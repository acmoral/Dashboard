function b8(t,r){for(var s=0;s<r.length;s++){const c=r[s];if(typeof c!="string"&&!Array.isArray(c)){for(const m in c)if(m!=="default"&&!(m in t)){const v=Object.getOwnPropertyDescriptor(c,m);v&&Object.defineProperty(t,m,v.get?v:{enumerable:!0,get:()=>c[m]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))c(m);new MutationObserver(m=>{for(const v of m)if(v.type==="childList")for(const T of v.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&c(T)}).observe(document,{childList:!0,subtree:!0});function s(m){const v={};return m.integrity&&(v.integrity=m.integrity),m.referrerPolicy&&(v.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?v.credentials="include":m.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function c(m){if(m.ep)return;m.ep=!0;const v=s(m);fetch(m.href,v)}})();var Mx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var hw={exports:{}},_y={},fw={exports:{}},xi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uR;function w8(){if(uR)return xi;uR=1;var t=Symbol.for("react.element"),r=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),m=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),T=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),R=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),F=Symbol.iterator;function G(qe){return qe===null||typeof qe!="object"?null:(qe=F&&qe[F]||qe["@@iterator"],typeof qe=="function"?qe:null)}var K={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ee=Object.assign,H={};function Z(qe,mt,ar){this.props=qe,this.context=mt,this.refs=H,this.updater=ar||K}Z.prototype.isReactComponent={},Z.prototype.setState=function(qe,mt){if(typeof qe!="object"&&typeof qe!="function"&&qe!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,qe,mt,"setState")},Z.prototype.forceUpdate=function(qe){this.updater.enqueueForceUpdate(this,qe,"forceUpdate")};function ae(){}ae.prototype=Z.prototype;function fe(qe,mt,ar){this.props=qe,this.context=mt,this.refs=H,this.updater=ar||K}var ue=fe.prototype=new ae;ue.constructor=fe,ee(ue,Z.prototype),ue.isPureReactComponent=!0;var _e=Array.isArray,le=Object.prototype.hasOwnProperty,pe={current:null},Te={key:!0,ref:!0,__self:!0,__source:!0};function De(qe,mt,ar){var Mr,Gr={},Tr=null,vr=null;if(mt!=null)for(Mr in mt.ref!==void 0&&(vr=mt.ref),mt.key!==void 0&&(Tr=""+mt.key),mt)le.call(mt,Mr)&&!Te.hasOwnProperty(Mr)&&(Gr[Mr]=mt[Mr]);var Br=arguments.length-2;if(Br===1)Gr.children=ar;else if(1<Br){for(var or=Array(Br),Ar=0;Ar<Br;Ar++)or[Ar]=arguments[Ar+2];Gr.children=or}if(qe&&qe.defaultProps)for(Mr in Br=qe.defaultProps,Br)Gr[Mr]===void 0&&(Gr[Mr]=Br[Mr]);return{$$typeof:t,type:qe,key:Tr,ref:vr,props:Gr,_owner:pe.current}}function Xe(qe,mt){return{$$typeof:t,type:qe.type,key:mt,ref:qe.ref,props:qe.props,_owner:qe._owner}}function wt(qe){return typeof qe=="object"&&qe!==null&&qe.$$typeof===t}function $e(qe){var mt={"=":"=0",":":"=2"};return"$"+qe.replace(/[=:]/g,function(ar){return mt[ar]})}var vt=/\/+/g;function ft(qe,mt){return typeof qe=="object"&&qe!==null&&qe.key!=null?$e(""+qe.key):mt.toString(36)}function bt(qe,mt,ar,Mr,Gr){var Tr=typeof qe;(Tr==="undefined"||Tr==="boolean")&&(qe=null);var vr=!1;if(qe===null)vr=!0;else switch(Tr){case"string":case"number":vr=!0;break;case"object":switch(qe.$$typeof){case t:case r:vr=!0}}if(vr)return vr=qe,Gr=Gr(vr),qe=Mr===""?"."+ft(vr,0):Mr,_e(Gr)?(ar="",qe!=null&&(ar=qe.replace(vt,"$&/")+"/"),bt(Gr,mt,ar,"",function(Ar){return Ar})):Gr!=null&&(wt(Gr)&&(Gr=Xe(Gr,ar+(!Gr.key||vr&&vr.key===Gr.key?"":(""+Gr.key).replace(vt,"$&/")+"/")+qe)),mt.push(Gr)),1;if(vr=0,Mr=Mr===""?".":Mr+":",_e(qe))for(var Br=0;Br<qe.length;Br++){Tr=qe[Br];var or=Mr+ft(Tr,Br);vr+=bt(Tr,mt,ar,or,Gr)}else if(or=G(qe),typeof or=="function")for(qe=or.call(qe),Br=0;!(Tr=qe.next()).done;)Tr=Tr.value,or=Mr+ft(Tr,Br++),vr+=bt(Tr,mt,ar,or,Gr);else if(Tr==="object")throw mt=String(qe),Error("Objects are not valid as a React child (found: "+(mt==="[object Object]"?"object with keys {"+Object.keys(qe).join(", ")+"}":mt)+"). If you meant to render a collection of children, use an array instead.");return vr}function St(qe,mt,ar){if(qe==null)return qe;var Mr=[],Gr=0;return bt(qe,Mr,"","",function(Tr){return mt.call(ar,Tr,Gr++)}),Mr}function gt(qe){if(qe._status===-1){var mt=qe._result;mt=mt(),mt.then(function(ar){(qe._status===0||qe._status===-1)&&(qe._status=1,qe._result=ar)},function(ar){(qe._status===0||qe._status===-1)&&(qe._status=2,qe._result=ar)}),qe._status===-1&&(qe._status=0,qe._result=mt)}if(qe._status===1)return qe._result.default;throw qe._result}var Rt={current:null},Ke={transition:null},yt={ReactCurrentDispatcher:Rt,ReactCurrentBatchConfig:Ke,ReactCurrentOwner:pe};function Vt(){throw Error("act(...) is not supported in production builds of React.")}return xi.Children={map:St,forEach:function(qe,mt,ar){St(qe,function(){mt.apply(this,arguments)},ar)},count:function(qe){var mt=0;return St(qe,function(){mt++}),mt},toArray:function(qe){return St(qe,function(mt){return mt})||[]},only:function(qe){if(!wt(qe))throw Error("React.Children.only expected to receive a single React element child.");return qe}},xi.Component=Z,xi.Fragment=s,xi.Profiler=m,xi.PureComponent=fe,xi.StrictMode=c,xi.Suspense=M,xi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=yt,xi.act=Vt,xi.cloneElement=function(qe,mt,ar){if(qe==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+qe+".");var Mr=ee({},qe.props),Gr=qe.key,Tr=qe.ref,vr=qe._owner;if(mt!=null){if(mt.ref!==void 0&&(Tr=mt.ref,vr=pe.current),mt.key!==void 0&&(Gr=""+mt.key),qe.type&&qe.type.defaultProps)var Br=qe.type.defaultProps;for(or in mt)le.call(mt,or)&&!Te.hasOwnProperty(or)&&(Mr[or]=mt[or]===void 0&&Br!==void 0?Br[or]:mt[or])}var or=arguments.length-2;if(or===1)Mr.children=ar;else if(1<or){Br=Array(or);for(var Ar=0;Ar<or;Ar++)Br[Ar]=arguments[Ar+2];Mr.children=Br}return{$$typeof:t,type:qe.type,key:Gr,ref:Tr,props:Mr,_owner:vr}},xi.createContext=function(qe){return qe={$$typeof:T,_currentValue:qe,_currentValue2:qe,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},qe.Provider={$$typeof:v,_context:qe},qe.Consumer=qe},xi.createElement=De,xi.createFactory=function(qe){var mt=De.bind(null,qe);return mt.type=qe,mt},xi.createRef=function(){return{current:null}},xi.forwardRef=function(qe){return{$$typeof:o,render:qe}},xi.isValidElement=wt,xi.lazy=function(qe){return{$$typeof:B,_payload:{_status:-1,_result:qe},_init:gt}},xi.memo=function(qe,mt){return{$$typeof:R,type:qe,compare:mt===void 0?null:mt}},xi.startTransition=function(qe){var mt=Ke.transition;Ke.transition={};try{qe()}finally{Ke.transition=mt}},xi.unstable_act=Vt,xi.useCallback=function(qe,mt){return Rt.current.useCallback(qe,mt)},xi.useContext=function(qe){return Rt.current.useContext(qe)},xi.useDebugValue=function(){},xi.useDeferredValue=function(qe){return Rt.current.useDeferredValue(qe)},xi.useEffect=function(qe,mt){return Rt.current.useEffect(qe,mt)},xi.useId=function(){return Rt.current.useId()},xi.useImperativeHandle=function(qe,mt,ar){return Rt.current.useImperativeHandle(qe,mt,ar)},xi.useInsertionEffect=function(qe,mt){return Rt.current.useInsertionEffect(qe,mt)},xi.useLayoutEffect=function(qe,mt){return Rt.current.useLayoutEffect(qe,mt)},xi.useMemo=function(qe,mt){return Rt.current.useMemo(qe,mt)},xi.useReducer=function(qe,mt,ar){return Rt.current.useReducer(qe,mt,ar)},xi.useRef=function(qe){return Rt.current.useRef(qe)},xi.useState=function(qe){return Rt.current.useState(qe)},xi.useSyncExternalStore=function(qe,mt,ar){return Rt.current.useSyncExternalStore(qe,mt,ar)},xi.useTransition=function(){return Rt.current.useTransition()},xi.version="18.3.1",xi}var hR;function uP(){return hR||(hR=1,fw.exports=w8()),fw.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fR;function S8(){if(fR)return _y;fR=1;var t=uP(),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,m=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,v={key:!0,ref:!0,__self:!0,__source:!0};function T(o,M,R){var B,F={},G=null,K=null;R!==void 0&&(G=""+R),M.key!==void 0&&(G=""+M.key),M.ref!==void 0&&(K=M.ref);for(B in M)c.call(M,B)&&!v.hasOwnProperty(B)&&(F[B]=M[B]);if(o&&o.defaultProps)for(B in M=o.defaultProps,M)F[B]===void 0&&(F[B]=M[B]);return{$$typeof:r,type:o,key:G,ref:K,props:F,_owner:m.current}}return _y.Fragment=s,_y.jsx=T,_y.jsxs=T,_y}var dR;function T8(){return dR||(dR=1,hw.exports=S8()),hw.exports}var He=T8(),Ox={},dw={exports:{}},wl={},pw={exports:{}},mw={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pR;function E8(){return pR||(pR=1,(function(t){function r(Ke,yt){var Vt=Ke.length;Ke.push(yt);e:for(;0<Vt;){var qe=Vt-1>>>1,mt=Ke[qe];if(0<m(mt,yt))Ke[qe]=yt,Ke[Vt]=mt,Vt=qe;else break e}}function s(Ke){return Ke.length===0?null:Ke[0]}function c(Ke){if(Ke.length===0)return null;var yt=Ke[0],Vt=Ke.pop();if(Vt!==yt){Ke[0]=Vt;e:for(var qe=0,mt=Ke.length,ar=mt>>>1;qe<ar;){var Mr=2*(qe+1)-1,Gr=Ke[Mr],Tr=Mr+1,vr=Ke[Tr];if(0>m(Gr,Vt))Tr<mt&&0>m(vr,Gr)?(Ke[qe]=vr,Ke[Tr]=Vt,qe=Tr):(Ke[qe]=Gr,Ke[Mr]=Vt,qe=Mr);else if(Tr<mt&&0>m(vr,Vt))Ke[qe]=vr,Ke[Tr]=Vt,qe=Tr;else break e}}return yt}function m(Ke,yt){var Vt=Ke.sortIndex-yt.sortIndex;return Vt!==0?Vt:Ke.id-yt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;t.unstable_now=function(){return v.now()}}else{var T=Date,o=T.now();t.unstable_now=function(){return T.now()-o}}var M=[],R=[],B=1,F=null,G=3,K=!1,ee=!1,H=!1,Z=typeof setTimeout=="function"?setTimeout:null,ae=typeof clearTimeout=="function"?clearTimeout:null,fe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ue(Ke){for(var yt=s(R);yt!==null;){if(yt.callback===null)c(R);else if(yt.startTime<=Ke)c(R),yt.sortIndex=yt.expirationTime,r(M,yt);else break;yt=s(R)}}function _e(Ke){if(H=!1,ue(Ke),!ee)if(s(M)!==null)ee=!0,gt(le);else{var yt=s(R);yt!==null&&Rt(_e,yt.startTime-Ke)}}function le(Ke,yt){ee=!1,H&&(H=!1,ae(De),De=-1),K=!0;var Vt=G;try{for(ue(yt),F=s(M);F!==null&&(!(F.expirationTime>yt)||Ke&&!$e());){var qe=F.callback;if(typeof qe=="function"){F.callback=null,G=F.priorityLevel;var mt=qe(F.expirationTime<=yt);yt=t.unstable_now(),typeof mt=="function"?F.callback=mt:F===s(M)&&c(M),ue(yt)}else c(M);F=s(M)}if(F!==null)var ar=!0;else{var Mr=s(R);Mr!==null&&Rt(_e,Mr.startTime-yt),ar=!1}return ar}finally{F=null,G=Vt,K=!1}}var pe=!1,Te=null,De=-1,Xe=5,wt=-1;function $e(){return!(t.unstable_now()-wt<Xe)}function vt(){if(Te!==null){var Ke=t.unstable_now();wt=Ke;var yt=!0;try{yt=Te(!0,Ke)}finally{yt?ft():(pe=!1,Te=null)}}else pe=!1}var ft;if(typeof fe=="function")ft=function(){fe(vt)};else if(typeof MessageChannel<"u"){var bt=new MessageChannel,St=bt.port2;bt.port1.onmessage=vt,ft=function(){St.postMessage(null)}}else ft=function(){Z(vt,0)};function gt(Ke){Te=Ke,pe||(pe=!0,ft())}function Rt(Ke,yt){De=Z(function(){Ke(t.unstable_now())},yt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Ke){Ke.callback=null},t.unstable_continueExecution=function(){ee||K||(ee=!0,gt(le))},t.unstable_forceFrameRate=function(Ke){0>Ke||125<Ke?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Xe=0<Ke?Math.floor(1e3/Ke):5},t.unstable_getCurrentPriorityLevel=function(){return G},t.unstable_getFirstCallbackNode=function(){return s(M)},t.unstable_next=function(Ke){switch(G){case 1:case 2:case 3:var yt=3;break;default:yt=G}var Vt=G;G=yt;try{return Ke()}finally{G=Vt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Ke,yt){switch(Ke){case 1:case 2:case 3:case 4:case 5:break;default:Ke=3}var Vt=G;G=Ke;try{return yt()}finally{G=Vt}},t.unstable_scheduleCallback=function(Ke,yt,Vt){var qe=t.unstable_now();switch(typeof Vt=="object"&&Vt!==null?(Vt=Vt.delay,Vt=typeof Vt=="number"&&0<Vt?qe+Vt:qe):Vt=qe,Ke){case 1:var mt=-1;break;case 2:mt=250;break;case 5:mt=1073741823;break;case 4:mt=1e4;break;default:mt=5e3}return mt=Vt+mt,Ke={id:B++,callback:yt,priorityLevel:Ke,startTime:Vt,expirationTime:mt,sortIndex:-1},Vt>qe?(Ke.sortIndex=Vt,r(R,Ke),s(M)===null&&Ke===s(R)&&(H?(ae(De),De=-1):H=!0,Rt(_e,Vt-qe))):(Ke.sortIndex=mt,r(M,Ke),ee||K||(ee=!0,gt(le))),Ke},t.unstable_shouldYield=$e,t.unstable_wrapCallback=function(Ke){var yt=G;return function(){var Vt=G;G=yt;try{return Ke.apply(this,arguments)}finally{G=Vt}}}})(mw)),mw}var mR;function A8(){return mR||(mR=1,pw.exports=E8()),pw.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gR;function P8(){if(gR)return wl;gR=1;var t=uP(),r=A8();function s(_){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+_,I=1;I<arguments.length;I++)b+="&args[]="+encodeURIComponent(arguments[I]);return"Minified React error #"+_+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var c=new Set,m={};function v(_,b){T(_,b),T(_+"Capture",b)}function T(_,b){for(m[_]=b,_=0;_<b.length;_++)c.add(b[_])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),M=Object.prototype.hasOwnProperty,R=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,B={},F={};function G(_){return M.call(F,_)?!0:M.call(B,_)?!1:R.test(_)?F[_]=!0:(B[_]=!0,!1)}function K(_,b,I,N){if(I!==null&&I.type===0)return!1;switch(typeof b){case"function":case"symbol":return!0;case"boolean":return N?!1:I!==null?!I.acceptsBooleans:(_=_.toLowerCase().slice(0,5),_!=="data-"&&_!=="aria-");default:return!1}}function ee(_,b,I,N){if(b===null||typeof b>"u"||K(_,b,I,N))return!0;if(N)return!1;if(I!==null)switch(I.type){case 3:return!b;case 4:return b===!1;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function H(_,b,I,N,W,ne,Se){this.acceptsBooleans=b===2||b===3||b===4,this.attributeName=N,this.attributeNamespace=W,this.mustUseProperty=I,this.propertyName=_,this.type=b,this.sanitizeURL=ne,this.removeEmptyString=Se}var Z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(_){Z[_]=new H(_,0,!1,_,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(_){var b=_[0];Z[b]=new H(b,1,!1,_[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(_){Z[_]=new H(_,2,!1,_.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(_){Z[_]=new H(_,2,!1,_,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(_){Z[_]=new H(_,3,!1,_.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(_){Z[_]=new H(_,3,!0,_,null,!1,!1)}),["capture","download"].forEach(function(_){Z[_]=new H(_,4,!1,_,null,!1,!1)}),["cols","rows","size","span"].forEach(function(_){Z[_]=new H(_,6,!1,_,null,!1,!1)}),["rowSpan","start"].forEach(function(_){Z[_]=new H(_,5,!1,_.toLowerCase(),null,!1,!1)});var ae=/[\-:]([a-z])/g;function fe(_){return _[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(_){var b=_.replace(ae,fe);Z[b]=new H(b,1,!1,_,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(_){var b=_.replace(ae,fe);Z[b]=new H(b,1,!1,_,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(_){var b=_.replace(ae,fe);Z[b]=new H(b,1,!1,_,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(_){Z[_]=new H(_,1,!1,_.toLowerCase(),null,!1,!1)}),Z.xlinkHref=new H("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(_){Z[_]=new H(_,1,!1,_.toLowerCase(),null,!0,!0)});function ue(_,b,I,N){var W=Z.hasOwnProperty(b)?Z[b]:null;(W!==null?W.type!==0:N||!(2<b.length)||b[0]!=="o"&&b[0]!=="O"||b[1]!=="n"&&b[1]!=="N")&&(ee(b,I,W,N)&&(I=null),N||W===null?G(b)&&(I===null?_.removeAttribute(b):_.setAttribute(b,""+I)):W.mustUseProperty?_[W.propertyName]=I===null?W.type===3?!1:"":I:(b=W.attributeName,N=W.attributeNamespace,I===null?_.removeAttribute(b):(W=W.type,I=W===3||W===4&&I===!0?"":""+I,N?_.setAttributeNS(N,b,I):_.setAttribute(b,I))))}var _e=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,le=Symbol.for("react.element"),pe=Symbol.for("react.portal"),Te=Symbol.for("react.fragment"),De=Symbol.for("react.strict_mode"),Xe=Symbol.for("react.profiler"),wt=Symbol.for("react.provider"),$e=Symbol.for("react.context"),vt=Symbol.for("react.forward_ref"),ft=Symbol.for("react.suspense"),bt=Symbol.for("react.suspense_list"),St=Symbol.for("react.memo"),gt=Symbol.for("react.lazy"),Rt=Symbol.for("react.offscreen"),Ke=Symbol.iterator;function yt(_){return _===null||typeof _!="object"?null:(_=Ke&&_[Ke]||_["@@iterator"],typeof _=="function"?_:null)}var Vt=Object.assign,qe;function mt(_){if(qe===void 0)try{throw Error()}catch(I){var b=I.stack.trim().match(/\n( *(at )?)/);qe=b&&b[1]||""}return`
`+qe+_}var ar=!1;function Mr(_,b){if(!_||ar)return"";ar=!0;var I=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(b)if(b=function(){throw Error()},Object.defineProperty(b.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(b,[])}catch(Zt){var N=Zt}Reflect.construct(_,[],b)}else{try{b.call()}catch(Zt){N=Zt}_.call(b.prototype)}else{try{throw Error()}catch(Zt){N=Zt}_()}}catch(Zt){if(Zt&&N&&typeof Zt.stack=="string"){for(var W=Zt.stack.split(`
`),ne=N.stack.split(`
`),Se=W.length-1,Je=ne.length-1;1<=Se&&0<=Je&&W[Se]!==ne[Je];)Je--;for(;1<=Se&&0<=Je;Se--,Je--)if(W[Se]!==ne[Je]){if(Se!==1||Je!==1)do if(Se--,Je--,0>Je||W[Se]!==ne[Je]){var st=`
`+W[Se].replace(" at new "," at ");return _.displayName&&st.includes("<anonymous>")&&(st=st.replace("<anonymous>",_.displayName)),st}while(1<=Se&&0<=Je);break}}}finally{ar=!1,Error.prepareStackTrace=I}return(_=_?_.displayName||_.name:"")?mt(_):""}function Gr(_){switch(_.tag){case 5:return mt(_.type);case 16:return mt("Lazy");case 13:return mt("Suspense");case 19:return mt("SuspenseList");case 0:case 2:case 15:return _=Mr(_.type,!1),_;case 11:return _=Mr(_.type.render,!1),_;case 1:return _=Mr(_.type,!0),_;default:return""}}function Tr(_){if(_==null)return null;if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _;switch(_){case Te:return"Fragment";case pe:return"Portal";case Xe:return"Profiler";case De:return"StrictMode";case ft:return"Suspense";case bt:return"SuspenseList"}if(typeof _=="object")switch(_.$$typeof){case $e:return(_.displayName||"Context")+".Consumer";case wt:return(_._context.displayName||"Context")+".Provider";case vt:var b=_.render;return _=_.displayName,_||(_=b.displayName||b.name||"",_=_!==""?"ForwardRef("+_+")":"ForwardRef"),_;case St:return b=_.displayName||null,b!==null?b:Tr(_.type)||"Memo";case gt:b=_._payload,_=_._init;try{return Tr(_(b))}catch{}}return null}function vr(_){var b=_.type;switch(_.tag){case 24:return"Cache";case 9:return(b.displayName||"Context")+".Consumer";case 10:return(b._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return _=b.render,_=_.displayName||_.name||"",b.displayName||(_!==""?"ForwardRef("+_+")":"ForwardRef");case 7:return"Fragment";case 5:return b;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Tr(b);case 8:return b===De?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof b=="function")return b.displayName||b.name||null;if(typeof b=="string")return b}return null}function Br(_){switch(typeof _){case"boolean":case"number":case"string":case"undefined":return _;case"object":return _;default:return""}}function or(_){var b=_.type;return(_=_.nodeName)&&_.toLowerCase()==="input"&&(b==="checkbox"||b==="radio")}function Ar(_){var b=or(_)?"checked":"value",I=Object.getOwnPropertyDescriptor(_.constructor.prototype,b),N=""+_[b];if(!_.hasOwnProperty(b)&&typeof I<"u"&&typeof I.get=="function"&&typeof I.set=="function"){var W=I.get,ne=I.set;return Object.defineProperty(_,b,{configurable:!0,get:function(){return W.call(this)},set:function(Se){N=""+Se,ne.call(this,Se)}}),Object.defineProperty(_,b,{enumerable:I.enumerable}),{getValue:function(){return N},setValue:function(Se){N=""+Se},stopTracking:function(){_._valueTracker=null,delete _[b]}}}}function un(_){_._valueTracker||(_._valueTracker=Ar(_))}function sr(_){if(!_)return!1;var b=_._valueTracker;if(!b)return!0;var I=b.getValue(),N="";return _&&(N=or(_)?_.checked?"true":"false":_.value),_=N,_!==I?(b.setValue(_),!0):!1}function ui(_){if(_=_||(typeof document<"u"?document:void 0),typeof _>"u")return null;try{return _.activeElement||_.body}catch{return _.body}}function Rn(_,b){var I=b.checked;return Vt({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:I??_._wrapperState.initialChecked})}function In(_,b){var I=b.defaultValue==null?"":b.defaultValue,N=b.checked!=null?b.checked:b.defaultChecked;I=Br(b.value!=null?b.value:I),_._wrapperState={initialChecked:N,initialValue:I,controlled:b.type==="checkbox"||b.type==="radio"?b.checked!=null:b.value!=null}}function hi(_,b){b=b.checked,b!=null&&ue(_,"checked",b,!1)}function Yi(_,b){hi(_,b);var I=Br(b.value),N=b.type;if(I!=null)N==="number"?(I===0&&_.value===""||_.value!=I)&&(_.value=""+I):_.value!==""+I&&(_.value=""+I);else if(N==="submit"||N==="reset"){_.removeAttribute("value");return}b.hasOwnProperty("value")?qo(_,b.type,I):b.hasOwnProperty("defaultValue")&&qo(_,b.type,Br(b.defaultValue)),b.checked==null&&b.defaultChecked!=null&&(_.defaultChecked=!!b.defaultChecked)}function Sa(_,b,I){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var N=b.type;if(!(N!=="submit"&&N!=="reset"||b.value!==void 0&&b.value!==null))return;b=""+_._wrapperState.initialValue,I||b===_.value||(_.value=b),_.defaultValue=b}I=_.name,I!==""&&(_.name=""),_.defaultChecked=!!_._wrapperState.initialChecked,I!==""&&(_.name=I)}function qo(_,b,I){(b!=="number"||ui(_.ownerDocument)!==_)&&(I==null?_.defaultValue=""+_._wrapperState.initialValue:_.defaultValue!==""+I&&(_.defaultValue=""+I))}var po=Array.isArray;function Vi(_,b,I,N){if(_=_.options,b){b={};for(var W=0;W<I.length;W++)b["$"+I[W]]=!0;for(I=0;I<_.length;I++)W=b.hasOwnProperty("$"+_[I].value),_[I].selected!==W&&(_[I].selected=W),W&&N&&(_[I].defaultSelected=!0)}else{for(I=""+Br(I),b=null,W=0;W<_.length;W++){if(_[W].value===I){_[W].selected=!0,N&&(_[W].defaultSelected=!0);return}b!==null||_[W].disabled||(b=_[W])}b!==null&&(b.selected=!0)}}function Bo(_,b){if(b.dangerouslySetInnerHTML!=null)throw Error(s(91));return Vt({},b,{value:void 0,defaultValue:void 0,children:""+_._wrapperState.initialValue})}function Ba(_,b){var I=b.value;if(I==null){if(I=b.children,b=b.defaultValue,I!=null){if(b!=null)throw Error(s(92));if(po(I)){if(1<I.length)throw Error(s(93));I=I[0]}b=I}b==null&&(b=""),I=b}_._wrapperState={initialValue:Br(I)}}function Os(_,b){var I=Br(b.value),N=Br(b.defaultValue);I!=null&&(I=""+I,I!==_.value&&(_.value=I),b.defaultValue==null&&_.defaultValue!==I&&(_.defaultValue=I)),N!=null&&(_.defaultValue=""+N)}function tl(_){var b=_.textContent;b===_._wrapperState.initialValue&&b!==""&&b!==null&&(_.value=b)}function ca(_){switch(_){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ta(_,b){return _==null||_==="http://www.w3.org/1999/xhtml"?ca(b):_==="http://www.w3.org/2000/svg"&&b==="foreignObject"?"http://www.w3.org/1999/xhtml":_}var ic,rl=(function(_){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(b,I,N,W){MSApp.execUnsafeLocalFunction(function(){return _(b,I,N,W)})}:_})(function(_,b){if(_.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in _)_.innerHTML=b;else{for(ic=ic||document.createElement("div"),ic.innerHTML="<svg>"+b.valueOf().toString()+"</svg>",b=ic.firstChild;_.firstChild;)_.removeChild(_.firstChild);for(;b.firstChild;)_.appendChild(b.firstChild)}});function nl(_,b){if(b){var I=_.firstChild;if(I&&I===_.lastChild&&I.nodeType===3){I.nodeValue=b;return}}_.textContent=b}var xo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},rs=["Webkit","ms","Moz","O"];Object.keys(xo).forEach(function(_){rs.forEach(function(b){b=b+_.charAt(0).toUpperCase()+_.substring(1),xo[b]=xo[_]})});function Al(_,b,I){return b==null||typeof b=="boolean"||b===""?"":I||typeof b!="number"||b===0||xo.hasOwnProperty(_)&&xo[_]?(""+b).trim():b+"px"}function il(_,b){_=_.style;for(var I in b)if(b.hasOwnProperty(I)){var N=I.indexOf("--")===0,W=Al(I,b[I],N);I==="float"&&(I="cssFloat"),N?_.setProperty(I,W):_[I]=W}}var oc=Vt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ol(_,b){if(b){if(oc[_]&&(b.children!=null||b.dangerouslySetInnerHTML!=null))throw Error(s(137,_));if(b.dangerouslySetInnerHTML!=null){if(b.children!=null)throw Error(s(60));if(typeof b.dangerouslySetInnerHTML!="object"||!("__html"in b.dangerouslySetInnerHTML))throw Error(s(61))}if(b.style!=null&&typeof b.style!="object")throw Error(s(62))}}function ac(_,b){if(_.indexOf("-")===-1)return typeof b.is=="string";switch(_){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ii=null;function Jc(_){return _=_.target||_.srcElement||window,_.correspondingUseElement&&(_=_.correspondingUseElement),_.nodeType===3?_.parentNode:_}var Qc=null,Go=null,al=null;function pd(_){if(_=bh(_)){if(typeof Qc!="function")throw Error(s(280));var b=_.stateNode;b&&(b=wh(b),Qc(_.stateNode,_.type,b))}}function eu(_){Go?al?al.push(_):al=[_]:Go=_}function kt(){if(Go){var _=Go,b=al;if(al=Go=null,pd(_),b)for(_=0;_<b.length;_++)pd(b[_])}}function sl(_,b){return _(b)}function md(){}var tu=!1;function Cn(_,b,I){if(tu)return _(b,I);tu=!0;try{return sl(_,b,I)}finally{tu=!1,(Go!==null||al!==null)&&(md(),kt())}}function et(_,b){var I=_.stateNode;if(I===null)return null;var N=wh(I);if(N===null)return null;I=N[b];e:switch(b){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(N=!N.disabled)||(_=_.type,N=!(_==="button"||_==="input"||_==="select"||_==="textarea")),_=!N;break e;default:_=!1}if(_)return null;if(I&&typeof I!="function")throw Error(s(231,b,typeof I));return I}var oe=!1;if(o)try{var se={};Object.defineProperty(se,"passive",{get:function(){oe=!0}}),window.addEventListener("test",se,se),window.removeEventListener("test",se,se)}catch{oe=!1}function be(_,b,I,N,W,ne,Se,Je,st){var Zt=Array.prototype.slice.call(arguments,3);try{b.apply(I,Zt)}catch(mr){this.onError(mr)}}var ke=!1,we=null,Ne=!1,it=null,Ve={onError:function(_){ke=!0,we=_}};function nt(_,b,I,N,W,ne,Se,Je,st){ke=!1,we=null,be.apply(Ve,arguments)}function $t(_,b,I,N,W,ne,Se,Je,st){if(nt.apply(this,arguments),ke){if(ke){var Zt=we;ke=!1,we=null}else throw Error(s(198));Ne||(Ne=!0,it=Zt)}}function Tt(_){var b=_,I=_;if(_.alternate)for(;b.return;)b=b.return;else{_=b;do b=_,(b.flags&4098)!==0&&(I=b.return),_=b.return;while(_)}return b.tag===3?I:null}function xr(_){if(_.tag===13){var b=_.memoizedState;if(b===null&&(_=_.alternate,_!==null&&(b=_.memoizedState)),b!==null)return b.dehydrated}return null}function Or(_){if(Tt(_)!==_)throw Error(s(188))}function Nr(_){var b=_.alternate;if(!b){if(b=Tt(_),b===null)throw Error(s(188));return b!==_?null:_}for(var I=_,N=b;;){var W=I.return;if(W===null)break;var ne=W.alternate;if(ne===null){if(N=W.return,N!==null){I=N;continue}break}if(W.child===ne.child){for(ne=W.child;ne;){if(ne===I)return Or(W),_;if(ne===N)return Or(W),b;ne=ne.sibling}throw Error(s(188))}if(I.return!==N.return)I=W,N=ne;else{for(var Se=!1,Je=W.child;Je;){if(Je===I){Se=!0,I=W,N=ne;break}if(Je===N){Se=!0,N=W,I=ne;break}Je=Je.sibling}if(!Se){for(Je=ne.child;Je;){if(Je===I){Se=!0,I=ne,N=W;break}if(Je===N){Se=!0,N=ne,I=W;break}Je=Je.sibling}if(!Se)throw Error(s(189))}}if(I.alternate!==N)throw Error(s(190))}if(I.tag!==3)throw Error(s(188));return I.stateNode.current===I?_:b}function ln(_){return _=Nr(_),_!==null?Jr(_):null}function Jr(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){var b=Jr(_);if(b!==null)return b;_=_.sibling}return null}var hn=r.unstable_scheduleCallback,Yn=r.unstable_cancelCallback,fn=r.unstable_shouldYield,Fi=r.unstable_requestPaint,$n=r.unstable_now,ro=r.unstable_getCurrentPriorityLevel,qn=r.unstable_ImmediatePriority,Dn=r.unstable_UserBlockingPriority,wi=r.unstable_NormalPriority,Ei=r.unstable_LowPriority,_i=r.unstable_IdlePriority,ao=null,no=null;function ea(_){if(no&&typeof no.onCommitFiberRoot=="function")try{no.onCommitFiberRoot(ao,_,void 0,(_.current.flags&128)===128)}catch{}}var Ea=Math.clz32?Math.clz32:gd,No=Math.log,sc=Math.LN2;function gd(_){return _>>>=0,_===0?32:31-(No(_)/sc|0)|0}var lc=64,cc=4194304;function uc(_){switch(_&-_){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return _&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return _}}function ru(_,b){var I=_.pendingLanes;if(I===0)return 0;var N=0,W=_.suspendedLanes,ne=_.pingedLanes,Se=I&268435455;if(Se!==0){var Je=Se&~W;Je!==0?N=uc(Je):(ne&=Se,ne!==0&&(N=uc(ne)))}else Se=I&~W,Se!==0?N=uc(Se):ne!==0&&(N=uc(ne));if(N===0)return 0;if(b!==0&&b!==N&&(b&W)===0&&(W=N&-N,ne=b&-b,W>=ne||W===16&&(ne&4194240)!==0))return b;if((N&4)!==0&&(N|=I&16),b=_.entangledLanes,b!==0)for(_=_.entanglements,b&=N;0<b;)I=31-Ea(b),W=1<<I,N|=_[I],b&=~W;return N}function nu(_,b){switch(_){case 1:case 2:case 4:return b+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return b+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ef(_,b){for(var I=_.suspendedLanes,N=_.pingedLanes,W=_.expirationTimes,ne=_.pendingLanes;0<ne;){var Se=31-Ea(ne),Je=1<<Se,st=W[Se];st===-1?((Je&I)===0||(Je&N)!==0)&&(W[Se]=nu(Je,b)):st<=b&&(_.expiredLanes|=Je),ne&=~Je}}function Ju(_){return _=_.pendingLanes&-1073741825,_!==0?_:_&1073741824?1073741824:0}function ps(){var _=lc;return lc<<=1,(lc&4194240)===0&&(lc=64),_}function Aa(_){for(var b=[],I=0;31>I;I++)b.push(_);return b}function ua(_,b,I){_.pendingLanes|=b,b!==536870912&&(_.suspendedLanes=0,_.pingedLanes=0),_=_.eventTimes,b=31-Ea(b),_[b]=I}function Pl(_,b){var I=_.pendingLanes&~b;_.pendingLanes=b,_.suspendedLanes=0,_.pingedLanes=0,_.expiredLanes&=b,_.mutableReadLanes&=b,_.entangledLanes&=b,b=_.entanglements;var N=_.eventTimes;for(_=_.expirationTimes;0<I;){var W=31-Ea(I),ne=1<<W;b[W]=0,N[W]=-1,_[W]=-1,I&=~ne}}function ns(_,b){var I=_.entangledLanes|=b;for(_=_.entanglements;I;){var N=31-Ea(I),W=1<<N;W&b|_[N]&b&&(_[N]|=b),I&=~W}}var oi=0;function Qu(_){return _&=-_,1<_?4<_?(_&268435455)!==0?16:536870912:4:1}var Rs,iu,hc,ou,_d,tf=!1,Ho=[],Na=null,ms=null,is=null,eh=new Map,th=new Map,gs=[],bn="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function rf(_,b){switch(_){case"focusin":case"focusout":Na=null;break;case"dragenter":case"dragleave":ms=null;break;case"mouseover":case"mouseout":is=null;break;case"pointerover":case"pointerout":eh.delete(b.pointerId);break;case"gotpointercapture":case"lostpointercapture":th.delete(b.pointerId)}}function ll(_,b,I,N,W,ne){return _===null||_.nativeEvent!==ne?(_={blockedOn:b,domEventName:I,eventSystemFlags:N,nativeEvent:ne,targetContainers:[W]},b!==null&&(b=bh(b),b!==null&&iu(b)),_):(_.eventSystemFlags|=N,b=_.targetContainers,W!==null&&b.indexOf(W)===-1&&b.push(W),_)}function nf(_,b,I,N,W){switch(b){case"focusin":return Na=ll(Na,_,b,I,N,W),!0;case"dragenter":return ms=ll(ms,_,b,I,N,W),!0;case"mouseover":return is=ll(is,_,b,I,N,W),!0;case"pointerover":var ne=W.pointerId;return eh.set(ne,ll(eh.get(ne)||null,_,b,I,N,W)),!0;case"gotpointercapture":return ne=W.pointerId,th.set(ne,ll(th.get(ne)||null,_,b,I,N,W)),!0}return!1}function Hm(_){var b=_u(_.target);if(b!==null){var I=Tt(b);if(I!==null){if(b=I.tag,b===13){if(b=xr(I),b!==null){_.blockedOn=b,_d(_.priority,function(){hc(I)});return}}else if(b===3&&I.stateNode.current.memoizedState.isDehydrated){_.blockedOn=I.tag===3?I.stateNode.containerInfo:null;return}}}_.blockedOn=null}function fc(_){if(_.blockedOn!==null)return!1;for(var b=_.targetContainers;0<b.length;){var I=gc(_.domEventName,_.eventSystemFlags,b[0],_.nativeEvent);if(I===null){I=_.nativeEvent;var N=new I.constructor(I.type,I);ii=N,I.target.dispatchEvent(N),ii=null}else return b=bh(I),b!==null&&iu(b),_.blockedOn=I,!1;b.shift()}return!0}function dc(_,b,I){fc(_)&&I.delete(b)}function pc(){tf=!1,Na!==null&&fc(Na)&&(Na=null),ms!==null&&fc(ms)&&(ms=null),is!==null&&fc(is)&&(is=null),eh.forEach(dc),th.forEach(dc)}function Il(_,b){_.blockedOn===b&&(_.blockedOn=null,tf||(tf=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,pc)))}function rh(_){function b(W){return Il(W,_)}if(0<Ho.length){Il(Ho[0],_);for(var I=1;I<Ho.length;I++){var N=Ho[I];N.blockedOn===_&&(N.blockedOn=null)}}for(Na!==null&&Il(Na,_),ms!==null&&Il(ms,_),is!==null&&Il(is,_),eh.forEach(b),th.forEach(b),I=0;I<gs.length;I++)N=gs[I],N.blockedOn===_&&(N.blockedOn=null);for(;0<gs.length&&(I=gs[0],I.blockedOn===null);)Hm(I),I.blockedOn===null&&gs.shift()}var Cl=_e.ReactCurrentBatchConfig,of=!0;function nh(_,b,I,N){var W=oi,ne=Cl.transition;Cl.transition=null;try{oi=1,yd(_,b,I,N)}finally{oi=W,Cl.transition=ne}}function au(_,b,I,N){var W=oi,ne=Cl.transition;Cl.transition=null;try{oi=4,yd(_,b,I,N)}finally{oi=W,Cl.transition=ne}}function yd(_,b,I,N){if(of){var W=gc(_,b,I,N);if(W===null)Cd(_,b,N,mc,I),rf(_,N);else if(nf(W,_,b,I,N))N.stopPropagation();else if(rf(_,N),b&4&&-1<bn.indexOf(_)){for(;W!==null;){var ne=bh(W);if(ne!==null&&Rs(ne),ne=gc(_,b,I,N),ne===null&&Cd(_,b,N,mc,I),ne===W)break;W=ne}W!==null&&N.stopPropagation()}else Cd(_,b,N,null,I)}}var mc=null;function gc(_,b,I,N){if(mc=null,_=Jc(N),_=_u(_),_!==null)if(b=Tt(_),b===null)_=null;else if(I=b.tag,I===13){if(_=xr(b),_!==null)return _;_=null}else if(I===3){if(b.stateNode.current.memoizedState.isDehydrated)return b.tag===3?b.stateNode.containerInfo:null;_=null}else b!==_&&(_=null);return mc=_,null}function cl(_){switch(_){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ro()){case qn:return 1;case Dn:return 4;case wi:case Ei:return 16;case _i:return 536870912;default:return 16}default:return 16}}var Co=null,af=null,ih=null;function _c(){if(ih)return ih;var _,b=af,I=b.length,N,W="value"in Co?Co.value:Co.textContent,ne=W.length;for(_=0;_<I&&b[_]===W[_];_++);var Se=I-_;for(N=1;N<=Se&&b[I-N]===W[ne-N];N++);return ih=W.slice(_,1<N?1-N:void 0)}function ta(_){var b=_.keyCode;return"charCode"in _?(_=_.charCode,_===0&&b===13&&(_=13)):_=b,_===10&&(_=13),32<=_||_===13?_:0}function oh(){return!0}function sf(){return!1}function Pa(_){function b(I,N,W,ne,Se){this._reactName=I,this._targetInst=W,this.type=N,this.nativeEvent=ne,this.target=Se,this.currentTarget=null;for(var Je in _)_.hasOwnProperty(Je)&&(I=_[Je],this[Je]=I?I(ne):ne[Je]);return this.isDefaultPrevented=(ne.defaultPrevented!=null?ne.defaultPrevented:ne.returnValue===!1)?oh:sf,this.isPropagationStopped=sf,this}return Vt(b.prototype,{preventDefault:function(){this.defaultPrevented=!0;var I=this.nativeEvent;I&&(I.preventDefault?I.preventDefault():typeof I.returnValue!="unknown"&&(I.returnValue=!1),this.isDefaultPrevented=oh)},stopPropagation:function(){var I=this.nativeEvent;I&&(I.stopPropagation?I.stopPropagation():typeof I.cancelBubble!="unknown"&&(I.cancelBubble=!0),this.isPropagationStopped=oh)},persist:function(){},isPersistent:oh}),b}var wn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(_){return _.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},su=Pa(wn),ul=Vt({},wn,{view:0,detail:0}),Wm=Pa(ul),Sr,vd,Ml,hl=Vt({},ul,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yc,button:0,buttons:0,relatedTarget:function(_){return _.relatedTarget===void 0?_.fromElement===_.srcElement?_.toElement:_.fromElement:_.relatedTarget},movementX:function(_){return"movementX"in _?_.movementX:(_!==Ml&&(Ml&&_.type==="mousemove"?(Sr=_.screenX-Ml.screenX,vd=_.screenY-Ml.screenY):vd=Sr=0,Ml=_),Sr)},movementY:function(_){return"movementY"in _?_.movementY:vd}}),ja=Pa(hl),Bp=Vt({},hl,{dataTransfer:0}),ah=Pa(Bp),yr=Vt({},ul,{relatedTarget:0}),kn=Pa(yr),Fn=Vt({},wn,{animationName:0,elapsedTime:0,pseudoElement:0}),Ua=Pa(Fn),Ol=Vt({},wn,{clipboardData:function(_){return"clipboardData"in _?_.clipboardData:window.clipboardData}}),Nn=Pa(Ol),xd=Vt({},wn,{data:0}),sh=Pa(xd),lf={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ra={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},io={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function I_(_){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(_):(_=io[_])?!!b[_]:!1}function yc(){return I_}var vc=Vt({},ul,{key:function(_){if(_.key){var b=lf[_.key]||_.key;if(b!=="Unidentified")return b}return _.type==="keypress"?(_=ta(_),_===13?"Enter":String.fromCharCode(_)):_.type==="keydown"||_.type==="keyup"?ra[_.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yc,charCode:function(_){return _.type==="keypress"?ta(_):0},keyCode:function(_){return _.type==="keydown"||_.type==="keyup"?_.keyCode:0},which:function(_){return _.type==="keypress"?ta(_):_.type==="keydown"||_.type==="keyup"?_.keyCode:0}}),cf=Pa(vc),bd=Vt({},hl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lh=Pa(bd),wd=Vt({},ul,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yc}),ha=Pa(wd),Rl=Vt({},wn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ia=Pa(Rl),lu=Vt({},hl,{deltaX:function(_){return"deltaX"in _?_.deltaX:"wheelDeltaX"in _?-_.wheelDeltaX:0},deltaY:function(_){return"deltaY"in _?_.deltaY:"wheelDeltaY"in _?-_.wheelDeltaY:"wheelDelta"in _?-_.wheelDelta:0},deltaZ:0,deltaMode:0}),Wr=Pa(lu),er=[9,13,27,32],Va=o&&"CompositionEvent"in window,Ir=null;o&&"documentMode"in document&&(Ir=document.documentMode);var Ji=o&&"TextEvent"in window&&!Ir,ch=o&&(!Va||Ir&&8<Ir&&11>=Ir),Er=" ",cu=!1;function uu(_,b){switch(_){case"keyup":return er.indexOf(b.keyCode)!==-1;case"keydown":return b.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Dl(_){return _=_.detail,typeof _=="object"&&"data"in _?_.data:null}var hu=!1;function _s(_,b){switch(_){case"compositionend":return Dl(b);case"keypress":return b.which!==32?null:(cu=!0,Er);case"textInput":return _=b.data,_===Er&&cu?null:_;default:return null}}function fa(_,b){if(hu)return _==="compositionend"||!Va&&uu(_,b)?(_=_c(),ih=af=Co=null,hu=!1,_):null;switch(_){case"paste":return null;case"keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;case"compositionend":return ch&&b.locale!=="ko"?null:b.data;default:return null}}var uf={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bo(_){var b=_&&_.nodeName&&_.nodeName.toLowerCase();return b==="input"?!!uf[_.type]:b==="textarea"}function Sd(_,b,I,N){eu(N),b=gu(b,"onChange"),0<b.length&&(I=new su("onChange","change",null,I,N),_.push({event:I,listeners:b}))}var $a=null,wo=null;function hf(_){$p(_,0)}function Td(_){var b=Pc(_);if(sr(b))return _}function C_(_,b){if(_==="change")return b}var kl=!1;if(o){var xc;if(o){var Ll="oninput"in document;if(!Ll){var fu=document.createElement("div");fu.setAttribute("oninput","return;"),Ll=typeof fu.oninput=="function"}xc=Ll}else xc=!1;kl=xc&&(!document.documentMode||9<document.documentMode)}function Np(){$a&&($a.detachEvent("onpropertychange",ff),wo=$a=null)}function ff(_){if(_.propertyName==="value"&&Td(wo)){var b=[];Sd(b,wo,_,Jc(_)),Cn(hf,b)}}function jp(_,b,I){_==="focusin"?(Np(),$a=b,wo=I,$a.attachEvent("onpropertychange",ff)):_==="focusout"&&Np()}function bc(_){if(_==="selectionchange"||_==="keyup"||_==="keydown")return Td(wo)}function M_(_,b){if(_==="click")return Td(b)}function Zm(_,b){if(_==="input"||_==="change")return Td(b)}function O_(_,b){return _===b&&(_!==0||1/_===1/b)||_!==_&&b!==b}var ys=typeof Object.is=="function"?Object.is:O_;function uh(_,b){if(ys(_,b))return!0;if(typeof _!="object"||_===null||typeof b!="object"||b===null)return!1;var I=Object.keys(_),N=Object.keys(b);if(I.length!==N.length)return!1;for(N=0;N<I.length;N++){var W=I[N];if(!M.call(b,W)||!ys(_[W],b[W]))return!1}return!0}function Ed(_){for(;_&&_.firstChild;)_=_.firstChild;return _}function zl(_,b){var I=Ed(_);_=0;for(var N;I;){if(I.nodeType===3){if(N=_+I.textContent.length,_<=b&&N>=b)return{node:I,offset:b-_};_=N}e:{for(;I;){if(I.nextSibling){I=I.nextSibling;break e}I=I.parentNode}I=void 0}I=Ed(I)}}function Up(_,b){return _&&b?_===b?!0:_&&_.nodeType===3?!1:b&&b.nodeType===3?Up(_,b.parentNode):"contains"in _?_.contains(b):_.compareDocumentPosition?!!(_.compareDocumentPosition(b)&16):!1:!1}function Vp(){for(var _=window,b=ui();b instanceof _.HTMLIFrameElement;){try{var I=typeof b.contentWindow.location.href=="string"}catch{I=!1}if(I)_=b.contentWindow;else break;b=ui(_.document)}return b}function hh(_){var b=_&&_.nodeName&&_.nodeName.toLowerCase();return b&&(b==="input"&&(_.type==="text"||_.type==="search"||_.type==="tel"||_.type==="url"||_.type==="password")||b==="textarea"||_.contentEditable==="true")}function wc(_){var b=Vp(),I=_.focusedElem,N=_.selectionRange;if(b!==I&&I&&I.ownerDocument&&Up(I.ownerDocument.documentElement,I)){if(N!==null&&hh(I)){if(b=N.start,_=N.end,_===void 0&&(_=b),"selectionStart"in I)I.selectionStart=b,I.selectionEnd=Math.min(_,I.value.length);else if(_=(b=I.ownerDocument||document)&&b.defaultView||window,_.getSelection){_=_.getSelection();var W=I.textContent.length,ne=Math.min(N.start,W);N=N.end===void 0?ne:Math.min(N.end,W),!_.extend&&ne>N&&(W=N,N=ne,ne=W),W=zl(I,ne);var Se=zl(I,N);W&&Se&&(_.rangeCount!==1||_.anchorNode!==W.node||_.anchorOffset!==W.offset||_.focusNode!==Se.node||_.focusOffset!==Se.offset)&&(b=b.createRange(),b.setStart(W.node,W.offset),_.removeAllRanges(),ne>N?(_.addRange(b),_.extend(Se.node,Se.offset)):(b.setEnd(Se.node,Se.offset),_.addRange(b)))}}for(b=[],_=I;_=_.parentNode;)_.nodeType===1&&b.push({element:_,left:_.scrollLeft,top:_.scrollTop});for(typeof I.focus=="function"&&I.focus(),I=0;I<b.length;I++)_=b[I],_.element.scrollLeft=_.left,_.element.scrollTop=_.top}}var df=o&&"documentMode"in document&&11>=document.documentMode,na=null,pf=null,fl=null,Sc=!1;function Ad(_,b,I){var N=I.window===I?I.document:I.nodeType===9?I:I.ownerDocument;Sc||na==null||na!==ui(N)||(N=na,"selectionStart"in N&&hh(N)?N={start:N.selectionStart,end:N.selectionEnd}:(N=(N.ownerDocument&&N.ownerDocument.defaultView||window).getSelection(),N={anchorNode:N.anchorNode,anchorOffset:N.anchorOffset,focusNode:N.focusNode,focusOffset:N.focusOffset}),fl&&uh(fl,N)||(fl=N,N=gu(pf,"onSelect"),0<N.length&&(b=new su("onSelect","select",null,b,I),_.push({event:b,listeners:N}),b.target=na)))}function du(_,b){var I={};return I[_.toLowerCase()]=b.toLowerCase(),I["Webkit"+_]="webkit"+b,I["Moz"+_]="moz"+b,I}var Wo={animationend:du("Animation","AnimationEnd"),animationiteration:du("Animation","AnimationIteration"),animationstart:du("Animation","AnimationStart"),transitionend:du("Transition","TransitionEnd")},fh={},Wt={};o&&(Wt=document.createElement("div").style,"AnimationEvent"in window||(delete Wo.animationend.animation,delete Wo.animationiteration.animation,delete Wo.animationstart.animation),"TransitionEvent"in window||delete Wo.transitionend.transition);function dh(_){if(fh[_])return fh[_];if(!Wo[_])return _;var b=Wo[_],I;for(I in b)if(b.hasOwnProperty(I)&&I in Wt)return fh[_]=b[I];return _}var mf=dh("animationend"),gf=dh("animationiteration"),ph=dh("animationstart"),Tc=dh("transitionend"),os=new Map,_f="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ca(_,b){os.set(_,b),v(b,[_])}for(var pu=0;pu<_f.length;pu++){var as=_f[pu],gn=as.toLowerCase(),R_=as[0].toUpperCase()+as.slice(1);Ca(gn,"on"+R_)}Ca(mf,"onAnimationEnd"),Ca(gf,"onAnimationIteration"),Ca(ph,"onAnimationStart"),Ca("dblclick","onDoubleClick"),Ca("focusin","onFocus"),Ca("focusout","onBlur"),Ca(Tc,"onTransitionEnd"),T("onMouseEnter",["mouseout","mouseover"]),T("onMouseLeave",["mouseout","mouseover"]),T("onPointerEnter",["pointerout","pointerover"]),T("onPointerLeave",["pointerout","pointerover"]),v("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),v("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),v("onBeforeInput",["compositionend","keypress","textInput","paste"]),v("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),v("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),v("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),D_=new Set("cancel close invalid load scroll toggle".split(" ").concat(mu));function Pd(_,b,I){var N=_.type||"unknown-event";_.currentTarget=I,$t(N,b,void 0,_),_.currentTarget=null}function $p(_,b){b=(b&4)!==0;for(var I=0;I<_.length;I++){var N=_[I],W=N.event;N=N.listeners;e:{var ne=void 0;if(b)for(var Se=N.length-1;0<=Se;Se--){var Je=N[Se],st=Je.instance,Zt=Je.currentTarget;if(Je=Je.listener,st!==ne&&W.isPropagationStopped())break e;Pd(W,Je,Zt),ne=st}else for(Se=0;Se<N.length;Se++){if(Je=N[Se],st=Je.instance,Zt=Je.currentTarget,Je=Je.listener,st!==ne&&W.isPropagationStopped())break e;Pd(W,Je,Zt),ne=st}}}if(Ne)throw _=it,Ne=!1,it=null,_}function cn(_,b){var I=b[Ac];I===void 0&&(I=b[Ac]=new Set);var N=_+"__bubble";I.has(N)||(Xm(b,_,2,!1),I.add(N))}function qp(_,b,I){var N=0;b&&(N|=4),Xm(I,_,N,b)}var Id="_reactListening"+Math.random().toString(36).slice(2);function yf(_){if(!_[Id]){_[Id]=!0,c.forEach(function(I){I!=="selectionchange"&&(D_.has(I)||qp(I,!1,_),qp(I,!0,_))});var b=_.nodeType===9?_:_.ownerDocument;b===null||b[Id]||(b[Id]=!0,qp("selectionchange",!1,b))}}function Xm(_,b,I,N){switch(cl(b)){case 1:var W=nh;break;case 4:W=au;break;default:W=yd}I=W.bind(null,b,I,_),W=void 0,!oe||b!=="touchstart"&&b!=="touchmove"&&b!=="wheel"||(W=!0),N?W!==void 0?_.addEventListener(b,I,{capture:!0,passive:W}):_.addEventListener(b,I,!0):W!==void 0?_.addEventListener(b,I,{passive:W}):_.addEventListener(b,I,!1)}function Cd(_,b,I,N,W){var ne=N;if((b&1)===0&&(b&2)===0&&N!==null)e:for(;;){if(N===null)return;var Se=N.tag;if(Se===3||Se===4){var Je=N.stateNode.containerInfo;if(Je===W||Je.nodeType===8&&Je.parentNode===W)break;if(Se===4)for(Se=N.return;Se!==null;){var st=Se.tag;if((st===3||st===4)&&(st=Se.stateNode.containerInfo,st===W||st.nodeType===8&&st.parentNode===W))return;Se=Se.return}for(;Je!==null;){if(Se=_u(Je),Se===null)return;if(st=Se.tag,st===5||st===6){N=ne=Se;continue e}Je=Je.parentNode}}N=N.return}Cn(function(){var Zt=ne,mr=Jc(I),br=[];e:{var _r=os.get(_);if(_r!==void 0){var $r=su,Kr=_;switch(_){case"keypress":if(ta(I)===0)break e;case"keydown":case"keyup":$r=cf;break;case"focusin":Kr="focus",$r=kn;break;case"focusout":Kr="blur",$r=kn;break;case"beforeblur":case"afterblur":$r=kn;break;case"click":if(I.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$r=ja;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$r=ah;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$r=ha;break;case mf:case gf:case ph:$r=Ua;break;case Tc:$r=Ia;break;case"scroll":$r=Wm;break;case"wheel":$r=Wr;break;case"copy":case"cut":case"paste":$r=Nn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$r=lh}var Qr=(b&4)!==0,Lo=!Qr&&_==="scroll",Mt=Qr?_r!==null?_r+"Capture":null:_r;Qr=[];for(var pt=Zt,jt;pt!==null;){jt=pt;var Pr=jt.stateNode;if(jt.tag===5&&Pr!==null&&(jt=Pr,Mt!==null&&(Pr=et(pt,Mt),Pr!=null&&Qr.push(vf(pt,Pr,jt)))),Lo)break;pt=pt.return}0<Qr.length&&(_r=new $r(_r,Kr,null,I,mr),br.push({event:_r,listeners:Qr}))}}if((b&7)===0){e:{if(_r=_==="mouseover"||_==="pointerover",$r=_==="mouseout"||_==="pointerout",_r&&I!==ii&&(Kr=I.relatedTarget||I.fromElement)&&(_u(Kr)||Kr[gl]))break e;if(($r||_r)&&(_r=mr.window===mr?mr:(_r=mr.ownerDocument)?_r.defaultView||_r.parentWindow:window,$r?(Kr=I.relatedTarget||I.toElement,$r=Zt,Kr=Kr?_u(Kr):null,Kr!==null&&(Lo=Tt(Kr),Kr!==Lo||Kr.tag!==5&&Kr.tag!==6)&&(Kr=null)):($r=null,Kr=Zt),$r!==Kr)){if(Qr=ja,Pr="onMouseLeave",Mt="onMouseEnter",pt="mouse",(_==="pointerout"||_==="pointerover")&&(Qr=lh,Pr="onPointerLeave",Mt="onPointerEnter",pt="pointer"),Lo=$r==null?_r:Pc($r),jt=Kr==null?_r:Pc(Kr),_r=new Qr(Pr,pt+"leave",$r,I,mr),_r.target=Lo,_r.relatedTarget=jt,Pr=null,_u(mr)===Zt&&(Qr=new Qr(Mt,pt+"enter",Kr,I,mr),Qr.target=jt,Qr.relatedTarget=Lo,Pr=Qr),Lo=Pr,$r&&Kr)t:{for(Qr=$r,Mt=Kr,pt=0,jt=Qr;jt;jt=mh(jt))pt++;for(jt=0,Pr=Mt;Pr;Pr=mh(Pr))jt++;for(;0<pt-jt;)Qr=mh(Qr),pt--;for(;0<jt-pt;)Mt=mh(Mt),jt--;for(;pt--;){if(Qr===Mt||Mt!==null&&Qr===Mt.alternate)break t;Qr=mh(Qr),Mt=mh(Mt)}Qr=null}else Qr=null;$r!==null&&Gp(br,_r,$r,Qr,!1),Kr!==null&&Lo!==null&&Gp(br,Lo,Kr,Qr,!0)}}e:{if(_r=Zt?Pc(Zt):window,$r=_r.nodeName&&_r.nodeName.toLowerCase(),$r==="select"||$r==="input"&&_r.type==="file")var sn=C_;else if(bo(_r))if(kl)sn=Zm;else{sn=bc;var En=jp}else($r=_r.nodeName)&&$r.toLowerCase()==="input"&&(_r.type==="checkbox"||_r.type==="radio")&&(sn=M_);if(sn&&(sn=sn(_,Zt))){Sd(br,sn,I,mr);break e}En&&En(_,_r,Zt),_==="focusout"&&(En=_r._wrapperState)&&En.controlled&&_r.type==="number"&&qo(_r,"number",_r.value)}switch(En=Zt?Pc(Zt):window,_){case"focusin":(bo(En)||En.contentEditable==="true")&&(na=En,pf=Zt,fl=null);break;case"focusout":fl=pf=na=null;break;case"mousedown":Sc=!0;break;case"contextmenu":case"mouseup":case"dragend":Sc=!1,Ad(br,I,mr);break;case"selectionchange":if(df)break;case"keydown":case"keyup":Ad(br,I,mr)}var An;if(Va)e:{switch(_){case"compositionstart":var jn="onCompositionStart";break e;case"compositionend":jn="onCompositionEnd";break e;case"compositionupdate":jn="onCompositionUpdate";break e}jn=void 0}else hu?uu(_,I)&&(jn="onCompositionEnd"):_==="keydown"&&I.keyCode===229&&(jn="onCompositionStart");jn&&(ch&&I.locale!=="ko"&&(hu||jn!=="onCompositionStart"?jn==="onCompositionEnd"&&hu&&(An=_c()):(Co=mr,af="value"in Co?Co.value:Co.textContent,hu=!0)),En=gu(Zt,jn),0<En.length&&(jn=new sh(jn,_,null,I,mr),br.push({event:jn,listeners:En}),An?jn.data=An:(An=Dl(I),An!==null&&(jn.data=An)))),(An=Ji?_s(_,I):fa(_,I))&&(Zt=gu(Zt,"onBeforeInput"),0<Zt.length&&(mr=new sh("onBeforeInput","beforeinput",null,I,mr),br.push({event:mr,listeners:Zt}),mr.data=An))}$p(br,b)})}function vf(_,b,I){return{instance:_,listener:b,currentTarget:I}}function gu(_,b){for(var I=b+"Capture",N=[];_!==null;){var W=_,ne=W.stateNode;W.tag===5&&ne!==null&&(W=ne,ne=et(_,I),ne!=null&&N.unshift(vf(_,ne,W)),ne=et(_,b),ne!=null&&N.push(vf(_,ne,W))),_=_.return}return N}function mh(_){if(_===null)return null;do _=_.return;while(_&&_.tag!==5);return _||null}function Gp(_,b,I,N,W){for(var ne=b._reactName,Se=[];I!==null&&I!==N;){var Je=I,st=Je.alternate,Zt=Je.stateNode;if(st!==null&&st===N)break;Je.tag===5&&Zt!==null&&(Je=Zt,W?(st=et(I,ne),st!=null&&Se.unshift(vf(I,st,Je))):W||(st=et(I,ne),st!=null&&Se.push(vf(I,st,Je)))),I=I.return}Se.length!==0&&_.push({event:b,listeners:Se})}var Hp=/\r\n?/g,Md=/\u0000|\uFFFD/g;function Od(_){return(typeof _=="string"?_:""+_).replace(Hp,`
`).replace(Md,"")}function dl(_,b,I){if(b=Od(b),Od(_)!==b&&I)throw Error(s(425))}function Fl(){}var gh=null,_h=null;function Ec(_,b){return _==="textarea"||_==="noscript"||typeof b.children=="string"||typeof b.children=="number"||typeof b.dangerouslySetInnerHTML=="object"&&b.dangerouslySetInnerHTML!==null&&b.dangerouslySetInnerHTML.__html!=null}var Rd=typeof setTimeout=="function"?setTimeout:void 0,Wp=typeof clearTimeout=="function"?clearTimeout:void 0,Zp=typeof Promise=="function"?Promise:void 0,yh=typeof queueMicrotask=="function"?queueMicrotask:typeof Zp<"u"?function(_){return Zp.resolve(null).then(_).catch(Dd)}:Rd;function Dd(_){setTimeout(function(){throw _})}function vh(_,b){var I=b,N=0;do{var W=I.nextSibling;if(_.removeChild(I),W&&W.nodeType===8)if(I=W.data,I==="/$"){if(N===0){_.removeChild(W),rh(b);return}N--}else I!=="$"&&I!=="$?"&&I!=="$!"||N++;I=W}while(I);rh(b)}function pl(_){for(;_!=null;_=_.nextSibling){var b=_.nodeType;if(b===1||b===3)break;if(b===8){if(b=_.data,b==="$"||b==="$!"||b==="$?")break;if(b==="/$")return null}}return _}function xf(_){_=_.previousSibling;for(var b=0;_;){if(_.nodeType===8){var I=_.data;if(I==="$"||I==="$!"||I==="$?"){if(b===0)return _;b--}else I==="/$"&&b++}_=_.previousSibling}return null}var ml=Math.random().toString(36).slice(2),Ds="__reactFiber$"+ml,xh="__reactProps$"+ml,gl="__reactContainer$"+ml,Ac="__reactEvents$"+ml,Km="__reactListeners$"+ml,Xp="__reactHandles$"+ml;function _u(_){var b=_[Ds];if(b)return b;for(var I=_.parentNode;I;){if(b=I[gl]||I[Ds]){if(I=b.alternate,b.child!==null||I!==null&&I.child!==null)for(_=xf(_);_!==null;){if(I=_[Ds])return I;_=xf(_)}return b}_=I,I=_.parentNode}return null}function bh(_){return _=_[Ds]||_[gl],!_||_.tag!==5&&_.tag!==6&&_.tag!==13&&_.tag!==3?null:_}function Pc(_){if(_.tag===5||_.tag===6)return _.stateNode;throw Error(s(33))}function wh(_){return _[xh]||null}var bf=[],Bl=-1;function _l(_){return{current:_}}function Ii(_){0>Bl||(_.current=bf[Bl],bf[Bl]=null,Bl--)}function $i(_,b){Bl++,bf[Bl]=_.current,_.current=b}var ss={},Mo=_l(ss),ia=_l(!1),So=ss;function Ic(_,b){var I=_.type.contextTypes;if(!I)return ss;var N=_.stateNode;if(N&&N.__reactInternalMemoizedUnmaskedChildContext===b)return N.__reactInternalMemoizedMaskedChildContext;var W={},ne;for(ne in I)W[ne]=b[ne];return N&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=b,_.__reactInternalMemoizedMaskedChildContext=W),W}function oa(_){return _=_.childContextTypes,_!=null}function Cc(){Ii(ia),Ii(Mo)}function wf(_,b,I){if(Mo.current!==ss)throw Error(s(168));$i(Mo,b),$i(ia,I)}function kd(_,b,I){var N=_.stateNode;if(b=b.childContextTypes,typeof N.getChildContext!="function")return I;N=N.getChildContext();for(var W in N)if(!(W in b))throw Error(s(108,vr(_)||"Unknown",W));return Vt({},I,N)}function Sh(_){return _=(_=_.stateNode)&&_.__reactInternalMemoizedMergedChildContext||ss,So=Mo.current,$i(Mo,_),$i(ia,ia.current),!0}function Sf(_,b,I){var N=_.stateNode;if(!N)throw Error(s(169));I?(_=kd(_,b,So),N.__reactInternalMemoizedMergedChildContext=_,Ii(ia),Ii(Mo),$i(Mo,_)):Ii(ia),$i(ia,I)}var vs=null,yu=!1,Nl=!1;function Ld(_){vs===null?vs=[_]:vs.push(_)}function Kp(_){yu=!0,Ld(_)}function jl(){if(!Nl&&vs!==null){Nl=!0;var _=0,b=oi;try{var I=vs;for(oi=1;_<I.length;_++){var N=I[_];do N=N(!0);while(N!==null)}vs=null,yu=!1}catch(W){throw vs!==null&&(vs=vs.slice(_+1)),hn(qn,jl),W}finally{oi=b,Nl=!1}}return null}var ks=[],vu=0,Tf=null,zd=0,xs=[],bs=0,yl=null,Ls=1,zs="";function Mc(_,b){ks[vu++]=zd,ks[vu++]=Tf,Tf=_,zd=b}function xu(_,b,I){xs[bs++]=Ls,xs[bs++]=zs,xs[bs++]=yl,yl=_;var N=Ls;_=zs;var W=32-Ea(N)-1;N&=~(1<<W),I+=1;var ne=32-Ea(b)+W;if(30<ne){var Se=W-W%5;ne=(N&(1<<Se)-1).toString(32),N>>=Se,W-=Se,Ls=1<<32-Ea(b)+W|I<<W|N,zs=ne+_}else Ls=1<<ne|I<<W|N,zs=_}function Ef(_){_.return!==null&&(Mc(_,1),xu(_,1,0))}function Fd(_){for(;_===Tf;)Tf=ks[--vu],ks[vu]=null,zd=ks[--vu],ks[vu]=null;for(;_===yl;)yl=xs[--bs],xs[bs]=null,zs=xs[--bs],xs[bs]=null,Ls=xs[--bs],xs[bs]=null}var qa=null,da=null,Ci=!1,ls=null;function Ul(_,b){var I=ti(5,null,null,0);I.elementType="DELETED",I.stateNode=b,I.return=_,b=_.deletions,b===null?(_.deletions=[I],_.flags|=16):b.push(I)}function Vl(_,b){switch(_.tag){case 5:var I=_.type;return b=b.nodeType!==1||I.toLowerCase()!==b.nodeName.toLowerCase()?null:b,b!==null?(_.stateNode=b,qa=_,da=pl(b.firstChild),!0):!1;case 6:return b=_.pendingProps===""||b.nodeType!==3?null:b,b!==null?(_.stateNode=b,qa=_,da=null,!0):!1;case 13:return b=b.nodeType!==8?null:b,b!==null?(I=yl!==null?{id:Ls,overflow:zs}:null,_.memoizedState={dehydrated:b,treeContext:I,retryLane:1073741824},I=ti(18,null,null,0),I.stateNode=b,I.return=_,_.child=I,qa=_,da=null,!0):!1;default:return!1}}function Th(_){return(_.mode&1)!==0&&(_.flags&128)===0}function Bd(_){if(Ci){var b=da;if(b){var I=b;if(!Vl(_,b)){if(Th(_))throw Error(s(418));b=pl(I.nextSibling);var N=qa;b&&Vl(_,b)?Ul(N,I):(_.flags=_.flags&-4097|2,Ci=!1,qa=_)}}else{if(Th(_))throw Error(s(418));_.flags=_.flags&-4097|2,Ci=!1,qa=_}}}function Yp(_){for(_=_.return;_!==null&&_.tag!==5&&_.tag!==3&&_.tag!==13;)_=_.return;qa=_}function bu(_){if(_!==qa)return!1;if(!Ci)return Yp(_),Ci=!0,!1;var b;if((b=_.tag!==3)&&!(b=_.tag!==5)&&(b=_.type,b=b!=="head"&&b!=="body"&&!Ec(_.type,_.memoizedProps)),b&&(b=da)){if(Th(_))throw Af(),Error(s(418));for(;b;)Ul(_,b),b=pl(b.nextSibling)}if(Yp(_),_.tag===13){if(_=_.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(s(317));e:{for(_=_.nextSibling,b=0;_;){if(_.nodeType===8){var I=_.data;if(I==="/$"){if(b===0){da=pl(_.nextSibling);break e}b--}else I!=="$"&&I!=="$!"&&I!=="$?"||b++}_=_.nextSibling}da=null}}else da=qa?pl(_.stateNode.nextSibling):null;return!0}function Af(){for(var _=da;_;)_=pl(_.nextSibling)}function wu(){da=qa=null,Ci=!1}function Pf(_){ls===null?ls=[_]:ls.push(_)}var Su=_e.ReactCurrentBatchConfig;function Tu(_,b,I){if(_=I.ref,_!==null&&typeof _!="function"&&typeof _!="object"){if(I._owner){if(I=I._owner,I){if(I.tag!==1)throw Error(s(309));var N=I.stateNode}if(!N)throw Error(s(147,_));var W=N,ne=""+_;return b!==null&&b.ref!==null&&typeof b.ref=="function"&&b.ref._stringRef===ne?b.ref:(b=function(Se){var Je=W.refs;Se===null?delete Je[ne]:Je[ne]=Se},b._stringRef=ne,b)}if(typeof _!="string")throw Error(s(284));if(!I._owner)throw Error(s(290,_))}return _}function If(_,b){throw _=Object.prototype.toString.call(b),Error(s(31,_==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":_))}function Jp(_){var b=_._init;return b(_._payload)}function $l(_){function b(Mt,pt){if(_){var jt=Mt.deletions;jt===null?(Mt.deletions=[pt],Mt.flags|=16):jt.push(pt)}}function I(Mt,pt){if(!_)return null;for(;pt!==null;)b(Mt,pt),pt=pt.sibling;return null}function N(Mt,pt){for(Mt=new Map;pt!==null;)pt.key!==null?Mt.set(pt.key,pt):Mt.set(pt.index,pt),pt=pt.sibling;return Mt}function W(Mt,pt){return Mt=Ko(Mt,pt),Mt.index=0,Mt.sibling=null,Mt}function ne(Mt,pt,jt){return Mt.index=jt,_?(jt=Mt.alternate,jt!==null?(jt=jt.index,jt<pt?(Mt.flags|=2,pt):jt):(Mt.flags|=2,pt)):(Mt.flags|=1048576,pt)}function Se(Mt){return _&&Mt.alternate===null&&(Mt.flags|=2),Mt}function Je(Mt,pt,jt,Pr){return pt===null||pt.tag!==6?(pt=Oa(jt,Mt.mode,Pr),pt.return=Mt,pt):(pt=W(pt,jt),pt.return=Mt,pt)}function st(Mt,pt,jt,Pr){var sn=jt.type;return sn===Te?mr(Mt,pt,jt.props.children,Pr,jt.key):pt!==null&&(pt.elementType===sn||typeof sn=="object"&&sn!==null&&sn.$$typeof===gt&&Jp(sn)===pt.type)?(Pr=W(pt,jt.props),Pr.ref=Tu(Mt,pt,jt),Pr.return=Mt,Pr):(Pr=Vo(jt.type,jt.key,jt.props,null,Mt.mode,Pr),Pr.ref=Tu(Mt,pt,jt),Pr.return=Mt,Pr)}function Zt(Mt,pt,jt,Pr){return pt===null||pt.tag!==4||pt.stateNode.containerInfo!==jt.containerInfo||pt.stateNode.implementation!==jt.implementation?(pt=Xa(jt,Mt.mode,Pr),pt.return=Mt,pt):(pt=W(pt,jt.children||[]),pt.return=Mt,pt)}function mr(Mt,pt,jt,Pr,sn){return pt===null||pt.tag!==7?(pt=ko(jt,Mt.mode,Pr,sn),pt.return=Mt,pt):(pt=W(pt,jt),pt.return=Mt,pt)}function br(Mt,pt,jt){if(typeof pt=="string"&&pt!==""||typeof pt=="number")return pt=Oa(""+pt,Mt.mode,jt),pt.return=Mt,pt;if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case le:return jt=Vo(pt.type,pt.key,pt.props,null,Mt.mode,jt),jt.ref=Tu(Mt,null,pt),jt.return=Mt,jt;case pe:return pt=Xa(pt,Mt.mode,jt),pt.return=Mt,pt;case gt:var Pr=pt._init;return br(Mt,Pr(pt._payload),jt)}if(po(pt)||yt(pt))return pt=ko(pt,Mt.mode,jt,null),pt.return=Mt,pt;If(Mt,pt)}return null}function _r(Mt,pt,jt,Pr){var sn=pt!==null?pt.key:null;if(typeof jt=="string"&&jt!==""||typeof jt=="number")return sn!==null?null:Je(Mt,pt,""+jt,Pr);if(typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case le:return jt.key===sn?st(Mt,pt,jt,Pr):null;case pe:return jt.key===sn?Zt(Mt,pt,jt,Pr):null;case gt:return sn=jt._init,_r(Mt,pt,sn(jt._payload),Pr)}if(po(jt)||yt(jt))return sn!==null?null:mr(Mt,pt,jt,Pr,null);If(Mt,jt)}return null}function $r(Mt,pt,jt,Pr,sn){if(typeof Pr=="string"&&Pr!==""||typeof Pr=="number")return Mt=Mt.get(jt)||null,Je(pt,Mt,""+Pr,sn);if(typeof Pr=="object"&&Pr!==null){switch(Pr.$$typeof){case le:return Mt=Mt.get(Pr.key===null?jt:Pr.key)||null,st(pt,Mt,Pr,sn);case pe:return Mt=Mt.get(Pr.key===null?jt:Pr.key)||null,Zt(pt,Mt,Pr,sn);case gt:var En=Pr._init;return $r(Mt,pt,jt,En(Pr._payload),sn)}if(po(Pr)||yt(Pr))return Mt=Mt.get(jt)||null,mr(pt,Mt,Pr,sn,null);If(pt,Pr)}return null}function Kr(Mt,pt,jt,Pr){for(var sn=null,En=null,An=pt,jn=pt=0,sa=null;An!==null&&jn<jt.length;jn++){An.index>jn?(sa=An,An=null):sa=An.sibling;var Ri=_r(Mt,An,jt[jn],Pr);if(Ri===null){An===null&&(An=sa);break}_&&An&&Ri.alternate===null&&b(Mt,An),pt=ne(Ri,pt,jn),En===null?sn=Ri:En.sibling=Ri,En=Ri,An=sa}if(jn===jt.length)return I(Mt,An),Ci&&Mc(Mt,jn),sn;if(An===null){for(;jn<jt.length;jn++)An=br(Mt,jt[jn],Pr),An!==null&&(pt=ne(An,pt,jn),En===null?sn=An:En.sibling=An,En=An);return Ci&&Mc(Mt,jn),sn}for(An=N(Mt,An);jn<jt.length;jn++)sa=$r(An,Mt,jn,jt[jn],Pr),sa!==null&&(_&&sa.alternate!==null&&An.delete(sa.key===null?jn:sa.key),pt=ne(sa,pt,jn),En===null?sn=sa:En.sibling=sa,En=sa);return _&&An.forEach(function(Bh){return b(Mt,Bh)}),Ci&&Mc(Mt,jn),sn}function Qr(Mt,pt,jt,Pr){var sn=yt(jt);if(typeof sn!="function")throw Error(s(150));if(jt=sn.call(jt),jt==null)throw Error(s(151));for(var En=sn=null,An=pt,jn=pt=0,sa=null,Ri=jt.next();An!==null&&!Ri.done;jn++,Ri=jt.next()){An.index>jn?(sa=An,An=null):sa=An.sibling;var Bh=_r(Mt,An,Ri.value,Pr);if(Bh===null){An===null&&(An=sa);break}_&&An&&Bh.alternate===null&&b(Mt,An),pt=ne(Bh,pt,jn),En===null?sn=Bh:En.sibling=Bh,En=Bh,An=sa}if(Ri.done)return I(Mt,An),Ci&&Mc(Mt,jn),sn;if(An===null){for(;!Ri.done;jn++,Ri=jt.next())Ri=br(Mt,Ri.value,Pr),Ri!==null&&(pt=ne(Ri,pt,jn),En===null?sn=Ri:En.sibling=Ri,En=Ri);return Ci&&Mc(Mt,jn),sn}for(An=N(Mt,An);!Ri.done;jn++,Ri=jt.next())Ri=$r(An,Mt,jn,Ri.value,Pr),Ri!==null&&(_&&Ri.alternate!==null&&An.delete(Ri.key===null?jn:Ri.key),pt=ne(Ri,pt,jn),En===null?sn=Ri:En.sibling=Ri,En=Ri);return _&&An.forEach(function(jv){return b(Mt,jv)}),Ci&&Mc(Mt,jn),sn}function Lo(Mt,pt,jt,Pr){if(typeof jt=="object"&&jt!==null&&jt.type===Te&&jt.key===null&&(jt=jt.props.children),typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case le:e:{for(var sn=jt.key,En=pt;En!==null;){if(En.key===sn){if(sn=jt.type,sn===Te){if(En.tag===7){I(Mt,En.sibling),pt=W(En,jt.props.children),pt.return=Mt,Mt=pt;break e}}else if(En.elementType===sn||typeof sn=="object"&&sn!==null&&sn.$$typeof===gt&&Jp(sn)===En.type){I(Mt,En.sibling),pt=W(En,jt.props),pt.ref=Tu(Mt,En,jt),pt.return=Mt,Mt=pt;break e}I(Mt,En);break}else b(Mt,En);En=En.sibling}jt.type===Te?(pt=ko(jt.props.children,Mt.mode,Pr,jt.key),pt.return=Mt,Mt=pt):(Pr=Vo(jt.type,jt.key,jt.props,null,Mt.mode,Pr),Pr.ref=Tu(Mt,pt,jt),Pr.return=Mt,Mt=Pr)}return Se(Mt);case pe:e:{for(En=jt.key;pt!==null;){if(pt.key===En)if(pt.tag===4&&pt.stateNode.containerInfo===jt.containerInfo&&pt.stateNode.implementation===jt.implementation){I(Mt,pt.sibling),pt=W(pt,jt.children||[]),pt.return=Mt,Mt=pt;break e}else{I(Mt,pt);break}else b(Mt,pt);pt=pt.sibling}pt=Xa(jt,Mt.mode,Pr),pt.return=Mt,Mt=pt}return Se(Mt);case gt:return En=jt._init,Lo(Mt,pt,En(jt._payload),Pr)}if(po(jt))return Kr(Mt,pt,jt,Pr);if(yt(jt))return Qr(Mt,pt,jt,Pr);If(Mt,jt)}return typeof jt=="string"&&jt!==""||typeof jt=="number"?(jt=""+jt,pt!==null&&pt.tag===6?(I(Mt,pt.sibling),pt=W(pt,jt),pt.return=Mt,Mt=pt):(I(Mt,pt),pt=Oa(jt,Mt.mode,Pr),pt.return=Mt,Mt=pt),Se(Mt)):I(Mt,pt)}return Lo}var Oc=$l(!0),Nd=$l(!1),vl=_l(null),Eu=null,cs=null,Cf=null;function ql(){Cf=cs=Eu=null}function Au(_){var b=vl.current;Ii(vl),_._currentValue=b}function Mf(_,b,I){for(;_!==null;){var N=_.alternate;if((_.childLanes&b)!==b?(_.childLanes|=b,N!==null&&(N.childLanes|=b)):N!==null&&(N.childLanes&b)!==b&&(N.childLanes|=b),_===I)break;_=_.return}}function Pu(_,b){Eu=_,Cf=cs=null,_=_.dependencies,_!==null&&_.firstContext!==null&&((_.lanes&b)!==0&&(Eo=!0),_.firstContext=null)}function Ga(_){var b=_._currentValue;if(Cf!==_)if(_={context:_,memoizedValue:b,next:null},cs===null){if(Eu===null)throw Error(s(308));cs=_,Eu.dependencies={lanes:0,firstContext:_}}else cs=cs.next=_;return b}var Ha=null;function Iu(_){Ha===null?Ha=[_]:Ha.push(_)}function ir(_,b,I,N){var W=b.interleaved;return W===null?(I.next=I,Iu(b)):(I.next=W.next,W.next=I),b.interleaved=I,ws(_,N)}function ws(_,b){_.lanes|=b;var I=_.alternate;for(I!==null&&(I.lanes|=b),I=_,_=_.return;_!==null;)_.childLanes|=b,I=_.alternate,I!==null&&(I.childLanes|=b),I=_,_=_.return;return I.tag===3?I.stateNode:null}var Ss=!1;function Fs(_){_.updateQueue={baseState:_.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function pa(_,b){_=_.updateQueue,b.updateQueue===_&&(b.updateQueue={baseState:_.baseState,firstBaseUpdate:_.firstBaseUpdate,lastBaseUpdate:_.lastBaseUpdate,shared:_.shared,effects:_.effects})}function wr(_,b){return{eventTime:_,lane:b,tag:0,payload:null,callback:null,next:null}}function xl(_,b,I){var N=_.updateQueue;if(N===null)return null;if(N=N.shared,(S&2)!==0){var W=N.pending;return W===null?b.next=b:(b.next=W.next,W.next=b),N.pending=b,ws(_,I)}return W=N.interleaved,W===null?(b.next=b,Iu(N)):(b.next=W.next,W.next=b),N.interleaved=b,ws(_,I)}function jd(_,b,I){if(b=b.updateQueue,b!==null&&(b=b.shared,(I&4194240)!==0)){var N=b.lanes;N&=_.pendingLanes,I|=N,b.lanes=I,ns(_,I)}}function Ym(_,b){var I=_.updateQueue,N=_.alternate;if(N!==null&&(N=N.updateQueue,I===N)){var W=null,ne=null;if(I=I.firstBaseUpdate,I!==null){do{var Se={eventTime:I.eventTime,lane:I.lane,tag:I.tag,payload:I.payload,callback:I.callback,next:null};ne===null?W=ne=Se:ne=ne.next=Se,I=I.next}while(I!==null);ne===null?W=ne=b:ne=ne.next=b}else W=ne=b;I={baseState:N.baseState,firstBaseUpdate:W,lastBaseUpdate:ne,shared:N.shared,effects:N.effects},_.updateQueue=I;return}_=I.lastBaseUpdate,_===null?I.firstBaseUpdate=b:_.next=b,I.lastBaseUpdate=b}function Cu(_,b,I,N){var W=_.updateQueue;Ss=!1;var ne=W.firstBaseUpdate,Se=W.lastBaseUpdate,Je=W.shared.pending;if(Je!==null){W.shared.pending=null;var st=Je,Zt=st.next;st.next=null,Se===null?ne=Zt:Se.next=Zt,Se=st;var mr=_.alternate;mr!==null&&(mr=mr.updateQueue,Je=mr.lastBaseUpdate,Je!==Se&&(Je===null?mr.firstBaseUpdate=Zt:Je.next=Zt,mr.lastBaseUpdate=st))}if(ne!==null){var br=W.baseState;Se=0,mr=Zt=st=null,Je=ne;do{var _r=Je.lane,$r=Je.eventTime;if((N&_r)===_r){mr!==null&&(mr=mr.next={eventTime:$r,lane:0,tag:Je.tag,payload:Je.payload,callback:Je.callback,next:null});e:{var Kr=_,Qr=Je;switch(_r=b,$r=I,Qr.tag){case 1:if(Kr=Qr.payload,typeof Kr=="function"){br=Kr.call($r,br,_r);break e}br=Kr;break e;case 3:Kr.flags=Kr.flags&-65537|128;case 0:if(Kr=Qr.payload,_r=typeof Kr=="function"?Kr.call($r,br,_r):Kr,_r==null)break e;br=Vt({},br,_r);break e;case 2:Ss=!0}}Je.callback!==null&&Je.lane!==0&&(_.flags|=64,_r=W.effects,_r===null?W.effects=[Je]:_r.push(Je))}else $r={eventTime:$r,lane:_r,tag:Je.tag,payload:Je.payload,callback:Je.callback,next:null},mr===null?(Zt=mr=$r,st=br):mr=mr.next=$r,Se|=_r;if(Je=Je.next,Je===null){if(Je=W.shared.pending,Je===null)break;_r=Je,Je=_r.next,_r.next=null,W.lastBaseUpdate=_r,W.shared.pending=null}}while(!0);if(mr===null&&(st=br),W.baseState=st,W.firstBaseUpdate=Zt,W.lastBaseUpdate=mr,b=W.shared.interleaved,b!==null){W=b;do Se|=W.lane,W=W.next;while(W!==b)}else ne===null&&(W.shared.lanes=0);Q|=Se,_.lanes=Se,_.memoizedState=br}}function Of(_,b,I){if(_=b.effects,b.effects=null,_!==null)for(b=0;b<_.length;b++){var N=_[b],W=N.callback;if(W!==null){if(N.callback=null,N=I,typeof W!="function")throw Error(s(191,W));W.call(N)}}}var Eh={},us=_l(Eh),Rf=_l(Eh),Df=_l(Eh);function Oo(_){if(_===Eh)throw Error(s(174));return _}function kf(_,b){switch($i(Df,b),$i(Rf,_),$i(us,Eh),_=b.nodeType,_){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Ta(null,"");break;default:_=_===8?b.parentNode:b,b=_.namespaceURI||null,_=_.tagName,b=Ta(b,_)}Ii(us),$i(us,b)}function To(){Ii(us),Ii(Rf),Ii(Df)}function Gl(_){Oo(Df.current);var b=Oo(us.current),I=Ta(b,_.type);b!==I&&($i(Rf,_),$i(us,I))}function Ud(_){Rf.current===_&&(Ii(us),Ii(Rf))}var Qi=_l(0);function Ah(_){for(var b=_;b!==null;){if(b.tag===13){var I=b.memoizedState;if(I!==null&&(I=I.dehydrated,I===null||I.data==="$?"||I.data==="$!"))return b}else if(b.tag===19&&b.memoizedProps.revealOrder!==void 0){if((b.flags&128)!==0)return b}else if(b.child!==null){b.child.return=b,b=b.child;continue}if(b===_)break;for(;b.sibling===null;){if(b.return===null||b.return===_)return null;b=b.return}b.sibling.return=b.return,b=b.sibling}return null}var Lf=[];function Vd(){for(var _=0;_<Lf.length;_++)Lf[_]._workInProgressVersionPrimary=null;Lf.length=0}var hs=_e.ReactCurrentDispatcher,Un=_e.ReactCurrentBatchConfig,Bs=0,Zi=null,so=null,jo=null,zf=!1,Ts=!1,Ns=0,js=0;function Ct(){throw Error(s(321))}function Qt(_,b){if(b===null)return!1;for(var I=0;I<b.length&&I<_.length;I++)if(!ys(_[I],b[I]))return!1;return!0}function Rc(_,b,I,N,W,ne){if(Bs=ne,Zi=b,b.memoizedState=null,b.updateQueue=null,b.lanes=0,hs.current=_===null||_.memoizedState===null?Lc:Mh,_=I(N,W),Ts){ne=0;do{if(Ts=!1,Ns=0,25<=ne)throw Error(s(301));ne+=1,jo=so=null,b.updateQueue=null,hs.current=Xd,_=I(N,W)}while(Ts)}if(hs.current=ga,b=so!==null&&so.next!==null,Bs=0,jo=so=Zi=null,zf=!1,b)throw Error(s(300));return _}function Ai(){var _=Ns!==0;return Ns=0,_}function Ge(){var _={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return jo===null?Zi.memoizedState=jo=_:jo=jo.next=_,jo}function fs(){if(so===null){var _=Zi.alternate;_=_!==null?_.memoizedState:null}else _=so.next;var b=jo===null?Zi.memoizedState:jo.next;if(b!==null)jo=b,so=_;else{if(_===null)throw Error(s(310));so=_,_={memoizedState:so.memoizedState,baseState:so.baseState,baseQueue:so.baseQueue,queue:so.queue,next:null},jo===null?Zi.memoizedState=jo=_:jo=jo.next=_}return jo}function Hl(_,b){return typeof b=="function"?b(_):b}function Mu(_){var b=fs(),I=b.queue;if(I===null)throw Error(s(311));I.lastRenderedReducer=_;var N=so,W=N.baseQueue,ne=I.pending;if(ne!==null){if(W!==null){var Se=W.next;W.next=ne.next,ne.next=Se}N.baseQueue=W=ne,I.pending=null}if(W!==null){ne=W.next,N=N.baseState;var Je=Se=null,st=null,Zt=ne;do{var mr=Zt.lane;if((Bs&mr)===mr)st!==null&&(st=st.next={lane:0,action:Zt.action,hasEagerState:Zt.hasEagerState,eagerState:Zt.eagerState,next:null}),N=Zt.hasEagerState?Zt.eagerState:_(N,Zt.action);else{var br={lane:mr,action:Zt.action,hasEagerState:Zt.hasEagerState,eagerState:Zt.eagerState,next:null};st===null?(Je=st=br,Se=N):st=st.next=br,Zi.lanes|=mr,Q|=mr}Zt=Zt.next}while(Zt!==null&&Zt!==ne);st===null?Se=N:st.next=Je,ys(N,b.memoizedState)||(Eo=!0),b.memoizedState=N,b.baseState=Se,b.baseQueue=st,I.lastRenderedState=N}if(_=I.interleaved,_!==null){W=_;do ne=W.lane,Zi.lanes|=ne,Q|=ne,W=W.next;while(W!==_)}else W===null&&(I.lanes=0);return[b.memoizedState,I.dispatch]}function Dc(_){var b=fs(),I=b.queue;if(I===null)throw Error(s(311));I.lastRenderedReducer=_;var N=I.dispatch,W=I.pending,ne=b.memoizedState;if(W!==null){I.pending=null;var Se=W=W.next;do ne=_(ne,Se.action),Se=Se.next;while(Se!==W);ys(ne,b.memoizedState)||(Eo=!0),b.memoizedState=ne,b.baseQueue===null&&(b.baseState=ne),I.lastRenderedState=ne}return[ne,N]}function $d(){}function Ff(_,b){var I=Zi,N=fs(),W=b(),ne=!ys(N.memoizedState,W);if(ne&&(N.memoizedState=W,Eo=!0),N=N.queue,Hd(Jm.bind(null,I,N,_),[_]),N.getSnapshot!==b||ne||jo!==null&&jo.memoizedState.tag&1){if(I.flags|=2048,Ph(9,Us.bind(null,I,N,W,b),void 0,null),A===null)throw Error(s(349));(Bs&30)!==0||Ou(I,b,W)}return W}function Ou(_,b,I){_.flags|=16384,_={getSnapshot:b,value:I},b=Zi.updateQueue,b===null?(b={lastEffect:null,stores:null},Zi.updateQueue=b,b.stores=[_]):(I=b.stores,I===null?b.stores=[_]:I.push(_))}function Us(_,b,I,N){b.value=I,b.getSnapshot=N,qd(b)&&Bf(_)}function Jm(_,b,I){return I(function(){qd(b)&&Bf(_)})}function qd(_){var b=_.getSnapshot;_=_.value;try{var I=b();return!ys(_,I)}catch{return!0}}function Bf(_){var b=ws(_,1);b!==null&&ze(b,_,1,-1)}function Gd(_){var b=Ge();return typeof _=="function"&&(_=_()),b.memoizedState=b.baseState=_,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hl,lastRenderedState:_},b.queue=_,_=_.dispatch=em.bind(null,Zi,_),[b.memoizedState,_]}function Ph(_,b,I,N){return _={tag:_,create:b,destroy:I,deps:N,next:null},b=Zi.updateQueue,b===null?(b={lastEffect:null,stores:null},Zi.updateQueue=b,b.lastEffect=_.next=_):(I=b.lastEffect,I===null?b.lastEffect=_.next=_:(N=I.next,I.next=_,_.next=N,b.lastEffect=_)),_}function Qp(){return fs().memoizedState}function Ru(_,b,I,N){var W=Ge();Zi.flags|=_,W.memoizedState=Ph(1|b,I,void 0,N===void 0?null:N)}function kc(_,b,I,N){var W=fs();N=N===void 0?null:N;var ne=void 0;if(so!==null){var Se=so.memoizedState;if(ne=Se.destroy,N!==null&&Qt(N,Se.deps)){W.memoizedState=Ph(b,I,ne,N);return}}Zi.flags|=_,W.memoizedState=Ph(1|b,I,ne,N)}function Du(_,b){return Ru(8390656,8,_,b)}function Hd(_,b){return kc(2048,8,_,b)}function Qm(_,b){return kc(4,2,_,b)}function Zo(_,b){return kc(4,4,_,b)}function eg(_,b){if(typeof b=="function")return _=_(),b(_),function(){b(null)};if(b!=null)return _=_(),b.current=_,function(){b.current=null}}function Ih(_,b,I){return I=I!=null?I.concat([_]):null,kc(4,4,eg.bind(null,b,_),I)}function ni(){}function mn(_,b){var I=fs();b=b===void 0?null:b;var N=I.memoizedState;return N!==null&&b!==null&&Qt(b,N[1])?N[0]:(I.memoizedState=[_,b],_)}function Wd(_,b){var I=fs();b=b===void 0?null:b;var N=I.memoizedState;return N!==null&&b!==null&&Qt(b,N[1])?N[0]:(_=_(),I.memoizedState=[_,b],_)}function ma(_,b,I){return(Bs&21)===0?(_.baseState&&(_.baseState=!1,Eo=!0),_.memoizedState=I):(ys(I,b)||(I=ps(),Zi.lanes|=I,Q|=I,_.baseState=!0),b)}function Ch(_,b){var I=oi;oi=I!==0&&4>I?I:4,_(!0);var N=Un.transition;Un.transition={};try{_(!1),b()}finally{oi=I,Un.transition=N}}function ku(){return fs().memoizedState}function Lu(_,b,I){var N=We(_);if(I={lane:N,action:I,hasEagerState:!1,eagerState:null,next:null},Zd(_))Nf(b,I);else if(I=ir(_,b,I,N),I!==null){var W=It();ze(I,_,N,W),jf(I,b,N)}}function em(_,b,I){var N=We(_),W={lane:N,action:I,hasEagerState:!1,eagerState:null,next:null};if(Zd(_))Nf(b,W);else{var ne=_.alternate;if(_.lanes===0&&(ne===null||ne.lanes===0)&&(ne=b.lastRenderedReducer,ne!==null))try{var Se=b.lastRenderedState,Je=ne(Se,I);if(W.hasEagerState=!0,W.eagerState=Je,ys(Je,Se)){var st=b.interleaved;st===null?(W.next=W,Iu(b)):(W.next=st.next,st.next=W),b.interleaved=W;return}}catch{}finally{}I=ir(_,b,W,N),I!==null&&(W=It(),ze(I,_,N,W),jf(I,b,N))}}function Zd(_){var b=_.alternate;return _===Zi||b!==null&&b===Zi}function Nf(_,b){Ts=zf=!0;var I=_.pending;I===null?b.next=b:(b.next=I.next,I.next=b),_.pending=b}function jf(_,b,I){if((I&4194240)!==0){var N=b.lanes;N&=_.pendingLanes,I|=N,b.lanes=I,ns(_,I)}}var ga={readContext:Ga,useCallback:Ct,useContext:Ct,useEffect:Ct,useImperativeHandle:Ct,useInsertionEffect:Ct,useLayoutEffect:Ct,useMemo:Ct,useReducer:Ct,useRef:Ct,useState:Ct,useDebugValue:Ct,useDeferredValue:Ct,useTransition:Ct,useMutableSource:Ct,useSyncExternalStore:Ct,useId:Ct,unstable_isNewReconciler:!1},Lc={readContext:Ga,useCallback:function(_,b){return Ge().memoizedState=[_,b===void 0?null:b],_},useContext:Ga,useEffect:Du,useImperativeHandle:function(_,b,I){return I=I!=null?I.concat([_]):null,Ru(4194308,4,eg.bind(null,b,_),I)},useLayoutEffect:function(_,b){return Ru(4194308,4,_,b)},useInsertionEffect:function(_,b){return Ru(4,2,_,b)},useMemo:function(_,b){var I=Ge();return b=b===void 0?null:b,_=_(),I.memoizedState=[_,b],_},useReducer:function(_,b,I){var N=Ge();return b=I!==void 0?I(b):b,N.memoizedState=N.baseState=b,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:b},N.queue=_,_=_.dispatch=Lu.bind(null,Zi,_),[N.memoizedState,_]},useRef:function(_){var b=Ge();return _={current:_},b.memoizedState=_},useState:Gd,useDebugValue:ni,useDeferredValue:function(_){return Ge().memoizedState=_},useTransition:function(){var _=Gd(!1),b=_[0];return _=Ch.bind(null,_[1]),Ge().memoizedState=_,[b,_]},useMutableSource:function(){},useSyncExternalStore:function(_,b,I){var N=Zi,W=Ge();if(Ci){if(I===void 0)throw Error(s(407));I=I()}else{if(I=b(),A===null)throw Error(s(349));(Bs&30)!==0||Ou(N,b,I)}W.memoizedState=I;var ne={value:I,getSnapshot:b};return W.queue=ne,Du(Jm.bind(null,N,ne,_),[_]),N.flags|=2048,Ph(9,Us.bind(null,N,ne,I,b),void 0,null),I},useId:function(){var _=Ge(),b=A.identifierPrefix;if(Ci){var I=zs,N=Ls;I=(N&~(1<<32-Ea(N)-1)).toString(32)+I,b=":"+b+"R"+I,I=Ns++,0<I&&(b+="H"+I.toString(32)),b+=":"}else I=js++,b=":"+b+"r"+I.toString(32)+":";return _.memoizedState=b},unstable_isNewReconciler:!1},Mh={readContext:Ga,useCallback:mn,useContext:Ga,useEffect:Hd,useImperativeHandle:Ih,useInsertionEffect:Qm,useLayoutEffect:Zo,useMemo:Wd,useReducer:Mu,useRef:Qp,useState:function(){return Mu(Hl)},useDebugValue:ni,useDeferredValue:function(_){var b=fs();return ma(b,so.memoizedState,_)},useTransition:function(){var _=Mu(Hl)[0],b=fs().memoizedState;return[_,b]},useMutableSource:$d,useSyncExternalStore:Ff,useId:ku,unstable_isNewReconciler:!1},Xd={readContext:Ga,useCallback:mn,useContext:Ga,useEffect:Hd,useImperativeHandle:Ih,useInsertionEffect:Qm,useLayoutEffect:Zo,useMemo:Wd,useReducer:Dc,useRef:Qp,useState:function(){return Dc(Hl)},useDebugValue:ni,useDeferredValue:function(_){var b=fs();return so===null?b.memoizedState=_:ma(b,so.memoizedState,_)},useTransition:function(){var _=Dc(Hl)[0],b=fs().memoizedState;return[_,b]},useMutableSource:$d,useSyncExternalStore:Ff,useId:ku,unstable_isNewReconciler:!1};function Wa(_,b){if(_&&_.defaultProps){b=Vt({},b),_=_.defaultProps;for(var I in _)b[I]===void 0&&(b[I]=_[I]);return b}return b}function zc(_,b,I,N){b=_.memoizedState,I=I(N,b),I=I==null?b:Vt({},b,I),_.memoizedState=I,_.lanes===0&&(_.updateQueue.baseState=I)}var Vs={isMounted:function(_){return(_=_._reactInternals)?Tt(_)===_:!1},enqueueSetState:function(_,b,I){_=_._reactInternals;var N=It(),W=We(_),ne=wr(N,W);ne.payload=b,I!=null&&(ne.callback=I),b=xl(_,ne,W),b!==null&&(ze(b,_,W,N),jd(b,_,W))},enqueueReplaceState:function(_,b,I){_=_._reactInternals;var N=It(),W=We(_),ne=wr(N,W);ne.tag=1,ne.payload=b,I!=null&&(ne.callback=I),b=xl(_,ne,W),b!==null&&(ze(b,_,W,N),jd(b,_,W))},enqueueForceUpdate:function(_,b){_=_._reactInternals;var I=It(),N=We(_),W=wr(I,N);W.tag=2,b!=null&&(W.callback=b),b=xl(_,W,N),b!==null&&(ze(b,_,N,I),jd(b,_,N))}};function Kd(_,b,I,N,W,ne,Se){return _=_.stateNode,typeof _.shouldComponentUpdate=="function"?_.shouldComponentUpdate(N,ne,Se):b.prototype&&b.prototype.isPureReactComponent?!uh(I,N)||!uh(W,ne):!0}function $s(_,b,I){var N=!1,W=ss,ne=b.contextType;return typeof ne=="object"&&ne!==null?ne=Ga(ne):(W=oa(b)?So:Mo.current,N=b.contextTypes,ne=(N=N!=null)?Ic(_,W):ss),b=new b(I,ne),_.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=Vs,_.stateNode=b,b._reactInternals=_,N&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=W,_.__reactInternalMemoizedMaskedChildContext=ne),b}function Yd(_,b,I,N){_=b.state,typeof b.componentWillReceiveProps=="function"&&b.componentWillReceiveProps(I,N),typeof b.UNSAFE_componentWillReceiveProps=="function"&&b.UNSAFE_componentWillReceiveProps(I,N),b.state!==_&&Vs.enqueueReplaceState(b,b.state,null)}function Oh(_,b,I,N){var W=_.stateNode;W.props=I,W.state=_.memoizedState,W.refs={},Fs(_);var ne=b.contextType;typeof ne=="object"&&ne!==null?W.context=Ga(ne):(ne=oa(b)?So:Mo.current,W.context=Ic(_,ne)),W.state=_.memoizedState,ne=b.getDerivedStateFromProps,typeof ne=="function"&&(zc(_,b,ne,I),W.state=_.memoizedState),typeof b.getDerivedStateFromProps=="function"||typeof W.getSnapshotBeforeUpdate=="function"||typeof W.UNSAFE_componentWillMount!="function"&&typeof W.componentWillMount!="function"||(b=W.state,typeof W.componentWillMount=="function"&&W.componentWillMount(),typeof W.UNSAFE_componentWillMount=="function"&&W.UNSAFE_componentWillMount(),b!==W.state&&Vs.enqueueReplaceState(W,W.state,null),Cu(_,I,W,N),W.state=_.memoizedState),typeof W.componentDidMount=="function"&&(_.flags|=4194308)}function qs(_,b){try{var I="",N=b;do I+=Gr(N),N=N.return;while(N);var W=I}catch(ne){W=`
Error generating stack: `+ne.message+`
`+ne.stack}return{value:_,source:b,stack:W,digest:null}}function Fc(_,b,I){return{value:_,source:null,stack:I??null,digest:b??null}}function ai(_,b){try{console.error(b.value)}catch(I){setTimeout(function(){throw I})}}var Rh=typeof WeakMap=="function"?WeakMap:Map;function Jd(_,b,I){I=wr(-1,I),I.tag=3,I.payload={element:null};var N=b.value;return I.callback=function(){Ce||(Ce=!0,Re=N),ai(_,b)},I}function Qd(_,b,I){I=wr(-1,I),I.tag=3;var N=_.type.getDerivedStateFromError;if(typeof N=="function"){var W=b.value;I.payload=function(){return N(W)},I.callback=function(){ai(_,b)}}var ne=_.stateNode;return ne!==null&&typeof ne.componentDidCatch=="function"&&(I.callback=function(){ai(_,b),typeof N!="function"&&(Ae===null?Ae=new Set([this]):Ae.add(this));var Se=b.stack;this.componentDidCatch(b.value,{componentStack:Se!==null?Se:""})}),I}function Bc(_,b,I){var N=_.pingCache;if(N===null){N=_.pingCache=new Rh;var W=new Set;N.set(b,W)}else W=N.get(b),W===void 0&&(W=new Set,N.set(b,W));W.has(I)||(W.add(I),_=Gn.bind(null,_,b,I),b.then(_,_))}function ep(_){do{var b;if((b=_.tag===13)&&(b=_.memoizedState,b=b!==null?b.dehydrated!==null:!0),b)return _;_=_.return}while(_!==null);return null}function Dh(_,b,I,N,W){return(_.mode&1)===0?(_===b?_.flags|=65536:(_.flags|=128,I.flags|=131072,I.flags&=-52805,I.tag===1&&(I.alternate===null?I.tag=17:(b=wr(-1,1),b.tag=2,xl(I,b,1))),I.lanes|=1),_):(_.flags|=65536,_.lanes=W,_)}var tm=_e.ReactCurrentOwner,Eo=!1;function aa(_,b,I,N){b.child=_===null?Nd(b,null,I,N):Oc(b,_.child,I,N)}function tp(_,b,I,N,W){I=I.render;var ne=b.ref;return Pu(b,W),N=Rc(_,b,I,N,ne,W),I=Ai(),_!==null&&!Eo?(b.updateQueue=_.updateQueue,b.flags&=-2053,_.lanes&=~W,Wl(_,b,W)):(Ci&&I&&Ef(b),b.flags|=1,aa(_,b,N,W),b.child)}function Uf(_,b,I,N,W){if(_===null){var ne=I.type;return typeof ne=="function"&&!ji(ne)&&ne.defaultProps===void 0&&I.compare===null&&I.defaultProps===void 0?(b.tag=15,b.type=ne,zu(_,b,ne,N,W)):(_=Vo(I.type,null,N,b,b.mode,W),_.ref=b.ref,_.return=b,b.child=_)}if(ne=_.child,(_.lanes&W)===0){var Se=ne.memoizedProps;if(I=I.compare,I=I!==null?I:uh,I(Se,N)&&_.ref===b.ref)return Wl(_,b,W)}return b.flags|=1,_=Ko(ne,N),_.ref=b.ref,_.return=b,b.child=_}function zu(_,b,I,N,W){if(_!==null){var ne=_.memoizedProps;if(uh(ne,N)&&_.ref===b.ref)if(Eo=!1,b.pendingProps=N=ne,(_.lanes&W)!==0)(_.flags&131072)!==0&&(Eo=!0);else return b.lanes=_.lanes,Wl(_,b,W)}return $f(_,b,I,N,W)}function rp(_,b,I){var N=b.pendingProps,W=N.children,ne=_!==null?_.memoizedState:null;if(N.mode==="hidden")if((b.mode&1)===0)b.memoizedState={baseLanes:0,cachePool:null,transitions:null},$i(V,z),z|=I;else{if((I&1073741824)===0)return _=ne!==null?ne.baseLanes|I:I,b.lanes=b.childLanes=1073741824,b.memoizedState={baseLanes:_,cachePool:null,transitions:null},b.updateQueue=null,$i(V,z),z|=_,null;b.memoizedState={baseLanes:0,cachePool:null,transitions:null},N=ne!==null?ne.baseLanes:I,$i(V,z),z|=N}else ne!==null?(N=ne.baseLanes|I,b.memoizedState=null):N=I,$i(V,z),z|=N;return aa(_,b,W,I),b.child}function Vf(_,b){var I=b.ref;(_===null&&I!==null||_!==null&&_.ref!==I)&&(b.flags|=512,b.flags|=2097152)}function $f(_,b,I,N,W){var ne=oa(I)?So:Mo.current;return ne=Ic(b,ne),Pu(b,W),I=Rc(_,b,I,N,ne,W),N=Ai(),_!==null&&!Eo?(b.updateQueue=_.updateQueue,b.flags&=-2053,_.lanes&=~W,Wl(_,b,W)):(Ci&&N&&Ef(b),b.flags|=1,aa(_,b,I,W),b.child)}function rm(_,b,I,N,W){if(oa(I)){var ne=!0;Sh(b)}else ne=!1;if(Pu(b,W),b.stateNode===null)ap(_,b),$s(b,I,N),Oh(b,I,N,W),N=!0;else if(_===null){var Se=b.stateNode,Je=b.memoizedProps;Se.props=Je;var st=Se.context,Zt=I.contextType;typeof Zt=="object"&&Zt!==null?Zt=Ga(Zt):(Zt=oa(I)?So:Mo.current,Zt=Ic(b,Zt));var mr=I.getDerivedStateFromProps,br=typeof mr=="function"||typeof Se.getSnapshotBeforeUpdate=="function";br||typeof Se.UNSAFE_componentWillReceiveProps!="function"&&typeof Se.componentWillReceiveProps!="function"||(Je!==N||st!==Zt)&&Yd(b,Se,N,Zt),Ss=!1;var _r=b.memoizedState;Se.state=_r,Cu(b,N,Se,W),st=b.memoizedState,Je!==N||_r!==st||ia.current||Ss?(typeof mr=="function"&&(zc(b,I,mr,N),st=b.memoizedState),(Je=Ss||Kd(b,I,Je,N,_r,st,Zt))?(br||typeof Se.UNSAFE_componentWillMount!="function"&&typeof Se.componentWillMount!="function"||(typeof Se.componentWillMount=="function"&&Se.componentWillMount(),typeof Se.UNSAFE_componentWillMount=="function"&&Se.UNSAFE_componentWillMount()),typeof Se.componentDidMount=="function"&&(b.flags|=4194308)):(typeof Se.componentDidMount=="function"&&(b.flags|=4194308),b.memoizedProps=N,b.memoizedState=st),Se.props=N,Se.state=st,Se.context=Zt,N=Je):(typeof Se.componentDidMount=="function"&&(b.flags|=4194308),N=!1)}else{Se=b.stateNode,pa(_,b),Je=b.memoizedProps,Zt=b.type===b.elementType?Je:Wa(b.type,Je),Se.props=Zt,br=b.pendingProps,_r=Se.context,st=I.contextType,typeof st=="object"&&st!==null?st=Ga(st):(st=oa(I)?So:Mo.current,st=Ic(b,st));var $r=I.getDerivedStateFromProps;(mr=typeof $r=="function"||typeof Se.getSnapshotBeforeUpdate=="function")||typeof Se.UNSAFE_componentWillReceiveProps!="function"&&typeof Se.componentWillReceiveProps!="function"||(Je!==br||_r!==st)&&Yd(b,Se,N,st),Ss=!1,_r=b.memoizedState,Se.state=_r,Cu(b,N,Se,W);var Kr=b.memoizedState;Je!==br||_r!==Kr||ia.current||Ss?(typeof $r=="function"&&(zc(b,I,$r,N),Kr=b.memoizedState),(Zt=Ss||Kd(b,I,Zt,N,_r,Kr,st)||!1)?(mr||typeof Se.UNSAFE_componentWillUpdate!="function"&&typeof Se.componentWillUpdate!="function"||(typeof Se.componentWillUpdate=="function"&&Se.componentWillUpdate(N,Kr,st),typeof Se.UNSAFE_componentWillUpdate=="function"&&Se.UNSAFE_componentWillUpdate(N,Kr,st)),typeof Se.componentDidUpdate=="function"&&(b.flags|=4),typeof Se.getSnapshotBeforeUpdate=="function"&&(b.flags|=1024)):(typeof Se.componentDidUpdate!="function"||Je===_.memoizedProps&&_r===_.memoizedState||(b.flags|=4),typeof Se.getSnapshotBeforeUpdate!="function"||Je===_.memoizedProps&&_r===_.memoizedState||(b.flags|=1024),b.memoizedProps=N,b.memoizedState=Kr),Se.props=N,Se.state=Kr,Se.context=st,N=Zt):(typeof Se.componentDidUpdate!="function"||Je===_.memoizedProps&&_r===_.memoizedState||(b.flags|=4),typeof Se.getSnapshotBeforeUpdate!="function"||Je===_.memoizedProps&&_r===_.memoizedState||(b.flags|=1024),N=!1)}return kh(_,b,I,N,ne,W)}function kh(_,b,I,N,W,ne){Vf(_,b);var Se=(b.flags&128)!==0;if(!N&&!Se)return W&&Sf(b,I,!1),Wl(_,b,ne);N=b.stateNode,tm.current=b;var Je=Se&&typeof I.getDerivedStateFromError!="function"?null:N.render();return b.flags|=1,_!==null&&Se?(b.child=Oc(b,_.child,null,ne),b.child=Oc(b,null,Je,ne)):aa(_,b,Je,ne),b.memoizedState=N.state,W&&Sf(b,I,!0),b.child}function Lh(_){var b=_.stateNode;b.pendingContext?wf(_,b.pendingContext,b.pendingContext!==b.context):b.context&&wf(_,b.context,!1),kf(_,b.containerInfo)}function np(_,b,I,N,W){return wu(),Pf(W),b.flags|=256,aa(_,b,I,N),b.child}var ip={dehydrated:null,treeContext:null,retryLane:0};function qf(_){return{baseLanes:_,cachePool:null,transitions:null}}function nm(_,b,I){var N=b.pendingProps,W=Qi.current,ne=!1,Se=(b.flags&128)!==0,Je;if((Je=Se)||(Je=_!==null&&_.memoizedState===null?!1:(W&2)!==0),Je?(ne=!0,b.flags&=-129):(_===null||_.memoizedState!==null)&&(W|=1),$i(Qi,W&1),_===null)return Bd(b),_=b.memoizedState,_!==null&&(_=_.dehydrated,_!==null)?((b.mode&1)===0?b.lanes=1:_.data==="$!"?b.lanes=8:b.lanes=1073741824,null):(Se=N.children,_=N.fallback,ne?(N=b.mode,ne=b.child,Se={mode:"hidden",children:Se},(N&1)===0&&ne!==null?(ne.childLanes=0,ne.pendingProps=Se):ne=Ao(Se,N,0,null),_=ko(_,N,I,null),ne.return=b,_.return=b,ne.sibling=_,b.child=ne,b.child.memoizedState=qf(I),b.memoizedState=ip,_):zh(b,Se));if(W=_.memoizedState,W!==null&&(Je=W.dehydrated,Je!==null))return tg(_,b,Se,N,Je,W,I);if(ne){ne=N.fallback,Se=b.mode,W=_.child,Je=W.sibling;var st={mode:"hidden",children:N.children};return(Se&1)===0&&b.child!==W?(N=b.child,N.childLanes=0,N.pendingProps=st,b.deletions=null):(N=Ko(W,st),N.subtreeFlags=W.subtreeFlags&14680064),Je!==null?ne=Ko(Je,ne):(ne=ko(ne,Se,I,null),ne.flags|=2),ne.return=b,N.return=b,N.sibling=ne,b.child=N,N=ne,ne=b.child,Se=_.child.memoizedState,Se=Se===null?qf(I):{baseLanes:Se.baseLanes|I,cachePool:null,transitions:Se.transitions},ne.memoizedState=Se,ne.childLanes=_.childLanes&~I,b.memoizedState=ip,N}return ne=_.child,_=ne.sibling,N=Ko(ne,{mode:"visible",children:N.children}),(b.mode&1)===0&&(N.lanes=I),N.return=b,N.sibling=null,_!==null&&(I=b.deletions,I===null?(b.deletions=[_],b.flags|=16):I.push(_)),b.child=N,b.memoizedState=null,N}function zh(_,b){return b=Ao({mode:"visible",children:b},_.mode,0,null),b.return=_,_.child=b}function Gf(_,b,I,N){return N!==null&&Pf(N),Oc(b,_.child,null,I),_=zh(b,b.pendingProps.children),_.flags|=2,b.memoizedState=null,_}function tg(_,b,I,N,W,ne,Se){if(I)return b.flags&256?(b.flags&=-257,N=Fc(Error(s(422))),Gf(_,b,Se,N)):b.memoizedState!==null?(b.child=_.child,b.flags|=128,null):(ne=N.fallback,W=b.mode,N=Ao({mode:"visible",children:N.children},W,0,null),ne=ko(ne,W,Se,null),ne.flags|=2,N.return=b,ne.return=b,N.sibling=ne,b.child=N,(b.mode&1)!==0&&Oc(b,_.child,null,Se),b.child.memoizedState=qf(Se),b.memoizedState=ip,ne);if((b.mode&1)===0)return Gf(_,b,Se,null);if(W.data==="$!"){if(N=W.nextSibling&&W.nextSibling.dataset,N)var Je=N.dgst;return N=Je,ne=Error(s(419)),N=Fc(ne,N,void 0),Gf(_,b,Se,N)}if(Je=(Se&_.childLanes)!==0,Eo||Je){if(N=A,N!==null){switch(Se&-Se){case 4:W=2;break;case 16:W=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:W=32;break;case 536870912:W=268435456;break;default:W=0}W=(W&(N.suspendedLanes|Se))!==0?0:W,W!==0&&W!==ne.retryLane&&(ne.retryLane=W,ws(_,W),ze(N,_,W,-1))}return Xr(),N=Fc(Error(s(421))),Gf(_,b,Se,N)}return W.data==="$?"?(b.flags|=128,b.child=_.child,b=Ti.bind(null,_),W._reactRetry=b,null):(_=ne.treeContext,da=pl(W.nextSibling),qa=b,Ci=!0,ls=null,_!==null&&(xs[bs++]=Ls,xs[bs++]=zs,xs[bs++]=yl,Ls=_.id,zs=_.overflow,yl=b),b=zh(b,N.children),b.flags|=4096,b)}function im(_,b,I){_.lanes|=b;var N=_.alternate;N!==null&&(N.lanes|=b),Mf(_.return,b,I)}function op(_,b,I,N,W){var ne=_.memoizedState;ne===null?_.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:N,tail:I,tailMode:W}:(ne.isBackwards=b,ne.rendering=null,ne.renderingStartTime=0,ne.last=N,ne.tail=I,ne.tailMode=W)}function om(_,b,I){var N=b.pendingProps,W=N.revealOrder,ne=N.tail;if(aa(_,b,N.children,I),N=Qi.current,(N&2)!==0)N=N&1|2,b.flags|=128;else{if(_!==null&&(_.flags&128)!==0)e:for(_=b.child;_!==null;){if(_.tag===13)_.memoizedState!==null&&im(_,I,b);else if(_.tag===19)im(_,I,b);else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===b)break e;for(;_.sibling===null;){if(_.return===null||_.return===b)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}N&=1}if($i(Qi,N),(b.mode&1)===0)b.memoizedState=null;else switch(W){case"forwards":for(I=b.child,W=null;I!==null;)_=I.alternate,_!==null&&Ah(_)===null&&(W=I),I=I.sibling;I=W,I===null?(W=b.child,b.child=null):(W=I.sibling,I.sibling=null),op(b,!1,W,I,ne);break;case"backwards":for(I=null,W=b.child,b.child=null;W!==null;){if(_=W.alternate,_!==null&&Ah(_)===null){b.child=W;break}_=W.sibling,W.sibling=I,I=W,W=_}op(b,!0,I,null,ne);break;case"together":op(b,!1,null,null,void 0);break;default:b.memoizedState=null}return b.child}function ap(_,b){(b.mode&1)===0&&_!==null&&(_.alternate=null,b.alternate=null,b.flags|=2)}function Wl(_,b,I){if(_!==null&&(b.dependencies=_.dependencies),Q|=b.lanes,(I&b.childLanes)===0)return null;if(_!==null&&b.child!==_.child)throw Error(s(153));if(b.child!==null){for(_=b.child,I=Ko(_,_.pendingProps),b.child=I,I.return=b;_.sibling!==null;)_=_.sibling,I=I.sibling=Ko(_,_.pendingProps),I.return=b;I.sibling=null}return b.child}function Si(_,b,I){switch(b.tag){case 3:Lh(b),wu();break;case 5:Gl(b);break;case 1:oa(b.type)&&Sh(b);break;case 4:kf(b,b.stateNode.containerInfo);break;case 10:var N=b.type._context,W=b.memoizedProps.value;$i(vl,N._currentValue),N._currentValue=W;break;case 13:if(N=b.memoizedState,N!==null)return N.dehydrated!==null?($i(Qi,Qi.current&1),b.flags|=128,null):(I&b.child.childLanes)!==0?nm(_,b,I):($i(Qi,Qi.current&1),_=Wl(_,b,I),_!==null?_.sibling:null);$i(Qi,Qi.current&1);break;case 19:if(N=(I&b.childLanes)!==0,(_.flags&128)!==0){if(N)return om(_,b,I);b.flags|=128}if(W=b.memoizedState,W!==null&&(W.rendering=null,W.tail=null,W.lastEffect=null),$i(Qi,Qi.current),N)break;return null;case 22:case 23:return b.lanes=0,rp(_,b,I)}return Wl(_,b,I)}var am,sm,sp,rg;am=function(_,b){for(var I=b.child;I!==null;){if(I.tag===5||I.tag===6)_.appendChild(I.stateNode);else if(I.tag!==4&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===b)break;for(;I.sibling===null;){if(I.return===null||I.return===b)return;I=I.return}I.sibling.return=I.return,I=I.sibling}},sm=function(){},sp=function(_,b,I,N){var W=_.memoizedProps;if(W!==N){_=b.stateNode,Oo(us.current);var ne=null;switch(I){case"input":W=Rn(_,W),N=Rn(_,N),ne=[];break;case"select":W=Vt({},W,{value:void 0}),N=Vt({},N,{value:void 0}),ne=[];break;case"textarea":W=Bo(_,W),N=Bo(_,N),ne=[];break;default:typeof W.onClick!="function"&&typeof N.onClick=="function"&&(_.onclick=Fl)}ol(I,N);var Se;I=null;for(Zt in W)if(!N.hasOwnProperty(Zt)&&W.hasOwnProperty(Zt)&&W[Zt]!=null)if(Zt==="style"){var Je=W[Zt];for(Se in Je)Je.hasOwnProperty(Se)&&(I||(I={}),I[Se]="")}else Zt!=="dangerouslySetInnerHTML"&&Zt!=="children"&&Zt!=="suppressContentEditableWarning"&&Zt!=="suppressHydrationWarning"&&Zt!=="autoFocus"&&(m.hasOwnProperty(Zt)?ne||(ne=[]):(ne=ne||[]).push(Zt,null));for(Zt in N){var st=N[Zt];if(Je=W?.[Zt],N.hasOwnProperty(Zt)&&st!==Je&&(st!=null||Je!=null))if(Zt==="style")if(Je){for(Se in Je)!Je.hasOwnProperty(Se)||st&&st.hasOwnProperty(Se)||(I||(I={}),I[Se]="");for(Se in st)st.hasOwnProperty(Se)&&Je[Se]!==st[Se]&&(I||(I={}),I[Se]=st[Se])}else I||(ne||(ne=[]),ne.push(Zt,I)),I=st;else Zt==="dangerouslySetInnerHTML"?(st=st?st.__html:void 0,Je=Je?Je.__html:void 0,st!=null&&Je!==st&&(ne=ne||[]).push(Zt,st)):Zt==="children"?typeof st!="string"&&typeof st!="number"||(ne=ne||[]).push(Zt,""+st):Zt!=="suppressContentEditableWarning"&&Zt!=="suppressHydrationWarning"&&(m.hasOwnProperty(Zt)?(st!=null&&Zt==="onScroll"&&cn("scroll",_),ne||Je===st||(ne=[])):(ne=ne||[]).push(Zt,st))}I&&(ne=ne||[]).push("style",I);var Zt=ne;(b.updateQueue=Zt)&&(b.flags|=4)}},rg=function(_,b,I,N){I!==N&&(b.flags|=4)};function Zl(_,b){if(!Ci)switch(_.tailMode){case"hidden":b=_.tail;for(var I=null;b!==null;)b.alternate!==null&&(I=b),b=b.sibling;I===null?_.tail=null:I.sibling=null;break;case"collapsed":I=_.tail;for(var N=null;I!==null;)I.alternate!==null&&(N=I),I=I.sibling;N===null?b||_.tail===null?_.tail=null:_.tail.sibling=null:N.sibling=null}}function Ro(_){var b=_.alternate!==null&&_.alternate.child===_.child,I=0,N=0;if(b)for(var W=_.child;W!==null;)I|=W.lanes|W.childLanes,N|=W.subtreeFlags&14680064,N|=W.flags&14680064,W.return=_,W=W.sibling;else for(W=_.child;W!==null;)I|=W.lanes|W.childLanes,N|=W.subtreeFlags,N|=W.flags,W.return=_,W=W.sibling;return _.subtreeFlags|=N,_.childLanes=I,b}function lm(_,b,I){var N=b.pendingProps;switch(Fd(b),b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ro(b),null;case 1:return oa(b.type)&&Cc(),Ro(b),null;case 3:return N=b.stateNode,To(),Ii(ia),Ii(Mo),Vd(),N.pendingContext&&(N.context=N.pendingContext,N.pendingContext=null),(_===null||_.child===null)&&(bu(b)?b.flags|=4:_===null||_.memoizedState.isDehydrated&&(b.flags&256)===0||(b.flags|=1024,ls!==null&&(Pt(ls),ls=null))),sm(_,b),Ro(b),null;case 5:Ud(b);var W=Oo(Df.current);if(I=b.type,_!==null&&b.stateNode!=null)sp(_,b,I,N,W),_.ref!==b.ref&&(b.flags|=512,b.flags|=2097152);else{if(!N){if(b.stateNode===null)throw Error(s(166));return Ro(b),null}if(_=Oo(us.current),bu(b)){N=b.stateNode,I=b.type;var ne=b.memoizedProps;switch(N[Ds]=b,N[xh]=ne,_=(b.mode&1)!==0,I){case"dialog":cn("cancel",N),cn("close",N);break;case"iframe":case"object":case"embed":cn("load",N);break;case"video":case"audio":for(W=0;W<mu.length;W++)cn(mu[W],N);break;case"source":cn("error",N);break;case"img":case"image":case"link":cn("error",N),cn("load",N);break;case"details":cn("toggle",N);break;case"input":In(N,ne),cn("invalid",N);break;case"select":N._wrapperState={wasMultiple:!!ne.multiple},cn("invalid",N);break;case"textarea":Ba(N,ne),cn("invalid",N)}ol(I,ne),W=null;for(var Se in ne)if(ne.hasOwnProperty(Se)){var Je=ne[Se];Se==="children"?typeof Je=="string"?N.textContent!==Je&&(ne.suppressHydrationWarning!==!0&&dl(N.textContent,Je,_),W=["children",Je]):typeof Je=="number"&&N.textContent!==""+Je&&(ne.suppressHydrationWarning!==!0&&dl(N.textContent,Je,_),W=["children",""+Je]):m.hasOwnProperty(Se)&&Je!=null&&Se==="onScroll"&&cn("scroll",N)}switch(I){case"input":un(N),Sa(N,ne,!0);break;case"textarea":un(N),tl(N);break;case"select":case"option":break;default:typeof ne.onClick=="function"&&(N.onclick=Fl)}N=W,b.updateQueue=N,N!==null&&(b.flags|=4)}else{Se=W.nodeType===9?W:W.ownerDocument,_==="http://www.w3.org/1999/xhtml"&&(_=ca(I)),_==="http://www.w3.org/1999/xhtml"?I==="script"?(_=Se.createElement("div"),_.innerHTML="<script><\/script>",_=_.removeChild(_.firstChild)):typeof N.is=="string"?_=Se.createElement(I,{is:N.is}):(_=Se.createElement(I),I==="select"&&(Se=_,N.multiple?Se.multiple=!0:N.size&&(Se.size=N.size))):_=Se.createElementNS(_,I),_[Ds]=b,_[xh]=N,am(_,b,!1,!1),b.stateNode=_;e:{switch(Se=ac(I,N),I){case"dialog":cn("cancel",_),cn("close",_),W=N;break;case"iframe":case"object":case"embed":cn("load",_),W=N;break;case"video":case"audio":for(W=0;W<mu.length;W++)cn(mu[W],_);W=N;break;case"source":cn("error",_),W=N;break;case"img":case"image":case"link":cn("error",_),cn("load",_),W=N;break;case"details":cn("toggle",_),W=N;break;case"input":In(_,N),W=Rn(_,N),cn("invalid",_);break;case"option":W=N;break;case"select":_._wrapperState={wasMultiple:!!N.multiple},W=Vt({},N,{value:void 0}),cn("invalid",_);break;case"textarea":Ba(_,N),W=Bo(_,N),cn("invalid",_);break;default:W=N}ol(I,W),Je=W;for(ne in Je)if(Je.hasOwnProperty(ne)){var st=Je[ne];ne==="style"?il(_,st):ne==="dangerouslySetInnerHTML"?(st=st?st.__html:void 0,st!=null&&rl(_,st)):ne==="children"?typeof st=="string"?(I!=="textarea"||st!=="")&&nl(_,st):typeof st=="number"&&nl(_,""+st):ne!=="suppressContentEditableWarning"&&ne!=="suppressHydrationWarning"&&ne!=="autoFocus"&&(m.hasOwnProperty(ne)?st!=null&&ne==="onScroll"&&cn("scroll",_):st!=null&&ue(_,ne,st,Se))}switch(I){case"input":un(_),Sa(_,N,!1);break;case"textarea":un(_),tl(_);break;case"option":N.value!=null&&_.setAttribute("value",""+Br(N.value));break;case"select":_.multiple=!!N.multiple,ne=N.value,ne!=null?Vi(_,!!N.multiple,ne,!1):N.defaultValue!=null&&Vi(_,!!N.multiple,N.defaultValue,!0);break;default:typeof W.onClick=="function"&&(_.onclick=Fl)}switch(I){case"button":case"input":case"select":case"textarea":N=!!N.autoFocus;break e;case"img":N=!0;break e;default:N=!1}}N&&(b.flags|=4)}b.ref!==null&&(b.flags|=512,b.flags|=2097152)}return Ro(b),null;case 6:if(_&&b.stateNode!=null)rg(_,b,_.memoizedProps,N);else{if(typeof N!="string"&&b.stateNode===null)throw Error(s(166));if(I=Oo(Df.current),Oo(us.current),bu(b)){if(N=b.stateNode,I=b.memoizedProps,N[Ds]=b,(ne=N.nodeValue!==I)&&(_=qa,_!==null))switch(_.tag){case 3:dl(N.nodeValue,I,(_.mode&1)!==0);break;case 5:_.memoizedProps.suppressHydrationWarning!==!0&&dl(N.nodeValue,I,(_.mode&1)!==0)}ne&&(b.flags|=4)}else N=(I.nodeType===9?I:I.ownerDocument).createTextNode(N),N[Ds]=b,b.stateNode=N}return Ro(b),null;case 13:if(Ii(Qi),N=b.memoizedState,_===null||_.memoizedState!==null&&_.memoizedState.dehydrated!==null){if(Ci&&da!==null&&(b.mode&1)!==0&&(b.flags&128)===0)Af(),wu(),b.flags|=98560,ne=!1;else if(ne=bu(b),N!==null&&N.dehydrated!==null){if(_===null){if(!ne)throw Error(s(318));if(ne=b.memoizedState,ne=ne!==null?ne.dehydrated:null,!ne)throw Error(s(317));ne[Ds]=b}else wu(),(b.flags&128)===0&&(b.memoizedState=null),b.flags|=4;Ro(b),ne=!1}else ls!==null&&(Pt(ls),ls=null),ne=!0;if(!ne)return b.flags&65536?b:null}return(b.flags&128)!==0?(b.lanes=I,b):(N=N!==null,N!==(_!==null&&_.memoizedState!==null)&&N&&(b.child.flags|=8192,(b.mode&1)!==0&&(_===null||(Qi.current&1)!==0?j===0&&(j=3):Xr())),b.updateQueue!==null&&(b.flags|=4),Ro(b),null);case 4:return To(),sm(_,b),_===null&&yf(b.stateNode.containerInfo),Ro(b),null;case 10:return Au(b.type._context),Ro(b),null;case 17:return oa(b.type)&&Cc(),Ro(b),null;case 19:if(Ii(Qi),ne=b.memoizedState,ne===null)return Ro(b),null;if(N=(b.flags&128)!==0,Se=ne.rendering,Se===null)if(N)Zl(ne,!1);else{if(j!==0||_!==null&&(_.flags&128)!==0)for(_=b.child;_!==null;){if(Se=Ah(_),Se!==null){for(b.flags|=128,Zl(ne,!1),N=Se.updateQueue,N!==null&&(b.updateQueue=N,b.flags|=4),b.subtreeFlags=0,N=I,I=b.child;I!==null;)ne=I,_=N,ne.flags&=14680066,Se=ne.alternate,Se===null?(ne.childLanes=0,ne.lanes=_,ne.child=null,ne.subtreeFlags=0,ne.memoizedProps=null,ne.memoizedState=null,ne.updateQueue=null,ne.dependencies=null,ne.stateNode=null):(ne.childLanes=Se.childLanes,ne.lanes=Se.lanes,ne.child=Se.child,ne.subtreeFlags=0,ne.deletions=null,ne.memoizedProps=Se.memoizedProps,ne.memoizedState=Se.memoizedState,ne.updateQueue=Se.updateQueue,ne.type=Se.type,_=Se.dependencies,ne.dependencies=_===null?null:{lanes:_.lanes,firstContext:_.firstContext}),I=I.sibling;return $i(Qi,Qi.current&1|2),b.child}_=_.sibling}ne.tail!==null&&$n()>ye&&(b.flags|=128,N=!0,Zl(ne,!1),b.lanes=4194304)}else{if(!N)if(_=Ah(Se),_!==null){if(b.flags|=128,N=!0,I=_.updateQueue,I!==null&&(b.updateQueue=I,b.flags|=4),Zl(ne,!0),ne.tail===null&&ne.tailMode==="hidden"&&!Se.alternate&&!Ci)return Ro(b),null}else 2*$n()-ne.renderingStartTime>ye&&I!==1073741824&&(b.flags|=128,N=!0,Zl(ne,!1),b.lanes=4194304);ne.isBackwards?(Se.sibling=b.child,b.child=Se):(I=ne.last,I!==null?I.sibling=Se:b.child=Se,ne.last=Se)}return ne.tail!==null?(b=ne.tail,ne.rendering=b,ne.tail=b.sibling,ne.renderingStartTime=$n(),b.sibling=null,I=Qi.current,$i(Qi,N?I&1|2:I&1),b):(Ro(b),null);case 22:case 23:return dr(),N=b.memoizedState!==null,_!==null&&_.memoizedState!==null!==N&&(b.flags|=8192),N&&(b.mode&1)!==0?(z&1073741824)!==0&&(Ro(b),b.subtreeFlags&6&&(b.flags|=8192)):Ro(b),null;case 24:return null;case 25:return null}throw Error(s(156,b.tag))}function lp(_,b){switch(Fd(b),b.tag){case 1:return oa(b.type)&&Cc(),_=b.flags,_&65536?(b.flags=_&-65537|128,b):null;case 3:return To(),Ii(ia),Ii(Mo),Vd(),_=b.flags,(_&65536)!==0&&(_&128)===0?(b.flags=_&-65537|128,b):null;case 5:return Ud(b),null;case 13:if(Ii(Qi),_=b.memoizedState,_!==null&&_.dehydrated!==null){if(b.alternate===null)throw Error(s(340));wu()}return _=b.flags,_&65536?(b.flags=_&-65537|128,b):null;case 19:return Ii(Qi),null;case 4:return To(),null;case 10:return Au(b.type._context),null;case 22:case 23:return dr(),null;case 24:return null;default:return null}}var Ma=!1,Uo=!1,qi=typeof WeakSet=="function"?WeakSet:Set,jr=null;function Gs(_,b){var I=_.ref;if(I!==null)if(typeof I=="function")try{I(null)}catch(N){Rr(_,b,N)}else I.current=null}function Fu(_,b,I){try{I()}catch(N){Rr(_,b,N)}}var cp=!1;function ng(_,b){if(gh=of,_=Vp(),hh(_)){if("selectionStart"in _)var I={start:_.selectionStart,end:_.selectionEnd};else e:{I=(I=_.ownerDocument)&&I.defaultView||window;var N=I.getSelection&&I.getSelection();if(N&&N.rangeCount!==0){I=N.anchorNode;var W=N.anchorOffset,ne=N.focusNode;N=N.focusOffset;try{I.nodeType,ne.nodeType}catch{I=null;break e}var Se=0,Je=-1,st=-1,Zt=0,mr=0,br=_,_r=null;t:for(;;){for(var $r;br!==I||W!==0&&br.nodeType!==3||(Je=Se+W),br!==ne||N!==0&&br.nodeType!==3||(st=Se+N),br.nodeType===3&&(Se+=br.nodeValue.length),($r=br.firstChild)!==null;)_r=br,br=$r;for(;;){if(br===_)break t;if(_r===I&&++Zt===W&&(Je=Se),_r===ne&&++mr===N&&(st=Se),($r=br.nextSibling)!==null)break;br=_r,_r=br.parentNode}br=$r}I=Je===-1||st===-1?null:{start:Je,end:st}}else I=null}I=I||{start:0,end:0}}else I=null;for(_h={focusedElem:_,selectionRange:I},of=!1,jr=b;jr!==null;)if(b=jr,_=b.child,(b.subtreeFlags&1028)!==0&&_!==null)_.return=b,jr=_;else for(;jr!==null;){b=jr;try{var Kr=b.alternate;if((b.flags&1024)!==0)switch(b.tag){case 0:case 11:case 15:break;case 1:if(Kr!==null){var Qr=Kr.memoizedProps,Lo=Kr.memoizedState,Mt=b.stateNode,pt=Mt.getSnapshotBeforeUpdate(b.elementType===b.type?Qr:Wa(b.type,Qr),Lo);Mt.__reactInternalSnapshotBeforeUpdate=pt}break;case 3:var jt=b.stateNode.containerInfo;jt.nodeType===1?jt.textContent="":jt.nodeType===9&&jt.documentElement&&jt.removeChild(jt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(s(163))}}catch(Pr){Rr(b,b.return,Pr)}if(_=b.sibling,_!==null){_.return=b.return,jr=_;break}jr=b.return}return Kr=cp,cp=!1,Kr}function Xl(_,b,I){var N=b.updateQueue;if(N=N!==null?N.lastEffect:null,N!==null){var W=N=N.next;do{if((W.tag&_)===_){var ne=W.destroy;W.destroy=void 0,ne!==void 0&&Fu(b,I,ne)}W=W.next}while(W!==N)}}function up(_,b){if(b=b.updateQueue,b=b!==null?b.lastEffect:null,b!==null){var I=b=b.next;do{if((I.tag&_)===_){var N=I.create;I.destroy=N()}I=I.next}while(I!==b)}}function hp(_){var b=_.ref;if(b!==null){var I=_.stateNode;switch(_.tag){case 5:_=I;break;default:_=I}typeof b=="function"?b(_):b.current=_}}function fp(_){var b=_.alternate;b!==null&&(_.alternate=null,fp(b)),_.child=null,_.deletions=null,_.sibling=null,_.tag===5&&(b=_.stateNode,b!==null&&(delete b[Ds],delete b[xh],delete b[Ac],delete b[Km],delete b[Xp])),_.stateNode=null,_.return=null,_.dependencies=null,_.memoizedProps=null,_.memoizedState=null,_.pendingProps=null,_.stateNode=null,_.updateQueue=null}function dp(_){return _.tag===5||_.tag===3||_.tag===4}function Fh(_){e:for(;;){for(;_.sibling===null;){if(_.return===null||dp(_.return))return null;_=_.return}for(_.sibling.return=_.return,_=_.sibling;_.tag!==5&&_.tag!==6&&_.tag!==18;){if(_.flags&2||_.child===null||_.tag===4)continue e;_.child.return=_,_=_.child}if(!(_.flags&2))return _.stateNode}}function Nc(_,b,I){var N=_.tag;if(N===5||N===6)_=_.stateNode,b?I.nodeType===8?I.parentNode.insertBefore(_,b):I.insertBefore(_,b):(I.nodeType===8?(b=I.parentNode,b.insertBefore(_,I)):(b=I,b.appendChild(_)),I=I._reactRootContainer,I!=null||b.onclick!==null||(b.onclick=Fl));else if(N!==4&&(_=_.child,_!==null))for(Nc(_,b,I),_=_.sibling;_!==null;)Nc(_,b,I),_=_.sibling}function Hs(_,b,I){var N=_.tag;if(N===5||N===6)_=_.stateNode,b?I.insertBefore(_,b):I.appendChild(_);else if(N!==4&&(_=_.child,_!==null))for(Hs(_,b,I),_=_.sibling;_!==null;)Hs(_,b,I),_=_.sibling}var Ni=null,lo=!1;function co(_,b,I){for(I=I.child;I!==null;)Za(_,b,I),I=I.sibling}function Za(_,b,I){if(no&&typeof no.onCommitFiberUnmount=="function")try{no.onCommitFiberUnmount(ao,I)}catch{}switch(I.tag){case 5:Uo||Gs(I,b);case 6:var N=Ni,W=lo;Ni=null,co(_,b,I),Ni=N,lo=W,Ni!==null&&(lo?(_=Ni,I=I.stateNode,_.nodeType===8?_.parentNode.removeChild(I):_.removeChild(I)):Ni.removeChild(I.stateNode));break;case 18:Ni!==null&&(lo?(_=Ni,I=I.stateNode,_.nodeType===8?vh(_.parentNode,I):_.nodeType===1&&vh(_,I),rh(_)):vh(Ni,I.stateNode));break;case 4:N=Ni,W=lo,Ni=I.stateNode.containerInfo,lo=!0,co(_,b,I),Ni=N,lo=W;break;case 0:case 11:case 14:case 15:if(!Uo&&(N=I.updateQueue,N!==null&&(N=N.lastEffect,N!==null))){W=N=N.next;do{var ne=W,Se=ne.destroy;ne=ne.tag,Se!==void 0&&((ne&2)!==0||(ne&4)!==0)&&Fu(I,b,Se),W=W.next}while(W!==N)}co(_,b,I);break;case 1:if(!Uo&&(Gs(I,b),N=I.stateNode,typeof N.componentWillUnmount=="function"))try{N.props=I.memoizedProps,N.state=I.memoizedState,N.componentWillUnmount()}catch(Je){Rr(I,b,Je)}co(_,b,I);break;case 21:co(_,b,I);break;case 22:I.mode&1?(Uo=(N=Uo)||I.memoizedState!==null,co(_,b,I),Uo=N):co(_,b,I);break;default:co(_,b,I)}}function ig(_){var b=_.updateQueue;if(b!==null){_.updateQueue=null;var I=_.stateNode;I===null&&(I=_.stateNode=new qi),b.forEach(function(N){var W=xn.bind(null,_,N);I.has(N)||(I.add(N),N.then(W,W))})}}function Ws(_,b){var I=b.deletions;if(I!==null)for(var N=0;N<I.length;N++){var W=I[N];try{var ne=_,Se=b,Je=Se;e:for(;Je!==null;){switch(Je.tag){case 5:Ni=Je.stateNode,lo=!1;break e;case 3:Ni=Je.stateNode.containerInfo,lo=!0;break e;case 4:Ni=Je.stateNode.containerInfo,lo=!0;break e}Je=Je.return}if(Ni===null)throw Error(s(160));Za(ne,Se,W),Ni=null,lo=!1;var st=W.alternate;st!==null&&(st.return=null),W.return=null}catch(Zt){Rr(W,b,Zt)}}if(b.subtreeFlags&12854)for(b=b.child;b!==null;)og(b,_),b=b.sibling}function og(_,b){var I=_.alternate,N=_.flags;switch(_.tag){case 0:case 11:case 14:case 15:if(Ws(b,_),bl(_),N&4){try{Xl(3,_,_.return),up(3,_)}catch(Qr){Rr(_,_.return,Qr)}try{Xl(5,_,_.return)}catch(Qr){Rr(_,_.return,Qr)}}break;case 1:Ws(b,_),bl(_),N&512&&I!==null&&Gs(I,I.return);break;case 5:if(Ws(b,_),bl(_),N&512&&I!==null&&Gs(I,I.return),_.flags&32){var W=_.stateNode;try{nl(W,"")}catch(Qr){Rr(_,_.return,Qr)}}if(N&4&&(W=_.stateNode,W!=null)){var ne=_.memoizedProps,Se=I!==null?I.memoizedProps:ne,Je=_.type,st=_.updateQueue;if(_.updateQueue=null,st!==null)try{Je==="input"&&ne.type==="radio"&&ne.name!=null&&hi(W,ne),ac(Je,Se);var Zt=ac(Je,ne);for(Se=0;Se<st.length;Se+=2){var mr=st[Se],br=st[Se+1];mr==="style"?il(W,br):mr==="dangerouslySetInnerHTML"?rl(W,br):mr==="children"?nl(W,br):ue(W,mr,br,Zt)}switch(Je){case"input":Yi(W,ne);break;case"textarea":Os(W,ne);break;case"select":var _r=W._wrapperState.wasMultiple;W._wrapperState.wasMultiple=!!ne.multiple;var $r=ne.value;$r!=null?Vi(W,!!ne.multiple,$r,!1):_r!==!!ne.multiple&&(ne.defaultValue!=null?Vi(W,!!ne.multiple,ne.defaultValue,!0):Vi(W,!!ne.multiple,ne.multiple?[]:"",!1))}W[xh]=ne}catch(Qr){Rr(_,_.return,Qr)}}break;case 6:if(Ws(b,_),bl(_),N&4){if(_.stateNode===null)throw Error(s(162));W=_.stateNode,ne=_.memoizedProps;try{W.nodeValue=ne}catch(Qr){Rr(_,_.return,Qr)}}break;case 3:if(Ws(b,_),bl(_),N&4&&I!==null&&I.memoizedState.isDehydrated)try{rh(b.containerInfo)}catch(Qr){Rr(_,_.return,Qr)}break;case 4:Ws(b,_),bl(_);break;case 13:Ws(b,_),bl(_),W=_.child,W.flags&8192&&(ne=W.memoizedState!==null,W.stateNode.isHidden=ne,!ne||W.alternate!==null&&W.alternate.memoizedState!==null||(me=$n())),N&4&&ig(_);break;case 22:if(mr=I!==null&&I.memoizedState!==null,_.mode&1?(Uo=(Zt=Uo)||mr,Ws(b,_),Uo=Zt):Ws(b,_),bl(_),N&8192){if(Zt=_.memoizedState!==null,(_.stateNode.isHidden=Zt)&&!mr&&(_.mode&1)!==0)for(jr=_,mr=_.child;mr!==null;){for(br=jr=mr;jr!==null;){switch(_r=jr,$r=_r.child,_r.tag){case 0:case 11:case 14:case 15:Xl(4,_r,_r.return);break;case 1:Gs(_r,_r.return);var Kr=_r.stateNode;if(typeof Kr.componentWillUnmount=="function"){N=_r,I=_r.return;try{b=N,Kr.props=b.memoizedProps,Kr.state=b.memoizedState,Kr.componentWillUnmount()}catch(Qr){Rr(N,I,Qr)}}break;case 5:Gs(_r,_r.return);break;case 22:if(_r.memoizedState!==null){f(br);continue}}$r!==null?($r.return=_r,jr=$r):f(br)}mr=mr.sibling}e:for(mr=null,br=_;;){if(br.tag===5){if(mr===null){mr=br;try{W=br.stateNode,Zt?(ne=W.style,typeof ne.setProperty=="function"?ne.setProperty("display","none","important"):ne.display="none"):(Je=br.stateNode,st=br.memoizedProps.style,Se=st!=null&&st.hasOwnProperty("display")?st.display:null,Je.style.display=Al("display",Se))}catch(Qr){Rr(_,_.return,Qr)}}}else if(br.tag===6){if(mr===null)try{br.stateNode.nodeValue=Zt?"":br.memoizedProps}catch(Qr){Rr(_,_.return,Qr)}}else if((br.tag!==22&&br.tag!==23||br.memoizedState===null||br===_)&&br.child!==null){br.child.return=br,br=br.child;continue}if(br===_)break e;for(;br.sibling===null;){if(br.return===null||br.return===_)break e;mr===br&&(mr=null),br=br.return}mr===br&&(mr=null),br.sibling.return=br.return,br=br.sibling}}break;case 19:Ws(b,_),bl(_),N&4&&ig(_);break;case 21:break;default:Ws(b,_),bl(_)}}function bl(_){var b=_.flags;if(b&2){try{e:{for(var I=_.return;I!==null;){if(dp(I)){var N=I;break e}I=I.return}throw Error(s(160))}switch(N.tag){case 5:var W=N.stateNode;N.flags&32&&(nl(W,""),N.flags&=-33);var ne=Fh(_);Hs(_,ne,W);break;case 3:case 4:var Se=N.stateNode.containerInfo,Je=Fh(_);Nc(_,Je,Se);break;default:throw Error(s(161))}}catch(st){Rr(_,_.return,st)}_.flags&=-3}b&4096&&(_.flags&=-4097)}function ag(_,b,I){jr=_,Xo(_)}function Xo(_,b,I){for(var N=(_.mode&1)!==0;jr!==null;){var W=jr,ne=W.child;if(W.tag===22&&N){var Se=W.memoizedState!==null||Ma;if(!Se){var Je=W.alternate,st=Je!==null&&Je.memoizedState!==null||Uo;Je=Ma;var Zt=Uo;if(Ma=Se,(Uo=st)&&!Zt)for(jr=W;jr!==null;)Se=jr,st=Se.child,Se.tag===22&&Se.memoizedState!==null?n(W):st!==null?(st.return=Se,jr=st):n(W);for(;ne!==null;)jr=ne,Xo(ne),ne=ne.sibling;jr=W,Ma=Je,Uo=Zt}cm(_)}else(W.subtreeFlags&8772)!==0&&ne!==null?(ne.return=W,jr=ne):cm(_)}}function cm(_){for(;jr!==null;){var b=jr;if((b.flags&8772)!==0){var I=b.alternate;try{if((b.flags&8772)!==0)switch(b.tag){case 0:case 11:case 15:Uo||up(5,b);break;case 1:var N=b.stateNode;if(b.flags&4&&!Uo)if(I===null)N.componentDidMount();else{var W=b.elementType===b.type?I.memoizedProps:Wa(b.type,I.memoizedProps);N.componentDidUpdate(W,I.memoizedState,N.__reactInternalSnapshotBeforeUpdate)}var ne=b.updateQueue;ne!==null&&Of(b,ne,N);break;case 3:var Se=b.updateQueue;if(Se!==null){if(I=null,b.child!==null)switch(b.child.tag){case 5:I=b.child.stateNode;break;case 1:I=b.child.stateNode}Of(b,Se,I)}break;case 5:var Je=b.stateNode;if(I===null&&b.flags&4){I=Je;var st=b.memoizedProps;switch(b.type){case"button":case"input":case"select":case"textarea":st.autoFocus&&I.focus();break;case"img":st.src&&(I.src=st.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(b.memoizedState===null){var Zt=b.alternate;if(Zt!==null){var mr=Zt.memoizedState;if(mr!==null){var br=mr.dehydrated;br!==null&&rh(br)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(s(163))}Uo||b.flags&512&&hp(b)}catch(_r){Rr(b,b.return,_r)}}if(b===_){jr=null;break}if(I=b.sibling,I!==null){I.return=b.return,jr=I;break}jr=b.return}}function f(_){for(;jr!==null;){var b=jr;if(b===_){jr=null;break}var I=b.sibling;if(I!==null){I.return=b.return,jr=I;break}jr=b.return}}function n(_){for(;jr!==null;){var b=jr;try{switch(b.tag){case 0:case 11:case 15:var I=b.return;try{up(4,b)}catch(st){Rr(b,I,st)}break;case 1:var N=b.stateNode;if(typeof N.componentDidMount=="function"){var W=b.return;try{N.componentDidMount()}catch(st){Rr(b,W,st)}}var ne=b.return;try{hp(b)}catch(st){Rr(b,ne,st)}break;case 5:var Se=b.return;try{hp(b)}catch(st){Rr(b,Se,st)}}}catch(st){Rr(b,b.return,st)}if(b===_){jr=null;break}var Je=b.sibling;if(Je!==null){Je.return=b.return,jr=Je;break}jr=b.return}}var l=Math.ceil,d=_e.ReactCurrentDispatcher,y=_e.ReactCurrentOwner,x=_e.ReactCurrentBatchConfig,S=0,A=null,C=null,k=0,z=0,V=_l(0),j=0,q=null,Q=0,Y=0,re=0,te=null,ce=null,me=0,ye=1/0,Ee=null,Ce=!1,Re=null,Ae=null,Pe=!1,Ie=null,Ye=0,Be=0,dt=null,rt=-1,xt=0;function It(){return(S&6)!==0?$n():rt!==-1?rt:rt=$n()}function We(_){return(_.mode&1)===0?1:(S&2)!==0&&k!==0?k&-k:Su.transition!==null?(xt===0&&(xt=ps()),xt):(_=oi,_!==0||(_=window.event,_=_===void 0?16:cl(_.type)),_)}function ze(_,b,I,N){if(50<Be)throw Be=0,dt=null,Error(s(185));ua(_,I,N),((S&2)===0||_!==A)&&(_===A&&((S&2)===0&&(Y|=I),j===4&&Bt(_,k)),ot(_,N),I===1&&S===0&&(b.mode&1)===0&&(ye=$n()+500,yu&&jl()))}function ot(_,b){var I=_.callbackNode;ef(_,b);var N=ru(_,_===A?k:0);if(N===0)I!==null&&Yn(I),_.callbackNode=null,_.callbackPriority=0;else if(b=N&-N,_.callbackPriority!==b){if(I!=null&&Yn(I),b===1)_.tag===0?Kp(cr.bind(null,_)):Ld(cr.bind(null,_)),yh(function(){(S&6)===0&&jl()}),I=null;else{switch(Qu(N)){case 1:I=qn;break;case 4:I=Dn;break;case 16:I=wi;break;case 536870912:I=_i;break;default:I=wi}I=Wn(I,tt.bind(null,_))}_.callbackPriority=b,_.callbackNode=I}}function tt(_,b){if(rt=-1,xt=0,(S&6)!==0)throw Error(s(327));var I=_.callbackNode;if(_n()&&_.callbackNode!==I)return null;var N=ru(_,_===A?k:0);if(N===0)return null;if((N&30)!==0||(N&_.expiredLanes)!==0||b)b=vn(_,N);else{b=N;var W=S;S|=2;var ne=Vr();(A!==_||k!==b)&&(Ee=null,ye=$n()+500,ur(_,b));do try{Sn();break}catch(Je){Lr(_,Je)}while(!0);ql(),d.current=ne,S=W,C!==null?b=0:(A=null,k=0,b=j)}if(b!==0){if(b===2&&(W=Ju(_),W!==0&&(N=W,b=At(_,W))),b===1)throw I=q,ur(_,0),Bt(_,N),ot(_,$n()),I;if(b===6)Bt(_,N);else{if(W=_.current.alternate,(N&30)===0&&!Dt(W)&&(b=vn(_,N),b===2&&(ne=Ju(_),ne!==0&&(N=ne,b=At(_,ne))),b===1))throw I=q,ur(_,0),Bt(_,N),ot(_,$n()),I;switch(_.finishedWork=W,_.finishedLanes=N,b){case 0:case 1:throw Error(s(345));case 2:Hr(_,ce,Ee);break;case 3:if(Bt(_,N),(N&130023424)===N&&(b=me+500-$n(),10<b)){if(ru(_,0)!==0)break;if(W=_.suspendedLanes,(W&N)!==N){It(),_.pingedLanes|=_.suspendedLanes&W;break}_.timeoutHandle=Rd(Hr.bind(null,_,ce,Ee),b);break}Hr(_,ce,Ee);break;case 4:if(Bt(_,N),(N&4194240)===N)break;for(b=_.eventTimes,W=-1;0<N;){var Se=31-Ea(N);ne=1<<Se,Se=b[Se],Se>W&&(W=Se),N&=~ne}if(N=W,N=$n()-N,N=(120>N?120:480>N?480:1080>N?1080:1920>N?1920:3e3>N?3e3:4320>N?4320:1960*l(N/1960))-N,10<N){_.timeoutHandle=Rd(Hr.bind(null,_,ce,Ee),N);break}Hr(_,ce,Ee);break;case 5:Hr(_,ce,Ee);break;default:throw Error(s(329))}}}return ot(_,$n()),_.callbackNode===I?tt.bind(null,_):null}function At(_,b){var I=te;return _.current.memoizedState.isDehydrated&&(ur(_,b).flags|=256),_=vn(_,b),_!==2&&(b=ce,ce=I,b!==null&&Pt(b)),_}function Pt(_){ce===null?ce=_:ce.push.apply(ce,_)}function Dt(_){for(var b=_;;){if(b.flags&16384){var I=b.updateQueue;if(I!==null&&(I=I.stores,I!==null))for(var N=0;N<I.length;N++){var W=I[N],ne=W.getSnapshot;W=W.value;try{if(!ys(ne(),W))return!1}catch{return!1}}}if(I=b.child,b.subtreeFlags&16384&&I!==null)I.return=b,b=I;else{if(b===_)break;for(;b.sibling===null;){if(b.return===null||b.return===_)return!0;b=b.return}b.sibling.return=b.return,b=b.sibling}}return!0}function Bt(_,b){for(b&=~re,b&=~Y,_.suspendedLanes|=b,_.pingedLanes&=~b,_=_.expirationTimes;0<b;){var I=31-Ea(b),N=1<<I;_[I]=-1,b&=~N}}function cr(_){if((S&6)!==0)throw Error(s(327));_n();var b=ru(_,0);if((b&1)===0)return ot(_,$n()),null;var I=vn(_,b);if(_.tag!==0&&I===2){var N=Ju(_);N!==0&&(b=N,I=At(_,N))}if(I===1)throw I=q,ur(_,0),Bt(_,b),ot(_,$n()),I;if(I===6)throw Error(s(345));return _.finishedWork=_.current.alternate,_.finishedLanes=b,Hr(_,ce,Ee),ot(_,$n()),null}function pr(_,b){var I=S;S|=1;try{return _(b)}finally{S=I,S===0&&(ye=$n()+500,yu&&jl())}}function Jt(_){Ie!==null&&Ie.tag===0&&(S&6)===0&&_n();var b=S;S|=1;var I=x.transition,N=oi;try{if(x.transition=null,oi=1,_)return _()}finally{oi=N,x.transition=I,S=b,(S&6)===0&&jl()}}function dr(){z=V.current,Ii(V)}function ur(_,b){_.finishedWork=null,_.finishedLanes=0;var I=_.timeoutHandle;if(I!==-1&&(_.timeoutHandle=-1,Wp(I)),C!==null)for(I=C.return;I!==null;){var N=I;switch(Fd(N),N.tag){case 1:N=N.type.childContextTypes,N!=null&&Cc();break;case 3:To(),Ii(ia),Ii(Mo),Vd();break;case 5:Ud(N);break;case 4:To();break;case 13:Ii(Qi);break;case 19:Ii(Qi);break;case 10:Au(N.type._context);break;case 22:case 23:dr()}I=I.return}if(A=_,C=_=Ko(_.current,null),k=z=b,j=0,q=null,re=Y=Q=0,ce=te=null,Ha!==null){for(b=0;b<Ha.length;b++)if(I=Ha[b],N=I.interleaved,N!==null){I.interleaved=null;var W=N.next,ne=I.pending;if(ne!==null){var Se=ne.next;ne.next=W,N.next=Se}I.pending=N}Ha=null}return _}function Lr(_,b){do{var I=C;try{if(ql(),hs.current=ga,zf){for(var N=Zi.memoizedState;N!==null;){var W=N.queue;W!==null&&(W.pending=null),N=N.next}zf=!1}if(Bs=0,jo=so=Zi=null,Ts=!1,Ns=0,y.current=null,I===null||I.return===null){j=1,q=b,C=null;break}e:{var ne=_,Se=I.return,Je=I,st=b;if(b=k,Je.flags|=32768,st!==null&&typeof st=="object"&&typeof st.then=="function"){var Zt=st,mr=Je,br=mr.tag;if((mr.mode&1)===0&&(br===0||br===11||br===15)){var _r=mr.alternate;_r?(mr.updateQueue=_r.updateQueue,mr.memoizedState=_r.memoizedState,mr.lanes=_r.lanes):(mr.updateQueue=null,mr.memoizedState=null)}var $r=ep(Se);if($r!==null){$r.flags&=-257,Dh($r,Se,Je,ne,b),$r.mode&1&&Bc(ne,Zt,b),b=$r,st=Zt;var Kr=b.updateQueue;if(Kr===null){var Qr=new Set;Qr.add(st),b.updateQueue=Qr}else Kr.add(st);break e}else{if((b&1)===0){Bc(ne,Zt,b),Xr();break e}st=Error(s(426))}}else if(Ci&&Je.mode&1){var Lo=ep(Se);if(Lo!==null){(Lo.flags&65536)===0&&(Lo.flags|=256),Dh(Lo,Se,Je,ne,b),Pf(qs(st,Je));break e}}ne=st=qs(st,Je),j!==4&&(j=2),te===null?te=[ne]:te.push(ne),ne=Se;do{switch(ne.tag){case 3:ne.flags|=65536,b&=-b,ne.lanes|=b;var Mt=Jd(ne,st,b);Ym(ne,Mt);break e;case 1:Je=st;var pt=ne.type,jt=ne.stateNode;if((ne.flags&128)===0&&(typeof pt.getDerivedStateFromError=="function"||jt!==null&&typeof jt.componentDidCatch=="function"&&(Ae===null||!Ae.has(jt)))){ne.flags|=65536,b&=-b,ne.lanes|=b;var Pr=Qd(ne,Je,b);Ym(ne,Pr);break e}}ne=ne.return}while(ne!==null)}Xn(I)}catch(sn){b=sn,C===I&&I!==null&&(C=I=I.return);continue}break}while(!0)}function Vr(){var _=d.current;return d.current=ga,_===null?ga:_}function Xr(){(j===0||j===3||j===2)&&(j=4),A===null||(Q&268435455)===0&&(Y&268435455)===0||Bt(A,k)}function vn(_,b){var I=S;S|=2;var N=Vr();(A!==_||k!==b)&&(Ee=null,ur(_,b));do try{Ur();break}catch(W){Lr(_,W)}while(!0);if(ql(),S=I,d.current=N,C!==null)throw Error(s(261));return A=null,k=0,j}function Ur(){for(;C!==null;)Mn(C)}function Sn(){for(;C!==null&&!fn();)Mn(C)}function Mn(_){var b=zn(_.alternate,_,z);_.memoizedProps=_.pendingProps,b===null?Xn(_):C=b,y.current=null}function Xn(_){var b=_;do{var I=b.alternate;if(_=b.return,(b.flags&32768)===0){if(I=lm(I,b,z),I!==null){C=I;return}}else{if(I=lp(I,b),I!==null){I.flags&=32767,C=I;return}if(_!==null)_.flags|=32768,_.subtreeFlags=0,_.deletions=null;else{j=6,C=null;return}}if(b=b.sibling,b!==null){C=b;return}C=b=_}while(b!==null);j===0&&(j=5)}function Hr(_,b,I){var N=oi,W=x.transition;try{x.transition=null,oi=1,Tn(_,b,I,N)}finally{x.transition=W,oi=N}return null}function Tn(_,b,I,N){do _n();while(Ie!==null);if((S&6)!==0)throw Error(s(327));I=_.finishedWork;var W=_.finishedLanes;if(I===null)return null;if(_.finishedWork=null,_.finishedLanes=0,I===_.current)throw Error(s(177));_.callbackNode=null,_.callbackPriority=0;var ne=I.lanes|I.childLanes;if(Pl(_,ne),_===A&&(C=A=null,k=0),(I.subtreeFlags&2064)===0&&(I.flags&2064)===0||Pe||(Pe=!0,Wn(wi,function(){return _n(),null})),ne=(I.flags&15990)!==0,(I.subtreeFlags&15990)!==0||ne){ne=x.transition,x.transition=null;var Se=oi;oi=1;var Je=S;S|=4,y.current=null,ng(_,I),og(I,_),wc(_h),of=!!gh,_h=gh=null,_.current=I,ag(I),Fi(),S=Je,oi=Se,x.transition=ne}else _.current=I;if(Pe&&(Pe=!1,Ie=_,Ye=W),ne=_.pendingLanes,ne===0&&(Ae=null),ea(I.stateNode),ot(_,$n()),b!==null)for(N=_.onRecoverableError,I=0;I<b.length;I++)W=b[I],N(W.value,{componentStack:W.stack,digest:W.digest});if(Ce)throw Ce=!1,_=Re,Re=null,_;return(Ye&1)!==0&&_.tag!==0&&_n(),ne=_.pendingLanes,(ne&1)!==0?_===dt?Be++:(Be=0,dt=_):Be=0,jl(),null}function _n(){if(Ie!==null){var _=Qu(Ye),b=x.transition,I=oi;try{if(x.transition=null,oi=16>_?16:_,Ie===null)var N=!1;else{if(_=Ie,Ie=null,Ye=0,(S&6)!==0)throw Error(s(331));var W=S;for(S|=4,jr=_.current;jr!==null;){var ne=jr,Se=ne.child;if((jr.flags&16)!==0){var Je=ne.deletions;if(Je!==null){for(var st=0;st<Je.length;st++){var Zt=Je[st];for(jr=Zt;jr!==null;){var mr=jr;switch(mr.tag){case 0:case 11:case 15:Xl(8,mr,ne)}var br=mr.child;if(br!==null)br.return=mr,jr=br;else for(;jr!==null;){mr=jr;var _r=mr.sibling,$r=mr.return;if(fp(mr),mr===Zt){jr=null;break}if(_r!==null){_r.return=$r,jr=_r;break}jr=$r}}}var Kr=ne.alternate;if(Kr!==null){var Qr=Kr.child;if(Qr!==null){Kr.child=null;do{var Lo=Qr.sibling;Qr.sibling=null,Qr=Lo}while(Qr!==null)}}jr=ne}}if((ne.subtreeFlags&2064)!==0&&Se!==null)Se.return=ne,jr=Se;else e:for(;jr!==null;){if(ne=jr,(ne.flags&2048)!==0)switch(ne.tag){case 0:case 11:case 15:Xl(9,ne,ne.return)}var Mt=ne.sibling;if(Mt!==null){Mt.return=ne.return,jr=Mt;break e}jr=ne.return}}var pt=_.current;for(jr=pt;jr!==null;){Se=jr;var jt=Se.child;if((Se.subtreeFlags&2064)!==0&&jt!==null)jt.return=Se,jr=jt;else e:for(Se=pt;jr!==null;){if(Je=jr,(Je.flags&2048)!==0)try{switch(Je.tag){case 0:case 11:case 15:up(9,Je)}}catch(sn){Rr(Je,Je.return,sn)}if(Je===Se){jr=null;break e}var Pr=Je.sibling;if(Pr!==null){Pr.return=Je.return,jr=Pr;break e}jr=Je.return}}if(S=W,jl(),no&&typeof no.onPostCommitFiberRoot=="function")try{no.onPostCommitFiberRoot(ao,_)}catch{}N=!0}return N}finally{oi=I,x.transition=b}}return!1}function Ln(_,b,I){b=qs(I,b),b=Jd(_,b,1),_=xl(_,b,1),b=It(),_!==null&&(ua(_,1,b),ot(_,b))}function Rr(_,b,I){if(_.tag===3)Ln(_,_,I);else for(;b!==null;){if(b.tag===3){Ln(b,_,I);break}else if(b.tag===1){var N=b.stateNode;if(typeof b.type.getDerivedStateFromError=="function"||typeof N.componentDidCatch=="function"&&(Ae===null||!Ae.has(N))){_=qs(I,_),_=Qd(b,_,1),b=xl(b,_,1),_=It(),b!==null&&(ua(b,1,_),ot(b,_));break}}b=b.return}}function Gn(_,b,I){var N=_.pingCache;N!==null&&N.delete(b),b=It(),_.pingedLanes|=_.suspendedLanes&I,A===_&&(k&I)===I&&(j===4||j===3&&(k&130023424)===k&&500>$n()-me?ur(_,0):re|=I),ot(_,b)}function On(_,b){b===0&&((_.mode&1)===0?b=1:(b=cc,cc<<=1,(cc&130023424)===0&&(cc=4194304)));var I=It();_=ws(_,b),_!==null&&(ua(_,b,I),ot(_,I))}function Ti(_){var b=_.memoizedState,I=0;b!==null&&(I=b.retryLane),On(_,I)}function xn(_,b){var I=0;switch(_.tag){case 13:var N=_.stateNode,W=_.memoizedState;W!==null&&(I=W.retryLane);break;case 19:N=_.stateNode;break;default:throw Error(s(314))}N!==null&&N.delete(b),On(_,I)}var zn;zn=function(_,b,I){if(_!==null)if(_.memoizedProps!==b.pendingProps||ia.current)Eo=!0;else{if((_.lanes&I)===0&&(b.flags&128)===0)return Eo=!1,Si(_,b,I);Eo=(_.flags&131072)!==0}else Eo=!1,Ci&&(b.flags&1048576)!==0&&xu(b,zd,b.index);switch(b.lanes=0,b.tag){case 2:var N=b.type;ap(_,b),_=b.pendingProps;var W=Ic(b,Mo.current);Pu(b,I),W=Rc(null,b,N,_,W,I);var ne=Ai();return b.flags|=1,typeof W=="object"&&W!==null&&typeof W.render=="function"&&W.$$typeof===void 0?(b.tag=1,b.memoizedState=null,b.updateQueue=null,oa(N)?(ne=!0,Sh(b)):ne=!1,b.memoizedState=W.state!==null&&W.state!==void 0?W.state:null,Fs(b),W.updater=Vs,b.stateNode=W,W._reactInternals=b,Oh(b,N,_,I),b=kh(null,b,N,!0,ne,I)):(b.tag=0,Ci&&ne&&Ef(b),aa(null,b,W,I),b=b.child),b;case 16:N=b.elementType;e:{switch(ap(_,b),_=b.pendingProps,W=N._init,N=W(N._payload),b.type=N,W=b.tag=Do(N),_=Wa(N,_),W){case 0:b=$f(null,b,N,_,I);break e;case 1:b=rm(null,b,N,_,I);break e;case 11:b=tp(null,b,N,_,I);break e;case 14:b=Uf(null,b,N,Wa(N.type,_),I);break e}throw Error(s(306,N,""))}return b;case 0:return N=b.type,W=b.pendingProps,W=b.elementType===N?W:Wa(N,W),$f(_,b,N,W,I);case 1:return N=b.type,W=b.pendingProps,W=b.elementType===N?W:Wa(N,W),rm(_,b,N,W,I);case 3:e:{if(Lh(b),_===null)throw Error(s(387));N=b.pendingProps,ne=b.memoizedState,W=ne.element,pa(_,b),Cu(b,N,null,I);var Se=b.memoizedState;if(N=Se.element,ne.isDehydrated)if(ne={element:N,isDehydrated:!1,cache:Se.cache,pendingSuspenseBoundaries:Se.pendingSuspenseBoundaries,transitions:Se.transitions},b.updateQueue.baseState=ne,b.memoizedState=ne,b.flags&256){W=qs(Error(s(423)),b),b=np(_,b,N,I,W);break e}else if(N!==W){W=qs(Error(s(424)),b),b=np(_,b,N,I,W);break e}else for(da=pl(b.stateNode.containerInfo.firstChild),qa=b,Ci=!0,ls=null,I=Nd(b,null,N,I),b.child=I;I;)I.flags=I.flags&-3|4096,I=I.sibling;else{if(wu(),N===W){b=Wl(_,b,I);break e}aa(_,b,N,I)}b=b.child}return b;case 5:return Gl(b),_===null&&Bd(b),N=b.type,W=b.pendingProps,ne=_!==null?_.memoizedProps:null,Se=W.children,Ec(N,W)?Se=null:ne!==null&&Ec(N,ne)&&(b.flags|=32),Vf(_,b),aa(_,b,Se,I),b.child;case 6:return _===null&&Bd(b),null;case 13:return nm(_,b,I);case 4:return kf(b,b.stateNode.containerInfo),N=b.pendingProps,_===null?b.child=Oc(b,null,N,I):aa(_,b,N,I),b.child;case 11:return N=b.type,W=b.pendingProps,W=b.elementType===N?W:Wa(N,W),tp(_,b,N,W,I);case 7:return aa(_,b,b.pendingProps,I),b.child;case 8:return aa(_,b,b.pendingProps.children,I),b.child;case 12:return aa(_,b,b.pendingProps.children,I),b.child;case 10:e:{if(N=b.type._context,W=b.pendingProps,ne=b.memoizedProps,Se=W.value,$i(vl,N._currentValue),N._currentValue=Se,ne!==null)if(ys(ne.value,Se)){if(ne.children===W.children&&!ia.current){b=Wl(_,b,I);break e}}else for(ne=b.child,ne!==null&&(ne.return=b);ne!==null;){var Je=ne.dependencies;if(Je!==null){Se=ne.child;for(var st=Je.firstContext;st!==null;){if(st.context===N){if(ne.tag===1){st=wr(-1,I&-I),st.tag=2;var Zt=ne.updateQueue;if(Zt!==null){Zt=Zt.shared;var mr=Zt.pending;mr===null?st.next=st:(st.next=mr.next,mr.next=st),Zt.pending=st}}ne.lanes|=I,st=ne.alternate,st!==null&&(st.lanes|=I),Mf(ne.return,I,b),Je.lanes|=I;break}st=st.next}}else if(ne.tag===10)Se=ne.type===b.type?null:ne.child;else if(ne.tag===18){if(Se=ne.return,Se===null)throw Error(s(341));Se.lanes|=I,Je=Se.alternate,Je!==null&&(Je.lanes|=I),Mf(Se,I,b),Se=ne.sibling}else Se=ne.child;if(Se!==null)Se.return=ne;else for(Se=ne;Se!==null;){if(Se===b){Se=null;break}if(ne=Se.sibling,ne!==null){ne.return=Se.return,Se=ne;break}Se=Se.return}ne=Se}aa(_,b,W.children,I),b=b.child}return b;case 9:return W=b.type,N=b.pendingProps.children,Pu(b,I),W=Ga(W),N=N(W),b.flags|=1,aa(_,b,N,I),b.child;case 14:return N=b.type,W=Wa(N,b.pendingProps),W=Wa(N.type,W),Uf(_,b,N,W,I);case 15:return zu(_,b,b.type,b.pendingProps,I);case 17:return N=b.type,W=b.pendingProps,W=b.elementType===N?W:Wa(N,W),ap(_,b),b.tag=1,oa(N)?(_=!0,Sh(b)):_=!1,Pu(b,I),$s(b,N,W),Oh(b,N,W,I),kh(null,b,N,!0,_,I);case 19:return om(_,b,I);case 22:return rp(_,b,I)}throw Error(s(156,b.tag))};function Wn(_,b){return hn(_,b)}function Gi(_,b,I,N){this.tag=_,this.key=I,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=b,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=N,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ti(_,b,I,N){return new Gi(_,b,I,N)}function ji(_){return _=_.prototype,!(!_||!_.isReactComponent)}function Do(_){if(typeof _=="function")return ji(_)?1:0;if(_!=null){if(_=_.$$typeof,_===vt)return 11;if(_===St)return 14}return 2}function Ko(_,b){var I=_.alternate;return I===null?(I=ti(_.tag,b,_.key,_.mode),I.elementType=_.elementType,I.type=_.type,I.stateNode=_.stateNode,I.alternate=_,_.alternate=I):(I.pendingProps=b,I.type=_.type,I.flags=0,I.subtreeFlags=0,I.deletions=null),I.flags=_.flags&14680064,I.childLanes=_.childLanes,I.lanes=_.lanes,I.child=_.child,I.memoizedProps=_.memoizedProps,I.memoizedState=_.memoizedState,I.updateQueue=_.updateQueue,b=_.dependencies,I.dependencies=b===null?null:{lanes:b.lanes,firstContext:b.firstContext},I.sibling=_.sibling,I.index=_.index,I.ref=_.ref,I}function Vo(_,b,I,N,W,ne){var Se=2;if(N=_,typeof _=="function")ji(_)&&(Se=1);else if(typeof _=="string")Se=5;else e:switch(_){case Te:return ko(I.children,W,ne,b);case De:Se=8,W|=8;break;case Xe:return _=ti(12,I,b,W|2),_.elementType=Xe,_.lanes=ne,_;case ft:return _=ti(13,I,b,W),_.elementType=ft,_.lanes=ne,_;case bt:return _=ti(19,I,b,W),_.elementType=bt,_.lanes=ne,_;case Rt:return Ao(I,W,ne,b);default:if(typeof _=="object"&&_!==null)switch(_.$$typeof){case wt:Se=10;break e;case $e:Se=9;break e;case vt:Se=11;break e;case St:Se=14;break e;case gt:Se=16,N=null;break e}throw Error(s(130,_==null?_:typeof _,""))}return b=ti(Se,I,b,W),b.elementType=_,b.type=N,b.lanes=ne,b}function ko(_,b,I,N){return _=ti(7,_,N,b),_.lanes=I,_}function Ao(_,b,I,N){return _=ti(22,_,N,b),_.elementType=Rt,_.lanes=I,_.stateNode={isHidden:!1},_}function Oa(_,b,I){return _=ti(6,_,null,b),_.lanes=I,_}function Xa(_,b,I){return b=ti(4,_.children!==null?_.children:[],_.key,b),b.lanes=I,b.stateNode={containerInfo:_.containerInfo,pendingChildren:null,implementation:_.implementation},b}function Yo(_,b,I,N,W){this.tag=b,this.containerInfo=_,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Aa(0),this.expirationTimes=Aa(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Aa(0),this.identifierPrefix=N,this.onRecoverableError=W,this.mutableSourceEagerHydrationData=null}function Mi(_,b,I,N,W,ne,Se,Je,st){return _=new Yo(_,b,I,Je,st),b===1?(b=1,ne===!0&&(b|=8)):b=0,ne=ti(3,null,null,b),_.current=ne,ne.stateNode=_,ne.memoizedState={element:N,isDehydrated:I,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fs(ne),_}function Oi(_,b,I){var N=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:pe,key:N==null?null:""+N,children:_,containerInfo:b,implementation:I}}function Jn(_){if(!_)return ss;_=_._reactInternals;e:{if(Tt(_)!==_||_.tag!==1)throw Error(s(170));var b=_;do{switch(b.tag){case 3:b=b.stateNode.context;break e;case 1:if(oa(b.type)){b=b.stateNode.__reactInternalMemoizedMergedChildContext;break e}}b=b.return}while(b!==null);throw Error(s(171))}if(_.tag===1){var I=_.type;if(oa(I))return kd(_,I,b)}return b}function eo(_,b,I,N,W,ne,Se,Je,st){return _=Mi(I,N,!0,_,W,ne,Se,Je,st),_.context=Jn(null),I=_.current,N=It(),W=We(I),ne=wr(N,W),ne.callback=b??null,xl(I,ne,W),_.current.lanes=W,ua(_,W,N),ot(_,N),_}function uo(_,b,I,N){var W=b.current,ne=It(),Se=We(W);return I=Jn(I),b.context===null?b.context=I:b.pendingContext=I,b=wr(ne,Se),b.payload={element:_},N=N===void 0?null:N,N!==null&&(b.callback=N),_=xl(W,b,Se),_!==null&&(ze(_,W,Se,ne),jd(_,W,Se)),Se}function Pi(_){if(_=_.current,!_.child)return null;switch(_.child.tag){case 5:return _.child.stateNode;default:return _.child.stateNode}}function Ka(_,b){if(_=_.memoizedState,_!==null&&_.dehydrated!==null){var I=_.retryLane;_.retryLane=I!==0&&I<b?I:b}}function Kl(_,b){Ka(_,b),(_=_.alternate)&&Ka(_,b)}function jc(){return null}var Bu=typeof reportError=="function"?reportError:function(_){console.error(_)};function Uc(_){this._internalRoot=_}_a.prototype.render=Uc.prototype.render=function(_){var b=this._internalRoot;if(b===null)throw Error(s(409));uo(_,b,null,null)},_a.prototype.unmount=Uc.prototype.unmount=function(){var _=this._internalRoot;if(_!==null){this._internalRoot=null;var b=_.containerInfo;Jt(function(){uo(null,_,null,null)}),b[gl]=null}};function _a(_){this._internalRoot=_}_a.prototype.unstable_scheduleHydration=function(_){if(_){var b=ou();_={blockedOn:null,target:_,priority:b};for(var I=0;I<gs.length&&b!==0&&b<gs[I].priority;I++);gs.splice(I,0,_),I===0&&Hm(_)}};function Es(_){return!(!_||_.nodeType!==1&&_.nodeType!==9&&_.nodeType!==11)}function Hi(_){return!(!_||_.nodeType!==1&&_.nodeType!==9&&_.nodeType!==11&&(_.nodeType!==8||_.nodeValue!==" react-mount-point-unstable "))}function Ya(){}function Nu(_,b,I,N,W){if(W){if(typeof N=="function"){var ne=N;N=function(){var Zt=Pi(Se);ne.call(Zt)}}var Se=eo(b,N,_,0,null,!1,!1,"",Ya);return _._reactRootContainer=Se,_[gl]=Se.current,yf(_.nodeType===8?_.parentNode:_),Jt(),Se}for(;W=_.lastChild;)_.removeChild(W);if(typeof N=="function"){var Je=N;N=function(){var Zt=Pi(st);Je.call(Zt)}}var st=Mi(_,0,!1,null,null,!1,!1,"",Ya);return _._reactRootContainer=st,_[gl]=st.current,yf(_.nodeType===8?_.parentNode:_),Jt(function(){uo(b,st,I,N)}),st}function sg(_,b,I,N,W){var ne=I._reactRootContainer;if(ne){var Se=ne;if(typeof W=="function"){var Je=W;W=function(){var st=Pi(Se);Je.call(st)}}uo(b,Se,_,W)}else Se=Nu(I,b,_,W,N);return Pi(Se)}Rs=function(_){switch(_.tag){case 3:var b=_.stateNode;if(b.current.memoizedState.isDehydrated){var I=uc(b.pendingLanes);I!==0&&(ns(b,I|1),ot(b,$n()),(S&6)===0&&(ye=$n()+500,jl()))}break;case 13:Jt(function(){var N=ws(_,1);if(N!==null){var W=It();ze(N,_,1,W)}}),Kl(_,1)}},iu=function(_){if(_.tag===13){var b=ws(_,134217728);if(b!==null){var I=It();ze(b,_,134217728,I)}Kl(_,134217728)}},hc=function(_){if(_.tag===13){var b=We(_),I=ws(_,b);if(I!==null){var N=It();ze(I,_,b,N)}Kl(_,b)}},ou=function(){return oi},_d=function(_,b){var I=oi;try{return oi=_,b()}finally{oi=I}},Qc=function(_,b,I){switch(b){case"input":if(Yi(_,I),b=I.name,I.type==="radio"&&b!=null){for(I=_;I.parentNode;)I=I.parentNode;for(I=I.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]'),b=0;b<I.length;b++){var N=I[b];if(N!==_&&N.form===_.form){var W=wh(N);if(!W)throw Error(s(90));sr(N),Yi(N,W)}}}break;case"textarea":Os(_,I);break;case"select":b=I.value,b!=null&&Vi(_,!!I.multiple,b,!1)}},sl=pr,md=Jt;var lg={usingClientEntryPoint:!1,Events:[bh,Pc,wh,eu,kt,pr]},um={findFiberByHostInstance:_u,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Nv={bundleType:um.bundleType,version:um.version,rendererPackageName:um.rendererPackageName,rendererConfig:um.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_e.ReactCurrentDispatcher,findHostInstanceByFiber:function(_){return _=ln(_),_===null?null:_.stateNode},findFiberByHostInstance:um.findFiberByHostInstance||jc,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hf.isDisabled&&Hf.supportsFiber)try{ao=Hf.inject(Nv),no=Hf}catch{}}return wl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lg,wl.createPortal=function(_,b){var I=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Es(b))throw Error(s(200));return Oi(_,b,null,I)},wl.createRoot=function(_,b){if(!Es(_))throw Error(s(299));var I=!1,N="",W=Bu;return b!=null&&(b.unstable_strictMode===!0&&(I=!0),b.identifierPrefix!==void 0&&(N=b.identifierPrefix),b.onRecoverableError!==void 0&&(W=b.onRecoverableError)),b=Mi(_,1,!1,null,null,I,!1,N,W),_[gl]=b.current,yf(_.nodeType===8?_.parentNode:_),new Uc(b)},wl.findDOMNode=function(_){if(_==null)return null;if(_.nodeType===1)return _;var b=_._reactInternals;if(b===void 0)throw typeof _.render=="function"?Error(s(188)):(_=Object.keys(_).join(","),Error(s(268,_)));return _=ln(b),_=_===null?null:_.stateNode,_},wl.flushSync=function(_){return Jt(_)},wl.hydrate=function(_,b,I){if(!Hi(b))throw Error(s(200));return sg(null,_,b,!0,I)},wl.hydrateRoot=function(_,b,I){if(!Es(_))throw Error(s(405));var N=I!=null&&I.hydratedSources||null,W=!1,ne="",Se=Bu;if(I!=null&&(I.unstable_strictMode===!0&&(W=!0),I.identifierPrefix!==void 0&&(ne=I.identifierPrefix),I.onRecoverableError!==void 0&&(Se=I.onRecoverableError)),b=eo(b,null,_,1,I??null,W,!1,ne,Se),_[gl]=b.current,yf(_),N)for(_=0;_<N.length;_++)I=N[_],W=I._getVersion,W=W(I._source),b.mutableSourceEagerHydrationData==null?b.mutableSourceEagerHydrationData=[I,W]:b.mutableSourceEagerHydrationData.push(I,W);return new _a(b)},wl.render=function(_,b,I){if(!Hi(b))throw Error(s(200));return sg(null,_,b,!1,I)},wl.unmountComponentAtNode=function(_){if(!Hi(_))throw Error(s(40));return _._reactRootContainer?(Jt(function(){sg(null,null,_,!1,function(){_._reactRootContainer=null,_[gl]=null})}),!0):!1},wl.unstable_batchedUpdates=pr,wl.unstable_renderSubtreeIntoContainer=function(_,b,I,N){if(!Hi(I))throw Error(s(200));if(_==null||_._reactInternals===void 0)throw Error(s(38));return sg(_,b,I,!1,N)},wl.version="18.3.1-next-f1338f8080-20240426",wl}var _R;function KB(){if(_R)return dw.exports;_R=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(r){console.error(r)}}return t(),dw.exports=P8(),dw.exports}var yR;function I8(){if(yR)return Ox;yR=1;var t=KB();return Ox.createRoot=t.createRoot,Ox.hydrateRoot=t.hydrateRoot,Ox}var C8=I8(),Le=uP();const ht=Wi(Le),YB=b8({__proto__:null,default:ht},[Le]);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M8=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),O8=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(r,s,c)=>c?c.toUpperCase():s.toLowerCase()),vR=t=>{const r=O8(t);return r.charAt(0).toUpperCase()+r.slice(1)},JB=(...t)=>t.filter((r,s,c)=>!!r&&r.trim()!==""&&c.indexOf(r)===s).join(" ").trim();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var R8={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D8=Le.forwardRef(({color:t="currentColor",size:r=24,strokeWidth:s=2,absoluteStrokeWidth:c,className:m="",children:v,iconNode:T,...o},M)=>Le.createElement("svg",{ref:M,...R8,width:r,height:r,stroke:t,strokeWidth:c?Number(s)*24/Number(r):s,className:JB("lucide",m),...o},[...T.map(([R,B])=>Le.createElement(R,B)),...Array.isArray(v)?v:[v]]));/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ud=(t,r)=>{const s=Le.forwardRef(({className:c,...m},v)=>Le.createElement(D8,{ref:v,iconNode:r,className:JB(`lucide-${M8(vR(t))}`,`lucide-${t}`,c),...m}));return s.displayName=vR(t),s};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k8=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],L8=ud("arrow-right",k8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z8=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],xR=ud("calendar",z8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F8=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],B8=ud("check",F8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N8=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],j8=ud("chevron-down",N8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U8=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],V8=ud("database",U8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $8=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],q8=ud("ellipsis",$8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G8=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],H8=ud("info",G8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W8=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],Z8=ud("layout-dashboard",W8);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X8=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],K8=ud("search",X8);function bR(t,r){if(typeof t=="function")return t(r);t!=null&&(t.current=r)}function sb(...t){return r=>{let s=!1;const c=t.map(m=>{const v=bR(m,r);return!s&&typeof v=="function"&&(s=!0),v});if(s)return()=>{for(let m=0;m<c.length;m++){const v=c[m];typeof v=="function"?v():bR(t[m],null)}}}}function Tl(...t){return Le.useCallback(sb(...t),t)}function By(t){const r=J8(t),s=Le.forwardRef((c,m)=>{const{children:v,...T}=c,o=Le.Children.toArray(v),M=o.find(eq);if(M){const R=M.props.children,B=o.map(F=>F===M?Le.Children.count(R)>1?Le.Children.only(null):Le.isValidElement(R)?R.props.children:null:F);return He.jsx(r,{...T,ref:m,children:Le.isValidElement(R)?Le.cloneElement(R,void 0,B):null})}return He.jsx(r,{...T,ref:m,children:v})});return s.displayName=`${t}.Slot`,s}var Y8=By("Slot");function J8(t){const r=Le.forwardRef((s,c)=>{const{children:m,...v}=s;if(Le.isValidElement(m)){const T=rq(m),o=tq(v,m.props);return m.type!==Le.Fragment&&(o.ref=c?sb(c,T):T),Le.cloneElement(m,o)}return Le.Children.count(m)>1?Le.Children.only(null):null});return r.displayName=`${t}.SlotClone`,r}var Q8=Symbol("radix.slottable");function eq(t){return Le.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Q8}function tq(t,r){const s={...r};for(const c in r){const m=t[c],v=r[c];/^on[A-Z]/.test(c)?m&&v?s[c]=(...o)=>{const M=v(...o);return m(...o),M}:m&&(s[c]=m):c==="style"?s[c]={...m,...v}:c==="className"&&(s[c]=[m,v].filter(Boolean).join(" "))}return{...t,...s}}function rq(t){let r=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=r&&"isReactWarning"in r&&r.isReactWarning;return s?t.ref:(r=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=r&&"isReactWarning"in r&&r.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}function QB(t){var r,s,c="";if(typeof t=="string"||typeof t=="number")c+=t;else if(typeof t=="object")if(Array.isArray(t)){var m=t.length;for(r=0;r<m;r++)t[r]&&(s=QB(t[r]))&&(c&&(c+=" "),c+=s)}else for(s in t)t[s]&&(c&&(c+=" "),c+=s);return c}function ci(){for(var t,r,s=0,c="",m=arguments.length;s<m;s++)(t=arguments[s])&&(r=QB(t))&&(c&&(c+=" "),c+=r);return c}const wR=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,SR=ci,nq=(t,r)=>s=>{var c;if(r?.variants==null)return SR(t,s?.class,s?.className);const{variants:m,defaultVariants:v}=r,T=Object.keys(m).map(R=>{const B=s?.[R],F=v?.[R];if(B===null)return null;const G=wR(B)||wR(F);return m[R][G]}),o=s&&Object.entries(s).reduce((R,B)=>{let[F,G]=B;return G===void 0||(R[F]=G),R},{}),M=r==null||(c=r.compoundVariants)===null||c===void 0?void 0:c.reduce((R,B)=>{let{class:F,className:G,...K}=B;return Object.entries(K).every(ee=>{let[H,Z]=ee;return Array.isArray(Z)?Z.includes({...v,...o}[H]):{...v,...o}[H]===Z})?[...R,F,G]:R},[]);return SR(t,T,M,s?.class,s?.className)},hP="-",iq=t=>{const r=aq(t),{conflictingClassGroups:s,conflictingClassGroupModifiers:c}=t;return{getClassGroupId:T=>{const o=T.split(hP);return o[0]===""&&o.length!==1&&o.shift(),eN(o,r)||oq(T)},getConflictingClassGroupIds:(T,o)=>{const M=s[T]||[];return o&&c[T]?[...M,...c[T]]:M}}},eN=(t,r)=>{if(t.length===0)return r.classGroupId;const s=t[0],c=r.nextPart.get(s),m=c?eN(t.slice(1),c):void 0;if(m)return m;if(r.validators.length===0)return;const v=t.join(hP);return r.validators.find(({validator:T})=>T(v))?.classGroupId},TR=/^\[(.+)\]$/,oq=t=>{if(TR.test(t)){const r=TR.exec(t)[1],s=r?.substring(0,r.indexOf(":"));if(s)return"arbitrary.."+s}},aq=t=>{const{theme:r,classGroups:s}=t,c={nextPart:new Map,validators:[]};for(const m in s)RA(s[m],c,m,r);return c},RA=(t,r,s,c)=>{t.forEach(m=>{if(typeof m=="string"){const v=m===""?r:ER(r,m);v.classGroupId=s;return}if(typeof m=="function"){if(sq(m)){RA(m(c),r,s,c);return}r.validators.push({validator:m,classGroupId:s});return}Object.entries(m).forEach(([v,T])=>{RA(T,ER(r,v),s,c)})})},ER=(t,r)=>{let s=t;return r.split(hP).forEach(c=>{s.nextPart.has(c)||s.nextPart.set(c,{nextPart:new Map,validators:[]}),s=s.nextPart.get(c)}),s},sq=t=>t.isThemeGetter,lq=t=>{if(t<1)return{get:()=>{},set:()=>{}};let r=0,s=new Map,c=new Map;const m=(v,T)=>{s.set(v,T),r++,r>t&&(r=0,c=s,s=new Map)};return{get(v){let T=s.get(v);if(T!==void 0)return T;if((T=c.get(v))!==void 0)return m(v,T),T},set(v,T){s.has(v)?s.set(v,T):m(v,T)}}},DA="!",kA=":",cq=kA.length,uq=t=>{const{prefix:r,experimentalParseClassName:s}=t;let c=m=>{const v=[];let T=0,o=0,M=0,R;for(let ee=0;ee<m.length;ee++){let H=m[ee];if(T===0&&o===0){if(H===kA){v.push(m.slice(M,ee)),M=ee+cq;continue}if(H==="/"){R=ee;continue}}H==="["?T++:H==="]"?T--:H==="("?o++:H===")"&&o--}const B=v.length===0?m:m.substring(M),F=hq(B),G=F!==B,K=R&&R>M?R-M:void 0;return{modifiers:v,hasImportantModifier:G,baseClassName:F,maybePostfixModifierPosition:K}};if(r){const m=r+kA,v=c;c=T=>T.startsWith(m)?v(T.substring(m.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:T,maybePostfixModifierPosition:void 0}}if(s){const m=c;c=v=>s({className:v,parseClassName:m})}return c},hq=t=>t.endsWith(DA)?t.substring(0,t.length-1):t.startsWith(DA)?t.substring(1):t,fq=t=>{const r=Object.fromEntries(t.orderSensitiveModifiers.map(c=>[c,!0]));return c=>{if(c.length<=1)return c;const m=[];let v=[];return c.forEach(T=>{T[0]==="["||r[T]?(m.push(...v.sort(),T),v=[]):v.push(T)}),m.push(...v.sort()),m}},dq=t=>({cache:lq(t.cacheSize),parseClassName:uq(t),sortModifiers:fq(t),...iq(t)}),pq=/\s+/,mq=(t,r)=>{const{parseClassName:s,getClassGroupId:c,getConflictingClassGroupIds:m,sortModifiers:v}=r,T=[],o=t.trim().split(pq);let M="";for(let R=o.length-1;R>=0;R-=1){const B=o[R],{isExternal:F,modifiers:G,hasImportantModifier:K,baseClassName:ee,maybePostfixModifierPosition:H}=s(B);if(F){M=B+(M.length>0?" "+M:M);continue}let Z=!!H,ae=c(Z?ee.substring(0,H):ee);if(!ae){if(!Z){M=B+(M.length>0?" "+M:M);continue}if(ae=c(ee),!ae){M=B+(M.length>0?" "+M:M);continue}Z=!1}const fe=v(G).join(":"),ue=K?fe+DA:fe,_e=ue+ae;if(T.includes(_e))continue;T.push(_e);const le=m(ae,Z);for(let pe=0;pe<le.length;++pe){const Te=le[pe];T.push(ue+Te)}M=B+(M.length>0?" "+M:M)}return M};function gq(){let t=0,r,s,c="";for(;t<arguments.length;)(r=arguments[t++])&&(s=tN(r))&&(c&&(c+=" "),c+=s);return c}const tN=t=>{if(typeof t=="string")return t;let r,s="";for(let c=0;c<t.length;c++)t[c]&&(r=tN(t[c]))&&(s&&(s+=" "),s+=r);return s};function _q(t,...r){let s,c,m,v=T;function T(M){const R=r.reduce((B,F)=>F(B),t());return s=dq(R),c=s.cache.get,m=s.cache.set,v=o,o(M)}function o(M){const R=c(M);if(R)return R;const B=mq(M,s);return m(M,B),B}return function(){return v(gq.apply(null,arguments))}}const Da=t=>{const r=s=>s[t]||[];return r.isThemeGetter=!0,r},rN=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,nN=/^\((?:(\w[\w-]*):)?(.+)\)$/i,yq=/^\d+\/\d+$/,vq=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,xq=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,bq=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,wq=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Sq=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ag=t=>yq.test(t),gi=t=>!!t&&!Number.isNaN(Number(t)),wp=t=>!!t&&Number.isInteger(Number(t)),gw=t=>t.endsWith("%")&&gi(t.slice(0,-1)),Zf=t=>vq.test(t),Tq=()=>!0,Eq=t=>xq.test(t)&&!bq.test(t),iN=()=>!1,Aq=t=>wq.test(t),Pq=t=>Sq.test(t),Iq=t=>!on(t)&&!an(t),Cq=t=>g_(t,sN,iN),on=t=>rN.test(t),vm=t=>g_(t,lN,Eq),_w=t=>g_(t,kq,gi),AR=t=>g_(t,oN,iN),Mq=t=>g_(t,aN,Pq),Rx=t=>g_(t,cN,Aq),an=t=>nN.test(t),yy=t=>__(t,lN),Oq=t=>__(t,Lq),PR=t=>__(t,oN),Rq=t=>__(t,sN),Dq=t=>__(t,aN),Dx=t=>__(t,cN,!0),g_=(t,r,s)=>{const c=rN.exec(t);return c?c[1]?r(c[1]):s(c[2]):!1},__=(t,r,s=!1)=>{const c=nN.exec(t);return c?c[1]?r(c[1]):s:!1},oN=t=>t==="position"||t==="percentage",aN=t=>t==="image"||t==="url",sN=t=>t==="length"||t==="size"||t==="bg-size",lN=t=>t==="length",kq=t=>t==="number",Lq=t=>t==="family-name",cN=t=>t==="shadow",zq=()=>{const t=Da("color"),r=Da("font"),s=Da("text"),c=Da("font-weight"),m=Da("tracking"),v=Da("leading"),T=Da("breakpoint"),o=Da("container"),M=Da("spacing"),R=Da("radius"),B=Da("shadow"),F=Da("inset-shadow"),G=Da("text-shadow"),K=Da("drop-shadow"),ee=Da("blur"),H=Da("perspective"),Z=Da("aspect"),ae=Da("ease"),fe=Da("animate"),ue=()=>["auto","avoid","all","avoid-page","page","left","right","column"],_e=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],le=()=>[..._e(),an,on],pe=()=>["auto","hidden","clip","visible","scroll"],Te=()=>["auto","contain","none"],De=()=>[an,on,M],Xe=()=>[Ag,"full","auto",...De()],wt=()=>[wp,"none","subgrid",an,on],$e=()=>["auto",{span:["full",wp,an,on]},wp,an,on],vt=()=>[wp,"auto",an,on],ft=()=>["auto","min","max","fr",an,on],bt=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],St=()=>["start","end","center","stretch","center-safe","end-safe"],gt=()=>["auto",...De()],Rt=()=>[Ag,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...De()],Ke=()=>[t,an,on],yt=()=>[..._e(),PR,AR,{position:[an,on]}],Vt=()=>["no-repeat",{repeat:["","x","y","space","round"]}],qe=()=>["auto","cover","contain",Rq,Cq,{size:[an,on]}],mt=()=>[gw,yy,vm],ar=()=>["","none","full",R,an,on],Mr=()=>["",gi,yy,vm],Gr=()=>["solid","dashed","dotted","double"],Tr=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],vr=()=>[gi,gw,PR,AR],Br=()=>["","none",ee,an,on],or=()=>["none",gi,an,on],Ar=()=>["none",gi,an,on],un=()=>[gi,an,on],sr=()=>[Ag,"full",...De()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Zf],breakpoint:[Zf],color:[Tq],container:[Zf],"drop-shadow":[Zf],ease:["in","out","in-out"],font:[Iq],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Zf],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Zf],shadow:[Zf],spacing:["px",gi],text:[Zf],"text-shadow":[Zf],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Ag,on,an,Z]}],container:["container"],columns:[{columns:[gi,on,an,o]}],"break-after":[{"break-after":ue()}],"break-before":[{"break-before":ue()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:le()}],overflow:[{overflow:pe()}],"overflow-x":[{"overflow-x":pe()}],"overflow-y":[{"overflow-y":pe()}],overscroll:[{overscroll:Te()}],"overscroll-x":[{"overscroll-x":Te()}],"overscroll-y":[{"overscroll-y":Te()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:Xe()}],"inset-x":[{"inset-x":Xe()}],"inset-y":[{"inset-y":Xe()}],start:[{start:Xe()}],end:[{end:Xe()}],top:[{top:Xe()}],right:[{right:Xe()}],bottom:[{bottom:Xe()}],left:[{left:Xe()}],visibility:["visible","invisible","collapse"],z:[{z:[wp,"auto",an,on]}],basis:[{basis:[Ag,"full","auto",o,...De()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[gi,Ag,"auto","initial","none",on]}],grow:[{grow:["",gi,an,on]}],shrink:[{shrink:["",gi,an,on]}],order:[{order:[wp,"first","last","none",an,on]}],"grid-cols":[{"grid-cols":wt()}],"col-start-end":[{col:$e()}],"col-start":[{"col-start":vt()}],"col-end":[{"col-end":vt()}],"grid-rows":[{"grid-rows":wt()}],"row-start-end":[{row:$e()}],"row-start":[{"row-start":vt()}],"row-end":[{"row-end":vt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":ft()}],"auto-rows":[{"auto-rows":ft()}],gap:[{gap:De()}],"gap-x":[{"gap-x":De()}],"gap-y":[{"gap-y":De()}],"justify-content":[{justify:[...bt(),"normal"]}],"justify-items":[{"justify-items":[...St(),"normal"]}],"justify-self":[{"justify-self":["auto",...St()]}],"align-content":[{content:["normal",...bt()]}],"align-items":[{items:[...St(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...St(),{baseline:["","last"]}]}],"place-content":[{"place-content":bt()}],"place-items":[{"place-items":[...St(),"baseline"]}],"place-self":[{"place-self":["auto",...St()]}],p:[{p:De()}],px:[{px:De()}],py:[{py:De()}],ps:[{ps:De()}],pe:[{pe:De()}],pt:[{pt:De()}],pr:[{pr:De()}],pb:[{pb:De()}],pl:[{pl:De()}],m:[{m:gt()}],mx:[{mx:gt()}],my:[{my:gt()}],ms:[{ms:gt()}],me:[{me:gt()}],mt:[{mt:gt()}],mr:[{mr:gt()}],mb:[{mb:gt()}],ml:[{ml:gt()}],"space-x":[{"space-x":De()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":De()}],"space-y-reverse":["space-y-reverse"],size:[{size:Rt()}],w:[{w:[o,"screen",...Rt()]}],"min-w":[{"min-w":[o,"screen","none",...Rt()]}],"max-w":[{"max-w":[o,"screen","none","prose",{screen:[T]},...Rt()]}],h:[{h:["screen","lh",...Rt()]}],"min-h":[{"min-h":["screen","lh","none",...Rt()]}],"max-h":[{"max-h":["screen","lh",...Rt()]}],"font-size":[{text:["base",s,yy,vm]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[c,an,_w]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",gw,on]}],"font-family":[{font:[Oq,on,r]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[m,an,on]}],"line-clamp":[{"line-clamp":[gi,"none",an,_w]}],leading:[{leading:[v,...De()]}],"list-image":[{"list-image":["none",an,on]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",an,on]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:Ke()}],"text-color":[{text:Ke()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Gr(),"wavy"]}],"text-decoration-thickness":[{decoration:[gi,"from-font","auto",an,vm]}],"text-decoration-color":[{decoration:Ke()}],"underline-offset":[{"underline-offset":[gi,"auto",an,on]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:De()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",an,on]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",an,on]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:yt()}],"bg-repeat":[{bg:Vt()}],"bg-size":[{bg:qe()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},wp,an,on],radial:["",an,on],conic:[wp,an,on]},Dq,Mq]}],"bg-color":[{bg:Ke()}],"gradient-from-pos":[{from:mt()}],"gradient-via-pos":[{via:mt()}],"gradient-to-pos":[{to:mt()}],"gradient-from":[{from:Ke()}],"gradient-via":[{via:Ke()}],"gradient-to":[{to:Ke()}],rounded:[{rounded:ar()}],"rounded-s":[{"rounded-s":ar()}],"rounded-e":[{"rounded-e":ar()}],"rounded-t":[{"rounded-t":ar()}],"rounded-r":[{"rounded-r":ar()}],"rounded-b":[{"rounded-b":ar()}],"rounded-l":[{"rounded-l":ar()}],"rounded-ss":[{"rounded-ss":ar()}],"rounded-se":[{"rounded-se":ar()}],"rounded-ee":[{"rounded-ee":ar()}],"rounded-es":[{"rounded-es":ar()}],"rounded-tl":[{"rounded-tl":ar()}],"rounded-tr":[{"rounded-tr":ar()}],"rounded-br":[{"rounded-br":ar()}],"rounded-bl":[{"rounded-bl":ar()}],"border-w":[{border:Mr()}],"border-w-x":[{"border-x":Mr()}],"border-w-y":[{"border-y":Mr()}],"border-w-s":[{"border-s":Mr()}],"border-w-e":[{"border-e":Mr()}],"border-w-t":[{"border-t":Mr()}],"border-w-r":[{"border-r":Mr()}],"border-w-b":[{"border-b":Mr()}],"border-w-l":[{"border-l":Mr()}],"divide-x":[{"divide-x":Mr()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Mr()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Gr(),"hidden","none"]}],"divide-style":[{divide:[...Gr(),"hidden","none"]}],"border-color":[{border:Ke()}],"border-color-x":[{"border-x":Ke()}],"border-color-y":[{"border-y":Ke()}],"border-color-s":[{"border-s":Ke()}],"border-color-e":[{"border-e":Ke()}],"border-color-t":[{"border-t":Ke()}],"border-color-r":[{"border-r":Ke()}],"border-color-b":[{"border-b":Ke()}],"border-color-l":[{"border-l":Ke()}],"divide-color":[{divide:Ke()}],"outline-style":[{outline:[...Gr(),"none","hidden"]}],"outline-offset":[{"outline-offset":[gi,an,on]}],"outline-w":[{outline:["",gi,yy,vm]}],"outline-color":[{outline:Ke()}],shadow:[{shadow:["","none",B,Dx,Rx]}],"shadow-color":[{shadow:Ke()}],"inset-shadow":[{"inset-shadow":["none",F,Dx,Rx]}],"inset-shadow-color":[{"inset-shadow":Ke()}],"ring-w":[{ring:Mr()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:Ke()}],"ring-offset-w":[{"ring-offset":[gi,vm]}],"ring-offset-color":[{"ring-offset":Ke()}],"inset-ring-w":[{"inset-ring":Mr()}],"inset-ring-color":[{"inset-ring":Ke()}],"text-shadow":[{"text-shadow":["none",G,Dx,Rx]}],"text-shadow-color":[{"text-shadow":Ke()}],opacity:[{opacity:[gi,an,on]}],"mix-blend":[{"mix-blend":[...Tr(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Tr()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[gi]}],"mask-image-linear-from-pos":[{"mask-linear-from":vr()}],"mask-image-linear-to-pos":[{"mask-linear-to":vr()}],"mask-image-linear-from-color":[{"mask-linear-from":Ke()}],"mask-image-linear-to-color":[{"mask-linear-to":Ke()}],"mask-image-t-from-pos":[{"mask-t-from":vr()}],"mask-image-t-to-pos":[{"mask-t-to":vr()}],"mask-image-t-from-color":[{"mask-t-from":Ke()}],"mask-image-t-to-color":[{"mask-t-to":Ke()}],"mask-image-r-from-pos":[{"mask-r-from":vr()}],"mask-image-r-to-pos":[{"mask-r-to":vr()}],"mask-image-r-from-color":[{"mask-r-from":Ke()}],"mask-image-r-to-color":[{"mask-r-to":Ke()}],"mask-image-b-from-pos":[{"mask-b-from":vr()}],"mask-image-b-to-pos":[{"mask-b-to":vr()}],"mask-image-b-from-color":[{"mask-b-from":Ke()}],"mask-image-b-to-color":[{"mask-b-to":Ke()}],"mask-image-l-from-pos":[{"mask-l-from":vr()}],"mask-image-l-to-pos":[{"mask-l-to":vr()}],"mask-image-l-from-color":[{"mask-l-from":Ke()}],"mask-image-l-to-color":[{"mask-l-to":Ke()}],"mask-image-x-from-pos":[{"mask-x-from":vr()}],"mask-image-x-to-pos":[{"mask-x-to":vr()}],"mask-image-x-from-color":[{"mask-x-from":Ke()}],"mask-image-x-to-color":[{"mask-x-to":Ke()}],"mask-image-y-from-pos":[{"mask-y-from":vr()}],"mask-image-y-to-pos":[{"mask-y-to":vr()}],"mask-image-y-from-color":[{"mask-y-from":Ke()}],"mask-image-y-to-color":[{"mask-y-to":Ke()}],"mask-image-radial":[{"mask-radial":[an,on]}],"mask-image-radial-from-pos":[{"mask-radial-from":vr()}],"mask-image-radial-to-pos":[{"mask-radial-to":vr()}],"mask-image-radial-from-color":[{"mask-radial-from":Ke()}],"mask-image-radial-to-color":[{"mask-radial-to":Ke()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":_e()}],"mask-image-conic-pos":[{"mask-conic":[gi]}],"mask-image-conic-from-pos":[{"mask-conic-from":vr()}],"mask-image-conic-to-pos":[{"mask-conic-to":vr()}],"mask-image-conic-from-color":[{"mask-conic-from":Ke()}],"mask-image-conic-to-color":[{"mask-conic-to":Ke()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:yt()}],"mask-repeat":[{mask:Vt()}],"mask-size":[{mask:qe()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",an,on]}],filter:[{filter:["","none",an,on]}],blur:[{blur:Br()}],brightness:[{brightness:[gi,an,on]}],contrast:[{contrast:[gi,an,on]}],"drop-shadow":[{"drop-shadow":["","none",K,Dx,Rx]}],"drop-shadow-color":[{"drop-shadow":Ke()}],grayscale:[{grayscale:["",gi,an,on]}],"hue-rotate":[{"hue-rotate":[gi,an,on]}],invert:[{invert:["",gi,an,on]}],saturate:[{saturate:[gi,an,on]}],sepia:[{sepia:["",gi,an,on]}],"backdrop-filter":[{"backdrop-filter":["","none",an,on]}],"backdrop-blur":[{"backdrop-blur":Br()}],"backdrop-brightness":[{"backdrop-brightness":[gi,an,on]}],"backdrop-contrast":[{"backdrop-contrast":[gi,an,on]}],"backdrop-grayscale":[{"backdrop-grayscale":["",gi,an,on]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[gi,an,on]}],"backdrop-invert":[{"backdrop-invert":["",gi,an,on]}],"backdrop-opacity":[{"backdrop-opacity":[gi,an,on]}],"backdrop-saturate":[{"backdrop-saturate":[gi,an,on]}],"backdrop-sepia":[{"backdrop-sepia":["",gi,an,on]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":De()}],"border-spacing-x":[{"border-spacing-x":De()}],"border-spacing-y":[{"border-spacing-y":De()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",an,on]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[gi,"initial",an,on]}],ease:[{ease:["linear","initial",ae,an,on]}],delay:[{delay:[gi,an,on]}],animate:[{animate:["none",fe,an,on]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[H,an,on]}],"perspective-origin":[{"perspective-origin":le()}],rotate:[{rotate:or()}],"rotate-x":[{"rotate-x":or()}],"rotate-y":[{"rotate-y":or()}],"rotate-z":[{"rotate-z":or()}],scale:[{scale:Ar()}],"scale-x":[{"scale-x":Ar()}],"scale-y":[{"scale-y":Ar()}],"scale-z":[{"scale-z":Ar()}],"scale-3d":["scale-3d"],skew:[{skew:un()}],"skew-x":[{"skew-x":un()}],"skew-y":[{"skew-y":un()}],transform:[{transform:[an,on,"","none","gpu","cpu"]}],"transform-origin":[{origin:le()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:sr()}],"translate-x":[{"translate-x":sr()}],"translate-y":[{"translate-y":sr()}],"translate-z":[{"translate-z":sr()}],"translate-none":["translate-none"],accent:[{accent:Ke()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:Ke()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",an,on]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":De()}],"scroll-mx":[{"scroll-mx":De()}],"scroll-my":[{"scroll-my":De()}],"scroll-ms":[{"scroll-ms":De()}],"scroll-me":[{"scroll-me":De()}],"scroll-mt":[{"scroll-mt":De()}],"scroll-mr":[{"scroll-mr":De()}],"scroll-mb":[{"scroll-mb":De()}],"scroll-ml":[{"scroll-ml":De()}],"scroll-p":[{"scroll-p":De()}],"scroll-px":[{"scroll-px":De()}],"scroll-py":[{"scroll-py":De()}],"scroll-ps":[{"scroll-ps":De()}],"scroll-pe":[{"scroll-pe":De()}],"scroll-pt":[{"scroll-pt":De()}],"scroll-pr":[{"scroll-pr":De()}],"scroll-pb":[{"scroll-pb":De()}],"scroll-pl":[{"scroll-pl":De()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",an,on]}],fill:[{fill:["none",...Ke()]}],"stroke-w":[{stroke:[gi,yy,vm,_w]}],stroke:[{stroke:["none",...Ke()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},Fq=_q(zq);function Ku(...t){return Fq(ci(t))}const Bq=nq("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",selected:"bg-primary text-white hover:bg-selected-primary/90 focus-visible:ring-selected-primary/20 dark:focus-visible:ring-selected-primary/40 dark:bg-selected-primary/60",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),Pp=Le.forwardRef(({className:t,variant:r,size:s,asChild:c=!1,...m},v)=>{const T=c?Y8:"button";return He.jsx(T,{ref:v,"data-slot":"button",className:Ku(Bq({variant:r,size:s,className:t})),...m})});Pp.displayName="Button";const Nq="/Dashboard/assets/logo-BiIKLco-.png",yw=(t,r,s,c)=>{s(t),c(r)};function jq({activeItem:t,onItemClick:r,activeTab:s,onTabClick:c}){return He.jsxs("div",{className:"w-64 bg-white border-r border-border h-full flex flex-col",children:[He.jsx("div",{className:"p-4 border-b border-border",children:He.jsxs("div",{className:"flex-1 items-center gap-2",children:[He.jsx("div",{className:"w-full rounded flex items-center justify-center",children:He.jsx("img",{src:Nq,alt:"Logo",className:"w-full"})}),He.jsxs("div",{className:"mt-2 space-y-0.5 bg-gray-100 p-2 rounded",children:[He.jsx("div",{className:"text-xs text-muted-foreground text-center",children:"CENTRO DE PENSAMIENTO"}),He.jsx("div",{className:"text-xs font-medium text-center",children:"MEDICAMENTOS"}),He.jsx("div",{className:"text-xs text-muted-foreground text-center",children:"INFORMACIÓN Y PODER"})]})]})}),He.jsx("nav",{className:"flex-1 p-4",children:He.jsxs("div",{className:"space-y-2",children:[He.jsxs(Pp,{variant:t==="dashboard"?"secondary":"ghost",className:"w-full justify-start",onClick:()=>yw("dashboard","dashboard",c,r),children:[He.jsx(Z8,{className:"w-4 h-4 mr-2"}),"Dashboard"]}),He.jsxs(Pp,{variant:t==="acerca"?"secondary":"ghost",className:"w-full justify-start",onClick:()=>yw("acerca","acerca",c,r),children:[He.jsx(H8,{className:"w-4 h-4 mr-2"}),"Acerca de"]}),He.jsxs(Pp,{variant:t==="Tabla de datos"?"secondary":"ghost",className:"w-full justify-start",onClick:()=>yw("Tabla de datos","Tabla de datos",c,r),children:[He.jsx(V8,{className:"w-4 h-4 mr-2"}),"Tabla de datos"]}),He.jsxs(Pp,{variant:"ghost",className:"w-full justify-between",children:[He.jsxs("div",{className:"flex items-center",children:[He.jsx("div",{className:"w-4 h-4 mr-2"}),"Contactos"]}),He.jsx(j8,{className:"w-4 h-4"})]})]})})]})}function vw({className:t,type:r,...s}){return He.jsx("input",{type:r,"data-slot":"input",className:Ku("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...s})}function zi(t,r,{checkForDefaultPrevented:s=!0}={}){return function(m){if(t?.(m),s===!1||!m.defaultPrevented)return r?.(m)}}function Tv(t,r=[]){let s=[];function c(v,T){const o=Le.createContext(T),M=s.length;s=[...s,T];const R=F=>{const{scope:G,children:K,...ee}=F,H=G?.[t]?.[M]||o,Z=Le.useMemo(()=>ee,Object.values(ee));return He.jsx(H.Provider,{value:Z,children:K})};R.displayName=v+"Provider";function B(F,G){const K=G?.[t]?.[M]||o,ee=Le.useContext(K);if(ee)return ee;if(T!==void 0)return T;throw new Error(`\`${F}\` must be used within \`${v}\``)}return[R,B]}const m=()=>{const v=s.map(T=>Le.createContext(T));return function(o){const M=o?.[t]||v;return Le.useMemo(()=>({[`__scope${t}`]:{...o,[t]:M}}),[o,M])}};return m.scopeName=t,[c,Uq(m,...r)]}function Uq(...t){const r=t[0];if(t.length===1)return r;const s=()=>{const c=t.map(m=>({useScope:m(),scopeName:m.scopeName}));return function(v){const T=c.reduce((o,{useScope:M,scopeName:R})=>{const F=M(v)[`__scope${R}`];return{...o,...F}},{});return Le.useMemo(()=>({[`__scope${r.scopeName}`]:T}),[T])}};return s.scopeName=r.scopeName,s}var Op=globalThis?.document?Le.useLayoutEffect:()=>{},Vq=YB[" useInsertionEffect ".trim().toString()]||Op;function uN({prop:t,defaultProp:r,onChange:s=()=>{},caller:c}){const[m,v,T]=$q({defaultProp:r,onChange:s}),o=t!==void 0,M=o?t:m;{const B=Le.useRef(t!==void 0);Le.useEffect(()=>{const F=B.current;F!==o&&console.warn(`${c} is changing from ${F?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),B.current=o},[o,c])}const R=Le.useCallback(B=>{if(o){const F=qq(B)?B(t):B;F!==t&&T.current?.(F)}else v(B)},[o,t,v,T]);return[M,R]}function $q({defaultProp:t,onChange:r}){const[s,c]=Le.useState(t),m=Le.useRef(s),v=Le.useRef(r);return Vq(()=>{v.current=r},[r]),Le.useEffect(()=>{m.current!==s&&(v.current?.(s),m.current=s)},[s,m]),[s,c,v]}function qq(t){return typeof t=="function"}var fP=KB();const Gq=Wi(fP);var Hq=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Qs=Hq.reduce((t,r)=>{const s=By(`Primitive.${r}`),c=Le.forwardRef((m,v)=>{const{asChild:T,...o}=m,M=T?s:r;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),He.jsx(M,{...o,ref:v})});return c.displayName=`Primitive.${r}`,{...t,[r]:c}},{});function hN(t,r){t&&fP.flushSync(()=>t.dispatchEvent(r))}function fN(t){const r=t+"CollectionProvider",[s,c]=Tv(r),[m,v]=s(r,{collectionRef:{current:null},itemMap:new Map}),T=H=>{const{scope:Z,children:ae}=H,fe=ht.useRef(null),ue=ht.useRef(new Map).current;return He.jsx(m,{scope:Z,itemMap:ue,collectionRef:fe,children:ae})};T.displayName=r;const o=t+"CollectionSlot",M=By(o),R=ht.forwardRef((H,Z)=>{const{scope:ae,children:fe}=H,ue=v(o,ae),_e=Tl(Z,ue.collectionRef);return He.jsx(M,{ref:_e,children:fe})});R.displayName=o;const B=t+"CollectionItemSlot",F="data-radix-collection-item",G=By(B),K=ht.forwardRef((H,Z)=>{const{scope:ae,children:fe,...ue}=H,_e=ht.useRef(null),le=Tl(Z,_e),pe=v(B,ae);return ht.useEffect(()=>(pe.itemMap.set(_e,{ref:_e,...ue}),()=>void pe.itemMap.delete(_e))),He.jsx(G,{[F]:"",ref:le,children:fe})});K.displayName=B;function ee(H){const Z=v(t+"CollectionConsumer",H);return ht.useCallback(()=>{const fe=Z.collectionRef.current;if(!fe)return[];const ue=Array.from(fe.querySelectorAll(`[${F}]`));return Array.from(Z.itemMap.values()).sort((pe,Te)=>ue.indexOf(pe.ref.current)-ue.indexOf(Te.ref.current))},[Z.collectionRef,Z.itemMap])}return[{Provider:T,Slot:R,ItemSlot:K},ee,c]}var Wq=Le.createContext(void 0);function dN(t){const r=Le.useContext(Wq);return t||r||"ltr"}function nd(t){const r=Le.useRef(t);return Le.useEffect(()=>{r.current=t}),Le.useMemo(()=>(...s)=>r.current?.(...s),[])}function Zq(t,r=globalThis?.document){const s=nd(t);Le.useEffect(()=>{const c=m=>{m.key==="Escape"&&s(m)};return r.addEventListener("keydown",c,{capture:!0}),()=>r.removeEventListener("keydown",c,{capture:!0})},[s,r])}var Xq="DismissableLayer",LA="dismissableLayer.update",Kq="dismissableLayer.pointerDownOutside",Yq="dismissableLayer.focusOutside",IR,pN=Le.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),mN=Le.forwardRef((t,r)=>{const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:c,onPointerDownOutside:m,onFocusOutside:v,onInteractOutside:T,onDismiss:o,...M}=t,R=Le.useContext(pN),[B,F]=Le.useState(null),G=B?.ownerDocument??globalThis?.document,[,K]=Le.useState({}),ee=Tl(r,Te=>F(Te)),H=Array.from(R.layers),[Z]=[...R.layersWithOutsidePointerEventsDisabled].slice(-1),ae=H.indexOf(Z),fe=B?H.indexOf(B):-1,ue=R.layersWithOutsidePointerEventsDisabled.size>0,_e=fe>=ae,le=eG(Te=>{const De=Te.target,Xe=[...R.branches].some(wt=>wt.contains(De));!_e||Xe||(m?.(Te),T?.(Te),Te.defaultPrevented||o?.())},G),pe=tG(Te=>{const De=Te.target;[...R.branches].some(wt=>wt.contains(De))||(v?.(Te),T?.(Te),Te.defaultPrevented||o?.())},G);return Zq(Te=>{fe===R.layers.size-1&&(c?.(Te),!Te.defaultPrevented&&o&&(Te.preventDefault(),o()))},G),Le.useEffect(()=>{if(B)return s&&(R.layersWithOutsidePointerEventsDisabled.size===0&&(IR=G.body.style.pointerEvents,G.body.style.pointerEvents="none"),R.layersWithOutsidePointerEventsDisabled.add(B)),R.layers.add(B),CR(),()=>{s&&R.layersWithOutsidePointerEventsDisabled.size===1&&(G.body.style.pointerEvents=IR)}},[B,G,s,R]),Le.useEffect(()=>()=>{B&&(R.layers.delete(B),R.layersWithOutsidePointerEventsDisabled.delete(B),CR())},[B,R]),Le.useEffect(()=>{const Te=()=>K({});return document.addEventListener(LA,Te),()=>document.removeEventListener(LA,Te)},[]),He.jsx(Qs.div,{...M,ref:ee,style:{pointerEvents:ue?_e?"auto":"none":void 0,...t.style},onFocusCapture:zi(t.onFocusCapture,pe.onFocusCapture),onBlurCapture:zi(t.onBlurCapture,pe.onBlurCapture),onPointerDownCapture:zi(t.onPointerDownCapture,le.onPointerDownCapture)})});mN.displayName=Xq;var Jq="DismissableLayerBranch",Qq=Le.forwardRef((t,r)=>{const s=Le.useContext(pN),c=Le.useRef(null),m=Tl(r,c);return Le.useEffect(()=>{const v=c.current;if(v)return s.branches.add(v),()=>{s.branches.delete(v)}},[s.branches]),He.jsx(Qs.div,{...t,ref:m})});Qq.displayName=Jq;function eG(t,r=globalThis?.document){const s=nd(t),c=Le.useRef(!1),m=Le.useRef(()=>{});return Le.useEffect(()=>{const v=o=>{if(o.target&&!c.current){let M=function(){gN(Kq,s,R,{discrete:!0})};const R={originalEvent:o};o.pointerType==="touch"?(r.removeEventListener("click",m.current),m.current=M,r.addEventListener("click",m.current,{once:!0})):M()}else r.removeEventListener("click",m.current);c.current=!1},T=window.setTimeout(()=>{r.addEventListener("pointerdown",v)},0);return()=>{window.clearTimeout(T),r.removeEventListener("pointerdown",v),r.removeEventListener("click",m.current)}},[r,s]),{onPointerDownCapture:()=>c.current=!0}}function tG(t,r=globalThis?.document){const s=nd(t),c=Le.useRef(!1);return Le.useEffect(()=>{const m=v=>{v.target&&!c.current&&gN(Yq,s,{originalEvent:v},{discrete:!1})};return r.addEventListener("focusin",m),()=>r.removeEventListener("focusin",m)},[r,s]),{onFocusCapture:()=>c.current=!0,onBlurCapture:()=>c.current=!1}}function CR(){const t=new CustomEvent(LA);document.dispatchEvent(t)}function gN(t,r,s,{discrete:c}){const m=s.originalEvent.target,v=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:s});r&&m.addEventListener(t,r,{once:!0}),c?hN(m,v):m.dispatchEvent(v)}var xw=0;function rG(){Le.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??MR()),document.body.insertAdjacentElement("beforeend",t[1]??MR()),xw++,()=>{xw===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(r=>r.remove()),xw--}},[])}function MR(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var bw="focusScope.autoFocusOnMount",ww="focusScope.autoFocusOnUnmount",OR={bubbles:!1,cancelable:!0},nG="FocusScope",_N=Le.forwardRef((t,r)=>{const{loop:s=!1,trapped:c=!1,onMountAutoFocus:m,onUnmountAutoFocus:v,...T}=t,[o,M]=Le.useState(null),R=nd(m),B=nd(v),F=Le.useRef(null),G=Tl(r,H=>M(H)),K=Le.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Le.useEffect(()=>{if(c){let H=function(ue){if(K.paused||!o)return;const _e=ue.target;o.contains(_e)?F.current=_e:Sp(F.current,{select:!0})},Z=function(ue){if(K.paused||!o)return;const _e=ue.relatedTarget;_e!==null&&(o.contains(_e)||Sp(F.current,{select:!0}))},ae=function(ue){if(document.activeElement===document.body)for(const le of ue)le.removedNodes.length>0&&Sp(o)};document.addEventListener("focusin",H),document.addEventListener("focusout",Z);const fe=new MutationObserver(ae);return o&&fe.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",H),document.removeEventListener("focusout",Z),fe.disconnect()}}},[c,o,K.paused]),Le.useEffect(()=>{if(o){DR.add(K);const H=document.activeElement;if(!o.contains(H)){const ae=new CustomEvent(bw,OR);o.addEventListener(bw,R),o.dispatchEvent(ae),ae.defaultPrevented||(iG(cG(yN(o)),{select:!0}),document.activeElement===H&&Sp(o))}return()=>{o.removeEventListener(bw,R),setTimeout(()=>{const ae=new CustomEvent(ww,OR);o.addEventListener(ww,B),o.dispatchEvent(ae),ae.defaultPrevented||Sp(H??document.body,{select:!0}),o.removeEventListener(ww,B),DR.remove(K)},0)}}},[o,R,B,K]);const ee=Le.useCallback(H=>{if(!s&&!c||K.paused)return;const Z=H.key==="Tab"&&!H.altKey&&!H.ctrlKey&&!H.metaKey,ae=document.activeElement;if(Z&&ae){const fe=H.currentTarget,[ue,_e]=oG(fe);ue&&_e?!H.shiftKey&&ae===_e?(H.preventDefault(),s&&Sp(ue,{select:!0})):H.shiftKey&&ae===ue&&(H.preventDefault(),s&&Sp(_e,{select:!0})):ae===fe&&H.preventDefault()}},[s,c,K.paused]);return He.jsx(Qs.div,{tabIndex:-1,...T,ref:G,onKeyDown:ee})});_N.displayName=nG;function iG(t,{select:r=!1}={}){const s=document.activeElement;for(const c of t)if(Sp(c,{select:r}),document.activeElement!==s)return}function oG(t){const r=yN(t),s=RR(r,t),c=RR(r.reverse(),t);return[s,c]}function yN(t){const r=[],s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:c=>{const m=c.tagName==="INPUT"&&c.type==="hidden";return c.disabled||c.hidden||m?NodeFilter.FILTER_SKIP:c.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;s.nextNode();)r.push(s.currentNode);return r}function RR(t,r){for(const s of t)if(!aG(s,{upTo:r}))return s}function aG(t,{upTo:r}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(r!==void 0&&t===r)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function sG(t){return t instanceof HTMLInputElement&&"select"in t}function Sp(t,{select:r=!1}={}){if(t&&t.focus){const s=document.activeElement;t.focus({preventScroll:!0}),t!==s&&sG(t)&&r&&t.select()}}var DR=lG();function lG(){let t=[];return{add(r){const s=t[0];r!==s&&s?.pause(),t=kR(t,r),t.unshift(r)},remove(r){t=kR(t,r),t[0]?.resume()}}}function kR(t,r){const s=[...t],c=s.indexOf(r);return c!==-1&&s.splice(c,1),s}function cG(t){return t.filter(r=>r.tagName!=="A")}var uG=YB[" useId ".trim().toString()]||(()=>{}),hG=0;function zA(t){const[r,s]=Le.useState(uG());return Op(()=>{s(c=>c??String(hG++))},[t]),t||(r?`radix-${r}`:"")}const fG=["top","right","bottom","left"],Rp=Math.min,ec=Math.max,a0=Math.round,kx=Math.floor,Gh=t=>({x:t,y:t}),dG={left:"right",right:"left",bottom:"top",top:"bottom"},pG={start:"end",end:"start"};function FA(t,r,s){return ec(t,Rp(r,s))}function id(t,r){return typeof t=="function"?t(r):t}function od(t){return t.split("-")[0]}function y_(t){return t.split("-")[1]}function dP(t){return t==="x"?"y":"x"}function pP(t){return t==="y"?"height":"width"}const mG=new Set(["top","bottom"]);function $h(t){return mG.has(od(t))?"y":"x"}function mP(t){return dP($h(t))}function gG(t,r,s){s===void 0&&(s=!1);const c=y_(t),m=mP(t),v=pP(m);let T=m==="x"?c===(s?"end":"start")?"right":"left":c==="start"?"bottom":"top";return r.reference[v]>r.floating[v]&&(T=s0(T)),[T,s0(T)]}function _G(t){const r=s0(t);return[BA(t),r,BA(r)]}function BA(t){return t.replace(/start|end/g,r=>pG[r])}const LR=["left","right"],zR=["right","left"],yG=["top","bottom"],vG=["bottom","top"];function xG(t,r,s){switch(t){case"top":case"bottom":return s?r?zR:LR:r?LR:zR;case"left":case"right":return r?yG:vG;default:return[]}}function bG(t,r,s,c){const m=y_(t);let v=xG(od(t),s==="start",c);return m&&(v=v.map(T=>T+"-"+m),r&&(v=v.concat(v.map(BA)))),v}function s0(t){return t.replace(/left|right|bottom|top/g,r=>dG[r])}function wG(t){return{top:0,right:0,bottom:0,left:0,...t}}function vN(t){return typeof t!="number"?wG(t):{top:t,right:t,bottom:t,left:t}}function l0(t){const{x:r,y:s,width:c,height:m}=t;return{width:c,height:m,top:s,left:r,right:r+c,bottom:s+m,x:r,y:s}}function FR(t,r,s){let{reference:c,floating:m}=t;const v=$h(r),T=mP(r),o=pP(T),M=od(r),R=v==="y",B=c.x+c.width/2-m.width/2,F=c.y+c.height/2-m.height/2,G=c[o]/2-m[o]/2;let K;switch(M){case"top":K={x:B,y:c.y-m.height};break;case"bottom":K={x:B,y:c.y+c.height};break;case"right":K={x:c.x+c.width,y:F};break;case"left":K={x:c.x-m.width,y:F};break;default:K={x:c.x,y:c.y}}switch(y_(r)){case"start":K[T]-=G*(s&&R?-1:1);break;case"end":K[T]+=G*(s&&R?-1:1);break}return K}const SG=async(t,r,s)=>{const{placement:c="bottom",strategy:m="absolute",middleware:v=[],platform:T}=s,o=v.filter(Boolean),M=await(T.isRTL==null?void 0:T.isRTL(r));let R=await T.getElementRects({reference:t,floating:r,strategy:m}),{x:B,y:F}=FR(R,c,M),G=c,K={},ee=0;for(let H=0;H<o.length;H++){const{name:Z,fn:ae}=o[H],{x:fe,y:ue,data:_e,reset:le}=await ae({x:B,y:F,initialPlacement:c,placement:G,strategy:m,middlewareData:K,rects:R,platform:T,elements:{reference:t,floating:r}});B=fe??B,F=ue??F,K={...K,[Z]:{...K[Z],..._e}},le&&ee<=50&&(ee++,typeof le=="object"&&(le.placement&&(G=le.placement),le.rects&&(R=le.rects===!0?await T.getElementRects({reference:t,floating:r,strategy:m}):le.rects),{x:B,y:F}=FR(R,G,M)),H=-1)}return{x:B,y:F,placement:G,strategy:m,middlewareData:K}};async function Ny(t,r){var s;r===void 0&&(r={});const{x:c,y:m,platform:v,rects:T,elements:o,strategy:M}=t,{boundary:R="clippingAncestors",rootBoundary:B="viewport",elementContext:F="floating",altBoundary:G=!1,padding:K=0}=id(r,t),ee=vN(K),Z=o[G?F==="floating"?"reference":"floating":F],ae=l0(await v.getClippingRect({element:(s=await(v.isElement==null?void 0:v.isElement(Z)))==null||s?Z:Z.contextElement||await(v.getDocumentElement==null?void 0:v.getDocumentElement(o.floating)),boundary:R,rootBoundary:B,strategy:M})),fe=F==="floating"?{x:c,y:m,width:T.floating.width,height:T.floating.height}:T.reference,ue=await(v.getOffsetParent==null?void 0:v.getOffsetParent(o.floating)),_e=await(v.isElement==null?void 0:v.isElement(ue))?await(v.getScale==null?void 0:v.getScale(ue))||{x:1,y:1}:{x:1,y:1},le=l0(v.convertOffsetParentRelativeRectToViewportRelativeRect?await v.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:fe,offsetParent:ue,strategy:M}):fe);return{top:(ae.top-le.top+ee.top)/_e.y,bottom:(le.bottom-ae.bottom+ee.bottom)/_e.y,left:(ae.left-le.left+ee.left)/_e.x,right:(le.right-ae.right+ee.right)/_e.x}}const TG=t=>({name:"arrow",options:t,async fn(r){const{x:s,y:c,placement:m,rects:v,platform:T,elements:o,middlewareData:M}=r,{element:R,padding:B=0}=id(t,r)||{};if(R==null)return{};const F=vN(B),G={x:s,y:c},K=mP(m),ee=pP(K),H=await T.getDimensions(R),Z=K==="y",ae=Z?"top":"left",fe=Z?"bottom":"right",ue=Z?"clientHeight":"clientWidth",_e=v.reference[ee]+v.reference[K]-G[K]-v.floating[ee],le=G[K]-v.reference[K],pe=await(T.getOffsetParent==null?void 0:T.getOffsetParent(R));let Te=pe?pe[ue]:0;(!Te||!await(T.isElement==null?void 0:T.isElement(pe)))&&(Te=o.floating[ue]||v.floating[ee]);const De=_e/2-le/2,Xe=Te/2-H[ee]/2-1,wt=Rp(F[ae],Xe),$e=Rp(F[fe],Xe),vt=wt,ft=Te-H[ee]-$e,bt=Te/2-H[ee]/2+De,St=FA(vt,bt,ft),gt=!M.arrow&&y_(m)!=null&&bt!==St&&v.reference[ee]/2-(bt<vt?wt:$e)-H[ee]/2<0,Rt=gt?bt<vt?bt-vt:bt-ft:0;return{[K]:G[K]+Rt,data:{[K]:St,centerOffset:bt-St-Rt,...gt&&{alignmentOffset:Rt}},reset:gt}}}),EG=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(r){var s,c;const{placement:m,middlewareData:v,rects:T,initialPlacement:o,platform:M,elements:R}=r,{mainAxis:B=!0,crossAxis:F=!0,fallbackPlacements:G,fallbackStrategy:K="bestFit",fallbackAxisSideDirection:ee="none",flipAlignment:H=!0,...Z}=id(t,r);if((s=v.arrow)!=null&&s.alignmentOffset)return{};const ae=od(m),fe=$h(o),ue=od(o)===o,_e=await(M.isRTL==null?void 0:M.isRTL(R.floating)),le=G||(ue||!H?[s0(o)]:_G(o)),pe=ee!=="none";!G&&pe&&le.push(...bG(o,H,ee,_e));const Te=[o,...le],De=await Ny(r,Z),Xe=[];let wt=((c=v.flip)==null?void 0:c.overflows)||[];if(B&&Xe.push(De[ae]),F){const bt=gG(m,T,_e);Xe.push(De[bt[0]],De[bt[1]])}if(wt=[...wt,{placement:m,overflows:Xe}],!Xe.every(bt=>bt<=0)){var $e,vt;const bt=((($e=v.flip)==null?void 0:$e.index)||0)+1,St=Te[bt];if(St&&(!(F==="alignment"?fe!==$h(St):!1)||wt.every(Ke=>$h(Ke.placement)===fe?Ke.overflows[0]>0:!0)))return{data:{index:bt,overflows:wt},reset:{placement:St}};let gt=(vt=wt.filter(Rt=>Rt.overflows[0]<=0).sort((Rt,Ke)=>Rt.overflows[1]-Ke.overflows[1])[0])==null?void 0:vt.placement;if(!gt)switch(K){case"bestFit":{var ft;const Rt=(ft=wt.filter(Ke=>{if(pe){const yt=$h(Ke.placement);return yt===fe||yt==="y"}return!0}).map(Ke=>[Ke.placement,Ke.overflows.filter(yt=>yt>0).reduce((yt,Vt)=>yt+Vt,0)]).sort((Ke,yt)=>Ke[1]-yt[1])[0])==null?void 0:ft[0];Rt&&(gt=Rt);break}case"initialPlacement":gt=o;break}if(m!==gt)return{reset:{placement:gt}}}return{}}}};function BR(t,r){return{top:t.top-r.height,right:t.right-r.width,bottom:t.bottom-r.height,left:t.left-r.width}}function NR(t){return fG.some(r=>t[r]>=0)}const AG=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(r){const{rects:s}=r,{strategy:c="referenceHidden",...m}=id(t,r);switch(c){case"referenceHidden":{const v=await Ny(r,{...m,elementContext:"reference"}),T=BR(v,s.reference);return{data:{referenceHiddenOffsets:T,referenceHidden:NR(T)}}}case"escaped":{const v=await Ny(r,{...m,altBoundary:!0}),T=BR(v,s.floating);return{data:{escapedOffsets:T,escaped:NR(T)}}}default:return{}}}}},xN=new Set(["left","top"]);async function PG(t,r){const{placement:s,platform:c,elements:m}=t,v=await(c.isRTL==null?void 0:c.isRTL(m.floating)),T=od(s),o=y_(s),M=$h(s)==="y",R=xN.has(T)?-1:1,B=v&&M?-1:1,F=id(r,t);let{mainAxis:G,crossAxis:K,alignmentAxis:ee}=typeof F=="number"?{mainAxis:F,crossAxis:0,alignmentAxis:null}:{mainAxis:F.mainAxis||0,crossAxis:F.crossAxis||0,alignmentAxis:F.alignmentAxis};return o&&typeof ee=="number"&&(K=o==="end"?ee*-1:ee),M?{x:K*B,y:G*R}:{x:G*R,y:K*B}}const IG=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(r){var s,c;const{x:m,y:v,placement:T,middlewareData:o}=r,M=await PG(r,t);return T===((s=o.offset)==null?void 0:s.placement)&&(c=o.arrow)!=null&&c.alignmentOffset?{}:{x:m+M.x,y:v+M.y,data:{...M,placement:T}}}}},CG=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(r){const{x:s,y:c,placement:m}=r,{mainAxis:v=!0,crossAxis:T=!1,limiter:o={fn:Z=>{let{x:ae,y:fe}=Z;return{x:ae,y:fe}}},...M}=id(t,r),R={x:s,y:c},B=await Ny(r,M),F=$h(od(m)),G=dP(F);let K=R[G],ee=R[F];if(v){const Z=G==="y"?"top":"left",ae=G==="y"?"bottom":"right",fe=K+B[Z],ue=K-B[ae];K=FA(fe,K,ue)}if(T){const Z=F==="y"?"top":"left",ae=F==="y"?"bottom":"right",fe=ee+B[Z],ue=ee-B[ae];ee=FA(fe,ee,ue)}const H=o.fn({...r,[G]:K,[F]:ee});return{...H,data:{x:H.x-s,y:H.y-c,enabled:{[G]:v,[F]:T}}}}}},MG=function(t){return t===void 0&&(t={}),{options:t,fn(r){const{x:s,y:c,placement:m,rects:v,middlewareData:T}=r,{offset:o=0,mainAxis:M=!0,crossAxis:R=!0}=id(t,r),B={x:s,y:c},F=$h(m),G=dP(F);let K=B[G],ee=B[F];const H=id(o,r),Z=typeof H=="number"?{mainAxis:H,crossAxis:0}:{mainAxis:0,crossAxis:0,...H};if(M){const ue=G==="y"?"height":"width",_e=v.reference[G]-v.floating[ue]+Z.mainAxis,le=v.reference[G]+v.reference[ue]-Z.mainAxis;K<_e?K=_e:K>le&&(K=le)}if(R){var ae,fe;const ue=G==="y"?"width":"height",_e=xN.has(od(m)),le=v.reference[F]-v.floating[ue]+(_e&&((ae=T.offset)==null?void 0:ae[F])||0)+(_e?0:Z.crossAxis),pe=v.reference[F]+v.reference[ue]+(_e?0:((fe=T.offset)==null?void 0:fe[F])||0)-(_e?Z.crossAxis:0);ee<le?ee=le:ee>pe&&(ee=pe)}return{[G]:K,[F]:ee}}}},OG=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(r){var s,c;const{placement:m,rects:v,platform:T,elements:o}=r,{apply:M=()=>{},...R}=id(t,r),B=await Ny(r,R),F=od(m),G=y_(m),K=$h(m)==="y",{width:ee,height:H}=v.floating;let Z,ae;F==="top"||F==="bottom"?(Z=F,ae=G===(await(T.isRTL==null?void 0:T.isRTL(o.floating))?"start":"end")?"left":"right"):(ae=F,Z=G==="end"?"top":"bottom");const fe=H-B.top-B.bottom,ue=ee-B.left-B.right,_e=Rp(H-B[Z],fe),le=Rp(ee-B[ae],ue),pe=!r.middlewareData.shift;let Te=_e,De=le;if((s=r.middlewareData.shift)!=null&&s.enabled.x&&(De=ue),(c=r.middlewareData.shift)!=null&&c.enabled.y&&(Te=fe),pe&&!G){const wt=ec(B.left,0),$e=ec(B.right,0),vt=ec(B.top,0),ft=ec(B.bottom,0);K?De=ee-2*(wt!==0||$e!==0?wt+$e:ec(B.left,B.right)):Te=H-2*(vt!==0||ft!==0?vt+ft:ec(B.top,B.bottom))}await M({...r,availableWidth:De,availableHeight:Te});const Xe=await T.getDimensions(o.floating);return ee!==Xe.width||H!==Xe.height?{reset:{rects:!0}}:{}}}};function lb(){return typeof window<"u"}function v_(t){return bN(t)?(t.nodeName||"").toLowerCase():"#document"}function rc(t){var r;return(t==null||(r=t.ownerDocument)==null?void 0:r.defaultView)||window}function Kh(t){var r;return(r=(bN(t)?t.ownerDocument:t.document)||window.document)==null?void 0:r.documentElement}function bN(t){return lb()?t instanceof Node||t instanceof rc(t).Node:!1}function Zu(t){return lb()?t instanceof Element||t instanceof rc(t).Element:!1}function Zh(t){return lb()?t instanceof HTMLElement||t instanceof rc(t).HTMLElement:!1}function jR(t){return!lb()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof rc(t).ShadowRoot}const RG=new Set(["inline","contents"]);function Ev(t){const{overflow:r,overflowX:s,overflowY:c,display:m}=Xu(t);return/auto|scroll|overlay|hidden|clip/.test(r+c+s)&&!RG.has(m)}const DG=new Set(["table","td","th"]);function kG(t){return DG.has(v_(t))}const LG=[":popover-open",":modal"];function cb(t){return LG.some(r=>{try{return t.matches(r)}catch{return!1}})}const zG=["transform","translate","scale","rotate","perspective"],FG=["transform","translate","scale","rotate","perspective","filter"],BG=["paint","layout","strict","content"];function gP(t){const r=_P(),s=Zu(t)?Xu(t):t;return zG.some(c=>s[c]?s[c]!=="none":!1)||(s.containerType?s.containerType!=="normal":!1)||!r&&(s.backdropFilter?s.backdropFilter!=="none":!1)||!r&&(s.filter?s.filter!=="none":!1)||FG.some(c=>(s.willChange||"").includes(c))||BG.some(c=>(s.contain||"").includes(c))}function NG(t){let r=Dp(t);for(;Zh(r)&&!qg(r);){if(gP(r))return r;if(cb(r))return null;r=Dp(r)}return null}function _P(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const jG=new Set(["html","body","#document"]);function qg(t){return jG.has(v_(t))}function Xu(t){return rc(t).getComputedStyle(t)}function ub(t){return Zu(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Dp(t){if(v_(t)==="html")return t;const r=t.assignedSlot||t.parentNode||jR(t)&&t.host||Kh(t);return jR(r)?r.host:r}function wN(t){const r=Dp(t);return qg(r)?t.ownerDocument?t.ownerDocument.body:t.body:Zh(r)&&Ev(r)?r:wN(r)}function jy(t,r,s){var c;r===void 0&&(r=[]),s===void 0&&(s=!0);const m=wN(t),v=m===((c=t.ownerDocument)==null?void 0:c.body),T=rc(m);if(v){const o=NA(T);return r.concat(T,T.visualViewport||[],Ev(m)?m:[],o&&s?jy(o):[])}return r.concat(m,jy(m,[],s))}function NA(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function SN(t){const r=Xu(t);let s=parseFloat(r.width)||0,c=parseFloat(r.height)||0;const m=Zh(t),v=m?t.offsetWidth:s,T=m?t.offsetHeight:c,o=a0(s)!==v||a0(c)!==T;return o&&(s=v,c=T),{width:s,height:c,$:o}}function yP(t){return Zu(t)?t:t.contextElement}function Bg(t){const r=yP(t);if(!Zh(r))return Gh(1);const s=r.getBoundingClientRect(),{width:c,height:m,$:v}=SN(r);let T=(v?a0(s.width):s.width)/c,o=(v?a0(s.height):s.height)/m;return(!T||!Number.isFinite(T))&&(T=1),(!o||!Number.isFinite(o))&&(o=1),{x:T,y:o}}const UG=Gh(0);function TN(t){const r=rc(t);return!_P()||!r.visualViewport?UG:{x:r.visualViewport.offsetLeft,y:r.visualViewport.offsetTop}}function VG(t,r,s){return r===void 0&&(r=!1),!s||r&&s!==rc(t)?!1:r}function Rm(t,r,s,c){r===void 0&&(r=!1),s===void 0&&(s=!1);const m=t.getBoundingClientRect(),v=yP(t);let T=Gh(1);r&&(c?Zu(c)&&(T=Bg(c)):T=Bg(t));const o=VG(v,s,c)?TN(v):Gh(0);let M=(m.left+o.x)/T.x,R=(m.top+o.y)/T.y,B=m.width/T.x,F=m.height/T.y;if(v){const G=rc(v),K=c&&Zu(c)?rc(c):c;let ee=G,H=NA(ee);for(;H&&c&&K!==ee;){const Z=Bg(H),ae=H.getBoundingClientRect(),fe=Xu(H),ue=ae.left+(H.clientLeft+parseFloat(fe.paddingLeft))*Z.x,_e=ae.top+(H.clientTop+parseFloat(fe.paddingTop))*Z.y;M*=Z.x,R*=Z.y,B*=Z.x,F*=Z.y,M+=ue,R+=_e,ee=rc(H),H=NA(ee)}}return l0({width:B,height:F,x:M,y:R})}function hb(t,r){const s=ub(t).scrollLeft;return r?r.left+s:Rm(Kh(t)).left+s}function EN(t,r){const s=t.getBoundingClientRect(),c=s.left+r.scrollLeft-hb(t,s),m=s.top+r.scrollTop;return{x:c,y:m}}function $G(t){let{elements:r,rect:s,offsetParent:c,strategy:m}=t;const v=m==="fixed",T=Kh(c),o=r?cb(r.floating):!1;if(c===T||o&&v)return s;let M={scrollLeft:0,scrollTop:0},R=Gh(1);const B=Gh(0),F=Zh(c);if((F||!F&&!v)&&((v_(c)!=="body"||Ev(T))&&(M=ub(c)),Zh(c))){const K=Rm(c);R=Bg(c),B.x=K.x+c.clientLeft,B.y=K.y+c.clientTop}const G=T&&!F&&!v?EN(T,M):Gh(0);return{width:s.width*R.x,height:s.height*R.y,x:s.x*R.x-M.scrollLeft*R.x+B.x+G.x,y:s.y*R.y-M.scrollTop*R.y+B.y+G.y}}function qG(t){return Array.from(t.getClientRects())}function GG(t){const r=Kh(t),s=ub(t),c=t.ownerDocument.body,m=ec(r.scrollWidth,r.clientWidth,c.scrollWidth,c.clientWidth),v=ec(r.scrollHeight,r.clientHeight,c.scrollHeight,c.clientHeight);let T=-s.scrollLeft+hb(t);const o=-s.scrollTop;return Xu(c).direction==="rtl"&&(T+=ec(r.clientWidth,c.clientWidth)-m),{width:m,height:v,x:T,y:o}}const UR=25;function HG(t,r){const s=rc(t),c=Kh(t),m=s.visualViewport;let v=c.clientWidth,T=c.clientHeight,o=0,M=0;if(m){v=m.width,T=m.height;const B=_P();(!B||B&&r==="fixed")&&(o=m.offsetLeft,M=m.offsetTop)}const R=hb(c);if(R<=0){const B=c.ownerDocument,F=B.body,G=getComputedStyle(F),K=B.compatMode==="CSS1Compat"&&parseFloat(G.marginLeft)+parseFloat(G.marginRight)||0,ee=Math.abs(c.clientWidth-F.clientWidth-K);ee<=UR&&(v-=ee)}else R<=UR&&(v+=R);return{width:v,height:T,x:o,y:M}}const WG=new Set(["absolute","fixed"]);function ZG(t,r){const s=Rm(t,!0,r==="fixed"),c=s.top+t.clientTop,m=s.left+t.clientLeft,v=Zh(t)?Bg(t):Gh(1),T=t.clientWidth*v.x,o=t.clientHeight*v.y,M=m*v.x,R=c*v.y;return{width:T,height:o,x:M,y:R}}function VR(t,r,s){let c;if(r==="viewport")c=HG(t,s);else if(r==="document")c=GG(Kh(t));else if(Zu(r))c=ZG(r,s);else{const m=TN(t);c={x:r.x-m.x,y:r.y-m.y,width:r.width,height:r.height}}return l0(c)}function AN(t,r){const s=Dp(t);return s===r||!Zu(s)||qg(s)?!1:Xu(s).position==="fixed"||AN(s,r)}function XG(t,r){const s=r.get(t);if(s)return s;let c=jy(t,[],!1).filter(o=>Zu(o)&&v_(o)!=="body"),m=null;const v=Xu(t).position==="fixed";let T=v?Dp(t):t;for(;Zu(T)&&!qg(T);){const o=Xu(T),M=gP(T);!M&&o.position==="fixed"&&(m=null),(v?!M&&!m:!M&&o.position==="static"&&!!m&&WG.has(m.position)||Ev(T)&&!M&&AN(t,T))?c=c.filter(B=>B!==T):m=o,T=Dp(T)}return r.set(t,c),c}function KG(t){let{element:r,boundary:s,rootBoundary:c,strategy:m}=t;const T=[...s==="clippingAncestors"?cb(r)?[]:XG(r,this._c):[].concat(s),c],o=T[0],M=T.reduce((R,B)=>{const F=VR(r,B,m);return R.top=ec(F.top,R.top),R.right=Rp(F.right,R.right),R.bottom=Rp(F.bottom,R.bottom),R.left=ec(F.left,R.left),R},VR(r,o,m));return{width:M.right-M.left,height:M.bottom-M.top,x:M.left,y:M.top}}function YG(t){const{width:r,height:s}=SN(t);return{width:r,height:s}}function JG(t,r,s){const c=Zh(r),m=Kh(r),v=s==="fixed",T=Rm(t,!0,v,r);let o={scrollLeft:0,scrollTop:0};const M=Gh(0);function R(){M.x=hb(m)}if(c||!c&&!v)if((v_(r)!=="body"||Ev(m))&&(o=ub(r)),c){const K=Rm(r,!0,v,r);M.x=K.x+r.clientLeft,M.y=K.y+r.clientTop}else m&&R();v&&!c&&m&&R();const B=m&&!c&&!v?EN(m,o):Gh(0),F=T.left+o.scrollLeft-M.x-B.x,G=T.top+o.scrollTop-M.y-B.y;return{x:F,y:G,width:T.width,height:T.height}}function Sw(t){return Xu(t).position==="static"}function $R(t,r){if(!Zh(t)||Xu(t).position==="fixed")return null;if(r)return r(t);let s=t.offsetParent;return Kh(t)===s&&(s=s.ownerDocument.body),s}function PN(t,r){const s=rc(t);if(cb(t))return s;if(!Zh(t)){let m=Dp(t);for(;m&&!qg(m);){if(Zu(m)&&!Sw(m))return m;m=Dp(m)}return s}let c=$R(t,r);for(;c&&kG(c)&&Sw(c);)c=$R(c,r);return c&&qg(c)&&Sw(c)&&!gP(c)?s:c||NG(t)||s}const QG=async function(t){const r=this.getOffsetParent||PN,s=this.getDimensions,c=await s(t.floating);return{reference:JG(t.reference,await r(t.floating),t.strategy),floating:{x:0,y:0,width:c.width,height:c.height}}};function eH(t){return Xu(t).direction==="rtl"}const tH={convertOffsetParentRelativeRectToViewportRelativeRect:$G,getDocumentElement:Kh,getClippingRect:KG,getOffsetParent:PN,getElementRects:QG,getClientRects:qG,getDimensions:YG,getScale:Bg,isElement:Zu,isRTL:eH};function IN(t,r){return t.x===r.x&&t.y===r.y&&t.width===r.width&&t.height===r.height}function rH(t,r){let s=null,c;const m=Kh(t);function v(){var o;clearTimeout(c),(o=s)==null||o.disconnect(),s=null}function T(o,M){o===void 0&&(o=!1),M===void 0&&(M=1),v();const R=t.getBoundingClientRect(),{left:B,top:F,width:G,height:K}=R;if(o||r(),!G||!K)return;const ee=kx(F),H=kx(m.clientWidth-(B+G)),Z=kx(m.clientHeight-(F+K)),ae=kx(B),ue={rootMargin:-ee+"px "+-H+"px "+-Z+"px "+-ae+"px",threshold:ec(0,Rp(1,M))||1};let _e=!0;function le(pe){const Te=pe[0].intersectionRatio;if(Te!==M){if(!_e)return T();Te?T(!1,Te):c=setTimeout(()=>{T(!1,1e-7)},1e3)}Te===1&&!IN(R,t.getBoundingClientRect())&&T(),_e=!1}try{s=new IntersectionObserver(le,{...ue,root:m.ownerDocument})}catch{s=new IntersectionObserver(le,ue)}s.observe(t)}return T(!0),v}function nH(t,r,s,c){c===void 0&&(c={});const{ancestorScroll:m=!0,ancestorResize:v=!0,elementResize:T=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:M=!1}=c,R=yP(t),B=m||v?[...R?jy(R):[],...jy(r)]:[];B.forEach(ae=>{m&&ae.addEventListener("scroll",s,{passive:!0}),v&&ae.addEventListener("resize",s)});const F=R&&o?rH(R,s):null;let G=-1,K=null;T&&(K=new ResizeObserver(ae=>{let[fe]=ae;fe&&fe.target===R&&K&&(K.unobserve(r),cancelAnimationFrame(G),G=requestAnimationFrame(()=>{var ue;(ue=K)==null||ue.observe(r)})),s()}),R&&!M&&K.observe(R),K.observe(r));let ee,H=M?Rm(t):null;M&&Z();function Z(){const ae=Rm(t);H&&!IN(H,ae)&&s(),H=ae,ee=requestAnimationFrame(Z)}return s(),()=>{var ae;B.forEach(fe=>{m&&fe.removeEventListener("scroll",s),v&&fe.removeEventListener("resize",s)}),F?.(),(ae=K)==null||ae.disconnect(),K=null,M&&cancelAnimationFrame(ee)}}const iH=IG,oH=CG,aH=EG,sH=OG,lH=AG,qR=TG,cH=MG,uH=(t,r,s)=>{const c=new Map,m={platform:tH,...s},v={...m.platform,_c:c};return SG(t,r,{...m,platform:v})};var hH=typeof document<"u",fH=function(){},t0=hH?Le.useLayoutEffect:fH;function c0(t,r){if(t===r)return!0;if(typeof t!=typeof r)return!1;if(typeof t=="function"&&t.toString()===r.toString())return!0;let s,c,m;if(t&&r&&typeof t=="object"){if(Array.isArray(t)){if(s=t.length,s!==r.length)return!1;for(c=s;c--!==0;)if(!c0(t[c],r[c]))return!1;return!0}if(m=Object.keys(t),s=m.length,s!==Object.keys(r).length)return!1;for(c=s;c--!==0;)if(!{}.hasOwnProperty.call(r,m[c]))return!1;for(c=s;c--!==0;){const v=m[c];if(!(v==="_owner"&&t.$$typeof)&&!c0(t[v],r[v]))return!1}return!0}return t!==t&&r!==r}function CN(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function GR(t,r){const s=CN(t);return Math.round(r*s)/s}function Tw(t){const r=Le.useRef(t);return t0(()=>{r.current=t}),r}function dH(t){t===void 0&&(t={});const{placement:r="bottom",strategy:s="absolute",middleware:c=[],platform:m,elements:{reference:v,floating:T}={},transform:o=!0,whileElementsMounted:M,open:R}=t,[B,F]=Le.useState({x:0,y:0,strategy:s,placement:r,middlewareData:{},isPositioned:!1}),[G,K]=Le.useState(c);c0(G,c)||K(c);const[ee,H]=Le.useState(null),[Z,ae]=Le.useState(null),fe=Le.useCallback(Ke=>{Ke!==pe.current&&(pe.current=Ke,H(Ke))},[]),ue=Le.useCallback(Ke=>{Ke!==Te.current&&(Te.current=Ke,ae(Ke))},[]),_e=v||ee,le=T||Z,pe=Le.useRef(null),Te=Le.useRef(null),De=Le.useRef(B),Xe=M!=null,wt=Tw(M),$e=Tw(m),vt=Tw(R),ft=Le.useCallback(()=>{if(!pe.current||!Te.current)return;const Ke={placement:r,strategy:s,middleware:G};$e.current&&(Ke.platform=$e.current),uH(pe.current,Te.current,Ke).then(yt=>{const Vt={...yt,isPositioned:vt.current!==!1};bt.current&&!c0(De.current,Vt)&&(De.current=Vt,fP.flushSync(()=>{F(Vt)}))})},[G,r,s,$e,vt]);t0(()=>{R===!1&&De.current.isPositioned&&(De.current.isPositioned=!1,F(Ke=>({...Ke,isPositioned:!1})))},[R]);const bt=Le.useRef(!1);t0(()=>(bt.current=!0,()=>{bt.current=!1}),[]),t0(()=>{if(_e&&(pe.current=_e),le&&(Te.current=le),_e&&le){if(wt.current)return wt.current(_e,le,ft);ft()}},[_e,le,ft,wt,Xe]);const St=Le.useMemo(()=>({reference:pe,floating:Te,setReference:fe,setFloating:ue}),[fe,ue]),gt=Le.useMemo(()=>({reference:_e,floating:le}),[_e,le]),Rt=Le.useMemo(()=>{const Ke={position:s,left:0,top:0};if(!gt.floating)return Ke;const yt=GR(gt.floating,B.x),Vt=GR(gt.floating,B.y);return o?{...Ke,transform:"translate("+yt+"px, "+Vt+"px)",...CN(gt.floating)>=1.5&&{willChange:"transform"}}:{position:s,left:yt,top:Vt}},[s,o,gt.floating,B.x,B.y]);return Le.useMemo(()=>({...B,update:ft,refs:St,elements:gt,floatingStyles:Rt}),[B,ft,St,gt,Rt])}const pH=t=>{function r(s){return{}.hasOwnProperty.call(s,"current")}return{name:"arrow",options:t,fn(s){const{element:c,padding:m}=typeof t=="function"?t(s):t;return c&&r(c)?c.current!=null?qR({element:c.current,padding:m}).fn(s):{}:c?qR({element:c,padding:m}).fn(s):{}}}},mH=(t,r)=>({...iH(t),options:[t,r]}),gH=(t,r)=>({...oH(t),options:[t,r]}),_H=(t,r)=>({...cH(t),options:[t,r]}),yH=(t,r)=>({...aH(t),options:[t,r]}),vH=(t,r)=>({...sH(t),options:[t,r]}),xH=(t,r)=>({...lH(t),options:[t,r]}),bH=(t,r)=>({...pH(t),options:[t,r]});var wH="Arrow",MN=Le.forwardRef((t,r)=>{const{children:s,width:c=10,height:m=5,...v}=t;return He.jsx(Qs.svg,{...v,ref:r,width:c,height:m,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?s:He.jsx("polygon",{points:"0,0 30,0 15,10"})})});MN.displayName=wH;var SH=MN;function TH(t){const[r,s]=Le.useState(void 0);return Op(()=>{if(t){s({width:t.offsetWidth,height:t.offsetHeight});const c=new ResizeObserver(m=>{if(!Array.isArray(m)||!m.length)return;const v=m[0];let T,o;if("borderBoxSize"in v){const M=v.borderBoxSize,R=Array.isArray(M)?M[0]:M;T=R.inlineSize,o=R.blockSize}else T=t.offsetWidth,o=t.offsetHeight;s({width:T,height:o})});return c.observe(t,{box:"border-box"}),()=>c.unobserve(t)}else s(void 0)},[t]),r}var vP="Popper",[ON,RN]=Tv(vP),[EH,DN]=ON(vP),kN=t=>{const{__scopePopper:r,children:s}=t,[c,m]=Le.useState(null);return He.jsx(EH,{scope:r,anchor:c,onAnchorChange:m,children:s})};kN.displayName=vP;var LN="PopperAnchor",zN=Le.forwardRef((t,r)=>{const{__scopePopper:s,virtualRef:c,...m}=t,v=DN(LN,s),T=Le.useRef(null),o=Tl(r,T),M=Le.useRef(null);return Le.useEffect(()=>{const R=M.current;M.current=c?.current||T.current,R!==M.current&&v.onAnchorChange(M.current)}),c?null:He.jsx(Qs.div,{...m,ref:o})});zN.displayName=LN;var xP="PopperContent",[AH,PH]=ON(xP),FN=Le.forwardRef((t,r)=>{const{__scopePopper:s,side:c="bottom",sideOffset:m=0,align:v="center",alignOffset:T=0,arrowPadding:o=0,avoidCollisions:M=!0,collisionBoundary:R=[],collisionPadding:B=0,sticky:F="partial",hideWhenDetached:G=!1,updatePositionStrategy:K="optimized",onPlaced:ee,...H}=t,Z=DN(xP,s),[ae,fe]=Le.useState(null),ue=Tl(r,vr=>fe(vr)),[_e,le]=Le.useState(null),pe=TH(_e),Te=pe?.width??0,De=pe?.height??0,Xe=c+(v!=="center"?"-"+v:""),wt=typeof B=="number"?B:{top:0,right:0,bottom:0,left:0,...B},$e=Array.isArray(R)?R:[R],vt=$e.length>0,ft={padding:wt,boundary:$e.filter(CH),altBoundary:vt},{refs:bt,floatingStyles:St,placement:gt,isPositioned:Rt,middlewareData:Ke}=dH({strategy:"fixed",placement:Xe,whileElementsMounted:(...vr)=>nH(...vr,{animationFrame:K==="always"}),elements:{reference:Z.anchor},middleware:[mH({mainAxis:m+De,alignmentAxis:T}),M&&gH({mainAxis:!0,crossAxis:!1,limiter:F==="partial"?_H():void 0,...ft}),M&&yH({...ft}),vH({...ft,apply:({elements:vr,rects:Br,availableWidth:or,availableHeight:Ar})=>{const{width:un,height:sr}=Br.reference,ui=vr.floating.style;ui.setProperty("--radix-popper-available-width",`${or}px`),ui.setProperty("--radix-popper-available-height",`${Ar}px`),ui.setProperty("--radix-popper-anchor-width",`${un}px`),ui.setProperty("--radix-popper-anchor-height",`${sr}px`)}}),_e&&bH({element:_e,padding:o}),MH({arrowWidth:Te,arrowHeight:De}),G&&xH({strategy:"referenceHidden",...ft})]}),[yt,Vt]=jN(gt),qe=nd(ee);Op(()=>{Rt&&qe?.()},[Rt,qe]);const mt=Ke.arrow?.x,ar=Ke.arrow?.y,Mr=Ke.arrow?.centerOffset!==0,[Gr,Tr]=Le.useState();return Op(()=>{ae&&Tr(window.getComputedStyle(ae).zIndex)},[ae]),He.jsx("div",{ref:bt.setFloating,"data-radix-popper-content-wrapper":"",style:{...St,transform:Rt?St.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Gr,"--radix-popper-transform-origin":[Ke.transformOrigin?.x,Ke.transformOrigin?.y].join(" "),...Ke.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:He.jsx(AH,{scope:s,placedSide:yt,onArrowChange:le,arrowX:mt,arrowY:ar,shouldHideArrow:Mr,children:He.jsx(Qs.div,{"data-side":yt,"data-align":Vt,...H,ref:ue,style:{...H.style,animation:Rt?void 0:"none"}})})})});FN.displayName=xP;var BN="PopperArrow",IH={top:"bottom",right:"left",bottom:"top",left:"right"},NN=Le.forwardRef(function(r,s){const{__scopePopper:c,...m}=r,v=PH(BN,c),T=IH[v.placedSide];return He.jsx("span",{ref:v.onArrowChange,style:{position:"absolute",left:v.arrowX,top:v.arrowY,[T]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[v.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[v.placedSide],visibility:v.shouldHideArrow?"hidden":void 0},children:He.jsx(SH,{...m,ref:s,style:{...m.style,display:"block"}})})});NN.displayName=BN;function CH(t){return t!==null}var MH=t=>({name:"transformOrigin",options:t,fn(r){const{placement:s,rects:c,middlewareData:m}=r,T=m.arrow?.centerOffset!==0,o=T?0:t.arrowWidth,M=T?0:t.arrowHeight,[R,B]=jN(s),F={start:"0%",center:"50%",end:"100%"}[B],G=(m.arrow?.x??0)+o/2,K=(m.arrow?.y??0)+M/2;let ee="",H="";return R==="bottom"?(ee=T?F:`${G}px`,H=`${-M}px`):R==="top"?(ee=T?F:`${G}px`,H=`${c.floating.height+M}px`):R==="right"?(ee=`${-M}px`,H=T?F:`${K}px`):R==="left"&&(ee=`${c.floating.width+M}px`,H=T?F:`${K}px`),{data:{x:ee,y:H}}}});function jN(t){const[r,s="center"]=t.split("-");return[r,s]}var OH=kN,RH=zN,DH=FN,kH=NN,LH="Portal",UN=Le.forwardRef((t,r)=>{const{container:s,...c}=t,[m,v]=Le.useState(!1);Op(()=>v(!0),[]);const T=s||m&&globalThis?.document?.body;return T?Gq.createPortal(He.jsx(Qs.div,{...c,ref:r}),T):null});UN.displayName=LH;function zH(t,r){return Le.useReducer((s,c)=>r[s][c]??s,t)}var Av=t=>{const{present:r,children:s}=t,c=FH(r),m=typeof s=="function"?s({present:c.isPresent}):Le.Children.only(s),v=Tl(c.ref,BH(m));return typeof s=="function"||c.isPresent?Le.cloneElement(m,{ref:v}):null};Av.displayName="Presence";function FH(t){const[r,s]=Le.useState(),c=Le.useRef(null),m=Le.useRef(t),v=Le.useRef("none"),T=t?"mounted":"unmounted",[o,M]=zH(T,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Le.useEffect(()=>{const R=Lx(c.current);v.current=o==="mounted"?R:"none"},[o]),Op(()=>{const R=c.current,B=m.current;if(B!==t){const G=v.current,K=Lx(R);t?M("MOUNT"):K==="none"||R?.display==="none"?M("UNMOUNT"):M(B&&G!==K?"ANIMATION_OUT":"UNMOUNT"),m.current=t}},[t,M]),Op(()=>{if(r){let R;const B=r.ownerDocument.defaultView??window,F=K=>{const H=Lx(c.current).includes(CSS.escape(K.animationName));if(K.target===r&&H&&(M("ANIMATION_END"),!m.current)){const Z=r.style.animationFillMode;r.style.animationFillMode="forwards",R=B.setTimeout(()=>{r.style.animationFillMode==="forwards"&&(r.style.animationFillMode=Z)})}},G=K=>{K.target===r&&(v.current=Lx(c.current))};return r.addEventListener("animationstart",G),r.addEventListener("animationcancel",F),r.addEventListener("animationend",F),()=>{B.clearTimeout(R),r.removeEventListener("animationstart",G),r.removeEventListener("animationcancel",F),r.removeEventListener("animationend",F)}}else M("ANIMATION_END")},[r,M]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:Le.useCallback(R=>{c.current=R?getComputedStyle(R):null,s(R)},[])}}function Lx(t){return t?.animationName||"none"}function BH(t){let r=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,s=r&&"isReactWarning"in r&&r.isReactWarning;return s?t.ref:(r=Object.getOwnPropertyDescriptor(t,"ref")?.get,s=r&&"isReactWarning"in r&&r.isReactWarning,s?t.props.ref:t.props.ref||t.ref)}var Ew="rovingFocusGroup.onEntryFocus",NH={bubbles:!1,cancelable:!0},Pv="RovingFocusGroup",[jA,VN,jH]=fN(Pv),[UH,$N]=Tv(Pv,[jH]),[VH,$H]=UH(Pv),qN=Le.forwardRef((t,r)=>He.jsx(jA.Provider,{scope:t.__scopeRovingFocusGroup,children:He.jsx(jA.Slot,{scope:t.__scopeRovingFocusGroup,children:He.jsx(qH,{...t,ref:r})})}));qN.displayName=Pv;var qH=Le.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:s,orientation:c,loop:m=!1,dir:v,currentTabStopId:T,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:M,onEntryFocus:R,preventScrollOnEntryFocus:B=!1,...F}=t,G=Le.useRef(null),K=Tl(r,G),ee=dN(v),[H,Z]=uN({prop:T,defaultProp:o??null,onChange:M,caller:Pv}),[ae,fe]=Le.useState(!1),ue=nd(R),_e=VN(s),le=Le.useRef(!1),[pe,Te]=Le.useState(0);return Le.useEffect(()=>{const De=G.current;if(De)return De.addEventListener(Ew,ue),()=>De.removeEventListener(Ew,ue)},[ue]),He.jsx(VH,{scope:s,orientation:c,dir:ee,loop:m,currentTabStopId:H,onItemFocus:Le.useCallback(De=>Z(De),[Z]),onItemShiftTab:Le.useCallback(()=>fe(!0),[]),onFocusableItemAdd:Le.useCallback(()=>Te(De=>De+1),[]),onFocusableItemRemove:Le.useCallback(()=>Te(De=>De-1),[]),children:He.jsx(Qs.div,{tabIndex:ae||pe===0?-1:0,"data-orientation":c,...F,ref:K,style:{outline:"none",...t.style},onMouseDown:zi(t.onMouseDown,()=>{le.current=!0}),onFocus:zi(t.onFocus,De=>{const Xe=!le.current;if(De.target===De.currentTarget&&Xe&&!ae){const wt=new CustomEvent(Ew,NH);if(De.currentTarget.dispatchEvent(wt),!wt.defaultPrevented){const $e=_e().filter(gt=>gt.focusable),vt=$e.find(gt=>gt.active),ft=$e.find(gt=>gt.id===H),St=[vt,ft,...$e].filter(Boolean).map(gt=>gt.ref.current);WN(St,B)}}le.current=!1}),onBlur:zi(t.onBlur,()=>fe(!1))})})}),GN="RovingFocusGroupItem",HN=Le.forwardRef((t,r)=>{const{__scopeRovingFocusGroup:s,focusable:c=!0,active:m=!1,tabStopId:v,children:T,...o}=t,M=zA(),R=v||M,B=$H(GN,s),F=B.currentTabStopId===R,G=VN(s),{onFocusableItemAdd:K,onFocusableItemRemove:ee,currentTabStopId:H}=B;return Le.useEffect(()=>{if(c)return K(),()=>ee()},[c,K,ee]),He.jsx(jA.ItemSlot,{scope:s,id:R,focusable:c,active:m,children:He.jsx(Qs.span,{tabIndex:F?0:-1,"data-orientation":B.orientation,...o,ref:r,onMouseDown:zi(t.onMouseDown,Z=>{c?B.onItemFocus(R):Z.preventDefault()}),onFocus:zi(t.onFocus,()=>B.onItemFocus(R)),onKeyDown:zi(t.onKeyDown,Z=>{if(Z.key==="Tab"&&Z.shiftKey){B.onItemShiftTab();return}if(Z.target!==Z.currentTarget)return;const ae=WH(Z,B.orientation,B.dir);if(ae!==void 0){if(Z.metaKey||Z.ctrlKey||Z.altKey||Z.shiftKey)return;Z.preventDefault();let ue=G().filter(_e=>_e.focusable).map(_e=>_e.ref.current);if(ae==="last")ue.reverse();else if(ae==="prev"||ae==="next"){ae==="prev"&&ue.reverse();const _e=ue.indexOf(Z.currentTarget);ue=B.loop?ZH(ue,_e+1):ue.slice(_e+1)}setTimeout(()=>WN(ue))}}),children:typeof T=="function"?T({isCurrentTabStop:F,hasTabStop:H!=null}):T})})});HN.displayName=GN;var GH={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function HH(t,r){return r!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function WH(t,r,s){const c=HH(t.key,s);if(!(r==="vertical"&&["ArrowLeft","ArrowRight"].includes(c))&&!(r==="horizontal"&&["ArrowUp","ArrowDown"].includes(c)))return GH[c]}function WN(t,r=!1){const s=document.activeElement;for(const c of t)if(c===s||(c.focus({preventScroll:r}),document.activeElement!==s))return}function ZH(t,r){return t.map((s,c)=>t[(r+c)%t.length])}var XH=qN,KH=HN,YH=function(t){if(typeof document>"u")return null;var r=Array.isArray(t)?t[0]:t;return r.ownerDocument.body},Pg=new WeakMap,zx=new WeakMap,Fx={},Aw=0,ZN=function(t){return t&&(t.host||ZN(t.parentNode))},JH=function(t,r){return r.map(function(s){if(t.contains(s))return s;var c=ZN(s);return c&&t.contains(c)?c:(console.error("aria-hidden",s,"in not contained inside",t,". Doing nothing"),null)}).filter(function(s){return!!s})},QH=function(t,r,s,c){var m=JH(r,Array.isArray(t)?t:[t]);Fx[s]||(Fx[s]=new WeakMap);var v=Fx[s],T=[],o=new Set,M=new Set(m),R=function(F){!F||o.has(F)||(o.add(F),R(F.parentNode))};m.forEach(R);var B=function(F){!F||M.has(F)||Array.prototype.forEach.call(F.children,function(G){if(o.has(G))B(G);else try{var K=G.getAttribute(c),ee=K!==null&&K!=="false",H=(Pg.get(G)||0)+1,Z=(v.get(G)||0)+1;Pg.set(G,H),v.set(G,Z),T.push(G),H===1&&ee&&zx.set(G,!0),Z===1&&G.setAttribute(s,"true"),ee||G.setAttribute(c,"true")}catch(ae){console.error("aria-hidden: cannot operate on ",G,ae)}})};return B(r),o.clear(),Aw++,function(){T.forEach(function(F){var G=Pg.get(F)-1,K=v.get(F)-1;Pg.set(F,G),v.set(F,K),G||(zx.has(F)||F.removeAttribute(c),zx.delete(F)),K||F.removeAttribute(s)}),Aw--,Aw||(Pg=new WeakMap,Pg=new WeakMap,zx=new WeakMap,Fx={})}},eW=function(t,r,s){s===void 0&&(s="data-aria-hidden");var c=Array.from(Array.isArray(t)?t:[t]),m=YH(t);return m?(c.push.apply(c,Array.from(m.querySelectorAll("[aria-live], script"))),QH(c,m,s,"aria-hidden")):function(){return null}},Vh=function(){return Vh=Object.assign||function(r){for(var s,c=1,m=arguments.length;c<m;c++){s=arguments[c];for(var v in s)Object.prototype.hasOwnProperty.call(s,v)&&(r[v]=s[v])}return r},Vh.apply(this,arguments)};function XN(t,r){var s={};for(var c in t)Object.prototype.hasOwnProperty.call(t,c)&&r.indexOf(c)<0&&(s[c]=t[c]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,c=Object.getOwnPropertySymbols(t);m<c.length;m++)r.indexOf(c[m])<0&&Object.prototype.propertyIsEnumerable.call(t,c[m])&&(s[c[m]]=t[c[m]]);return s}function tW(t,r,s){if(s||arguments.length===2)for(var c=0,m=r.length,v;c<m;c++)(v||!(c in r))&&(v||(v=Array.prototype.slice.call(r,0,c)),v[c]=r[c]);return t.concat(v||Array.prototype.slice.call(r))}var r0="right-scroll-bar-position",n0="width-before-scroll-bar",rW="with-scroll-bars-hidden",nW="--removed-body-scroll-bar-size";function Pw(t,r){return typeof t=="function"?t(r):t&&(t.current=r),t}function iW(t,r){var s=Le.useState(function(){return{value:t,callback:r,facade:{get current(){return s.value},set current(c){var m=s.value;m!==c&&(s.value=c,s.callback(c,m))}}}})[0];return s.callback=r,s.facade}var oW=typeof window<"u"?Le.useLayoutEffect:Le.useEffect,HR=new WeakMap;function aW(t,r){var s=iW(null,function(c){return t.forEach(function(m){return Pw(m,c)})});return oW(function(){var c=HR.get(s);if(c){var m=new Set(c),v=new Set(t),T=s.current;m.forEach(function(o){v.has(o)||Pw(o,null)}),v.forEach(function(o){m.has(o)||Pw(o,T)})}HR.set(s,t)},[t]),s}function sW(t){return t}function lW(t,r){r===void 0&&(r=sW);var s=[],c=!1,m={read:function(){if(c)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return s.length?s[s.length-1]:t},useMedium:function(v){var T=r(v,c);return s.push(T),function(){s=s.filter(function(o){return o!==T})}},assignSyncMedium:function(v){for(c=!0;s.length;){var T=s;s=[],T.forEach(v)}s={push:function(o){return v(o)},filter:function(){return s}}},assignMedium:function(v){c=!0;var T=[];if(s.length){var o=s;s=[],o.forEach(v),T=s}var M=function(){var B=T;T=[],B.forEach(v)},R=function(){return Promise.resolve().then(M)};R(),s={push:function(B){T.push(B),R()},filter:function(B){return T=T.filter(B),s}}}};return m}function cW(t){t===void 0&&(t={});var r=lW(null);return r.options=Vh({async:!0,ssr:!1},t),r}var KN=function(t){var r=t.sideCar,s=XN(t,["sideCar"]);if(!r)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var c=r.read();if(!c)throw new Error("Sidecar medium not found");return Le.createElement(c,Vh({},s))};KN.isSideCarExport=!0;function uW(t,r){return t.useMedium(r),KN}var YN=cW(),Iw=function(){},fb=Le.forwardRef(function(t,r){var s=Le.useRef(null),c=Le.useState({onScrollCapture:Iw,onWheelCapture:Iw,onTouchMoveCapture:Iw}),m=c[0],v=c[1],T=t.forwardProps,o=t.children,M=t.className,R=t.removeScrollBar,B=t.enabled,F=t.shards,G=t.sideCar,K=t.noRelative,ee=t.noIsolation,H=t.inert,Z=t.allowPinchZoom,ae=t.as,fe=ae===void 0?"div":ae,ue=t.gapMode,_e=XN(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),le=G,pe=aW([s,r]),Te=Vh(Vh({},_e),m);return Le.createElement(Le.Fragment,null,B&&Le.createElement(le,{sideCar:YN,removeScrollBar:R,shards:F,noRelative:K,noIsolation:ee,inert:H,setCallbacks:v,allowPinchZoom:!!Z,lockRef:s,gapMode:ue}),T?Le.cloneElement(Le.Children.only(o),Vh(Vh({},Te),{ref:pe})):Le.createElement(fe,Vh({},Te,{className:M,ref:pe}),o))});fb.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};fb.classNames={fullWidth:n0,zeroRight:r0};var hW=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function fW(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var r=hW();return r&&t.setAttribute("nonce",r),t}function dW(t,r){t.styleSheet?t.styleSheet.cssText=r:t.appendChild(document.createTextNode(r))}function pW(t){var r=document.head||document.getElementsByTagName("head")[0];r.appendChild(t)}var mW=function(){var t=0,r=null;return{add:function(s){t==0&&(r=fW())&&(dW(r,s),pW(r)),t++},remove:function(){t--,!t&&r&&(r.parentNode&&r.parentNode.removeChild(r),r=null)}}},gW=function(){var t=mW();return function(r,s){Le.useEffect(function(){return t.add(r),function(){t.remove()}},[r&&s])}},JN=function(){var t=gW(),r=function(s){var c=s.styles,m=s.dynamic;return t(c,m),null};return r},_W={left:0,top:0,right:0,gap:0},Cw=function(t){return parseInt(t||"",10)||0},yW=function(t){var r=window.getComputedStyle(document.body),s=r[t==="padding"?"paddingLeft":"marginLeft"],c=r[t==="padding"?"paddingTop":"marginTop"],m=r[t==="padding"?"paddingRight":"marginRight"];return[Cw(s),Cw(c),Cw(m)]},vW=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return _W;var r=yW(t),s=document.documentElement.clientWidth,c=window.innerWidth;return{left:r[0],top:r[1],right:r[2],gap:Math.max(0,c-s+r[2]-r[0])}},xW=JN(),Ng="data-scroll-locked",bW=function(t,r,s,c){var m=t.left,v=t.top,T=t.right,o=t.gap;return s===void 0&&(s="margin"),`
  .`.concat(rW,` {
   overflow: hidden `).concat(c,`;
   padding-right: `).concat(o,"px ").concat(c,`;
  }
  body[`).concat(Ng,`] {
    overflow: hidden `).concat(c,`;
    overscroll-behavior: contain;
    `).concat([r&&"position: relative ".concat(c,";"),s==="margin"&&`
    padding-left: `.concat(m,`px;
    padding-top: `).concat(v,`px;
    padding-right: `).concat(T,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(c,`;
    `),s==="padding"&&"padding-right: ".concat(o,"px ").concat(c,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(r0,` {
    right: `).concat(o,"px ").concat(c,`;
  }
  
  .`).concat(n0,` {
    margin-right: `).concat(o,"px ").concat(c,`;
  }
  
  .`).concat(r0," .").concat(r0,` {
    right: 0 `).concat(c,`;
  }
  
  .`).concat(n0," .").concat(n0,` {
    margin-right: 0 `).concat(c,`;
  }
  
  body[`).concat(Ng,`] {
    `).concat(nW,": ").concat(o,`px;
  }
`)},WR=function(){var t=parseInt(document.body.getAttribute(Ng)||"0",10);return isFinite(t)?t:0},wW=function(){Le.useEffect(function(){return document.body.setAttribute(Ng,(WR()+1).toString()),function(){var t=WR()-1;t<=0?document.body.removeAttribute(Ng):document.body.setAttribute(Ng,t.toString())}},[])},SW=function(t){var r=t.noRelative,s=t.noImportant,c=t.gapMode,m=c===void 0?"margin":c;wW();var v=Le.useMemo(function(){return vW(m)},[m]);return Le.createElement(xW,{styles:bW(v,!r,m,s?"":"!important")})},UA=!1;if(typeof window<"u")try{var Bx=Object.defineProperty({},"passive",{get:function(){return UA=!0,!0}});window.addEventListener("test",Bx,Bx),window.removeEventListener("test",Bx,Bx)}catch{UA=!1}var Ig=UA?{passive:!1}:!1,TW=function(t){return t.tagName==="TEXTAREA"},QN=function(t,r){if(!(t instanceof Element))return!1;var s=window.getComputedStyle(t);return s[r]!=="hidden"&&!(s.overflowY===s.overflowX&&!TW(t)&&s[r]==="visible")},EW=function(t){return QN(t,"overflowY")},AW=function(t){return QN(t,"overflowX")},ZR=function(t,r){var s=r.ownerDocument,c=r;do{typeof ShadowRoot<"u"&&c instanceof ShadowRoot&&(c=c.host);var m=ej(t,c);if(m){var v=tj(t,c),T=v[1],o=v[2];if(T>o)return!0}c=c.parentNode}while(c&&c!==s.body);return!1},PW=function(t){var r=t.scrollTop,s=t.scrollHeight,c=t.clientHeight;return[r,s,c]},IW=function(t){var r=t.scrollLeft,s=t.scrollWidth,c=t.clientWidth;return[r,s,c]},ej=function(t,r){return t==="v"?EW(r):AW(r)},tj=function(t,r){return t==="v"?PW(r):IW(r)},CW=function(t,r){return t==="h"&&r==="rtl"?-1:1},MW=function(t,r,s,c,m){var v=CW(t,window.getComputedStyle(r).direction),T=v*c,o=s.target,M=r.contains(o),R=!1,B=T>0,F=0,G=0;do{if(!o)break;var K=tj(t,o),ee=K[0],H=K[1],Z=K[2],ae=H-Z-v*ee;(ee||ae)&&ej(t,o)&&(F+=ae,G+=ee);var fe=o.parentNode;o=fe&&fe.nodeType===Node.DOCUMENT_FRAGMENT_NODE?fe.host:fe}while(!M&&o!==document.body||M&&(r.contains(o)||r===o));return(B&&Math.abs(F)<1||!B&&Math.abs(G)<1)&&(R=!0),R},Nx=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},XR=function(t){return[t.deltaX,t.deltaY]},KR=function(t){return t&&"current"in t?t.current:t},OW=function(t,r){return t[0]===r[0]&&t[1]===r[1]},RW=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},DW=0,Cg=[];function kW(t){var r=Le.useRef([]),s=Le.useRef([0,0]),c=Le.useRef(),m=Le.useState(DW++)[0],v=Le.useState(JN)[0],T=Le.useRef(t);Le.useEffect(function(){T.current=t},[t]),Le.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(m));var H=tW([t.lockRef.current],(t.shards||[]).map(KR),!0).filter(Boolean);return H.forEach(function(Z){return Z.classList.add("allow-interactivity-".concat(m))}),function(){document.body.classList.remove("block-interactivity-".concat(m)),H.forEach(function(Z){return Z.classList.remove("allow-interactivity-".concat(m))})}}},[t.inert,t.lockRef.current,t.shards]);var o=Le.useCallback(function(H,Z){if("touches"in H&&H.touches.length===2||H.type==="wheel"&&H.ctrlKey)return!T.current.allowPinchZoom;var ae=Nx(H),fe=s.current,ue="deltaX"in H?H.deltaX:fe[0]-ae[0],_e="deltaY"in H?H.deltaY:fe[1]-ae[1],le,pe=H.target,Te=Math.abs(ue)>Math.abs(_e)?"h":"v";if("touches"in H&&Te==="h"&&pe.type==="range")return!1;var De=ZR(Te,pe);if(!De)return!0;if(De?le=Te:(le=Te==="v"?"h":"v",De=ZR(Te,pe)),!De)return!1;if(!c.current&&"changedTouches"in H&&(ue||_e)&&(c.current=le),!le)return!0;var Xe=c.current||le;return MW(Xe,Z,H,Xe==="h"?ue:_e)},[]),M=Le.useCallback(function(H){var Z=H;if(!(!Cg.length||Cg[Cg.length-1]!==v)){var ae="deltaY"in Z?XR(Z):Nx(Z),fe=r.current.filter(function(le){return le.name===Z.type&&(le.target===Z.target||Z.target===le.shadowParent)&&OW(le.delta,ae)})[0];if(fe&&fe.should){Z.cancelable&&Z.preventDefault();return}if(!fe){var ue=(T.current.shards||[]).map(KR).filter(Boolean).filter(function(le){return le.contains(Z.target)}),_e=ue.length>0?o(Z,ue[0]):!T.current.noIsolation;_e&&Z.cancelable&&Z.preventDefault()}}},[]),R=Le.useCallback(function(H,Z,ae,fe){var ue={name:H,delta:Z,target:ae,should:fe,shadowParent:LW(ae)};r.current.push(ue),setTimeout(function(){r.current=r.current.filter(function(_e){return _e!==ue})},1)},[]),B=Le.useCallback(function(H){s.current=Nx(H),c.current=void 0},[]),F=Le.useCallback(function(H){R(H.type,XR(H),H.target,o(H,t.lockRef.current))},[]),G=Le.useCallback(function(H){R(H.type,Nx(H),H.target,o(H,t.lockRef.current))},[]);Le.useEffect(function(){return Cg.push(v),t.setCallbacks({onScrollCapture:F,onWheelCapture:F,onTouchMoveCapture:G}),document.addEventListener("wheel",M,Ig),document.addEventListener("touchmove",M,Ig),document.addEventListener("touchstart",B,Ig),function(){Cg=Cg.filter(function(H){return H!==v}),document.removeEventListener("wheel",M,Ig),document.removeEventListener("touchmove",M,Ig),document.removeEventListener("touchstart",B,Ig)}},[]);var K=t.removeScrollBar,ee=t.inert;return Le.createElement(Le.Fragment,null,ee?Le.createElement(v,{styles:RW(m)}):null,K?Le.createElement(SW,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function LW(t){for(var r=null;t!==null;)t instanceof ShadowRoot&&(r=t.host,t=t.host),t=t.parentNode;return r}const zW=uW(YN,kW);var rj=Le.forwardRef(function(t,r){return Le.createElement(fb,Vh({},t,{ref:r,sideCar:zW}))});rj.classNames=fb.classNames;var VA=["Enter"," "],FW=["ArrowDown","PageUp","Home"],nj=["ArrowUp","PageDown","End"],BW=[...FW,...nj],NW={ltr:[...VA,"ArrowRight"],rtl:[...VA,"ArrowLeft"]},jW={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Iv="Menu",[Uy,UW,VW]=fN(Iv),[Nm,ij]=Tv(Iv,[VW,RN,$N]),db=RN(),oj=$N(),[$W,jm]=Nm(Iv),[qW,Cv]=Nm(Iv),aj=t=>{const{__scopeMenu:r,open:s=!1,children:c,dir:m,onOpenChange:v,modal:T=!0}=t,o=db(r),[M,R]=Le.useState(null),B=Le.useRef(!1),F=nd(v),G=dN(m);return Le.useEffect(()=>{const K=()=>{B.current=!0,document.addEventListener("pointerdown",ee,{capture:!0,once:!0}),document.addEventListener("pointermove",ee,{capture:!0,once:!0})},ee=()=>B.current=!1;return document.addEventListener("keydown",K,{capture:!0}),()=>{document.removeEventListener("keydown",K,{capture:!0}),document.removeEventListener("pointerdown",ee,{capture:!0}),document.removeEventListener("pointermove",ee,{capture:!0})}},[]),He.jsx(OH,{...o,children:He.jsx($W,{scope:r,open:s,onOpenChange:F,content:M,onContentChange:R,children:He.jsx(qW,{scope:r,onClose:Le.useCallback(()=>F(!1),[F]),isUsingKeyboardRef:B,dir:G,modal:T,children:c})})})};aj.displayName=Iv;var GW="MenuAnchor",bP=Le.forwardRef((t,r)=>{const{__scopeMenu:s,...c}=t,m=db(s);return He.jsx(RH,{...m,...c,ref:r})});bP.displayName=GW;var wP="MenuPortal",[HW,sj]=Nm(wP,{forceMount:void 0}),lj=t=>{const{__scopeMenu:r,forceMount:s,children:c,container:m}=t,v=jm(wP,r);return He.jsx(HW,{scope:r,forceMount:s,children:He.jsx(Av,{present:s||v.open,children:He.jsx(UN,{asChild:!0,container:m,children:c})})})};lj.displayName=wP;var Zc="MenuContent",[WW,SP]=Nm(Zc),cj=Le.forwardRef((t,r)=>{const s=sj(Zc,t.__scopeMenu),{forceMount:c=s.forceMount,...m}=t,v=jm(Zc,t.__scopeMenu),T=Cv(Zc,t.__scopeMenu);return He.jsx(Uy.Provider,{scope:t.__scopeMenu,children:He.jsx(Av,{present:c||v.open,children:He.jsx(Uy.Slot,{scope:t.__scopeMenu,children:T.modal?He.jsx(ZW,{...m,ref:r}):He.jsx(XW,{...m,ref:r})})})})}),ZW=Le.forwardRef((t,r)=>{const s=jm(Zc,t.__scopeMenu),c=Le.useRef(null),m=Tl(r,c);return Le.useEffect(()=>{const v=c.current;if(v)return eW(v)},[]),He.jsx(TP,{...t,ref:m,trapFocus:s.open,disableOutsidePointerEvents:s.open,disableOutsideScroll:!0,onFocusOutside:zi(t.onFocusOutside,v=>v.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>s.onOpenChange(!1)})}),XW=Le.forwardRef((t,r)=>{const s=jm(Zc,t.__scopeMenu);return He.jsx(TP,{...t,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>s.onOpenChange(!1)})}),KW=By("MenuContent.ScrollLock"),TP=Le.forwardRef((t,r)=>{const{__scopeMenu:s,loop:c=!1,trapFocus:m,onOpenAutoFocus:v,onCloseAutoFocus:T,disableOutsidePointerEvents:o,onEntryFocus:M,onEscapeKeyDown:R,onPointerDownOutside:B,onFocusOutside:F,onInteractOutside:G,onDismiss:K,disableOutsideScroll:ee,...H}=t,Z=jm(Zc,s),ae=Cv(Zc,s),fe=db(s),ue=oj(s),_e=UW(s),[le,pe]=Le.useState(null),Te=Le.useRef(null),De=Tl(r,Te,Z.onContentChange),Xe=Le.useRef(0),wt=Le.useRef(""),$e=Le.useRef(0),vt=Le.useRef(null),ft=Le.useRef("right"),bt=Le.useRef(0),St=ee?rj:Le.Fragment,gt=ee?{as:KW,allowPinchZoom:!0}:void 0,Rt=yt=>{const Vt=wt.current+yt,qe=_e().filter(vr=>!vr.disabled),mt=document.activeElement,ar=qe.find(vr=>vr.ref.current===mt)?.textValue,Mr=qe.map(vr=>vr.textValue),Gr=l7(Mr,Vt,ar),Tr=qe.find(vr=>vr.textValue===Gr)?.ref.current;(function vr(Br){wt.current=Br,window.clearTimeout(Xe.current),Br!==""&&(Xe.current=window.setTimeout(()=>vr(""),1e3))})(Vt),Tr&&setTimeout(()=>Tr.focus())};Le.useEffect(()=>()=>window.clearTimeout(Xe.current),[]),rG();const Ke=Le.useCallback(yt=>ft.current===vt.current?.side&&u7(yt,vt.current?.area),[]);return He.jsx(WW,{scope:s,searchRef:wt,onItemEnter:Le.useCallback(yt=>{Ke(yt)&&yt.preventDefault()},[Ke]),onItemLeave:Le.useCallback(yt=>{Ke(yt)||(Te.current?.focus(),pe(null))},[Ke]),onTriggerLeave:Le.useCallback(yt=>{Ke(yt)&&yt.preventDefault()},[Ke]),pointerGraceTimerRef:$e,onPointerGraceIntentChange:Le.useCallback(yt=>{vt.current=yt},[]),children:He.jsx(St,{...gt,children:He.jsx(_N,{asChild:!0,trapped:m,onMountAutoFocus:zi(v,yt=>{yt.preventDefault(),Te.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:T,children:He.jsx(mN,{asChild:!0,disableOutsidePointerEvents:o,onEscapeKeyDown:R,onPointerDownOutside:B,onFocusOutside:F,onInteractOutside:G,onDismiss:K,children:He.jsx(XH,{asChild:!0,...ue,dir:ae.dir,orientation:"vertical",loop:c,currentTabStopId:le,onCurrentTabStopIdChange:pe,onEntryFocus:zi(M,yt=>{ae.isUsingKeyboardRef.current||yt.preventDefault()}),preventScrollOnEntryFocus:!0,children:He.jsx(DH,{role:"menu","aria-orientation":"vertical","data-state":Ej(Z.open),"data-radix-menu-content":"",dir:ae.dir,...fe,...H,ref:De,style:{outline:"none",...H.style},onKeyDown:zi(H.onKeyDown,yt=>{const qe=yt.target.closest("[data-radix-menu-content]")===yt.currentTarget,mt=yt.ctrlKey||yt.altKey||yt.metaKey,ar=yt.key.length===1;qe&&(yt.key==="Tab"&&yt.preventDefault(),!mt&&ar&&Rt(yt.key));const Mr=Te.current;if(yt.target!==Mr||!BW.includes(yt.key))return;yt.preventDefault();const Tr=_e().filter(vr=>!vr.disabled).map(vr=>vr.ref.current);nj.includes(yt.key)&&Tr.reverse(),a7(Tr)}),onBlur:zi(t.onBlur,yt=>{yt.currentTarget.contains(yt.target)||(window.clearTimeout(Xe.current),wt.current="")}),onPointerMove:zi(t.onPointerMove,Vy(yt=>{const Vt=yt.target,qe=bt.current!==yt.clientX;if(yt.currentTarget.contains(Vt)&&qe){const mt=yt.clientX>bt.current?"right":"left";ft.current=mt,bt.current=yt.clientX}}))})})})})})})});cj.displayName=Zc;var YW="MenuGroup",EP=Le.forwardRef((t,r)=>{const{__scopeMenu:s,...c}=t;return He.jsx(Qs.div,{role:"group",...c,ref:r})});EP.displayName=YW;var JW="MenuLabel",uj=Le.forwardRef((t,r)=>{const{__scopeMenu:s,...c}=t;return He.jsx(Qs.div,{...c,ref:r})});uj.displayName=JW;var u0="MenuItem",YR="menu.itemSelect",pb=Le.forwardRef((t,r)=>{const{disabled:s=!1,onSelect:c,...m}=t,v=Le.useRef(null),T=Cv(u0,t.__scopeMenu),o=SP(u0,t.__scopeMenu),M=Tl(r,v),R=Le.useRef(!1),B=()=>{const F=v.current;if(!s&&F){const G=new CustomEvent(YR,{bubbles:!0,cancelable:!0});F.addEventListener(YR,K=>c?.(K),{once:!0}),hN(F,G),G.defaultPrevented?R.current=!1:T.onClose()}};return He.jsx(hj,{...m,ref:M,disabled:s,onClick:zi(t.onClick,B),onPointerDown:F=>{t.onPointerDown?.(F),R.current=!0},onPointerUp:zi(t.onPointerUp,F=>{R.current||F.currentTarget?.click()}),onKeyDown:zi(t.onKeyDown,F=>{const G=o.searchRef.current!=="";s||G&&F.key===" "||VA.includes(F.key)&&(F.currentTarget.click(),F.preventDefault())})})});pb.displayName=u0;var hj=Le.forwardRef((t,r)=>{const{__scopeMenu:s,disabled:c=!1,textValue:m,...v}=t,T=SP(u0,s),o=oj(s),M=Le.useRef(null),R=Tl(r,M),[B,F]=Le.useState(!1),[G,K]=Le.useState("");return Le.useEffect(()=>{const ee=M.current;ee&&K((ee.textContent??"").trim())},[v.children]),He.jsx(Uy.ItemSlot,{scope:s,disabled:c,textValue:m??G,children:He.jsx(KH,{asChild:!0,...o,focusable:!c,children:He.jsx(Qs.div,{role:"menuitem","data-highlighted":B?"":void 0,"aria-disabled":c||void 0,"data-disabled":c?"":void 0,...v,ref:R,onPointerMove:zi(t.onPointerMove,Vy(ee=>{c?T.onItemLeave(ee):(T.onItemEnter(ee),ee.defaultPrevented||ee.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:zi(t.onPointerLeave,Vy(ee=>T.onItemLeave(ee))),onFocus:zi(t.onFocus,()=>F(!0)),onBlur:zi(t.onBlur,()=>F(!1))})})})}),QW="MenuCheckboxItem",fj=Le.forwardRef((t,r)=>{const{checked:s=!1,onCheckedChange:c,...m}=t;return He.jsx(_j,{scope:t.__scopeMenu,checked:s,children:He.jsx(pb,{role:"menuitemcheckbox","aria-checked":h0(s)?"mixed":s,...m,ref:r,"data-state":PP(s),onSelect:zi(m.onSelect,()=>c?.(h0(s)?!0:!s),{checkForDefaultPrevented:!1})})})});fj.displayName=QW;var dj="MenuRadioGroup",[e7,t7]=Nm(dj,{value:void 0,onValueChange:()=>{}}),pj=Le.forwardRef((t,r)=>{const{value:s,onValueChange:c,...m}=t,v=nd(c);return He.jsx(e7,{scope:t.__scopeMenu,value:s,onValueChange:v,children:He.jsx(EP,{...m,ref:r})})});pj.displayName=dj;var mj="MenuRadioItem",gj=Le.forwardRef((t,r)=>{const{value:s,...c}=t,m=t7(mj,t.__scopeMenu),v=s===m.value;return He.jsx(_j,{scope:t.__scopeMenu,checked:v,children:He.jsx(pb,{role:"menuitemradio","aria-checked":v,...c,ref:r,"data-state":PP(v),onSelect:zi(c.onSelect,()=>m.onValueChange?.(s),{checkForDefaultPrevented:!1})})})});gj.displayName=mj;var AP="MenuItemIndicator",[_j,r7]=Nm(AP,{checked:!1}),yj=Le.forwardRef((t,r)=>{const{__scopeMenu:s,forceMount:c,...m}=t,v=r7(AP,s);return He.jsx(Av,{present:c||h0(v.checked)||v.checked===!0,children:He.jsx(Qs.span,{...m,ref:r,"data-state":PP(v.checked)})})});yj.displayName=AP;var n7="MenuSeparator",vj=Le.forwardRef((t,r)=>{const{__scopeMenu:s,...c}=t;return He.jsx(Qs.div,{role:"separator","aria-orientation":"horizontal",...c,ref:r})});vj.displayName=n7;var i7="MenuArrow",xj=Le.forwardRef((t,r)=>{const{__scopeMenu:s,...c}=t,m=db(s);return He.jsx(kH,{...m,...c,ref:r})});xj.displayName=i7;var o7="MenuSub",[$ue,bj]=Nm(o7),Iy="MenuSubTrigger",wj=Le.forwardRef((t,r)=>{const s=jm(Iy,t.__scopeMenu),c=Cv(Iy,t.__scopeMenu),m=bj(Iy,t.__scopeMenu),v=SP(Iy,t.__scopeMenu),T=Le.useRef(null),{pointerGraceTimerRef:o,onPointerGraceIntentChange:M}=v,R={__scopeMenu:t.__scopeMenu},B=Le.useCallback(()=>{T.current&&window.clearTimeout(T.current),T.current=null},[]);return Le.useEffect(()=>B,[B]),Le.useEffect(()=>{const F=o.current;return()=>{window.clearTimeout(F),M(null)}},[o,M]),He.jsx(bP,{asChild:!0,...R,children:He.jsx(hj,{id:m.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":m.contentId,"data-state":Ej(s.open),...t,ref:sb(r,m.onTriggerChange),onClick:F=>{t.onClick?.(F),!(t.disabled||F.defaultPrevented)&&(F.currentTarget.focus(),s.open||s.onOpenChange(!0))},onPointerMove:zi(t.onPointerMove,Vy(F=>{v.onItemEnter(F),!F.defaultPrevented&&!t.disabled&&!s.open&&!T.current&&(v.onPointerGraceIntentChange(null),T.current=window.setTimeout(()=>{s.onOpenChange(!0),B()},100))})),onPointerLeave:zi(t.onPointerLeave,Vy(F=>{B();const G=s.content?.getBoundingClientRect();if(G){const K=s.content?.dataset.side,ee=K==="right",H=ee?-5:5,Z=G[ee?"left":"right"],ae=G[ee?"right":"left"];v.onPointerGraceIntentChange({area:[{x:F.clientX+H,y:F.clientY},{x:Z,y:G.top},{x:ae,y:G.top},{x:ae,y:G.bottom},{x:Z,y:G.bottom}],side:K}),window.clearTimeout(o.current),o.current=window.setTimeout(()=>v.onPointerGraceIntentChange(null),300)}else{if(v.onTriggerLeave(F),F.defaultPrevented)return;v.onPointerGraceIntentChange(null)}})),onKeyDown:zi(t.onKeyDown,F=>{const G=v.searchRef.current!=="";t.disabled||G&&F.key===" "||NW[c.dir].includes(F.key)&&(s.onOpenChange(!0),s.content?.focus(),F.preventDefault())})})})});wj.displayName=Iy;var Sj="MenuSubContent",Tj=Le.forwardRef((t,r)=>{const s=sj(Zc,t.__scopeMenu),{forceMount:c=s.forceMount,...m}=t,v=jm(Zc,t.__scopeMenu),T=Cv(Zc,t.__scopeMenu),o=bj(Sj,t.__scopeMenu),M=Le.useRef(null),R=Tl(r,M);return He.jsx(Uy.Provider,{scope:t.__scopeMenu,children:He.jsx(Av,{present:c||v.open,children:He.jsx(Uy.Slot,{scope:t.__scopeMenu,children:He.jsx(TP,{id:o.contentId,"aria-labelledby":o.triggerId,...m,ref:R,align:"start",side:T.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:B=>{T.isUsingKeyboardRef.current&&M.current?.focus(),B.preventDefault()},onCloseAutoFocus:B=>B.preventDefault(),onFocusOutside:zi(t.onFocusOutside,B=>{B.target!==o.trigger&&v.onOpenChange(!1)}),onEscapeKeyDown:zi(t.onEscapeKeyDown,B=>{T.onClose(),B.preventDefault()}),onKeyDown:zi(t.onKeyDown,B=>{const F=B.currentTarget.contains(B.target),G=jW[T.dir].includes(B.key);F&&G&&(v.onOpenChange(!1),o.trigger?.focus(),B.preventDefault())})})})})})});Tj.displayName=Sj;function Ej(t){return t?"open":"closed"}function h0(t){return t==="indeterminate"}function PP(t){return h0(t)?"indeterminate":t?"checked":"unchecked"}function a7(t){const r=document.activeElement;for(const s of t)if(s===r||(s.focus(),document.activeElement!==r))return}function s7(t,r){return t.map((s,c)=>t[(r+c)%t.length])}function l7(t,r,s){const m=r.length>1&&Array.from(r).every(R=>R===r[0])?r[0]:r,v=s?t.indexOf(s):-1;let T=s7(t,Math.max(v,0));m.length===1&&(T=T.filter(R=>R!==s));const M=T.find(R=>R.toLowerCase().startsWith(m.toLowerCase()));return M!==s?M:void 0}function c7(t,r){const{x:s,y:c}=t;let m=!1;for(let v=0,T=r.length-1;v<r.length;T=v++){const o=r[v],M=r[T],R=o.x,B=o.y,F=M.x,G=M.y;B>c!=G>c&&s<(F-R)*(c-B)/(G-B)+R&&(m=!m)}return m}function u7(t,r){if(!r)return!1;const s={x:t.clientX,y:t.clientY};return c7(s,r)}function Vy(t){return r=>r.pointerType==="mouse"?t(r):void 0}var h7=aj,f7=bP,d7=lj,p7=cj,m7=EP,g7=uj,_7=pb,y7=fj,v7=pj,x7=gj,b7=yj,w7=vj,S7=xj,T7=wj,E7=Tj,mb="DropdownMenu",[A7,que]=Tv(mb,[ij]),el=ij(),[P7,Aj]=A7(mb),Pj=t=>{const{__scopeDropdownMenu:r,children:s,dir:c,open:m,defaultOpen:v,onOpenChange:T,modal:o=!0}=t,M=el(r),R=Le.useRef(null),[B,F]=uN({prop:m,defaultProp:v??!1,onChange:T,caller:mb});return He.jsx(P7,{scope:r,triggerId:zA(),triggerRef:R,contentId:zA(),open:B,onOpenChange:F,onOpenToggle:Le.useCallback(()=>F(G=>!G),[F]),modal:o,children:He.jsx(h7,{...M,open:B,onOpenChange:F,dir:c,modal:o,children:s})})};Pj.displayName=mb;var Ij="DropdownMenuTrigger",Cj=Le.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,disabled:c=!1,...m}=t,v=Aj(Ij,s),T=el(s);return He.jsx(f7,{asChild:!0,...T,children:He.jsx(Qs.button,{type:"button",id:v.triggerId,"aria-haspopup":"menu","aria-expanded":v.open,"aria-controls":v.open?v.contentId:void 0,"data-state":v.open?"open":"closed","data-disabled":c?"":void 0,disabled:c,...m,ref:sb(r,v.triggerRef),onPointerDown:zi(t.onPointerDown,o=>{!c&&o.button===0&&o.ctrlKey===!1&&(v.onOpenToggle(),v.open||o.preventDefault())}),onKeyDown:zi(t.onKeyDown,o=>{c||(["Enter"," "].includes(o.key)&&v.onOpenToggle(),o.key==="ArrowDown"&&v.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(o.key)&&o.preventDefault())})})})});Cj.displayName=Ij;var I7="DropdownMenuPortal",Mj=t=>{const{__scopeDropdownMenu:r,...s}=t,c=el(r);return He.jsx(d7,{...c,...s})};Mj.displayName=I7;var Oj="DropdownMenuContent",Rj=Le.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...c}=t,m=Aj(Oj,s),v=el(s),T=Le.useRef(!1);return He.jsx(p7,{id:m.contentId,"aria-labelledby":m.triggerId,...v,...c,ref:r,onCloseAutoFocus:zi(t.onCloseAutoFocus,o=>{T.current||m.triggerRef.current?.focus(),T.current=!1,o.preventDefault()}),onInteractOutside:zi(t.onInteractOutside,o=>{const M=o.detail.originalEvent,R=M.button===0&&M.ctrlKey===!0,B=M.button===2||R;(!m.modal||B)&&(T.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Rj.displayName=Oj;var C7="DropdownMenuGroup",M7=Le.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...c}=t,m=el(s);return He.jsx(m7,{...m,...c,ref:r})});M7.displayName=C7;var O7="DropdownMenuLabel",R7=Le.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...c}=t,m=el(s);return He.jsx(g7,{...m,...c,ref:r})});R7.displayName=O7;var D7="DropdownMenuItem",k7=Le.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...c}=t,m=el(s);return He.jsx(_7,{...m,...c,ref:r})});k7.displayName=D7;var L7="DropdownMenuCheckboxItem",Dj=Le.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...c}=t,m=el(s);return He.jsx(y7,{...m,...c,ref:r})});Dj.displayName=L7;var z7="DropdownMenuRadioGroup",F7=Le.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...c}=t,m=el(s);return He.jsx(v7,{...m,...c,ref:r})});F7.displayName=z7;var B7="DropdownMenuRadioItem",N7=Le.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...c}=t,m=el(s);return He.jsx(x7,{...m,...c,ref:r})});N7.displayName=B7;var j7="DropdownMenuItemIndicator",kj=Le.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...c}=t,m=el(s);return He.jsx(b7,{...m,...c,ref:r})});kj.displayName=j7;var U7="DropdownMenuSeparator",V7=Le.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...c}=t,m=el(s);return He.jsx(w7,{...m,...c,ref:r})});V7.displayName=U7;var $7="DropdownMenuArrow",q7=Le.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...c}=t,m=el(s);return He.jsx(S7,{...m,...c,ref:r})});q7.displayName=$7;var G7="DropdownMenuSubTrigger",H7=Le.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...c}=t,m=el(s);return He.jsx(T7,{...m,...c,ref:r})});H7.displayName=G7;var W7="DropdownMenuSubContent",Z7=Le.forwardRef((t,r)=>{const{__scopeDropdownMenu:s,...c}=t,m=el(s);return He.jsx(E7,{...m,...c,ref:r,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Z7.displayName=W7;var X7=Pj,K7=Cj,Y7=Mj,J7=Rj,Q7=Dj,e9=kj;function t9({...t}){return He.jsx(X7,{"data-slot":"dropdown-menu",...t})}function r9({...t}){return He.jsx(K7,{"data-slot":"dropdown-menu-trigger",...t})}function n9({className:t,sideOffset:r=4,...s}){return He.jsx(Y7,{children:He.jsx(J7,{"data-slot":"dropdown-menu-content",sideOffset:r,className:Ku("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...s})})}function jx({className:t,children:r,checked:s,...c}){return He.jsxs(Q7,{"data-slot":"dropdown-menu-checkbox-item",className:Ku("focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),checked:s,...c,children:[He.jsx("span",{className:"pointer-events-none absolute left-2 flex size-3.5 items-center justify-center",children:He.jsx(e9,{children:He.jsx(B8,{className:"size-4"})})}),r]})}function i9({activeAuthors:t,activeTopics:r,onAuthorFilterChange:s,onTopicFilterChange:c}){const[m,v]=Le.useState(""),[T,o]=Le.useState("");return He.jsx("div",{className:"bg-white border-b border-border",children:He.jsxs("div",{className:"p-6",children:[He.jsx("h1",{className:"text-2xl font-semibold mb-6",children:"Resultados de la extracción"}),He.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[He.jsxs("div",{className:"flex items-center gap-4",children:[He.jsx("label",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"Autor"}),He.jsx("div",{className:"relative",children:He.jsxs(t9,{children:[He.jsx(r9,{asChild:!0,children:He.jsxs(Pp,{type:"button",variant:"outline",className:"relative pl-3 pr-8 text-sm bg-input-background border-0",children:[t==="all"?"Todos los autores":t,He.jsx(q8,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"})]})}),He.jsxs(n9,{align:"start",className:"w-48 z-50",children:[He.jsx(jx,{onClick:()=>s("all"),children:"Todos los autores"}),He.jsx(jx,{onClick:()=>s("author1"),children:"Autor 1"}),He.jsx(jx,{onClick:()=>s("author2"),children:"Autor 2"}),He.jsx(jx,{onClick:()=>s("author3"),children:"Autor 3"})]})]})}),He.jsx("label",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"Tema"}),He.jsxs("div",{className:"relative",children:[He.jsx(K8,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),He.jsx(vw,{placeholder:"Buscar Temas...",className:"pl-10 bg-input-background border-0",value:r,onChange:M=>c(M.target.value)})]})]}),He.jsxs("div",{className:"flex items-center gap-4",children:[He.jsxs("div",{className:"flex items-center gap-2",children:[He.jsx("label",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"Fecha inicial"}),He.jsxs("div",{className:"relative",children:[He.jsx(vw,{type:"date",value:m,onChange:M=>v(M.target.value),className:"w-40 bg-input-background border-0"}),He.jsx(xR,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"})]})]}),He.jsx(L8,{className:"w-4 h-4 text-muted-foreground"}),He.jsxs("div",{className:"flex items-center gap-2",children:[He.jsx("label",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"Fecha final"}),He.jsxs("div",{className:"relative",children:[He.jsx(vw,{type:"date",value:T,onChange:M=>o(M.target.value),className:"w-40 bg-input-background border-0"}),He.jsx(xR,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"})]})]})]})]})]})})}function Gg({className:t,...r}){return He.jsx("div",{"data-slot":"card",className:Ku("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",t),...r})}function Ux({title:t,value:r,percentage:s,showPercentageBadge:c,variant:m="default"}){return He.jsx(Gg,{className:`p-4 hover:shadow-md transition-shadow ${m==="accent"?"bg-accent/50":""}`,children:He.jsxs("div",{className:"space-y-1",children:[He.jsx("p",{className:"text-sm text-muted-foreground",children:t}),He.jsxs("div",{className:"flex items-baseline gap-2",children:[He.jsx("span",{className:"text-2xl font-semibold",children:r}),s&&He.jsx("span",{className:`text-sm ${c?"bg-muted px-2 py-1 rounded-full":"text-muted-foreground"}`,children:s})]})]})})}function o9(){return He.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[He.jsx(Ux,{title:"Total de estudios",value:"296",percentage:"100%"}),He.jsx(Ux,{title:"Autores",value:"30",percentage:"100%",showPercentageBadge:!0}),He.jsx(Ux,{title:"Lugares de afiliación de autores",value:"32",percentage:"100%"}),He.jsx(Ux,{title:"Otra cifra numérica",value:"8K",percentage:"+52%",variant:"accent"})]})}var Mw,JR;function El(){if(JR)return Mw;JR=1;var t=Array.isArray;return Mw=t,Mw}var Ow,QR;function Lj(){if(QR)return Ow;QR=1;var t=typeof Mx=="object"&&Mx&&Mx.Object===Object&&Mx;return Ow=t,Ow}var Rw,eD;function Yh(){if(eD)return Rw;eD=1;var t=Lj(),r=typeof self=="object"&&self&&self.Object===Object&&self,s=t||r||Function("return this")();return Rw=s,Rw}var Dw,tD;function Mv(){if(tD)return Dw;tD=1;var t=Yh(),r=t.Symbol;return Dw=r,Dw}var kw,rD;function a9(){if(rD)return kw;rD=1;var t=Mv(),r=Object.prototype,s=r.hasOwnProperty,c=r.toString,m=t?t.toStringTag:void 0;function v(T){var o=s.call(T,m),M=T[m];try{T[m]=void 0;var R=!0}catch{}var B=c.call(T);return R&&(o?T[m]=M:delete T[m]),B}return kw=v,kw}var Lw,nD;function s9(){if(nD)return Lw;nD=1;var t=Object.prototype,r=t.toString;function s(c){return r.call(c)}return Lw=s,Lw}var zw,iD;function hd(){if(iD)return zw;iD=1;var t=Mv(),r=a9(),s=s9(),c="[object Null]",m="[object Undefined]",v=t?t.toStringTag:void 0;function T(o){return o==null?o===void 0?m:c:v&&v in Object(o)?r(o):s(o)}return zw=T,zw}var Fw,oD;function fd(){if(oD)return Fw;oD=1;function t(r){return r!=null&&typeof r=="object"}return Fw=t,Fw}var Bw,aD;function x_(){if(aD)return Bw;aD=1;var t=hd(),r=fd(),s="[object Symbol]";function c(m){return typeof m=="symbol"||r(m)&&t(m)==s}return Bw=c,Bw}var Nw,sD;function IP(){if(sD)return Nw;sD=1;var t=El(),r=x_(),s=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,c=/^\w*$/;function m(v,T){if(t(v))return!1;var o=typeof v;return o=="number"||o=="symbol"||o=="boolean"||v==null||r(v)?!0:c.test(v)||!s.test(v)||T!=null&&v in Object(T)}return Nw=m,Nw}var jw,lD;function kp(){if(lD)return jw;lD=1;function t(r){var s=typeof r;return r!=null&&(s=="object"||s=="function")}return jw=t,jw}var Uw,cD;function CP(){if(cD)return Uw;cD=1;var t=hd(),r=kp(),s="[object AsyncFunction]",c="[object Function]",m="[object GeneratorFunction]",v="[object Proxy]";function T(o){if(!r(o))return!1;var M=t(o);return M==c||M==m||M==s||M==v}return Uw=T,Uw}var Vw,uD;function l9(){if(uD)return Vw;uD=1;var t=Yh(),r=t["__core-js_shared__"];return Vw=r,Vw}var $w,hD;function c9(){if(hD)return $w;hD=1;var t=l9(),r=(function(){var c=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""})();function s(c){return!!r&&r in c}return $w=s,$w}var qw,fD;function zj(){if(fD)return qw;fD=1;var t=Function.prototype,r=t.toString;function s(c){if(c!=null){try{return r.call(c)}catch{}try{return c+""}catch{}}return""}return qw=s,qw}var Gw,dD;function u9(){if(dD)return Gw;dD=1;var t=CP(),r=c9(),s=kp(),c=zj(),m=/[\\^$.*+?()[\]{}|]/g,v=/^\[object .+?Constructor\]$/,T=Function.prototype,o=Object.prototype,M=T.toString,R=o.hasOwnProperty,B=RegExp("^"+M.call(R).replace(m,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function F(G){if(!s(G)||r(G))return!1;var K=t(G)?B:v;return K.test(c(G))}return Gw=F,Gw}var Hw,pD;function h9(){if(pD)return Hw;pD=1;function t(r,s){return r?.[s]}return Hw=t,Hw}var Ww,mD;function Um(){if(mD)return Ww;mD=1;var t=u9(),r=h9();function s(c,m){var v=r(c,m);return t(v)?v:void 0}return Ww=s,Ww}var Zw,gD;function gb(){if(gD)return Zw;gD=1;var t=Um(),r=t(Object,"create");return Zw=r,Zw}var Xw,_D;function f9(){if(_D)return Xw;_D=1;var t=gb();function r(){this.__data__=t?t(null):{},this.size=0}return Xw=r,Xw}var Kw,yD;function d9(){if(yD)return Kw;yD=1;function t(r){var s=this.has(r)&&delete this.__data__[r];return this.size-=s?1:0,s}return Kw=t,Kw}var Yw,vD;function p9(){if(vD)return Yw;vD=1;var t=gb(),r="__lodash_hash_undefined__",s=Object.prototype,c=s.hasOwnProperty;function m(v){var T=this.__data__;if(t){var o=T[v];return o===r?void 0:o}return c.call(T,v)?T[v]:void 0}return Yw=m,Yw}var Jw,xD;function m9(){if(xD)return Jw;xD=1;var t=gb(),r=Object.prototype,s=r.hasOwnProperty;function c(m){var v=this.__data__;return t?v[m]!==void 0:s.call(v,m)}return Jw=c,Jw}var Qw,bD;function g9(){if(bD)return Qw;bD=1;var t=gb(),r="__lodash_hash_undefined__";function s(c,m){var v=this.__data__;return this.size+=this.has(c)?0:1,v[c]=t&&m===void 0?r:m,this}return Qw=s,Qw}var eS,wD;function _9(){if(wD)return eS;wD=1;var t=f9(),r=d9(),s=p9(),c=m9(),m=g9();function v(T){var o=-1,M=T==null?0:T.length;for(this.clear();++o<M;){var R=T[o];this.set(R[0],R[1])}}return v.prototype.clear=t,v.prototype.delete=r,v.prototype.get=s,v.prototype.has=c,v.prototype.set=m,eS=v,eS}var tS,SD;function y9(){if(SD)return tS;SD=1;function t(){this.__data__=[],this.size=0}return tS=t,tS}var rS,TD;function MP(){if(TD)return rS;TD=1;function t(r,s){return r===s||r!==r&&s!==s}return rS=t,rS}var nS,ED;function _b(){if(ED)return nS;ED=1;var t=MP();function r(s,c){for(var m=s.length;m--;)if(t(s[m][0],c))return m;return-1}return nS=r,nS}var iS,AD;function v9(){if(AD)return iS;AD=1;var t=_b(),r=Array.prototype,s=r.splice;function c(m){var v=this.__data__,T=t(v,m);if(T<0)return!1;var o=v.length-1;return T==o?v.pop():s.call(v,T,1),--this.size,!0}return iS=c,iS}var oS,PD;function x9(){if(PD)return oS;PD=1;var t=_b();function r(s){var c=this.__data__,m=t(c,s);return m<0?void 0:c[m][1]}return oS=r,oS}var aS,ID;function b9(){if(ID)return aS;ID=1;var t=_b();function r(s){return t(this.__data__,s)>-1}return aS=r,aS}var sS,CD;function w9(){if(CD)return sS;CD=1;var t=_b();function r(s,c){var m=this.__data__,v=t(m,s);return v<0?(++this.size,m.push([s,c])):m[v][1]=c,this}return sS=r,sS}var lS,MD;function yb(){if(MD)return lS;MD=1;var t=y9(),r=v9(),s=x9(),c=b9(),m=w9();function v(T){var o=-1,M=T==null?0:T.length;for(this.clear();++o<M;){var R=T[o];this.set(R[0],R[1])}}return v.prototype.clear=t,v.prototype.delete=r,v.prototype.get=s,v.prototype.has=c,v.prototype.set=m,lS=v,lS}var cS,OD;function OP(){if(OD)return cS;OD=1;var t=Um(),r=Yh(),s=t(r,"Map");return cS=s,cS}var uS,RD;function S9(){if(RD)return uS;RD=1;var t=_9(),r=yb(),s=OP();function c(){this.size=0,this.__data__={hash:new t,map:new(s||r),string:new t}}return uS=c,uS}var hS,DD;function T9(){if(DD)return hS;DD=1;function t(r){var s=typeof r;return s=="string"||s=="number"||s=="symbol"||s=="boolean"?r!=="__proto__":r===null}return hS=t,hS}var fS,kD;function vb(){if(kD)return fS;kD=1;var t=T9();function r(s,c){var m=s.__data__;return t(c)?m[typeof c=="string"?"string":"hash"]:m.map}return fS=r,fS}var dS,LD;function E9(){if(LD)return dS;LD=1;var t=vb();function r(s){var c=t(this,s).delete(s);return this.size-=c?1:0,c}return dS=r,dS}var pS,zD;function A9(){if(zD)return pS;zD=1;var t=vb();function r(s){return t(this,s).get(s)}return pS=r,pS}var mS,FD;function P9(){if(FD)return mS;FD=1;var t=vb();function r(s){return t(this,s).has(s)}return mS=r,mS}var gS,BD;function I9(){if(BD)return gS;BD=1;var t=vb();function r(s,c){var m=t(this,s),v=m.size;return m.set(s,c),this.size+=m.size==v?0:1,this}return gS=r,gS}var _S,ND;function RP(){if(ND)return _S;ND=1;var t=S9(),r=E9(),s=A9(),c=P9(),m=I9();function v(T){var o=-1,M=T==null?0:T.length;for(this.clear();++o<M;){var R=T[o];this.set(R[0],R[1])}}return v.prototype.clear=t,v.prototype.delete=r,v.prototype.get=s,v.prototype.has=c,v.prototype.set=m,_S=v,_S}var yS,jD;function Fj(){if(jD)return yS;jD=1;var t=RP(),r="Expected a function";function s(c,m){if(typeof c!="function"||m!=null&&typeof m!="function")throw new TypeError(r);var v=function(){var T=arguments,o=m?m.apply(this,T):T[0],M=v.cache;if(M.has(o))return M.get(o);var R=c.apply(this,T);return v.cache=M.set(o,R)||M,R};return v.cache=new(s.Cache||t),v}return s.Cache=t,yS=s,yS}var vS,UD;function C9(){if(UD)return vS;UD=1;var t=Fj(),r=500;function s(c){var m=t(c,function(T){return v.size===r&&v.clear(),T}),v=m.cache;return m}return vS=s,vS}var xS,VD;function M9(){if(VD)return xS;VD=1;var t=C9(),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,s=/\\(\\)?/g,c=t(function(m){var v=[];return m.charCodeAt(0)===46&&v.push(""),m.replace(r,function(T,o,M,R){v.push(M?R.replace(s,"$1"):o||T)}),v});return xS=c,xS}var bS,$D;function DP(){if($D)return bS;$D=1;function t(r,s){for(var c=-1,m=r==null?0:r.length,v=Array(m);++c<m;)v[c]=s(r[c],c,r);return v}return bS=t,bS}var wS,qD;function O9(){if(qD)return wS;qD=1;var t=Mv(),r=DP(),s=El(),c=x_(),m=t?t.prototype:void 0,v=m?m.toString:void 0;function T(o){if(typeof o=="string")return o;if(s(o))return r(o,T)+"";if(c(o))return v?v.call(o):"";var M=o+"";return M=="0"&&1/o==-1/0?"-0":M}return wS=T,wS}var SS,GD;function Bj(){if(GD)return SS;GD=1;var t=O9();function r(s){return s==null?"":t(s)}return SS=r,SS}var TS,HD;function Nj(){if(HD)return TS;HD=1;var t=El(),r=IP(),s=M9(),c=Bj();function m(v,T){return t(v)?v:r(v,T)?[v]:s(c(v))}return TS=m,TS}var ES,WD;function xb(){if(WD)return ES;WD=1;var t=x_();function r(s){if(typeof s=="string"||t(s))return s;var c=s+"";return c=="0"&&1/s==-1/0?"-0":c}return ES=r,ES}var AS,ZD;function kP(){if(ZD)return AS;ZD=1;var t=Nj(),r=xb();function s(c,m){m=t(m,c);for(var v=0,T=m.length;c!=null&&v<T;)c=c[r(m[v++])];return v&&v==T?c:void 0}return AS=s,AS}var PS,XD;function jj(){if(XD)return PS;XD=1;var t=kP();function r(s,c,m){var v=s==null?void 0:t(s,c);return v===void 0?m:v}return PS=r,PS}var R9=jj();const nc=Wi(R9);var IS,KD;function D9(){if(KD)return IS;KD=1;function t(r){return r==null}return IS=t,IS}var k9=D9();const bi=Wi(k9);var CS,YD;function L9(){if(YD)return CS;YD=1;var t=hd(),r=El(),s=fd(),c="[object String]";function m(v){return typeof v=="string"||!r(v)&&s(v)&&t(v)==c}return CS=m,CS}var z9=L9();const Dm=Wi(z9);var F9=CP();const Zn=Wi(F9);var B9=kp();const b_=Wi(B9);var MS={exports:{}},Xi={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var JD;function N9(){if(JD)return Xi;JD=1;var t=Symbol.for("react.element"),r=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),m=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),T=Symbol.for("react.context"),o=Symbol.for("react.server_context"),M=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),B=Symbol.for("react.suspense_list"),F=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),K=Symbol.for("react.offscreen"),ee;ee=Symbol.for("react.module.reference");function H(Z){if(typeof Z=="object"&&Z!==null){var ae=Z.$$typeof;switch(ae){case t:switch(Z=Z.type,Z){case s:case m:case c:case R:case B:return Z;default:switch(Z=Z&&Z.$$typeof,Z){case o:case T:case M:case G:case F:case v:return Z;default:return ae}}case r:return ae}}}return Xi.ContextConsumer=T,Xi.ContextProvider=v,Xi.Element=t,Xi.ForwardRef=M,Xi.Fragment=s,Xi.Lazy=G,Xi.Memo=F,Xi.Portal=r,Xi.Profiler=m,Xi.StrictMode=c,Xi.Suspense=R,Xi.SuspenseList=B,Xi.isAsyncMode=function(){return!1},Xi.isConcurrentMode=function(){return!1},Xi.isContextConsumer=function(Z){return H(Z)===T},Xi.isContextProvider=function(Z){return H(Z)===v},Xi.isElement=function(Z){return typeof Z=="object"&&Z!==null&&Z.$$typeof===t},Xi.isForwardRef=function(Z){return H(Z)===M},Xi.isFragment=function(Z){return H(Z)===s},Xi.isLazy=function(Z){return H(Z)===G},Xi.isMemo=function(Z){return H(Z)===F},Xi.isPortal=function(Z){return H(Z)===r},Xi.isProfiler=function(Z){return H(Z)===m},Xi.isStrictMode=function(Z){return H(Z)===c},Xi.isSuspense=function(Z){return H(Z)===R},Xi.isSuspenseList=function(Z){return H(Z)===B},Xi.isValidElementType=function(Z){return typeof Z=="string"||typeof Z=="function"||Z===s||Z===m||Z===c||Z===R||Z===B||Z===K||typeof Z=="object"&&Z!==null&&(Z.$$typeof===G||Z.$$typeof===F||Z.$$typeof===v||Z.$$typeof===T||Z.$$typeof===M||Z.$$typeof===ee||Z.getModuleId!==void 0)},Xi.typeOf=H,Xi}var QD;function j9(){return QD||(QD=1,MS.exports=N9()),MS.exports}var U9=j9(),OS,ek;function Uj(){if(ek)return OS;ek=1;var t=hd(),r=fd(),s="[object Number]";function c(m){return typeof m=="number"||r(m)&&t(m)==s}return OS=c,OS}var RS,tk;function V9(){if(tk)return RS;tk=1;var t=Uj();function r(s){return t(s)&&s!=+s}return RS=r,RS}var $9=V9();const Ov=Wi($9);var q9=Uj();const G9=Wi(q9);var Ks=function(r){return r===0?0:r>0?1:-1},Am=function(r){return Dm(r)&&r.indexOf("%")===r.length-1},kr=function(r){return G9(r)&&!Ov(r)},H9=function(r){return bi(r)},za=function(r){return kr(r)||Dm(r)},W9=0,Rv=function(r){var s=++W9;return"".concat(r||"").concat(s)},Ys=function(r,s){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!kr(r)&&!Dm(r))return c;var v;if(Am(r)){var T=r.indexOf("%");v=s*parseFloat(r.slice(0,T))/100}else v=+r;return Ov(v)&&(v=c),m&&v>s&&(v=s),v},Ap=function(r){if(!r)return null;var s=Object.keys(r);return s&&s.length?r[s[0]]:null},Z9=function(r){if(!Array.isArray(r))return!1;for(var s=r.length,c={},m=0;m<s;m++)if(!c[r[m]])c[r[m]]=!0;else return!0;return!1},Tp=function(r,s){return kr(r)&&kr(s)?function(c){return r+c*(s-r)}:function(){return s}};function $A(t,r,s){return!t||!t.length?null:t.find(function(c){return c&&(typeof r=="function"?r(c):nc(c,r))===s})}var X9=function(r,s){return kr(r)&&kr(s)?r-s:Dm(r)&&Dm(s)?r.localeCompare(s):r instanceof Date&&s instanceof Date?r.getTime()-s.getTime():String(r).localeCompare(String(s))};function jg(t,r){for(var s in t)if({}.hasOwnProperty.call(t,s)&&(!{}.hasOwnProperty.call(r,s)||t[s]!==r[s]))return!1;for(var c in r)if({}.hasOwnProperty.call(r,c)&&!{}.hasOwnProperty.call(t,c))return!1;return!0}function qA(t){"@babel/helpers - typeof";return qA=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},qA(t)}var K9=["viewBox","children"],Y9=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],rk=["points","pathLength"],DS={svg:K9,polygon:rk,polyline:rk},LP=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],f0=function(r,s){if(!r||typeof r=="function"||typeof r=="boolean")return null;var c=r;if(Le.isValidElement(r)&&(c=r.props),!b_(c))return null;var m={};return Object.keys(c).forEach(function(v){LP.includes(v)&&(m[v]=s||function(T){return c[v](c,T)})}),m},J9=function(r,s,c){return function(m){return r(s,c,m),null}},km=function(r,s,c){if(!b_(r)||qA(r)!=="object")return null;var m=null;return Object.keys(r).forEach(function(v){var T=r[v];LP.includes(v)&&typeof T=="function"&&(m||(m={}),m[v]=J9(T,s,c))}),m},Q9=["children"],eZ=["children"];function nk(t,r){if(t==null)return{};var s=tZ(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function tZ(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}var ik={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},td=function(r){return typeof r=="string"?r:r?r.displayName||r.name||"Component":""},ok=null,kS=null,zP=function t(r){if(r===ok&&Array.isArray(kS))return kS;var s=[];return Le.Children.forEach(r,function(c){bi(c)||(U9.isFragment(c)?s=s.concat(t(c.props.children)):s.push(c))}),kS=s,ok=r,s};function Xc(t,r){var s=[],c=[];return Array.isArray(r)?c=r.map(function(m){return td(m)}):c=[td(r)],zP(t).forEach(function(m){var v=nc(m,"type.displayName")||nc(m,"type.name");c.indexOf(v)!==-1&&s.push(m)}),s}function Ql(t,r){var s=Xc(t,r);return s&&s[0]}var ak=function(r){if(!r||!r.props)return!1;var s=r.props,c=s.width,m=s.height;return!(!kr(c)||c<=0||!kr(m)||m<=0)},rZ=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],nZ=function(r){return r&&r.type&&Dm(r.type)&&rZ.indexOf(r.type)>=0},iZ=function(r,s,c,m){var v,T=(v=DS?.[m])!==null&&v!==void 0?v:[];return s.startsWith("data-")||!Zn(r)&&(m&&T.includes(s)||Y9.includes(s))||c&&LP.includes(s)},Vn=function(r,s,c){if(!r||typeof r=="function"||typeof r=="boolean")return null;var m=r;if(Le.isValidElement(r)&&(m=r.props),!b_(m))return null;var v={};return Object.keys(m).forEach(function(T){var o;iZ((o=m)===null||o===void 0?void 0:o[T],T,s,c)&&(v[T]=m[T])}),v},GA=function t(r,s){if(r===s)return!0;var c=Le.Children.count(r);if(c!==Le.Children.count(s))return!1;if(c===0)return!0;if(c===1)return sk(Array.isArray(r)?r[0]:r,Array.isArray(s)?s[0]:s);for(var m=0;m<c;m++){var v=r[m],T=s[m];if(Array.isArray(v)||Array.isArray(T)){if(!t(v,T))return!1}else if(!sk(v,T))return!1}return!0},sk=function(r,s){if(bi(r)&&bi(s))return!0;if(!bi(r)&&!bi(s)){var c=r.props||{},m=c.children,v=nk(c,Q9),T=s.props||{},o=T.children,M=nk(T,eZ);return m&&o?jg(v,M)&&GA(m,o):!m&&!o?jg(v,M):!1}return!1},lk=function(r,s){var c=[],m={};return zP(r).forEach(function(v,T){if(nZ(v))c.push(v);else if(v){var o=td(v.type),M=s[o]||{},R=M.handler,B=M.once;if(R&&(!B||!m[o])){var F=R(v,o,T);c.push(F),m[o]=!0}}}),c},oZ=function(r){var s=r&&r.type;return s&&ik[s]?ik[s]:null},aZ=function(r,s){return zP(s).indexOf(r)},sZ=["children","width","height","viewBox","className","style","title","desc"];function HA(){return HA=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},HA.apply(this,arguments)}function lZ(t,r){if(t==null)return{};var s=cZ(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function cZ(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}function WA(t){var r=t.children,s=t.width,c=t.height,m=t.viewBox,v=t.className,T=t.style,o=t.title,M=t.desc,R=lZ(t,sZ),B=m||{width:s,height:c,x:0,y:0},F=ci("recharts-surface",v);return ht.createElement("svg",HA({},Vn(R,!0,"svg"),{className:F,width:s,height:c,style:T,viewBox:"".concat(B.x," ").concat(B.y," ").concat(B.width," ").concat(B.height)}),ht.createElement("title",null,o),ht.createElement("desc",null,M),r)}var uZ=["children","className"];function ZA(){return ZA=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},ZA.apply(this,arguments)}function hZ(t,r){if(t==null)return{};var s=fZ(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function fZ(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}var to=ht.forwardRef(function(t,r){var s=t.children,c=t.className,m=hZ(t,uZ),v=ci("recharts-layer",c);return ht.createElement("g",ZA({className:v},Vn(m,!0),{ref:r}),s)}),Wu=function(r,s){for(var c=arguments.length,m=new Array(c>2?c-2:0),v=2;v<c;v++)m[v-2]=arguments[v]},LS,ck;function dZ(){if(ck)return LS;ck=1;function t(r,s,c){var m=-1,v=r.length;s<0&&(s=-s>v?0:v+s),c=c>v?v:c,c<0&&(c+=v),v=s>c?0:c-s>>>0,s>>>=0;for(var T=Array(v);++m<v;)T[m]=r[m+s];return T}return LS=t,LS}var zS,uk;function pZ(){if(uk)return zS;uk=1;var t=dZ();function r(s,c,m){var v=s.length;return m=m===void 0?v:m,!c&&m>=v?s:t(s,c,m)}return zS=r,zS}var FS,hk;function Vj(){if(hk)return FS;hk=1;var t="\\ud800-\\udfff",r="\\u0300-\\u036f",s="\\ufe20-\\ufe2f",c="\\u20d0-\\u20ff",m=r+s+c,v="\\ufe0e\\ufe0f",T="\\u200d",o=RegExp("["+T+t+m+v+"]");function M(R){return o.test(R)}return FS=M,FS}var BS,fk;function mZ(){if(fk)return BS;fk=1;function t(r){return r.split("")}return BS=t,BS}var NS,dk;function gZ(){if(dk)return NS;dk=1;var t="\\ud800-\\udfff",r="\\u0300-\\u036f",s="\\ufe20-\\ufe2f",c="\\u20d0-\\u20ff",m=r+s+c,v="\\ufe0e\\ufe0f",T="["+t+"]",o="["+m+"]",M="\\ud83c[\\udffb-\\udfff]",R="(?:"+o+"|"+M+")",B="[^"+t+"]",F="(?:\\ud83c[\\udde6-\\uddff]){2}",G="[\\ud800-\\udbff][\\udc00-\\udfff]",K="\\u200d",ee=R+"?",H="["+v+"]?",Z="(?:"+K+"(?:"+[B,F,G].join("|")+")"+H+ee+")*",ae=H+ee+Z,fe="(?:"+[B+o+"?",o,F,G,T].join("|")+")",ue=RegExp(M+"(?="+M+")|"+fe+ae,"g");function _e(le){return le.match(ue)||[]}return NS=_e,NS}var jS,pk;function _Z(){if(pk)return jS;pk=1;var t=mZ(),r=Vj(),s=gZ();function c(m){return r(m)?s(m):t(m)}return jS=c,jS}var US,mk;function yZ(){if(mk)return US;mk=1;var t=pZ(),r=Vj(),s=_Z(),c=Bj();function m(v){return function(T){T=c(T);var o=r(T)?s(T):void 0,M=o?o[0]:T.charAt(0),R=o?t(o,1).join(""):T.slice(1);return M[v]()+R}}return US=m,US}var VS,gk;function vZ(){if(gk)return VS;gk=1;var t=yZ(),r=t("toUpperCase");return VS=r,VS}var xZ=vZ();const bb=Wi(xZ);function yo(t){return function(){return t}}const $j=Math.cos,d0=Math.sin,Yu=Math.sqrt,p0=Math.PI,wb=2*p0,XA=Math.PI,KA=2*XA,Sm=1e-6,bZ=KA-Sm;function qj(t){this._+=t[0];for(let r=1,s=t.length;r<s;++r)this._+=arguments[r]+t[r]}function wZ(t){let r=Math.floor(t);if(!(r>=0))throw new Error(`invalid digits: ${t}`);if(r>15)return qj;const s=10**r;return function(c){this._+=c[0];for(let m=1,v=c.length;m<v;++m)this._+=Math.round(arguments[m]*s)/s+c[m]}}class SZ{constructor(r){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=r==null?qj:wZ(r)}moveTo(r,s){this._append`M${this._x0=this._x1=+r},${this._y0=this._y1=+s}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(r,s){this._append`L${this._x1=+r},${this._y1=+s}`}quadraticCurveTo(r,s,c,m){this._append`Q${+r},${+s},${this._x1=+c},${this._y1=+m}`}bezierCurveTo(r,s,c,m,v,T){this._append`C${+r},${+s},${+c},${+m},${this._x1=+v},${this._y1=+T}`}arcTo(r,s,c,m,v){if(r=+r,s=+s,c=+c,m=+m,v=+v,v<0)throw new Error(`negative radius: ${v}`);let T=this._x1,o=this._y1,M=c-r,R=m-s,B=T-r,F=o-s,G=B*B+F*F;if(this._x1===null)this._append`M${this._x1=r},${this._y1=s}`;else if(G>Sm)if(!(Math.abs(F*M-R*B)>Sm)||!v)this._append`L${this._x1=r},${this._y1=s}`;else{let K=c-T,ee=m-o,H=M*M+R*R,Z=K*K+ee*ee,ae=Math.sqrt(H),fe=Math.sqrt(G),ue=v*Math.tan((XA-Math.acos((H+G-Z)/(2*ae*fe)))/2),_e=ue/fe,le=ue/ae;Math.abs(_e-1)>Sm&&this._append`L${r+_e*B},${s+_e*F}`,this._append`A${v},${v},0,0,${+(F*K>B*ee)},${this._x1=r+le*M},${this._y1=s+le*R}`}}arc(r,s,c,m,v,T){if(r=+r,s=+s,c=+c,T=!!T,c<0)throw new Error(`negative radius: ${c}`);let o=c*Math.cos(m),M=c*Math.sin(m),R=r+o,B=s+M,F=1^T,G=T?m-v:v-m;this._x1===null?this._append`M${R},${B}`:(Math.abs(this._x1-R)>Sm||Math.abs(this._y1-B)>Sm)&&this._append`L${R},${B}`,c&&(G<0&&(G=G%KA+KA),G>bZ?this._append`A${c},${c},0,1,${F},${r-o},${s-M}A${c},${c},0,1,${F},${this._x1=R},${this._y1=B}`:G>Sm&&this._append`A${c},${c},0,${+(G>=XA)},${F},${this._x1=r+c*Math.cos(v)},${this._y1=s+c*Math.sin(v)}`)}rect(r,s,c,m){this._append`M${this._x0=this._x1=+r},${this._y0=this._y1=+s}h${c=+c}v${+m}h${-c}Z`}toString(){return this._}}function FP(t){let r=3;return t.digits=function(s){if(!arguments.length)return r;if(s==null)r=null;else{const c=Math.floor(s);if(!(c>=0))throw new RangeError(`invalid digits: ${s}`);r=c}return t},()=>new SZ(r)}function BP(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Gj(t){this._context=t}Gj.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,r){switch(t=+t,r=+r,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break;case 1:this._point=2;default:this._context.lineTo(t,r);break}}};function Sb(t){return new Gj(t)}function Hj(t){return t[0]}function Wj(t){return t[1]}function Zj(t,r){var s=yo(!0),c=null,m=Sb,v=null,T=FP(o);t=typeof t=="function"?t:t===void 0?Hj:yo(t),r=typeof r=="function"?r:r===void 0?Wj:yo(r);function o(M){var R,B=(M=BP(M)).length,F,G=!1,K;for(c==null&&(v=m(K=T())),R=0;R<=B;++R)!(R<B&&s(F=M[R],R,M))===G&&((G=!G)?v.lineStart():v.lineEnd()),G&&v.point(+t(F,R,M),+r(F,R,M));if(K)return v=null,K+""||null}return o.x=function(M){return arguments.length?(t=typeof M=="function"?M:yo(+M),o):t},o.y=function(M){return arguments.length?(r=typeof M=="function"?M:yo(+M),o):r},o.defined=function(M){return arguments.length?(s=typeof M=="function"?M:yo(!!M),o):s},o.curve=function(M){return arguments.length?(m=M,c!=null&&(v=m(c)),o):m},o.context=function(M){return arguments.length?(M==null?c=v=null:v=m(c=M),o):c},o}function Vx(t,r,s){var c=null,m=yo(!0),v=null,T=Sb,o=null,M=FP(R);t=typeof t=="function"?t:t===void 0?Hj:yo(+t),r=typeof r=="function"?r:yo(r===void 0?0:+r),s=typeof s=="function"?s:s===void 0?Wj:yo(+s);function R(F){var G,K,ee,H=(F=BP(F)).length,Z,ae=!1,fe,ue=new Array(H),_e=new Array(H);for(v==null&&(o=T(fe=M())),G=0;G<=H;++G){if(!(G<H&&m(Z=F[G],G,F))===ae)if(ae=!ae)K=G,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),ee=G-1;ee>=K;--ee)o.point(ue[ee],_e[ee]);o.lineEnd(),o.areaEnd()}ae&&(ue[G]=+t(Z,G,F),_e[G]=+r(Z,G,F),o.point(c?+c(Z,G,F):ue[G],s?+s(Z,G,F):_e[G]))}if(fe)return o=null,fe+""||null}function B(){return Zj().defined(m).curve(T).context(v)}return R.x=function(F){return arguments.length?(t=typeof F=="function"?F:yo(+F),c=null,R):t},R.x0=function(F){return arguments.length?(t=typeof F=="function"?F:yo(+F),R):t},R.x1=function(F){return arguments.length?(c=F==null?null:typeof F=="function"?F:yo(+F),R):c},R.y=function(F){return arguments.length?(r=typeof F=="function"?F:yo(+F),s=null,R):r},R.y0=function(F){return arguments.length?(r=typeof F=="function"?F:yo(+F),R):r},R.y1=function(F){return arguments.length?(s=F==null?null:typeof F=="function"?F:yo(+F),R):s},R.lineX0=R.lineY0=function(){return B().x(t).y(r)},R.lineY1=function(){return B().x(t).y(s)},R.lineX1=function(){return B().x(c).y(r)},R.defined=function(F){return arguments.length?(m=typeof F=="function"?F:yo(!!F),R):m},R.curve=function(F){return arguments.length?(T=F,v!=null&&(o=T(v)),R):T},R.context=function(F){return arguments.length?(F==null?v=o=null:o=T(v=F),R):v},R}class Xj{constructor(r,s){this._context=r,this._x=s}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(r,s){switch(r=+r,s=+s,this._point){case 0:{this._point=1,this._line?this._context.lineTo(r,s):this._context.moveTo(r,s);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+r)/2,this._y0,this._x0,s,r,s):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+s)/2,r,this._y0,r,s);break}}this._x0=r,this._y0=s}}function TZ(t){return new Xj(t,!0)}function EZ(t){return new Xj(t,!1)}const NP={draw(t,r){const s=Yu(r/p0);t.moveTo(s,0),t.arc(0,0,s,0,wb)}},AZ={draw(t,r){const s=Yu(r/5)/2;t.moveTo(-3*s,-s),t.lineTo(-s,-s),t.lineTo(-s,-3*s),t.lineTo(s,-3*s),t.lineTo(s,-s),t.lineTo(3*s,-s),t.lineTo(3*s,s),t.lineTo(s,s),t.lineTo(s,3*s),t.lineTo(-s,3*s),t.lineTo(-s,s),t.lineTo(-3*s,s),t.closePath()}},Kj=Yu(1/3),PZ=Kj*2,IZ={draw(t,r){const s=Yu(r/PZ),c=s*Kj;t.moveTo(0,-s),t.lineTo(c,0),t.lineTo(0,s),t.lineTo(-c,0),t.closePath()}},CZ={draw(t,r){const s=Yu(r),c=-s/2;t.rect(c,c,s,s)}},MZ=.8908130915292852,Yj=d0(p0/10)/d0(7*p0/10),OZ=d0(wb/10)*Yj,RZ=-$j(wb/10)*Yj,DZ={draw(t,r){const s=Yu(r*MZ),c=OZ*s,m=RZ*s;t.moveTo(0,-s),t.lineTo(c,m);for(let v=1;v<5;++v){const T=wb*v/5,o=$j(T),M=d0(T);t.lineTo(M*s,-o*s),t.lineTo(o*c-M*m,M*c+o*m)}t.closePath()}},$S=Yu(3),kZ={draw(t,r){const s=-Yu(r/($S*3));t.moveTo(0,s*2),t.lineTo(-$S*s,-s),t.lineTo($S*s,-s),t.closePath()}},$c=-.5,qc=Yu(3)/2,YA=1/Yu(12),LZ=(YA/2+1)*3,zZ={draw(t,r){const s=Yu(r/LZ),c=s/2,m=s*YA,v=c,T=s*YA+s,o=-v,M=T;t.moveTo(c,m),t.lineTo(v,T),t.lineTo(o,M),t.lineTo($c*c-qc*m,qc*c+$c*m),t.lineTo($c*v-qc*T,qc*v+$c*T),t.lineTo($c*o-qc*M,qc*o+$c*M),t.lineTo($c*c+qc*m,$c*m-qc*c),t.lineTo($c*v+qc*T,$c*T-qc*v),t.lineTo($c*o+qc*M,$c*M-qc*o),t.closePath()}};function FZ(t,r){let s=null,c=FP(m);t=typeof t=="function"?t:yo(t||NP),r=typeof r=="function"?r:yo(r===void 0?64:+r);function m(){let v;if(s||(s=v=c()),t.apply(this,arguments).draw(s,+r.apply(this,arguments)),v)return s=null,v+""||null}return m.type=function(v){return arguments.length?(t=typeof v=="function"?v:yo(v),m):t},m.size=function(v){return arguments.length?(r=typeof v=="function"?v:yo(+v),m):r},m.context=function(v){return arguments.length?(s=v??null,m):s},m}function m0(){}function g0(t,r,s){t._context.bezierCurveTo((2*t._x0+t._x1)/3,(2*t._y0+t._y1)/3,(t._x0+2*t._x1)/3,(t._y0+2*t._y1)/3,(t._x0+4*t._x1+r)/6,(t._y0+4*t._y1+s)/6)}function Jj(t){this._context=t}Jj.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:g0(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,r){switch(t=+t,r=+r,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:g0(this,t,r);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=r}};function BZ(t){return new Jj(t)}function Qj(t){this._context=t}Qj.prototype={areaStart:m0,areaEnd:m0,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(t,r){switch(t=+t,r=+r,this._point){case 0:this._point=1,this._x2=t,this._y2=r;break;case 1:this._point=2,this._x3=t,this._y3=r;break;case 2:this._point=3,this._x4=t,this._y4=r,this._context.moveTo((this._x0+4*this._x1+t)/6,(this._y0+4*this._y1+r)/6);break;default:g0(this,t,r);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=r}};function NZ(t){return new Qj(t)}function e5(t){this._context=t}e5.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(t,r){switch(t=+t,r=+r,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var s=(this._x0+4*this._x1+t)/6,c=(this._y0+4*this._y1+r)/6;this._line?this._context.lineTo(s,c):this._context.moveTo(s,c);break;case 3:this._point=4;default:g0(this,t,r);break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=r}};function jZ(t){return new e5(t)}function t5(t){this._context=t}t5.prototype={areaStart:m0,areaEnd:m0,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(t,r){t=+t,r=+r,this._point?this._context.lineTo(t,r):(this._point=1,this._context.moveTo(t,r))}};function UZ(t){return new t5(t)}function _k(t){return t<0?-1:1}function yk(t,r,s){var c=t._x1-t._x0,m=r-t._x1,v=(t._y1-t._y0)/(c||m<0&&-0),T=(s-t._y1)/(m||c<0&&-0),o=(v*m+T*c)/(c+m);return(_k(v)+_k(T))*Math.min(Math.abs(v),Math.abs(T),.5*Math.abs(o))||0}function vk(t,r){var s=t._x1-t._x0;return s?(3*(t._y1-t._y0)/s-r)/2:r}function qS(t,r,s){var c=t._x0,m=t._y0,v=t._x1,T=t._y1,o=(v-c)/3;t._context.bezierCurveTo(c+o,m+o*r,v-o,T-o*s,v,T)}function _0(t){this._context=t}_0.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:qS(this,this._t0,vk(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,r){var s=NaN;if(t=+t,r=+r,!(t===this._x1&&r===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break;case 1:this._point=2;break;case 2:this._point=3,qS(this,vk(this,s=yk(this,t,r)),s);break;default:qS(this,this._t0,s=yk(this,t,r));break}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=r,this._t0=s}}};function r5(t){this._context=new n5(t)}(r5.prototype=Object.create(_0.prototype)).point=function(t,r){_0.prototype.point.call(this,r,t)};function n5(t){this._context=t}n5.prototype={moveTo:function(t,r){this._context.moveTo(r,t)},closePath:function(){this._context.closePath()},lineTo:function(t,r){this._context.lineTo(r,t)},bezierCurveTo:function(t,r,s,c,m,v){this._context.bezierCurveTo(r,t,c,s,v,m)}};function VZ(t){return new _0(t)}function $Z(t){return new r5(t)}function i5(t){this._context=t}i5.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var t=this._x,r=this._y,s=t.length;if(s)if(this._line?this._context.lineTo(t[0],r[0]):this._context.moveTo(t[0],r[0]),s===2)this._context.lineTo(t[1],r[1]);else for(var c=xk(t),m=xk(r),v=0,T=1;T<s;++v,++T)this._context.bezierCurveTo(c[0][v],m[0][v],c[1][v],m[1][v],t[T],r[T]);(this._line||this._line!==0&&s===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(t,r){this._x.push(+t),this._y.push(+r)}};function xk(t){var r,s=t.length-1,c,m=new Array(s),v=new Array(s),T=new Array(s);for(m[0]=0,v[0]=2,T[0]=t[0]+2*t[1],r=1;r<s-1;++r)m[r]=1,v[r]=4,T[r]=4*t[r]+2*t[r+1];for(m[s-1]=2,v[s-1]=7,T[s-1]=8*t[s-1]+t[s],r=1;r<s;++r)c=m[r]/v[r-1],v[r]-=c,T[r]-=c*T[r-1];for(m[s-1]=T[s-1]/v[s-1],r=s-2;r>=0;--r)m[r]=(T[r]-m[r+1])/v[r];for(v[s-1]=(t[s]+m[s-1])/2,r=0;r<s-1;++r)v[r]=2*t[r+1]-m[r+1];return[m,v]}function qZ(t){return new i5(t)}function Tb(t,r){this._context=t,this._t=r}Tb.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(t,r){switch(t=+t,r=+r,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,r),this._context.lineTo(t,r);else{var s=this._x*(1-this._t)+t*this._t;this._context.lineTo(s,this._y),this._context.lineTo(s,r)}break}}this._x=t,this._y=r}};function GZ(t){return new Tb(t,.5)}function HZ(t){return new Tb(t,0)}function WZ(t){return new Tb(t,1)}function Hg(t,r){if((T=t.length)>1)for(var s=1,c,m,v=t[r[0]],T,o=v.length;s<T;++s)for(m=v,v=t[r[s]],c=0;c<o;++c)v[c][1]+=v[c][0]=isNaN(m[c][1])?m[c][0]:m[c][1]}function JA(t){for(var r=t.length,s=new Array(r);--r>=0;)s[r]=r;return s}function ZZ(t,r){return t[r]}function XZ(t){const r=[];return r.key=t,r}function KZ(){var t=yo([]),r=JA,s=Hg,c=ZZ;function m(v){var T=Array.from(t.apply(this,arguments),XZ),o,M=T.length,R=-1,B;for(const F of v)for(o=0,++R;o<M;++o)(T[o][R]=[0,+c(F,T[o].key,R,v)]).data=F;for(o=0,B=BP(r(T));o<M;++o)T[B[o]].index=o;return s(T,B),T}return m.keys=function(v){return arguments.length?(t=typeof v=="function"?v:yo(Array.from(v)),m):t},m.value=function(v){return arguments.length?(c=typeof v=="function"?v:yo(+v),m):c},m.order=function(v){return arguments.length?(r=v==null?JA:typeof v=="function"?v:yo(Array.from(v)),m):r},m.offset=function(v){return arguments.length?(s=v??Hg,m):s},m}function YZ(t,r){if((c=t.length)>0){for(var s,c,m=0,v=t[0].length,T;m<v;++m){for(T=s=0;s<c;++s)T+=t[s][m][1]||0;if(T)for(s=0;s<c;++s)t[s][m][1]/=T}Hg(t,r)}}function JZ(t,r){if((m=t.length)>0){for(var s=0,c=t[r[0]],m,v=c.length;s<v;++s){for(var T=0,o=0;T<m;++T)o+=t[T][s][1]||0;c[s][1]+=c[s][0]=-o/2}Hg(t,r)}}function QZ(t,r){if(!(!((T=t.length)>0)||!((v=(m=t[r[0]]).length)>0))){for(var s=0,c=1,m,v,T;c<v;++c){for(var o=0,M=0,R=0;o<T;++o){for(var B=t[r[o]],F=B[c][1]||0,G=B[c-1][1]||0,K=(F-G)/2,ee=0;ee<o;++ee){var H=t[r[ee]],Z=H[c][1]||0,ae=H[c-1][1]||0;K+=Z-ae}M+=F,R+=K*F}m[c-1][1]+=m[c-1][0]=s,M&&(s-=R/M)}m[c-1][1]+=m[c-1][0]=s,Hg(t,r)}}function $y(t){"@babel/helpers - typeof";return $y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},$y(t)}var eX=["type","size","sizeType"];function QA(){return QA=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},QA.apply(this,arguments)}function bk(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function wk(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?bk(Object(s),!0).forEach(function(c){tX(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):bk(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function tX(t,r,s){return r=rX(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function rX(t){var r=nX(t,"string");return $y(r)=="symbol"?r:r+""}function nX(t,r){if($y(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if($y(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function iX(t,r){if(t==null)return{};var s=oX(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function oX(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}var o5={symbolCircle:NP,symbolCross:AZ,symbolDiamond:IZ,symbolSquare:CZ,symbolStar:DZ,symbolTriangle:kZ,symbolWye:zZ},aX=Math.PI/180,sX=function(r){var s="symbol".concat(bb(r));return o5[s]||NP},lX=function(r,s,c){if(s==="area")return r;switch(c){case"cross":return 5*r*r/9;case"diamond":return .5*r*r/Math.sqrt(3);case"square":return r*r;case"star":{var m=18*aX;return 1.25*r*r*(Math.tan(m)-Math.tan(m*2)*Math.pow(Math.tan(m),2))}case"triangle":return Math.sqrt(3)*r*r/4;case"wye":return(21-10*Math.sqrt(3))*r*r/8;default:return Math.PI*r*r/4}},cX=function(r,s){o5["symbol".concat(bb(r))]=s},jP=function(r){var s=r.type,c=s===void 0?"circle":s,m=r.size,v=m===void 0?64:m,T=r.sizeType,o=T===void 0?"area":T,M=iX(r,eX),R=wk(wk({},M),{},{type:c,size:v,sizeType:o}),B=function(){var Z=sX(c),ae=FZ().type(Z).size(lX(v,o,c));return ae()},F=R.className,G=R.cx,K=R.cy,ee=Vn(R,!0);return G===+G&&K===+K&&v===+v?ht.createElement("path",QA({},ee,{className:ci("recharts-symbols",F),transform:"translate(".concat(G,", ").concat(K,")"),d:B()})):null};jP.registerSymbol=cX;function Wg(t){"@babel/helpers - typeof";return Wg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Wg(t)}function e2(){return e2=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},e2.apply(this,arguments)}function Sk(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function uX(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Sk(Object(s),!0).forEach(function(c){qy(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Sk(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function hX(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function fX(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,s5(c.key),c)}}function dX(t,r,s){return r&&fX(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function pX(t,r,s){return r=y0(r),mX(t,a5()?Reflect.construct(r,s||[],y0(t).constructor):r.apply(t,s))}function mX(t,r){if(r&&(Wg(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gX(t)}function gX(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function a5(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(a5=function(){return!!t})()}function y0(t){return y0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},y0(t)}function _X(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&t2(t,r)}function t2(t,r){return t2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},t2(t,r)}function qy(t,r,s){return r=s5(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function s5(t){var r=yX(t,"string");return Wg(r)=="symbol"?r:r+""}function yX(t,r){if(Wg(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(Wg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Gc=32,UP=(function(t){function r(){return hX(this,r),pX(this,r,arguments)}return _X(r,t),dX(r,[{key:"renderIcon",value:function(c){var m=this.props.inactiveColor,v=Gc/2,T=Gc/6,o=Gc/3,M=c.inactive?m:c.color;if(c.type==="plainline")return ht.createElement("line",{strokeWidth:4,fill:"none",stroke:M,strokeDasharray:c.payload.strokeDasharray,x1:0,y1:v,x2:Gc,y2:v,className:"recharts-legend-icon"});if(c.type==="line")return ht.createElement("path",{strokeWidth:4,fill:"none",stroke:M,d:"M0,".concat(v,"h").concat(o,`
            A`).concat(T,",").concat(T,",0,1,1,").concat(2*o,",").concat(v,`
            H`).concat(Gc,"M").concat(2*o,",").concat(v,`
            A`).concat(T,",").concat(T,",0,1,1,").concat(o,",").concat(v),className:"recharts-legend-icon"});if(c.type==="rect")return ht.createElement("path",{stroke:"none",fill:M,d:"M0,".concat(Gc/8,"h").concat(Gc,"v").concat(Gc*3/4,"h").concat(-Gc,"z"),className:"recharts-legend-icon"});if(ht.isValidElement(c.legendIcon)){var R=uX({},c);return delete R.legendIcon,ht.cloneElement(c.legendIcon,R)}return ht.createElement(jP,{fill:M,cx:v,cy:v,size:Gc,sizeType:"diameter",type:c.type})}},{key:"renderItems",value:function(){var c=this,m=this.props,v=m.payload,T=m.iconSize,o=m.layout,M=m.formatter,R=m.inactiveColor,B={x:0,y:0,width:Gc,height:Gc},F={display:o==="horizontal"?"inline-block":"block",marginRight:10},G={display:"inline-block",verticalAlign:"middle",marginRight:4};return v.map(function(K,ee){var H=K.formatter||M,Z=ci(qy(qy({"recharts-legend-item":!0},"legend-item-".concat(ee),!0),"inactive",K.inactive));if(K.type==="none")return null;var ae=Zn(K.value)?null:K.value;Wu(!Zn(K.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var fe=K.inactive?R:K.color;return ht.createElement("li",e2({className:Z,style:F,key:"legend-item-".concat(ee)},km(c.props,K,ee)),ht.createElement(WA,{width:T,height:T,viewBox:B,style:G},c.renderIcon(K)),ht.createElement("span",{className:"recharts-legend-item-text",style:{color:fe}},H?H(ae,K,ee):ae))})}},{key:"render",value:function(){var c=this.props,m=c.payload,v=c.layout,T=c.align;if(!m||!m.length)return null;var o={padding:0,margin:0,textAlign:v==="horizontal"?T:"left"};return ht.createElement("ul",{className:"recharts-default-legend",style:o},this.renderItems())}}])})(Le.PureComponent);qy(UP,"displayName","Legend");qy(UP,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var GS,Tk;function vX(){if(Tk)return GS;Tk=1;var t=yb();function r(){this.__data__=new t,this.size=0}return GS=r,GS}var HS,Ek;function xX(){if(Ek)return HS;Ek=1;function t(r){var s=this.__data__,c=s.delete(r);return this.size=s.size,c}return HS=t,HS}var WS,Ak;function bX(){if(Ak)return WS;Ak=1;function t(r){return this.__data__.get(r)}return WS=t,WS}var ZS,Pk;function wX(){if(Pk)return ZS;Pk=1;function t(r){return this.__data__.has(r)}return ZS=t,ZS}var XS,Ik;function SX(){if(Ik)return XS;Ik=1;var t=yb(),r=OP(),s=RP(),c=200;function m(v,T){var o=this.__data__;if(o instanceof t){var M=o.__data__;if(!r||M.length<c-1)return M.push([v,T]),this.size=++o.size,this;o=this.__data__=new s(M)}return o.set(v,T),this.size=o.size,this}return XS=m,XS}var KS,Ck;function l5(){if(Ck)return KS;Ck=1;var t=yb(),r=vX(),s=xX(),c=bX(),m=wX(),v=SX();function T(o){var M=this.__data__=new t(o);this.size=M.size}return T.prototype.clear=r,T.prototype.delete=s,T.prototype.get=c,T.prototype.has=m,T.prototype.set=v,KS=T,KS}var YS,Mk;function TX(){if(Mk)return YS;Mk=1;var t="__lodash_hash_undefined__";function r(s){return this.__data__.set(s,t),this}return YS=r,YS}var JS,Ok;function EX(){if(Ok)return JS;Ok=1;function t(r){return this.__data__.has(r)}return JS=t,JS}var QS,Rk;function c5(){if(Rk)return QS;Rk=1;var t=RP(),r=TX(),s=EX();function c(m){var v=-1,T=m==null?0:m.length;for(this.__data__=new t;++v<T;)this.add(m[v])}return c.prototype.add=c.prototype.push=r,c.prototype.has=s,QS=c,QS}var eT,Dk;function u5(){if(Dk)return eT;Dk=1;function t(r,s){for(var c=-1,m=r==null?0:r.length;++c<m;)if(s(r[c],c,r))return!0;return!1}return eT=t,eT}var tT,kk;function h5(){if(kk)return tT;kk=1;function t(r,s){return r.has(s)}return tT=t,tT}var rT,Lk;function f5(){if(Lk)return rT;Lk=1;var t=c5(),r=u5(),s=h5(),c=1,m=2;function v(T,o,M,R,B,F){var G=M&c,K=T.length,ee=o.length;if(K!=ee&&!(G&&ee>K))return!1;var H=F.get(T),Z=F.get(o);if(H&&Z)return H==o&&Z==T;var ae=-1,fe=!0,ue=M&m?new t:void 0;for(F.set(T,o),F.set(o,T);++ae<K;){var _e=T[ae],le=o[ae];if(R)var pe=G?R(le,_e,ae,o,T,F):R(_e,le,ae,T,o,F);if(pe!==void 0){if(pe)continue;fe=!1;break}if(ue){if(!r(o,function(Te,De){if(!s(ue,De)&&(_e===Te||B(_e,Te,M,R,F)))return ue.push(De)})){fe=!1;break}}else if(!(_e===le||B(_e,le,M,R,F))){fe=!1;break}}return F.delete(T),F.delete(o),fe}return rT=v,rT}var nT,zk;function AX(){if(zk)return nT;zk=1;var t=Yh(),r=t.Uint8Array;return nT=r,nT}var iT,Fk;function PX(){if(Fk)return iT;Fk=1;function t(r){var s=-1,c=Array(r.size);return r.forEach(function(m,v){c[++s]=[v,m]}),c}return iT=t,iT}var oT,Bk;function VP(){if(Bk)return oT;Bk=1;function t(r){var s=-1,c=Array(r.size);return r.forEach(function(m){c[++s]=m}),c}return oT=t,oT}var aT,Nk;function IX(){if(Nk)return aT;Nk=1;var t=Mv(),r=AX(),s=MP(),c=f5(),m=PX(),v=VP(),T=1,o=2,M="[object Boolean]",R="[object Date]",B="[object Error]",F="[object Map]",G="[object Number]",K="[object RegExp]",ee="[object Set]",H="[object String]",Z="[object Symbol]",ae="[object ArrayBuffer]",fe="[object DataView]",ue=t?t.prototype:void 0,_e=ue?ue.valueOf:void 0;function le(pe,Te,De,Xe,wt,$e,vt){switch(De){case fe:if(pe.byteLength!=Te.byteLength||pe.byteOffset!=Te.byteOffset)return!1;pe=pe.buffer,Te=Te.buffer;case ae:return!(pe.byteLength!=Te.byteLength||!$e(new r(pe),new r(Te)));case M:case R:case G:return s(+pe,+Te);case B:return pe.name==Te.name&&pe.message==Te.message;case K:case H:return pe==Te+"";case F:var ft=m;case ee:var bt=Xe&T;if(ft||(ft=v),pe.size!=Te.size&&!bt)return!1;var St=vt.get(pe);if(St)return St==Te;Xe|=o,vt.set(pe,Te);var gt=c(ft(pe),ft(Te),Xe,wt,$e,vt);return vt.delete(pe),gt;case Z:if(_e)return _e.call(pe)==_e.call(Te)}return!1}return aT=le,aT}var sT,jk;function d5(){if(jk)return sT;jk=1;function t(r,s){for(var c=-1,m=s.length,v=r.length;++c<m;)r[v+c]=s[c];return r}return sT=t,sT}var lT,Uk;function CX(){if(Uk)return lT;Uk=1;var t=d5(),r=El();function s(c,m,v){var T=m(c);return r(c)?T:t(T,v(c))}return lT=s,lT}var cT,Vk;function MX(){if(Vk)return cT;Vk=1;function t(r,s){for(var c=-1,m=r==null?0:r.length,v=0,T=[];++c<m;){var o=r[c];s(o,c,r)&&(T[v++]=o)}return T}return cT=t,cT}var uT,$k;function OX(){if($k)return uT;$k=1;function t(){return[]}return uT=t,uT}var hT,qk;function RX(){if(qk)return hT;qk=1;var t=MX(),r=OX(),s=Object.prototype,c=s.propertyIsEnumerable,m=Object.getOwnPropertySymbols,v=m?function(T){return T==null?[]:(T=Object(T),t(m(T),function(o){return c.call(T,o)}))}:r;return hT=v,hT}var fT,Gk;function DX(){if(Gk)return fT;Gk=1;function t(r,s){for(var c=-1,m=Array(r);++c<r;)m[c]=s(c);return m}return fT=t,fT}var dT,Hk;function kX(){if(Hk)return dT;Hk=1;var t=hd(),r=fd(),s="[object Arguments]";function c(m){return r(m)&&t(m)==s}return dT=c,dT}var pT,Wk;function $P(){if(Wk)return pT;Wk=1;var t=kX(),r=fd(),s=Object.prototype,c=s.hasOwnProperty,m=s.propertyIsEnumerable,v=t((function(){return arguments})())?t:function(T){return r(T)&&c.call(T,"callee")&&!m.call(T,"callee")};return pT=v,pT}var Cy={exports:{}},mT,Zk;function LX(){if(Zk)return mT;Zk=1;function t(){return!1}return mT=t,mT}Cy.exports;var Xk;function p5(){return Xk||(Xk=1,(function(t,r){var s=Yh(),c=LX(),m=r&&!r.nodeType&&r,v=m&&!0&&t&&!t.nodeType&&t,T=v&&v.exports===m,o=T?s.Buffer:void 0,M=o?o.isBuffer:void 0,R=M||c;t.exports=R})(Cy,Cy.exports)),Cy.exports}var gT,Kk;function qP(){if(Kk)return gT;Kk=1;var t=9007199254740991,r=/^(?:0|[1-9]\d*)$/;function s(c,m){var v=typeof c;return m=m??t,!!m&&(v=="number"||v!="symbol"&&r.test(c))&&c>-1&&c%1==0&&c<m}return gT=s,gT}var _T,Yk;function GP(){if(Yk)return _T;Yk=1;var t=9007199254740991;function r(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=t}return _T=r,_T}var yT,Jk;function zX(){if(Jk)return yT;Jk=1;var t=hd(),r=GP(),s=fd(),c="[object Arguments]",m="[object Array]",v="[object Boolean]",T="[object Date]",o="[object Error]",M="[object Function]",R="[object Map]",B="[object Number]",F="[object Object]",G="[object RegExp]",K="[object Set]",ee="[object String]",H="[object WeakMap]",Z="[object ArrayBuffer]",ae="[object DataView]",fe="[object Float32Array]",ue="[object Float64Array]",_e="[object Int8Array]",le="[object Int16Array]",pe="[object Int32Array]",Te="[object Uint8Array]",De="[object Uint8ClampedArray]",Xe="[object Uint16Array]",wt="[object Uint32Array]",$e={};$e[fe]=$e[ue]=$e[_e]=$e[le]=$e[pe]=$e[Te]=$e[De]=$e[Xe]=$e[wt]=!0,$e[c]=$e[m]=$e[Z]=$e[v]=$e[ae]=$e[T]=$e[o]=$e[M]=$e[R]=$e[B]=$e[F]=$e[G]=$e[K]=$e[ee]=$e[H]=!1;function vt(ft){return s(ft)&&r(ft.length)&&!!$e[t(ft)]}return yT=vt,yT}var vT,Qk;function m5(){if(Qk)return vT;Qk=1;function t(r){return function(s){return r(s)}}return vT=t,vT}var My={exports:{}};My.exports;var eL;function FX(){return eL||(eL=1,(function(t,r){var s=Lj(),c=r&&!r.nodeType&&r,m=c&&!0&&t&&!t.nodeType&&t,v=m&&m.exports===c,T=v&&s.process,o=(function(){try{var M=m&&m.require&&m.require("util").types;return M||T&&T.binding&&T.binding("util")}catch{}})();t.exports=o})(My,My.exports)),My.exports}var xT,tL;function g5(){if(tL)return xT;tL=1;var t=zX(),r=m5(),s=FX(),c=s&&s.isTypedArray,m=c?r(c):t;return xT=m,xT}var bT,rL;function BX(){if(rL)return bT;rL=1;var t=DX(),r=$P(),s=El(),c=p5(),m=qP(),v=g5(),T=Object.prototype,o=T.hasOwnProperty;function M(R,B){var F=s(R),G=!F&&r(R),K=!F&&!G&&c(R),ee=!F&&!G&&!K&&v(R),H=F||G||K||ee,Z=H?t(R.length,String):[],ae=Z.length;for(var fe in R)(B||o.call(R,fe))&&!(H&&(fe=="length"||K&&(fe=="offset"||fe=="parent")||ee&&(fe=="buffer"||fe=="byteLength"||fe=="byteOffset")||m(fe,ae)))&&Z.push(fe);return Z}return bT=M,bT}var wT,nL;function NX(){if(nL)return wT;nL=1;var t=Object.prototype;function r(s){var c=s&&s.constructor,m=typeof c=="function"&&c.prototype||t;return s===m}return wT=r,wT}var ST,iL;function _5(){if(iL)return ST;iL=1;function t(r,s){return function(c){return r(s(c))}}return ST=t,ST}var TT,oL;function jX(){if(oL)return TT;oL=1;var t=_5(),r=t(Object.keys,Object);return TT=r,TT}var ET,aL;function UX(){if(aL)return ET;aL=1;var t=NX(),r=jX(),s=Object.prototype,c=s.hasOwnProperty;function m(v){if(!t(v))return r(v);var T=[];for(var o in Object(v))c.call(v,o)&&o!="constructor"&&T.push(o);return T}return ET=m,ET}var AT,sL;function Dv(){if(sL)return AT;sL=1;var t=CP(),r=GP();function s(c){return c!=null&&r(c.length)&&!t(c)}return AT=s,AT}var PT,lL;function Eb(){if(lL)return PT;lL=1;var t=BX(),r=UX(),s=Dv();function c(m){return s(m)?t(m):r(m)}return PT=c,PT}var IT,cL;function VX(){if(cL)return IT;cL=1;var t=CX(),r=RX(),s=Eb();function c(m){return t(m,s,r)}return IT=c,IT}var CT,uL;function $X(){if(uL)return CT;uL=1;var t=VX(),r=1,s=Object.prototype,c=s.hasOwnProperty;function m(v,T,o,M,R,B){var F=o&r,G=t(v),K=G.length,ee=t(T),H=ee.length;if(K!=H&&!F)return!1;for(var Z=K;Z--;){var ae=G[Z];if(!(F?ae in T:c.call(T,ae)))return!1}var fe=B.get(v),ue=B.get(T);if(fe&&ue)return fe==T&&ue==v;var _e=!0;B.set(v,T),B.set(T,v);for(var le=F;++Z<K;){ae=G[Z];var pe=v[ae],Te=T[ae];if(M)var De=F?M(Te,pe,ae,T,v,B):M(pe,Te,ae,v,T,B);if(!(De===void 0?pe===Te||R(pe,Te,o,M,B):De)){_e=!1;break}le||(le=ae=="constructor")}if(_e&&!le){var Xe=v.constructor,wt=T.constructor;Xe!=wt&&"constructor"in v&&"constructor"in T&&!(typeof Xe=="function"&&Xe instanceof Xe&&typeof wt=="function"&&wt instanceof wt)&&(_e=!1)}return B.delete(v),B.delete(T),_e}return CT=m,CT}var MT,hL;function qX(){if(hL)return MT;hL=1;var t=Um(),r=Yh(),s=t(r,"DataView");return MT=s,MT}var OT,fL;function GX(){if(fL)return OT;fL=1;var t=Um(),r=Yh(),s=t(r,"Promise");return OT=s,OT}var RT,dL;function y5(){if(dL)return RT;dL=1;var t=Um(),r=Yh(),s=t(r,"Set");return RT=s,RT}var DT,pL;function HX(){if(pL)return DT;pL=1;var t=Um(),r=Yh(),s=t(r,"WeakMap");return DT=s,DT}var kT,mL;function WX(){if(mL)return kT;mL=1;var t=qX(),r=OP(),s=GX(),c=y5(),m=HX(),v=hd(),T=zj(),o="[object Map]",M="[object Object]",R="[object Promise]",B="[object Set]",F="[object WeakMap]",G="[object DataView]",K=T(t),ee=T(r),H=T(s),Z=T(c),ae=T(m),fe=v;return(t&&fe(new t(new ArrayBuffer(1)))!=G||r&&fe(new r)!=o||s&&fe(s.resolve())!=R||c&&fe(new c)!=B||m&&fe(new m)!=F)&&(fe=function(ue){var _e=v(ue),le=_e==M?ue.constructor:void 0,pe=le?T(le):"";if(pe)switch(pe){case K:return G;case ee:return o;case H:return R;case Z:return B;case ae:return F}return _e}),kT=fe,kT}var LT,gL;function ZX(){if(gL)return LT;gL=1;var t=l5(),r=f5(),s=IX(),c=$X(),m=WX(),v=El(),T=p5(),o=g5(),M=1,R="[object Arguments]",B="[object Array]",F="[object Object]",G=Object.prototype,K=G.hasOwnProperty;function ee(H,Z,ae,fe,ue,_e){var le=v(H),pe=v(Z),Te=le?B:m(H),De=pe?B:m(Z);Te=Te==R?F:Te,De=De==R?F:De;var Xe=Te==F,wt=De==F,$e=Te==De;if($e&&T(H)){if(!T(Z))return!1;le=!0,Xe=!1}if($e&&!Xe)return _e||(_e=new t),le||o(H)?r(H,Z,ae,fe,ue,_e):s(H,Z,Te,ae,fe,ue,_e);if(!(ae&M)){var vt=Xe&&K.call(H,"__wrapped__"),ft=wt&&K.call(Z,"__wrapped__");if(vt||ft){var bt=vt?H.value():H,St=ft?Z.value():Z;return _e||(_e=new t),ue(bt,St,ae,fe,_e)}}return $e?(_e||(_e=new t),c(H,Z,ae,fe,ue,_e)):!1}return LT=ee,LT}var zT,_L;function HP(){if(_L)return zT;_L=1;var t=ZX(),r=fd();function s(c,m,v,T,o){return c===m?!0:c==null||m==null||!r(c)&&!r(m)?c!==c&&m!==m:t(c,m,v,T,s,o)}return zT=s,zT}var FT,yL;function XX(){if(yL)return FT;yL=1;var t=l5(),r=HP(),s=1,c=2;function m(v,T,o,M){var R=o.length,B=R,F=!M;if(v==null)return!B;for(v=Object(v);R--;){var G=o[R];if(F&&G[2]?G[1]!==v[G[0]]:!(G[0]in v))return!1}for(;++R<B;){G=o[R];var K=G[0],ee=v[K],H=G[1];if(F&&G[2]){if(ee===void 0&&!(K in v))return!1}else{var Z=new t;if(M)var ae=M(ee,H,K,v,T,Z);if(!(ae===void 0?r(H,ee,s|c,M,Z):ae))return!1}}return!0}return FT=m,FT}var BT,vL;function v5(){if(vL)return BT;vL=1;var t=kp();function r(s){return s===s&&!t(s)}return BT=r,BT}var NT,xL;function KX(){if(xL)return NT;xL=1;var t=v5(),r=Eb();function s(c){for(var m=r(c),v=m.length;v--;){var T=m[v],o=c[T];m[v]=[T,o,t(o)]}return m}return NT=s,NT}var jT,bL;function x5(){if(bL)return jT;bL=1;function t(r,s){return function(c){return c==null?!1:c[r]===s&&(s!==void 0||r in Object(c))}}return jT=t,jT}var UT,wL;function YX(){if(wL)return UT;wL=1;var t=XX(),r=KX(),s=x5();function c(m){var v=r(m);return v.length==1&&v[0][2]?s(v[0][0],v[0][1]):function(T){return T===m||t(T,m,v)}}return UT=c,UT}var VT,SL;function JX(){if(SL)return VT;SL=1;function t(r,s){return r!=null&&s in Object(r)}return VT=t,VT}var $T,TL;function QX(){if(TL)return $T;TL=1;var t=Nj(),r=$P(),s=El(),c=qP(),m=GP(),v=xb();function T(o,M,R){M=t(M,o);for(var B=-1,F=M.length,G=!1;++B<F;){var K=v(M[B]);if(!(G=o!=null&&R(o,K)))break;o=o[K]}return G||++B!=F?G:(F=o==null?0:o.length,!!F&&m(F)&&c(K,F)&&(s(o)||r(o)))}return $T=T,$T}var qT,EL;function eK(){if(EL)return qT;EL=1;var t=JX(),r=QX();function s(c,m){return c!=null&&r(c,m,t)}return qT=s,qT}var GT,AL;function tK(){if(AL)return GT;AL=1;var t=HP(),r=jj(),s=eK(),c=IP(),m=v5(),v=x5(),T=xb(),o=1,M=2;function R(B,F){return c(B)&&m(F)?v(T(B),F):function(G){var K=r(G,B);return K===void 0&&K===F?s(G,B):t(F,K,o|M)}}return GT=R,GT}var HT,PL;function w_(){if(PL)return HT;PL=1;function t(r){return r}return HT=t,HT}var WT,IL;function rK(){if(IL)return WT;IL=1;function t(r){return function(s){return s?.[r]}}return WT=t,WT}var ZT,CL;function nK(){if(CL)return ZT;CL=1;var t=kP();function r(s){return function(c){return t(c,s)}}return ZT=r,ZT}var XT,ML;function iK(){if(ML)return XT;ML=1;var t=rK(),r=nK(),s=IP(),c=xb();function m(v){return s(v)?t(c(v)):r(v)}return XT=m,XT}var KT,OL;function Jh(){if(OL)return KT;OL=1;var t=YX(),r=tK(),s=w_(),c=El(),m=iK();function v(T){return typeof T=="function"?T:T==null?s:typeof T=="object"?c(T)?r(T[0],T[1]):t(T):m(T)}return KT=v,KT}var YT,RL;function b5(){if(RL)return YT;RL=1;function t(r,s,c,m){for(var v=r.length,T=c+(m?1:-1);m?T--:++T<v;)if(s(r[T],T,r))return T;return-1}return YT=t,YT}var JT,DL;function oK(){if(DL)return JT;DL=1;function t(r){return r!==r}return JT=t,JT}var QT,kL;function aK(){if(kL)return QT;kL=1;function t(r,s,c){for(var m=c-1,v=r.length;++m<v;)if(r[m]===s)return m;return-1}return QT=t,QT}var eE,LL;function sK(){if(LL)return eE;LL=1;var t=b5(),r=oK(),s=aK();function c(m,v,T){return v===v?s(m,v,T):t(m,r,T)}return eE=c,eE}var tE,zL;function lK(){if(zL)return tE;zL=1;var t=sK();function r(s,c){var m=s==null?0:s.length;return!!m&&t(s,c,0)>-1}return tE=r,tE}var rE,FL;function cK(){if(FL)return rE;FL=1;function t(r,s,c){for(var m=-1,v=r==null?0:r.length;++m<v;)if(c(s,r[m]))return!0;return!1}return rE=t,rE}var nE,BL;function uK(){if(BL)return nE;BL=1;function t(){}return nE=t,nE}var iE,NL;function hK(){if(NL)return iE;NL=1;var t=y5(),r=uK(),s=VP(),c=1/0,m=t&&1/s(new t([,-0]))[1]==c?function(v){return new t(v)}:r;return iE=m,iE}var oE,jL;function fK(){if(jL)return oE;jL=1;var t=c5(),r=lK(),s=cK(),c=h5(),m=hK(),v=VP(),T=200;function o(M,R,B){var F=-1,G=r,K=M.length,ee=!0,H=[],Z=H;if(B)ee=!1,G=s;else if(K>=T){var ae=R?null:m(M);if(ae)return v(ae);ee=!1,G=c,Z=new t}else Z=R?[]:H;e:for(;++F<K;){var fe=M[F],ue=R?R(fe):fe;if(fe=B||fe!==0?fe:0,ee&&ue===ue){for(var _e=Z.length;_e--;)if(Z[_e]===ue)continue e;R&&Z.push(ue),H.push(fe)}else G(Z,ue,B)||(Z!==H&&Z.push(ue),H.push(fe))}return H}return oE=o,oE}var aE,UL;function dK(){if(UL)return aE;UL=1;var t=Jh(),r=fK();function s(c,m){return c&&c.length?r(c,t(m,2)):[]}return aE=s,aE}var pK=dK();const VL=Wi(pK);function w5(t,r,s){return r===!0?VL(t,s):Zn(r)?VL(t,r):t}function Zg(t){"@babel/helpers - typeof";return Zg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Zg(t)}var mK=["ref"];function $L(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function Xf(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?$L(Object(s),!0).forEach(function(c){Ab(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):$L(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function gK(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function qL(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,T5(c.key),c)}}function _K(t,r,s){return r&&qL(t.prototype,r),s&&qL(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function yK(t,r,s){return r=v0(r),vK(t,S5()?Reflect.construct(r,s||[],v0(t).constructor):r.apply(t,s))}function vK(t,r){if(r&&(Zg(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return xK(t)}function xK(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function S5(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(S5=function(){return!!t})()}function v0(t){return v0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},v0(t)}function bK(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&r2(t,r)}function r2(t,r){return r2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},r2(t,r)}function Ab(t,r,s){return r=T5(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function T5(t){var r=wK(t,"string");return Zg(r)=="symbol"?r:r+""}function wK(t,r){if(Zg(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(Zg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function SK(t,r){if(t==null)return{};var s=TK(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function TK(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}function EK(t){return t.value}function AK(t,r){if(ht.isValidElement(t))return ht.cloneElement(t,r);if(typeof t=="function")return ht.createElement(t,r);r.ref;var s=SK(r,mK);return ht.createElement(UP,s)}var GL=1,Ug=(function(t){function r(){var s;gK(this,r);for(var c=arguments.length,m=new Array(c),v=0;v<c;v++)m[v]=arguments[v];return s=yK(this,r,[].concat(m)),Ab(s,"lastBoundingBox",{width:-1,height:-1}),s}return bK(r,t),_K(r,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var c=this.wrapperNode.getBoundingClientRect();return c.height=this.wrapperNode.offsetHeight,c.width=this.wrapperNode.offsetWidth,c}return null}},{key:"updateBBox",value:function(){var c=this.props.onBBoxUpdate,m=this.getBBox();m?(Math.abs(m.width-this.lastBoundingBox.width)>GL||Math.abs(m.height-this.lastBoundingBox.height)>GL)&&(this.lastBoundingBox.width=m.width,this.lastBoundingBox.height=m.height,c&&c(m)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,c&&c(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?Xf({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(c){var m=this.props,v=m.layout,T=m.align,o=m.verticalAlign,M=m.margin,R=m.chartWidth,B=m.chartHeight,F,G;if(!c||(c.left===void 0||c.left===null)&&(c.right===void 0||c.right===null))if(T==="center"&&v==="vertical"){var K=this.getBBoxSnapshot();F={left:((R||0)-K.width)/2}}else F=T==="right"?{right:M&&M.right||0}:{left:M&&M.left||0};if(!c||(c.top===void 0||c.top===null)&&(c.bottom===void 0||c.bottom===null))if(o==="middle"){var ee=this.getBBoxSnapshot();G={top:((B||0)-ee.height)/2}}else G=o==="bottom"?{bottom:M&&M.bottom||0}:{top:M&&M.top||0};return Xf(Xf({},F),G)}},{key:"render",value:function(){var c=this,m=this.props,v=m.content,T=m.width,o=m.height,M=m.wrapperStyle,R=m.payloadUniqBy,B=m.payload,F=Xf(Xf({position:"absolute",width:T||"auto",height:o||"auto"},this.getDefaultPosition(M)),M);return ht.createElement("div",{className:"recharts-legend-wrapper",style:F,ref:function(K){c.wrapperNode=K}},AK(v,Xf(Xf({},this.props),{},{payload:w5(B,R,EK)})))}}],[{key:"getWithHeight",value:function(c,m){var v=Xf(Xf({},this.defaultProps),c.props),T=v.layout;return T==="vertical"&&kr(c.props.height)?{height:c.props.height}:T==="horizontal"?{width:c.props.width||m}:null}}])})(Le.PureComponent);Ab(Ug,"displayName","Legend");Ab(Ug,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var sE,HL;function PK(){if(HL)return sE;HL=1;var t=Mv(),r=$P(),s=El(),c=t?t.isConcatSpreadable:void 0;function m(v){return s(v)||r(v)||!!(c&&v&&v[c])}return sE=m,sE}var lE,WL;function E5(){if(WL)return lE;WL=1;var t=d5(),r=PK();function s(c,m,v,T,o){var M=-1,R=c.length;for(v||(v=r),o||(o=[]);++M<R;){var B=c[M];m>0&&v(B)?m>1?s(B,m-1,v,T,o):t(o,B):T||(o[o.length]=B)}return o}return lE=s,lE}var cE,ZL;function IK(){if(ZL)return cE;ZL=1;function t(r){return function(s,c,m){for(var v=-1,T=Object(s),o=m(s),M=o.length;M--;){var R=o[r?M:++v];if(c(T[R],R,T)===!1)break}return s}}return cE=t,cE}var uE,XL;function CK(){if(XL)return uE;XL=1;var t=IK(),r=t();return uE=r,uE}var hE,KL;function A5(){if(KL)return hE;KL=1;var t=CK(),r=Eb();function s(c,m){return c&&t(c,m,r)}return hE=s,hE}var fE,YL;function MK(){if(YL)return fE;YL=1;var t=Dv();function r(s,c){return function(m,v){if(m==null)return m;if(!t(m))return s(m,v);for(var T=m.length,o=c?T:-1,M=Object(m);(c?o--:++o<T)&&v(M[o],o,M)!==!1;);return m}}return fE=r,fE}var dE,JL;function WP(){if(JL)return dE;JL=1;var t=A5(),r=MK(),s=r(t);return dE=s,dE}var pE,QL;function P5(){if(QL)return pE;QL=1;var t=WP(),r=Dv();function s(c,m){var v=-1,T=r(c)?Array(c.length):[];return t(c,function(o,M,R){T[++v]=m(o,M,R)}),T}return pE=s,pE}var mE,ez;function OK(){if(ez)return mE;ez=1;function t(r,s){var c=r.length;for(r.sort(s);c--;)r[c]=r[c].value;return r}return mE=t,mE}var gE,tz;function RK(){if(tz)return gE;tz=1;var t=x_();function r(s,c){if(s!==c){var m=s!==void 0,v=s===null,T=s===s,o=t(s),M=c!==void 0,R=c===null,B=c===c,F=t(c);if(!R&&!F&&!o&&s>c||o&&M&&B&&!R&&!F||v&&M&&B||!m&&B||!T)return 1;if(!v&&!o&&!F&&s<c||F&&m&&T&&!v&&!o||R&&m&&T||!M&&T||!B)return-1}return 0}return gE=r,gE}var _E,rz;function DK(){if(rz)return _E;rz=1;var t=RK();function r(s,c,m){for(var v=-1,T=s.criteria,o=c.criteria,M=T.length,R=m.length;++v<M;){var B=t(T[v],o[v]);if(B){if(v>=R)return B;var F=m[v];return B*(F=="desc"?-1:1)}}return s.index-c.index}return _E=r,_E}var yE,nz;function kK(){if(nz)return yE;nz=1;var t=DP(),r=kP(),s=Jh(),c=P5(),m=OK(),v=m5(),T=DK(),o=w_(),M=El();function R(B,F,G){F.length?F=t(F,function(H){return M(H)?function(Z){return r(Z,H.length===1?H[0]:H)}:H}):F=[o];var K=-1;F=t(F,v(s));var ee=c(B,function(H,Z,ae){var fe=t(F,function(ue){return ue(H)});return{criteria:fe,index:++K,value:H}});return m(ee,function(H,Z){return T(H,Z,G)})}return yE=R,yE}var vE,iz;function LK(){if(iz)return vE;iz=1;function t(r,s,c){switch(c.length){case 0:return r.call(s);case 1:return r.call(s,c[0]);case 2:return r.call(s,c[0],c[1]);case 3:return r.call(s,c[0],c[1],c[2])}return r.apply(s,c)}return vE=t,vE}var xE,oz;function zK(){if(oz)return xE;oz=1;var t=LK(),r=Math.max;function s(c,m,v){return m=r(m===void 0?c.length-1:m,0),function(){for(var T=arguments,o=-1,M=r(T.length-m,0),R=Array(M);++o<M;)R[o]=T[m+o];o=-1;for(var B=Array(m+1);++o<m;)B[o]=T[o];return B[m]=v(R),t(c,this,B)}}return xE=s,xE}var bE,az;function FK(){if(az)return bE;az=1;function t(r){return function(){return r}}return bE=t,bE}var wE,sz;function I5(){if(sz)return wE;sz=1;var t=Um(),r=(function(){try{var s=t(Object,"defineProperty");return s({},"",{}),s}catch{}})();return wE=r,wE}var SE,lz;function BK(){if(lz)return SE;lz=1;var t=FK(),r=I5(),s=w_(),c=r?function(m,v){return r(m,"toString",{configurable:!0,enumerable:!1,value:t(v),writable:!0})}:s;return SE=c,SE}var TE,cz;function NK(){if(cz)return TE;cz=1;var t=800,r=16,s=Date.now;function c(m){var v=0,T=0;return function(){var o=s(),M=r-(o-T);if(T=o,M>0){if(++v>=t)return arguments[0]}else v=0;return m.apply(void 0,arguments)}}return TE=c,TE}var EE,uz;function jK(){if(uz)return EE;uz=1;var t=BK(),r=NK(),s=r(t);return EE=s,EE}var AE,hz;function UK(){if(hz)return AE;hz=1;var t=w_(),r=zK(),s=jK();function c(m,v){return s(r(m,v,t),m+"")}return AE=c,AE}var PE,fz;function Pb(){if(fz)return PE;fz=1;var t=MP(),r=Dv(),s=qP(),c=kp();function m(v,T,o){if(!c(o))return!1;var M=typeof T;return(M=="number"?r(o)&&s(T,o.length):M=="string"&&T in o)?t(o[T],v):!1}return PE=m,PE}var IE,dz;function VK(){if(dz)return IE;dz=1;var t=E5(),r=kK(),s=UK(),c=Pb(),m=s(function(v,T){if(v==null)return[];var o=T.length;return o>1&&c(v,T[0],T[1])?T=[]:o>2&&c(T[0],T[1],T[2])&&(T=[T[0]]),r(v,t(T,1),[])});return IE=m,IE}var $K=VK();const ZP=Wi($K);function Gy(t){"@babel/helpers - typeof";return Gy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Gy(t)}function n2(){return n2=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},n2.apply(this,arguments)}function qK(t,r){return ZK(t)||WK(t,r)||HK(t,r)||GK()}function GK(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HK(t,r){if(t){if(typeof t=="string")return pz(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return pz(t,r)}}function pz(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function WK(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var c,m,v,T,o=[],M=!0,R=!1;try{if(v=(s=s.call(t)).next,r!==0)for(;!(M=(c=v.call(s)).done)&&(o.push(c.value),o.length!==r);M=!0);}catch(B){R=!0,m=B}finally{try{if(!M&&s.return!=null&&(T=s.return(),Object(T)!==T))return}finally{if(R)throw m}}return o}}function ZK(t){if(Array.isArray(t))return t}function mz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function CE(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?mz(Object(s),!0).forEach(function(c){XK(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):mz(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function XK(t,r,s){return r=KK(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function KK(t){var r=YK(t,"string");return Gy(r)=="symbol"?r:r+""}function YK(t,r){if(Gy(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(Gy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function JK(t){return Array.isArray(t)&&za(t[0])&&za(t[1])?t.join(" ~ "):t}var QK=function(r){var s=r.separator,c=s===void 0?" : ":s,m=r.contentStyle,v=m===void 0?{}:m,T=r.itemStyle,o=T===void 0?{}:T,M=r.labelStyle,R=M===void 0?{}:M,B=r.payload,F=r.formatter,G=r.itemSorter,K=r.wrapperClassName,ee=r.labelClassName,H=r.label,Z=r.labelFormatter,ae=r.accessibilityLayer,fe=ae===void 0?!1:ae,ue=function(){if(B&&B.length){var vt={padding:0,margin:0},ft=(G?ZP(B,G):B).map(function(bt,St){if(bt.type==="none")return null;var gt=CE({display:"block",paddingTop:4,paddingBottom:4,color:bt.color||"#000"},o),Rt=bt.formatter||F||JK,Ke=bt.value,yt=bt.name,Vt=Ke,qe=yt;if(Rt&&Vt!=null&&qe!=null){var mt=Rt(Ke,yt,bt,St,B);if(Array.isArray(mt)){var ar=qK(mt,2);Vt=ar[0],qe=ar[1]}else Vt=mt}return ht.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(St),style:gt},za(qe)?ht.createElement("span",{className:"recharts-tooltip-item-name"},qe):null,za(qe)?ht.createElement("span",{className:"recharts-tooltip-item-separator"},c):null,ht.createElement("span",{className:"recharts-tooltip-item-value"},Vt),ht.createElement("span",{className:"recharts-tooltip-item-unit"},bt.unit||""))});return ht.createElement("ul",{className:"recharts-tooltip-item-list",style:vt},ft)}return null},_e=CE({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},v),le=CE({margin:0},R),pe=!bi(H),Te=pe?H:"",De=ci("recharts-default-tooltip",K),Xe=ci("recharts-tooltip-label",ee);pe&&Z&&B!==void 0&&B!==null&&(Te=Z(H,B));var wt=fe?{role:"status","aria-live":"assertive"}:{};return ht.createElement("div",n2({className:De,style:_e},wt),ht.createElement("p",{className:Xe,style:le},ht.isValidElement(Te)?Te:"".concat(Te)),ue())};function Hy(t){"@babel/helpers - typeof";return Hy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Hy(t)}function $x(t,r,s){return r=eY(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function eY(t){var r=tY(t,"string");return Hy(r)=="symbol"?r:r+""}function tY(t,r){if(Hy(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(Hy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var vy="recharts-tooltip-wrapper",rY={visibility:"hidden"};function nY(t){var r=t.coordinate,s=t.translateX,c=t.translateY;return ci(vy,$x($x($x($x({},"".concat(vy,"-right"),kr(s)&&r&&kr(r.x)&&s>=r.x),"".concat(vy,"-left"),kr(s)&&r&&kr(r.x)&&s<r.x),"".concat(vy,"-bottom"),kr(c)&&r&&kr(r.y)&&c>=r.y),"".concat(vy,"-top"),kr(c)&&r&&kr(r.y)&&c<r.y))}function gz(t){var r=t.allowEscapeViewBox,s=t.coordinate,c=t.key,m=t.offsetTopLeft,v=t.position,T=t.reverseDirection,o=t.tooltipDimension,M=t.viewBox,R=t.viewBoxDimension;if(v&&kr(v[c]))return v[c];var B=s[c]-o-m,F=s[c]+m;if(r[c])return T[c]?B:F;if(T[c]){var G=B,K=M[c];return G<K?Math.max(F,M[c]):Math.max(B,M[c])}var ee=F+o,H=M[c]+R;return ee>H?Math.max(B,M[c]):Math.max(F,M[c])}function iY(t){var r=t.translateX,s=t.translateY,c=t.useTranslate3d;return{transform:c?"translate3d(".concat(r,"px, ").concat(s,"px, 0)"):"translate(".concat(r,"px, ").concat(s,"px)")}}function oY(t){var r=t.allowEscapeViewBox,s=t.coordinate,c=t.offsetTopLeft,m=t.position,v=t.reverseDirection,T=t.tooltipBox,o=t.useTranslate3d,M=t.viewBox,R,B,F;return T.height>0&&T.width>0&&s?(B=gz({allowEscapeViewBox:r,coordinate:s,key:"x",offsetTopLeft:c,position:m,reverseDirection:v,tooltipDimension:T.width,viewBox:M,viewBoxDimension:M.width}),F=gz({allowEscapeViewBox:r,coordinate:s,key:"y",offsetTopLeft:c,position:m,reverseDirection:v,tooltipDimension:T.height,viewBox:M,viewBoxDimension:M.height}),R=iY({translateX:B,translateY:F,useTranslate3d:o})):R=rY,{cssProperties:R,cssClasses:nY({translateX:B,translateY:F,coordinate:s})}}function Xg(t){"@babel/helpers - typeof";return Xg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Xg(t)}function _z(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function yz(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?_z(Object(s),!0).forEach(function(c){o2(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):_z(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function aY(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function sY(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,M5(c.key),c)}}function lY(t,r,s){return r&&sY(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function cY(t,r,s){return r=x0(r),uY(t,C5()?Reflect.construct(r,s||[],x0(t).constructor):r.apply(t,s))}function uY(t,r){if(r&&(Xg(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hY(t)}function hY(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function C5(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(C5=function(){return!!t})()}function x0(t){return x0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},x0(t)}function fY(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&i2(t,r)}function i2(t,r){return i2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},i2(t,r)}function o2(t,r,s){return r=M5(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function M5(t){var r=dY(t,"string");return Xg(r)=="symbol"?r:r+""}function dY(t,r){if(Xg(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(Xg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var vz=1,pY=(function(t){function r(){var s;aY(this,r);for(var c=arguments.length,m=new Array(c),v=0;v<c;v++)m[v]=arguments[v];return s=cY(this,r,[].concat(m)),o2(s,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),o2(s,"handleKeyDown",function(T){if(T.key==="Escape"){var o,M,R,B;s.setState({dismissed:!0,dismissedAtCoordinate:{x:(o=(M=s.props.coordinate)===null||M===void 0?void 0:M.x)!==null&&o!==void 0?o:0,y:(R=(B=s.props.coordinate)===null||B===void 0?void 0:B.y)!==null&&R!==void 0?R:0}})}}),s}return fY(r,t),lY(r,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var c=this.wrapperNode.getBoundingClientRect();(Math.abs(c.width-this.state.lastBoundingBox.width)>vz||Math.abs(c.height-this.state.lastBoundingBox.height)>vz)&&this.setState({lastBoundingBox:{width:c.width,height:c.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var c,m;this.props.active&&this.updateBBox(),this.state.dismissed&&(((c=this.props.coordinate)===null||c===void 0?void 0:c.x)!==this.state.dismissedAtCoordinate.x||((m=this.props.coordinate)===null||m===void 0?void 0:m.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var c=this,m=this.props,v=m.active,T=m.allowEscapeViewBox,o=m.animationDuration,M=m.animationEasing,R=m.children,B=m.coordinate,F=m.hasPayload,G=m.isAnimationActive,K=m.offset,ee=m.position,H=m.reverseDirection,Z=m.useTranslate3d,ae=m.viewBox,fe=m.wrapperStyle,ue=oY({allowEscapeViewBox:T,coordinate:B,offsetTopLeft:K,position:ee,reverseDirection:H,tooltipBox:this.state.lastBoundingBox,useTranslate3d:Z,viewBox:ae}),_e=ue.cssClasses,le=ue.cssProperties,pe=yz(yz({transition:G&&v?"transform ".concat(o,"ms ").concat(M):void 0},le),{},{pointerEvents:"none",visibility:!this.state.dismissed&&v&&F?"visible":"hidden",position:"absolute",top:0,left:0},fe);return ht.createElement("div",{tabIndex:-1,className:_e,style:pe,ref:function(De){c.wrapperNode=De}},R)}}])})(Le.PureComponent),mY=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},S_={isSsr:mY()};function Kg(t){"@babel/helpers - typeof";return Kg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Kg(t)}function xz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function bz(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?xz(Object(s),!0).forEach(function(c){XP(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):xz(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function gY(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _Y(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,R5(c.key),c)}}function yY(t,r,s){return r&&_Y(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function vY(t,r,s){return r=b0(r),xY(t,O5()?Reflect.construct(r,s||[],b0(t).constructor):r.apply(t,s))}function xY(t,r){if(r&&(Kg(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return bY(t)}function bY(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function O5(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(O5=function(){return!!t})()}function b0(t){return b0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},b0(t)}function wY(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&a2(t,r)}function a2(t,r){return a2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},a2(t,r)}function XP(t,r,s){return r=R5(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function R5(t){var r=SY(t,"string");return Kg(r)=="symbol"?r:r+""}function SY(t,r){if(Kg(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(Kg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function TY(t){return t.dataKey}function EY(t,r){return ht.isValidElement(t)?ht.cloneElement(t,r):typeof t=="function"?ht.createElement(t,r):ht.createElement(QK,r)}var Kf=(function(t){function r(){return gY(this,r),vY(this,r,arguments)}return wY(r,t),yY(r,[{key:"render",value:function(){var c=this,m=this.props,v=m.active,T=m.allowEscapeViewBox,o=m.animationDuration,M=m.animationEasing,R=m.content,B=m.coordinate,F=m.filterNull,G=m.isAnimationActive,K=m.offset,ee=m.payload,H=m.payloadUniqBy,Z=m.position,ae=m.reverseDirection,fe=m.useTranslate3d,ue=m.viewBox,_e=m.wrapperStyle,le=ee??[];F&&le.length&&(le=w5(ee.filter(function(Te){return Te.value!=null&&(Te.hide!==!0||c.props.includeHidden)}),H,TY));var pe=le.length>0;return ht.createElement(pY,{allowEscapeViewBox:T,animationDuration:o,animationEasing:M,isAnimationActive:G,active:v,coordinate:B,hasPayload:pe,offset:K,position:Z,reverseDirection:ae,useTranslate3d:fe,viewBox:ue,wrapperStyle:_e},EY(R,bz(bz({},this.props),{},{payload:le})))}}])})(Le.PureComponent);XP(Kf,"displayName","Tooltip");XP(Kf,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!S_.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var ME,wz;function AY(){if(wz)return ME;wz=1;var t=Yh(),r=function(){return t.Date.now()};return ME=r,ME}var OE,Sz;function PY(){if(Sz)return OE;Sz=1;var t=/\s/;function r(s){for(var c=s.length;c--&&t.test(s.charAt(c)););return c}return OE=r,OE}var RE,Tz;function IY(){if(Tz)return RE;Tz=1;var t=PY(),r=/^\s+/;function s(c){return c&&c.slice(0,t(c)+1).replace(r,"")}return RE=s,RE}var DE,Ez;function D5(){if(Ez)return DE;Ez=1;var t=IY(),r=kp(),s=x_(),c=NaN,m=/^[-+]0x[0-9a-f]+$/i,v=/^0b[01]+$/i,T=/^0o[0-7]+$/i,o=parseInt;function M(R){if(typeof R=="number")return R;if(s(R))return c;if(r(R)){var B=typeof R.valueOf=="function"?R.valueOf():R;R=r(B)?B+"":B}if(typeof R!="string")return R===0?R:+R;R=t(R);var F=v.test(R);return F||T.test(R)?o(R.slice(2),F?2:8):m.test(R)?c:+R}return DE=M,DE}var kE,Az;function CY(){if(Az)return kE;Az=1;var t=kp(),r=AY(),s=D5(),c="Expected a function",m=Math.max,v=Math.min;function T(o,M,R){var B,F,G,K,ee,H,Z=0,ae=!1,fe=!1,ue=!0;if(typeof o!="function")throw new TypeError(c);M=s(M)||0,t(R)&&(ae=!!R.leading,fe="maxWait"in R,G=fe?m(s(R.maxWait)||0,M):G,ue="trailing"in R?!!R.trailing:ue);function _e(ft){var bt=B,St=F;return B=F=void 0,Z=ft,K=o.apply(St,bt),K}function le(ft){return Z=ft,ee=setTimeout(De,M),ae?_e(ft):K}function pe(ft){var bt=ft-H,St=ft-Z,gt=M-bt;return fe?v(gt,G-St):gt}function Te(ft){var bt=ft-H,St=ft-Z;return H===void 0||bt>=M||bt<0||fe&&St>=G}function De(){var ft=r();if(Te(ft))return Xe(ft);ee=setTimeout(De,pe(ft))}function Xe(ft){return ee=void 0,ue&&B?_e(ft):(B=F=void 0,K)}function wt(){ee!==void 0&&clearTimeout(ee),Z=0,B=H=F=ee=void 0}function $e(){return ee===void 0?K:Xe(r())}function vt(){var ft=r(),bt=Te(ft);if(B=arguments,F=this,H=ft,bt){if(ee===void 0)return le(H);if(fe)return clearTimeout(ee),ee=setTimeout(De,M),_e(H)}return ee===void 0&&(ee=setTimeout(De,M)),K}return vt.cancel=wt,vt.flush=$e,vt}return kE=T,kE}var LE,Pz;function MY(){if(Pz)return LE;Pz=1;var t=CY(),r=kp(),s="Expected a function";function c(m,v,T){var o=!0,M=!0;if(typeof m!="function")throw new TypeError(s);return r(T)&&(o="leading"in T?!!T.leading:o,M="trailing"in T?!!T.trailing:M),t(m,v,{leading:o,maxWait:v,trailing:M})}return LE=c,LE}var OY=MY();const k5=Wi(OY);function Wy(t){"@babel/helpers - typeof";return Wy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Wy(t)}function Iz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function qx(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Iz(Object(s),!0).forEach(function(c){RY(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Iz(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function RY(t,r,s){return r=DY(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function DY(t){var r=kY(t,"string");return Wy(r)=="symbol"?r:r+""}function kY(t,r){if(Wy(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(Wy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function LY(t,r){return NY(t)||BY(t,r)||FY(t,r)||zY()}function zY(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FY(t,r){if(t){if(typeof t=="string")return Cz(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Cz(t,r)}}function Cz(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function BY(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var c,m,v,T,o=[],M=!0,R=!1;try{if(v=(s=s.call(t)).next,r!==0)for(;!(M=(c=v.call(s)).done)&&(o.push(c.value),o.length!==r);M=!0);}catch(B){R=!0,m=B}finally{try{if(!M&&s.return!=null&&(T=s.return(),Object(T)!==T))return}finally{if(R)throw m}}return o}}function NY(t){if(Array.isArray(t))return t}var KP=Le.forwardRef(function(t,r){var s=t.aspect,c=t.initialDimension,m=c===void 0?{width:-1,height:-1}:c,v=t.width,T=v===void 0?"100%":v,o=t.height,M=o===void 0?"100%":o,R=t.minWidth,B=R===void 0?0:R,F=t.minHeight,G=t.maxHeight,K=t.children,ee=t.debounce,H=ee===void 0?0:ee,Z=t.id,ae=t.className,fe=t.onResize,ue=t.style,_e=ue===void 0?{}:ue,le=Le.useRef(null),pe=Le.useRef();pe.current=fe,Le.useImperativeHandle(r,function(){return Object.defineProperty(le.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),le.current},configurable:!0})});var Te=Le.useState({containerWidth:m.width,containerHeight:m.height}),De=LY(Te,2),Xe=De[0],wt=De[1],$e=Le.useCallback(function(ft,bt){wt(function(St){var gt=Math.round(ft),Rt=Math.round(bt);return St.containerWidth===gt&&St.containerHeight===Rt?St:{containerWidth:gt,containerHeight:Rt}})},[]);Le.useEffect(function(){var ft=function(yt){var Vt,qe=yt[0].contentRect,mt=qe.width,ar=qe.height;$e(mt,ar),(Vt=pe.current)===null||Vt===void 0||Vt.call(pe,mt,ar)};H>0&&(ft=k5(ft,H,{trailing:!0,leading:!1}));var bt=new ResizeObserver(ft),St=le.current.getBoundingClientRect(),gt=St.width,Rt=St.height;return $e(gt,Rt),bt.observe(le.current),function(){bt.disconnect()}},[$e,H]);var vt=Le.useMemo(function(){var ft=Xe.containerWidth,bt=Xe.containerHeight;if(ft<0||bt<0)return null;Wu(Am(T)||Am(M),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,T,M),Wu(!s||s>0,"The aspect(%s) must be greater than zero.",s);var St=Am(T)?ft:T,gt=Am(M)?bt:M;s&&s>0&&(St?gt=St/s:gt&&(St=gt*s),G&&gt>G&&(gt=G)),Wu(St>0||gt>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,St,gt,T,M,B,F,s);var Rt=!Array.isArray(K)&&td(K.type).endsWith("Chart");return ht.Children.map(K,function(Ke){return ht.isValidElement(Ke)?Le.cloneElement(Ke,qx({width:St,height:gt},Rt?{style:qx({height:"100%",width:"100%",maxHeight:gt,maxWidth:St},Ke.props.style)}:{})):Ke})},[s,K,M,G,F,B,Xe,T]);return ht.createElement("div",{id:Z?"".concat(Z):void 0,className:ci("recharts-responsive-container",ae),style:qx(qx({},_e),{},{width:T,height:M,minWidth:B,minHeight:F,maxHeight:G}),ref:le},vt)}),kv=function(r){return null};kv.displayName="Cell";function Zy(t){"@babel/helpers - typeof";return Zy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Zy(t)}function Mz(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function s2(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Mz(Object(s),!0).forEach(function(c){jY(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Mz(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function jY(t,r,s){return r=UY(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function UY(t){var r=VY(t,"string");return Zy(r)=="symbol"?r:r+""}function VY(t,r){if(Zy(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(Zy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var Mg={widthCache:{},cacheCount:0},$Y=2e3,qY={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},Oz="recharts_measurement_span";function GY(t){var r=s2({},t);return Object.keys(r).forEach(function(s){r[s]||delete r[s]}),r}var Ry=function(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(r==null||S_.isSsr)return{width:0,height:0};var c=GY(s),m=JSON.stringify({text:r,copyStyle:c});if(Mg.widthCache[m])return Mg.widthCache[m];try{var v=document.getElementById(Oz);v||(v=document.createElement("span"),v.setAttribute("id",Oz),v.setAttribute("aria-hidden","true"),document.body.appendChild(v));var T=s2(s2({},qY),c);Object.assign(v.style,T),v.textContent="".concat(r);var o=v.getBoundingClientRect(),M={width:o.width,height:o.height};return Mg.widthCache[m]=M,++Mg.cacheCount>$Y&&(Mg.cacheCount=0,Mg.widthCache={}),M}catch{return{width:0,height:0}}},HY=function(r){return{top:r.top+window.scrollY-document.documentElement.clientTop,left:r.left+window.scrollX-document.documentElement.clientLeft}};function Xy(t){"@babel/helpers - typeof";return Xy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Xy(t)}function w0(t,r){return KY(t)||XY(t,r)||ZY(t,r)||WY()}function WY(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZY(t,r){if(t){if(typeof t=="string")return Rz(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Rz(t,r)}}function Rz(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function XY(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var c,m,v,T,o=[],M=!0,R=!1;try{if(v=(s=s.call(t)).next,r===0){if(Object(s)!==s)return;M=!1}else for(;!(M=(c=v.call(s)).done)&&(o.push(c.value),o.length!==r);M=!0);}catch(B){R=!0,m=B}finally{try{if(!M&&s.return!=null&&(T=s.return(),Object(T)!==T))return}finally{if(R)throw m}}return o}}function KY(t){if(Array.isArray(t))return t}function YY(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Dz(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,QY(c.key),c)}}function JY(t,r,s){return r&&Dz(t.prototype,r),s&&Dz(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function QY(t){var r=eJ(t,"string");return Xy(r)=="symbol"?r:r+""}function eJ(t,r){if(Xy(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(Xy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var kz=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,Lz=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,tJ=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,rJ=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,L5={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},nJ=Object.keys(L5),Dg="NaN";function iJ(t,r){return t*L5[r]}var Gx=(function(){function t(r,s){YY(this,t),this.num=r,this.unit=s,this.num=r,this.unit=s,Number.isNaN(r)&&(this.unit=""),s!==""&&!tJ.test(s)&&(this.num=NaN,this.unit=""),nJ.includes(s)&&(this.num=iJ(r,s),this.unit="px")}return JY(t,[{key:"add",value:function(s){return this.unit!==s.unit?new t(NaN,""):new t(this.num+s.num,this.unit)}},{key:"subtract",value:function(s){return this.unit!==s.unit?new t(NaN,""):new t(this.num-s.num,this.unit)}},{key:"multiply",value:function(s){return this.unit!==""&&s.unit!==""&&this.unit!==s.unit?new t(NaN,""):new t(this.num*s.num,this.unit||s.unit)}},{key:"divide",value:function(s){return this.unit!==""&&s.unit!==""&&this.unit!==s.unit?new t(NaN,""):new t(this.num/s.num,this.unit||s.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(s){var c,m=(c=rJ.exec(s))!==null&&c!==void 0?c:[],v=w0(m,3),T=v[1],o=v[2];return new t(parseFloat(T),o??"")}}])})();function z5(t){if(t.includes(Dg))return Dg;for(var r=t;r.includes("*")||r.includes("/");){var s,c=(s=kz.exec(r))!==null&&s!==void 0?s:[],m=w0(c,4),v=m[1],T=m[2],o=m[3],M=Gx.parse(v??""),R=Gx.parse(o??""),B=T==="*"?M.multiply(R):M.divide(R);if(B.isNaN())return Dg;r=r.replace(kz,B.toString())}for(;r.includes("+")||/.-\d+(?:\.\d+)?/.test(r);){var F,G=(F=Lz.exec(r))!==null&&F!==void 0?F:[],K=w0(G,4),ee=K[1],H=K[2],Z=K[3],ae=Gx.parse(ee??""),fe=Gx.parse(Z??""),ue=H==="+"?ae.add(fe):ae.subtract(fe);if(ue.isNaN())return Dg;r=r.replace(Lz,ue.toString())}return r}var zz=/\(([^()]*)\)/;function oJ(t){for(var r=t;r.includes("(");){var s=zz.exec(r),c=w0(s,2),m=c[1];r=r.replace(zz,z5(m))}return r}function aJ(t){var r=t.replace(/\s+/g,"");return r=oJ(r),r=z5(r),r}function sJ(t){try{return aJ(t)}catch{return Dg}}function zE(t){var r=sJ(t.slice(5,-1));return r===Dg?"":r}var lJ=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],cJ=["dx","dy","angle","className","breakAll"];function l2(){return l2=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},l2.apply(this,arguments)}function Fz(t,r){if(t==null)return{};var s=uJ(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function uJ(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}function Bz(t,r){return pJ(t)||dJ(t,r)||fJ(t,r)||hJ()}function hJ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fJ(t,r){if(t){if(typeof t=="string")return Nz(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Nz(t,r)}}function Nz(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function dJ(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var c,m,v,T,o=[],M=!0,R=!1;try{if(v=(s=s.call(t)).next,r===0){if(Object(s)!==s)return;M=!1}else for(;!(M=(c=v.call(s)).done)&&(o.push(c.value),o.length!==r);M=!0);}catch(B){R=!0,m=B}finally{try{if(!M&&s.return!=null&&(T=s.return(),Object(T)!==T))return}finally{if(R)throw m}}return o}}function pJ(t){if(Array.isArray(t))return t}var F5=/[ \f\n\r\t\v\u2028\u2029]+/,B5=function(r){var s=r.children,c=r.breakAll,m=r.style;try{var v=[];bi(s)||(c?v=s.toString().split(""):v=s.toString().split(F5));var T=v.map(function(M){return{word:M,width:Ry(M,m).width}}),o=c?0:Ry(" ",m).width;return{wordsWithComputedWidth:T,spaceWidth:o}}catch{return null}},mJ=function(r,s,c,m,v){var T=r.maxLines,o=r.children,M=r.style,R=r.breakAll,B=kr(T),F=o,G=function(){var St=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return St.reduce(function(gt,Rt){var Ke=Rt.word,yt=Rt.width,Vt=gt[gt.length-1];if(Vt&&(m==null||v||Vt.width+yt+c<Number(m)))Vt.words.push(Ke),Vt.width+=yt+c;else{var qe={words:[Ke],width:yt};gt.push(qe)}return gt},[])},K=G(s),ee=function(St){return St.reduce(function(gt,Rt){return gt.width>Rt.width?gt:Rt})};if(!B)return K;for(var H="…",Z=function(St){var gt=F.slice(0,St),Rt=B5({breakAll:R,style:M,children:gt+H}).wordsWithComputedWidth,Ke=G(Rt),yt=Ke.length>T||ee(Ke).width>Number(m);return[yt,Ke]},ae=0,fe=F.length-1,ue=0,_e;ae<=fe&&ue<=F.length-1;){var le=Math.floor((ae+fe)/2),pe=le-1,Te=Z(pe),De=Bz(Te,2),Xe=De[0],wt=De[1],$e=Z(le),vt=Bz($e,1),ft=vt[0];if(!Xe&&!ft&&(ae=le+1),Xe&&ft&&(fe=le-1),!Xe&&ft){_e=wt;break}ue++}return _e||K},jz=function(r){var s=bi(r)?[]:r.toString().split(F5);return[{words:s}]},gJ=function(r){var s=r.width,c=r.scaleToFit,m=r.children,v=r.style,T=r.breakAll,o=r.maxLines;if((s||c)&&!S_.isSsr){var M,R,B=B5({breakAll:T,children:m,style:v});if(B){var F=B.wordsWithComputedWidth,G=B.spaceWidth;M=F,R=G}else return jz(m);return mJ({breakAll:T,children:m,maxLines:o,style:v},M,R,s,c)}return jz(m)},Uz="#808080",Lm=function(r){var s=r.x,c=s===void 0?0:s,m=r.y,v=m===void 0?0:m,T=r.lineHeight,o=T===void 0?"1em":T,M=r.capHeight,R=M===void 0?"0.71em":M,B=r.scaleToFit,F=B===void 0?!1:B,G=r.textAnchor,K=G===void 0?"start":G,ee=r.verticalAnchor,H=ee===void 0?"end":ee,Z=r.fill,ae=Z===void 0?Uz:Z,fe=Fz(r,lJ),ue=Le.useMemo(function(){return gJ({breakAll:fe.breakAll,children:fe.children,maxLines:fe.maxLines,scaleToFit:F,style:fe.style,width:fe.width})},[fe.breakAll,fe.children,fe.maxLines,F,fe.style,fe.width]),_e=fe.dx,le=fe.dy,pe=fe.angle,Te=fe.className,De=fe.breakAll,Xe=Fz(fe,cJ);if(!za(c)||!za(v))return null;var wt=c+(kr(_e)?_e:0),$e=v+(kr(le)?le:0),vt;switch(H){case"start":vt=zE("calc(".concat(R,")"));break;case"middle":vt=zE("calc(".concat((ue.length-1)/2," * -").concat(o," + (").concat(R," / 2))"));break;default:vt=zE("calc(".concat(ue.length-1," * -").concat(o,")"));break}var ft=[];if(F){var bt=ue[0].width,St=fe.width;ft.push("scale(".concat((kr(St)?St/bt:1)/bt,")"))}return pe&&ft.push("rotate(".concat(pe,", ").concat(wt,", ").concat($e,")")),ft.length&&(Xe.transform=ft.join(" ")),ht.createElement("text",l2({},Vn(Xe,!0),{x:wt,y:$e,className:ci("recharts-text",Te),textAnchor:K,fill:ae.includes("url")?Uz:ae}),ue.map(function(gt,Rt){var Ke=gt.words.join(De?"":" ");return ht.createElement("tspan",{x:wt,dy:Rt===0?vt:o,key:"".concat(Ke,"-").concat(Rt)},Ke)}))};function Cp(t,r){return t==null||r==null?NaN:t<r?-1:t>r?1:t>=r?0:NaN}function _J(t,r){return t==null||r==null?NaN:r<t?-1:r>t?1:r>=t?0:NaN}function YP(t){let r,s,c;t.length!==2?(r=Cp,s=(o,M)=>Cp(t(o),M),c=(o,M)=>t(o)-M):(r=t===Cp||t===_J?t:yJ,s=t,c=t);function m(o,M,R=0,B=o.length){if(R<B){if(r(M,M)!==0)return B;do{const F=R+B>>>1;s(o[F],M)<0?R=F+1:B=F}while(R<B)}return R}function v(o,M,R=0,B=o.length){if(R<B){if(r(M,M)!==0)return B;do{const F=R+B>>>1;s(o[F],M)<=0?R=F+1:B=F}while(R<B)}return R}function T(o,M,R=0,B=o.length){const F=m(o,M,R,B-1);return F>R&&c(o[F-1],M)>-c(o[F],M)?F-1:F}return{left:m,center:T,right:v}}function yJ(){return 0}function N5(t){return t===null?NaN:+t}function*vJ(t,r){for(let s of t)s!=null&&(s=+s)>=s&&(yield s)}const xJ=YP(Cp),Lv=xJ.right;YP(N5).center;class Vz extends Map{constructor(r,s=SJ){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:s}}),r!=null)for(const[c,m]of r)this.set(c,m)}get(r){return super.get($z(this,r))}has(r){return super.has($z(this,r))}set(r,s){return super.set(bJ(this,r),s)}delete(r){return super.delete(wJ(this,r))}}function $z({_intern:t,_key:r},s){const c=r(s);return t.has(c)?t.get(c):s}function bJ({_intern:t,_key:r},s){const c=r(s);return t.has(c)?t.get(c):(t.set(c,s),s)}function wJ({_intern:t,_key:r},s){const c=r(s);return t.has(c)&&(s=t.get(c),t.delete(c)),s}function SJ(t){return t!==null&&typeof t=="object"?t.valueOf():t}function TJ(t=Cp){if(t===Cp)return j5;if(typeof t!="function")throw new TypeError("compare is not a function");return(r,s)=>{const c=t(r,s);return c||c===0?c:(t(s,s)===0)-(t(r,r)===0)}}function j5(t,r){return(t==null||!(t>=t))-(r==null||!(r>=r))||(t<r?-1:t>r?1:0)}const EJ=Math.sqrt(50),AJ=Math.sqrt(10),PJ=Math.sqrt(2);function S0(t,r,s){const c=(r-t)/Math.max(0,s),m=Math.floor(Math.log10(c)),v=c/Math.pow(10,m),T=v>=EJ?10:v>=AJ?5:v>=PJ?2:1;let o,M,R;return m<0?(R=Math.pow(10,-m)/T,o=Math.round(t*R),M=Math.round(r*R),o/R<t&&++o,M/R>r&&--M,R=-R):(R=Math.pow(10,m)*T,o=Math.round(t/R),M=Math.round(r/R),o*R<t&&++o,M*R>r&&--M),M<o&&.5<=s&&s<2?S0(t,r,s*2):[o,M,R]}function c2(t,r,s){if(r=+r,t=+t,s=+s,!(s>0))return[];if(t===r)return[t];const c=r<t,[m,v,T]=c?S0(r,t,s):S0(t,r,s);if(!(v>=m))return[];const o=v-m+1,M=new Array(o);if(c)if(T<0)for(let R=0;R<o;++R)M[R]=(v-R)/-T;else for(let R=0;R<o;++R)M[R]=(v-R)*T;else if(T<0)for(let R=0;R<o;++R)M[R]=(m+R)/-T;else for(let R=0;R<o;++R)M[R]=(m+R)*T;return M}function u2(t,r,s){return r=+r,t=+t,s=+s,S0(t,r,s)[2]}function h2(t,r,s){r=+r,t=+t,s=+s;const c=r<t,m=c?u2(r,t,s):u2(t,r,s);return(c?-1:1)*(m<0?1/-m:m)}function qz(t,r){let s;for(const c of t)c!=null&&(s<c||s===void 0&&c>=c)&&(s=c);return s}function Gz(t,r){let s;for(const c of t)c!=null&&(s>c||s===void 0&&c>=c)&&(s=c);return s}function U5(t,r,s=0,c=1/0,m){if(r=Math.floor(r),s=Math.floor(Math.max(0,s)),c=Math.floor(Math.min(t.length-1,c)),!(s<=r&&r<=c))return t;for(m=m===void 0?j5:TJ(m);c>s;){if(c-s>600){const M=c-s+1,R=r-s+1,B=Math.log(M),F=.5*Math.exp(2*B/3),G=.5*Math.sqrt(B*F*(M-F)/M)*(R-M/2<0?-1:1),K=Math.max(s,Math.floor(r-R*F/M+G)),ee=Math.min(c,Math.floor(r+(M-R)*F/M+G));U5(t,r,K,ee,m)}const v=t[r];let T=s,o=c;for(xy(t,s,r),m(t[c],v)>0&&xy(t,s,c);T<o;){for(xy(t,T,o),++T,--o;m(t[T],v)<0;)++T;for(;m(t[o],v)>0;)--o}m(t[s],v)===0?xy(t,s,o):(++o,xy(t,o,c)),o<=r&&(s=o+1),r<=o&&(c=o-1)}return t}function xy(t,r,s){const c=t[r];t[r]=t[s],t[s]=c}function IJ(t,r,s){if(t=Float64Array.from(vJ(t)),!(!(c=t.length)||isNaN(r=+r))){if(r<=0||c<2)return Gz(t);if(r>=1)return qz(t);var c,m=(c-1)*r,v=Math.floor(m),T=qz(U5(t,v).subarray(0,v+1)),o=Gz(t.subarray(v+1));return T+(o-T)*(m-v)}}function CJ(t,r,s=N5){if(!(!(c=t.length)||isNaN(r=+r))){if(r<=0||c<2)return+s(t[0],0,t);if(r>=1)return+s(t[c-1],c-1,t);var c,m=(c-1)*r,v=Math.floor(m),T=+s(t[v],v,t),o=+s(t[v+1],v+1,t);return T+(o-T)*(m-v)}}function MJ(t,r,s){t=+t,r=+r,s=(m=arguments.length)<2?(r=t,t=0,1):m<3?1:+s;for(var c=-1,m=Math.max(0,Math.ceil((r-t)/s))|0,v=new Array(m);++c<m;)v[c]=t+c*s;return v}function Yc(t,r){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(r).domain(t);break}return this}function dd(t,r){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof r=="function"?this.interpolator(r):this.range(r);break}}return this}const f2=Symbol("implicit");function JP(){var t=new Vz,r=[],s=[],c=f2;function m(v){let T=t.get(v);if(T===void 0){if(c!==f2)return c;t.set(v,T=r.push(v)-1)}return s[T%s.length]}return m.domain=function(v){if(!arguments.length)return r.slice();r=[],t=new Vz;for(const T of v)t.has(T)||t.set(T,r.push(T)-1);return m},m.range=function(v){return arguments.length?(s=Array.from(v),m):s.slice()},m.unknown=function(v){return arguments.length?(c=v,m):c},m.copy=function(){return JP(r,s).unknown(c)},Yc.apply(m,arguments),m}function Ky(){var t=JP().unknown(void 0),r=t.domain,s=t.range,c=0,m=1,v,T,o=!1,M=0,R=0,B=.5;delete t.unknown;function F(){var G=r().length,K=m<c,ee=K?m:c,H=K?c:m;v=(H-ee)/Math.max(1,G-M+R*2),o&&(v=Math.floor(v)),ee+=(H-ee-v*(G-M))*B,T=v*(1-M),o&&(ee=Math.round(ee),T=Math.round(T));var Z=MJ(G).map(function(ae){return ee+v*ae});return s(K?Z.reverse():Z)}return t.domain=function(G){return arguments.length?(r(G),F()):r()},t.range=function(G){return arguments.length?([c,m]=G,c=+c,m=+m,F()):[c,m]},t.rangeRound=function(G){return[c,m]=G,c=+c,m=+m,o=!0,F()},t.bandwidth=function(){return T},t.step=function(){return v},t.round=function(G){return arguments.length?(o=!!G,F()):o},t.padding=function(G){return arguments.length?(M=Math.min(1,R=+G),F()):M},t.paddingInner=function(G){return arguments.length?(M=Math.min(1,G),F()):M},t.paddingOuter=function(G){return arguments.length?(R=+G,F()):R},t.align=function(G){return arguments.length?(B=Math.max(0,Math.min(1,G)),F()):B},t.copy=function(){return Ky(r(),[c,m]).round(o).paddingInner(M).paddingOuter(R).align(B)},Yc.apply(F(),arguments)}function V5(t){var r=t.copy;return t.padding=t.paddingOuter,delete t.paddingInner,delete t.paddingOuter,t.copy=function(){return V5(r())},t}function Dy(){return V5(Ky.apply(null,arguments).paddingInner(1))}function QP(t,r,s){t.prototype=r.prototype=s,s.constructor=t}function $5(t,r){var s=Object.create(t.prototype);for(var c in r)s[c]=r[c];return s}function zv(){}var Yy=.7,T0=1/Yy,Vg="\\s*([+-]?\\d+)\\s*",Jy="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Hh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",OJ=/^#([0-9a-f]{3,8})$/,RJ=new RegExp(`^rgb\\(${Vg},${Vg},${Vg}\\)$`),DJ=new RegExp(`^rgb\\(${Hh},${Hh},${Hh}\\)$`),kJ=new RegExp(`^rgba\\(${Vg},${Vg},${Vg},${Jy}\\)$`),LJ=new RegExp(`^rgba\\(${Hh},${Hh},${Hh},${Jy}\\)$`),zJ=new RegExp(`^hsl\\(${Jy},${Hh},${Hh}\\)$`),FJ=new RegExp(`^hsla\\(${Jy},${Hh},${Hh},${Jy}\\)$`),Hz={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};QP(zv,Qy,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Wz,formatHex:Wz,formatHex8:BJ,formatHsl:NJ,formatRgb:Zz,toString:Zz});function Wz(){return this.rgb().formatHex()}function BJ(){return this.rgb().formatHex8()}function NJ(){return q5(this).formatHsl()}function Zz(){return this.rgb().formatRgb()}function Qy(t){var r,s;return t=(t+"").trim().toLowerCase(),(r=OJ.exec(t))?(s=r[1].length,r=parseInt(r[1],16),s===6?Xz(r):s===3?new Sl(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):s===8?Hx(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):s===4?Hx(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=RJ.exec(t))?new Sl(r[1],r[2],r[3],1):(r=DJ.exec(t))?new Sl(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=kJ.exec(t))?Hx(r[1],r[2],r[3],r[4]):(r=LJ.exec(t))?Hx(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=zJ.exec(t))?Jz(r[1],r[2]/100,r[3]/100,1):(r=FJ.exec(t))?Jz(r[1],r[2]/100,r[3]/100,r[4]):Hz.hasOwnProperty(t)?Xz(Hz[t]):t==="transparent"?new Sl(NaN,NaN,NaN,0):null}function Xz(t){return new Sl(t>>16&255,t>>8&255,t&255,1)}function Hx(t,r,s,c){return c<=0&&(t=r=s=NaN),new Sl(t,r,s,c)}function jJ(t){return t instanceof zv||(t=Qy(t)),t?(t=t.rgb(),new Sl(t.r,t.g,t.b,t.opacity)):new Sl}function d2(t,r,s,c){return arguments.length===1?jJ(t):new Sl(t,r,s,c??1)}function Sl(t,r,s,c){this.r=+t,this.g=+r,this.b=+s,this.opacity=+c}QP(Sl,d2,$5(zv,{brighter(t){return t=t==null?T0:Math.pow(T0,t),new Sl(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Yy:Math.pow(Yy,t),new Sl(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Sl(Mm(this.r),Mm(this.g),Mm(this.b),E0(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Kz,formatHex:Kz,formatHex8:UJ,formatRgb:Yz,toString:Yz}));function Kz(){return`#${Pm(this.r)}${Pm(this.g)}${Pm(this.b)}`}function UJ(){return`#${Pm(this.r)}${Pm(this.g)}${Pm(this.b)}${Pm((isNaN(this.opacity)?1:this.opacity)*255)}`}function Yz(){const t=E0(this.opacity);return`${t===1?"rgb(":"rgba("}${Mm(this.r)}, ${Mm(this.g)}, ${Mm(this.b)}${t===1?")":`, ${t})`}`}function E0(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Mm(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Pm(t){return t=Mm(t),(t<16?"0":"")+t.toString(16)}function Jz(t,r,s,c){return c<=0?t=r=s=NaN:s<=0||s>=1?t=r=NaN:r<=0&&(t=NaN),new Hu(t,r,s,c)}function q5(t){if(t instanceof Hu)return new Hu(t.h,t.s,t.l,t.opacity);if(t instanceof zv||(t=Qy(t)),!t)return new Hu;if(t instanceof Hu)return t;t=t.rgb();var r=t.r/255,s=t.g/255,c=t.b/255,m=Math.min(r,s,c),v=Math.max(r,s,c),T=NaN,o=v-m,M=(v+m)/2;return o?(r===v?T=(s-c)/o+(s<c)*6:s===v?T=(c-r)/o+2:T=(r-s)/o+4,o/=M<.5?v+m:2-v-m,T*=60):o=M>0&&M<1?0:T,new Hu(T,o,M,t.opacity)}function VJ(t,r,s,c){return arguments.length===1?q5(t):new Hu(t,r,s,c??1)}function Hu(t,r,s,c){this.h=+t,this.s=+r,this.l=+s,this.opacity=+c}QP(Hu,VJ,$5(zv,{brighter(t){return t=t==null?T0:Math.pow(T0,t),new Hu(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Yy:Math.pow(Yy,t),new Hu(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,r=isNaN(t)||isNaN(this.s)?0:this.s,s=this.l,c=s+(s<.5?s:1-s)*r,m=2*s-c;return new Sl(FE(t>=240?t-240:t+120,m,c),FE(t,m,c),FE(t<120?t+240:t-120,m,c),this.opacity)},clamp(){return new Hu(Qz(this.h),Wx(this.s),Wx(this.l),E0(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=E0(this.opacity);return`${t===1?"hsl(":"hsla("}${Qz(this.h)}, ${Wx(this.s)*100}%, ${Wx(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Qz(t){return t=(t||0)%360,t<0?t+360:t}function Wx(t){return Math.max(0,Math.min(1,t||0))}function FE(t,r,s){return(t<60?r+(s-r)*t/60:t<180?s:t<240?r+(s-r)*(240-t)/60:r)*255}const eI=t=>()=>t;function $J(t,r){return function(s){return t+s*r}}function qJ(t,r,s){return t=Math.pow(t,s),r=Math.pow(r,s)-t,s=1/s,function(c){return Math.pow(t+c*r,s)}}function GJ(t){return(t=+t)==1?G5:function(r,s){return s-r?qJ(r,s,t):eI(isNaN(r)?s:r)}}function G5(t,r){var s=r-t;return s?$J(t,s):eI(isNaN(t)?r:t)}const e3=(function t(r){var s=GJ(r);function c(m,v){var T=s((m=d2(m)).r,(v=d2(v)).r),o=s(m.g,v.g),M=s(m.b,v.b),R=G5(m.opacity,v.opacity);return function(B){return m.r=T(B),m.g=o(B),m.b=M(B),m.opacity=R(B),m+""}}return c.gamma=t,c})(1);function HJ(t,r){r||(r=[]);var s=t?Math.min(r.length,t.length):0,c=r.slice(),m;return function(v){for(m=0;m<s;++m)c[m]=t[m]*(1-v)+r[m]*v;return c}}function WJ(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ZJ(t,r){var s=r?r.length:0,c=t?Math.min(s,t.length):0,m=new Array(c),v=new Array(s),T;for(T=0;T<c;++T)m[T]=T_(t[T],r[T]);for(;T<s;++T)v[T]=r[T];return function(o){for(T=0;T<c;++T)v[T]=m[T](o);return v}}function XJ(t,r){var s=new Date;return t=+t,r=+r,function(c){return s.setTime(t*(1-c)+r*c),s}}function A0(t,r){return t=+t,r=+r,function(s){return t*(1-s)+r*s}}function KJ(t,r){var s={},c={},m;(t===null||typeof t!="object")&&(t={}),(r===null||typeof r!="object")&&(r={});for(m in r)m in t?s[m]=T_(t[m],r[m]):c[m]=r[m];return function(v){for(m in s)c[m]=s[m](v);return c}}var p2=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,BE=new RegExp(p2.source,"g");function YJ(t){return function(){return t}}function JJ(t){return function(r){return t(r)+""}}function QJ(t,r){var s=p2.lastIndex=BE.lastIndex=0,c,m,v,T=-1,o=[],M=[];for(t=t+"",r=r+"";(c=p2.exec(t))&&(m=BE.exec(r));)(v=m.index)>s&&(v=r.slice(s,v),o[T]?o[T]+=v:o[++T]=v),(c=c[0])===(m=m[0])?o[T]?o[T]+=m:o[++T]=m:(o[++T]=null,M.push({i:T,x:A0(c,m)})),s=BE.lastIndex;return s<r.length&&(v=r.slice(s),o[T]?o[T]+=v:o[++T]=v),o.length<2?M[0]?JJ(M[0].x):YJ(r):(r=M.length,function(R){for(var B=0,F;B<r;++B)o[(F=M[B]).i]=F.x(R);return o.join("")})}function T_(t,r){var s=typeof r,c;return r==null||s==="boolean"?eI(r):(s==="number"?A0:s==="string"?(c=Qy(r))?(r=c,e3):QJ:r instanceof Qy?e3:r instanceof Date?XJ:WJ(r)?HJ:Array.isArray(r)?ZJ:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?KJ:A0)(t,r)}function tI(t,r){return t=+t,r=+r,function(s){return Math.round(t*(1-s)+r*s)}}function eQ(t,r){r===void 0&&(r=t,t=T_);for(var s=0,c=r.length-1,m=r[0],v=new Array(c<0?0:c);s<c;)v[s]=t(m,m=r[++s]);return function(T){var o=Math.max(0,Math.min(c-1,Math.floor(T*=c)));return v[o](T-o)}}function tQ(t){return function(){return t}}function P0(t){return+t}var t3=[0,1];function Js(t){return t}function m2(t,r){return(r-=t=+t)?function(s){return(s-t)/r}:tQ(isNaN(r)?NaN:.5)}function rQ(t,r){var s;return t>r&&(s=t,t=r,r=s),function(c){return Math.max(t,Math.min(r,c))}}function nQ(t,r,s){var c=t[0],m=t[1],v=r[0],T=r[1];return m<c?(c=m2(m,c),v=s(T,v)):(c=m2(c,m),v=s(v,T)),function(o){return v(c(o))}}function iQ(t,r,s){var c=Math.min(t.length,r.length)-1,m=new Array(c),v=new Array(c),T=-1;for(t[c]<t[0]&&(t=t.slice().reverse(),r=r.slice().reverse());++T<c;)m[T]=m2(t[T],t[T+1]),v[T]=s(r[T],r[T+1]);return function(o){var M=Lv(t,o,1,c)-1;return v[M](m[M](o))}}function Fv(t,r){return r.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Ib(){var t=t3,r=t3,s=T_,c,m,v,T=Js,o,M,R;function B(){var G=Math.min(t.length,r.length);return T!==Js&&(T=rQ(t[0],t[G-1])),o=G>2?iQ:nQ,M=R=null,F}function F(G){return G==null||isNaN(G=+G)?v:(M||(M=o(t.map(c),r,s)))(c(T(G)))}return F.invert=function(G){return T(m((R||(R=o(r,t.map(c),A0)))(G)))},F.domain=function(G){return arguments.length?(t=Array.from(G,P0),B()):t.slice()},F.range=function(G){return arguments.length?(r=Array.from(G),B()):r.slice()},F.rangeRound=function(G){return r=Array.from(G),s=tI,B()},F.clamp=function(G){return arguments.length?(T=G?!0:Js,B()):T!==Js},F.interpolate=function(G){return arguments.length?(s=G,B()):s},F.unknown=function(G){return arguments.length?(v=G,F):v},function(G,K){return c=G,m=K,B()}}function rI(){return Ib()(Js,Js)}function oQ(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function I0(t,r){if((s=(t=r?t.toExponential(r-1):t.toExponential()).indexOf("e"))<0)return null;var s,c=t.slice(0,s);return[c.length>1?c[0]+c.slice(2):c,+t.slice(s+1)]}function Yg(t){return t=I0(Math.abs(t)),t?t[1]:NaN}function aQ(t,r){return function(s,c){for(var m=s.length,v=[],T=0,o=t[0],M=0;m>0&&o>0&&(M+o+1>c&&(o=Math.max(1,c-M)),v.push(s.substring(m-=o,m+o)),!((M+=o+1)>c));)o=t[T=(T+1)%t.length];return v.reverse().join(r)}}function sQ(t){return function(r){return r.replace(/[0-9]/g,function(s){return t[+s]})}}var lQ=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ev(t){if(!(r=lQ.exec(t)))throw new Error("invalid format: "+t);var r;return new nI({fill:r[1],align:r[2],sign:r[3],symbol:r[4],zero:r[5],width:r[6],comma:r[7],precision:r[8]&&r[8].slice(1),trim:r[9],type:r[10]})}ev.prototype=nI.prototype;function nI(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}nI.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function cQ(t){e:for(var r=t.length,s=1,c=-1,m;s<r;++s)switch(t[s]){case".":c=m=s;break;case"0":c===0&&(c=s),m=s;break;default:if(!+t[s])break e;c>0&&(c=0);break}return c>0?t.slice(0,c)+t.slice(m+1):t}var H5;function uQ(t,r){var s=I0(t,r);if(!s)return t+"";var c=s[0],m=s[1],v=m-(H5=Math.max(-8,Math.min(8,Math.floor(m/3)))*3)+1,T=c.length;return v===T?c:v>T?c+new Array(v-T+1).join("0"):v>0?c.slice(0,v)+"."+c.slice(v):"0."+new Array(1-v).join("0")+I0(t,Math.max(0,r+v-1))[0]}function r3(t,r){var s=I0(t,r);if(!s)return t+"";var c=s[0],m=s[1];return m<0?"0."+new Array(-m).join("0")+c:c.length>m+1?c.slice(0,m+1)+"."+c.slice(m+1):c+new Array(m-c.length+2).join("0")}const n3={"%":(t,r)=>(t*100).toFixed(r),b:t=>Math.round(t).toString(2),c:t=>t+"",d:oQ,e:(t,r)=>t.toExponential(r),f:(t,r)=>t.toFixed(r),g:(t,r)=>t.toPrecision(r),o:t=>Math.round(t).toString(8),p:(t,r)=>r3(t*100,r),r:r3,s:uQ,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function i3(t){return t}var o3=Array.prototype.map,a3=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function hQ(t){var r=t.grouping===void 0||t.thousands===void 0?i3:aQ(o3.call(t.grouping,Number),t.thousands+""),s=t.currency===void 0?"":t.currency[0]+"",c=t.currency===void 0?"":t.currency[1]+"",m=t.decimal===void 0?".":t.decimal+"",v=t.numerals===void 0?i3:sQ(o3.call(t.numerals,String)),T=t.percent===void 0?"%":t.percent+"",o=t.minus===void 0?"−":t.minus+"",M=t.nan===void 0?"NaN":t.nan+"";function R(F){F=ev(F);var G=F.fill,K=F.align,ee=F.sign,H=F.symbol,Z=F.zero,ae=F.width,fe=F.comma,ue=F.precision,_e=F.trim,le=F.type;le==="n"?(fe=!0,le="g"):n3[le]||(ue===void 0&&(ue=12),_e=!0,le="g"),(Z||G==="0"&&K==="=")&&(Z=!0,G="0",K="=");var pe=H==="$"?s:H==="#"&&/[boxX]/.test(le)?"0"+le.toLowerCase():"",Te=H==="$"?c:/[%p]/.test(le)?T:"",De=n3[le],Xe=/[defgprs%]/.test(le);ue=ue===void 0?6:/[gprs]/.test(le)?Math.max(1,Math.min(21,ue)):Math.max(0,Math.min(20,ue));function wt($e){var vt=pe,ft=Te,bt,St,gt;if(le==="c")ft=De($e)+ft,$e="";else{$e=+$e;var Rt=$e<0||1/$e<0;if($e=isNaN($e)?M:De(Math.abs($e),ue),_e&&($e=cQ($e)),Rt&&+$e==0&&ee!=="+"&&(Rt=!1),vt=(Rt?ee==="("?ee:o:ee==="-"||ee==="("?"":ee)+vt,ft=(le==="s"?a3[8+H5/3]:"")+ft+(Rt&&ee==="("?")":""),Xe){for(bt=-1,St=$e.length;++bt<St;)if(gt=$e.charCodeAt(bt),48>gt||gt>57){ft=(gt===46?m+$e.slice(bt+1):$e.slice(bt))+ft,$e=$e.slice(0,bt);break}}}fe&&!Z&&($e=r($e,1/0));var Ke=vt.length+$e.length+ft.length,yt=Ke<ae?new Array(ae-Ke+1).join(G):"";switch(fe&&Z&&($e=r(yt+$e,yt.length?ae-ft.length:1/0),yt=""),K){case"<":$e=vt+$e+ft+yt;break;case"=":$e=vt+yt+$e+ft;break;case"^":$e=yt.slice(0,Ke=yt.length>>1)+vt+$e+ft+yt.slice(Ke);break;default:$e=yt+vt+$e+ft;break}return v($e)}return wt.toString=function(){return F+""},wt}function B(F,G){var K=R((F=ev(F),F.type="f",F)),ee=Math.max(-8,Math.min(8,Math.floor(Yg(G)/3)))*3,H=Math.pow(10,-ee),Z=a3[8+ee/3];return function(ae){return K(H*ae)+Z}}return{format:R,formatPrefix:B}}var Zx,iI,W5;fQ({thousands:",",grouping:[3],currency:["$",""]});function fQ(t){return Zx=hQ(t),iI=Zx.format,W5=Zx.formatPrefix,Zx}function dQ(t){return Math.max(0,-Yg(Math.abs(t)))}function pQ(t,r){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Yg(r)/3)))*3-Yg(Math.abs(t)))}function mQ(t,r){return t=Math.abs(t),r=Math.abs(r)-t,Math.max(0,Yg(r)-Yg(t))+1}function Z5(t,r,s,c){var m=h2(t,r,s),v;switch(c=ev(c??",f"),c.type){case"s":{var T=Math.max(Math.abs(t),Math.abs(r));return c.precision==null&&!isNaN(v=pQ(m,T))&&(c.precision=v),W5(c,T)}case"":case"e":case"g":case"p":case"r":{c.precision==null&&!isNaN(v=mQ(m,Math.max(Math.abs(t),Math.abs(r))))&&(c.precision=v-(c.type==="e"));break}case"f":case"%":{c.precision==null&&!isNaN(v=dQ(m))&&(c.precision=v-(c.type==="%")*2);break}}return iI(c)}function Lp(t){var r=t.domain;return t.ticks=function(s){var c=r();return c2(c[0],c[c.length-1],s??10)},t.tickFormat=function(s,c){var m=r();return Z5(m[0],m[m.length-1],s??10,c)},t.nice=function(s){s==null&&(s=10);var c=r(),m=0,v=c.length-1,T=c[m],o=c[v],M,R,B=10;for(o<T&&(R=T,T=o,o=R,R=m,m=v,v=R);B-- >0;){if(R=u2(T,o,s),R===M)return c[m]=T,c[v]=o,r(c);if(R>0)T=Math.floor(T/R)*R,o=Math.ceil(o/R)*R;else if(R<0)T=Math.ceil(T*R)/R,o=Math.floor(o*R)/R;else break;M=R}return t},t}function C0(){var t=rI();return t.copy=function(){return Fv(t,C0())},Yc.apply(t,arguments),Lp(t)}function X5(t){var r;function s(c){return c==null||isNaN(c=+c)?r:c}return s.invert=s,s.domain=s.range=function(c){return arguments.length?(t=Array.from(c,P0),s):t.slice()},s.unknown=function(c){return arguments.length?(r=c,s):r},s.copy=function(){return X5(t).unknown(r)},t=arguments.length?Array.from(t,P0):[0,1],Lp(s)}function K5(t,r){t=t.slice();var s=0,c=t.length-1,m=t[s],v=t[c],T;return v<m&&(T=s,s=c,c=T,T=m,m=v,v=T),t[s]=r.floor(m),t[c]=r.ceil(v),t}function s3(t){return Math.log(t)}function l3(t){return Math.exp(t)}function gQ(t){return-Math.log(-t)}function _Q(t){return-Math.exp(-t)}function yQ(t){return isFinite(t)?+("1e"+t):t<0?0:t}function vQ(t){return t===10?yQ:t===Math.E?Math.exp:r=>Math.pow(t,r)}function xQ(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),r=>Math.log(r)/t)}function c3(t){return(r,s)=>-t(-r,s)}function oI(t){const r=t(s3,l3),s=r.domain;let c=10,m,v;function T(){return m=xQ(c),v=vQ(c),s()[0]<0?(m=c3(m),v=c3(v),t(gQ,_Q)):t(s3,l3),r}return r.base=function(o){return arguments.length?(c=+o,T()):c},r.domain=function(o){return arguments.length?(s(o),T()):s()},r.ticks=o=>{const M=s();let R=M[0],B=M[M.length-1];const F=B<R;F&&([R,B]=[B,R]);let G=m(R),K=m(B),ee,H;const Z=o==null?10:+o;let ae=[];if(!(c%1)&&K-G<Z){if(G=Math.floor(G),K=Math.ceil(K),R>0){for(;G<=K;++G)for(ee=1;ee<c;++ee)if(H=G<0?ee/v(-G):ee*v(G),!(H<R)){if(H>B)break;ae.push(H)}}else for(;G<=K;++G)for(ee=c-1;ee>=1;--ee)if(H=G>0?ee/v(-G):ee*v(G),!(H<R)){if(H>B)break;ae.push(H)}ae.length*2<Z&&(ae=c2(R,B,Z))}else ae=c2(G,K,Math.min(K-G,Z)).map(v);return F?ae.reverse():ae},r.tickFormat=(o,M)=>{if(o==null&&(o=10),M==null&&(M=c===10?"s":","),typeof M!="function"&&(!(c%1)&&(M=ev(M)).precision==null&&(M.trim=!0),M=iI(M)),o===1/0)return M;const R=Math.max(1,c*o/r.ticks().length);return B=>{let F=B/v(Math.round(m(B)));return F*c<c-.5&&(F*=c),F<=R?M(B):""}},r.nice=()=>s(K5(s(),{floor:o=>v(Math.floor(m(o))),ceil:o=>v(Math.ceil(m(o)))})),r}function Y5(){const t=oI(Ib()).domain([1,10]);return t.copy=()=>Fv(t,Y5()).base(t.base()),Yc.apply(t,arguments),t}function u3(t){return function(r){return Math.sign(r)*Math.log1p(Math.abs(r/t))}}function h3(t){return function(r){return Math.sign(r)*Math.expm1(Math.abs(r))*t}}function aI(t){var r=1,s=t(u3(r),h3(r));return s.constant=function(c){return arguments.length?t(u3(r=+c),h3(r)):r},Lp(s)}function J5(){var t=aI(Ib());return t.copy=function(){return Fv(t,J5()).constant(t.constant())},Yc.apply(t,arguments)}function f3(t){return function(r){return r<0?-Math.pow(-r,t):Math.pow(r,t)}}function bQ(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function wQ(t){return t<0?-t*t:t*t}function sI(t){var r=t(Js,Js),s=1;function c(){return s===1?t(Js,Js):s===.5?t(bQ,wQ):t(f3(s),f3(1/s))}return r.exponent=function(m){return arguments.length?(s=+m,c()):s},Lp(r)}function lI(){var t=sI(Ib());return t.copy=function(){return Fv(t,lI()).exponent(t.exponent())},Yc.apply(t,arguments),t}function SQ(){return lI.apply(null,arguments).exponent(.5)}function d3(t){return Math.sign(t)*t*t}function TQ(t){return Math.sign(t)*Math.sqrt(Math.abs(t))}function Q5(){var t=rI(),r=[0,1],s=!1,c;function m(v){var T=TQ(t(v));return isNaN(T)?c:s?Math.round(T):T}return m.invert=function(v){return t.invert(d3(v))},m.domain=function(v){return arguments.length?(t.domain(v),m):t.domain()},m.range=function(v){return arguments.length?(t.range((r=Array.from(v,P0)).map(d3)),m):r.slice()},m.rangeRound=function(v){return m.range(v).round(!0)},m.round=function(v){return arguments.length?(s=!!v,m):s},m.clamp=function(v){return arguments.length?(t.clamp(v),m):t.clamp()},m.unknown=function(v){return arguments.length?(c=v,m):c},m.copy=function(){return Q5(t.domain(),r).round(s).clamp(t.clamp()).unknown(c)},Yc.apply(m,arguments),Lp(m)}function e4(){var t=[],r=[],s=[],c;function m(){var T=0,o=Math.max(1,r.length);for(s=new Array(o-1);++T<o;)s[T-1]=CJ(t,T/o);return v}function v(T){return T==null||isNaN(T=+T)?c:r[Lv(s,T)]}return v.invertExtent=function(T){var o=r.indexOf(T);return o<0?[NaN,NaN]:[o>0?s[o-1]:t[0],o<s.length?s[o]:t[t.length-1]]},v.domain=function(T){if(!arguments.length)return t.slice();t=[];for(let o of T)o!=null&&!isNaN(o=+o)&&t.push(o);return t.sort(Cp),m()},v.range=function(T){return arguments.length?(r=Array.from(T),m()):r.slice()},v.unknown=function(T){return arguments.length?(c=T,v):c},v.quantiles=function(){return s.slice()},v.copy=function(){return e4().domain(t).range(r).unknown(c)},Yc.apply(v,arguments)}function t4(){var t=0,r=1,s=1,c=[.5],m=[0,1],v;function T(M){return M!=null&&M<=M?m[Lv(c,M,0,s)]:v}function o(){var M=-1;for(c=new Array(s);++M<s;)c[M]=((M+1)*r-(M-s)*t)/(s+1);return T}return T.domain=function(M){return arguments.length?([t,r]=M,t=+t,r=+r,o()):[t,r]},T.range=function(M){return arguments.length?(s=(m=Array.from(M)).length-1,o()):m.slice()},T.invertExtent=function(M){var R=m.indexOf(M);return R<0?[NaN,NaN]:R<1?[t,c[0]]:R>=s?[c[s-1],r]:[c[R-1],c[R]]},T.unknown=function(M){return arguments.length&&(v=M),T},T.thresholds=function(){return c.slice()},T.copy=function(){return t4().domain([t,r]).range(m).unknown(v)},Yc.apply(Lp(T),arguments)}function r4(){var t=[.5],r=[0,1],s,c=1;function m(v){return v!=null&&v<=v?r[Lv(t,v,0,c)]:s}return m.domain=function(v){return arguments.length?(t=Array.from(v),c=Math.min(t.length,r.length-1),m):t.slice()},m.range=function(v){return arguments.length?(r=Array.from(v),c=Math.min(t.length,r.length-1),m):r.slice()},m.invertExtent=function(v){var T=r.indexOf(v);return[t[T-1],t[T]]},m.unknown=function(v){return arguments.length?(s=v,m):s},m.copy=function(){return r4().domain(t).range(r).unknown(s)},Yc.apply(m,arguments)}const NE=new Date,jE=new Date;function Fa(t,r,s,c){function m(v){return t(v=arguments.length===0?new Date:new Date(+v)),v}return m.floor=v=>(t(v=new Date(+v)),v),m.ceil=v=>(t(v=new Date(v-1)),r(v,1),t(v),v),m.round=v=>{const T=m(v),o=m.ceil(v);return v-T<o-v?T:o},m.offset=(v,T)=>(r(v=new Date(+v),T==null?1:Math.floor(T)),v),m.range=(v,T,o)=>{const M=[];if(v=m.ceil(v),o=o==null?1:Math.floor(o),!(v<T)||!(o>0))return M;let R;do M.push(R=new Date(+v)),r(v,o),t(v);while(R<v&&v<T);return M},m.filter=v=>Fa(T=>{if(T>=T)for(;t(T),!v(T);)T.setTime(T-1)},(T,o)=>{if(T>=T)if(o<0)for(;++o<=0;)for(;r(T,-1),!v(T););else for(;--o>=0;)for(;r(T,1),!v(T););}),s&&(m.count=(v,T)=>(NE.setTime(+v),jE.setTime(+T),t(NE),t(jE),Math.floor(s(NE,jE))),m.every=v=>(v=Math.floor(v),!isFinite(v)||!(v>0)?null:v>1?m.filter(c?T=>c(T)%v===0:T=>m.count(0,T)%v===0):m)),m}const M0=Fa(()=>{},(t,r)=>{t.setTime(+t+r)},(t,r)=>r-t);M0.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?Fa(r=>{r.setTime(Math.floor(r/t)*t)},(r,s)=>{r.setTime(+r+s*t)},(r,s)=>(s-r)/t):M0);M0.range;const Jf=1e3,Wc=Jf*60,Qf=Wc*60,ad=Qf*24,cI=ad*7,p3=ad*30,UE=ad*365,Im=Fa(t=>{t.setTime(t-t.getMilliseconds())},(t,r)=>{t.setTime(+t+r*Jf)},(t,r)=>(r-t)/Jf,t=>t.getUTCSeconds());Im.range;const uI=Fa(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Jf)},(t,r)=>{t.setTime(+t+r*Wc)},(t,r)=>(r-t)/Wc,t=>t.getMinutes());uI.range;const hI=Fa(t=>{t.setUTCSeconds(0,0)},(t,r)=>{t.setTime(+t+r*Wc)},(t,r)=>(r-t)/Wc,t=>t.getUTCMinutes());hI.range;const fI=Fa(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Jf-t.getMinutes()*Wc)},(t,r)=>{t.setTime(+t+r*Qf)},(t,r)=>(r-t)/Qf,t=>t.getHours());fI.range;const dI=Fa(t=>{t.setUTCMinutes(0,0,0)},(t,r)=>{t.setTime(+t+r*Qf)},(t,r)=>(r-t)/Qf,t=>t.getUTCHours());dI.range;const Bv=Fa(t=>t.setHours(0,0,0,0),(t,r)=>t.setDate(t.getDate()+r),(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*Wc)/ad,t=>t.getDate()-1);Bv.range;const Cb=Fa(t=>{t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r)},(t,r)=>(r-t)/ad,t=>t.getUTCDate()-1);Cb.range;const n4=Fa(t=>{t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r)},(t,r)=>(r-t)/ad,t=>Math.floor(t/ad));n4.range;function Vm(t){return Fa(r=>{r.setDate(r.getDate()-(r.getDay()+7-t)%7),r.setHours(0,0,0,0)},(r,s)=>{r.setDate(r.getDate()+s*7)},(r,s)=>(s-r-(s.getTimezoneOffset()-r.getTimezoneOffset())*Wc)/cI)}const Mb=Vm(0),O0=Vm(1),EQ=Vm(2),AQ=Vm(3),Jg=Vm(4),PQ=Vm(5),IQ=Vm(6);Mb.range;O0.range;EQ.range;AQ.range;Jg.range;PQ.range;IQ.range;function $m(t){return Fa(r=>{r.setUTCDate(r.getUTCDate()-(r.getUTCDay()+7-t)%7),r.setUTCHours(0,0,0,0)},(r,s)=>{r.setUTCDate(r.getUTCDate()+s*7)},(r,s)=>(s-r)/cI)}const Ob=$m(0),R0=$m(1),CQ=$m(2),MQ=$m(3),Qg=$m(4),OQ=$m(5),RQ=$m(6);Ob.range;R0.range;CQ.range;MQ.range;Qg.range;OQ.range;RQ.range;const pI=Fa(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,r)=>{t.setMonth(t.getMonth()+r)},(t,r)=>r.getMonth()-t.getMonth()+(r.getFullYear()-t.getFullYear())*12,t=>t.getMonth());pI.range;const mI=Fa(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCMonth(t.getUTCMonth()+r)},(t,r)=>r.getUTCMonth()-t.getUTCMonth()+(r.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());mI.range;const sd=Fa(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r)},(t,r)=>r.getFullYear()-t.getFullYear(),t=>t.getFullYear());sd.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:Fa(r=>{r.setFullYear(Math.floor(r.getFullYear()/t)*t),r.setMonth(0,1),r.setHours(0,0,0,0)},(r,s)=>{r.setFullYear(r.getFullYear()+s*t)});sd.range;const ld=Fa(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r)},(t,r)=>r.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());ld.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:Fa(r=>{r.setUTCFullYear(Math.floor(r.getUTCFullYear()/t)*t),r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},(r,s)=>{r.setUTCFullYear(r.getUTCFullYear()+s*t)});ld.range;function i4(t,r,s,c,m,v){const T=[[Im,1,Jf],[Im,5,5*Jf],[Im,15,15*Jf],[Im,30,30*Jf],[v,1,Wc],[v,5,5*Wc],[v,15,15*Wc],[v,30,30*Wc],[m,1,Qf],[m,3,3*Qf],[m,6,6*Qf],[m,12,12*Qf],[c,1,ad],[c,2,2*ad],[s,1,cI],[r,1,p3],[r,3,3*p3],[t,1,UE]];function o(R,B,F){const G=B<R;G&&([R,B]=[B,R]);const K=F&&typeof F.range=="function"?F:M(R,B,F),ee=K?K.range(R,+B+1):[];return G?ee.reverse():ee}function M(R,B,F){const G=Math.abs(B-R)/F,K=YP(([,,Z])=>Z).right(T,G);if(K===T.length)return t.every(h2(R/UE,B/UE,F));if(K===0)return M0.every(Math.max(h2(R,B,F),1));const[ee,H]=T[G/T[K-1][2]<T[K][2]/G?K-1:K];return ee.every(H)}return[o,M]}const[DQ,kQ]=i4(ld,mI,Ob,n4,dI,hI),[LQ,zQ]=i4(sd,pI,Mb,Bv,fI,uI);function VE(t){if(0<=t.y&&t.y<100){var r=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return r.setFullYear(t.y),r}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function $E(t){if(0<=t.y&&t.y<100){var r=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return r.setUTCFullYear(t.y),r}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function by(t,r,s){return{y:t,m:r,d:s,H:0,M:0,S:0,L:0}}function FQ(t){var r=t.dateTime,s=t.date,c=t.time,m=t.periods,v=t.days,T=t.shortDays,o=t.months,M=t.shortMonths,R=wy(m),B=Sy(m),F=wy(v),G=Sy(v),K=wy(T),ee=Sy(T),H=wy(o),Z=Sy(o),ae=wy(M),fe=Sy(M),ue={a:Rt,A:Ke,b:yt,B:Vt,c:null,d:x3,e:x3,f:aee,g:gee,G:yee,H:nee,I:iee,j:oee,L:o4,m:see,M:lee,p:qe,q:mt,Q:S3,s:T3,S:cee,u:uee,U:hee,V:fee,w:dee,W:pee,x:null,X:null,y:mee,Y:_ee,Z:vee,"%":w3},_e={a:ar,A:Mr,b:Gr,B:Tr,c:null,d:b3,e:b3,f:See,g:Dee,G:Lee,H:xee,I:bee,j:wee,L:s4,m:Tee,M:Eee,p:vr,q:Br,Q:S3,s:T3,S:Aee,u:Pee,U:Iee,V:Cee,w:Mee,W:Oee,x:null,X:null,y:Ree,Y:kee,Z:zee,"%":w3},le={a:wt,A:$e,b:vt,B:ft,c:bt,d:y3,e:y3,f:QQ,g:_3,G:g3,H:v3,I:v3,j:XQ,L:JQ,m:ZQ,M:KQ,p:Xe,q:WQ,Q:tee,s:ree,S:YQ,u:VQ,U:$Q,V:qQ,w:UQ,W:GQ,x:St,X:gt,y:_3,Y:g3,Z:HQ,"%":eee};ue.x=pe(s,ue),ue.X=pe(c,ue),ue.c=pe(r,ue),_e.x=pe(s,_e),_e.X=pe(c,_e),_e.c=pe(r,_e);function pe(or,Ar){return function(un){var sr=[],ui=-1,Rn=0,In=or.length,hi,Yi,Sa;for(un instanceof Date||(un=new Date(+un));++ui<In;)or.charCodeAt(ui)===37&&(sr.push(or.slice(Rn,ui)),(Yi=m3[hi=or.charAt(++ui)])!=null?hi=or.charAt(++ui):Yi=hi==="e"?" ":"0",(Sa=Ar[hi])&&(hi=Sa(un,Yi)),sr.push(hi),Rn=ui+1);return sr.push(or.slice(Rn,ui)),sr.join("")}}function Te(or,Ar){return function(un){var sr=by(1900,void 0,1),ui=De(sr,or,un+="",0),Rn,In;if(ui!=un.length)return null;if("Q"in sr)return new Date(sr.Q);if("s"in sr)return new Date(sr.s*1e3+("L"in sr?sr.L:0));if(Ar&&!("Z"in sr)&&(sr.Z=0),"p"in sr&&(sr.H=sr.H%12+sr.p*12),sr.m===void 0&&(sr.m="q"in sr?sr.q:0),"V"in sr){if(sr.V<1||sr.V>53)return null;"w"in sr||(sr.w=1),"Z"in sr?(Rn=$E(by(sr.y,0,1)),In=Rn.getUTCDay(),Rn=In>4||In===0?R0.ceil(Rn):R0(Rn),Rn=Cb.offset(Rn,(sr.V-1)*7),sr.y=Rn.getUTCFullYear(),sr.m=Rn.getUTCMonth(),sr.d=Rn.getUTCDate()+(sr.w+6)%7):(Rn=VE(by(sr.y,0,1)),In=Rn.getDay(),Rn=In>4||In===0?O0.ceil(Rn):O0(Rn),Rn=Bv.offset(Rn,(sr.V-1)*7),sr.y=Rn.getFullYear(),sr.m=Rn.getMonth(),sr.d=Rn.getDate()+(sr.w+6)%7)}else("W"in sr||"U"in sr)&&("w"in sr||(sr.w="u"in sr?sr.u%7:"W"in sr?1:0),In="Z"in sr?$E(by(sr.y,0,1)).getUTCDay():VE(by(sr.y,0,1)).getDay(),sr.m=0,sr.d="W"in sr?(sr.w+6)%7+sr.W*7-(In+5)%7:sr.w+sr.U*7-(In+6)%7);return"Z"in sr?(sr.H+=sr.Z/100|0,sr.M+=sr.Z%100,$E(sr)):VE(sr)}}function De(or,Ar,un,sr){for(var ui=0,Rn=Ar.length,In=un.length,hi,Yi;ui<Rn;){if(sr>=In)return-1;if(hi=Ar.charCodeAt(ui++),hi===37){if(hi=Ar.charAt(ui++),Yi=le[hi in m3?Ar.charAt(ui++):hi],!Yi||(sr=Yi(or,un,sr))<0)return-1}else if(hi!=un.charCodeAt(sr++))return-1}return sr}function Xe(or,Ar,un){var sr=R.exec(Ar.slice(un));return sr?(or.p=B.get(sr[0].toLowerCase()),un+sr[0].length):-1}function wt(or,Ar,un){var sr=K.exec(Ar.slice(un));return sr?(or.w=ee.get(sr[0].toLowerCase()),un+sr[0].length):-1}function $e(or,Ar,un){var sr=F.exec(Ar.slice(un));return sr?(or.w=G.get(sr[0].toLowerCase()),un+sr[0].length):-1}function vt(or,Ar,un){var sr=ae.exec(Ar.slice(un));return sr?(or.m=fe.get(sr[0].toLowerCase()),un+sr[0].length):-1}function ft(or,Ar,un){var sr=H.exec(Ar.slice(un));return sr?(or.m=Z.get(sr[0].toLowerCase()),un+sr[0].length):-1}function bt(or,Ar,un){return De(or,r,Ar,un)}function St(or,Ar,un){return De(or,s,Ar,un)}function gt(or,Ar,un){return De(or,c,Ar,un)}function Rt(or){return T[or.getDay()]}function Ke(or){return v[or.getDay()]}function yt(or){return M[or.getMonth()]}function Vt(or){return o[or.getMonth()]}function qe(or){return m[+(or.getHours()>=12)]}function mt(or){return 1+~~(or.getMonth()/3)}function ar(or){return T[or.getUTCDay()]}function Mr(or){return v[or.getUTCDay()]}function Gr(or){return M[or.getUTCMonth()]}function Tr(or){return o[or.getUTCMonth()]}function vr(or){return m[+(or.getUTCHours()>=12)]}function Br(or){return 1+~~(or.getUTCMonth()/3)}return{format:function(or){var Ar=pe(or+="",ue);return Ar.toString=function(){return or},Ar},parse:function(or){var Ar=Te(or+="",!1);return Ar.toString=function(){return or},Ar},utcFormat:function(or){var Ar=pe(or+="",_e);return Ar.toString=function(){return or},Ar},utcParse:function(or){var Ar=Te(or+="",!0);return Ar.toString=function(){return or},Ar}}}var m3={"-":"",_:" ",0:"0"},ts=/^\s*\d+/,BQ=/^%/,NQ=/[\\^$*+?|[\]().{}]/g;function Ui(t,r,s){var c=t<0?"-":"",m=(c?-t:t)+"",v=m.length;return c+(v<s?new Array(s-v+1).join(r)+m:m)}function jQ(t){return t.replace(NQ,"\\$&")}function wy(t){return new RegExp("^(?:"+t.map(jQ).join("|")+")","i")}function Sy(t){return new Map(t.map((r,s)=>[r.toLowerCase(),s]))}function UQ(t,r,s){var c=ts.exec(r.slice(s,s+1));return c?(t.w=+c[0],s+c[0].length):-1}function VQ(t,r,s){var c=ts.exec(r.slice(s,s+1));return c?(t.u=+c[0],s+c[0].length):-1}function $Q(t,r,s){var c=ts.exec(r.slice(s,s+2));return c?(t.U=+c[0],s+c[0].length):-1}function qQ(t,r,s){var c=ts.exec(r.slice(s,s+2));return c?(t.V=+c[0],s+c[0].length):-1}function GQ(t,r,s){var c=ts.exec(r.slice(s,s+2));return c?(t.W=+c[0],s+c[0].length):-1}function g3(t,r,s){var c=ts.exec(r.slice(s,s+4));return c?(t.y=+c[0],s+c[0].length):-1}function _3(t,r,s){var c=ts.exec(r.slice(s,s+2));return c?(t.y=+c[0]+(+c[0]>68?1900:2e3),s+c[0].length):-1}function HQ(t,r,s){var c=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(r.slice(s,s+6));return c?(t.Z=c[1]?0:-(c[2]+(c[3]||"00")),s+c[0].length):-1}function WQ(t,r,s){var c=ts.exec(r.slice(s,s+1));return c?(t.q=c[0]*3-3,s+c[0].length):-1}function ZQ(t,r,s){var c=ts.exec(r.slice(s,s+2));return c?(t.m=c[0]-1,s+c[0].length):-1}function y3(t,r,s){var c=ts.exec(r.slice(s,s+2));return c?(t.d=+c[0],s+c[0].length):-1}function XQ(t,r,s){var c=ts.exec(r.slice(s,s+3));return c?(t.m=0,t.d=+c[0],s+c[0].length):-1}function v3(t,r,s){var c=ts.exec(r.slice(s,s+2));return c?(t.H=+c[0],s+c[0].length):-1}function KQ(t,r,s){var c=ts.exec(r.slice(s,s+2));return c?(t.M=+c[0],s+c[0].length):-1}function YQ(t,r,s){var c=ts.exec(r.slice(s,s+2));return c?(t.S=+c[0],s+c[0].length):-1}function JQ(t,r,s){var c=ts.exec(r.slice(s,s+3));return c?(t.L=+c[0],s+c[0].length):-1}function QQ(t,r,s){var c=ts.exec(r.slice(s,s+6));return c?(t.L=Math.floor(c[0]/1e3),s+c[0].length):-1}function eee(t,r,s){var c=BQ.exec(r.slice(s,s+1));return c?s+c[0].length:-1}function tee(t,r,s){var c=ts.exec(r.slice(s));return c?(t.Q=+c[0],s+c[0].length):-1}function ree(t,r,s){var c=ts.exec(r.slice(s));return c?(t.s=+c[0],s+c[0].length):-1}function x3(t,r){return Ui(t.getDate(),r,2)}function nee(t,r){return Ui(t.getHours(),r,2)}function iee(t,r){return Ui(t.getHours()%12||12,r,2)}function oee(t,r){return Ui(1+Bv.count(sd(t),t),r,3)}function o4(t,r){return Ui(t.getMilliseconds(),r,3)}function aee(t,r){return o4(t,r)+"000"}function see(t,r){return Ui(t.getMonth()+1,r,2)}function lee(t,r){return Ui(t.getMinutes(),r,2)}function cee(t,r){return Ui(t.getSeconds(),r,2)}function uee(t){var r=t.getDay();return r===0?7:r}function hee(t,r){return Ui(Mb.count(sd(t)-1,t),r,2)}function a4(t){var r=t.getDay();return r>=4||r===0?Jg(t):Jg.ceil(t)}function fee(t,r){return t=a4(t),Ui(Jg.count(sd(t),t)+(sd(t).getDay()===4),r,2)}function dee(t){return t.getDay()}function pee(t,r){return Ui(O0.count(sd(t)-1,t),r,2)}function mee(t,r){return Ui(t.getFullYear()%100,r,2)}function gee(t,r){return t=a4(t),Ui(t.getFullYear()%100,r,2)}function _ee(t,r){return Ui(t.getFullYear()%1e4,r,4)}function yee(t,r){var s=t.getDay();return t=s>=4||s===0?Jg(t):Jg.ceil(t),Ui(t.getFullYear()%1e4,r,4)}function vee(t){var r=t.getTimezoneOffset();return(r>0?"-":(r*=-1,"+"))+Ui(r/60|0,"0",2)+Ui(r%60,"0",2)}function b3(t,r){return Ui(t.getUTCDate(),r,2)}function xee(t,r){return Ui(t.getUTCHours(),r,2)}function bee(t,r){return Ui(t.getUTCHours()%12||12,r,2)}function wee(t,r){return Ui(1+Cb.count(ld(t),t),r,3)}function s4(t,r){return Ui(t.getUTCMilliseconds(),r,3)}function See(t,r){return s4(t,r)+"000"}function Tee(t,r){return Ui(t.getUTCMonth()+1,r,2)}function Eee(t,r){return Ui(t.getUTCMinutes(),r,2)}function Aee(t,r){return Ui(t.getUTCSeconds(),r,2)}function Pee(t){var r=t.getUTCDay();return r===0?7:r}function Iee(t,r){return Ui(Ob.count(ld(t)-1,t),r,2)}function l4(t){var r=t.getUTCDay();return r>=4||r===0?Qg(t):Qg.ceil(t)}function Cee(t,r){return t=l4(t),Ui(Qg.count(ld(t),t)+(ld(t).getUTCDay()===4),r,2)}function Mee(t){return t.getUTCDay()}function Oee(t,r){return Ui(R0.count(ld(t)-1,t),r,2)}function Ree(t,r){return Ui(t.getUTCFullYear()%100,r,2)}function Dee(t,r){return t=l4(t),Ui(t.getUTCFullYear()%100,r,2)}function kee(t,r){return Ui(t.getUTCFullYear()%1e4,r,4)}function Lee(t,r){var s=t.getUTCDay();return t=s>=4||s===0?Qg(t):Qg.ceil(t),Ui(t.getUTCFullYear()%1e4,r,4)}function zee(){return"+0000"}function w3(){return"%"}function S3(t){return+t}function T3(t){return Math.floor(+t/1e3)}var Og,c4,u4;Fee({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Fee(t){return Og=FQ(t),c4=Og.format,Og.parse,u4=Og.utcFormat,Og.utcParse,Og}function Bee(t){return new Date(t)}function Nee(t){return t instanceof Date?+t:+new Date(+t)}function gI(t,r,s,c,m,v,T,o,M,R){var B=rI(),F=B.invert,G=B.domain,K=R(".%L"),ee=R(":%S"),H=R("%I:%M"),Z=R("%I %p"),ae=R("%a %d"),fe=R("%b %d"),ue=R("%B"),_e=R("%Y");function le(pe){return(M(pe)<pe?K:o(pe)<pe?ee:T(pe)<pe?H:v(pe)<pe?Z:c(pe)<pe?m(pe)<pe?ae:fe:s(pe)<pe?ue:_e)(pe)}return B.invert=function(pe){return new Date(F(pe))},B.domain=function(pe){return arguments.length?G(Array.from(pe,Nee)):G().map(Bee)},B.ticks=function(pe){var Te=G();return t(Te[0],Te[Te.length-1],pe??10)},B.tickFormat=function(pe,Te){return Te==null?le:R(Te)},B.nice=function(pe){var Te=G();return(!pe||typeof pe.range!="function")&&(pe=r(Te[0],Te[Te.length-1],pe??10)),pe?G(K5(Te,pe)):B},B.copy=function(){return Fv(B,gI(t,r,s,c,m,v,T,o,M,R))},B}function jee(){return Yc.apply(gI(LQ,zQ,sd,pI,Mb,Bv,fI,uI,Im,c4).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Uee(){return Yc.apply(gI(DQ,kQ,ld,mI,Ob,Cb,dI,hI,Im,u4).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Rb(){var t=0,r=1,s,c,m,v,T=Js,o=!1,M;function R(F){return F==null||isNaN(F=+F)?M:T(m===0?.5:(F=(v(F)-s)*m,o?Math.max(0,Math.min(1,F)):F))}R.domain=function(F){return arguments.length?([t,r]=F,s=v(t=+t),c=v(r=+r),m=s===c?0:1/(c-s),R):[t,r]},R.clamp=function(F){return arguments.length?(o=!!F,R):o},R.interpolator=function(F){return arguments.length?(T=F,R):T};function B(F){return function(G){var K,ee;return arguments.length?([K,ee]=G,T=F(K,ee),R):[T(0),T(1)]}}return R.range=B(T_),R.rangeRound=B(tI),R.unknown=function(F){return arguments.length?(M=F,R):M},function(F){return v=F,s=F(t),c=F(r),m=s===c?0:1/(c-s),R}}function zp(t,r){return r.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function h4(){var t=Lp(Rb()(Js));return t.copy=function(){return zp(t,h4())},dd.apply(t,arguments)}function f4(){var t=oI(Rb()).domain([1,10]);return t.copy=function(){return zp(t,f4()).base(t.base())},dd.apply(t,arguments)}function d4(){var t=aI(Rb());return t.copy=function(){return zp(t,d4()).constant(t.constant())},dd.apply(t,arguments)}function _I(){var t=sI(Rb());return t.copy=function(){return zp(t,_I()).exponent(t.exponent())},dd.apply(t,arguments)}function Vee(){return _I.apply(null,arguments).exponent(.5)}function p4(){var t=[],r=Js;function s(c){if(c!=null&&!isNaN(c=+c))return r((Lv(t,c,1)-1)/(t.length-1))}return s.domain=function(c){if(!arguments.length)return t.slice();t=[];for(let m of c)m!=null&&!isNaN(m=+m)&&t.push(m);return t.sort(Cp),s},s.interpolator=function(c){return arguments.length?(r=c,s):r},s.range=function(){return t.map((c,m)=>r(m/(t.length-1)))},s.quantiles=function(c){return Array.from({length:c+1},(m,v)=>IJ(t,v/c))},s.copy=function(){return p4(r).domain(t)},dd.apply(s,arguments)}function Db(){var t=0,r=.5,s=1,c=1,m,v,T,o,M,R=Js,B,F=!1,G;function K(H){return isNaN(H=+H)?G:(H=.5+((H=+B(H))-v)*(c*H<c*v?o:M),R(F?Math.max(0,Math.min(1,H)):H))}K.domain=function(H){return arguments.length?([t,r,s]=H,m=B(t=+t),v=B(r=+r),T=B(s=+s),o=m===v?0:.5/(v-m),M=v===T?0:.5/(T-v),c=v<m?-1:1,K):[t,r,s]},K.clamp=function(H){return arguments.length?(F=!!H,K):F},K.interpolator=function(H){return arguments.length?(R=H,K):R};function ee(H){return function(Z){var ae,fe,ue;return arguments.length?([ae,fe,ue]=Z,R=eQ(H,[ae,fe,ue]),K):[R(0),R(.5),R(1)]}}return K.range=ee(T_),K.rangeRound=ee(tI),K.unknown=function(H){return arguments.length?(G=H,K):G},function(H){return B=H,m=H(t),v=H(r),T=H(s),o=m===v?0:.5/(v-m),M=v===T?0:.5/(T-v),c=v<m?-1:1,K}}function m4(){var t=Lp(Db()(Js));return t.copy=function(){return zp(t,m4())},dd.apply(t,arguments)}function g4(){var t=oI(Db()).domain([.1,1,10]);return t.copy=function(){return zp(t,g4()).base(t.base())},dd.apply(t,arguments)}function _4(){var t=aI(Db());return t.copy=function(){return zp(t,_4()).constant(t.constant())},dd.apply(t,arguments)}function yI(){var t=sI(Db());return t.copy=function(){return zp(t,yI()).exponent(t.exponent())},dd.apply(t,arguments)}function $ee(){return yI.apply(null,arguments).exponent(.5)}const E3=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:Ky,scaleDiverging:m4,scaleDivergingLog:g4,scaleDivergingPow:yI,scaleDivergingSqrt:$ee,scaleDivergingSymlog:_4,scaleIdentity:X5,scaleImplicit:f2,scaleLinear:C0,scaleLog:Y5,scaleOrdinal:JP,scalePoint:Dy,scalePow:lI,scaleQuantile:e4,scaleQuantize:t4,scaleRadial:Q5,scaleSequential:h4,scaleSequentialLog:f4,scaleSequentialPow:_I,scaleSequentialQuantile:p4,scaleSequentialSqrt:Vee,scaleSequentialSymlog:d4,scaleSqrt:SQ,scaleSymlog:J5,scaleThreshold:r4,scaleTime:jee,scaleUtc:Uee,tickFormat:Z5},Symbol.toStringTag,{value:"Module"}));var qE,A3;function kb(){if(A3)return qE;A3=1;var t=x_();function r(s,c,m){for(var v=-1,T=s.length;++v<T;){var o=s[v],M=c(o);if(M!=null&&(R===void 0?M===M&&!t(M):m(M,R)))var R=M,B=o}return B}return qE=r,qE}var GE,P3;function y4(){if(P3)return GE;P3=1;function t(r,s){return r>s}return GE=t,GE}var HE,I3;function qee(){if(I3)return HE;I3=1;var t=kb(),r=y4(),s=w_();function c(m){return m&&m.length?t(m,s,r):void 0}return HE=c,HE}var Gee=qee();const Lb=Wi(Gee);var WE,C3;function v4(){if(C3)return WE;C3=1;function t(r,s){return r<s}return WE=t,WE}var ZE,M3;function Hee(){if(M3)return ZE;M3=1;var t=kb(),r=v4(),s=w_();function c(m){return m&&m.length?t(m,s,r):void 0}return ZE=c,ZE}var Wee=Hee();const zb=Wi(Wee);var XE,O3;function Zee(){if(O3)return XE;O3=1;var t=DP(),r=Jh(),s=P5(),c=El();function m(v,T){var o=c(v)?t:s;return o(v,r(T,3))}return XE=m,XE}var KE,R3;function Xee(){if(R3)return KE;R3=1;var t=E5(),r=Zee();function s(c,m){return t(r(c,m),1)}return KE=s,KE}var Kee=Xee();const Yee=Wi(Kee);var YE,D3;function Jee(){if(D3)return YE;D3=1;var t=HP();function r(s,c){return t(s,c)}return YE=r,YE}var Qee=Jee();const Fb=Wi(Qee);var E_=1e9,ete={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},xI,Fo=!0,Kc="[DecimalError] ",Om=Kc+"Invalid argument: ",vI=Kc+"Exponent out of range: ",A_=Math.floor,Tm=Math.pow,tte=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,tc,Qa=1e7,Io=7,x4=9007199254740991,D0=A_(x4/Io),rn={};rn.absoluteValue=rn.abs=function(){var t=new this.constructor(this);return t.s&&(t.s=1),t};rn.comparedTo=rn.cmp=function(t){var r,s,c,m,v=this;if(t=new v.constructor(t),v.s!==t.s)return v.s||-t.s;if(v.e!==t.e)return v.e>t.e^v.s<0?1:-1;for(c=v.d.length,m=t.d.length,r=0,s=c<m?c:m;r<s;++r)if(v.d[r]!==t.d[r])return v.d[r]>t.d[r]^v.s<0?1:-1;return c===m?0:c>m^v.s<0?1:-1};rn.decimalPlaces=rn.dp=function(){var t=this,r=t.d.length-1,s=(r-t.e)*Io;if(r=t.d[r],r)for(;r%10==0;r/=10)s--;return s<0?0:s};rn.dividedBy=rn.div=function(t){return rd(this,new this.constructor(t))};rn.dividedToIntegerBy=rn.idiv=function(t){var r=this,s=r.constructor;return fo(rd(r,new s(t),0,1),s.precision)};rn.equals=rn.eq=function(t){return!this.cmp(t)};rn.exponent=function(){return wa(this)};rn.greaterThan=rn.gt=function(t){return this.cmp(t)>0};rn.greaterThanOrEqualTo=rn.gte=function(t){return this.cmp(t)>=0};rn.isInteger=rn.isint=function(){return this.e>this.d.length-2};rn.isNegative=rn.isneg=function(){return this.s<0};rn.isPositive=rn.ispos=function(){return this.s>0};rn.isZero=function(){return this.s===0};rn.lessThan=rn.lt=function(t){return this.cmp(t)<0};rn.lessThanOrEqualTo=rn.lte=function(t){return this.cmp(t)<1};rn.logarithm=rn.log=function(t){var r,s=this,c=s.constructor,m=c.precision,v=m+5;if(t===void 0)t=new c(10);else if(t=new c(t),t.s<1||t.eq(tc))throw Error(Kc+"NaN");if(s.s<1)throw Error(Kc+(s.s?"NaN":"-Infinity"));return s.eq(tc)?new c(0):(Fo=!1,r=rd(tv(s,v),tv(t,v),v),Fo=!0,fo(r,m))};rn.minus=rn.sub=function(t){var r=this;return t=new r.constructor(t),r.s==t.s?S4(r,t):b4(r,(t.s=-t.s,t))};rn.modulo=rn.mod=function(t){var r,s=this,c=s.constructor,m=c.precision;if(t=new c(t),!t.s)throw Error(Kc+"NaN");return s.s?(Fo=!1,r=rd(s,t,0,1).times(t),Fo=!0,s.minus(r)):fo(new c(s),m)};rn.naturalExponential=rn.exp=function(){return w4(this)};rn.naturalLogarithm=rn.ln=function(){return tv(this)};rn.negated=rn.neg=function(){var t=new this.constructor(this);return t.s=-t.s||0,t};rn.plus=rn.add=function(t){var r=this;return t=new r.constructor(t),r.s==t.s?b4(r,t):S4(r,(t.s=-t.s,t))};rn.precision=rn.sd=function(t){var r,s,c,m=this;if(t!==void 0&&t!==!!t&&t!==1&&t!==0)throw Error(Om+t);if(r=wa(m)+1,c=m.d.length-1,s=c*Io+1,c=m.d[c],c){for(;c%10==0;c/=10)s--;for(c=m.d[0];c>=10;c/=10)s++}return t&&r>s?r:s};rn.squareRoot=rn.sqrt=function(){var t,r,s,c,m,v,T,o=this,M=o.constructor;if(o.s<1){if(!o.s)return new M(0);throw Error(Kc+"NaN")}for(t=wa(o),Fo=!1,m=Math.sqrt(+o),m==0||m==1/0?(r=qh(o.d),(r.length+t)%2==0&&(r+="0"),m=Math.sqrt(r),t=A_((t+1)/2)-(t<0||t%2),m==1/0?r="5e"+t:(r=m.toExponential(),r=r.slice(0,r.indexOf("e")+1)+t),c=new M(r)):c=new M(m.toString()),s=M.precision,m=T=s+3;;)if(v=c,c=v.plus(rd(o,v,T+2)).times(.5),qh(v.d).slice(0,T)===(r=qh(c.d)).slice(0,T)){if(r=r.slice(T-3,T+1),m==T&&r=="4999"){if(fo(v,s+1,0),v.times(v).eq(o)){c=v;break}}else if(r!="9999")break;T+=4}return Fo=!0,fo(c,s)};rn.times=rn.mul=function(t){var r,s,c,m,v,T,o,M,R,B=this,F=B.constructor,G=B.d,K=(t=new F(t)).d;if(!B.s||!t.s)return new F(0);for(t.s*=B.s,s=B.e+t.e,M=G.length,R=K.length,M<R&&(v=G,G=K,K=v,T=M,M=R,R=T),v=[],T=M+R,c=T;c--;)v.push(0);for(c=R;--c>=0;){for(r=0,m=M+c;m>c;)o=v[m]+K[c]*G[m-c-1]+r,v[m--]=o%Qa|0,r=o/Qa|0;v[m]=(v[m]+r)%Qa|0}for(;!v[--T];)v.pop();return r?++s:v.shift(),t.d=v,t.e=s,Fo?fo(t,F.precision):t};rn.toDecimalPlaces=rn.todp=function(t,r){var s=this,c=s.constructor;return s=new c(s),t===void 0?s:(Xh(t,0,E_),r===void 0?r=c.rounding:Xh(r,0,8),fo(s,t+wa(s)+1,r))};rn.toExponential=function(t,r){var s,c=this,m=c.constructor;return t===void 0?s=zm(c,!0):(Xh(t,0,E_),r===void 0?r=m.rounding:Xh(r,0,8),c=fo(new m(c),t+1,r),s=zm(c,!0,t+1)),s};rn.toFixed=function(t,r){var s,c,m=this,v=m.constructor;return t===void 0?zm(m):(Xh(t,0,E_),r===void 0?r=v.rounding:Xh(r,0,8),c=fo(new v(m),t+wa(m)+1,r),s=zm(c.abs(),!1,t+wa(c)+1),m.isneg()&&!m.isZero()?"-"+s:s)};rn.toInteger=rn.toint=function(){var t=this,r=t.constructor;return fo(new r(t),wa(t)+1,r.rounding)};rn.toNumber=function(){return+this};rn.toPower=rn.pow=function(t){var r,s,c,m,v,T,o=this,M=o.constructor,R=12,B=+(t=new M(t));if(!t.s)return new M(tc);if(o=new M(o),!o.s){if(t.s<1)throw Error(Kc+"Infinity");return o}if(o.eq(tc))return o;if(c=M.precision,t.eq(tc))return fo(o,c);if(r=t.e,s=t.d.length-1,T=r>=s,v=o.s,T){if((s=B<0?-B:B)<=x4){for(m=new M(tc),r=Math.ceil(c/Io+4),Fo=!1;s%2&&(m=m.times(o),L3(m.d,r)),s=A_(s/2),s!==0;)o=o.times(o),L3(o.d,r);return Fo=!0,t.s<0?new M(tc).div(m):fo(m,c)}}else if(v<0)throw Error(Kc+"NaN");return v=v<0&&t.d[Math.max(r,s)]&1?-1:1,o.s=1,Fo=!1,m=t.times(tv(o,c+R)),Fo=!0,m=w4(m),m.s=v,m};rn.toPrecision=function(t,r){var s,c,m=this,v=m.constructor;return t===void 0?(s=wa(m),c=zm(m,s<=v.toExpNeg||s>=v.toExpPos)):(Xh(t,1,E_),r===void 0?r=v.rounding:Xh(r,0,8),m=fo(new v(m),t,r),s=wa(m),c=zm(m,t<=s||s<=v.toExpNeg,t)),c};rn.toSignificantDigits=rn.tosd=function(t,r){var s=this,c=s.constructor;return t===void 0?(t=c.precision,r=c.rounding):(Xh(t,1,E_),r===void 0?r=c.rounding:Xh(r,0,8)),fo(new c(s),t,r)};rn.toString=rn.valueOf=rn.val=rn.toJSON=rn[Symbol.for("nodejs.util.inspect.custom")]=function(){var t=this,r=wa(t),s=t.constructor;return zm(t,r<=s.toExpNeg||r>=s.toExpPos)};function b4(t,r){var s,c,m,v,T,o,M,R,B=t.constructor,F=B.precision;if(!t.s||!r.s)return r.s||(r=new B(t)),Fo?fo(r,F):r;if(M=t.d,R=r.d,T=t.e,m=r.e,M=M.slice(),v=T-m,v){for(v<0?(c=M,v=-v,o=R.length):(c=R,m=T,o=M.length),T=Math.ceil(F/Io),o=T>o?T+1:o+1,v>o&&(v=o,c.length=1),c.reverse();v--;)c.push(0);c.reverse()}for(o=M.length,v=R.length,o-v<0&&(v=o,c=R,R=M,M=c),s=0;v;)s=(M[--v]=M[v]+R[v]+s)/Qa|0,M[v]%=Qa;for(s&&(M.unshift(s),++m),o=M.length;M[--o]==0;)M.pop();return r.d=M,r.e=m,Fo?fo(r,F):r}function Xh(t,r,s){if(t!==~~t||t<r||t>s)throw Error(Om+t)}function qh(t){var r,s,c,m=t.length-1,v="",T=t[0];if(m>0){for(v+=T,r=1;r<m;r++)c=t[r]+"",s=Io-c.length,s&&(v+=Ep(s)),v+=c;T=t[r],c=T+"",s=Io-c.length,s&&(v+=Ep(s))}else if(T===0)return"0";for(;T%10===0;)T/=10;return v+T}var rd=(function(){function t(c,m){var v,T=0,o=c.length;for(c=c.slice();o--;)v=c[o]*m+T,c[o]=v%Qa|0,T=v/Qa|0;return T&&c.unshift(T),c}function r(c,m,v,T){var o,M;if(v!=T)M=v>T?1:-1;else for(o=M=0;o<v;o++)if(c[o]!=m[o]){M=c[o]>m[o]?1:-1;break}return M}function s(c,m,v){for(var T=0;v--;)c[v]-=T,T=c[v]<m[v]?1:0,c[v]=T*Qa+c[v]-m[v];for(;!c[0]&&c.length>1;)c.shift()}return function(c,m,v,T){var o,M,R,B,F,G,K,ee,H,Z,ae,fe,ue,_e,le,pe,Te,De,Xe=c.constructor,wt=c.s==m.s?1:-1,$e=c.d,vt=m.d;if(!c.s)return new Xe(c);if(!m.s)throw Error(Kc+"Division by zero");for(M=c.e-m.e,Te=vt.length,le=$e.length,K=new Xe(wt),ee=K.d=[],R=0;vt[R]==($e[R]||0);)++R;if(vt[R]>($e[R]||0)&&--M,v==null?fe=v=Xe.precision:T?fe=v+(wa(c)-wa(m))+1:fe=v,fe<0)return new Xe(0);if(fe=fe/Io+2|0,R=0,Te==1)for(B=0,vt=vt[0],fe++;(R<le||B)&&fe--;R++)ue=B*Qa+($e[R]||0),ee[R]=ue/vt|0,B=ue%vt|0;else{for(B=Qa/(vt[0]+1)|0,B>1&&(vt=t(vt,B),$e=t($e,B),Te=vt.length,le=$e.length),_e=Te,H=$e.slice(0,Te),Z=H.length;Z<Te;)H[Z++]=0;De=vt.slice(),De.unshift(0),pe=vt[0],vt[1]>=Qa/2&&++pe;do B=0,o=r(vt,H,Te,Z),o<0?(ae=H[0],Te!=Z&&(ae=ae*Qa+(H[1]||0)),B=ae/pe|0,B>1?(B>=Qa&&(B=Qa-1),F=t(vt,B),G=F.length,Z=H.length,o=r(F,H,G,Z),o==1&&(B--,s(F,Te<G?De:vt,G))):(B==0&&(o=B=1),F=vt.slice()),G=F.length,G<Z&&F.unshift(0),s(H,F,Z),o==-1&&(Z=H.length,o=r(vt,H,Te,Z),o<1&&(B++,s(H,Te<Z?De:vt,Z))),Z=H.length):o===0&&(B++,H=[0]),ee[R++]=B,o&&H[0]?H[Z++]=$e[_e]||0:(H=[$e[_e]],Z=1);while((_e++<le||H[0]!==void 0)&&fe--)}return ee[0]||ee.shift(),K.e=M,fo(K,T?v+wa(K)+1:v)}})();function w4(t,r){var s,c,m,v,T,o,M=0,R=0,B=t.constructor,F=B.precision;if(wa(t)>16)throw Error(vI+wa(t));if(!t.s)return new B(tc);for(Fo=!1,o=F,T=new B(.03125);t.abs().gte(.1);)t=t.times(T),R+=5;for(c=Math.log(Tm(2,R))/Math.LN10*2+5|0,o+=c,s=m=v=new B(tc),B.precision=o;;){if(m=fo(m.times(t),o),s=s.times(++M),T=v.plus(rd(m,s,o)),qh(T.d).slice(0,o)===qh(v.d).slice(0,o)){for(;R--;)v=fo(v.times(v),o);return B.precision=F,r==null?(Fo=!0,fo(v,F)):v}v=T}}function wa(t){for(var r=t.e*Io,s=t.d[0];s>=10;s/=10)r++;return r}function JE(t,r,s){if(r>t.LN10.sd())throw Fo=!0,s&&(t.precision=s),Error(Kc+"LN10 precision limit exceeded");return fo(new t(t.LN10),r)}function Ep(t){for(var r="";t--;)r+="0";return r}function tv(t,r){var s,c,m,v,T,o,M,R,B,F=1,G=10,K=t,ee=K.d,H=K.constructor,Z=H.precision;if(K.s<1)throw Error(Kc+(K.s?"NaN":"-Infinity"));if(K.eq(tc))return new H(0);if(r==null?(Fo=!1,R=Z):R=r,K.eq(10))return r==null&&(Fo=!0),JE(H,R);if(R+=G,H.precision=R,s=qh(ee),c=s.charAt(0),v=wa(K),Math.abs(v)<15e14){for(;c<7&&c!=1||c==1&&s.charAt(1)>3;)K=K.times(t),s=qh(K.d),c=s.charAt(0),F++;v=wa(K),c>1?(K=new H("0."+s),v++):K=new H(c+"."+s.slice(1))}else return M=JE(H,R+2,Z).times(v+""),K=tv(new H(c+"."+s.slice(1)),R-G).plus(M),H.precision=Z,r==null?(Fo=!0,fo(K,Z)):K;for(o=T=K=rd(K.minus(tc),K.plus(tc),R),B=fo(K.times(K),R),m=3;;){if(T=fo(T.times(B),R),M=o.plus(rd(T,new H(m),R)),qh(M.d).slice(0,R)===qh(o.d).slice(0,R))return o=o.times(2),v!==0&&(o=o.plus(JE(H,R+2,Z).times(v+""))),o=rd(o,new H(F),R),H.precision=Z,r==null?(Fo=!0,fo(o,Z)):o;o=M,m+=2}}function k3(t,r){var s,c,m;for((s=r.indexOf("."))>-1&&(r=r.replace(".","")),(c=r.search(/e/i))>0?(s<0&&(s=c),s+=+r.slice(c+1),r=r.substring(0,c)):s<0&&(s=r.length),c=0;r.charCodeAt(c)===48;)++c;for(m=r.length;r.charCodeAt(m-1)===48;)--m;if(r=r.slice(c,m),r){if(m-=c,s=s-c-1,t.e=A_(s/Io),t.d=[],c=(s+1)%Io,s<0&&(c+=Io),c<m){for(c&&t.d.push(+r.slice(0,c)),m-=Io;c<m;)t.d.push(+r.slice(c,c+=Io));r=r.slice(c),c=Io-r.length}else c-=m;for(;c--;)r+="0";if(t.d.push(+r),Fo&&(t.e>D0||t.e<-D0))throw Error(vI+s)}else t.s=0,t.e=0,t.d=[0];return t}function fo(t,r,s){var c,m,v,T,o,M,R,B,F=t.d;for(T=1,v=F[0];v>=10;v/=10)T++;if(c=r-T,c<0)c+=Io,m=r,R=F[B=0];else{if(B=Math.ceil((c+1)/Io),v=F.length,B>=v)return t;for(R=v=F[B],T=1;v>=10;v/=10)T++;c%=Io,m=c-Io+T}if(s!==void 0&&(v=Tm(10,T-m-1),o=R/v%10|0,M=r<0||F[B+1]!==void 0||R%v,M=s<4?(o||M)&&(s==0||s==(t.s<0?3:2)):o>5||o==5&&(s==4||M||s==6&&(c>0?m>0?R/Tm(10,T-m):0:F[B-1])%10&1||s==(t.s<0?8:7))),r<1||!F[0])return M?(v=wa(t),F.length=1,r=r-v-1,F[0]=Tm(10,(Io-r%Io)%Io),t.e=A_(-r/Io)||0):(F.length=1,F[0]=t.e=t.s=0),t;if(c==0?(F.length=B,v=1,B--):(F.length=B+1,v=Tm(10,Io-c),F[B]=m>0?(R/Tm(10,T-m)%Tm(10,m)|0)*v:0),M)for(;;)if(B==0){(F[0]+=v)==Qa&&(F[0]=1,++t.e);break}else{if(F[B]+=v,F[B]!=Qa)break;F[B--]=0,v=1}for(c=F.length;F[--c]===0;)F.pop();if(Fo&&(t.e>D0||t.e<-D0))throw Error(vI+wa(t));return t}function S4(t,r){var s,c,m,v,T,o,M,R,B,F,G=t.constructor,K=G.precision;if(!t.s||!r.s)return r.s?r.s=-r.s:r=new G(t),Fo?fo(r,K):r;if(M=t.d,F=r.d,c=r.e,R=t.e,M=M.slice(),T=R-c,T){for(B=T<0,B?(s=M,T=-T,o=F.length):(s=F,c=R,o=M.length),m=Math.max(Math.ceil(K/Io),o)+2,T>m&&(T=m,s.length=1),s.reverse(),m=T;m--;)s.push(0);s.reverse()}else{for(m=M.length,o=F.length,B=m<o,B&&(o=m),m=0;m<o;m++)if(M[m]!=F[m]){B=M[m]<F[m];break}T=0}for(B&&(s=M,M=F,F=s,r.s=-r.s),o=M.length,m=F.length-o;m>0;--m)M[o++]=0;for(m=F.length;m>T;){if(M[--m]<F[m]){for(v=m;v&&M[--v]===0;)M[v]=Qa-1;--M[v],M[m]+=Qa}M[m]-=F[m]}for(;M[--o]===0;)M.pop();for(;M[0]===0;M.shift())--c;return M[0]?(r.d=M,r.e=c,Fo?fo(r,K):r):new G(0)}function zm(t,r,s){var c,m=wa(t),v=qh(t.d),T=v.length;return r?(s&&(c=s-T)>0?v=v.charAt(0)+"."+v.slice(1)+Ep(c):T>1&&(v=v.charAt(0)+"."+v.slice(1)),v=v+(m<0?"e":"e+")+m):m<0?(v="0."+Ep(-m-1)+v,s&&(c=s-T)>0&&(v+=Ep(c))):m>=T?(v+=Ep(m+1-T),s&&(c=s-m-1)>0&&(v=v+"."+Ep(c))):((c=m+1)<T&&(v=v.slice(0,c)+"."+v.slice(c)),s&&(c=s-T)>0&&(m+1===T&&(v+="."),v+=Ep(c))),t.s<0?"-"+v:v}function L3(t,r){if(t.length>r)return t.length=r,!0}function T4(t){var r,s,c;function m(v){var T=this;if(!(T instanceof m))return new m(v);if(T.constructor=m,v instanceof m){T.s=v.s,T.e=v.e,T.d=(v=v.d)?v.slice():v;return}if(typeof v=="number"){if(v*0!==0)throw Error(Om+v);if(v>0)T.s=1;else if(v<0)v=-v,T.s=-1;else{T.s=0,T.e=0,T.d=[0];return}if(v===~~v&&v<1e7){T.e=0,T.d=[v];return}return k3(T,v.toString())}else if(typeof v!="string")throw Error(Om+v);if(v.charCodeAt(0)===45?(v=v.slice(1),T.s=-1):T.s=1,tte.test(v))k3(T,v);else throw Error(Om+v)}if(m.prototype=rn,m.ROUND_UP=0,m.ROUND_DOWN=1,m.ROUND_CEIL=2,m.ROUND_FLOOR=3,m.ROUND_HALF_UP=4,m.ROUND_HALF_DOWN=5,m.ROUND_HALF_EVEN=6,m.ROUND_HALF_CEIL=7,m.ROUND_HALF_FLOOR=8,m.clone=T4,m.config=m.set=rte,t===void 0&&(t={}),t)for(c=["precision","rounding","toExpNeg","toExpPos","LN10"],r=0;r<c.length;)t.hasOwnProperty(s=c[r++])||(t[s]=this[s]);return m.config(t),m}function rte(t){if(!t||typeof t!="object")throw Error(Kc+"Object expected");var r,s,c,m=["precision",1,E_,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(r=0;r<m.length;r+=3)if((c=t[s=m[r]])!==void 0)if(A_(c)===c&&c>=m[r+1]&&c<=m[r+2])this[s]=c;else throw Error(Om+s+": "+c);if((c=t[s="LN10"])!==void 0)if(c==Math.LN10)this[s]=new this(c);else throw Error(Om+s+": "+c);return this}var xI=T4(ete);tc=new xI(1);const oo=xI;function nte(t){return ste(t)||ate(t)||ote(t)||ite()}function ite(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ote(t,r){if(t){if(typeof t=="string")return g2(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return g2(t,r)}}function ate(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function ste(t){if(Array.isArray(t))return g2(t)}function g2(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}var lte=function(r){return r},E4={},A4=function(r){return r===E4},z3=function(r){return function s(){return arguments.length===0||arguments.length===1&&A4(arguments.length<=0?void 0:arguments[0])?s:r.apply(void 0,arguments)}},cte=function t(r,s){return r===1?s:z3(function(){for(var c=arguments.length,m=new Array(c),v=0;v<c;v++)m[v]=arguments[v];var T=m.filter(function(o){return o!==E4}).length;return T>=r?s.apply(void 0,m):t(r-T,z3(function(){for(var o=arguments.length,M=new Array(o),R=0;R<o;R++)M[R]=arguments[R];var B=m.map(function(F){return A4(F)?M.shift():F});return s.apply(void 0,nte(B).concat(M))}))})},Bb=function(r){return cte(r.length,r)},_2=function(r,s){for(var c=[],m=r;m<s;++m)c[m-r]=m;return c},ute=Bb(function(t,r){return Array.isArray(r)?r.map(t):Object.keys(r).map(function(s){return r[s]}).map(t)}),hte=function(){for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];if(!s.length)return lte;var m=s.reverse(),v=m[0],T=m.slice(1);return function(){return T.reduce(function(o,M){return M(o)},v.apply(void 0,arguments))}},y2=function(r){return Array.isArray(r)?r.reverse():r.split("").reverse.join("")},P4=function(r){var s=null,c=null;return function(){for(var m=arguments.length,v=new Array(m),T=0;T<m;T++)v[T]=arguments[T];return s&&v.every(function(o,M){return o===s[M]})||(s=v,c=r.apply(void 0,v)),c}};function fte(t){var r;return t===0?r=1:r=Math.floor(new oo(t).abs().log(10).toNumber())+1,r}function dte(t,r,s){for(var c=new oo(t),m=0,v=[];c.lt(r)&&m<1e5;)v.push(c.toNumber()),c=c.add(s),m++;return v}var pte=Bb(function(t,r,s){var c=+t,m=+r;return c+s*(m-c)}),mte=Bb(function(t,r,s){var c=r-+t;return c=c||1/0,(s-t)/c}),gte=Bb(function(t,r,s){var c=r-+t;return c=c||1/0,Math.max(0,Math.min(1,(s-t)/c))});const Nb={rangeStep:dte,getDigitCount:fte,interpolateNumber:pte,uninterpolateNumber:mte,uninterpolateTruncation:gte};function v2(t){return vte(t)||yte(t)||I4(t)||_te()}function _te(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yte(t){if(typeof Symbol<"u"&&Symbol.iterator in Object(t))return Array.from(t)}function vte(t){if(Array.isArray(t))return x2(t)}function rv(t,r){return wte(t)||bte(t,r)||I4(t,r)||xte()}function xte(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function I4(t,r){if(t){if(typeof t=="string")return x2(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return x2(t,r)}}function x2(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function bte(t,r){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var s=[],c=!0,m=!1,v=void 0;try{for(var T=t[Symbol.iterator](),o;!(c=(o=T.next()).done)&&(s.push(o.value),!(r&&s.length===r));c=!0);}catch(M){m=!0,v=M}finally{try{!c&&T.return!=null&&T.return()}finally{if(m)throw v}}return s}}function wte(t){if(Array.isArray(t))return t}function C4(t){var r=rv(t,2),s=r[0],c=r[1],m=s,v=c;return s>c&&(m=c,v=s),[m,v]}function M4(t,r,s){if(t.lte(0))return new oo(0);var c=Nb.getDigitCount(t.toNumber()),m=new oo(10).pow(c),v=t.div(m),T=c!==1?.05:.1,o=new oo(Math.ceil(v.div(T).toNumber())).add(s).mul(T),M=o.mul(m);return r?M:new oo(Math.ceil(M))}function Ste(t,r,s){var c=1,m=new oo(t);if(!m.isint()&&s){var v=Math.abs(t);v<1?(c=new oo(10).pow(Nb.getDigitCount(t)-1),m=new oo(Math.floor(m.div(c).toNumber())).mul(c)):v>1&&(m=new oo(Math.floor(t)))}else t===0?m=new oo(Math.floor((r-1)/2)):s||(m=new oo(Math.floor(t)));var T=Math.floor((r-1)/2),o=hte(ute(function(M){return m.add(new oo(M-T).mul(c)).toNumber()}),_2);return o(0,r)}function O4(t,r,s,c){var m=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((r-t)/(s-1)))return{step:new oo(0),tickMin:new oo(0),tickMax:new oo(0)};var v=M4(new oo(r).sub(t).div(s-1),c,m),T;t<=0&&r>=0?T=new oo(0):(T=new oo(t).add(r).div(2),T=T.sub(new oo(T).mod(v)));var o=Math.ceil(T.sub(t).div(v).toNumber()),M=Math.ceil(new oo(r).sub(T).div(v).toNumber()),R=o+M+1;return R>s?O4(t,r,s,c,m+1):(R<s&&(M=r>0?M+(s-R):M,o=r>0?o:o+(s-R)),{step:v,tickMin:T.sub(new oo(o).mul(v)),tickMax:T.add(new oo(M).mul(v))})}function Tte(t){var r=rv(t,2),s=r[0],c=r[1],m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,T=Math.max(m,2),o=C4([s,c]),M=rv(o,2),R=M[0],B=M[1];if(R===-1/0||B===1/0){var F=B===1/0?[R].concat(v2(_2(0,m-1).map(function(){return 1/0}))):[].concat(v2(_2(0,m-1).map(function(){return-1/0})),[B]);return s>c?y2(F):F}if(R===B)return Ste(R,m,v);var G=O4(R,B,T,v),K=G.step,ee=G.tickMin,H=G.tickMax,Z=Nb.rangeStep(ee,H.add(new oo(.1).mul(K)),K);return s>c?y2(Z):Z}function Ete(t,r){var s=rv(t,2),c=s[0],m=s[1],v=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,T=C4([c,m]),o=rv(T,2),M=o[0],R=o[1];if(M===-1/0||R===1/0)return[c,m];if(M===R)return[M];var B=Math.max(r,2),F=M4(new oo(R).sub(M).div(B-1),v,0),G=[].concat(v2(Nb.rangeStep(new oo(M),new oo(R).sub(new oo(.99).mul(F)),F)),[R]);return c>m?y2(G):G}var Ate=P4(Tte),Pte=P4(Ete),Ite="Invariant failed";function Fm(t,r){throw new Error(Ite)}var Cte=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function e_(t){"@babel/helpers - typeof";return e_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},e_(t)}function k0(){return k0=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},k0.apply(this,arguments)}function Mte(t,r){return kte(t)||Dte(t,r)||Rte(t,r)||Ote()}function Ote(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rte(t,r){if(t){if(typeof t=="string")return F3(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return F3(t,r)}}function F3(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function Dte(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var c,m,v,T,o=[],M=!0,R=!1;try{if(v=(s=s.call(t)).next,r!==0)for(;!(M=(c=v.call(s)).done)&&(o.push(c.value),o.length!==r);M=!0);}catch(B){R=!0,m=B}finally{try{if(!M&&s.return!=null&&(T=s.return(),Object(T)!==T))return}finally{if(R)throw m}}return o}}function kte(t){if(Array.isArray(t))return t}function Lte(t,r){if(t==null)return{};var s=zte(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function zte(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}function Fte(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Bte(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,k4(c.key),c)}}function Nte(t,r,s){return r&&Bte(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function jte(t,r,s){return r=L0(r),Ute(t,R4()?Reflect.construct(r,s||[],L0(t).constructor):r.apply(t,s))}function Ute(t,r){if(r&&(e_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Vte(t)}function Vte(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function R4(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(R4=function(){return!!t})()}function L0(t){return L0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},L0(t)}function $te(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&b2(t,r)}function b2(t,r){return b2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},b2(t,r)}function D4(t,r,s){return r=k4(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function k4(t){var r=qte(t,"string");return e_(r)=="symbol"?r:r+""}function qte(t,r){if(e_(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(e_(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var jb=(function(t){function r(){return Fte(this,r),jte(this,r,arguments)}return $te(r,t),Nte(r,[{key:"render",value:function(){var c=this.props,m=c.offset,v=c.layout,T=c.width,o=c.dataKey,M=c.data,R=c.dataPointFormatter,B=c.xAxis,F=c.yAxis,G=Lte(c,Cte),K=Vn(G,!1);this.props.direction==="x"&&B.type!=="number"&&Fm();var ee=M.map(function(H){var Z=R(H,o),ae=Z.x,fe=Z.y,ue=Z.value,_e=Z.errorVal;if(!_e)return null;var le=[],pe,Te;if(Array.isArray(_e)){var De=Mte(_e,2);pe=De[0],Te=De[1]}else pe=Te=_e;if(v==="vertical"){var Xe=B.scale,wt=fe+m,$e=wt+T,vt=wt-T,ft=Xe(ue-pe),bt=Xe(ue+Te);le.push({x1:bt,y1:$e,x2:bt,y2:vt}),le.push({x1:ft,y1:wt,x2:bt,y2:wt}),le.push({x1:ft,y1:$e,x2:ft,y2:vt})}else if(v==="horizontal"){var St=F.scale,gt=ae+m,Rt=gt-T,Ke=gt+T,yt=St(ue-pe),Vt=St(ue+Te);le.push({x1:Rt,y1:Vt,x2:Ke,y2:Vt}),le.push({x1:gt,y1:yt,x2:gt,y2:Vt}),le.push({x1:Rt,y1:yt,x2:Ke,y2:yt})}return ht.createElement(to,k0({className:"recharts-errorBar",key:"bar-".concat(le.map(function(qe){return"".concat(qe.x1,"-").concat(qe.x2,"-").concat(qe.y1,"-").concat(qe.y2)}))},K),le.map(function(qe){return ht.createElement("line",k0({},qe,{key:"line-".concat(qe.x1,"-").concat(qe.x2,"-").concat(qe.y1,"-").concat(qe.y2)}))}))});return ht.createElement(to,{className:"recharts-errorBars"},ee)}}])})(ht.Component);D4(jb,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});D4(jb,"displayName","ErrorBar");function nv(t){"@babel/helpers - typeof";return nv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},nv(t)}function B3(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function xm(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?B3(Object(s),!0).forEach(function(c){Gte(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):B3(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function Gte(t,r,s){return r=Hte(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Hte(t){var r=Wte(t,"string");return nv(r)=="symbol"?r:r+""}function Wte(t,r){if(nv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(nv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var L4=function(r){var s=r.children,c=r.formattedGraphicalItems,m=r.legendWidth,v=r.legendContent,T=Ql(s,Ug);if(!T)return null;var o=Ug.defaultProps,M=o!==void 0?xm(xm({},o),T.props):{},R;return T.props&&T.props.payload?R=T.props&&T.props.payload:v==="children"?R=(c||[]).reduce(function(B,F){var G=F.item,K=F.props,ee=K.sectors||K.data||[];return B.concat(ee.map(function(H){return{type:T.props.iconType||G.props.legendType,value:H.name,color:H.fill,payload:H}}))},[]):R=(c||[]).map(function(B){var F=B.item,G=F.type.defaultProps,K=G!==void 0?xm(xm({},G),F.props):{},ee=K.dataKey,H=K.name,Z=K.legendType,ae=K.hide;return{inactive:ae,dataKey:ee,type:M.iconType||Z||"square",color:bI(F),value:H||ee,payload:K}}),xm(xm(xm({},M),Ug.getWithHeight(T,m)),{},{payload:R,item:T})};function iv(t){"@babel/helpers - typeof";return iv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},iv(t)}function N3(t){return Yte(t)||Kte(t)||Xte(t)||Zte()}function Zte(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xte(t,r){if(t){if(typeof t=="string")return w2(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return w2(t,r)}}function Kte(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Yte(t){if(Array.isArray(t))return w2(t)}function w2(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function j3(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function Qo(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?j3(Object(s),!0).forEach(function(c){$g(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):j3(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function $g(t,r,s){return r=Jte(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Jte(t){var r=Qte(t,"string");return iv(r)=="symbol"?r:r+""}function Qte(t,r){if(iv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(iv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Ms(t,r,s){return bi(t)||bi(r)?s:za(r)?nc(t,r,s):Zn(r)?r(t):s}function ky(t,r,s,c){var m=Yee(t,function(o){return Ms(o,r)});if(s==="number"){var v=m.filter(function(o){return kr(o)||parseFloat(o)});return v.length?[zb(v),Lb(v)]:[1/0,-1/0]}var T=c?m.filter(function(o){return!bi(o)}):m;return T.map(function(o){return za(o)||o instanceof Date?o:""})}var ere=function(r){var s,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],m=arguments.length>2?arguments[2]:void 0,v=arguments.length>3?arguments[3]:void 0,T=-1,o=(s=c?.length)!==null&&s!==void 0?s:0;if(o<=1)return 0;if(v&&v.axisType==="angleAxis"&&Math.abs(Math.abs(v.range[1]-v.range[0])-360)<=1e-6)for(var M=v.range,R=0;R<o;R++){var B=R>0?m[R-1].coordinate:m[o-1].coordinate,F=m[R].coordinate,G=R>=o-1?m[0].coordinate:m[R+1].coordinate,K=void 0;if(Ks(F-B)!==Ks(G-F)){var ee=[];if(Ks(G-F)===Ks(M[1]-M[0])){K=G;var H=F+M[1]-M[0];ee[0]=Math.min(H,(H+B)/2),ee[1]=Math.max(H,(H+B)/2)}else{K=B;var Z=G+M[1]-M[0];ee[0]=Math.min(F,(Z+F)/2),ee[1]=Math.max(F,(Z+F)/2)}var ae=[Math.min(F,(K+F)/2),Math.max(F,(K+F)/2)];if(r>ae[0]&&r<=ae[1]||r>=ee[0]&&r<=ee[1]){T=m[R].index;break}}else{var fe=Math.min(B,G),ue=Math.max(B,G);if(r>(fe+F)/2&&r<=(ue+F)/2){T=m[R].index;break}}}else for(var _e=0;_e<o;_e++)if(_e===0&&r<=(c[_e].coordinate+c[_e+1].coordinate)/2||_e>0&&_e<o-1&&r>(c[_e].coordinate+c[_e-1].coordinate)/2&&r<=(c[_e].coordinate+c[_e+1].coordinate)/2||_e===o-1&&r>(c[_e].coordinate+c[_e-1].coordinate)/2){T=c[_e].index;break}return T},bI=function(r){var s,c=r,m=c.type.displayName,v=(s=r.type)!==null&&s!==void 0&&s.defaultProps?Qo(Qo({},r.type.defaultProps),r.props):r.props,T=v.stroke,o=v.fill,M;switch(m){case"Line":M=T;break;case"Area":case"Radar":M=T&&T!=="none"?T:o;break;default:M=o;break}return M},tre=function(r){var s=r.barSize,c=r.totalSize,m=r.stackGroups,v=m===void 0?{}:m;if(!v)return{};for(var T={},o=Object.keys(v),M=0,R=o.length;M<R;M++)for(var B=v[o[M]].stackGroups,F=Object.keys(B),G=0,K=F.length;G<K;G++){var ee=B[F[G]],H=ee.items,Z=ee.cateAxisId,ae=H.filter(function(Te){return td(Te.type).indexOf("Bar")>=0});if(ae&&ae.length){var fe=ae[0].type.defaultProps,ue=fe!==void 0?Qo(Qo({},fe),ae[0].props):ae[0].props,_e=ue.barSize,le=ue[Z];T[le]||(T[le]=[]);var pe=bi(_e)?s:_e;T[le].push({item:ae[0],stackList:ae.slice(1),barSize:bi(pe)?void 0:Ys(pe,c,0)})}}return T},rre=function(r){var s=r.barGap,c=r.barCategoryGap,m=r.bandSize,v=r.sizeList,T=v===void 0?[]:v,o=r.maxBarSize,M=T.length;if(M<1)return null;var R=Ys(s,m,0,!0),B,F=[];if(T[0].barSize===+T[0].barSize){var G=!1,K=m/M,ee=T.reduce(function(_e,le){return _e+le.barSize||0},0);ee+=(M-1)*R,ee>=m&&(ee-=(M-1)*R,R=0),ee>=m&&K>0&&(G=!0,K*=.9,ee=M*K);var H=(m-ee)/2>>0,Z={offset:H-R,size:0};B=T.reduce(function(_e,le){var pe={item:le.item,position:{offset:Z.offset+Z.size+R,size:G?K:le.barSize}},Te=[].concat(N3(_e),[pe]);return Z=Te[Te.length-1].position,le.stackList&&le.stackList.length&&le.stackList.forEach(function(De){Te.push({item:De,position:Z})}),Te},F)}else{var ae=Ys(c,m,0,!0);m-2*ae-(M-1)*R<=0&&(R=0);var fe=(m-2*ae-(M-1)*R)/M;fe>1&&(fe>>=0);var ue=o===+o?Math.min(fe,o):fe;B=T.reduce(function(_e,le,pe){var Te=[].concat(N3(_e),[{item:le.item,position:{offset:ae+(fe+R)*pe+(fe-ue)/2,size:ue}}]);return le.stackList&&le.stackList.length&&le.stackList.forEach(function(De){Te.push({item:De,position:Te[Te.length-1].position})}),Te},F)}return B},nre=function(r,s,c,m){var v=c.children,T=c.width,o=c.margin,M=T-(o.left||0)-(o.right||0),R=L4({children:v,legendWidth:M});if(R){var B=m||{},F=B.width,G=B.height,K=R.align,ee=R.verticalAlign,H=R.layout;if((H==="vertical"||H==="horizontal"&&ee==="middle")&&K!=="center"&&kr(r[K]))return Qo(Qo({},r),{},$g({},K,r[K]+(F||0)));if((H==="horizontal"||H==="vertical"&&K==="center")&&ee!=="middle"&&kr(r[ee]))return Qo(Qo({},r),{},$g({},ee,r[ee]+(G||0)))}return r},ire=function(r,s,c){return bi(s)?!0:r==="horizontal"?s==="yAxis":r==="vertical"||c==="x"?s==="xAxis":c==="y"?s==="yAxis":!0},z4=function(r,s,c,m,v){var T=s.props.children,o=Xc(T,jb).filter(function(R){return ire(m,v,R.props.direction)});if(o&&o.length){var M=o.map(function(R){return R.props.dataKey});return r.reduce(function(R,B){var F=Ms(B,c);if(bi(F))return R;var G=Array.isArray(F)?[zb(F),Lb(F)]:[F,F],K=M.reduce(function(ee,H){var Z=Ms(B,H,0),ae=G[0]-Math.abs(Array.isArray(Z)?Z[0]:Z),fe=G[1]+Math.abs(Array.isArray(Z)?Z[1]:Z);return[Math.min(ae,ee[0]),Math.max(fe,ee[1])]},[1/0,-1/0]);return[Math.min(K[0],R[0]),Math.max(K[1],R[1])]},[1/0,-1/0])}return null},ore=function(r,s,c,m,v){var T=s.map(function(o){return z4(r,o,c,v,m)}).filter(function(o){return!bi(o)});return T&&T.length?T.reduce(function(o,M){return[Math.min(o[0],M[0]),Math.max(o[1],M[1])]},[1/0,-1/0]):null},F4=function(r,s,c,m,v){var T=s.map(function(M){var R=M.props.dataKey;return c==="number"&&R&&z4(r,M,R,m)||ky(r,R,c,v)});if(c==="number")return T.reduce(function(M,R){return[Math.min(M[0],R[0]),Math.max(M[1],R[1])]},[1/0,-1/0]);var o={};return T.reduce(function(M,R){for(var B=0,F=R.length;B<F;B++)o[R[B]]||(o[R[B]]=!0,M.push(R[B]));return M},[])},B4=function(r,s){return r==="horizontal"&&s==="xAxis"||r==="vertical"&&s==="yAxis"||r==="centric"&&s==="angleAxis"||r==="radial"&&s==="radiusAxis"},N4=function(r,s,c,m){if(m)return r.map(function(M){return M.coordinate});var v,T,o=r.map(function(M){return M.coordinate===s&&(v=!0),M.coordinate===c&&(T=!0),M.coordinate});return v||o.push(s),T||o.push(c),o},ed=function(r,s,c){if(!r)return null;var m=r.scale,v=r.duplicateDomain,T=r.type,o=r.range,M=r.realScaleType==="scaleBand"?m.bandwidth()/2:2,R=(s||c)&&T==="category"&&m.bandwidth?m.bandwidth()/M:0;if(R=r.axisType==="angleAxis"&&o?.length>=2?Ks(o[0]-o[1])*2*R:R,s&&(r.ticks||r.niceTicks)){var B=(r.ticks||r.niceTicks).map(function(F){var G=v?v.indexOf(F):F;return{coordinate:m(G)+R,value:F,offset:R}});return B.filter(function(F){return!Ov(F.coordinate)})}return r.isCategorical&&r.categoricalDomain?r.categoricalDomain.map(function(F,G){return{coordinate:m(F)+R,value:F,index:G,offset:R}}):m.ticks&&!c?m.ticks(r.tickCount).map(function(F){return{coordinate:m(F)+R,value:F,offset:R}}):m.domain().map(function(F,G){return{coordinate:m(F)+R,value:v?v[F]:F,index:G,offset:R}})},QE=new WeakMap,Xx=function(r,s){if(typeof s!="function")return r;QE.has(r)||QE.set(r,new WeakMap);var c=QE.get(r);if(c.has(s))return c.get(s);var m=function(){r.apply(void 0,arguments),s.apply(void 0,arguments)};return c.set(s,m),m},j4=function(r,s,c){var m=r.scale,v=r.type,T=r.layout,o=r.axisType;if(m==="auto")return T==="radial"&&o==="radiusAxis"?{scale:Ky(),realScaleType:"band"}:T==="radial"&&o==="angleAxis"?{scale:C0(),realScaleType:"linear"}:v==="category"&&s&&(s.indexOf("LineChart")>=0||s.indexOf("AreaChart")>=0||s.indexOf("ComposedChart")>=0&&!c)?{scale:Dy(),realScaleType:"point"}:v==="category"?{scale:Ky(),realScaleType:"band"}:{scale:C0(),realScaleType:"linear"};if(Dm(m)){var M="scale".concat(bb(m));return{scale:(E3[M]||Dy)(),realScaleType:E3[M]?M:"point"}}return Zn(m)?{scale:m}:{scale:Dy(),realScaleType:"point"}},U3=1e-4,U4=function(r){var s=r.domain();if(!(!s||s.length<=2)){var c=s.length,m=r.range(),v=Math.min(m[0],m[1])-U3,T=Math.max(m[0],m[1])+U3,o=r(s[0]),M=r(s[c-1]);(o<v||o>T||M<v||M>T)&&r.domain([s[0],s[c-1]])}},are=function(r,s){if(!r)return null;for(var c=0,m=r.length;c<m;c++)if(r[c].item===s)return r[c].position;return null},sre=function(r,s){if(!s||s.length!==2||!kr(s[0])||!kr(s[1]))return r;var c=Math.min(s[0],s[1]),m=Math.max(s[0],s[1]),v=[r[0],r[1]];return(!kr(r[0])||r[0]<c)&&(v[0]=c),(!kr(r[1])||r[1]>m)&&(v[1]=m),v[0]>m&&(v[0]=m),v[1]<c&&(v[1]=c),v},lre=function(r){var s=r.length;if(!(s<=0))for(var c=0,m=r[0].length;c<m;++c)for(var v=0,T=0,o=0;o<s;++o){var M=Ov(r[o][c][1])?r[o][c][0]:r[o][c][1];M>=0?(r[o][c][0]=v,r[o][c][1]=v+M,v=r[o][c][1]):(r[o][c][0]=T,r[o][c][1]=T+M,T=r[o][c][1])}},cre=function(r){var s=r.length;if(!(s<=0))for(var c=0,m=r[0].length;c<m;++c)for(var v=0,T=0;T<s;++T){var o=Ov(r[T][c][1])?r[T][c][0]:r[T][c][1];o>=0?(r[T][c][0]=v,r[T][c][1]=v+o,v=r[T][c][1]):(r[T][c][0]=0,r[T][c][1]=0)}},ure={sign:lre,expand:YZ,none:Hg,silhouette:JZ,wiggle:QZ,positive:cre},hre=function(r,s,c){var m=s.map(function(o){return o.props.dataKey}),v=ure[c],T=KZ().keys(m).value(function(o,M){return+Ms(o,M,0)}).order(JA).offset(v);return T(r)},fre=function(r,s,c,m,v,T){if(!r)return null;var o=T?s.reverse():s,M={},R=o.reduce(function(F,G){var K,ee=(K=G.type)!==null&&K!==void 0&&K.defaultProps?Qo(Qo({},G.type.defaultProps),G.props):G.props,H=ee.stackId,Z=ee.hide;if(Z)return F;var ae=ee[c],fe=F[ae]||{hasStack:!1,stackGroups:{}};if(za(H)){var ue=fe.stackGroups[H]||{numericAxisId:c,cateAxisId:m,items:[]};ue.items.push(G),fe.hasStack=!0,fe.stackGroups[H]=ue}else fe.stackGroups[Rv("_stackId_")]={numericAxisId:c,cateAxisId:m,items:[G]};return Qo(Qo({},F),{},$g({},ae,fe))},M),B={};return Object.keys(R).reduce(function(F,G){var K=R[G];if(K.hasStack){var ee={};K.stackGroups=Object.keys(K.stackGroups).reduce(function(H,Z){var ae=K.stackGroups[Z];return Qo(Qo({},H),{},$g({},Z,{numericAxisId:c,cateAxisId:m,items:ae.items,stackedData:hre(r,ae.items,v)}))},ee)}return Qo(Qo({},F),{},$g({},G,K))},B)},V4=function(r,s){var c=s.realScaleType,m=s.type,v=s.tickCount,T=s.originalDomain,o=s.allowDecimals,M=c||s.scale;if(M!=="auto"&&M!=="linear")return null;if(v&&m==="number"&&T&&(T[0]==="auto"||T[1]==="auto")){var R=r.domain();if(!R.length)return null;var B=Ate(R,v,o);return r.domain([zb(B),Lb(B)]),{niceTicks:B}}if(v&&m==="number"){var F=r.domain(),G=Pte(F,v,o);return{niceTicks:G}}return null},V3=function(r){var s=r.axis,c=r.ticks,m=r.offset,v=r.bandSize,T=r.entry,o=r.index;if(s.type==="category")return c[o]?c[o].coordinate+m:null;var M=Ms(T,s.dataKey,s.domain[o]);return bi(M)?null:s.scale(M)-v/2+m},dre=function(r){var s=r.numericAxis,c=s.scale.domain();if(s.type==="number"){var m=Math.min(c[0],c[1]),v=Math.max(c[0],c[1]);return m<=0&&v>=0?0:v<0?v:m}return c[0]},pre=function(r,s){var c,m=(c=r.type)!==null&&c!==void 0&&c.defaultProps?Qo(Qo({},r.type.defaultProps),r.props):r.props,v=m.stackId;if(za(v)){var T=s[v];if(T){var o=T.items.indexOf(r);return o>=0?T.stackedData[o]:null}}return null},mre=function(r){return r.reduce(function(s,c){return[zb(c.concat([s[0]]).filter(kr)),Lb(c.concat([s[1]]).filter(kr))]},[1/0,-1/0])},$4=function(r,s,c){return Object.keys(r).reduce(function(m,v){var T=r[v],o=T.stackedData,M=o.reduce(function(R,B){var F=mre(B.slice(s,c+1));return[Math.min(R[0],F[0]),Math.max(R[1],F[1])]},[1/0,-1/0]);return[Math.min(M[0],m[0]),Math.max(M[1],m[1])]},[1/0,-1/0]).map(function(m){return m===1/0||m===-1/0?0:m})},$3=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,q3=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,S2=function(r,s,c){if(Zn(r))return r(s,c);if(!Array.isArray(r))return s;var m=[];if(kr(r[0]))m[0]=c?r[0]:Math.min(r[0],s[0]);else if($3.test(r[0])){var v=+$3.exec(r[0])[1];m[0]=s[0]-v}else Zn(r[0])?m[0]=r[0](s[0]):m[0]=s[0];if(kr(r[1]))m[1]=c?r[1]:Math.max(r[1],s[1]);else if(q3.test(r[1])){var T=+q3.exec(r[1])[1];m[1]=s[1]+T}else Zn(r[1])?m[1]=r[1](s[1]):m[1]=s[1];return m},z0=function(r,s,c){if(r&&r.scale&&r.scale.bandwidth){var m=r.scale.bandwidth();if(!c||m>0)return m}if(r&&s&&s.length>=2){for(var v=ZP(s,function(F){return F.coordinate}),T=1/0,o=1,M=v.length;o<M;o++){var R=v[o],B=v[o-1];T=Math.min((R.coordinate||0)-(B.coordinate||0),T)}return T===1/0?0:T}return c?void 0:0},G3=function(r,s,c){return!r||!r.length||Fb(r,nc(c,"type.defaultProps.domain"))?s:r},q4=function(r,s){var c=r.type.defaultProps?Qo(Qo({},r.type.defaultProps),r.props):r.props,m=c.dataKey,v=c.name,T=c.unit,o=c.formatter,M=c.tooltipType,R=c.chartType,B=c.hide;return Qo(Qo({},Vn(r,!1)),{},{dataKey:m,unit:T,formatter:o,name:v||m,color:bI(r),value:Ms(s,m),type:M,payload:s,chartType:R,hide:B})};function ov(t){"@babel/helpers - typeof";return ov=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},ov(t)}function H3(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function Yf(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?H3(Object(s),!0).forEach(function(c){G4(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):H3(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function G4(t,r,s){return r=gre(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function gre(t){var r=_re(t,"string");return ov(r)=="symbol"?r:r+""}function _re(t,r){if(ov(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(ov(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function yre(t,r){return wre(t)||bre(t,r)||xre(t,r)||vre()}function vre(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xre(t,r){if(t){if(typeof t=="string")return W3(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return W3(t,r)}}function W3(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function bre(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var c,m,v,T,o=[],M=!0,R=!1;try{if(v=(s=s.call(t)).next,r!==0)for(;!(M=(c=v.call(s)).done)&&(o.push(c.value),o.length!==r);M=!0);}catch(B){R=!0,m=B}finally{try{if(!M&&s.return!=null&&(T=s.return(),Object(T)!==T))return}finally{if(R)throw m}}return o}}function wre(t){if(Array.isArray(t))return t}var F0=Math.PI/180,Sre=function(r){return r*180/Math.PI},vo=function(r,s,c,m){return{x:r+Math.cos(-F0*m)*c,y:s+Math.sin(-F0*m)*c}},H4=function(r,s){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(r-(c.left||0)-(c.right||0)),Math.abs(s-(c.top||0)-(c.bottom||0)))/2},Tre=function(r,s,c,m,v){var T=r.width,o=r.height,M=r.startAngle,R=r.endAngle,B=Ys(r.cx,T,T/2),F=Ys(r.cy,o,o/2),G=H4(T,o,c),K=Ys(r.innerRadius,G,0),ee=Ys(r.outerRadius,G,G*.8),H=Object.keys(s);return H.reduce(function(Z,ae){var fe=s[ae],ue=fe.domain,_e=fe.reversed,le;if(bi(fe.range))m==="angleAxis"?le=[M,R]:m==="radiusAxis"&&(le=[K,ee]),_e&&(le=[le[1],le[0]]);else{le=fe.range;var pe=le,Te=yre(pe,2);M=Te[0],R=Te[1]}var De=j4(fe,v),Xe=De.realScaleType,wt=De.scale;wt.domain(ue).range(le),U4(wt);var $e=V4(wt,Yf(Yf({},fe),{},{realScaleType:Xe})),vt=Yf(Yf(Yf({},fe),$e),{},{range:le,radius:ee,realScaleType:Xe,scale:wt,cx:B,cy:F,innerRadius:K,outerRadius:ee,startAngle:M,endAngle:R});return Yf(Yf({},Z),{},G4({},ae,vt))},{})},Ere=function(r,s){var c=r.x,m=r.y,v=s.x,T=s.y;return Math.sqrt(Math.pow(c-v,2)+Math.pow(m-T,2))},Are=function(r,s){var c=r.x,m=r.y,v=s.cx,T=s.cy,o=Ere({x:c,y:m},{x:v,y:T});if(o<=0)return{radius:o};var M=(c-v)/o,R=Math.acos(M);return m>T&&(R=2*Math.PI-R),{radius:o,angle:Sre(R),angleInRadian:R}},Pre=function(r){var s=r.startAngle,c=r.endAngle,m=Math.floor(s/360),v=Math.floor(c/360),T=Math.min(m,v);return{startAngle:s-T*360,endAngle:c-T*360}},Ire=function(r,s){var c=s.startAngle,m=s.endAngle,v=Math.floor(c/360),T=Math.floor(m/360),o=Math.min(v,T);return r+o*360},Z3=function(r,s){var c=r.x,m=r.y,v=Are({x:c,y:m},s),T=v.radius,o=v.angle,M=s.innerRadius,R=s.outerRadius;if(T<M||T>R)return!1;if(T===0)return!0;var B=Pre(s),F=B.startAngle,G=B.endAngle,K=o,ee;if(F<=G){for(;K>G;)K-=360;for(;K<F;)K+=360;ee=K>=F&&K<=G}else{for(;K>F;)K-=360;for(;K<G;)K+=360;ee=K>=G&&K<=F}return ee?Yf(Yf({},s),{},{radius:T,angle:Ire(K,s)}):null},W4=function(r){return!Le.isValidElement(r)&&!Zn(r)&&typeof r!="boolean"?r.className:""};function av(t){"@babel/helpers - typeof";return av=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},av(t)}var Cre=["offset"];function Mre(t){return kre(t)||Dre(t)||Rre(t)||Ore()}function Ore(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rre(t,r){if(t){if(typeof t=="string")return T2(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return T2(t,r)}}function Dre(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function kre(t){if(Array.isArray(t))return T2(t)}function T2(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function Lre(t,r){if(t==null)return{};var s=zre(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function zre(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}function X3(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function La(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?X3(Object(s),!0).forEach(function(c){Fre(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):X3(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function Fre(t,r,s){return r=Bre(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Bre(t){var r=Nre(t,"string");return av(r)=="symbol"?r:r+""}function Nre(t,r){if(av(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(av(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function sv(){return sv=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},sv.apply(this,arguments)}var jre=function(r){var s=r.value,c=r.formatter,m=bi(r.children)?s:r.children;return Zn(c)?c(m):m},Ure=function(r,s){var c=Ks(s-r),m=Math.min(Math.abs(s-r),360);return c*m},Vre=function(r,s,c){var m=r.position,v=r.viewBox,T=r.offset,o=r.className,M=v,R=M.cx,B=M.cy,F=M.innerRadius,G=M.outerRadius,K=M.startAngle,ee=M.endAngle,H=M.clockWise,Z=(F+G)/2,ae=Ure(K,ee),fe=ae>=0?1:-1,ue,_e;m==="insideStart"?(ue=K+fe*T,_e=H):m==="insideEnd"?(ue=ee-fe*T,_e=!H):m==="end"&&(ue=ee+fe*T,_e=H),_e=ae<=0?_e:!_e;var le=vo(R,B,Z,ue),pe=vo(R,B,Z,ue+(_e?1:-1)*359),Te="M".concat(le.x,",").concat(le.y,`
    A`).concat(Z,",").concat(Z,",0,1,").concat(_e?0:1,`,
    `).concat(pe.x,",").concat(pe.y),De=bi(r.id)?Rv("recharts-radial-line-"):r.id;return ht.createElement("text",sv({},c,{dominantBaseline:"central",className:ci("recharts-radial-bar-label",o)}),ht.createElement("defs",null,ht.createElement("path",{id:De,d:Te})),ht.createElement("textPath",{xlinkHref:"#".concat(De)},s))},$re=function(r){var s=r.viewBox,c=r.offset,m=r.position,v=s,T=v.cx,o=v.cy,M=v.innerRadius,R=v.outerRadius,B=v.startAngle,F=v.endAngle,G=(B+F)/2;if(m==="outside"){var K=vo(T,o,R+c,G),ee=K.x,H=K.y;return{x:ee,y:H,textAnchor:ee>=T?"start":"end",verticalAnchor:"middle"}}if(m==="center")return{x:T,y:o,textAnchor:"middle",verticalAnchor:"middle"};if(m==="centerTop")return{x:T,y:o,textAnchor:"middle",verticalAnchor:"start"};if(m==="centerBottom")return{x:T,y:o,textAnchor:"middle",verticalAnchor:"end"};var Z=(M+R)/2,ae=vo(T,o,Z,G),fe=ae.x,ue=ae.y;return{x:fe,y:ue,textAnchor:"middle",verticalAnchor:"middle"}},qre=function(r){var s=r.viewBox,c=r.parentViewBox,m=r.offset,v=r.position,T=s,o=T.x,M=T.y,R=T.width,B=T.height,F=B>=0?1:-1,G=F*m,K=F>0?"end":"start",ee=F>0?"start":"end",H=R>=0?1:-1,Z=H*m,ae=H>0?"end":"start",fe=H>0?"start":"end";if(v==="top"){var ue={x:o+R/2,y:M-F*m,textAnchor:"middle",verticalAnchor:K};return La(La({},ue),c?{height:Math.max(M-c.y,0),width:R}:{})}if(v==="bottom"){var _e={x:o+R/2,y:M+B+G,textAnchor:"middle",verticalAnchor:ee};return La(La({},_e),c?{height:Math.max(c.y+c.height-(M+B),0),width:R}:{})}if(v==="left"){var le={x:o-Z,y:M+B/2,textAnchor:ae,verticalAnchor:"middle"};return La(La({},le),c?{width:Math.max(le.x-c.x,0),height:B}:{})}if(v==="right"){var pe={x:o+R+Z,y:M+B/2,textAnchor:fe,verticalAnchor:"middle"};return La(La({},pe),c?{width:Math.max(c.x+c.width-pe.x,0),height:B}:{})}var Te=c?{width:R,height:B}:{};return v==="insideLeft"?La({x:o+Z,y:M+B/2,textAnchor:fe,verticalAnchor:"middle"},Te):v==="insideRight"?La({x:o+R-Z,y:M+B/2,textAnchor:ae,verticalAnchor:"middle"},Te):v==="insideTop"?La({x:o+R/2,y:M+G,textAnchor:"middle",verticalAnchor:ee},Te):v==="insideBottom"?La({x:o+R/2,y:M+B-G,textAnchor:"middle",verticalAnchor:K},Te):v==="insideTopLeft"?La({x:o+Z,y:M+G,textAnchor:fe,verticalAnchor:ee},Te):v==="insideTopRight"?La({x:o+R-Z,y:M+G,textAnchor:ae,verticalAnchor:ee},Te):v==="insideBottomLeft"?La({x:o+Z,y:M+B-G,textAnchor:fe,verticalAnchor:K},Te):v==="insideBottomRight"?La({x:o+R-Z,y:M+B-G,textAnchor:ae,verticalAnchor:K},Te):b_(v)&&(kr(v.x)||Am(v.x))&&(kr(v.y)||Am(v.y))?La({x:o+Ys(v.x,R),y:M+Ys(v.y,B),textAnchor:"end",verticalAnchor:"end"},Te):La({x:o+R/2,y:M+B/2,textAnchor:"middle",verticalAnchor:"middle"},Te)},Gre=function(r){return"cx"in r&&kr(r.cx)};function es(t){var r=t.offset,s=r===void 0?5:r,c=Lre(t,Cre),m=La({offset:s},c),v=m.viewBox,T=m.position,o=m.value,M=m.children,R=m.content,B=m.className,F=B===void 0?"":B,G=m.textBreakAll;if(!v||bi(o)&&bi(M)&&!Le.isValidElement(R)&&!Zn(R))return null;if(Le.isValidElement(R))return Le.cloneElement(R,m);var K;if(Zn(R)){if(K=Le.createElement(R,m),Le.isValidElement(K))return K}else K=jre(m);var ee=Gre(v),H=Vn(m,!0);if(ee&&(T==="insideStart"||T==="insideEnd"||T==="end"))return Vre(m,K,H);var Z=ee?$re(m):qre(m);return ht.createElement(Lm,sv({className:ci("recharts-label",F)},H,Z,{breakAll:G}),K)}es.displayName="Label";var Z4=function(r){var s=r.cx,c=r.cy,m=r.angle,v=r.startAngle,T=r.endAngle,o=r.r,M=r.radius,R=r.innerRadius,B=r.outerRadius,F=r.x,G=r.y,K=r.top,ee=r.left,H=r.width,Z=r.height,ae=r.clockWise,fe=r.labelViewBox;if(fe)return fe;if(kr(H)&&kr(Z)){if(kr(F)&&kr(G))return{x:F,y:G,width:H,height:Z};if(kr(K)&&kr(ee))return{x:K,y:ee,width:H,height:Z}}return kr(F)&&kr(G)?{x:F,y:G,width:0,height:0}:kr(s)&&kr(c)?{cx:s,cy:c,startAngle:v||m||0,endAngle:T||m||0,innerRadius:R||0,outerRadius:B||M||o||0,clockWise:ae}:r.viewBox?r.viewBox:{}},Hre=function(r,s){return r?r===!0?ht.createElement(es,{key:"label-implicit",viewBox:s}):za(r)?ht.createElement(es,{key:"label-implicit",viewBox:s,value:r}):Le.isValidElement(r)?r.type===es?Le.cloneElement(r,{key:"label-implicit",viewBox:s}):ht.createElement(es,{key:"label-implicit",content:r,viewBox:s}):Zn(r)?ht.createElement(es,{key:"label-implicit",content:r,viewBox:s}):b_(r)?ht.createElement(es,sv({viewBox:s},r,{key:"label-implicit"})):null:null},Wre=function(r,s){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!r||!r.children&&c&&!r.label)return null;var m=r.children,v=Z4(r),T=Xc(m,es).map(function(M,R){return Le.cloneElement(M,{viewBox:s||v,key:"label-".concat(R)})});if(!c)return T;var o=Hre(r.label,s||v);return[o].concat(Mre(T))};es.parseViewBox=Z4;es.renderCallByParent=Wre;var eA,K3;function Zre(){if(K3)return eA;K3=1;function t(r){var s=r==null?0:r.length;return s?r[s-1]:void 0}return eA=t,eA}var Xre=Zre();const Kre=Wi(Xre);function lv(t){"@babel/helpers - typeof";return lv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},lv(t)}var Yre=["valueAccessor"],Jre=["data","dataKey","clockWise","id","textBreakAll"];function Qre(t){return nne(t)||rne(t)||tne(t)||ene()}function ene(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tne(t,r){if(t){if(typeof t=="string")return E2(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return E2(t,r)}}function rne(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function nne(t){if(Array.isArray(t))return E2(t)}function E2(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function B0(){return B0=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},B0.apply(this,arguments)}function Y3(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function J3(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?Y3(Object(s),!0).forEach(function(c){ine(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):Y3(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function ine(t,r,s){return r=one(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function one(t){var r=ane(t,"string");return lv(r)=="symbol"?r:r+""}function ane(t,r){if(lv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(lv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Q3(t,r){if(t==null)return{};var s=sne(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function sne(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}var lne=function(r){return Array.isArray(r.value)?Kre(r.value):r.value};function Mp(t){var r=t.valueAccessor,s=r===void 0?lne:r,c=Q3(t,Yre),m=c.data,v=c.dataKey,T=c.clockWise,o=c.id,M=c.textBreakAll,R=Q3(c,Jre);return!m||!m.length?null:ht.createElement(to,{className:"recharts-label-list"},m.map(function(B,F){var G=bi(v)?s(B,F):Ms(B&&B.payload,v),K=bi(o)?{}:{id:"".concat(o,"-").concat(F)};return ht.createElement(es,B0({},Vn(B,!0),R,K,{parentViewBox:B.parentViewBox,value:G,textBreakAll:M,viewBox:es.parseViewBox(bi(T)?B:J3(J3({},B),{},{clockWise:T})),key:"label-".concat(F),index:F}))}))}Mp.displayName="LabelList";function cne(t,r){return t?t===!0?ht.createElement(Mp,{key:"labelList-implicit",data:r}):ht.isValidElement(t)||Zn(t)?ht.createElement(Mp,{key:"labelList-implicit",data:r,content:t}):b_(t)?ht.createElement(Mp,B0({data:r},t,{key:"labelList-implicit"})):null:null}function une(t,r){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&s&&!t.label)return null;var c=t.children,m=Xc(c,Mp).map(function(T,o){return Le.cloneElement(T,{data:r,key:"labelList-".concat(o)})});if(!s)return m;var v=cne(t.label,r);return[v].concat(Qre(m))}Mp.renderCallByParent=une;function cv(t){"@babel/helpers - typeof";return cv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},cv(t)}function A2(){return A2=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},A2.apply(this,arguments)}function eF(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function tF(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?eF(Object(s),!0).forEach(function(c){hne(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):eF(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function hne(t,r,s){return r=fne(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function fne(t){var r=dne(t,"string");return cv(r)=="symbol"?r:r+""}function dne(t,r){if(cv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(cv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var pne=function(r,s){var c=Ks(s-r),m=Math.min(Math.abs(s-r),359.999);return c*m},Kx=function(r){var s=r.cx,c=r.cy,m=r.radius,v=r.angle,T=r.sign,o=r.isExternal,M=r.cornerRadius,R=r.cornerIsExternal,B=M*(o?1:-1)+m,F=Math.asin(M/B)/F0,G=R?v:v+T*F,K=vo(s,c,B,G),ee=vo(s,c,m,G),H=R?v-T*F:v,Z=vo(s,c,B*Math.cos(F*F0),H);return{center:K,circleTangency:ee,lineTangency:Z,theta:F}},X4=function(r){var s=r.cx,c=r.cy,m=r.innerRadius,v=r.outerRadius,T=r.startAngle,o=r.endAngle,M=pne(T,o),R=T+M,B=vo(s,c,v,T),F=vo(s,c,v,R),G="M ".concat(B.x,",").concat(B.y,`
    A `).concat(v,",").concat(v,`,0,
    `).concat(+(Math.abs(M)>180),",").concat(+(T>R),`,
    `).concat(F.x,",").concat(F.y,`
  `);if(m>0){var K=vo(s,c,m,T),ee=vo(s,c,m,R);G+="L ".concat(ee.x,",").concat(ee.y,`
            A `).concat(m,",").concat(m,`,0,
            `).concat(+(Math.abs(M)>180),",").concat(+(T<=R),`,
            `).concat(K.x,",").concat(K.y," Z")}else G+="L ".concat(s,",").concat(c," Z");return G},mne=function(r){var s=r.cx,c=r.cy,m=r.innerRadius,v=r.outerRadius,T=r.cornerRadius,o=r.forceCornerRadius,M=r.cornerIsExternal,R=r.startAngle,B=r.endAngle,F=Ks(B-R),G=Kx({cx:s,cy:c,radius:v,angle:R,sign:F,cornerRadius:T,cornerIsExternal:M}),K=G.circleTangency,ee=G.lineTangency,H=G.theta,Z=Kx({cx:s,cy:c,radius:v,angle:B,sign:-F,cornerRadius:T,cornerIsExternal:M}),ae=Z.circleTangency,fe=Z.lineTangency,ue=Z.theta,_e=M?Math.abs(R-B):Math.abs(R-B)-H-ue;if(_e<0)return o?"M ".concat(ee.x,",").concat(ee.y,`
        a`).concat(T,",").concat(T,",0,0,1,").concat(T*2,`,0
        a`).concat(T,",").concat(T,",0,0,1,").concat(-T*2,`,0
      `):X4({cx:s,cy:c,innerRadius:m,outerRadius:v,startAngle:R,endAngle:B});var le="M ".concat(ee.x,",").concat(ee.y,`
    A`).concat(T,",").concat(T,",0,0,").concat(+(F<0),",").concat(K.x,",").concat(K.y,`
    A`).concat(v,",").concat(v,",0,").concat(+(_e>180),",").concat(+(F<0),",").concat(ae.x,",").concat(ae.y,`
    A`).concat(T,",").concat(T,",0,0,").concat(+(F<0),",").concat(fe.x,",").concat(fe.y,`
  `);if(m>0){var pe=Kx({cx:s,cy:c,radius:m,angle:R,sign:F,isExternal:!0,cornerRadius:T,cornerIsExternal:M}),Te=pe.circleTangency,De=pe.lineTangency,Xe=pe.theta,wt=Kx({cx:s,cy:c,radius:m,angle:B,sign:-F,isExternal:!0,cornerRadius:T,cornerIsExternal:M}),$e=wt.circleTangency,vt=wt.lineTangency,ft=wt.theta,bt=M?Math.abs(R-B):Math.abs(R-B)-Xe-ft;if(bt<0&&T===0)return"".concat(le,"L").concat(s,",").concat(c,"Z");le+="L".concat(vt.x,",").concat(vt.y,`
      A`).concat(T,",").concat(T,",0,0,").concat(+(F<0),",").concat($e.x,",").concat($e.y,`
      A`).concat(m,",").concat(m,",0,").concat(+(bt>180),",").concat(+(F>0),",").concat(Te.x,",").concat(Te.y,`
      A`).concat(T,",").concat(T,",0,0,").concat(+(F<0),",").concat(De.x,",").concat(De.y,"Z")}else le+="L".concat(s,",").concat(c,"Z");return le},gne={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},K4=function(r){var s=tF(tF({},gne),r),c=s.cx,m=s.cy,v=s.innerRadius,T=s.outerRadius,o=s.cornerRadius,M=s.forceCornerRadius,R=s.cornerIsExternal,B=s.startAngle,F=s.endAngle,G=s.className;if(T<v||B===F)return null;var K=ci("recharts-sector",G),ee=T-v,H=Ys(o,ee,0,!0),Z;return H>0&&Math.abs(B-F)<360?Z=mne({cx:c,cy:m,innerRadius:v,outerRadius:T,cornerRadius:Math.min(H,ee/2),forceCornerRadius:M,cornerIsExternal:R,startAngle:B,endAngle:F}):Z=X4({cx:c,cy:m,innerRadius:v,outerRadius:T,startAngle:B,endAngle:F}),ht.createElement("path",A2({},Vn(s,!0),{className:K,d:Z,role:"img"}))};function uv(t){"@babel/helpers - typeof";return uv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},uv(t)}function P2(){return P2=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},P2.apply(this,arguments)}function rF(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function nF(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?rF(Object(s),!0).forEach(function(c){_ne(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):rF(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function _ne(t,r,s){return r=yne(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function yne(t){var r=vne(t,"string");return uv(r)=="symbol"?r:r+""}function vne(t,r){if(uv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(uv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var iF={curveBasisClosed:NZ,curveBasisOpen:jZ,curveBasis:BZ,curveBumpX:TZ,curveBumpY:EZ,curveLinearClosed:UZ,curveLinear:Sb,curveMonotoneX:VZ,curveMonotoneY:$Z,curveNatural:qZ,curveStep:GZ,curveStepAfter:WZ,curveStepBefore:HZ},Yx=function(r){return r.x===+r.x&&r.y===+r.y},Ty=function(r){return r.x},Ey=function(r){return r.y},xne=function(r,s){if(Zn(r))return r;var c="curve".concat(bb(r));return(c==="curveMonotone"||c==="curveBump")&&s?iF["".concat(c).concat(s==="vertical"?"Y":"X")]:iF[c]||Sb},bne=function(r){var s=r.type,c=s===void 0?"linear":s,m=r.points,v=m===void 0?[]:m,T=r.baseLine,o=r.layout,M=r.connectNulls,R=M===void 0?!1:M,B=xne(c,o),F=R?v.filter(function(H){return Yx(H)}):v,G;if(Array.isArray(T)){var K=R?T.filter(function(H){return Yx(H)}):T,ee=F.map(function(H,Z){return nF(nF({},H),{},{base:K[Z]})});return o==="vertical"?G=Vx().y(Ey).x1(Ty).x0(function(H){return H.base.x}):G=Vx().x(Ty).y1(Ey).y0(function(H){return H.base.y}),G.defined(Yx).curve(B),G(ee)}return o==="vertical"&&kr(T)?G=Vx().y(Ey).x1(Ty).x0(T):kr(T)?G=Vx().x(Ty).y1(Ey).y0(T):G=Zj().x(Ty).y(Ey),G.defined(Yx).curve(B),G(F)},I2=function(r){var s=r.className,c=r.points,m=r.path,v=r.pathRef;if((!c||!c.length)&&!m)return null;var T=c&&c.length?bne(r):m;return Le.createElement("path",P2({},Vn(r,!1),f0(r),{className:ci("recharts-curve",s),d:T,ref:v}))},tA={exports:{}},rA,oF;function wne(){if(oF)return rA;oF=1;var t="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return rA=t,rA}var nA,aF;function Sne(){if(aF)return nA;aF=1;var t=wne();function r(){}function s(){}return s.resetWarningCache=r,nA=function(){function c(T,o,M,R,B,F){if(F!==t){var G=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw G.name="Invariant Violation",G}}c.isRequired=c;function m(){return c}var v={array:c,bigint:c,bool:c,func:c,number:c,object:c,string:c,symbol:c,any:c,arrayOf:m,element:c,elementType:c,instanceOf:m,node:c,objectOf:m,oneOf:m,oneOfType:m,shape:m,exact:m,checkPropTypes:s,resetWarningCache:r};return v.PropTypes=v,v},nA}var sF;function Tne(){return sF||(sF=1,tA.exports=Sne()()),tA.exports}var Ene=Tne();const Ki=Wi(Ene);var Ane=Object.getOwnPropertyNames,Pne=Object.getOwnPropertySymbols,Ine=Object.prototype.hasOwnProperty;function lF(t,r){return function(c,m,v){return t(c,m,v)&&r(c,m,v)}}function Jx(t){return function(s,c,m){if(!s||!c||typeof s!="object"||typeof c!="object")return t(s,c,m);var v=m.cache,T=v.get(s),o=v.get(c);if(T&&o)return T===c&&o===s;v.set(s,c),v.set(c,s);var M=t(s,c,m);return v.delete(s),v.delete(c),M}}function cF(t){return Ane(t).concat(Pne(t))}var Cne=Object.hasOwn||(function(t,r){return Ine.call(t,r)});function qm(t,r){return t===r||!t&&!r&&t!==t&&r!==r}var Mne="__v",One="__o",Rne="_owner",uF=Object.getOwnPropertyDescriptor,hF=Object.keys;function Dne(t,r,s){var c=t.length;if(r.length!==c)return!1;for(;c-- >0;)if(!s.equals(t[c],r[c],c,c,t,r,s))return!1;return!0}function kne(t,r){return qm(t.getTime(),r.getTime())}function Lne(t,r){return t.name===r.name&&t.message===r.message&&t.cause===r.cause&&t.stack===r.stack}function zne(t,r){return t===r}function fF(t,r,s){var c=t.size;if(c!==r.size)return!1;if(!c)return!0;for(var m=new Array(c),v=t.entries(),T,o,M=0;(T=v.next())&&!T.done;){for(var R=r.entries(),B=!1,F=0;(o=R.next())&&!o.done;){if(m[F]){F++;continue}var G=T.value,K=o.value;if(s.equals(G[0],K[0],M,F,t,r,s)&&s.equals(G[1],K[1],G[0],K[0],t,r,s)){B=m[F]=!0;break}F++}if(!B)return!1;M++}return!0}var Fne=qm;function Bne(t,r,s){var c=hF(t),m=c.length;if(hF(r).length!==m)return!1;for(;m-- >0;)if(!Y4(t,r,s,c[m]))return!1;return!0}function Ay(t,r,s){var c=cF(t),m=c.length;if(cF(r).length!==m)return!1;for(var v,T,o;m-- >0;)if(v=c[m],!Y4(t,r,s,v)||(T=uF(t,v),o=uF(r,v),(T||o)&&(!T||!o||T.configurable!==o.configurable||T.enumerable!==o.enumerable||T.writable!==o.writable)))return!1;return!0}function Nne(t,r){return qm(t.valueOf(),r.valueOf())}function jne(t,r){return t.source===r.source&&t.flags===r.flags}function dF(t,r,s){var c=t.size;if(c!==r.size)return!1;if(!c)return!0;for(var m=new Array(c),v=t.values(),T,o;(T=v.next())&&!T.done;){for(var M=r.values(),R=!1,B=0;(o=M.next())&&!o.done;){if(!m[B]&&s.equals(T.value,o.value,T.value,o.value,t,r,s)){R=m[B]=!0;break}B++}if(!R)return!1}return!0}function Une(t,r){var s=t.length;if(r.length!==s)return!1;for(;s-- >0;)if(t[s]!==r[s])return!1;return!0}function Vne(t,r){return t.hostname===r.hostname&&t.pathname===r.pathname&&t.protocol===r.protocol&&t.port===r.port&&t.hash===r.hash&&t.username===r.username&&t.password===r.password}function Y4(t,r,s,c){return(c===Rne||c===One||c===Mne)&&(t.$$typeof||r.$$typeof)?!0:Cne(r,c)&&s.equals(t[c],r[c],c,c,t,r,s)}var $ne="[object Arguments]",qne="[object Boolean]",Gne="[object Date]",Hne="[object Error]",Wne="[object Map]",Zne="[object Number]",Xne="[object Object]",Kne="[object RegExp]",Yne="[object Set]",Jne="[object String]",Qne="[object URL]",eie=Array.isArray,pF=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,mF=Object.assign,tie=Object.prototype.toString.call.bind(Object.prototype.toString);function rie(t){var r=t.areArraysEqual,s=t.areDatesEqual,c=t.areErrorsEqual,m=t.areFunctionsEqual,v=t.areMapsEqual,T=t.areNumbersEqual,o=t.areObjectsEqual,M=t.arePrimitiveWrappersEqual,R=t.areRegExpsEqual,B=t.areSetsEqual,F=t.areTypedArraysEqual,G=t.areUrlsEqual;return function(ee,H,Z){if(ee===H)return!0;if(ee==null||H==null)return!1;var ae=typeof ee;if(ae!==typeof H)return!1;if(ae!=="object")return ae==="number"?T(ee,H,Z):ae==="function"?m(ee,H,Z):!1;var fe=ee.constructor;if(fe!==H.constructor)return!1;if(fe===Object)return o(ee,H,Z);if(eie(ee))return r(ee,H,Z);if(pF!=null&&pF(ee))return F(ee,H,Z);if(fe===Date)return s(ee,H,Z);if(fe===RegExp)return R(ee,H,Z);if(fe===Map)return v(ee,H,Z);if(fe===Set)return B(ee,H,Z);var ue=tie(ee);return ue===Gne?s(ee,H,Z):ue===Kne?R(ee,H,Z):ue===Wne?v(ee,H,Z):ue===Yne?B(ee,H,Z):ue===Xne?typeof ee.then!="function"&&typeof H.then!="function"&&o(ee,H,Z):ue===Qne?G(ee,H,Z):ue===Hne?c(ee,H,Z):ue===$ne?o(ee,H,Z):ue===qne||ue===Zne||ue===Jne?M(ee,H,Z):!1}}function nie(t){var r=t.circular,s=t.createCustomConfig,c=t.strict,m={areArraysEqual:c?Ay:Dne,areDatesEqual:kne,areErrorsEqual:Lne,areFunctionsEqual:zne,areMapsEqual:c?lF(fF,Ay):fF,areNumbersEqual:Fne,areObjectsEqual:c?Ay:Bne,arePrimitiveWrappersEqual:Nne,areRegExpsEqual:jne,areSetsEqual:c?lF(dF,Ay):dF,areTypedArraysEqual:c?Ay:Une,areUrlsEqual:Vne};if(s&&(m=mF({},m,s(m))),r){var v=Jx(m.areArraysEqual),T=Jx(m.areMapsEqual),o=Jx(m.areObjectsEqual),M=Jx(m.areSetsEqual);m=mF({},m,{areArraysEqual:v,areMapsEqual:T,areObjectsEqual:o,areSetsEqual:M})}return m}function iie(t){return function(r,s,c,m,v,T,o){return t(r,s,o)}}function oie(t){var r=t.circular,s=t.comparator,c=t.createState,m=t.equals,v=t.strict;if(c)return function(M,R){var B=c(),F=B.cache,G=F===void 0?r?new WeakMap:void 0:F,K=B.meta;return s(M,R,{cache:G,equals:m,meta:K,strict:v})};if(r)return function(M,R){return s(M,R,{cache:new WeakMap,equals:m,meta:void 0,strict:v})};var T={cache:void 0,equals:m,meta:void 0,strict:v};return function(M,R){return s(M,R,T)}}var aie=Fp();Fp({strict:!0});Fp({circular:!0});Fp({circular:!0,strict:!0});Fp({createInternalComparator:function(){return qm}});Fp({strict:!0,createInternalComparator:function(){return qm}});Fp({circular:!0,createInternalComparator:function(){return qm}});Fp({circular:!0,createInternalComparator:function(){return qm},strict:!0});function Fp(t){t===void 0&&(t={});var r=t.circular,s=r===void 0?!1:r,c=t.createInternalComparator,m=t.createState,v=t.strict,T=v===void 0?!1:v,o=nie(t),M=rie(o),R=c?c(M):iie(M);return oie({circular:s,comparator:M,createState:m,equals:R,strict:T})}function sie(t){typeof requestAnimationFrame<"u"&&requestAnimationFrame(t)}function gF(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,s=-1,c=function m(v){s<0&&(s=v),v-s>r?(t(v),s=-1):sie(m)};requestAnimationFrame(c)}function C2(t){"@babel/helpers - typeof";return C2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},C2(t)}function lie(t){return fie(t)||hie(t)||uie(t)||cie()}function cie(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uie(t,r){if(t){if(typeof t=="string")return _F(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return _F(t,r)}}function _F(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function hie(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function fie(t){if(Array.isArray(t))return t}function die(){var t={},r=function(){return null},s=!1,c=function m(v){if(!s){if(Array.isArray(v)){if(!v.length)return;var T=v,o=lie(T),M=o[0],R=o.slice(1);if(typeof M=="number"){gF(m.bind(null,R),M);return}m(M),gF(m.bind(null,R));return}C2(v)==="object"&&(t=v,r(t)),typeof v=="function"&&v()}};return{stop:function(){s=!0},start:function(v){s=!1,c(v)},subscribe:function(v){return r=v,function(){r=function(){return null}}}}}function hv(t){"@babel/helpers - typeof";return hv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},hv(t)}function yF(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function vF(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?yF(Object(s),!0).forEach(function(c){J4(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):yF(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function J4(t,r,s){return r=pie(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function pie(t){var r=mie(t,"string");return hv(r)==="symbol"?r:String(r)}function mie(t,r){if(hv(t)!=="object"||t===null)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(hv(c)!=="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var gie=function(r,s){return[Object.keys(r),Object.keys(s)].reduce(function(c,m){return c.filter(function(v){return m.includes(v)})})},_ie=function(r){return r},yie=function(r){return r.replace(/([A-Z])/g,function(s){return"-".concat(s.toLowerCase())})},Ly=function(r,s){return Object.keys(s).reduce(function(c,m){return vF(vF({},c),{},J4({},m,r(m,s[m])))},{})},xF=function(r,s,c){return r.map(function(m){return"".concat(yie(m)," ").concat(s,"ms ").concat(c)}).join(",")};function vie(t,r){return wie(t)||bie(t,r)||Q4(t,r)||xie()}function xie(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bie(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var c,m,v,T,o=[],M=!0,R=!1;try{if(v=(s=s.call(t)).next,r!==0)for(;!(M=(c=v.call(s)).done)&&(o.push(c.value),o.length!==r);M=!0);}catch(B){R=!0,m=B}finally{try{if(!M&&s.return!=null&&(T=s.return(),Object(T)!==T))return}finally{if(R)throw m}}return o}}function wie(t){if(Array.isArray(t))return t}function Sie(t){return Aie(t)||Eie(t)||Q4(t)||Tie()}function Tie(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Q4(t,r){if(t){if(typeof t=="string")return M2(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return M2(t,r)}}function Eie(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Aie(t){if(Array.isArray(t))return M2(t)}function M2(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}var N0=1e-4,eU=function(r,s){return[0,3*r,3*s-6*r,3*r-3*s+1]},tU=function(r,s){return r.map(function(c,m){return c*Math.pow(s,m)}).reduce(function(c,m){return c+m})},bF=function(r,s){return function(c){var m=eU(r,s);return tU(m,c)}},Pie=function(r,s){return function(c){var m=eU(r,s),v=[].concat(Sie(m.map(function(T,o){return T*o}).slice(1)),[0]);return tU(v,c)}},wF=function(){for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];var m=s[0],v=s[1],T=s[2],o=s[3];if(s.length===1)switch(s[0]){case"linear":m=0,v=0,T=1,o=1;break;case"ease":m=.25,v=.1,T=.25,o=1;break;case"ease-in":m=.42,v=0,T=1,o=1;break;case"ease-out":m=.42,v=0,T=.58,o=1;break;case"ease-in-out":m=0,v=0,T=.58,o=1;break;default:{var M=s[0].split("(");if(M[0]==="cubic-bezier"&&M[1].split(")")[0].split(",").length===4){var R=M[1].split(")")[0].split(",").map(function(Z){return parseFloat(Z)}),B=vie(R,4);m=B[0],v=B[1],T=B[2],o=B[3]}}}var F=bF(m,T),G=bF(v,o),K=Pie(m,T),ee=function(ae){return ae>1?1:ae<0?0:ae},H=function(ae){for(var fe=ae>1?1:ae,ue=fe,_e=0;_e<8;++_e){var le=F(ue)-fe,pe=K(ue);if(Math.abs(le-fe)<N0||pe<N0)return G(ue);ue=ee(ue-le/pe)}return G(ue)};return H.isStepper=!1,H},Iie=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=r.stiff,c=s===void 0?100:s,m=r.damping,v=m===void 0?8:m,T=r.dt,o=T===void 0?17:T,M=function(B,F,G){var K=-(B-F)*c,ee=G*v,H=G+(K-ee)*o/1e3,Z=G*o/1e3+B;return Math.abs(Z-F)<N0&&Math.abs(H)<N0?[F,0]:[Z,H]};return M.isStepper=!0,M.dt=o,M},Cie=function(){for(var r=arguments.length,s=new Array(r),c=0;c<r;c++)s[c]=arguments[c];var m=s[0];if(typeof m=="string")switch(m){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return wF(m);case"spring":return Iie();default:if(m.split("(")[0]==="cubic-bezier")return wF(m)}return typeof m=="function"?m:null};function fv(t){"@babel/helpers - typeof";return fv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},fv(t)}function SF(t){return Rie(t)||Oie(t)||rU(t)||Mie()}function Mie(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Oie(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Rie(t){if(Array.isArray(t))return R2(t)}function TF(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function ds(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?TF(Object(s),!0).forEach(function(c){O2(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):TF(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function O2(t,r,s){return r=Die(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Die(t){var r=kie(t,"string");return fv(r)==="symbol"?r:String(r)}function kie(t,r){if(fv(t)!=="object"||t===null)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(fv(c)!=="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Lie(t,r){return Bie(t)||Fie(t,r)||rU(t,r)||zie()}function zie(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rU(t,r){if(t){if(typeof t=="string")return R2(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return R2(t,r)}}function R2(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function Fie(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var c,m,v,T,o=[],M=!0,R=!1;try{if(v=(s=s.call(t)).next,r!==0)for(;!(M=(c=v.call(s)).done)&&(o.push(c.value),o.length!==r);M=!0);}catch(B){R=!0,m=B}finally{try{if(!M&&s.return!=null&&(T=s.return(),Object(T)!==T))return}finally{if(R)throw m}}return o}}function Bie(t){if(Array.isArray(t))return t}var j0=function(r,s,c){return r+(s-r)*c},D2=function(r){var s=r.from,c=r.to;return s!==c},Nie=function t(r,s,c){var m=Ly(function(v,T){if(D2(T)){var o=r(T.from,T.to,T.velocity),M=Lie(o,2),R=M[0],B=M[1];return ds(ds({},T),{},{from:R,velocity:B})}return T},s);return c<1?Ly(function(v,T){return D2(T)?ds(ds({},T),{},{velocity:j0(T.velocity,m[v].velocity,c),from:j0(T.from,m[v].from,c)}):T},s):t(r,m,c-1)};const jie=(function(t,r,s,c,m){var v=gie(t,r),T=v.reduce(function(Z,ae){return ds(ds({},Z),{},O2({},ae,[t[ae],r[ae]]))},{}),o=v.reduce(function(Z,ae){return ds(ds({},Z),{},O2({},ae,{from:t[ae],velocity:0,to:r[ae]}))},{}),M=-1,R,B,F=function(){return null},G=function(){return Ly(function(ae,fe){return fe.from},o)},K=function(){return!Object.values(o).filter(D2).length},ee=function(ae){R||(R=ae);var fe=ae-R,ue=fe/s.dt;o=Nie(s,o,ue),m(ds(ds(ds({},t),r),G())),R=ae,K()||(M=requestAnimationFrame(F))},H=function(ae){B||(B=ae);var fe=(ae-B)/c,ue=Ly(function(le,pe){return j0.apply(void 0,SF(pe).concat([s(fe)]))},T);if(m(ds(ds(ds({},t),r),ue)),fe<1)M=requestAnimationFrame(F);else{var _e=Ly(function(le,pe){return j0.apply(void 0,SF(pe).concat([s(1)]))},T);m(ds(ds(ds({},t),r),_e))}};return F=s.isStepper?ee:H,function(){return requestAnimationFrame(F),function(){cancelAnimationFrame(M)}}});function t_(t){"@babel/helpers - typeof";return t_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},t_(t)}var Uie=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function Vie(t,r){if(t==null)return{};var s=$ie(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function $ie(t,r){if(t==null)return{};var s={},c=Object.keys(t),m,v;for(v=0;v<c.length;v++)m=c[v],!(r.indexOf(m)>=0)&&(s[m]=t[m]);return s}function iA(t){return Wie(t)||Hie(t)||Gie(t)||qie()}function qie(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Gie(t,r){if(t){if(typeof t=="string")return k2(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return k2(t,r)}}function Hie(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Wie(t){if(Array.isArray(t))return k2(t)}function k2(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function EF(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function qu(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?EF(Object(s),!0).forEach(function(c){Oy(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):EF(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function Oy(t,r,s){return r=nU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Zie(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Xie(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,nU(c.key),c)}}function Kie(t,r,s){return r&&Xie(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function nU(t){var r=Yie(t,"string");return t_(r)==="symbol"?r:String(r)}function Yie(t,r){if(t_(t)!=="object"||t===null)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(t_(c)!=="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Jie(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&L2(t,r)}function L2(t,r){return L2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},L2(t,r)}function Qie(t){var r=eoe();return function(){var c=U0(t),m;if(r){var v=U0(this).constructor;m=Reflect.construct(c,arguments,v)}else m=c.apply(this,arguments);return z2(this,m)}}function z2(t,r){if(r&&(t_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return F2(t)}function F2(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function eoe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function U0(t){return U0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},U0(t)}var cd=(function(t){Jie(s,t);var r=Qie(s);function s(c,m){var v;Zie(this,s),v=r.call(this,c,m);var T=v.props,o=T.isActive,M=T.attributeName,R=T.from,B=T.to,F=T.steps,G=T.children,K=T.duration;if(v.handleStyleChange=v.handleStyleChange.bind(F2(v)),v.changeStyle=v.changeStyle.bind(F2(v)),!o||K<=0)return v.state={style:{}},typeof G=="function"&&(v.state={style:B}),z2(v);if(F&&F.length)v.state={style:F[0].style};else if(R){if(typeof G=="function")return v.state={style:R},z2(v);v.state={style:M?Oy({},M,R):R}}else v.state={style:{}};return v}return Kie(s,[{key:"componentDidMount",value:function(){var m=this.props,v=m.isActive,T=m.canBegin;this.mounted=!0,!(!v||!T)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(m){var v=this.props,T=v.isActive,o=v.canBegin,M=v.attributeName,R=v.shouldReAnimate,B=v.to,F=v.from,G=this.state.style;if(o){if(!T){var K={style:M?Oy({},M,B):B};this.state&&G&&(M&&G[M]!==B||!M&&G!==B)&&this.setState(K);return}if(!(aie(m.to,B)&&m.canBegin&&m.isActive)){var ee=!m.canBegin||!m.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var H=ee||R?F:m.to;if(this.state&&G){var Z={style:M?Oy({},M,H):H};(M&&G[M]!==H||!M&&G!==H)&&this.setState(Z)}this.runAnimation(qu(qu({},this.props),{},{from:H,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var m=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),m&&m()}},{key:"handleStyleChange",value:function(m){this.changeStyle(m)}},{key:"changeStyle",value:function(m){this.mounted&&this.setState({style:m})}},{key:"runJSAnimation",value:function(m){var v=this,T=m.from,o=m.to,M=m.duration,R=m.easing,B=m.begin,F=m.onAnimationEnd,G=m.onAnimationStart,K=jie(T,o,Cie(R),M,this.changeStyle),ee=function(){v.stopJSAnimation=K()};this.manager.start([G,B,ee,M,F])}},{key:"runStepAnimation",value:function(m){var v=this,T=m.steps,o=m.begin,M=m.onAnimationStart,R=T[0],B=R.style,F=R.duration,G=F===void 0?0:F,K=function(H,Z,ae){if(ae===0)return H;var fe=Z.duration,ue=Z.easing,_e=ue===void 0?"ease":ue,le=Z.style,pe=Z.properties,Te=Z.onAnimationEnd,De=ae>0?T[ae-1]:Z,Xe=pe||Object.keys(le);if(typeof _e=="function"||_e==="spring")return[].concat(iA(H),[v.runJSAnimation.bind(v,{from:De.style,to:le,duration:fe,easing:_e}),fe]);var wt=xF(Xe,fe,_e),$e=qu(qu(qu({},De.style),le),{},{transition:wt});return[].concat(iA(H),[$e,fe,Te]).filter(_ie)};return this.manager.start([M].concat(iA(T.reduce(K,[B,Math.max(G,o)])),[m.onAnimationEnd]))}},{key:"runAnimation",value:function(m){this.manager||(this.manager=die());var v=m.begin,T=m.duration,o=m.attributeName,M=m.to,R=m.easing,B=m.onAnimationStart,F=m.onAnimationEnd,G=m.steps,K=m.children,ee=this.manager;if(this.unSubscribe=ee.subscribe(this.handleStyleChange),typeof R=="function"||typeof K=="function"||R==="spring"){this.runJSAnimation(m);return}if(G.length>1){this.runStepAnimation(m);return}var H=o?Oy({},o,M):M,Z=xF(Object.keys(H),T,R);ee.start([B,v,qu(qu({},H),{},{transition:Z}),T,F])}},{key:"render",value:function(){var m=this.props,v=m.children;m.begin;var T=m.duration;m.attributeName,m.easing;var o=m.isActive;m.steps,m.from,m.to,m.canBegin,m.onAnimationEnd,m.shouldReAnimate,m.onAnimationReStart;var M=Vie(m,Uie),R=Le.Children.count(v),B=this.state.style;if(typeof v=="function")return v(B);if(!o||R===0||T<=0)return v;var F=function(K){var ee=K.props,H=ee.style,Z=H===void 0?{}:H,ae=ee.className,fe=Le.cloneElement(K,qu(qu({},M),{},{style:qu(qu({},Z),B),className:ae}));return fe};return R===1?F(Le.Children.only(v)):ht.createElement("div",null,Le.Children.map(v,function(G){return F(G)}))}}]),s})(Le.PureComponent);cd.displayName="Animate";cd.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};cd.propTypes={from:Ki.oneOfType([Ki.object,Ki.string]),to:Ki.oneOfType([Ki.object,Ki.string]),attributeName:Ki.string,duration:Ki.number,begin:Ki.number,easing:Ki.oneOfType([Ki.string,Ki.func]),steps:Ki.arrayOf(Ki.shape({duration:Ki.number.isRequired,style:Ki.object.isRequired,easing:Ki.oneOfType([Ki.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Ki.func]),properties:Ki.arrayOf("string"),onAnimationEnd:Ki.func})),children:Ki.oneOfType([Ki.node,Ki.func]),isActive:Ki.bool,canBegin:Ki.bool,onAnimationEnd:Ki.func,shouldReAnimate:Ki.bool,onAnimationStart:Ki.func,onAnimationReStart:Ki.func};function dv(t){"@babel/helpers - typeof";return dv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},dv(t)}function V0(){return V0=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},V0.apply(this,arguments)}function toe(t,r){return ooe(t)||ioe(t,r)||noe(t,r)||roe()}function roe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function noe(t,r){if(t){if(typeof t=="string")return AF(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return AF(t,r)}}function AF(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function ioe(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var c,m,v,T,o=[],M=!0,R=!1;try{if(v=(s=s.call(t)).next,r!==0)for(;!(M=(c=v.call(s)).done)&&(o.push(c.value),o.length!==r);M=!0);}catch(B){R=!0,m=B}finally{try{if(!M&&s.return!=null&&(T=s.return(),Object(T)!==T))return}finally{if(R)throw m}}return o}}function ooe(t){if(Array.isArray(t))return t}function PF(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function IF(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?PF(Object(s),!0).forEach(function(c){aoe(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):PF(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function aoe(t,r,s){return r=soe(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function soe(t){var r=loe(t,"string");return dv(r)=="symbol"?r:r+""}function loe(t,r){if(dv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(dv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var CF=function(r,s,c,m,v){var T=Math.min(Math.abs(c)/2,Math.abs(m)/2),o=m>=0?1:-1,M=c>=0?1:-1,R=m>=0&&c>=0||m<0&&c<0?1:0,B;if(T>0&&v instanceof Array){for(var F=[0,0,0,0],G=0,K=4;G<K;G++)F[G]=v[G]>T?T:v[G];B="M".concat(r,",").concat(s+o*F[0]),F[0]>0&&(B+="A ".concat(F[0],",").concat(F[0],",0,0,").concat(R,",").concat(r+M*F[0],",").concat(s)),B+="L ".concat(r+c-M*F[1],",").concat(s),F[1]>0&&(B+="A ".concat(F[1],",").concat(F[1],",0,0,").concat(R,`,
        `).concat(r+c,",").concat(s+o*F[1])),B+="L ".concat(r+c,",").concat(s+m-o*F[2]),F[2]>0&&(B+="A ".concat(F[2],",").concat(F[2],",0,0,").concat(R,`,
        `).concat(r+c-M*F[2],",").concat(s+m)),B+="L ".concat(r+M*F[3],",").concat(s+m),F[3]>0&&(B+="A ".concat(F[3],",").concat(F[3],",0,0,").concat(R,`,
        `).concat(r,",").concat(s+m-o*F[3])),B+="Z"}else if(T>0&&v===+v&&v>0){var ee=Math.min(T,v);B="M ".concat(r,",").concat(s+o*ee,`
            A `).concat(ee,",").concat(ee,",0,0,").concat(R,",").concat(r+M*ee,",").concat(s,`
            L `).concat(r+c-M*ee,",").concat(s,`
            A `).concat(ee,",").concat(ee,",0,0,").concat(R,",").concat(r+c,",").concat(s+o*ee,`
            L `).concat(r+c,",").concat(s+m-o*ee,`
            A `).concat(ee,",").concat(ee,",0,0,").concat(R,",").concat(r+c-M*ee,",").concat(s+m,`
            L `).concat(r+M*ee,",").concat(s+m,`
            A `).concat(ee,",").concat(ee,",0,0,").concat(R,",").concat(r,",").concat(s+m-o*ee," Z")}else B="M ".concat(r,",").concat(s," h ").concat(c," v ").concat(m," h ").concat(-c," Z");return B},coe=function(r,s){if(!r||!s)return!1;var c=r.x,m=r.y,v=s.x,T=s.y,o=s.width,M=s.height;if(Math.abs(o)>0&&Math.abs(M)>0){var R=Math.min(v,v+o),B=Math.max(v,v+o),F=Math.min(T,T+M),G=Math.max(T,T+M);return c>=R&&c<=B&&m>=F&&m<=G}return!1},uoe={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},wI=function(r){var s=IF(IF({},uoe),r),c=Le.useRef(),m=Le.useState(-1),v=toe(m,2),T=v[0],o=v[1];Le.useEffect(function(){if(c.current&&c.current.getTotalLength)try{var _e=c.current.getTotalLength();_e&&o(_e)}catch{}},[]);var M=s.x,R=s.y,B=s.width,F=s.height,G=s.radius,K=s.className,ee=s.animationEasing,H=s.animationDuration,Z=s.animationBegin,ae=s.isAnimationActive,fe=s.isUpdateAnimationActive;if(M!==+M||R!==+R||B!==+B||F!==+F||B===0||F===0)return null;var ue=ci("recharts-rectangle",K);return fe?ht.createElement(cd,{canBegin:T>0,from:{width:B,height:F,x:M,y:R},to:{width:B,height:F,x:M,y:R},duration:H,animationEasing:ee,isActive:fe},function(_e){var le=_e.width,pe=_e.height,Te=_e.x,De=_e.y;return ht.createElement(cd,{canBegin:T>0,from:"0px ".concat(T===-1?1:T,"px"),to:"".concat(T,"px 0px"),attributeName:"strokeDasharray",begin:Z,duration:H,isActive:ae,easing:ee},ht.createElement("path",V0({},Vn(s,!0),{className:ue,d:CF(Te,De,le,pe,G),ref:c})))}):ht.createElement("path",V0({},Vn(s,!0),{className:ue,d:CF(M,R,B,F,G)}))},hoe=["points","className","baseLinePoints","connectNulls"];function kg(){return kg=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},kg.apply(this,arguments)}function foe(t,r){if(t==null)return{};var s=doe(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function doe(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}function MF(t){return _oe(t)||goe(t)||moe(t)||poe()}function poe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function moe(t,r){if(t){if(typeof t=="string")return B2(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return B2(t,r)}}function goe(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function _oe(t){if(Array.isArray(t))return B2(t)}function B2(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}var OF=function(r){return r&&r.x===+r.x&&r.y===+r.y},yoe=function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=[[]];return r.forEach(function(c){OF(c)?s[s.length-1].push(c):s[s.length-1].length>0&&s.push([])}),OF(r[0])&&s[s.length-1].push(r[0]),s[s.length-1].length<=0&&(s=s.slice(0,-1)),s},zy=function(r,s){var c=yoe(r);s&&(c=[c.reduce(function(v,T){return[].concat(MF(v),MF(T))},[])]);var m=c.map(function(v){return v.reduce(function(T,o,M){return"".concat(T).concat(M===0?"M":"L").concat(o.x,",").concat(o.y)},"")}).join("");return c.length===1?"".concat(m,"Z"):m},voe=function(r,s,c){var m=zy(r,c);return"".concat(m.slice(-1)==="Z"?m.slice(0,-1):m,"L").concat(zy(s.reverse(),c).slice(1))},xoe=function(r){var s=r.points,c=r.className,m=r.baseLinePoints,v=r.connectNulls,T=foe(r,hoe);if(!s||!s.length)return null;var o=ci("recharts-polygon",c);if(m&&m.length){var M=T.stroke&&T.stroke!=="none",R=voe(s,m,v);return ht.createElement("g",{className:o},ht.createElement("path",kg({},Vn(T,!0),{fill:R.slice(-1)==="Z"?T.fill:"none",stroke:"none",d:R})),M?ht.createElement("path",kg({},Vn(T,!0),{fill:"none",d:zy(s,v)})):null,M?ht.createElement("path",kg({},Vn(T,!0),{fill:"none",d:zy(m,v)})):null)}var B=zy(s,v);return ht.createElement("path",kg({},Vn(T,!0),{fill:B.slice(-1)==="Z"?T.fill:"none",className:o,d:B}))};function N2(){return N2=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},N2.apply(this,arguments)}var SI=function(r){var s=r.cx,c=r.cy,m=r.r,v=r.className,T=ci("recharts-dot",v);return s===+s&&c===+c&&m===+m?Le.createElement("circle",N2({},Vn(r,!1),f0(r),{className:T,cx:s,cy:c,r:m})):null};function pv(t){"@babel/helpers - typeof";return pv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},pv(t)}var boe=["x","y","top","left","width","height","className"];function j2(){return j2=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},j2.apply(this,arguments)}function RF(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function woe(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?RF(Object(s),!0).forEach(function(c){Soe(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):RF(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function Soe(t,r,s){return r=Toe(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Toe(t){var r=Eoe(t,"string");return pv(r)=="symbol"?r:r+""}function Eoe(t,r){if(pv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(pv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Aoe(t,r){if(t==null)return{};var s=Poe(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function Poe(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}var Ioe=function(r,s,c,m,v,T){return"M".concat(r,",").concat(v,"v").concat(m,"M").concat(T,",").concat(s,"h").concat(c)},Coe=function(r){var s=r.x,c=s===void 0?0:s,m=r.y,v=m===void 0?0:m,T=r.top,o=T===void 0?0:T,M=r.left,R=M===void 0?0:M,B=r.width,F=B===void 0?0:B,G=r.height,K=G===void 0?0:G,ee=r.className,H=Aoe(r,boe),Z=woe({x:c,y:v,top:o,left:R,width:F,height:K},H);return!kr(c)||!kr(v)||!kr(F)||!kr(K)||!kr(o)||!kr(R)?null:ht.createElement("path",j2({},Vn(Z,!0),{className:ci("recharts-cross",ee),d:Ioe(c,v,F,K,o,R)}))},oA,DF;function Moe(){if(DF)return oA;DF=1;var t=kb(),r=y4(),s=Jh();function c(m,v){return m&&m.length?t(m,s(v,2),r):void 0}return oA=c,oA}var Ooe=Moe();const Roe=Wi(Ooe);var aA,kF;function Doe(){if(kF)return aA;kF=1;var t=kb(),r=Jh(),s=v4();function c(m,v){return m&&m.length?t(m,r(v,2),s):void 0}return aA=c,aA}var koe=Doe();const Loe=Wi(koe);var zoe=["cx","cy","angle","ticks","axisLine"],Foe=["ticks","tick","angle","tickFormatter","stroke"];function r_(t){"@babel/helpers - typeof";return r_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},r_(t)}function Fy(){return Fy=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},Fy.apply(this,arguments)}function LF(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function bm(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?LF(Object(s),!0).forEach(function(c){Ub(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):LF(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function zF(t,r){if(t==null)return{};var s=Boe(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function Boe(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}function Noe(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function FF(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,oU(c.key),c)}}function joe(t,r,s){return r&&FF(t.prototype,r),s&&FF(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function Uoe(t,r,s){return r=$0(r),Voe(t,iU()?Reflect.construct(r,s||[],$0(t).constructor):r.apply(t,s))}function Voe(t,r){if(r&&(r_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $oe(t)}function $oe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function iU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(iU=function(){return!!t})()}function $0(t){return $0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},$0(t)}function qoe(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&U2(t,r)}function U2(t,r){return U2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},U2(t,r)}function Ub(t,r,s){return r=oU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function oU(t){var r=Goe(t,"string");return r_(r)=="symbol"?r:r+""}function Goe(t,r){if(r_(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(r_(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var Vb=(function(t){function r(){return Noe(this,r),Uoe(this,r,arguments)}return qoe(r,t),joe(r,[{key:"getTickValueCoord",value:function(c){var m=c.coordinate,v=this.props,T=v.angle,o=v.cx,M=v.cy;return vo(o,M,m,T)}},{key:"getTickTextAnchor",value:function(){var c=this.props.orientation,m;switch(c){case"left":m="end";break;case"right":m="start";break;default:m="middle";break}return m}},{key:"getViewBox",value:function(){var c=this.props,m=c.cx,v=c.cy,T=c.angle,o=c.ticks,M=Roe(o,function(B){return B.coordinate||0}),R=Loe(o,function(B){return B.coordinate||0});return{cx:m,cy:v,startAngle:T,endAngle:T,innerRadius:R.coordinate||0,outerRadius:M.coordinate||0}}},{key:"renderAxisLine",value:function(){var c=this.props,m=c.cx,v=c.cy,T=c.angle,o=c.ticks,M=c.axisLine,R=zF(c,zoe),B=o.reduce(function(ee,H){return[Math.min(ee[0],H.coordinate),Math.max(ee[1],H.coordinate)]},[1/0,-1/0]),F=vo(m,v,B[0],T),G=vo(m,v,B[1],T),K=bm(bm(bm({},Vn(R,!1)),{},{fill:"none"},Vn(M,!1)),{},{x1:F.x,y1:F.y,x2:G.x,y2:G.y});return ht.createElement("line",Fy({className:"recharts-polar-radius-axis-line"},K))}},{key:"renderTicks",value:function(){var c=this,m=this.props,v=m.ticks,T=m.tick,o=m.angle,M=m.tickFormatter,R=m.stroke,B=zF(m,Foe),F=this.getTickTextAnchor(),G=Vn(B,!1),K=Vn(T,!1),ee=v.map(function(H,Z){var ae=c.getTickValueCoord(H),fe=bm(bm(bm(bm({textAnchor:F,transform:"rotate(".concat(90-o,", ").concat(ae.x,", ").concat(ae.y,")")},G),{},{stroke:"none",fill:R},K),{},{index:Z},ae),{},{payload:H});return ht.createElement(to,Fy({className:ci("recharts-polar-radius-axis-tick",W4(T)),key:"tick-".concat(H.coordinate)},km(c.props,H,Z)),r.renderTickItem(T,fe,M?M(H.value,Z):H.value))});return ht.createElement(to,{className:"recharts-polar-radius-axis-ticks"},ee)}},{key:"render",value:function(){var c=this.props,m=c.ticks,v=c.axisLine,T=c.tick;return!m||!m.length?null:ht.createElement(to,{className:ci("recharts-polar-radius-axis",this.props.className)},v&&this.renderAxisLine(),T&&this.renderTicks(),es.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(c,m,v){var T;return ht.isValidElement(c)?T=ht.cloneElement(c,m):Zn(c)?T=c(m):T=ht.createElement(Lm,Fy({},m,{className:"recharts-polar-radius-axis-tick-value"}),v),T}}])})(Le.PureComponent);Ub(Vb,"displayName","PolarRadiusAxis");Ub(Vb,"axisType","radiusAxis");Ub(Vb,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function n_(t){"@babel/helpers - typeof";return n_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},n_(t)}function Em(){return Em=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},Em.apply(this,arguments)}function BF(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function wm(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?BF(Object(s),!0).forEach(function(c){$b(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):BF(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function Hoe(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function NF(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,sU(c.key),c)}}function Woe(t,r,s){return r&&NF(t.prototype,r),s&&NF(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function Zoe(t,r,s){return r=q0(r),Xoe(t,aU()?Reflect.construct(r,s||[],q0(t).constructor):r.apply(t,s))}function Xoe(t,r){if(r&&(n_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Koe(t)}function Koe(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function aU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(aU=function(){return!!t})()}function q0(t){return q0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},q0(t)}function Yoe(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&V2(t,r)}function V2(t,r){return V2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},V2(t,r)}function $b(t,r,s){return r=sU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function sU(t){var r=Joe(t,"string");return n_(r)=="symbol"?r:r+""}function Joe(t,r){if(n_(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(n_(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var Qoe=Math.PI/180,jF=1e-5,qb=(function(t){function r(){return Hoe(this,r),Zoe(this,r,arguments)}return Yoe(r,t),Woe(r,[{key:"getTickLineCoord",value:function(c){var m=this.props,v=m.cx,T=m.cy,o=m.radius,M=m.orientation,R=m.tickSize,B=R||8,F=vo(v,T,o,c.coordinate),G=vo(v,T,o+(M==="inner"?-1:1)*B,c.coordinate);return{x1:F.x,y1:F.y,x2:G.x,y2:G.y}}},{key:"getTickTextAnchor",value:function(c){var m=this.props.orientation,v=Math.cos(-c.coordinate*Qoe),T;return v>jF?T=m==="outer"?"start":"end":v<-jF?T=m==="outer"?"end":"start":T="middle",T}},{key:"renderAxisLine",value:function(){var c=this.props,m=c.cx,v=c.cy,T=c.radius,o=c.axisLine,M=c.axisLineType,R=wm(wm({},Vn(this.props,!1)),{},{fill:"none"},Vn(o,!1));if(M==="circle")return ht.createElement(SI,Em({className:"recharts-polar-angle-axis-line"},R,{cx:m,cy:v,r:T}));var B=this.props.ticks,F=B.map(function(G){return vo(m,v,T,G.coordinate)});return ht.createElement(xoe,Em({className:"recharts-polar-angle-axis-line"},R,{points:F}))}},{key:"renderTicks",value:function(){var c=this,m=this.props,v=m.ticks,T=m.tick,o=m.tickLine,M=m.tickFormatter,R=m.stroke,B=Vn(this.props,!1),F=Vn(T,!1),G=wm(wm({},B),{},{fill:"none"},Vn(o,!1)),K=v.map(function(ee,H){var Z=c.getTickLineCoord(ee),ae=c.getTickTextAnchor(ee),fe=wm(wm(wm({textAnchor:ae},B),{},{stroke:"none",fill:R},F),{},{index:H,payload:ee,x:Z.x2,y:Z.y2});return ht.createElement(to,Em({className:ci("recharts-polar-angle-axis-tick",W4(T)),key:"tick-".concat(ee.coordinate)},km(c.props,ee,H)),o&&ht.createElement("line",Em({className:"recharts-polar-angle-axis-tick-line"},G,Z)),T&&r.renderTickItem(T,fe,M?M(ee.value,H):ee.value))});return ht.createElement(to,{className:"recharts-polar-angle-axis-ticks"},K)}},{key:"render",value:function(){var c=this.props,m=c.ticks,v=c.radius,T=c.axisLine;return v<=0||!m||!m.length?null:ht.createElement(to,{className:ci("recharts-polar-angle-axis",this.props.className)},T&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(c,m,v){var T;return ht.isValidElement(c)?T=ht.cloneElement(c,m):Zn(c)?T=c(m):T=ht.createElement(Lm,Em({},m,{className:"recharts-polar-angle-axis-tick-value"}),v),T}}])})(Le.PureComponent);$b(qb,"displayName","PolarAngleAxis");$b(qb,"axisType","angleAxis");$b(qb,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var sA,UF;function eae(){if(UF)return sA;UF=1;var t=_5(),r=t(Object.getPrototypeOf,Object);return sA=r,sA}var lA,VF;function tae(){if(VF)return lA;VF=1;var t=hd(),r=eae(),s=fd(),c="[object Object]",m=Function.prototype,v=Object.prototype,T=m.toString,o=v.hasOwnProperty,M=T.call(Object);function R(B){if(!s(B)||t(B)!=c)return!1;var F=r(B);if(F===null)return!0;var G=o.call(F,"constructor")&&F.constructor;return typeof G=="function"&&G instanceof G&&T.call(G)==M}return lA=R,lA}var rae=tae();const nae=Wi(rae);var cA,$F;function iae(){if($F)return cA;$F=1;var t=hd(),r=fd(),s="[object Boolean]";function c(m){return m===!0||m===!1||r(m)&&t(m)==s}return cA=c,cA}var oae=iae();const aae=Wi(oae);function mv(t){"@babel/helpers - typeof";return mv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},mv(t)}function G0(){return G0=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},G0.apply(this,arguments)}function sae(t,r){return hae(t)||uae(t,r)||cae(t,r)||lae()}function lae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cae(t,r){if(t){if(typeof t=="string")return qF(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return qF(t,r)}}function qF(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function uae(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var c,m,v,T,o=[],M=!0,R=!1;try{if(v=(s=s.call(t)).next,r!==0)for(;!(M=(c=v.call(s)).done)&&(o.push(c.value),o.length!==r);M=!0);}catch(B){R=!0,m=B}finally{try{if(!M&&s.return!=null&&(T=s.return(),Object(T)!==T))return}finally{if(R)throw m}}return o}}function hae(t){if(Array.isArray(t))return t}function GF(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function HF(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?GF(Object(s),!0).forEach(function(c){fae(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):GF(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function fae(t,r,s){return r=dae(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function dae(t){var r=pae(t,"string");return mv(r)=="symbol"?r:r+""}function pae(t,r){if(mv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(mv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var WF=function(r,s,c,m,v){var T=c-m,o;return o="M ".concat(r,",").concat(s),o+="L ".concat(r+c,",").concat(s),o+="L ".concat(r+c-T/2,",").concat(s+v),o+="L ".concat(r+c-T/2-m,",").concat(s+v),o+="L ".concat(r,",").concat(s," Z"),o},mae={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},gae=function(r){var s=HF(HF({},mae),r),c=Le.useRef(),m=Le.useState(-1),v=sae(m,2),T=v[0],o=v[1];Le.useEffect(function(){if(c.current&&c.current.getTotalLength)try{var ue=c.current.getTotalLength();ue&&o(ue)}catch{}},[]);var M=s.x,R=s.y,B=s.upperWidth,F=s.lowerWidth,G=s.height,K=s.className,ee=s.animationEasing,H=s.animationDuration,Z=s.animationBegin,ae=s.isUpdateAnimationActive;if(M!==+M||R!==+R||B!==+B||F!==+F||G!==+G||B===0&&F===0||G===0)return null;var fe=ci("recharts-trapezoid",K);return ae?ht.createElement(cd,{canBegin:T>0,from:{upperWidth:0,lowerWidth:0,height:G,x:M,y:R},to:{upperWidth:B,lowerWidth:F,height:G,x:M,y:R},duration:H,animationEasing:ee,isActive:ae},function(ue){var _e=ue.upperWidth,le=ue.lowerWidth,pe=ue.height,Te=ue.x,De=ue.y;return ht.createElement(cd,{canBegin:T>0,from:"0px ".concat(T===-1?1:T,"px"),to:"".concat(T,"px 0px"),attributeName:"strokeDasharray",begin:Z,duration:H,easing:ee},ht.createElement("path",G0({},Vn(s,!0),{className:fe,d:WF(Te,De,_e,le,pe),ref:c})))}):ht.createElement("g",null,ht.createElement("path",G0({},Vn(s,!0),{className:fe,d:WF(M,R,B,F,G)})))},_ae=["option","shapeType","propTransformer","activeClassName","isActive"];function gv(t){"@babel/helpers - typeof";return gv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},gv(t)}function yae(t,r){if(t==null)return{};var s=vae(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function vae(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}function ZF(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function H0(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?ZF(Object(s),!0).forEach(function(c){xae(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):ZF(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function xae(t,r,s){return r=bae(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function bae(t){var r=wae(t,"string");return gv(r)=="symbol"?r:r+""}function wae(t,r){if(gv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(gv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Sae(t,r){return H0(H0({},r),t)}function Tae(t,r){return t==="symbols"}function XF(t){var r=t.shapeType,s=t.elementProps;switch(r){case"rectangle":return ht.createElement(wI,s);case"trapezoid":return ht.createElement(gae,s);case"sector":return ht.createElement(K4,s);case"symbols":if(Tae(r))return ht.createElement(jP,s);break;default:return null}}function Eae(t){return Le.isValidElement(t)?t.props:t}function lU(t){var r=t.option,s=t.shapeType,c=t.propTransformer,m=c===void 0?Sae:c,v=t.activeClassName,T=v===void 0?"recharts-active-shape":v,o=t.isActive,M=yae(t,_ae),R;if(Le.isValidElement(r))R=Le.cloneElement(r,H0(H0({},M),Eae(r)));else if(Zn(r))R=r(M);else if(nae(r)&&!aae(r)){var B=m(r,M);R=ht.createElement(XF,{shapeType:s,elementProps:B})}else{var F=M;R=ht.createElement(XF,{shapeType:s,elementProps:F})}return o?ht.createElement(to,{className:T},R):R}function Gb(t,r){return r!=null&&"trapezoids"in t.props}function Hb(t,r){return r!=null&&"sectors"in t.props}function _v(t,r){return r!=null&&"points"in t.props}function Aae(t,r){var s,c,m=t.x===(r==null||(s=r.labelViewBox)===null||s===void 0?void 0:s.x)||t.x===r.x,v=t.y===(r==null||(c=r.labelViewBox)===null||c===void 0?void 0:c.y)||t.y===r.y;return m&&v}function Pae(t,r){var s=t.endAngle===r.endAngle,c=t.startAngle===r.startAngle;return s&&c}function Iae(t,r){var s=t.x===r.x,c=t.y===r.y,m=t.z===r.z;return s&&c&&m}function Cae(t,r){var s;return Gb(t,r)?s=Aae:Hb(t,r)?s=Pae:_v(t,r)&&(s=Iae),s}function Mae(t,r){var s;return Gb(t,r)?s="trapezoids":Hb(t,r)?s="sectors":_v(t,r)&&(s="points"),s}function Oae(t,r){if(Gb(t,r)){var s;return(s=r.tooltipPayload)===null||s===void 0||(s=s[0])===null||s===void 0||(s=s.payload)===null||s===void 0?void 0:s.payload}if(Hb(t,r)){var c;return(c=r.tooltipPayload)===null||c===void 0||(c=c[0])===null||c===void 0||(c=c.payload)===null||c===void 0?void 0:c.payload}return _v(t,r)?r.payload:{}}function Rae(t){var r=t.activeTooltipItem,s=t.graphicalItem,c=t.itemData,m=Mae(s,r),v=Oae(s,r),T=c.filter(function(M,R){var B=Fb(v,M),F=s.props[m].filter(function(ee){var H=Cae(s,r);return H(ee,r)}),G=s.props[m].indexOf(F[F.length-1]),K=R===G;return B&&K}),o=c.indexOf(T[T.length-1]);return o}var i0;function i_(t){"@babel/helpers - typeof";return i_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},i_(t)}function Lg(){return Lg=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},Lg.apply(this,arguments)}function KF(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function _o(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?KF(Object(s),!0).forEach(function(c){Hc(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):KF(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function Dae(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function YF(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,uU(c.key),c)}}function kae(t,r,s){return r&&YF(t.prototype,r),s&&YF(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function Lae(t,r,s){return r=W0(r),zae(t,cU()?Reflect.construct(r,s||[],W0(t).constructor):r.apply(t,s))}function zae(t,r){if(r&&(i_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Fae(t)}function Fae(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function cU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cU=function(){return!!t})()}function W0(t){return W0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},W0(t)}function Bae(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&$2(t,r)}function $2(t,r){return $2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},$2(t,r)}function Hc(t,r,s){return r=uU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function uU(t){var r=Nae(t,"string");return i_(r)=="symbol"?r:r+""}function Nae(t,r){if(i_(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(i_(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Qh=(function(t){function r(s){var c;return Dae(this,r),c=Lae(this,r,[s]),Hc(c,"pieRef",null),Hc(c,"sectorRefs",[]),Hc(c,"id",Rv("recharts-pie-")),Hc(c,"handleAnimationEnd",function(){var m=c.props.onAnimationEnd;c.setState({isAnimationFinished:!0}),Zn(m)&&m()}),Hc(c,"handleAnimationStart",function(){var m=c.props.onAnimationStart;c.setState({isAnimationFinished:!1}),Zn(m)&&m()}),c.state={isAnimationFinished:!s.isAnimationActive,prevIsAnimationActive:s.isAnimationActive,prevAnimationId:s.animationId,sectorToFocus:0},c}return Bae(r,t),kae(r,[{key:"isActiveIndex",value:function(c){var m=this.props.activeIndex;return Array.isArray(m)?m.indexOf(c)!==-1:c===m}},{key:"hasActiveIndex",value:function(){var c=this.props.activeIndex;return Array.isArray(c)?c.length!==0:c||c===0}},{key:"renderLabels",value:function(c){var m=this.props.isAnimationActive;if(m&&!this.state.isAnimationFinished)return null;var v=this.props,T=v.label,o=v.labelLine,M=v.dataKey,R=v.valueKey,B=Vn(this.props,!1),F=Vn(T,!1),G=Vn(o,!1),K=T&&T.offsetRadius||20,ee=c.map(function(H,Z){var ae=(H.startAngle+H.endAngle)/2,fe=vo(H.cx,H.cy,H.outerRadius+K,ae),ue=_o(_o(_o(_o({},B),H),{},{stroke:"none"},F),{},{index:Z,textAnchor:r.getTextAnchor(fe.x,H.cx)},fe),_e=_o(_o(_o(_o({},B),H),{},{fill:"none",stroke:H.fill},G),{},{index:Z,points:[vo(H.cx,H.cy,H.outerRadius,ae),fe]}),le=M;return bi(M)&&bi(R)?le="value":bi(M)&&(le=R),ht.createElement(to,{key:"label-".concat(H.startAngle,"-").concat(H.endAngle,"-").concat(H.midAngle,"-").concat(Z)},o&&r.renderLabelLineItem(o,_e,"line"),r.renderLabelItem(T,ue,Ms(H,le)))});return ht.createElement(to,{className:"recharts-pie-labels"},ee)}},{key:"renderSectorsStatically",value:function(c){var m=this,v=this.props,T=v.activeShape,o=v.blendStroke,M=v.inactiveShape;return c.map(function(R,B){if(R?.startAngle===0&&R?.endAngle===0&&c.length!==1)return null;var F=m.isActiveIndex(B),G=M&&m.hasActiveIndex()?M:null,K=F?T:G,ee=_o(_o({},R),{},{stroke:o?R.fill:R.stroke,tabIndex:-1});return ht.createElement(to,Lg({ref:function(Z){Z&&!m.sectorRefs.includes(Z)&&m.sectorRefs.push(Z)},tabIndex:-1,className:"recharts-pie-sector"},km(m.props,R,B),{key:"sector-".concat(R?.startAngle,"-").concat(R?.endAngle,"-").concat(R.midAngle,"-").concat(B)}),ht.createElement(lU,Lg({option:K,isActive:F,shapeType:"sector"},ee)))})}},{key:"renderSectorsWithAnimation",value:function(){var c=this,m=this.props,v=m.sectors,T=m.isAnimationActive,o=m.animationBegin,M=m.animationDuration,R=m.animationEasing,B=m.animationId,F=this.state,G=F.prevSectors,K=F.prevIsAnimationActive;return ht.createElement(cd,{begin:o,duration:M,isActive:T,easing:R,from:{t:0},to:{t:1},key:"pie-".concat(B,"-").concat(K),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(ee){var H=ee.t,Z=[],ae=v&&v[0],fe=ae.startAngle;return v.forEach(function(ue,_e){var le=G&&G[_e],pe=_e>0?nc(ue,"paddingAngle",0):0;if(le){var Te=Tp(le.endAngle-le.startAngle,ue.endAngle-ue.startAngle),De=_o(_o({},ue),{},{startAngle:fe+pe,endAngle:fe+Te(H)+pe});Z.push(De),fe=De.endAngle}else{var Xe=ue.endAngle,wt=ue.startAngle,$e=Tp(0,Xe-wt),vt=$e(H),ft=_o(_o({},ue),{},{startAngle:fe+pe,endAngle:fe+vt+pe});Z.push(ft),fe=ft.endAngle}}),ht.createElement(to,null,c.renderSectorsStatically(Z))})}},{key:"attachKeyboardHandlers",value:function(c){var m=this;c.onkeydown=function(v){if(!v.altKey)switch(v.key){case"ArrowLeft":{var T=++m.state.sectorToFocus%m.sectorRefs.length;m.sectorRefs[T].focus(),m.setState({sectorToFocus:T});break}case"ArrowRight":{var o=--m.state.sectorToFocus<0?m.sectorRefs.length-1:m.state.sectorToFocus%m.sectorRefs.length;m.sectorRefs[o].focus(),m.setState({sectorToFocus:o});break}case"Escape":{m.sectorRefs[m.state.sectorToFocus].blur(),m.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var c=this.props,m=c.sectors,v=c.isAnimationActive,T=this.state.prevSectors;return v&&m&&m.length&&(!T||!Fb(T,m))?this.renderSectorsWithAnimation():this.renderSectorsStatically(m)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var c=this,m=this.props,v=m.hide,T=m.sectors,o=m.className,M=m.label,R=m.cx,B=m.cy,F=m.innerRadius,G=m.outerRadius,K=m.isAnimationActive,ee=this.state.isAnimationFinished;if(v||!T||!T.length||!kr(R)||!kr(B)||!kr(F)||!kr(G))return null;var H=ci("recharts-pie",o);return ht.createElement(to,{tabIndex:this.props.rootTabIndex,className:H,ref:function(ae){c.pieRef=ae}},this.renderSectors(),M&&this.renderLabels(T),es.renderCallByParent(this.props,null,!1),(!K||ee)&&Mp.renderCallByParent(this.props,T,!1))}}],[{key:"getDerivedStateFromProps",value:function(c,m){return m.prevIsAnimationActive!==c.isAnimationActive?{prevIsAnimationActive:c.isAnimationActive,prevAnimationId:c.animationId,curSectors:c.sectors,prevSectors:[],isAnimationFinished:!0}:c.isAnimationActive&&c.animationId!==m.prevAnimationId?{prevAnimationId:c.animationId,curSectors:c.sectors,prevSectors:m.curSectors,isAnimationFinished:!0}:c.sectors!==m.curSectors?{curSectors:c.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(c,m){return c>m?"start":c<m?"end":"middle"}},{key:"renderLabelLineItem",value:function(c,m,v){if(ht.isValidElement(c))return ht.cloneElement(c,m);if(Zn(c))return c(m);var T=ci("recharts-pie-label-line",typeof c!="boolean"?c.className:"");return ht.createElement(I2,Lg({},m,{key:v,type:"linear",className:T}))}},{key:"renderLabelItem",value:function(c,m,v){if(ht.isValidElement(c))return ht.cloneElement(c,m);var T=v;if(Zn(c)&&(T=c(m),ht.isValidElement(T)))return T;var o=ci("recharts-pie-label-text",typeof c!="boolean"&&!Zn(c)?c.className:"");return ht.createElement(Lm,Lg({},m,{alignmentBaseline:"middle",className:o}),T)}}])})(Le.PureComponent);i0=Qh;Hc(Qh,"displayName","Pie");Hc(Qh,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!S_.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});Hc(Qh,"parseDeltaAngle",function(t,r){var s=Ks(r-t),c=Math.min(Math.abs(r-t),360);return s*c});Hc(Qh,"getRealPieData",function(t){var r=t.data,s=t.children,c=Vn(t,!1),m=Xc(s,kv);return r&&r.length?r.map(function(v,T){return _o(_o(_o({payload:v},c),v),m&&m[T]&&m[T].props)}):m&&m.length?m.map(function(v){return _o(_o({},c),v.props)}):[]});Hc(Qh,"parseCoordinateOfPie",function(t,r){var s=r.top,c=r.left,m=r.width,v=r.height,T=H4(m,v),o=c+Ys(t.cx,m,m/2),M=s+Ys(t.cy,v,v/2),R=Ys(t.innerRadius,T,0),B=Ys(t.outerRadius,T,T*.8),F=t.maxRadius||Math.sqrt(m*m+v*v)/2;return{cx:o,cy:M,innerRadius:R,outerRadius:B,maxRadius:F}});Hc(Qh,"getComposedData",function(t){var r=t.item,s=t.offset,c=r.type.defaultProps!==void 0?_o(_o({},r.type.defaultProps),r.props):r.props,m=i0.getRealPieData(c);if(!m||!m.length)return null;var v=c.cornerRadius,T=c.startAngle,o=c.endAngle,M=c.paddingAngle,R=c.dataKey,B=c.nameKey,F=c.valueKey,G=c.tooltipType,K=Math.abs(c.minAngle),ee=i0.parseCoordinateOfPie(c,s),H=i0.parseDeltaAngle(T,o),Z=Math.abs(H),ae=R;bi(R)&&bi(F)?(Wu(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),ae="value"):bi(R)&&(Wu(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),ae=F);var fe=m.filter(function(De){return Ms(De,ae,0)!==0}).length,ue=(Z>=360?fe:fe-1)*M,_e=Z-fe*K-ue,le=m.reduce(function(De,Xe){var wt=Ms(Xe,ae,0);return De+(kr(wt)?wt:0)},0),pe;if(le>0){var Te;pe=m.map(function(De,Xe){var wt=Ms(De,ae,0),$e=Ms(De,B,Xe),vt=(kr(wt)?wt:0)/le,ft;Xe?ft=Te.endAngle+Ks(H)*M*(wt!==0?1:0):ft=T;var bt=ft+Ks(H)*((wt!==0?K:0)+vt*_e),St=(ft+bt)/2,gt=(ee.innerRadius+ee.outerRadius)/2,Rt=[{name:$e,value:wt,payload:De,dataKey:ae,type:G}],Ke=vo(ee.cx,ee.cy,gt,St);return Te=_o(_o(_o({percent:vt,cornerRadius:v,name:$e,tooltipPayload:Rt,midAngle:St,middleRadius:gt,tooltipPosition:Ke},De),ee),{},{value:Ms(De,ae),startAngle:ft,endAngle:bt,payload:De,paddingAngle:Ks(H)*M}),Te})}return _o(_o({},ee),{},{sectors:pe,data:m})});var uA,JF;function jae(){if(JF)return uA;JF=1;var t=Math.ceil,r=Math.max;function s(c,m,v,T){for(var o=-1,M=r(t((m-c)/(v||1)),0),R=Array(M);M--;)R[T?M:++o]=c,c+=v;return R}return uA=s,uA}var hA,QF;function hU(){if(QF)return hA;QF=1;var t=D5(),r=1/0,s=17976931348623157e292;function c(m){if(!m)return m===0?m:0;if(m=t(m),m===r||m===-r){var v=m<0?-1:1;return v*s}return m===m?m:0}return hA=c,hA}var fA,eB;function Uae(){if(eB)return fA;eB=1;var t=jae(),r=Pb(),s=hU();function c(m){return function(v,T,o){return o&&typeof o!="number"&&r(v,T,o)&&(T=o=void 0),v=s(v),T===void 0?(T=v,v=0):T=s(T),o=o===void 0?v<T?1:-1:s(o),t(v,T,o,m)}}return fA=c,fA}var dA,tB;function Vae(){if(tB)return dA;tB=1;var t=Uae(),r=t();return dA=r,dA}var $ae=Vae();const Z0=Wi($ae);function yv(t){"@babel/helpers - typeof";return yv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},yv(t)}function rB(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function nB(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?rB(Object(s),!0).forEach(function(c){fU(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):rB(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function fU(t,r,s){return r=qae(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function qae(t){var r=Gae(t,"string");return yv(r)=="symbol"?r:r+""}function Gae(t,r){if(yv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(yv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var Hae=["Webkit","Moz","O","ms"],Wae=function(r,s){var c=r.replace(/(\w)/,function(v){return v.toUpperCase()}),m=Hae.reduce(function(v,T){return nB(nB({},v),{},fU({},T+c,s))},{});return m[r]=s,m};function o_(t){"@babel/helpers - typeof";return o_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},o_(t)}function X0(){return X0=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},X0.apply(this,arguments)}function iB(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function pA(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?iB(Object(s),!0).forEach(function(c){Jl(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):iB(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function Zae(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function oB(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,pU(c.key),c)}}function Xae(t,r,s){return r&&oB(t.prototype,r),s&&oB(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function Kae(t,r,s){return r=K0(r),Yae(t,dU()?Reflect.construct(r,s||[],K0(t).constructor):r.apply(t,s))}function Yae(t,r){if(r&&(o_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Jae(t)}function Jae(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function dU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dU=function(){return!!t})()}function K0(t){return K0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},K0(t)}function Qae(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&q2(t,r)}function q2(t,r){return q2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},q2(t,r)}function Jl(t,r,s){return r=pU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function pU(t){var r=ese(t,"string");return o_(r)=="symbol"?r:r+""}function ese(t,r){if(o_(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(o_(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var tse=function(r){var s=r.data,c=r.startIndex,m=r.endIndex,v=r.x,T=r.width,o=r.travellerWidth;if(!s||!s.length)return{};var M=s.length,R=Dy().domain(Z0(0,M)).range([v,v+T-o]),B=R.domain().map(function(F){return R(F)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:R(c),endX:R(m),scale:R,scaleValues:B}},aB=function(r){return r.changedTouches&&!!r.changedTouches.length},a_=(function(t){function r(s){var c;return Zae(this,r),c=Kae(this,r,[s]),Jl(c,"handleDrag",function(m){c.leaveTimer&&(clearTimeout(c.leaveTimer),c.leaveTimer=null),c.state.isTravellerMoving?c.handleTravellerMove(m):c.state.isSlideMoving&&c.handleSlideDrag(m)}),Jl(c,"handleTouchMove",function(m){m.changedTouches!=null&&m.changedTouches.length>0&&c.handleDrag(m.changedTouches[0])}),Jl(c,"handleDragEnd",function(){c.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var m=c.props,v=m.endIndex,T=m.onDragEnd,o=m.startIndex;T?.({endIndex:v,startIndex:o})}),c.detachDragEndListener()}),Jl(c,"handleLeaveWrapper",function(){(c.state.isTravellerMoving||c.state.isSlideMoving)&&(c.leaveTimer=window.setTimeout(c.handleDragEnd,c.props.leaveTimeOut))}),Jl(c,"handleEnterSlideOrTraveller",function(){c.setState({isTextActive:!0})}),Jl(c,"handleLeaveSlideOrTraveller",function(){c.setState({isTextActive:!1})}),Jl(c,"handleSlideDragStart",function(m){var v=aB(m)?m.changedTouches[0]:m;c.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:v.pageX}),c.attachDragEndListener()}),c.travellerDragStartHandlers={startX:c.handleTravellerDragStart.bind(c,"startX"),endX:c.handleTravellerDragStart.bind(c,"endX")},c.state={},c}return Qae(r,t),Xae(r,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(c){var m=c.startX,v=c.endX,T=this.state.scaleValues,o=this.props,M=o.gap,R=o.data,B=R.length-1,F=Math.min(m,v),G=Math.max(m,v),K=r.getIndexInRange(T,F),ee=r.getIndexInRange(T,G);return{startIndex:K-K%M,endIndex:ee===B?B:ee-ee%M}}},{key:"getTextOfTick",value:function(c){var m=this.props,v=m.data,T=m.tickFormatter,o=m.dataKey,M=Ms(v[c],o,c);return Zn(T)?T(M,c):M}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(c){var m=this.state,v=m.slideMoveStartX,T=m.startX,o=m.endX,M=this.props,R=M.x,B=M.width,F=M.travellerWidth,G=M.startIndex,K=M.endIndex,ee=M.onChange,H=c.pageX-v;H>0?H=Math.min(H,R+B-F-o,R+B-F-T):H<0&&(H=Math.max(H,R-T,R-o));var Z=this.getIndex({startX:T+H,endX:o+H});(Z.startIndex!==G||Z.endIndex!==K)&&ee&&ee(Z),this.setState({startX:T+H,endX:o+H,slideMoveStartX:c.pageX})}},{key:"handleTravellerDragStart",value:function(c,m){var v=aB(m)?m.changedTouches[0]:m;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:c,brushMoveStartX:v.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(c){var m=this.state,v=m.brushMoveStartX,T=m.movingTravellerId,o=m.endX,M=m.startX,R=this.state[T],B=this.props,F=B.x,G=B.width,K=B.travellerWidth,ee=B.onChange,H=B.gap,Z=B.data,ae={startX:this.state.startX,endX:this.state.endX},fe=c.pageX-v;fe>0?fe=Math.min(fe,F+G-K-R):fe<0&&(fe=Math.max(fe,F-R)),ae[T]=R+fe;var ue=this.getIndex(ae),_e=ue.startIndex,le=ue.endIndex,pe=function(){var De=Z.length-1;return T==="startX"&&(o>M?_e%H===0:le%H===0)||o<M&&le===De||T==="endX"&&(o>M?le%H===0:_e%H===0)||o>M&&le===De};this.setState(Jl(Jl({},T,R+fe),"brushMoveStartX",c.pageX),function(){ee&&pe()&&ee(ue)})}},{key:"handleTravellerMoveKeyboard",value:function(c,m){var v=this,T=this.state,o=T.scaleValues,M=T.startX,R=T.endX,B=this.state[m],F=o.indexOf(B);if(F!==-1){var G=F+c;if(!(G===-1||G>=o.length)){var K=o[G];m==="startX"&&K>=R||m==="endX"&&K<=M||this.setState(Jl({},m,K),function(){v.props.onChange(v.getIndex({startX:v.state.startX,endX:v.state.endX}))})}}}},{key:"renderBackground",value:function(){var c=this.props,m=c.x,v=c.y,T=c.width,o=c.height,M=c.fill,R=c.stroke;return ht.createElement("rect",{stroke:R,fill:M,x:m,y:v,width:T,height:o})}},{key:"renderPanorama",value:function(){var c=this.props,m=c.x,v=c.y,T=c.width,o=c.height,M=c.data,R=c.children,B=c.padding,F=Le.Children.only(R);return F?ht.cloneElement(F,{x:m,y:v,width:T,height:o,margin:B,compact:!0,data:M}):null}},{key:"renderTravellerLayer",value:function(c,m){var v,T,o=this,M=this.props,R=M.y,B=M.travellerWidth,F=M.height,G=M.traveller,K=M.ariaLabel,ee=M.data,H=M.startIndex,Z=M.endIndex,ae=Math.max(c,this.props.x),fe=pA(pA({},Vn(this.props,!1)),{},{x:ae,y:R,width:B,height:F}),ue=K||"Min value: ".concat((v=ee[H])===null||v===void 0?void 0:v.name,", Max value: ").concat((T=ee[Z])===null||T===void 0?void 0:T.name);return ht.createElement(to,{tabIndex:0,role:"slider","aria-label":ue,"aria-valuenow":c,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[m],onTouchStart:this.travellerDragStartHandlers[m],onKeyDown:function(le){["ArrowLeft","ArrowRight"].includes(le.key)&&(le.preventDefault(),le.stopPropagation(),o.handleTravellerMoveKeyboard(le.key==="ArrowRight"?1:-1,m))},onFocus:function(){o.setState({isTravellerFocused:!0})},onBlur:function(){o.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},r.renderTraveller(G,fe))}},{key:"renderSlide",value:function(c,m){var v=this.props,T=v.y,o=v.height,M=v.stroke,R=v.travellerWidth,B=Math.min(c,m)+R,F=Math.max(Math.abs(m-c)-R,0);return ht.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:M,fillOpacity:.2,x:B,y:T,width:F,height:o})}},{key:"renderText",value:function(){var c=this.props,m=c.startIndex,v=c.endIndex,T=c.y,o=c.height,M=c.travellerWidth,R=c.stroke,B=this.state,F=B.startX,G=B.endX,K=5,ee={pointerEvents:"none",fill:R};return ht.createElement(to,{className:"recharts-brush-texts"},ht.createElement(Lm,X0({textAnchor:"end",verticalAnchor:"middle",x:Math.min(F,G)-K,y:T+o/2},ee),this.getTextOfTick(m)),ht.createElement(Lm,X0({textAnchor:"start",verticalAnchor:"middle",x:Math.max(F,G)+M+K,y:T+o/2},ee),this.getTextOfTick(v)))}},{key:"render",value:function(){var c=this.props,m=c.data,v=c.className,T=c.children,o=c.x,M=c.y,R=c.width,B=c.height,F=c.alwaysShowText,G=this.state,K=G.startX,ee=G.endX,H=G.isTextActive,Z=G.isSlideMoving,ae=G.isTravellerMoving,fe=G.isTravellerFocused;if(!m||!m.length||!kr(o)||!kr(M)||!kr(R)||!kr(B)||R<=0||B<=0)return null;var ue=ci("recharts-brush",v),_e=ht.Children.count(T)===1,le=Wae("userSelect","none");return ht.createElement(to,{className:ue,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:le},this.renderBackground(),_e&&this.renderPanorama(),this.renderSlide(K,ee),this.renderTravellerLayer(K,"startX"),this.renderTravellerLayer(ee,"endX"),(H||Z||ae||fe||F)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(c){var m=c.x,v=c.y,T=c.width,o=c.height,M=c.stroke,R=Math.floor(v+o/2)-1;return ht.createElement(ht.Fragment,null,ht.createElement("rect",{x:m,y:v,width:T,height:o,fill:M,stroke:"none"}),ht.createElement("line",{x1:m+1,y1:R,x2:m+T-1,y2:R,fill:"none",stroke:"#fff"}),ht.createElement("line",{x1:m+1,y1:R+2,x2:m+T-1,y2:R+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(c,m){var v;return ht.isValidElement(c)?v=ht.cloneElement(c,m):Zn(c)?v=c(m):v=r.renderDefaultTraveller(m),v}},{key:"getDerivedStateFromProps",value:function(c,m){var v=c.data,T=c.width,o=c.x,M=c.travellerWidth,R=c.updateId,B=c.startIndex,F=c.endIndex;if(v!==m.prevData||R!==m.prevUpdateId)return pA({prevData:v,prevTravellerWidth:M,prevUpdateId:R,prevX:o,prevWidth:T},v&&v.length?tse({data:v,width:T,x:o,travellerWidth:M,startIndex:B,endIndex:F}):{scale:null,scaleValues:null});if(m.scale&&(T!==m.prevWidth||o!==m.prevX||M!==m.prevTravellerWidth)){m.scale.range([o,o+T-M]);var G=m.scale.domain().map(function(K){return m.scale(K)});return{prevData:v,prevTravellerWidth:M,prevUpdateId:R,prevX:o,prevWidth:T,startX:m.scale(c.startIndex),endX:m.scale(c.endIndex),scaleValues:G}}return null}},{key:"getIndexInRange",value:function(c,m){for(var v=c.length,T=0,o=v-1;o-T>1;){var M=Math.floor((T+o)/2);c[M]>m?o=M:T=M}return m>=c[o]?o:T}}])})(Le.PureComponent);Jl(a_,"displayName","Brush");Jl(a_,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var mA,sB;function rse(){if(sB)return mA;sB=1;var t=WP();function r(s,c){var m;return t(s,function(v,T,o){return m=c(v,T,o),!m}),!!m}return mA=r,mA}var gA,lB;function nse(){if(lB)return gA;lB=1;var t=u5(),r=Jh(),s=rse(),c=El(),m=Pb();function v(T,o,M){var R=c(T)?t:s;return M&&m(T,o,M)&&(o=void 0),R(T,r(o,3))}return gA=v,gA}var ise=nse();const ose=Wi(ise);var Wh=function(r,s){var c=r.alwaysShow,m=r.ifOverflow;return c&&(m="extendDomain"),m===s},_A,cB;function ase(){if(cB)return _A;cB=1;var t=I5();function r(s,c,m){c=="__proto__"&&t?t(s,c,{configurable:!0,enumerable:!0,value:m,writable:!0}):s[c]=m}return _A=r,_A}var yA,uB;function sse(){if(uB)return yA;uB=1;var t=ase(),r=A5(),s=Jh();function c(m,v){var T={};return v=s(v,3),r(m,function(o,M,R){t(T,M,v(o,M,R))}),T}return yA=c,yA}var lse=sse();const cse=Wi(lse);var vA,hB;function use(){if(hB)return vA;hB=1;function t(r,s){for(var c=-1,m=r==null?0:r.length;++c<m;)if(!s(r[c],c,r))return!1;return!0}return vA=t,vA}var xA,fB;function hse(){if(fB)return xA;fB=1;var t=WP();function r(s,c){var m=!0;return t(s,function(v,T,o){return m=!!c(v,T,o),m}),m}return xA=r,xA}var bA,dB;function fse(){if(dB)return bA;dB=1;var t=use(),r=hse(),s=Jh(),c=El(),m=Pb();function v(T,o,M){var R=c(T)?t:r;return M&&m(T,o,M)&&(o=void 0),R(T,s(o,3))}return bA=v,bA}var dse=fse();const mU=Wi(dse);var pse=["x","y"];function vv(t){"@babel/helpers - typeof";return vv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},vv(t)}function G2(){return G2=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},G2.apply(this,arguments)}function pB(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function Py(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?pB(Object(s),!0).forEach(function(c){mse(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):pB(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function mse(t,r,s){return r=gse(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function gse(t){var r=_se(t,"string");return vv(r)=="symbol"?r:r+""}function _se(t,r){if(vv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(vv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function yse(t,r){if(t==null)return{};var s=vse(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function vse(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}function xse(t,r){var s=t.x,c=t.y,m=yse(t,pse),v="".concat(s),T=parseInt(v,10),o="".concat(c),M=parseInt(o,10),R="".concat(r.height||m.height),B=parseInt(R,10),F="".concat(r.width||m.width),G=parseInt(F,10);return Py(Py(Py(Py(Py({},r),m),T?{x:T}:{}),M?{y:M}:{}),{},{height:B,width:G,name:r.name,radius:r.radius})}function mB(t){return ht.createElement(lU,G2({shapeType:"rectangle",propTransformer:xse,activeClassName:"recharts-active-bar"},t))}var bse=function(r){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(c,m){if(typeof r=="number")return r;var v=kr(c)||H9(c);return v?r(c,m):(v||Fm(),s)}},wse=["value","background"],gU;function s_(t){"@babel/helpers - typeof";return s_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},s_(t)}function Sse(t,r){if(t==null)return{};var s=Tse(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function Tse(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}function Y0(){return Y0=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},Y0.apply(this,arguments)}function gB(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function ba(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?gB(Object(s),!0).forEach(function(c){Ip(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):gB(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function Ese(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _B(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,yU(c.key),c)}}function Ase(t,r,s){return r&&_B(t.prototype,r),s&&_B(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function Pse(t,r,s){return r=J0(r),Ise(t,_U()?Reflect.construct(r,s||[],J0(t).constructor):r.apply(t,s))}function Ise(t,r){if(r&&(s_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Cse(t)}function Cse(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _U(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(_U=function(){return!!t})()}function J0(t){return J0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},J0(t)}function Mse(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&H2(t,r)}function H2(t,r){return H2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},H2(t,r)}function Ip(t,r,s){return r=yU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function yU(t){var r=Ose(t,"string");return s_(r)=="symbol"?r:r+""}function Ose(t,r){if(s_(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(s_(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Gm=(function(t){function r(){var s;Ese(this,r);for(var c=arguments.length,m=new Array(c),v=0;v<c;v++)m[v]=arguments[v];return s=Pse(this,r,[].concat(m)),Ip(s,"state",{isAnimationFinished:!1}),Ip(s,"id",Rv("recharts-bar-")),Ip(s,"handleAnimationEnd",function(){var T=s.props.onAnimationEnd;s.setState({isAnimationFinished:!0}),T&&T()}),Ip(s,"handleAnimationStart",function(){var T=s.props.onAnimationStart;s.setState({isAnimationFinished:!1}),T&&T()}),s}return Mse(r,t),Ase(r,[{key:"renderRectanglesStatically",value:function(c){var m=this,v=this.props,T=v.shape,o=v.dataKey,M=v.activeIndex,R=v.activeBar,B=Vn(this.props,!1);return c&&c.map(function(F,G){var K=G===M,ee=K?R:T,H=ba(ba(ba({},B),F),{},{isActive:K,option:ee,index:G,dataKey:o,onAnimationStart:m.handleAnimationStart,onAnimationEnd:m.handleAnimationEnd});return ht.createElement(to,Y0({className:"recharts-bar-rectangle"},km(m.props,F,G),{key:"rectangle-".concat(F?.x,"-").concat(F?.y,"-").concat(F?.value,"-").concat(G)}),ht.createElement(mB,H))})}},{key:"renderRectanglesWithAnimation",value:function(){var c=this,m=this.props,v=m.data,T=m.layout,o=m.isAnimationActive,M=m.animationBegin,R=m.animationDuration,B=m.animationEasing,F=m.animationId,G=this.state.prevData;return ht.createElement(cd,{begin:M,duration:R,isActive:o,easing:B,from:{t:0},to:{t:1},key:"bar-".concat(F),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(K){var ee=K.t,H=v.map(function(Z,ae){var fe=G&&G[ae];if(fe){var ue=Tp(fe.x,Z.x),_e=Tp(fe.y,Z.y),le=Tp(fe.width,Z.width),pe=Tp(fe.height,Z.height);return ba(ba({},Z),{},{x:ue(ee),y:_e(ee),width:le(ee),height:pe(ee)})}if(T==="horizontal"){var Te=Tp(0,Z.height),De=Te(ee);return ba(ba({},Z),{},{y:Z.y+Z.height-De,height:De})}var Xe=Tp(0,Z.width),wt=Xe(ee);return ba(ba({},Z),{},{width:wt})});return ht.createElement(to,null,c.renderRectanglesStatically(H))})}},{key:"renderRectangles",value:function(){var c=this.props,m=c.data,v=c.isAnimationActive,T=this.state.prevData;return v&&m&&m.length&&(!T||!Fb(T,m))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(m)}},{key:"renderBackground",value:function(){var c=this,m=this.props,v=m.data,T=m.dataKey,o=m.activeIndex,M=Vn(this.props.background,!1);return v.map(function(R,B){R.value;var F=R.background,G=Sse(R,wse);if(!F)return null;var K=ba(ba(ba(ba(ba({},G),{},{fill:"#eee"},F),M),km(c.props,R,B)),{},{onAnimationStart:c.handleAnimationStart,onAnimationEnd:c.handleAnimationEnd,dataKey:T,index:B,className:"recharts-bar-background-rectangle"});return ht.createElement(mB,Y0({key:"background-bar-".concat(B),option:c.props.background,isActive:B===o},K))})}},{key:"renderErrorBar",value:function(c,m){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var v=this.props,T=v.data,o=v.xAxis,M=v.yAxis,R=v.layout,B=v.children,F=Xc(B,jb);if(!F)return null;var G=R==="vertical"?T[0].height/2:T[0].width/2,K=function(Z,ae){var fe=Array.isArray(Z.value)?Z.value[1]:Z.value;return{x:Z.x,y:Z.y,value:fe,errorVal:Ms(Z,ae)}},ee={clipPath:c?"url(#clipPath-".concat(m,")"):null};return ht.createElement(to,ee,F.map(function(H){return ht.cloneElement(H,{key:"error-bar-".concat(m,"-").concat(H.props.dataKey),data:T,xAxis:o,yAxis:M,layout:R,offset:G,dataPointFormatter:K})}))}},{key:"render",value:function(){var c=this.props,m=c.hide,v=c.data,T=c.className,o=c.xAxis,M=c.yAxis,R=c.left,B=c.top,F=c.width,G=c.height,K=c.isAnimationActive,ee=c.background,H=c.id;if(m||!v||!v.length)return null;var Z=this.state.isAnimationFinished,ae=ci("recharts-bar",T),fe=o&&o.allowDataOverflow,ue=M&&M.allowDataOverflow,_e=fe||ue,le=bi(H)?this.id:H;return ht.createElement(to,{className:ae},fe||ue?ht.createElement("defs",null,ht.createElement("clipPath",{id:"clipPath-".concat(le)},ht.createElement("rect",{x:fe?R:R-F/2,y:ue?B:B-G/2,width:fe?F:F*2,height:ue?G:G*2}))):null,ht.createElement(to,{className:"recharts-bar-rectangles",clipPath:_e?"url(#clipPath-".concat(le,")"):null},ee?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(_e,le),(!K||Z)&&Mp.renderCallByParent(this.props,v))}}],[{key:"getDerivedStateFromProps",value:function(c,m){return c.animationId!==m.prevAnimationId?{prevAnimationId:c.animationId,curData:c.data,prevData:m.curData}:c.data!==m.curData?{curData:c.data}:null}}])})(Le.PureComponent);gU=Gm;Ip(Gm,"displayName","Bar");Ip(Gm,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!S_.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Ip(Gm,"getComposedData",function(t){var r=t.props,s=t.item,c=t.barPosition,m=t.bandSize,v=t.xAxis,T=t.yAxis,o=t.xAxisTicks,M=t.yAxisTicks,R=t.stackedData,B=t.dataStartIndex,F=t.displayedData,G=t.offset,K=are(c,s);if(!K)return null;var ee=r.layout,H=s.type.defaultProps,Z=H!==void 0?ba(ba({},H),s.props):s.props,ae=Z.dataKey,fe=Z.children,ue=Z.minPointSize,_e=ee==="horizontal"?T:v,le=R?_e.scale.domain():null,pe=dre({numericAxis:_e}),Te=Xc(fe,kv),De=F.map(function(Xe,wt){var $e,vt,ft,bt,St,gt;R?$e=sre(R[B+wt],le):($e=Ms(Xe,ae),Array.isArray($e)||($e=[pe,$e]));var Rt=bse(ue,gU.defaultProps.minPointSize)($e[1],wt);if(ee==="horizontal"){var Ke,yt=[T.scale($e[0]),T.scale($e[1])],Vt=yt[0],qe=yt[1];vt=V3({axis:v,ticks:o,bandSize:m,offset:K.offset,entry:Xe,index:wt}),ft=(Ke=qe??Vt)!==null&&Ke!==void 0?Ke:void 0,bt=K.size;var mt=Vt-qe;if(St=Number.isNaN(mt)?0:mt,gt={x:vt,y:T.y,width:bt,height:T.height},Math.abs(Rt)>0&&Math.abs(St)<Math.abs(Rt)){var ar=Ks(St||Rt)*(Math.abs(Rt)-Math.abs(St));ft-=ar,St+=ar}}else{var Mr=[v.scale($e[0]),v.scale($e[1])],Gr=Mr[0],Tr=Mr[1];if(vt=Gr,ft=V3({axis:T,ticks:M,bandSize:m,offset:K.offset,entry:Xe,index:wt}),bt=Tr-Gr,St=K.size,gt={x:v.x,y:ft,width:v.width,height:St},Math.abs(Rt)>0&&Math.abs(bt)<Math.abs(Rt)){var vr=Ks(bt||Rt)*(Math.abs(Rt)-Math.abs(bt));bt+=vr}}return ba(ba(ba({},Xe),{},{x:vt,y:ft,width:bt,height:St,value:R?$e:$e[1],payload:Xe,background:gt},Te&&Te[wt]&&Te[wt].props),{},{tooltipPayload:[q4(s,Xe)],tooltipPosition:{x:vt+bt/2,y:ft+St/2}})});return ba({data:De,layout:ee},G)});function xv(t){"@babel/helpers - typeof";return xv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},xv(t)}function Rse(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function yB(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,vU(c.key),c)}}function Dse(t,r,s){return r&&yB(t.prototype,r),s&&yB(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function vB(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function Gu(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?vB(Object(s),!0).forEach(function(c){Wb(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):vB(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function Wb(t,r,s){return r=vU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function vU(t){var r=kse(t,"string");return xv(r)=="symbol"?r:r+""}function kse(t,r){if(xv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(xv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var Lse=function(r,s,c,m,v){var T=r.width,o=r.height,M=r.layout,R=r.children,B=Object.keys(s),F={left:c.left,leftMirror:c.left,right:T-c.right,rightMirror:T-c.right,top:c.top,topMirror:c.top,bottom:o-c.bottom,bottomMirror:o-c.bottom},G=!!Ql(R,Gm);return B.reduce(function(K,ee){var H=s[ee],Z=H.orientation,ae=H.domain,fe=H.padding,ue=fe===void 0?{}:fe,_e=H.mirror,le=H.reversed,pe="".concat(Z).concat(_e?"Mirror":""),Te,De,Xe,wt,$e;if(H.type==="number"&&(H.padding==="gap"||H.padding==="no-gap")){var vt=ae[1]-ae[0],ft=1/0,bt=H.categoricalDomain.sort(X9);if(bt.forEach(function(Mr,Gr){Gr>0&&(ft=Math.min((Mr||0)-(bt[Gr-1]||0),ft))}),Number.isFinite(ft)){var St=ft/vt,gt=H.layout==="vertical"?c.height:c.width;if(H.padding==="gap"&&(Te=St*gt/2),H.padding==="no-gap"){var Rt=Ys(r.barCategoryGap,St*gt),Ke=St*gt/2;Te=Ke-Rt-(Ke-Rt)/gt*Rt}}}m==="xAxis"?De=[c.left+(ue.left||0)+(Te||0),c.left+c.width-(ue.right||0)-(Te||0)]:m==="yAxis"?De=M==="horizontal"?[c.top+c.height-(ue.bottom||0),c.top+(ue.top||0)]:[c.top+(ue.top||0)+(Te||0),c.top+c.height-(ue.bottom||0)-(Te||0)]:De=H.range,le&&(De=[De[1],De[0]]);var yt=j4(H,v,G),Vt=yt.scale,qe=yt.realScaleType;Vt.domain(ae).range(De),U4(Vt);var mt=V4(Vt,Gu(Gu({},H),{},{realScaleType:qe}));m==="xAxis"?($e=Z==="top"&&!_e||Z==="bottom"&&_e,Xe=c.left,wt=F[pe]-$e*H.height):m==="yAxis"&&($e=Z==="left"&&!_e||Z==="right"&&_e,Xe=F[pe]-$e*H.width,wt=c.top);var ar=Gu(Gu(Gu({},H),mt),{},{realScaleType:qe,x:Xe,y:wt,scale:Vt,width:m==="xAxis"?c.width:H.width,height:m==="yAxis"?c.height:H.height});return ar.bandSize=z0(ar,mt),!H.hide&&m==="xAxis"?F[pe]+=($e?-1:1)*ar.height:H.hide||(F[pe]+=($e?-1:1)*ar.width),Gu(Gu({},K),{},Wb({},ee,ar))},{})},xU=function(r,s){var c=r.x,m=r.y,v=s.x,T=s.y;return{x:Math.min(c,v),y:Math.min(m,T),width:Math.abs(v-c),height:Math.abs(T-m)}},zse=function(r){var s=r.x1,c=r.y1,m=r.x2,v=r.y2;return xU({x:s,y:c},{x:m,y:v})},bU=(function(){function t(r){Rse(this,t),this.scale=r}return Dse(t,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(s){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=c.bandAware,v=c.position;if(s!==void 0){if(v)switch(v){case"start":return this.scale(s);case"middle":{var T=this.bandwidth?this.bandwidth()/2:0;return this.scale(s)+T}case"end":{var o=this.bandwidth?this.bandwidth():0;return this.scale(s)+o}default:return this.scale(s)}if(m){var M=this.bandwidth?this.bandwidth()/2:0;return this.scale(s)+M}return this.scale(s)}}},{key:"isInRange",value:function(s){var c=this.range(),m=c[0],v=c[c.length-1];return m<=v?s>=m&&s<=v:s>=v&&s<=m}}],[{key:"create",value:function(s){return new t(s)}}])})();Wb(bU,"EPS",1e-4);var TI=function(r){var s=Object.keys(r).reduce(function(c,m){return Gu(Gu({},c),{},Wb({},m,bU.create(r[m])))},{});return Gu(Gu({},s),{},{apply:function(m){var v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},T=v.bandAware,o=v.position;return cse(m,function(M,R){return s[R].apply(M,{bandAware:T,position:o})})},isInRange:function(m){return mU(m,function(v,T){return s[T].isInRange(v)})}})};function Fse(t){return(t%180+180)%180}var Bse=function(r){var s=r.width,c=r.height,m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,v=Fse(m),T=v*Math.PI/180,o=Math.atan(c/s),M=T>o&&T<Math.PI-o?c/Math.sin(T):s/Math.cos(T);return Math.abs(M)},wA,xB;function Nse(){if(xB)return wA;xB=1;var t=Jh(),r=Dv(),s=Eb();function c(m){return function(v,T,o){var M=Object(v);if(!r(v)){var R=t(T,3);v=s(v),T=function(F){return R(M[F],F,M)}}var B=m(v,T,o);return B>-1?M[R?v[B]:B]:void 0}}return wA=c,wA}var SA,bB;function jse(){if(bB)return SA;bB=1;var t=hU();function r(s){var c=t(s),m=c%1;return c===c?m?c-m:c:0}return SA=r,SA}var TA,wB;function Use(){if(wB)return TA;wB=1;var t=b5(),r=Jh(),s=jse(),c=Math.max;function m(v,T,o){var M=v==null?0:v.length;if(!M)return-1;var R=o==null?0:s(o);return R<0&&(R=c(M+R,0)),t(v,r(T,3),R)}return TA=m,TA}var EA,SB;function Vse(){if(SB)return EA;SB=1;var t=Nse(),r=Use(),s=t(r);return EA=s,EA}var $se=Vse();const qse=Wi($se);var Gse=Fj();const Hse=Wi(Gse);var Wse=Hse(function(t){return{x:t.left,y:t.top,width:t.width,height:t.height}},function(t){return["l",t.left,"t",t.top,"w",t.width,"h",t.height].join("")}),EI=Le.createContext(void 0),AI=Le.createContext(void 0),wU=Le.createContext(void 0),SU=Le.createContext({}),TU=Le.createContext(void 0),EU=Le.createContext(0),AU=Le.createContext(0),TB=function(r){var s=r.state,c=s.xAxisMap,m=s.yAxisMap,v=s.offset,T=r.clipPathId,o=r.children,M=r.width,R=r.height,B=Wse(v);return ht.createElement(EI.Provider,{value:c},ht.createElement(AI.Provider,{value:m},ht.createElement(SU.Provider,{value:v},ht.createElement(wU.Provider,{value:B},ht.createElement(TU.Provider,{value:T},ht.createElement(EU.Provider,{value:R},ht.createElement(AU.Provider,{value:M},o)))))))},Zse=function(){return Le.useContext(TU)},PU=function(r){var s=Le.useContext(EI);s==null&&Fm();var c=s[r];return c==null&&Fm(),c},Xse=function(){var r=Le.useContext(EI);return Ap(r)},Kse=function(){var r=Le.useContext(AI),s=qse(r,function(c){return mU(c.domain,Number.isFinite)});return s||Ap(r)},IU=function(r){var s=Le.useContext(AI);s==null&&Fm();var c=s[r];return c==null&&Fm(),c},Yse=function(){var r=Le.useContext(wU);return r},Jse=function(){return Le.useContext(SU)},PI=function(){return Le.useContext(AU)},II=function(){return Le.useContext(EU)};function l_(t){"@babel/helpers - typeof";return l_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},l_(t)}function Qse(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function ele(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,MU(c.key),c)}}function tle(t,r,s){return r&&ele(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function rle(t,r,s){return r=Q0(r),nle(t,CU()?Reflect.construct(r,s||[],Q0(t).constructor):r.apply(t,s))}function nle(t,r){if(r&&(l_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ile(t)}function ile(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function CU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(CU=function(){return!!t})()}function Q0(t){return Q0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},Q0(t)}function ole(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&W2(t,r)}function W2(t,r){return W2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},W2(t,r)}function EB(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function AB(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?EB(Object(s),!0).forEach(function(c){CI(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):EB(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function CI(t,r,s){return r=MU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function MU(t){var r=ale(t,"string");return l_(r)=="symbol"?r:r+""}function ale(t,r){if(l_(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(l_(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function sle(t,r){return hle(t)||ule(t,r)||cle(t,r)||lle()}function lle(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cle(t,r){if(t){if(typeof t=="string")return PB(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return PB(t,r)}}function PB(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function ule(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var c,m,v,T,o=[],M=!0,R=!1;try{if(v=(s=s.call(t)).next,r!==0)for(;!(M=(c=v.call(s)).done)&&(o.push(c.value),o.length!==r);M=!0);}catch(B){R=!0,m=B}finally{try{if(!M&&s.return!=null&&(T=s.return(),Object(T)!==T))return}finally{if(R)throw m}}return o}}function hle(t){if(Array.isArray(t))return t}function Z2(){return Z2=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},Z2.apply(this,arguments)}var fle=function(r,s){var c;return ht.isValidElement(r)?c=ht.cloneElement(r,s):Zn(r)?c=r(s):c=ht.createElement("line",Z2({},s,{className:"recharts-reference-line-line"})),c},dle=function(r,s,c,m,v,T,o,M,R){var B=v.x,F=v.y,G=v.width,K=v.height;if(c){var ee=R.y,H=r.y.apply(ee,{position:T});if(Wh(R,"discard")&&!r.y.isInRange(H))return null;var Z=[{x:B+G,y:H},{x:B,y:H}];return M==="left"?Z.reverse():Z}if(s){var ae=R.x,fe=r.x.apply(ae,{position:T});if(Wh(R,"discard")&&!r.x.isInRange(fe))return null;var ue=[{x:fe,y:F+K},{x:fe,y:F}];return o==="top"?ue.reverse():ue}if(m){var _e=R.segment,le=_e.map(function(pe){return r.apply(pe,{position:T})});return Wh(R,"discard")&&ose(le,function(pe){return!r.isInRange(pe)})?null:le}return null};function ple(t){var r=t.x,s=t.y,c=t.segment,m=t.xAxisId,v=t.yAxisId,T=t.shape,o=t.className,M=t.alwaysShow,R=Zse(),B=PU(m),F=IU(v),G=Yse();if(!R||!G)return null;Wu(M===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var K=TI({x:B.scale,y:F.scale}),ee=za(r),H=za(s),Z=c&&c.length===2,ae=dle(K,ee,H,Z,G,t.position,B.orientation,F.orientation,t);if(!ae)return null;var fe=sle(ae,2),ue=fe[0],_e=ue.x,le=ue.y,pe=fe[1],Te=pe.x,De=pe.y,Xe=Wh(t,"hidden")?"url(#".concat(R,")"):void 0,wt=AB(AB({clipPath:Xe},Vn(t,!0)),{},{x1:_e,y1:le,x2:Te,y2:De});return ht.createElement(to,{className:ci("recharts-reference-line",o)},fle(T,wt),es.renderCallByParent(t,zse({x1:_e,y1:le,x2:Te,y2:De})))}var MI=(function(t){function r(){return Qse(this,r),rle(this,r,arguments)}return ole(r,t),tle(r,[{key:"render",value:function(){return ht.createElement(ple,this.props)}}])})(ht.Component);CI(MI,"displayName","ReferenceLine");CI(MI,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function X2(){return X2=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},X2.apply(this,arguments)}function c_(t){"@babel/helpers - typeof";return c_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},c_(t)}function IB(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function CB(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?IB(Object(s),!0).forEach(function(c){Zb(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):IB(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function mle(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function gle(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,RU(c.key),c)}}function _le(t,r,s){return r&&gle(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function yle(t,r,s){return r=eb(r),vle(t,OU()?Reflect.construct(r,s||[],eb(t).constructor):r.apply(t,s))}function vle(t,r){if(r&&(c_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return xle(t)}function xle(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function OU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(OU=function(){return!!t})()}function eb(t){return eb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},eb(t)}function ble(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&K2(t,r)}function K2(t,r){return K2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},K2(t,r)}function Zb(t,r,s){return r=RU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function RU(t){var r=wle(t,"string");return c_(r)=="symbol"?r:r+""}function wle(t,r){if(c_(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(c_(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Sle=function(r){var s=r.x,c=r.y,m=r.xAxis,v=r.yAxis,T=TI({x:m.scale,y:v.scale}),o=T.apply({x:s,y:c},{bandAware:!0});return Wh(r,"discard")&&!T.isInRange(o)?null:o},Xb=(function(t){function r(){return mle(this,r),yle(this,r,arguments)}return ble(r,t),_le(r,[{key:"render",value:function(){var c=this.props,m=c.x,v=c.y,T=c.r,o=c.alwaysShow,M=c.clipPathId,R=za(m),B=za(v);if(Wu(o===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!R||!B)return null;var F=Sle(this.props);if(!F)return null;var G=F.x,K=F.y,ee=this.props,H=ee.shape,Z=ee.className,ae=Wh(this.props,"hidden")?"url(#".concat(M,")"):void 0,fe=CB(CB({clipPath:ae},Vn(this.props,!0)),{},{cx:G,cy:K});return ht.createElement(to,{className:ci("recharts-reference-dot",Z)},r.renderDot(H,fe),es.renderCallByParent(this.props,{x:G-T,y:K-T,width:2*T,height:2*T}))}}])})(ht.Component);Zb(Xb,"displayName","ReferenceDot");Zb(Xb,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});Zb(Xb,"renderDot",function(t,r){var s;return ht.isValidElement(t)?s=ht.cloneElement(t,r):Zn(t)?s=t(r):s=ht.createElement(SI,X2({},r,{cx:r.cx,cy:r.cy,className:"recharts-reference-dot-dot"})),s});function Y2(){return Y2=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},Y2.apply(this,arguments)}function u_(t){"@babel/helpers - typeof";return u_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},u_(t)}function MB(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function OB(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?MB(Object(s),!0).forEach(function(c){Kb(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):MB(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function Tle(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Ele(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,kU(c.key),c)}}function Ale(t,r,s){return r&&Ele(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Ple(t,r,s){return r=tb(r),Ile(t,DU()?Reflect.construct(r,s||[],tb(t).constructor):r.apply(t,s))}function Ile(t,r){if(r&&(u_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Cle(t)}function Cle(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function DU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(DU=function(){return!!t})()}function tb(t){return tb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},tb(t)}function Mle(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&J2(t,r)}function J2(t,r){return J2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},J2(t,r)}function Kb(t,r,s){return r=kU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function kU(t){var r=Ole(t,"string");return u_(r)=="symbol"?r:r+""}function Ole(t,r){if(u_(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(u_(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Rle=function(r,s,c,m,v){var T=v.x1,o=v.x2,M=v.y1,R=v.y2,B=v.xAxis,F=v.yAxis;if(!B||!F)return null;var G=TI({x:B.scale,y:F.scale}),K={x:r?G.x.apply(T,{position:"start"}):G.x.rangeMin,y:c?G.y.apply(M,{position:"start"}):G.y.rangeMin},ee={x:s?G.x.apply(o,{position:"end"}):G.x.rangeMax,y:m?G.y.apply(R,{position:"end"}):G.y.rangeMax};return Wh(v,"discard")&&(!G.isInRange(K)||!G.isInRange(ee))?null:xU(K,ee)},Yb=(function(t){function r(){return Tle(this,r),Ple(this,r,arguments)}return Mle(r,t),Ale(r,[{key:"render",value:function(){var c=this.props,m=c.x1,v=c.x2,T=c.y1,o=c.y2,M=c.className,R=c.alwaysShow,B=c.clipPathId;Wu(R===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var F=za(m),G=za(v),K=za(T),ee=za(o),H=this.props.shape;if(!F&&!G&&!K&&!ee&&!H)return null;var Z=Rle(F,G,K,ee,this.props);if(!Z&&!H)return null;var ae=Wh(this.props,"hidden")?"url(#".concat(B,")"):void 0;return ht.createElement(to,{className:ci("recharts-reference-area",M)},r.renderRect(H,OB(OB({clipPath:ae},Vn(this.props,!0)),Z)),es.renderCallByParent(this.props,Z))}}])})(ht.Component);Kb(Yb,"displayName","ReferenceArea");Kb(Yb,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});Kb(Yb,"renderRect",function(t,r){var s;return ht.isValidElement(t)?s=ht.cloneElement(t,r):Zn(t)?s=t(r):s=ht.createElement(wI,Y2({},r,{className:"recharts-reference-area-rect"})),s});function LU(t,r,s){if(r<1)return[];if(r===1&&s===void 0)return t;for(var c=[],m=0;m<t.length;m+=r)c.push(t[m]);return c}function Dle(t,r,s){var c={width:t.width+r.width,height:t.height+r.height};return Bse(c,s)}function kle(t,r,s){var c=s==="width",m=t.x,v=t.y,T=t.width,o=t.height;return r===1?{start:c?m:v,end:c?m+T:v+o}:{start:c?m+T:v+o,end:c?m:v}}function rb(t,r,s,c,m){if(t*r<t*c||t*r>t*m)return!1;var v=s();return t*(r-t*v/2-c)>=0&&t*(r+t*v/2-m)<=0}function Lle(t,r){return LU(t,r+1)}function zle(t,r,s,c,m){for(var v=(c||[]).slice(),T=r.start,o=r.end,M=0,R=1,B=T,F=function(){var ee=c?.[M];if(ee===void 0)return{v:LU(c,R)};var H=M,Z,ae=function(){return Z===void 0&&(Z=s(ee,H)),Z},fe=ee.coordinate,ue=M===0||rb(t,fe,ae,B,o);ue||(M=0,B=T,R+=1),ue&&(B=fe+t*(ae()/2+m),M+=R)},G;R<=v.length;)if(G=F(),G)return G.v;return[]}function bv(t){"@babel/helpers - typeof";return bv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},bv(t)}function RB(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function Is(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?RB(Object(s),!0).forEach(function(c){Fle(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):RB(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function Fle(t,r,s){return r=Ble(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Ble(t){var r=Nle(t,"string");return bv(r)=="symbol"?r:r+""}function Nle(t,r){if(bv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(bv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function jle(t,r,s,c,m){for(var v=(c||[]).slice(),T=v.length,o=r.start,M=r.end,R=function(G){var K=v[G],ee,H=function(){return ee===void 0&&(ee=s(K,G)),ee};if(G===T-1){var Z=t*(K.coordinate+t*H()/2-M);v[G]=K=Is(Is({},K),{},{tickCoord:Z>0?K.coordinate-Z*t:K.coordinate})}else v[G]=K=Is(Is({},K),{},{tickCoord:K.coordinate});var ae=rb(t,K.tickCoord,H,o,M);ae&&(M=K.tickCoord-t*(H()/2+m),v[G]=Is(Is({},K),{},{isShow:!0}))},B=T-1;B>=0;B--)R(B);return v}function Ule(t,r,s,c,m,v){var T=(c||[]).slice(),o=T.length,M=r.start,R=r.end;if(v){var B=c[o-1],F=s(B,o-1),G=t*(B.coordinate+t*F/2-R);T[o-1]=B=Is(Is({},B),{},{tickCoord:G>0?B.coordinate-G*t:B.coordinate});var K=rb(t,B.tickCoord,function(){return F},M,R);K&&(R=B.tickCoord-t*(F/2+m),T[o-1]=Is(Is({},B),{},{isShow:!0}))}for(var ee=v?o-1:o,H=function(fe){var ue=T[fe],_e,le=function(){return _e===void 0&&(_e=s(ue,fe)),_e};if(fe===0){var pe=t*(ue.coordinate-t*le()/2-M);T[fe]=ue=Is(Is({},ue),{},{tickCoord:pe<0?ue.coordinate-pe*t:ue.coordinate})}else T[fe]=ue=Is(Is({},ue),{},{tickCoord:ue.coordinate});var Te=rb(t,ue.tickCoord,le,M,R);Te&&(M=ue.tickCoord+t*(le()/2+m),T[fe]=Is(Is({},ue),{},{isShow:!0}))},Z=0;Z<ee;Z++)H(Z);return T}function OI(t,r,s){var c=t.tick,m=t.ticks,v=t.viewBox,T=t.minTickGap,o=t.orientation,M=t.interval,R=t.tickFormatter,B=t.unit,F=t.angle;if(!m||!m.length||!c)return[];if(kr(M)||S_.isSsr)return Lle(m,typeof M=="number"&&kr(M)?M:0);var G=[],K=o==="top"||o==="bottom"?"width":"height",ee=B&&K==="width"?Ry(B,{fontSize:r,letterSpacing:s}):{width:0,height:0},H=function(ue,_e){var le=Zn(R)?R(ue.value,_e):ue.value;return K==="width"?Dle(Ry(le,{fontSize:r,letterSpacing:s}),ee,F):Ry(le,{fontSize:r,letterSpacing:s})[K]},Z=m.length>=2?Ks(m[1].coordinate-m[0].coordinate):1,ae=kle(v,Z,K);return M==="equidistantPreserveStart"?zle(Z,ae,H,m,T):(M==="preserveStart"||M==="preserveStartEnd"?G=Ule(Z,ae,H,m,T,M==="preserveStartEnd"):G=jle(Z,ae,H,m,T),G.filter(function(fe){return fe.isShow}))}var Vle=["viewBox"],$le=["viewBox"],qle=["ticks"];function h_(t){"@babel/helpers - typeof";return h_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},h_(t)}function zg(){return zg=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},zg.apply(this,arguments)}function DB(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function ka(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?DB(Object(s),!0).forEach(function(c){RI(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):DB(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function AA(t,r){if(t==null)return{};var s=Gle(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function Gle(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}function Hle(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function kB(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,FU(c.key),c)}}function Wle(t,r,s){return r&&kB(t.prototype,r),s&&kB(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t}function Zle(t,r,s){return r=nb(r),Xle(t,zU()?Reflect.construct(r,s||[],nb(t).constructor):r.apply(t,s))}function Xle(t,r){if(r&&(h_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Kle(t)}function Kle(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function zU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(zU=function(){return!!t})()}function nb(t){return nb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},nb(t)}function Yle(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&Q2(t,r)}function Q2(t,r){return Q2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},Q2(t,r)}function RI(t,r,s){return r=FU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function FU(t){var r=Jle(t,"string");return h_(r)=="symbol"?r:r+""}function Jle(t,r){if(h_(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(h_(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var P_=(function(t){function r(s){var c;return Hle(this,r),c=Zle(this,r,[s]),c.state={fontSize:"",letterSpacing:""},c}return Yle(r,t),Wle(r,[{key:"shouldComponentUpdate",value:function(c,m){var v=c.viewBox,T=AA(c,Vle),o=this.props,M=o.viewBox,R=AA(o,$le);return!jg(v,M)||!jg(T,R)||!jg(m,this.state)}},{key:"componentDidMount",value:function(){var c=this.layerReference;if(c){var m=c.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];m&&this.setState({fontSize:window.getComputedStyle(m).fontSize,letterSpacing:window.getComputedStyle(m).letterSpacing})}}},{key:"getTickLineCoord",value:function(c){var m=this.props,v=m.x,T=m.y,o=m.width,M=m.height,R=m.orientation,B=m.tickSize,F=m.mirror,G=m.tickMargin,K,ee,H,Z,ae,fe,ue=F?-1:1,_e=c.tickSize||B,le=kr(c.tickCoord)?c.tickCoord:c.coordinate;switch(R){case"top":K=ee=c.coordinate,Z=T+ +!F*M,H=Z-ue*_e,fe=H-ue*G,ae=le;break;case"left":H=Z=c.coordinate,ee=v+ +!F*o,K=ee-ue*_e,ae=K-ue*G,fe=le;break;case"right":H=Z=c.coordinate,ee=v+ +F*o,K=ee+ue*_e,ae=K+ue*G,fe=le;break;default:K=ee=c.coordinate,Z=T+ +F*M,H=Z+ue*_e,fe=H+ue*G,ae=le;break}return{line:{x1:K,y1:H,x2:ee,y2:Z},tick:{x:ae,y:fe}}}},{key:"getTickTextAnchor",value:function(){var c=this.props,m=c.orientation,v=c.mirror,T;switch(m){case"left":T=v?"start":"end";break;case"right":T=v?"end":"start";break;default:T="middle";break}return T}},{key:"getTickVerticalAnchor",value:function(){var c=this.props,m=c.orientation,v=c.mirror,T="end";switch(m){case"left":case"right":T="middle";break;case"top":T=v?"start":"end";break;default:T=v?"end":"start";break}return T}},{key:"renderAxisLine",value:function(){var c=this.props,m=c.x,v=c.y,T=c.width,o=c.height,M=c.orientation,R=c.mirror,B=c.axisLine,F=ka(ka(ka({},Vn(this.props,!1)),Vn(B,!1)),{},{fill:"none"});if(M==="top"||M==="bottom"){var G=+(M==="top"&&!R||M==="bottom"&&R);F=ka(ka({},F),{},{x1:m,y1:v+G*o,x2:m+T,y2:v+G*o})}else{var K=+(M==="left"&&!R||M==="right"&&R);F=ka(ka({},F),{},{x1:m+K*T,y1:v,x2:m+K*T,y2:v+o})}return ht.createElement("line",zg({},F,{className:ci("recharts-cartesian-axis-line",nc(B,"className"))}))}},{key:"renderTicks",value:function(c,m,v){var T=this,o=this.props,M=o.tickLine,R=o.stroke,B=o.tick,F=o.tickFormatter,G=o.unit,K=OI(ka(ka({},this.props),{},{ticks:c}),m,v),ee=this.getTickTextAnchor(),H=this.getTickVerticalAnchor(),Z=Vn(this.props,!1),ae=Vn(B,!1),fe=ka(ka({},Z),{},{fill:"none"},Vn(M,!1)),ue=K.map(function(_e,le){var pe=T.getTickLineCoord(_e),Te=pe.line,De=pe.tick,Xe=ka(ka(ka(ka({textAnchor:ee,verticalAnchor:H},Z),{},{stroke:"none",fill:R},ae),De),{},{index:le,payload:_e,visibleTicksCount:K.length,tickFormatter:F});return ht.createElement(to,zg({className:"recharts-cartesian-axis-tick",key:"tick-".concat(_e.value,"-").concat(_e.coordinate,"-").concat(_e.tickCoord)},km(T.props,_e,le)),M&&ht.createElement("line",zg({},fe,Te,{className:ci("recharts-cartesian-axis-tick-line",nc(M,"className"))})),B&&r.renderTickItem(B,Xe,"".concat(Zn(F)?F(_e.value,le):_e.value).concat(G||"")))});return ht.createElement("g",{className:"recharts-cartesian-axis-ticks"},ue)}},{key:"render",value:function(){var c=this,m=this.props,v=m.axisLine,T=m.width,o=m.height,M=m.ticksGenerator,R=m.className,B=m.hide;if(B)return null;var F=this.props,G=F.ticks,K=AA(F,qle),ee=G;return Zn(M)&&(ee=G&&G.length>0?M(this.props):M(K)),T<=0||o<=0||!ee||!ee.length?null:ht.createElement(to,{className:ci("recharts-cartesian-axis",R),ref:function(Z){c.layerReference=Z}},v&&this.renderAxisLine(),this.renderTicks(ee,this.state.fontSize,this.state.letterSpacing),es.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(c,m,v){var T,o=ci(m.className,"recharts-cartesian-axis-tick-value");return ht.isValidElement(c)?T=ht.cloneElement(c,ka(ka({},m),{},{className:o})):Zn(c)?T=c(ka(ka({},m),{},{className:o})):T=ht.createElement(Lm,zg({},m,{className:"recharts-cartesian-axis-tick-value"}),v),T}}])})(Le.Component);RI(P_,"displayName","CartesianAxis");RI(P_,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var Qle=["x1","y1","x2","y2","key"],ece=["offset"];function Bm(t){"@babel/helpers - typeof";return Bm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Bm(t)}function LB(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function Cs(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?LB(Object(s),!0).forEach(function(c){tce(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):LB(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function tce(t,r,s){return r=rce(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function rce(t){var r=nce(t,"string");return Bm(r)=="symbol"?r:r+""}function nce(t,r){if(Bm(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(Bm(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Cm(){return Cm=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},Cm.apply(this,arguments)}function zB(t,r){if(t==null)return{};var s=ice(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function ice(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}var oce=function(r){var s=r.fill;if(!s||s==="none")return null;var c=r.fillOpacity,m=r.x,v=r.y,T=r.width,o=r.height,M=r.ry;return ht.createElement("rect",{x:m,y:v,ry:M,width:T,height:o,stroke:"none",fill:s,fillOpacity:c,className:"recharts-cartesian-grid-bg"})};function BU(t,r){var s;if(ht.isValidElement(t))s=ht.cloneElement(t,r);else if(Zn(t))s=t(r);else{var c=r.x1,m=r.y1,v=r.x2,T=r.y2,o=r.key,M=zB(r,Qle),R=Vn(M,!1);R.offset;var B=zB(R,ece);s=ht.createElement("line",Cm({},B,{x1:c,y1:m,x2:v,y2:T,fill:"none",key:o}))}return s}function ace(t){var r=t.x,s=t.width,c=t.horizontal,m=c===void 0?!0:c,v=t.horizontalPoints;if(!m||!v||!v.length)return null;var T=v.map(function(o,M){var R=Cs(Cs({},t),{},{x1:r,y1:o,x2:r+s,y2:o,key:"line-".concat(M),index:M});return BU(m,R)});return ht.createElement("g",{className:"recharts-cartesian-grid-horizontal"},T)}function sce(t){var r=t.y,s=t.height,c=t.vertical,m=c===void 0?!0:c,v=t.verticalPoints;if(!m||!v||!v.length)return null;var T=v.map(function(o,M){var R=Cs(Cs({},t),{},{x1:o,y1:r,x2:o,y2:r+s,key:"line-".concat(M),index:M});return BU(m,R)});return ht.createElement("g",{className:"recharts-cartesian-grid-vertical"},T)}function lce(t){var r=t.horizontalFill,s=t.fillOpacity,c=t.x,m=t.y,v=t.width,T=t.height,o=t.horizontalPoints,M=t.horizontal,R=M===void 0?!0:M;if(!R||!r||!r.length)return null;var B=o.map(function(G){return Math.round(G+m-m)}).sort(function(G,K){return G-K});m!==B[0]&&B.unshift(0);var F=B.map(function(G,K){var ee=!B[K+1],H=ee?m+T-G:B[K+1]-G;if(H<=0)return null;var Z=K%r.length;return ht.createElement("rect",{key:"react-".concat(K),y:G,x:c,height:H,width:v,stroke:"none",fill:r[Z],fillOpacity:s,className:"recharts-cartesian-grid-bg"})});return ht.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},F)}function cce(t){var r=t.vertical,s=r===void 0?!0:r,c=t.verticalFill,m=t.fillOpacity,v=t.x,T=t.y,o=t.width,M=t.height,R=t.verticalPoints;if(!s||!c||!c.length)return null;var B=R.map(function(G){return Math.round(G+v-v)}).sort(function(G,K){return G-K});v!==B[0]&&B.unshift(0);var F=B.map(function(G,K){var ee=!B[K+1],H=ee?v+o-G:B[K+1]-G;if(H<=0)return null;var Z=K%c.length;return ht.createElement("rect",{key:"react-".concat(K),x:G,y:T,width:H,height:M,stroke:"none",fill:c[Z],fillOpacity:m,className:"recharts-cartesian-grid-bg"})});return ht.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},F)}var uce=function(r,s){var c=r.xAxis,m=r.width,v=r.height,T=r.offset;return N4(OI(Cs(Cs(Cs({},P_.defaultProps),c),{},{ticks:ed(c,!0),viewBox:{x:0,y:0,width:m,height:v}})),T.left,T.left+T.width,s)},hce=function(r,s){var c=r.yAxis,m=r.width,v=r.height,T=r.offset;return N4(OI(Cs(Cs(Cs({},P_.defaultProps),c),{},{ticks:ed(c,!0),viewBox:{x:0,y:0,width:m,height:v}})),T.top,T.top+T.height,s)},Rg={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function NU(t){var r,s,c,m,v,T,o=PI(),M=II(),R=Jse(),B=Cs(Cs({},t),{},{stroke:(r=t.stroke)!==null&&r!==void 0?r:Rg.stroke,fill:(s=t.fill)!==null&&s!==void 0?s:Rg.fill,horizontal:(c=t.horizontal)!==null&&c!==void 0?c:Rg.horizontal,horizontalFill:(m=t.horizontalFill)!==null&&m!==void 0?m:Rg.horizontalFill,vertical:(v=t.vertical)!==null&&v!==void 0?v:Rg.vertical,verticalFill:(T=t.verticalFill)!==null&&T!==void 0?T:Rg.verticalFill,x:kr(t.x)?t.x:R.left,y:kr(t.y)?t.y:R.top,width:kr(t.width)?t.width:R.width,height:kr(t.height)?t.height:R.height}),F=B.x,G=B.y,K=B.width,ee=B.height,H=B.syncWithTicks,Z=B.horizontalValues,ae=B.verticalValues,fe=Xse(),ue=Kse();if(!kr(K)||K<=0||!kr(ee)||ee<=0||!kr(F)||F!==+F||!kr(G)||G!==+G)return null;var _e=B.verticalCoordinatesGenerator||uce,le=B.horizontalCoordinatesGenerator||hce,pe=B.horizontalPoints,Te=B.verticalPoints;if((!pe||!pe.length)&&Zn(le)){var De=Z&&Z.length,Xe=le({yAxis:ue?Cs(Cs({},ue),{},{ticks:De?Z:ue.ticks}):void 0,width:o,height:M,offset:R},De?!0:H);Wu(Array.isArray(Xe),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Bm(Xe),"]")),Array.isArray(Xe)&&(pe=Xe)}if((!Te||!Te.length)&&Zn(_e)){var wt=ae&&ae.length,$e=_e({xAxis:fe?Cs(Cs({},fe),{},{ticks:wt?ae:fe.ticks}):void 0,width:o,height:M,offset:R},wt?!0:H);Wu(Array.isArray($e),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Bm($e),"]")),Array.isArray($e)&&(Te=$e)}return ht.createElement("g",{className:"recharts-cartesian-grid"},ht.createElement(oce,{fill:B.fill,fillOpacity:B.fillOpacity,x:B.x,y:B.y,width:B.width,height:B.height,ry:B.ry}),ht.createElement(ace,Cm({},B,{offset:R,horizontalPoints:pe,xAxis:fe,yAxis:ue})),ht.createElement(sce,Cm({},B,{offset:R,verticalPoints:Te,xAxis:fe,yAxis:ue})),ht.createElement(lce,Cm({},B,{horizontalPoints:pe})),ht.createElement(cce,Cm({},B,{verticalPoints:Te})))}NU.displayName="CartesianGrid";function f_(t){"@babel/helpers - typeof";return f_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},f_(t)}function fce(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function dce(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,VU(c.key),c)}}function pce(t,r,s){return r&&dce(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function mce(t,r,s){return r=ib(r),gce(t,jU()?Reflect.construct(r,s||[],ib(t).constructor):r.apply(t,s))}function gce(t,r){if(r&&(f_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _ce(t)}function _ce(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function jU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(jU=function(){return!!t})()}function ib(t){return ib=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},ib(t)}function yce(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&eP(t,r)}function eP(t,r){return eP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},eP(t,r)}function UU(t,r,s){return r=VU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function VU(t){var r=vce(t,"string");return f_(r)=="symbol"?r:r+""}function vce(t,r){if(f_(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(f_(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function tP(){return tP=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},tP.apply(this,arguments)}function xce(t){var r=t.xAxisId,s=PI(),c=II(),m=PU(r);return m==null?null:Le.createElement(P_,tP({},m,{className:ci("recharts-".concat(m.axisType," ").concat(m.axisType),m.className),viewBox:{x:0,y:0,width:s,height:c},ticksGenerator:function(T){return ed(T,!0)}}))}var Jb=(function(t){function r(){return fce(this,r),mce(this,r,arguments)}return yce(r,t),pce(r,[{key:"render",value:function(){return Le.createElement(xce,this.props)}}])})(Le.Component);UU(Jb,"displayName","XAxis");UU(Jb,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function d_(t){"@babel/helpers - typeof";return d_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},d_(t)}function bce(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function wce(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,GU(c.key),c)}}function Sce(t,r,s){return r&&wce(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Tce(t,r,s){return r=ob(r),Ece(t,$U()?Reflect.construct(r,s||[],ob(t).constructor):r.apply(t,s))}function Ece(t,r){if(r&&(d_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Ace(t)}function Ace(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function $U(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return($U=function(){return!!t})()}function ob(t){return ob=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},ob(t)}function Pce(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&rP(t,r)}function rP(t,r){return rP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},rP(t,r)}function qU(t,r,s){return r=GU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function GU(t){var r=Ice(t,"string");return d_(r)=="symbol"?r:r+""}function Ice(t,r){if(d_(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(d_(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function nP(){return nP=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},nP.apply(this,arguments)}var Cce=function(r){var s=r.yAxisId,c=PI(),m=II(),v=IU(s);return v==null?null:Le.createElement(P_,nP({},v,{className:ci("recharts-".concat(v.axisType," ").concat(v.axisType),v.className),viewBox:{x:0,y:0,width:c,height:m},ticksGenerator:function(o){return ed(o,!0)}}))},Qb=(function(t){function r(){return bce(this,r),Tce(this,r,arguments)}return Pce(r,t),Sce(r,[{key:"render",value:function(){return Le.createElement(Cce,this.props)}}])})(Le.Component);qU(Qb,"displayName","YAxis");qU(Qb,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function FB(t){return Dce(t)||Rce(t)||Oce(t)||Mce()}function Mce(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Oce(t,r){if(t){if(typeof t=="string")return iP(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return iP(t,r)}}function Rce(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Dce(t){if(Array.isArray(t))return iP(t)}function iP(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}var oP=function(r,s,c,m,v){var T=Xc(r,MI),o=Xc(r,Xb),M=[].concat(FB(T),FB(o)),R=Xc(r,Yb),B="".concat(m,"Id"),F=m[0],G=s;if(M.length&&(G=M.reduce(function(H,Z){if(Z.props[B]===c&&Wh(Z.props,"extendDomain")&&kr(Z.props[F])){var ae=Z.props[F];return[Math.min(H[0],ae),Math.max(H[1],ae)]}return H},G)),R.length){var K="".concat(F,"1"),ee="".concat(F,"2");G=R.reduce(function(H,Z){if(Z.props[B]===c&&Wh(Z.props,"extendDomain")&&kr(Z.props[K])&&kr(Z.props[ee])){var ae=Z.props[K],fe=Z.props[ee];return[Math.min(H[0],ae,fe),Math.max(H[1],ae,fe)]}return H},G)}return v&&v.length&&(G=v.reduce(function(H,Z){return kr(Z)?[Math.min(H[0],Z),Math.max(H[1],Z)]:H},G)),G},PA={exports:{}},BB;function kce(){return BB||(BB=1,(function(t){var r=Object.prototype.hasOwnProperty,s="~";function c(){}Object.create&&(c.prototype=Object.create(null),new c().__proto__||(s=!1));function m(M,R,B){this.fn=M,this.context=R,this.once=B||!1}function v(M,R,B,F,G){if(typeof B!="function")throw new TypeError("The listener must be a function");var K=new m(B,F||M,G),ee=s?s+R:R;return M._events[ee]?M._events[ee].fn?M._events[ee]=[M._events[ee],K]:M._events[ee].push(K):(M._events[ee]=K,M._eventsCount++),M}function T(M,R){--M._eventsCount===0?M._events=new c:delete M._events[R]}function o(){this._events=new c,this._eventsCount=0}o.prototype.eventNames=function(){var R=[],B,F;if(this._eventsCount===0)return R;for(F in B=this._events)r.call(B,F)&&R.push(s?F.slice(1):F);return Object.getOwnPropertySymbols?R.concat(Object.getOwnPropertySymbols(B)):R},o.prototype.listeners=function(R){var B=s?s+R:R,F=this._events[B];if(!F)return[];if(F.fn)return[F.fn];for(var G=0,K=F.length,ee=new Array(K);G<K;G++)ee[G]=F[G].fn;return ee},o.prototype.listenerCount=function(R){var B=s?s+R:R,F=this._events[B];return F?F.fn?1:F.length:0},o.prototype.emit=function(R,B,F,G,K,ee){var H=s?s+R:R;if(!this._events[H])return!1;var Z=this._events[H],ae=arguments.length,fe,ue;if(Z.fn){switch(Z.once&&this.removeListener(R,Z.fn,void 0,!0),ae){case 1:return Z.fn.call(Z.context),!0;case 2:return Z.fn.call(Z.context,B),!0;case 3:return Z.fn.call(Z.context,B,F),!0;case 4:return Z.fn.call(Z.context,B,F,G),!0;case 5:return Z.fn.call(Z.context,B,F,G,K),!0;case 6:return Z.fn.call(Z.context,B,F,G,K,ee),!0}for(ue=1,fe=new Array(ae-1);ue<ae;ue++)fe[ue-1]=arguments[ue];Z.fn.apply(Z.context,fe)}else{var _e=Z.length,le;for(ue=0;ue<_e;ue++)switch(Z[ue].once&&this.removeListener(R,Z[ue].fn,void 0,!0),ae){case 1:Z[ue].fn.call(Z[ue].context);break;case 2:Z[ue].fn.call(Z[ue].context,B);break;case 3:Z[ue].fn.call(Z[ue].context,B,F);break;case 4:Z[ue].fn.call(Z[ue].context,B,F,G);break;default:if(!fe)for(le=1,fe=new Array(ae-1);le<ae;le++)fe[le-1]=arguments[le];Z[ue].fn.apply(Z[ue].context,fe)}}return!0},o.prototype.on=function(R,B,F){return v(this,R,B,F,!1)},o.prototype.once=function(R,B,F){return v(this,R,B,F,!0)},o.prototype.removeListener=function(R,B,F,G){var K=s?s+R:R;if(!this._events[K])return this;if(!B)return T(this,K),this;var ee=this._events[K];if(ee.fn)ee.fn===B&&(!G||ee.once)&&(!F||ee.context===F)&&T(this,K);else{for(var H=0,Z=[],ae=ee.length;H<ae;H++)(ee[H].fn!==B||G&&!ee[H].once||F&&ee[H].context!==F)&&Z.push(ee[H]);Z.length?this._events[K]=Z.length===1?Z[0]:Z:T(this,K)}return this},o.prototype.removeAllListeners=function(R){var B;return R?(B=s?s+R:R,this._events[B]&&T(this,B)):(this._events=new c,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=s,o.EventEmitter=o,t.exports=o})(PA)),PA.exports}var Lce=kce();const zce=Wi(Lce);var IA=new zce,CA="recharts.syncMouseEvents";function wv(t){"@babel/helpers - typeof";return wv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},wv(t)}function Fce(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function Bce(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,HU(c.key),c)}}function Nce(t,r,s){return r&&Bce(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function MA(t,r,s){return r=HU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function HU(t){var r=jce(t,"string");return wv(r)=="symbol"?r:r+""}function jce(t,r){if(wv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(wv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}var Uce=(function(){function t(){Fce(this,t),MA(this,"activeIndex",0),MA(this,"coordinateList",[]),MA(this,"layout","horizontal")}return Nce(t,[{key:"setDetails",value:function(s){var c,m=s.coordinateList,v=m===void 0?null:m,T=s.container,o=T===void 0?null:T,M=s.layout,R=M===void 0?null:M,B=s.offset,F=B===void 0?null:B,G=s.mouseHandlerCallback,K=G===void 0?null:G;this.coordinateList=(c=v??this.coordinateList)!==null&&c!==void 0?c:[],this.container=o??this.container,this.layout=R??this.layout,this.offset=F??this.offset,this.mouseHandlerCallback=K??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(s){if(this.coordinateList.length!==0)switch(s.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(s){this.activeIndex=s}},{key:"spoofMouse",value:function(){var s,c;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var m=this.container.getBoundingClientRect(),v=m.x,T=m.y,o=m.height,M=this.coordinateList[this.activeIndex].coordinate,R=((s=window)===null||s===void 0?void 0:s.scrollX)||0,B=((c=window)===null||c===void 0?void 0:c.scrollY)||0,F=v+M+R,G=T+this.offset.top+o/2+B;this.mouseHandlerCallback({pageX:F,pageY:G})}}}])})();function Vce(t,r,s){if(s==="number"&&r===!0&&Array.isArray(t)){var c=t?.[0],m=t?.[1];if(c&&m&&kr(c)&&kr(m))return!0}return!1}function $ce(t,r,s,c){var m=c/2;return{stroke:"none",fill:"#ccc",x:t==="horizontal"?r.x-m:s.left+.5,y:t==="horizontal"?s.top+.5:r.y-m,width:t==="horizontal"?c:s.width-1,height:t==="horizontal"?s.height-1:c}}function WU(t){var r=t.cx,s=t.cy,c=t.radius,m=t.startAngle,v=t.endAngle,T=vo(r,s,c,m),o=vo(r,s,c,v);return{points:[T,o],cx:r,cy:s,radius:c,startAngle:m,endAngle:v}}function qce(t,r,s){var c,m,v,T;if(t==="horizontal")c=r.x,v=c,m=s.top,T=s.top+s.height;else if(t==="vertical")m=r.y,T=m,c=s.left,v=s.left+s.width;else if(r.cx!=null&&r.cy!=null)if(t==="centric"){var o=r.cx,M=r.cy,R=r.innerRadius,B=r.outerRadius,F=r.angle,G=vo(o,M,R,F),K=vo(o,M,B,F);c=G.x,m=G.y,v=K.x,T=K.y}else return WU(r);return[{x:c,y:m},{x:v,y:T}]}function Sv(t){"@babel/helpers - typeof";return Sv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Sv(t)}function NB(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function Qx(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?NB(Object(s),!0).forEach(function(c){Gce(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):NB(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function Gce(t,r,s){return r=Hce(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function Hce(t){var r=Wce(t,"string");return Sv(r)=="symbol"?r:r+""}function Wce(t,r){if(Sv(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(Sv(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}function Zce(t){var r,s,c=t.element,m=t.tooltipEventType,v=t.isActive,T=t.activeCoordinate,o=t.activePayload,M=t.offset,R=t.activeTooltipIndex,B=t.tooltipAxisBandSize,F=t.layout,G=t.chartName,K=(r=c.props.cursor)!==null&&r!==void 0?r:(s=c.type.defaultProps)===null||s===void 0?void 0:s.cursor;if(!c||!K||!v||!T||G!=="ScatterChart"&&m!=="axis")return null;var ee,H=I2;if(G==="ScatterChart")ee=T,H=Coe;else if(G==="BarChart")ee=$ce(F,T,M,B),H=wI;else if(F==="radial"){var Z=WU(T),ae=Z.cx,fe=Z.cy,ue=Z.radius,_e=Z.startAngle,le=Z.endAngle;ee={cx:ae,cy:fe,startAngle:_e,endAngle:le,innerRadius:ue,outerRadius:ue},H=K4}else ee={points:qce(F,T,M)},H=I2;var pe=Qx(Qx(Qx(Qx({stroke:"#ccc",pointerEvents:"none"},M),ee),Vn(K,!1)),{},{payload:o,payloadIndex:R,className:ci("recharts-tooltip-cursor",K.className)});return Le.isValidElement(K)?Le.cloneElement(K,pe):Le.createElement(H,pe)}var Xce=["item"],Kce=["children","className","width","height","style","compact","title","desc"];function p_(t){"@babel/helpers - typeof";return p_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},p_(t)}function Fg(){return Fg=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var c in s)Object.prototype.hasOwnProperty.call(s,c)&&(t[c]=s[c])}return t},Fg.apply(this,arguments)}function jB(t,r){return Qce(t)||Jce(t,r)||XU(t,r)||Yce()}function Yce(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Jce(t,r){var s=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(s!=null){var c,m,v,T,o=[],M=!0,R=!1;try{if(v=(s=s.call(t)).next,r!==0)for(;!(M=(c=v.call(s)).done)&&(o.push(c.value),o.length!==r);M=!0);}catch(B){R=!0,m=B}finally{try{if(!M&&s.return!=null&&(T=s.return(),Object(T)!==T))return}finally{if(R)throw m}}return o}}function Qce(t){if(Array.isArray(t))return t}function UB(t,r){if(t==null)return{};var s=eue(t,r),c,m;if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(t);for(m=0;m<v.length;m++)c=v[m],!(r.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(t,c)&&(s[c]=t[c])}return s}function eue(t,r){if(t==null)return{};var s={};for(var c in t)if(Object.prototype.hasOwnProperty.call(t,c)){if(r.indexOf(c)>=0)continue;s[c]=t[c]}return s}function tue(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function rue(t,r){for(var s=0;s<r.length;s++){var c=r[s];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,KU(c.key),c)}}function nue(t,r,s){return r&&rue(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function iue(t,r,s){return r=ab(r),oue(t,ZU()?Reflect.construct(r,s||[],ab(t).constructor):r.apply(t,s))}function oue(t,r){if(r&&(p_(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return aue(t)}function aue(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ZU(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ZU=function(){return!!t})()}function ab(t){return ab=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},ab(t)}function sue(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),r&&aP(t,r)}function aP(t,r){return aP=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,m){return c.__proto__=m,c},aP(t,r)}function m_(t){return uue(t)||cue(t)||XU(t)||lue()}function lue(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XU(t,r){if(t){if(typeof t=="string")return sP(t,r);var s=Object.prototype.toString.call(t).slice(8,-1);if(s==="Object"&&t.constructor&&(s=t.constructor.name),s==="Map"||s==="Set")return Array.from(t);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return sP(t,r)}}function cue(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function uue(t){if(Array.isArray(t))return sP(t)}function sP(t,r){(r==null||r>t.length)&&(r=t.length);for(var s=0,c=new Array(r);s<r;s++)c[s]=t[s];return c}function VB(t,r){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);r&&(c=c.filter(function(m){return Object.getOwnPropertyDescriptor(t,m).enumerable})),s.push.apply(s,c)}return s}function rr(t){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?VB(Object(s),!0).forEach(function(c){Bn(t,c,s[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):VB(Object(s)).forEach(function(c){Object.defineProperty(t,c,Object.getOwnPropertyDescriptor(s,c))})}return t}function Bn(t,r,s){return r=KU(r),r in t?Object.defineProperty(t,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[r]=s,t}function KU(t){var r=hue(t,"string");return p_(r)=="symbol"?r:r+""}function hue(t,r){if(p_(t)!="object"||!t)return t;var s=t[Symbol.toPrimitive];if(s!==void 0){var c=s.call(t,r);if(p_(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}var fue={xAxis:["bottom","top"],yAxis:["left","right"]},due={width:"100%",height:"100%"},YU={x:0,y:0};function e0(t){return t}var pue=function(r,s){return s==="horizontal"?r.x:s==="vertical"?r.y:s==="centric"?r.angle:r.radius},mue=function(r,s,c,m){var v=s.find(function(B){return B&&B.index===c});if(v){if(r==="horizontal")return{x:v.coordinate,y:m.y};if(r==="vertical")return{x:m.x,y:v.coordinate};if(r==="centric"){var T=v.coordinate,o=m.radius;return rr(rr(rr({},m),vo(m.cx,m.cy,o,T)),{},{angle:T,radius:o})}var M=v.coordinate,R=m.angle;return rr(rr(rr({},m),vo(m.cx,m.cy,M,R)),{},{angle:R,radius:M})}return YU},e1=function(r,s){var c=s.graphicalItems,m=s.dataStartIndex,v=s.dataEndIndex,T=(c??[]).reduce(function(o,M){var R=M.props.data;return R&&R.length?[].concat(m_(o),m_(R)):o},[]);return T.length>0?T:r&&r.length&&kr(m)&&kr(v)?r.slice(m,v+1):[]};function JU(t){return t==="number"?[0,"auto"]:void 0}var lP=function(r,s,c,m){var v=r.graphicalItems,T=r.tooltipAxis,o=e1(s,r);return c<0||!v||!v.length||c>=o.length?null:v.reduce(function(M,R){var B,F=(B=R.props.data)!==null&&B!==void 0?B:s;F&&r.dataStartIndex+r.dataEndIndex!==0&&r.dataEndIndex-r.dataStartIndex>=c&&(F=F.slice(r.dataStartIndex,r.dataEndIndex+1));var G;if(T.dataKey&&!T.allowDuplicatedCategory){var K=F===void 0?o:F;G=$A(K,T.dataKey,m)}else G=F&&F[c]||o[c];return G?[].concat(m_(M),[q4(R,G)]):M},[])},$B=function(r,s,c,m){var v=m||{x:r.chartX,y:r.chartY},T=pue(v,c),o=r.orderedTooltipTicks,M=r.tooltipAxis,R=r.tooltipTicks,B=ere(T,o,R,M);if(B>=0&&R){var F=R[B]&&R[B].value,G=lP(r,s,B,F),K=mue(c,o,B,v);return{activeTooltipIndex:B,activeLabel:F,activePayload:G,activeCoordinate:K}}return null},gue=function(r,s){var c=s.axes,m=s.graphicalItems,v=s.axisType,T=s.axisIdKey,o=s.stackGroups,M=s.dataStartIndex,R=s.dataEndIndex,B=r.layout,F=r.children,G=r.stackOffset,K=B4(B,v);return c.reduce(function(ee,H){var Z,ae=H.type.defaultProps!==void 0?rr(rr({},H.type.defaultProps),H.props):H.props,fe=ae.type,ue=ae.dataKey,_e=ae.allowDataOverflow,le=ae.allowDuplicatedCategory,pe=ae.scale,Te=ae.ticks,De=ae.includeHidden,Xe=ae[T];if(ee[Xe])return ee;var wt=e1(r.data,{graphicalItems:m.filter(function(mt){var ar,Mr=T in mt.props?mt.props[T]:(ar=mt.type.defaultProps)===null||ar===void 0?void 0:ar[T];return Mr===Xe}),dataStartIndex:M,dataEndIndex:R}),$e=wt.length,vt,ft,bt;Vce(ae.domain,_e,fe)&&(vt=S2(ae.domain,null,_e),K&&(fe==="number"||pe!=="auto")&&(bt=ky(wt,ue,"category")));var St=JU(fe);if(!vt||vt.length===0){var gt,Rt=(gt=ae.domain)!==null&&gt!==void 0?gt:St;if(ue){if(vt=ky(wt,ue,fe),fe==="category"&&K){var Ke=Z9(vt);le&&Ke?(ft=vt,vt=Z0(0,$e)):le||(vt=G3(Rt,vt,H).reduce(function(mt,ar){return mt.indexOf(ar)>=0?mt:[].concat(m_(mt),[ar])},[]))}else if(fe==="category")le?vt=vt.filter(function(mt){return mt!==""&&!bi(mt)}):vt=G3(Rt,vt,H).reduce(function(mt,ar){return mt.indexOf(ar)>=0||ar===""||bi(ar)?mt:[].concat(m_(mt),[ar])},[]);else if(fe==="number"){var yt=ore(wt,m.filter(function(mt){var ar,Mr,Gr=T in mt.props?mt.props[T]:(ar=mt.type.defaultProps)===null||ar===void 0?void 0:ar[T],Tr="hide"in mt.props?mt.props.hide:(Mr=mt.type.defaultProps)===null||Mr===void 0?void 0:Mr.hide;return Gr===Xe&&(De||!Tr)}),ue,v,B);yt&&(vt=yt)}K&&(fe==="number"||pe!=="auto")&&(bt=ky(wt,ue,"category"))}else K?vt=Z0(0,$e):o&&o[Xe]&&o[Xe].hasStack&&fe==="number"?vt=G==="expand"?[0,1]:$4(o[Xe].stackGroups,M,R):vt=F4(wt,m.filter(function(mt){var ar=T in mt.props?mt.props[T]:mt.type.defaultProps[T],Mr="hide"in mt.props?mt.props.hide:mt.type.defaultProps.hide;return ar===Xe&&(De||!Mr)}),fe,B,!0);if(fe==="number")vt=oP(F,vt,Xe,v,Te),Rt&&(vt=S2(Rt,vt,_e));else if(fe==="category"&&Rt){var Vt=Rt,qe=vt.every(function(mt){return Vt.indexOf(mt)>=0});qe&&(vt=Vt)}}return rr(rr({},ee),{},Bn({},Xe,rr(rr({},ae),{},{axisType:v,domain:vt,categoricalDomain:bt,duplicateDomain:ft,originalDomain:(Z=ae.domain)!==null&&Z!==void 0?Z:St,isCategorical:K,layout:B})))},{})},_ue=function(r,s){var c=s.graphicalItems,m=s.Axis,v=s.axisType,T=s.axisIdKey,o=s.stackGroups,M=s.dataStartIndex,R=s.dataEndIndex,B=r.layout,F=r.children,G=e1(r.data,{graphicalItems:c,dataStartIndex:M,dataEndIndex:R}),K=G.length,ee=B4(B,v),H=-1;return c.reduce(function(Z,ae){var fe=ae.type.defaultProps!==void 0?rr(rr({},ae.type.defaultProps),ae.props):ae.props,ue=fe[T],_e=JU("number");if(!Z[ue]){H++;var le;return ee?le=Z0(0,K):o&&o[ue]&&o[ue].hasStack?(le=$4(o[ue].stackGroups,M,R),le=oP(F,le,ue,v)):(le=S2(_e,F4(G,c.filter(function(pe){var Te,De,Xe=T in pe.props?pe.props[T]:(Te=pe.type.defaultProps)===null||Te===void 0?void 0:Te[T],wt="hide"in pe.props?pe.props.hide:(De=pe.type.defaultProps)===null||De===void 0?void 0:De.hide;return Xe===ue&&!wt}),"number",B),m.defaultProps.allowDataOverflow),le=oP(F,le,ue,v)),rr(rr({},Z),{},Bn({},ue,rr(rr({axisType:v},m.defaultProps),{},{hide:!0,orientation:nc(fue,"".concat(v,".").concat(H%2),null),domain:le,originalDomain:_e,isCategorical:ee,layout:B})))}return Z},{})},yue=function(r,s){var c=s.axisType,m=c===void 0?"xAxis":c,v=s.AxisComp,T=s.graphicalItems,o=s.stackGroups,M=s.dataStartIndex,R=s.dataEndIndex,B=r.children,F="".concat(m,"Id"),G=Xc(B,v),K={};return G&&G.length?K=gue(r,{axes:G,graphicalItems:T,axisType:m,axisIdKey:F,stackGroups:o,dataStartIndex:M,dataEndIndex:R}):T&&T.length&&(K=_ue(r,{Axis:v,graphicalItems:T,axisType:m,axisIdKey:F,stackGroups:o,dataStartIndex:M,dataEndIndex:R})),K},vue=function(r){var s=Ap(r),c=ed(s,!1,!0);return{tooltipTicks:c,orderedTooltipTicks:ZP(c,function(m){return m.coordinate}),tooltipAxis:s,tooltipAxisBandSize:z0(s,c)}},qB=function(r){var s=r.children,c=r.defaultShowTooltip,m=Ql(s,a_),v=0,T=0;return r.data&&r.data.length!==0&&(T=r.data.length-1),m&&m.props&&(m.props.startIndex>=0&&(v=m.props.startIndex),m.props.endIndex>=0&&(T=m.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:v,dataEndIndex:T,activeTooltipIndex:-1,isTooltipActive:!!c}},xue=function(r){return!r||!r.length?!1:r.some(function(s){var c=td(s&&s.type);return c&&c.indexOf("Bar")>=0})},GB=function(r){return r==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:r==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:r==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},bue=function(r,s){var c=r.props,m=r.graphicalItems,v=r.xAxisMap,T=v===void 0?{}:v,o=r.yAxisMap,M=o===void 0?{}:o,R=c.width,B=c.height,F=c.children,G=c.margin||{},K=Ql(F,a_),ee=Ql(F,Ug),H=Object.keys(M).reduce(function(le,pe){var Te=M[pe],De=Te.orientation;return!Te.mirror&&!Te.hide?rr(rr({},le),{},Bn({},De,le[De]+Te.width)):le},{left:G.left||0,right:G.right||0}),Z=Object.keys(T).reduce(function(le,pe){var Te=T[pe],De=Te.orientation;return!Te.mirror&&!Te.hide?rr(rr({},le),{},Bn({},De,nc(le,"".concat(De))+Te.height)):le},{top:G.top||0,bottom:G.bottom||0}),ae=rr(rr({},Z),H),fe=ae.bottom;K&&(ae.bottom+=K.props.height||a_.defaultProps.height),ee&&s&&(ae=nre(ae,m,c,s));var ue=R-ae.left-ae.right,_e=B-ae.top-ae.bottom;return rr(rr({brushBottom:fe},ae),{},{width:Math.max(ue,0),height:Math.max(_e,0)})},wue=function(r,s){if(s==="xAxis")return r[s].width;if(s==="yAxis")return r[s].height},QU=function(r){var s=r.chartName,c=r.GraphicalChild,m=r.defaultTooltipEventType,v=m===void 0?"axis":m,T=r.validateTooltipEventTypes,o=T===void 0?["axis"]:T,M=r.axisComponents,R=r.legendContent,B=r.formatAxisMap,F=r.defaultProps,G=function(ae,fe){var ue=fe.graphicalItems,_e=fe.stackGroups,le=fe.offset,pe=fe.updateId,Te=fe.dataStartIndex,De=fe.dataEndIndex,Xe=ae.barSize,wt=ae.layout,$e=ae.barGap,vt=ae.barCategoryGap,ft=ae.maxBarSize,bt=GB(wt),St=bt.numericAxisName,gt=bt.cateAxisName,Rt=xue(ue),Ke=[];return ue.forEach(function(yt,Vt){var qe=e1(ae.data,{graphicalItems:[yt],dataStartIndex:Te,dataEndIndex:De}),mt=yt.type.defaultProps!==void 0?rr(rr({},yt.type.defaultProps),yt.props):yt.props,ar=mt.dataKey,Mr=mt.maxBarSize,Gr=mt["".concat(St,"Id")],Tr=mt["".concat(gt,"Id")],vr={},Br=M.reduce(function(Vi,Bo){var Ba=fe["".concat(Bo.axisType,"Map")],Os=mt["".concat(Bo.axisType,"Id")];Ba&&Ba[Os]||Bo.axisType==="zAxis"||Fm();var tl=Ba[Os];return rr(rr({},Vi),{},Bn(Bn({},Bo.axisType,tl),"".concat(Bo.axisType,"Ticks"),ed(tl)))},vr),or=Br[gt],Ar=Br["".concat(gt,"Ticks")],un=_e&&_e[Gr]&&_e[Gr].hasStack&&pre(yt,_e[Gr].stackGroups),sr=td(yt.type).indexOf("Bar")>=0,ui=z0(or,Ar),Rn=[],In=Rt&&tre({barSize:Xe,stackGroups:_e,totalSize:wue(Br,gt)});if(sr){var hi,Yi,Sa=bi(Mr)?ft:Mr,qo=(hi=(Yi=z0(or,Ar,!0))!==null&&Yi!==void 0?Yi:Sa)!==null&&hi!==void 0?hi:0;Rn=rre({barGap:$e,barCategoryGap:vt,bandSize:qo!==ui?qo:ui,sizeList:In[Tr],maxBarSize:Sa}),qo!==ui&&(Rn=Rn.map(function(Vi){return rr(rr({},Vi),{},{position:rr(rr({},Vi.position),{},{offset:Vi.position.offset-qo/2})})}))}var po=yt&&yt.type&&yt.type.getComposedData;po&&Ke.push({props:rr(rr({},po(rr(rr({},Br),{},{displayedData:qe,props:ae,dataKey:ar,item:yt,bandSize:ui,barPosition:Rn,offset:le,stackedData:un,layout:wt,dataStartIndex:Te,dataEndIndex:De}))),{},Bn(Bn(Bn({key:yt.key||"item-".concat(Vt)},St,Br[St]),gt,Br[gt]),"animationId",pe)),childIndex:aZ(yt,ae.children),item:yt})}),Ke},K=function(ae,fe){var ue=ae.props,_e=ae.dataStartIndex,le=ae.dataEndIndex,pe=ae.updateId;if(!ak({props:ue}))return null;var Te=ue.children,De=ue.layout,Xe=ue.stackOffset,wt=ue.data,$e=ue.reverseStackOrder,vt=GB(De),ft=vt.numericAxisName,bt=vt.cateAxisName,St=Xc(Te,c),gt=fre(wt,St,"".concat(ft,"Id"),"".concat(bt,"Id"),Xe,$e),Rt=M.reduce(function(mt,ar){var Mr="".concat(ar.axisType,"Map");return rr(rr({},mt),{},Bn({},Mr,yue(ue,rr(rr({},ar),{},{graphicalItems:St,stackGroups:ar.axisType===ft&&gt,dataStartIndex:_e,dataEndIndex:le}))))},{}),Ke=bue(rr(rr({},Rt),{},{props:ue,graphicalItems:St}),fe?.legendBBox);Object.keys(Rt).forEach(function(mt){Rt[mt]=B(ue,Rt[mt],Ke,mt.replace("Map",""),s)});var yt=Rt["".concat(bt,"Map")],Vt=vue(yt),qe=G(ue,rr(rr({},Rt),{},{dataStartIndex:_e,dataEndIndex:le,updateId:pe,graphicalItems:St,stackGroups:gt,offset:Ke}));return rr(rr({formattedGraphicalItems:qe,graphicalItems:St,offset:Ke,stackGroups:gt},Vt),Rt)},ee=(function(Z){function ae(fe){var ue,_e,le;return tue(this,ae),le=iue(this,ae,[fe]),Bn(le,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Bn(le,"accessibilityManager",new Uce),Bn(le,"handleLegendBBoxUpdate",function(pe){if(pe){var Te=le.state,De=Te.dataStartIndex,Xe=Te.dataEndIndex,wt=Te.updateId;le.setState(rr({legendBBox:pe},K({props:le.props,dataStartIndex:De,dataEndIndex:Xe,updateId:wt},rr(rr({},le.state),{},{legendBBox:pe}))))}}),Bn(le,"handleReceiveSyncEvent",function(pe,Te,De){if(le.props.syncId===pe){if(De===le.eventEmitterSymbol&&typeof le.props.syncMethod!="function")return;le.applySyncEvent(Te)}}),Bn(le,"handleBrushChange",function(pe){var Te=pe.startIndex,De=pe.endIndex;if(Te!==le.state.dataStartIndex||De!==le.state.dataEndIndex){var Xe=le.state.updateId;le.setState(function(){return rr({dataStartIndex:Te,dataEndIndex:De},K({props:le.props,dataStartIndex:Te,dataEndIndex:De,updateId:Xe},le.state))}),le.triggerSyncEvent({dataStartIndex:Te,dataEndIndex:De})}}),Bn(le,"handleMouseEnter",function(pe){var Te=le.getMouseInfo(pe);if(Te){var De=rr(rr({},Te),{},{isTooltipActive:!0});le.setState(De),le.triggerSyncEvent(De);var Xe=le.props.onMouseEnter;Zn(Xe)&&Xe(De,pe)}}),Bn(le,"triggeredAfterMouseMove",function(pe){var Te=le.getMouseInfo(pe),De=Te?rr(rr({},Te),{},{isTooltipActive:!0}):{isTooltipActive:!1};le.setState(De),le.triggerSyncEvent(De);var Xe=le.props.onMouseMove;Zn(Xe)&&Xe(De,pe)}),Bn(le,"handleItemMouseEnter",function(pe){le.setState(function(){return{isTooltipActive:!0,activeItem:pe,activePayload:pe.tooltipPayload,activeCoordinate:pe.tooltipPosition||{x:pe.cx,y:pe.cy}}})}),Bn(le,"handleItemMouseLeave",function(){le.setState(function(){return{isTooltipActive:!1}})}),Bn(le,"handleMouseMove",function(pe){pe.persist(),le.throttleTriggeredAfterMouseMove(pe)}),Bn(le,"handleMouseLeave",function(pe){le.throttleTriggeredAfterMouseMove.cancel();var Te={isTooltipActive:!1};le.setState(Te),le.triggerSyncEvent(Te);var De=le.props.onMouseLeave;Zn(De)&&De(Te,pe)}),Bn(le,"handleOuterEvent",function(pe){var Te=oZ(pe),De=nc(le.props,"".concat(Te));if(Te&&Zn(De)){var Xe,wt;/.*touch.*/i.test(Te)?wt=le.getMouseInfo(pe.changedTouches[0]):wt=le.getMouseInfo(pe),De((Xe=wt)!==null&&Xe!==void 0?Xe:{},pe)}}),Bn(le,"handleClick",function(pe){var Te=le.getMouseInfo(pe);if(Te){var De=rr(rr({},Te),{},{isTooltipActive:!0});le.setState(De),le.triggerSyncEvent(De);var Xe=le.props.onClick;Zn(Xe)&&Xe(De,pe)}}),Bn(le,"handleMouseDown",function(pe){var Te=le.props.onMouseDown;if(Zn(Te)){var De=le.getMouseInfo(pe);Te(De,pe)}}),Bn(le,"handleMouseUp",function(pe){var Te=le.props.onMouseUp;if(Zn(Te)){var De=le.getMouseInfo(pe);Te(De,pe)}}),Bn(le,"handleTouchMove",function(pe){pe.changedTouches!=null&&pe.changedTouches.length>0&&le.throttleTriggeredAfterMouseMove(pe.changedTouches[0])}),Bn(le,"handleTouchStart",function(pe){pe.changedTouches!=null&&pe.changedTouches.length>0&&le.handleMouseDown(pe.changedTouches[0])}),Bn(le,"handleTouchEnd",function(pe){pe.changedTouches!=null&&pe.changedTouches.length>0&&le.handleMouseUp(pe.changedTouches[0])}),Bn(le,"handleDoubleClick",function(pe){var Te=le.props.onDoubleClick;if(Zn(Te)){var De=le.getMouseInfo(pe);Te(De,pe)}}),Bn(le,"handleContextMenu",function(pe){var Te=le.props.onContextMenu;if(Zn(Te)){var De=le.getMouseInfo(pe);Te(De,pe)}}),Bn(le,"triggerSyncEvent",function(pe){le.props.syncId!==void 0&&IA.emit(CA,le.props.syncId,pe,le.eventEmitterSymbol)}),Bn(le,"applySyncEvent",function(pe){var Te=le.props,De=Te.layout,Xe=Te.syncMethod,wt=le.state.updateId,$e=pe.dataStartIndex,vt=pe.dataEndIndex;if(pe.dataStartIndex!==void 0||pe.dataEndIndex!==void 0)le.setState(rr({dataStartIndex:$e,dataEndIndex:vt},K({props:le.props,dataStartIndex:$e,dataEndIndex:vt,updateId:wt},le.state)));else if(pe.activeTooltipIndex!==void 0){var ft=pe.chartX,bt=pe.chartY,St=pe.activeTooltipIndex,gt=le.state,Rt=gt.offset,Ke=gt.tooltipTicks;if(!Rt)return;if(typeof Xe=="function")St=Xe(Ke,pe);else if(Xe==="value"){St=-1;for(var yt=0;yt<Ke.length;yt++)if(Ke[yt].value===pe.activeLabel){St=yt;break}}var Vt=rr(rr({},Rt),{},{x:Rt.left,y:Rt.top}),qe=Math.min(ft,Vt.x+Vt.width),mt=Math.min(bt,Vt.y+Vt.height),ar=Ke[St]&&Ke[St].value,Mr=lP(le.state,le.props.data,St),Gr=Ke[St]?{x:De==="horizontal"?Ke[St].coordinate:qe,y:De==="horizontal"?mt:Ke[St].coordinate}:YU;le.setState(rr(rr({},pe),{},{activeLabel:ar,activeCoordinate:Gr,activePayload:Mr,activeTooltipIndex:St}))}else le.setState(pe)}),Bn(le,"renderCursor",function(pe){var Te,De=le.state,Xe=De.isTooltipActive,wt=De.activeCoordinate,$e=De.activePayload,vt=De.offset,ft=De.activeTooltipIndex,bt=De.tooltipAxisBandSize,St=le.getTooltipEventType(),gt=(Te=pe.props.active)!==null&&Te!==void 0?Te:Xe,Rt=le.props.layout,Ke=pe.key||"_recharts-cursor";return ht.createElement(Zce,{key:Ke,activeCoordinate:wt,activePayload:$e,activeTooltipIndex:ft,chartName:s,element:pe,isActive:gt,layout:Rt,offset:vt,tooltipAxisBandSize:bt,tooltipEventType:St})}),Bn(le,"renderPolarAxis",function(pe,Te,De){var Xe=nc(pe,"type.axisType"),wt=nc(le.state,"".concat(Xe,"Map")),$e=pe.type.defaultProps,vt=$e!==void 0?rr(rr({},$e),pe.props):pe.props,ft=wt&&wt[vt["".concat(Xe,"Id")]];return Le.cloneElement(pe,rr(rr({},ft),{},{className:ci(Xe,ft.className),key:pe.key||"".concat(Te,"-").concat(De),ticks:ed(ft,!0)}))}),Bn(le,"renderPolarGrid",function(pe){var Te=pe.props,De=Te.radialLines,Xe=Te.polarAngles,wt=Te.polarRadius,$e=le.state,vt=$e.radiusAxisMap,ft=$e.angleAxisMap,bt=Ap(vt),St=Ap(ft),gt=St.cx,Rt=St.cy,Ke=St.innerRadius,yt=St.outerRadius;return Le.cloneElement(pe,{polarAngles:Array.isArray(Xe)?Xe:ed(St,!0).map(function(Vt){return Vt.coordinate}),polarRadius:Array.isArray(wt)?wt:ed(bt,!0).map(function(Vt){return Vt.coordinate}),cx:gt,cy:Rt,innerRadius:Ke,outerRadius:yt,key:pe.key||"polar-grid",radialLines:De})}),Bn(le,"renderLegend",function(){var pe=le.state.formattedGraphicalItems,Te=le.props,De=Te.children,Xe=Te.width,wt=Te.height,$e=le.props.margin||{},vt=Xe-($e.left||0)-($e.right||0),ft=L4({children:De,formattedGraphicalItems:pe,legendWidth:vt,legendContent:R});if(!ft)return null;var bt=ft.item,St=UB(ft,Xce);return Le.cloneElement(bt,rr(rr({},St),{},{chartWidth:Xe,chartHeight:wt,margin:$e,onBBoxUpdate:le.handleLegendBBoxUpdate}))}),Bn(le,"renderTooltip",function(){var pe,Te=le.props,De=Te.children,Xe=Te.accessibilityLayer,wt=Ql(De,Kf);if(!wt)return null;var $e=le.state,vt=$e.isTooltipActive,ft=$e.activeCoordinate,bt=$e.activePayload,St=$e.activeLabel,gt=$e.offset,Rt=(pe=wt.props.active)!==null&&pe!==void 0?pe:vt;return Le.cloneElement(wt,{viewBox:rr(rr({},gt),{},{x:gt.left,y:gt.top}),active:Rt,label:St,payload:Rt?bt:[],coordinate:ft,accessibilityLayer:Xe})}),Bn(le,"renderBrush",function(pe){var Te=le.props,De=Te.margin,Xe=Te.data,wt=le.state,$e=wt.offset,vt=wt.dataStartIndex,ft=wt.dataEndIndex,bt=wt.updateId;return Le.cloneElement(pe,{key:pe.key||"_recharts-brush",onChange:Xx(le.handleBrushChange,pe.props.onChange),data:Xe,x:kr(pe.props.x)?pe.props.x:$e.left,y:kr(pe.props.y)?pe.props.y:$e.top+$e.height+$e.brushBottom-(De.bottom||0),width:kr(pe.props.width)?pe.props.width:$e.width,startIndex:vt,endIndex:ft,updateId:"brush-".concat(bt)})}),Bn(le,"renderReferenceElement",function(pe,Te,De){if(!pe)return null;var Xe=le,wt=Xe.clipPathId,$e=le.state,vt=$e.xAxisMap,ft=$e.yAxisMap,bt=$e.offset,St=pe.type.defaultProps||{},gt=pe.props,Rt=gt.xAxisId,Ke=Rt===void 0?St.xAxisId:Rt,yt=gt.yAxisId,Vt=yt===void 0?St.yAxisId:yt;return Le.cloneElement(pe,{key:pe.key||"".concat(Te,"-").concat(De),xAxis:vt[Ke],yAxis:ft[Vt],viewBox:{x:bt.left,y:bt.top,width:bt.width,height:bt.height},clipPathId:wt})}),Bn(le,"renderActivePoints",function(pe){var Te=pe.item,De=pe.activePoint,Xe=pe.basePoint,wt=pe.childIndex,$e=pe.isRange,vt=[],ft=Te.props.key,bt=Te.item.type.defaultProps!==void 0?rr(rr({},Te.item.type.defaultProps),Te.item.props):Te.item.props,St=bt.activeDot,gt=bt.dataKey,Rt=rr(rr({index:wt,dataKey:gt,cx:De.x,cy:De.y,r:4,fill:bI(Te.item),strokeWidth:2,stroke:"#fff",payload:De.payload,value:De.value},Vn(St,!1)),f0(St));return vt.push(ae.renderActiveDot(St,Rt,"".concat(ft,"-activePoint-").concat(wt))),Xe?vt.push(ae.renderActiveDot(St,rr(rr({},Rt),{},{cx:Xe.x,cy:Xe.y}),"".concat(ft,"-basePoint-").concat(wt))):$e&&vt.push(null),vt}),Bn(le,"renderGraphicChild",function(pe,Te,De){var Xe=le.filterFormatItem(pe,Te,De);if(!Xe)return null;var wt=le.getTooltipEventType(),$e=le.state,vt=$e.isTooltipActive,ft=$e.tooltipAxis,bt=$e.activeTooltipIndex,St=$e.activeLabel,gt=le.props.children,Rt=Ql(gt,Kf),Ke=Xe.props,yt=Ke.points,Vt=Ke.isRange,qe=Ke.baseLine,mt=Xe.item.type.defaultProps!==void 0?rr(rr({},Xe.item.type.defaultProps),Xe.item.props):Xe.item.props,ar=mt.activeDot,Mr=mt.hide,Gr=mt.activeBar,Tr=mt.activeShape,vr=!!(!Mr&&vt&&Rt&&(ar||Gr||Tr)),Br={};wt!=="axis"&&Rt&&Rt.props.trigger==="click"?Br={onClick:Xx(le.handleItemMouseEnter,pe.props.onClick)}:wt!=="axis"&&(Br={onMouseLeave:Xx(le.handleItemMouseLeave,pe.props.onMouseLeave),onMouseEnter:Xx(le.handleItemMouseEnter,pe.props.onMouseEnter)});var or=Le.cloneElement(pe,rr(rr({},Xe.props),Br));function Ar(Bo){return typeof ft.dataKey=="function"?ft.dataKey(Bo.payload):null}if(vr)if(bt>=0){var un,sr;if(ft.dataKey&&!ft.allowDuplicatedCategory){var ui=typeof ft.dataKey=="function"?Ar:"payload.".concat(ft.dataKey.toString());un=$A(yt,ui,St),sr=Vt&&qe&&$A(qe,ui,St)}else un=yt?.[bt],sr=Vt&&qe&&qe[bt];if(Tr||Gr){var Rn=pe.props.activeIndex!==void 0?pe.props.activeIndex:bt;return[Le.cloneElement(pe,rr(rr(rr({},Xe.props),Br),{},{activeIndex:Rn})),null,null]}if(!bi(un))return[or].concat(m_(le.renderActivePoints({item:Xe,activePoint:un,basePoint:sr,childIndex:bt,isRange:Vt})))}else{var In,hi=(In=le.getItemByXY(le.state.activeCoordinate))!==null&&In!==void 0?In:{graphicalItem:or},Yi=hi.graphicalItem,Sa=Yi.item,qo=Sa===void 0?pe:Sa,po=Yi.childIndex,Vi=rr(rr(rr({},Xe.props),Br),{},{activeIndex:po});return[Le.cloneElement(qo,Vi),null,null]}return Vt?[or,null,null]:[or,null]}),Bn(le,"renderCustomized",function(pe,Te,De){return Le.cloneElement(pe,rr(rr({key:"recharts-customized-".concat(De)},le.props),le.state))}),Bn(le,"renderMap",{CartesianGrid:{handler:e0,once:!0},ReferenceArea:{handler:le.renderReferenceElement},ReferenceLine:{handler:e0},ReferenceDot:{handler:le.renderReferenceElement},XAxis:{handler:e0},YAxis:{handler:e0},Brush:{handler:le.renderBrush,once:!0},Bar:{handler:le.renderGraphicChild},Line:{handler:le.renderGraphicChild},Area:{handler:le.renderGraphicChild},Radar:{handler:le.renderGraphicChild},RadialBar:{handler:le.renderGraphicChild},Scatter:{handler:le.renderGraphicChild},Pie:{handler:le.renderGraphicChild},Funnel:{handler:le.renderGraphicChild},Tooltip:{handler:le.renderCursor,once:!0},PolarGrid:{handler:le.renderPolarGrid,once:!0},PolarAngleAxis:{handler:le.renderPolarAxis},PolarRadiusAxis:{handler:le.renderPolarAxis},Customized:{handler:le.renderCustomized}}),le.clipPathId="".concat((ue=fe.id)!==null&&ue!==void 0?ue:Rv("recharts"),"-clip"),le.throttleTriggeredAfterMouseMove=k5(le.triggeredAfterMouseMove,(_e=fe.throttleDelay)!==null&&_e!==void 0?_e:1e3/60),le.state={},le}return sue(ae,Z),nue(ae,[{key:"componentDidMount",value:function(){var ue,_e;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(ue=this.props.margin.left)!==null&&ue!==void 0?ue:0,top:(_e=this.props.margin.top)!==null&&_e!==void 0?_e:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var ue=this.props,_e=ue.children,le=ue.data,pe=ue.height,Te=ue.layout,De=Ql(_e,Kf);if(De){var Xe=De.props.defaultIndex;if(!(typeof Xe!="number"||Xe<0||Xe>this.state.tooltipTicks.length-1)){var wt=this.state.tooltipTicks[Xe]&&this.state.tooltipTicks[Xe].value,$e=lP(this.state,le,Xe,wt),vt=this.state.tooltipTicks[Xe].coordinate,ft=(this.state.offset.top+pe)/2,bt=Te==="horizontal",St=bt?{x:vt,y:ft}:{y:vt,x:ft},gt=this.state.formattedGraphicalItems.find(function(Ke){var yt=Ke.item;return yt.type.name==="Scatter"});gt&&(St=rr(rr({},St),gt.props.points[Xe].tooltipPosition),$e=gt.props.points[Xe].tooltipPayload);var Rt={activeTooltipIndex:Xe,isTooltipActive:!0,activeLabel:wt,activePayload:$e,activeCoordinate:St};this.setState(Rt),this.renderCursor(De),this.accessibilityManager.setIndex(Xe)}}}},{key:"getSnapshotBeforeUpdate",value:function(ue,_e){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==_e.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==ue.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==ue.margin){var le,pe;this.accessibilityManager.setDetails({offset:{left:(le=this.props.margin.left)!==null&&le!==void 0?le:0,top:(pe=this.props.margin.top)!==null&&pe!==void 0?pe:0}})}return null}},{key:"componentDidUpdate",value:function(ue){GA([Ql(ue.children,Kf)],[Ql(this.props.children,Kf)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var ue=Ql(this.props.children,Kf);if(ue&&typeof ue.props.shared=="boolean"){var _e=ue.props.shared?"axis":"item";return o.indexOf(_e)>=0?_e:v}return v}},{key:"getMouseInfo",value:function(ue){if(!this.container)return null;var _e=this.container,le=_e.getBoundingClientRect(),pe=HY(le),Te={chartX:Math.round(ue.pageX-pe.left),chartY:Math.round(ue.pageY-pe.top)},De=le.width/_e.offsetWidth||1,Xe=this.inRange(Te.chartX,Te.chartY,De);if(!Xe)return null;var wt=this.state,$e=wt.xAxisMap,vt=wt.yAxisMap,ft=this.getTooltipEventType(),bt=$B(this.state,this.props.data,this.props.layout,Xe);if(ft!=="axis"&&$e&&vt){var St=Ap($e).scale,gt=Ap(vt).scale,Rt=St&&St.invert?St.invert(Te.chartX):null,Ke=gt&&gt.invert?gt.invert(Te.chartY):null;return rr(rr({},Te),{},{xValue:Rt,yValue:Ke},bt)}return bt?rr(rr({},Te),bt):null}},{key:"inRange",value:function(ue,_e){var le=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,pe=this.props.layout,Te=ue/le,De=_e/le;if(pe==="horizontal"||pe==="vertical"){var Xe=this.state.offset,wt=Te>=Xe.left&&Te<=Xe.left+Xe.width&&De>=Xe.top&&De<=Xe.top+Xe.height;return wt?{x:Te,y:De}:null}var $e=this.state,vt=$e.angleAxisMap,ft=$e.radiusAxisMap;if(vt&&ft){var bt=Ap(vt);return Z3({x:Te,y:De},bt)}return null}},{key:"parseEventsOfWrapper",value:function(){var ue=this.props.children,_e=this.getTooltipEventType(),le=Ql(ue,Kf),pe={};le&&_e==="axis"&&(le.props.trigger==="click"?pe={onClick:this.handleClick}:pe={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var Te=f0(this.props,this.handleOuterEvent);return rr(rr({},Te),pe)}},{key:"addListener",value:function(){IA.on(CA,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){IA.removeListener(CA,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(ue,_e,le){for(var pe=this.state.formattedGraphicalItems,Te=0,De=pe.length;Te<De;Te++){var Xe=pe[Te];if(Xe.item===ue||Xe.props.key===ue.key||_e===td(Xe.item.type)&&le===Xe.childIndex)return Xe}return null}},{key:"renderClipPath",value:function(){var ue=this.clipPathId,_e=this.state.offset,le=_e.left,pe=_e.top,Te=_e.height,De=_e.width;return ht.createElement("defs",null,ht.createElement("clipPath",{id:ue},ht.createElement("rect",{x:le,y:pe,height:Te,width:De})))}},{key:"getXScales",value:function(){var ue=this.state.xAxisMap;return ue?Object.entries(ue).reduce(function(_e,le){var pe=jB(le,2),Te=pe[0],De=pe[1];return rr(rr({},_e),{},Bn({},Te,De.scale))},{}):null}},{key:"getYScales",value:function(){var ue=this.state.yAxisMap;return ue?Object.entries(ue).reduce(function(_e,le){var pe=jB(le,2),Te=pe[0],De=pe[1];return rr(rr({},_e),{},Bn({},Te,De.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(ue){var _e;return(_e=this.state.xAxisMap)===null||_e===void 0||(_e=_e[ue])===null||_e===void 0?void 0:_e.scale}},{key:"getYScaleByAxisId",value:function(ue){var _e;return(_e=this.state.yAxisMap)===null||_e===void 0||(_e=_e[ue])===null||_e===void 0?void 0:_e.scale}},{key:"getItemByXY",value:function(ue){var _e=this.state,le=_e.formattedGraphicalItems,pe=_e.activeItem;if(le&&le.length)for(var Te=0,De=le.length;Te<De;Te++){var Xe=le[Te],wt=Xe.props,$e=Xe.item,vt=$e.type.defaultProps!==void 0?rr(rr({},$e.type.defaultProps),$e.props):$e.props,ft=td($e.type);if(ft==="Bar"){var bt=(wt.data||[]).find(function(Ke){return coe(ue,Ke)});if(bt)return{graphicalItem:Xe,payload:bt}}else if(ft==="RadialBar"){var St=(wt.data||[]).find(function(Ke){return Z3(ue,Ke)});if(St)return{graphicalItem:Xe,payload:St}}else if(Gb(Xe,pe)||Hb(Xe,pe)||_v(Xe,pe)){var gt=Rae({graphicalItem:Xe,activeTooltipItem:pe,itemData:vt.data}),Rt=vt.activeIndex===void 0?gt:vt.activeIndex;return{graphicalItem:rr(rr({},Xe),{},{childIndex:Rt}),payload:_v(Xe,pe)?vt.data[gt]:Xe.props.data[gt]}}}return null}},{key:"render",value:function(){var ue=this;if(!ak(this))return null;var _e=this.props,le=_e.children,pe=_e.className,Te=_e.width,De=_e.height,Xe=_e.style,wt=_e.compact,$e=_e.title,vt=_e.desc,ft=UB(_e,Kce),bt=Vn(ft,!1);if(wt)return ht.createElement(TB,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},ht.createElement(WA,Fg({},bt,{width:Te,height:De,title:$e,desc:vt}),this.renderClipPath(),lk(le,this.renderMap)));if(this.props.accessibilityLayer){var St,gt;bt.tabIndex=(St=this.props.tabIndex)!==null&&St!==void 0?St:0,bt.role=(gt=this.props.role)!==null&&gt!==void 0?gt:"application",bt.onKeyDown=function(Ke){ue.accessibilityManager.keyboardEvent(Ke)},bt.onFocus=function(){ue.accessibilityManager.focus()}}var Rt=this.parseEventsOfWrapper();return ht.createElement(TB,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},ht.createElement("div",Fg({className:ci("recharts-wrapper",pe),style:rr({position:"relative",cursor:"default",width:Te,height:De},Xe)},Rt,{ref:function(yt){ue.container=yt}}),ht.createElement(WA,Fg({},bt,{width:Te,height:De,title:$e,desc:vt,style:due}),this.renderClipPath(),lk(le,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])})(Le.Component);Bn(ee,"displayName",s),Bn(ee,"defaultProps",rr({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},F)),Bn(ee,"getDerivedStateFromProps",function(Z,ae){var fe=Z.dataKey,ue=Z.data,_e=Z.children,le=Z.width,pe=Z.height,Te=Z.layout,De=Z.stackOffset,Xe=Z.margin,wt=ae.dataStartIndex,$e=ae.dataEndIndex;if(ae.updateId===void 0){var vt=qB(Z);return rr(rr(rr({},vt),{},{updateId:0},K(rr(rr({props:Z},vt),{},{updateId:0}),ae)),{},{prevDataKey:fe,prevData:ue,prevWidth:le,prevHeight:pe,prevLayout:Te,prevStackOffset:De,prevMargin:Xe,prevChildren:_e})}if(fe!==ae.prevDataKey||ue!==ae.prevData||le!==ae.prevWidth||pe!==ae.prevHeight||Te!==ae.prevLayout||De!==ae.prevStackOffset||!jg(Xe,ae.prevMargin)){var ft=qB(Z),bt={chartX:ae.chartX,chartY:ae.chartY,isTooltipActive:ae.isTooltipActive},St=rr(rr({},$B(ae,ue,Te)),{},{updateId:ae.updateId+1}),gt=rr(rr(rr({},ft),bt),St);return rr(rr(rr({},gt),K(rr({props:Z},gt),ae)),{},{prevDataKey:fe,prevData:ue,prevWidth:le,prevHeight:pe,prevLayout:Te,prevStackOffset:De,prevMargin:Xe,prevChildren:_e})}if(!GA(_e,ae.prevChildren)){var Rt,Ke,yt,Vt,qe=Ql(_e,a_),mt=qe&&(Rt=(Ke=qe.props)===null||Ke===void 0?void 0:Ke.startIndex)!==null&&Rt!==void 0?Rt:wt,ar=qe&&(yt=(Vt=qe.props)===null||Vt===void 0?void 0:Vt.endIndex)!==null&&yt!==void 0?yt:$e,Mr=mt!==wt||ar!==$e,Gr=!bi(ue),Tr=Gr&&!Mr?ae.updateId:ae.updateId+1;return rr(rr({updateId:Tr},K(rr(rr({props:Z},ae),{},{updateId:Tr,dataStartIndex:mt,dataEndIndex:ar}),ae)),{},{prevChildren:_e,dataStartIndex:mt,dataEndIndex:ar})}return null}),Bn(ee,"renderActiveDot",function(Z,ae,fe){var ue;return Le.isValidElement(Z)?ue=Le.cloneElement(Z,ae):Zn(Z)?ue=Z(ae):ue=ht.createElement(SI,ae),ht.createElement(to,{className:"recharts-active-dot",key:fe},ue)});var H=Le.forwardRef(function(ae,fe){return ht.createElement(ee,Fg({},ae,{ref:fe}))});return H.displayName=ee.displayName,H},Sue=QU({chartName:"BarChart",GraphicalChild:Gm,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Jb},{axisType:"yAxis",AxisComp:Qb}],formatAxisMap:Lse}),eV=QU({chartName:"PieChart",GraphicalChild:Qh,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:qb},{axisType:"radiusAxis",AxisComp:Vb}],formatAxisMap:Tre,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const HB=[{name:"Privado",value:67,color:"#6b7280"},{name:"Público",value:33,color:"#e5e7eb"}],OA=[{name:"COVID-19",value:23,percentage:7,color:"#6b7280"},{name:"Esquizofrenia",value:234,percentage:65,color:"#4b5563"},{name:"Insuficiencia Cardiaca",value:45,percentage:15,color:"#9ca3af"},{name:"Convulsiones Epilépticas",value:65,percentage:3,color:"#d1d5db"},{name:"Otro",value:4,percentage:10,color:"#e5e7eb"}],Tue=[{year:"2005",value:20},{year:"2006",value:35},{year:"2007",value:45},{year:"2008",value:30},{year:"2009",value:50},{year:"2010",value:40},{year:"2011",value:60},{year:"2013",value:55},{year:"2014",value:70},{year:"2015",value:45},{year:"2016",value:35},{year:"2017",value:65}];function WB({data:t,title:r,centerText:s}){return He.jsxs(Gg,{className:"p-4",children:[He.jsx("h3",{className:"text-sm font-medium mb-4",children:r}),He.jsxs("div",{className:"relative h-48",children:[He.jsx(KP,{width:"100%",height:"100%",children:He.jsx(eV,{children:He.jsx(Qh,{data:t,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:t.map((c,m)=>He.jsx(kv,{fill:c.color},`cell-${m}`))})})}),s&&He.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:He.jsx("span",{className:"text-2xl font-semibold",children:s})})]}),He.jsx("div",{className:"mt-4 space-y-2",children:t.map((c,m)=>He.jsxs("div",{className:"flex items-center justify-between text-sm",children:[He.jsxs("div",{className:"flex items-center gap-2",children:[He.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:c.color}}),He.jsx("span",{children:c.name})]}),He.jsx("span",{className:"text-muted-foreground",children:c.value})]},m))})]})}function Eue(){return He.jsxs(Gg,{className:"p-4",children:[He.jsx("h3",{className:"text-sm font-medium mb-4",children:"Patologías principales"}),He.jsx("div",{className:"relative h-48",children:He.jsx(KP,{width:"100%",height:"100%",children:He.jsx(eV,{children:He.jsx(Qh,{data:OA,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",children:OA.map((t,r)=>He.jsx(kv,{fill:t.color},`cell-${r}`))})})})}),He.jsx("div",{className:"mt-4 space-y-2",children:OA.map((t,r)=>He.jsxs("div",{className:"flex items-center justify-between text-sm",children:[He.jsxs("div",{className:"flex items-center gap-2",children:[He.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:t.color}}),He.jsx("span",{children:t.name})]}),He.jsxs("div",{className:"flex items-center gap-2",children:[He.jsx("span",{children:t.value}),He.jsxs("span",{className:"text-xs bg-muted px-2 py-1 rounded",children:[t.percentage,"%"]})]})]},r))})]})}function Aue(){return He.jsxs(Gg,{className:"p-4",children:[He.jsx("h3",{className:"text-sm font-medium mb-4",children:"Línea temporal"}),He.jsx("div",{className:"h-64",children:He.jsx(KP,{width:"100%",height:"100%",children:He.jsxs(Sue,{data:Tue,layout:"horizontal",children:[He.jsx(NU,{strokeDasharray:"3 3"}),He.jsx(Jb,{type:"number"}),He.jsx(Qb,{dataKey:"year",type:"category"}),He.jsx(Gm,{dataKey:"value",fill:"#9ca3af"})]})})})]})}function Pue(){return He.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:[He.jsx(WB,{data:HB,title:"Tipo de acceso",centerText:"67%"}),He.jsx(WB,{data:HB,title:"Tipo de acceso"}),He.jsx(Eue,{}),He.jsx("div",{className:"xl:col-span-2",children:He.jsx(Aue,{})})]})}var o0={exports:{}},Iue=o0.exports,ZB;function Cue(){return ZB||(ZB=1,(function(t,r){(function(s,c){t.exports=c()})(Iue,(function(){var s,c,m;function v(o,M){if(!s)s=M;else if(!c)c=M;else{var R="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",B={};s(B),m=M(B),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([R],{type:"text/javascript"})))}}v(["exports"],(function(o){var M=1e-6,R=typeof Float32Array<"u"?Float32Array:Array;function B(a,e){var i=e[0],u=e[1],h=e[2],p=e[3],g=i*p-h*u;return g?(a[0]=p*(g=1/g),a[1]=-u*g,a[2]=-h*g,a[3]=i*g,a):null}function F(){var a=new R(9);return R!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function G(a,e){var i=e[0],u=e[1],h=e[2],p=e[3],g=e[4],w=e[5],E=e[6],P=e[7],O=e[8];return a[0]=g*O-w*P,a[1]=h*P-u*O,a[2]=u*w-h*g,a[3]=w*E-p*O,a[4]=i*O-h*E,a[5]=h*p-i*w,a[6]=p*P-g*E,a[7]=u*E-i*P,a[8]=i*g-u*p,a}function K(a,e,i){var u=e[0],h=e[1],p=e[2],g=e[3],w=e[4],E=e[5],P=e[6],O=e[7],D=e[8],L=i[0],U=i[1],$=i[2],X=i[3],J=i[4],ie=i[5],de=i[6],he=i[7],ge=i[8];return a[0]=L*u+U*g+$*P,a[1]=L*h+U*w+$*O,a[2]=L*p+U*E+$*D,a[3]=X*u+J*g+ie*P,a[4]=X*h+J*w+ie*O,a[5]=X*p+J*E+ie*D,a[6]=de*u+he*g+ge*P,a[7]=de*h+he*w+ge*O,a[8]=de*p+he*E+ge*D,a}function ee(){var a=new R(16);return R!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function H(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Z(a,e){var i=e[0],u=e[1],h=e[2],p=e[3],g=e[4],w=e[5],E=e[6],P=e[7],O=e[8],D=e[9],L=e[10],U=e[11],$=e[12],X=e[13],J=e[14],ie=e[15],de=i*w-u*g,he=i*E-h*g,ge=i*P-p*g,Fe=u*E-h*w,Me=u*P-p*w,Oe=h*P-p*E,je=O*X-D*$,Ue=O*J-L*$,ut=O*ie-U*$,Ze=D*J-L*X,_t=D*ie-U*X,qt=L*ie-U*J,Et=de*qt-he*_t+ge*Ze+Fe*ut-Me*Ue+Oe*je;return Et?(a[0]=(w*qt-E*_t+P*Ze)*(Et=1/Et),a[1]=(h*_t-u*qt-p*Ze)*Et,a[2]=(X*Oe-J*Me+ie*Fe)*Et,a[3]=(L*Me-D*Oe-U*Fe)*Et,a[4]=(E*ut-g*qt-P*Ue)*Et,a[5]=(i*qt-h*ut+p*Ue)*Et,a[6]=(J*ge-$*Oe-ie*he)*Et,a[7]=(O*Oe-L*ge+U*he)*Et,a[8]=(g*_t-w*ut+P*je)*Et,a[9]=(u*ut-i*_t-p*je)*Et,a[10]=($*Me-X*ge+ie*de)*Et,a[11]=(D*ge-O*Me-U*de)*Et,a[12]=(w*Ue-g*Ze-E*je)*Et,a[13]=(i*Ze-u*Ue+h*je)*Et,a[14]=(X*he-$*Fe-J*de)*Et,a[15]=(O*Fe-D*he+L*de)*Et,a):null}function ae(a,e,i){var u=e[0],h=e[1],p=e[2],g=e[3],w=e[4],E=e[5],P=e[6],O=e[7],D=e[8],L=e[9],U=e[10],$=e[11],X=e[12],J=e[13],ie=e[14],de=e[15],he=i[0],ge=i[1],Fe=i[2],Me=i[3];return a[0]=he*u+ge*w+Fe*D+Me*X,a[1]=he*h+ge*E+Fe*L+Me*J,a[2]=he*p+ge*P+Fe*U+Me*ie,a[3]=he*g+ge*O+Fe*$+Me*de,a[4]=(he=i[4])*u+(ge=i[5])*w+(Fe=i[6])*D+(Me=i[7])*X,a[5]=he*h+ge*E+Fe*L+Me*J,a[6]=he*p+ge*P+Fe*U+Me*ie,a[7]=he*g+ge*O+Fe*$+Me*de,a[8]=(he=i[8])*u+(ge=i[9])*w+(Fe=i[10])*D+(Me=i[11])*X,a[9]=he*h+ge*E+Fe*L+Me*J,a[10]=he*p+ge*P+Fe*U+Me*ie,a[11]=he*g+ge*O+Fe*$+Me*de,a[12]=(he=i[12])*u+(ge=i[13])*w+(Fe=i[14])*D+(Me=i[15])*X,a[13]=he*h+ge*E+Fe*L+Me*J,a[14]=he*p+ge*P+Fe*U+Me*ie,a[15]=he*g+ge*O+Fe*$+Me*de,a}function fe(a,e,i){var u,h,p,g,w,E,P,O,D,L,U,$,X=i[0],J=i[1],ie=i[2];return e===a?(a[12]=e[0]*X+e[4]*J+e[8]*ie+e[12],a[13]=e[1]*X+e[5]*J+e[9]*ie+e[13],a[14]=e[2]*X+e[6]*J+e[10]*ie+e[14],a[15]=e[3]*X+e[7]*J+e[11]*ie+e[15]):(h=e[1],p=e[2],g=e[3],w=e[4],E=e[5],P=e[6],O=e[7],D=e[8],L=e[9],U=e[10],$=e[11],a[0]=u=e[0],a[1]=h,a[2]=p,a[3]=g,a[4]=w,a[5]=E,a[6]=P,a[7]=O,a[8]=D,a[9]=L,a[10]=U,a[11]=$,a[12]=u*X+w*J+D*ie+e[12],a[13]=h*X+E*J+L*ie+e[13],a[14]=p*X+P*J+U*ie+e[14],a[15]=g*X+O*J+$*ie+e[15]),a}function ue(a,e,i){var u=i[0],h=i[1],p=i[2];return a[0]=e[0]*u,a[1]=e[1]*u,a[2]=e[2]*u,a[3]=e[3]*u,a[4]=e[4]*h,a[5]=e[5]*h,a[6]=e[6]*h,a[7]=e[7]*h,a[8]=e[8]*p,a[9]=e[9]*p,a[10]=e[10]*p,a[11]=e[11]*p,a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15],a}function _e(a,e,i){var u=Math.sin(i),h=Math.cos(i),p=e[4],g=e[5],w=e[6],E=e[7],P=e[8],O=e[9],D=e[10],L=e[11];return e!==a&&(a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[3],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[4]=p*h+P*u,a[5]=g*h+O*u,a[6]=w*h+D*u,a[7]=E*h+L*u,a[8]=P*h-p*u,a[9]=O*h-g*u,a[10]=D*h-w*u,a[11]=L*h-E*u,a}function le(a,e,i){var u=Math.sin(i),h=Math.cos(i),p=e[0],g=e[1],w=e[2],E=e[3],P=e[8],O=e[9],D=e[10],L=e[11];return e!==a&&(a[4]=e[4],a[5]=e[5],a[6]=e[6],a[7]=e[7],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[0]=p*h-P*u,a[1]=g*h-O*u,a[2]=w*h-D*u,a[3]=E*h-L*u,a[8]=p*u+P*h,a[9]=g*u+O*h,a[10]=w*u+D*h,a[11]=E*u+L*h,a}function pe(a,e,i){var u=Math.sin(i),h=Math.cos(i),p=e[0],g=e[1],w=e[2],E=e[3],P=e[4],O=e[5],D=e[6],L=e[7];return e!==a&&(a[8]=e[8],a[9]=e[9],a[10]=e[10],a[11]=e[11],a[12]=e[12],a[13]=e[13],a[14]=e[14],a[15]=e[15]),a[0]=p*h+P*u,a[1]=g*h+O*u,a[2]=w*h+D*u,a[3]=E*h+L*u,a[4]=P*h-p*u,a[5]=O*h-g*u,a[6]=D*h-w*u,a[7]=L*h-E*u,a}function Te(a,e){return a[0]=e[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=e[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=e[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function De(a,e,i){var u,h,p,g=i[0],w=i[1],E=i[2],P=Math.hypot(g,w,E);return P<M?null:(g*=P=1/P,w*=P,E*=P,u=Math.sin(e),h=Math.cos(e),a[0]=g*g*(p=1-h)+h,a[1]=w*g*p+E*u,a[2]=E*g*p-w*u,a[3]=0,a[4]=g*w*p-E*u,a[5]=w*w*p+h,a[6]=E*w*p+g*u,a[7]=0,a[8]=g*E*p+w*u,a[9]=w*E*p-g*u,a[10]=E*E*p+h,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function Xe(a,e){var i=e[0],u=e[1],h=e[2],p=e[3],g=i+i,w=u+u,E=h+h,P=i*g,O=u*g,D=u*w,L=h*g,U=h*w,$=h*E,X=p*g,J=p*w,ie=p*E;return a[0]=1-D-$,a[1]=O+ie,a[2]=L-J,a[3]=0,a[4]=O-ie,a[5]=1-P-$,a[6]=U+X,a[7]=0,a[8]=L+J,a[9]=U-X,a[10]=1-P-D,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}Math.hypot||(Math.hypot=function(){for(var a=0,e=arguments.length;e--;)a+=arguments[e]*arguments[e];return Math.sqrt(a)});var wt=ae;function $e(){var a=new R(3);return R!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function vt(a){var e=new R(3);return e[0]=a[0],e[1]=a[1],e[2]=a[2],e}function ft(a){return Math.hypot(a[0],a[1],a[2])}function bt(a,e,i){var u=new R(3);return u[0]=a,u[1]=e,u[2]=i,u}function St(a,e,i,u){return a[0]=e,a[1]=i,a[2]=u,a}function gt(a,e,i){return a[0]=e[0]+i[0],a[1]=e[1]+i[1],a[2]=e[2]+i[2],a}function Rt(a,e,i){return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],a}function Ke(a,e,i){return a[0]=e[0]*i[0],a[1]=e[1]*i[1],a[2]=e[2]*i[2],a}function yt(a,e,i){return a[0]=Math.min(e[0],i[0]),a[1]=Math.min(e[1],i[1]),a[2]=Math.min(e[2],i[2]),a}function Vt(a,e,i){return a[0]=Math.max(e[0],i[0]),a[1]=Math.max(e[1],i[1]),a[2]=Math.max(e[2],i[2]),a}function qe(a,e,i){return a[0]=e[0]*i,a[1]=e[1]*i,a[2]=e[2]*i,a}function mt(a,e,i,u){return a[0]=e[0]+i[0]*u,a[1]=e[1]+i[1]*u,a[2]=e[2]+i[2]*u,a}function ar(a,e){var i=e[0]-a[0],u=e[1]-a[1],h=e[2]-a[2];return i*i+u*u+h*h}function Mr(a){var e=a[0],i=a[1],u=a[2];return e*e+i*i+u*u}function Gr(a,e){return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a}function Tr(a,e){var i=e[0],u=e[1],h=e[2],p=i*i+u*u+h*h;return p>0&&(p=1/Math.sqrt(p)),a[0]=e[0]*p,a[1]=e[1]*p,a[2]=e[2]*p,a}function vr(a,e){return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]}function Br(a,e,i){var u=e[0],h=e[1],p=e[2],g=i[0],w=i[1],E=i[2];return a[0]=h*E-p*w,a[1]=p*g-u*E,a[2]=u*w-h*g,a}function or(a,e,i,u){var h=e[0],p=e[1],g=e[2];return a[0]=h+u*(i[0]-h),a[1]=p+u*(i[1]-p),a[2]=g+u*(i[2]-g),a}function Ar(a,e,i){var u=e[0],h=e[1],p=e[2],g=i[3]*u+i[7]*h+i[11]*p+i[15];return a[0]=(i[0]*u+i[4]*h+i[8]*p+i[12])/(g=g||1),a[1]=(i[1]*u+i[5]*h+i[9]*p+i[13])/g,a[2]=(i[2]*u+i[6]*h+i[10]*p+i[14])/g,a}function un(a,e,i){var u=e[0],h=e[1],p=e[2];return a[0]=u*i[0]+h*i[3]+p*i[6],a[1]=u*i[1]+h*i[4]+p*i[7],a[2]=u*i[2]+h*i[5]+p*i[8],a}function sr(a,e,i){var u=i[0],h=i[1],p=i[2],g=e[0],w=e[1],E=e[2],P=h*E-p*w,O=p*g-u*E,D=u*w-h*g,L=h*D-p*O,U=p*P-u*D,$=u*O-h*P,X=2*i[3];return O*=X,D*=X,U*=2,$*=2,a[0]=g+(P*=X)+(L*=2),a[1]=w+O+U,a[2]=E+D+$,a}function ui(a){return a[0]=0,a[1]=0,a[2]=0,a}function Rn(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]}var In=Rt,hi=Ke,Yi=ft;function Sa(){var a=new R(4);return R!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function qo(a,e,i){return a[0]=e[0]*i,a[1]=e[1]*i,a[2]=e[2]*i,a[3]=e[3]*i,a}function po(a,e){var i=e[0],u=e[1],h=e[2],p=e[3],g=i*i+u*u+h*h+p*p;return g>0&&(g=1/Math.sqrt(g)),a[0]=i*g,a[1]=u*g,a[2]=h*g,a[3]=p*g,a}function Vi(a,e,i){var u=e[0],h=e[1],p=e[2],g=e[3];return a[0]=i[0]*u+i[4]*h+i[8]*p+i[12]*g,a[1]=i[1]*u+i[5]*h+i[9]*p+i[13]*g,a[2]=i[2]*u+i[6]*h+i[10]*p+i[14]*g,a[3]=i[3]*u+i[7]*h+i[11]*p+i[15]*g,a}function Bo(){var a=new R(4);return R!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Ba(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Os(a,e,i){i*=.5;var u=e[0],h=e[1],p=e[2],g=e[3],w=Math.sin(i),E=Math.cos(i);return a[0]=u*E+g*w,a[1]=h*E+p*w,a[2]=p*E-h*w,a[3]=g*E-u*w,a}function tl(a,e,i){i*=.5;var u=e[0],h=e[1],p=e[2],g=e[3],w=Math.sin(i),E=Math.cos(i);return a[0]=u*E-p*w,a[1]=h*E+g*w,a[2]=p*E+u*w,a[3]=g*E-h*w,a}$e(),Sa();var ca,Ta,ic,rl=po,nl=(ca=$e(),Ta=bt(1,0,0),ic=bt(0,1,0),function(a,e,i){var u=vr(e,i);return u<-.999999?(Br(ca,Ta,e),Yi(ca)<1e-6&&Br(ca,ic,e),Tr(ca,ca),(function(h,p,g){g*=.5;var w=Math.sin(g);h[0]=w*p[0],h[1]=w*p[1],h[2]=w*p[2],h[3]=Math.cos(g)})(a,ca,Math.PI),a):u>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(Br(ca,e,i),a[0]=ca[0],a[1]=ca[1],a[2]=ca[2],a[3]=1+u,rl(a,a))});function xo(){var a=new R(2);return R!=Float32Array&&(a[0]=0,a[1]=0),a}function rs(a,e){var i=new R(2);return i[0]=a,i[1]=e,i}function Al(a,e,i){return a[0]=e[0]+i[0],a[1]=e[1]+i[1],a}function il(a,e,i){return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a}function oc(a,e,i){return a[0]=e[0]*i,a[1]=e[1]*i,a}function ol(a){return Math.hypot(a[0],a[1])}function ac(a,e){var i=e[0],u=e[1],h=i*i+u*u;return h>0&&(h=1/Math.sqrt(h)),a[0]=e[0]*h,a[1]=e[1]*h,a}function ii(a,e){return a[0]*e[0]+a[1]*e[1]}Bo(),Bo(),F();var Jc,Qc,Go=il;function al(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}xo();var pd=(function(){if(Qc)return Jc;function a(e,i,u,h){this.cx=3*e,this.bx=3*(u-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=u,this.p2y=h}return Qc=1,Jc=a,a.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var u=e,h=0;h<8;h++){var p=this.sampleCurveX(u)-e;if(Math.abs(p)<i)return u;var g=this.sampleCurveDerivativeX(u);if(Math.abs(g)<1e-6)break;u-=p/g}var w=0,E=1;for(u=e,h=0;h<20&&(p=this.sampleCurveX(u),!(Math.abs(p-e)<i));h++)e>p?w=u:E=u,u=.5*(E-w)+w;return u},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Jc})(),eu=al(pd);function kt(a,e){this.x=a,this.y=e}function sl(a,e){if(Array.isArray(a)){if(!Array.isArray(e)||a.length!==e.length)return!1;for(let i=0;i<a.length;i++)if(!sl(a[i],e[i]))return!1;return!0}if(typeof a=="object"&&a!==null&&e!==null){if(typeof e!="object"||Object.keys(a).length!==Object.keys(e).length)return!1;for(const i in a)if(!sl(a[i],e[i]))return!1;return!0}return a===e}kt.prototype={clone(){return new kt(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,e){return this.clone()._rotateAround(a,e)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const e=a.x-this.x,i=a.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,e){return Math.atan2(this.x*e-this.y*a,this.x*a+this.y*e)},_matMult(a){const e=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=e,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const e=Math.cos(a),i=Math.sin(a),u=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=u,this},_rotateAround(a,e){const i=Math.cos(a),u=Math.sin(a),h=e.y+u*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-u*(this.y-e.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:kt},kt.convert=function(a){if(a instanceof kt)return a;if(Array.isArray(a))return new kt(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new kt(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};const md=Math.PI/180,tu=180/Math.PI;function Cn(a){return a*md}function et(a){return a*tu}const oe=[[0,0],[1,0],[1,1],[0,1]];function se(a){if(a<=0)return 0;if(a>=1)return 1;const e=a*a,i=e*a;return 4*(a<.5?i:3*(a-e)+i-.75)}function be(a,e,i,u){const h=new eu(a,e,i,u);return function(p){return h.solve(p)}}const ke=be(.25,.1,.25,1);function we(a,e,i){return Math.min(i,Math.max(e,a))}function Ne(a,e,i){return(i=we((i-a)/(e-a),0,1))*i*(3-2*i)}function it(a,e,i){const u=i-e,h=((a-e)%u+u)%u+e;return h===e?i:h}function Ve(a,e,i){if(!a.length)return i(null,[]);let u=a.length;const h=new Array(a.length);let p=null;a.forEach(((g,w)=>{e(g,((E,P)=>{E&&(p=E),h[w]=P,--u==0&&i(p,h)}))}))}function nt(a,...e){for(const i of e)for(const u in i)a[u]=i[u];return a}let $t=1;function Tt(){return $t++}function xr(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Or(a,e){a.forEach((i=>{e[i]&&(e[i]=e[i].bind(e))}))}function Nr(a,e,i){const u={};for(const h in a)u[h]=e.call(this,a[h],h,a);return u}function ln(a,e,i){const u={};for(const h in a)e.call(this,a[h],h,a)&&(u[h]=a[h]);return u}function Jr(a){return Array.isArray(a)?a.map(Jr):typeof a=="object"&&a?Nr(a,Jr):a}function hn(a,e){for(let i=0;i<a.length;i++)if(e.indexOf(a[i])>=0)return!0;return!1}const Yn={};function fn(a){Yn[a]||(typeof console<"u"&&console.warn(a),Yn[a]=!0)}function Fi(a,e,i){return(i.y-a.y)*(e.x-a.x)>(e.y-a.y)*(i.x-a.x)}function $n(a){let e=0;for(let i,u,h=0,p=a.length,g=p-1;h<p;g=h++)i=a[h],u=a[g],e+=(u.x-i.x)*(i.y+u.y);return e}function ro([a,e,i]){const u=Cn(e+90),h=Cn(i);return{x:a*Math.cos(u)*Math.sin(h),y:a*Math.sin(u)*Math.sin(h),z:a*Math.cos(h),azimuthal:e,polar:i}}function qn(a){return(typeof self<"u"||a!==void 0)&&typeof WorkerGlobalScope<"u"&&(a!==void 0?a:self)instanceof WorkerGlobalScope}function Dn(a){const e={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,u,h,p)=>{const g=h||p;return e[u]=!g||g.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let wi=null;function Ei(a,e){return[a[4*e],a[4*e+1],a[4*e+2],a[4*e+3]]}function _i(a,e,i,u){for(;e<i;){const h=e+i>>1;a[h]<u?e=h+1:i=h}return e}function ao(a,e,i,u){for(;e<i;){const h=e+i>>1;a[h]<=u?e=h+1:i=h}return e}function no(a){return a>0?1/(1.001-a):1+a}function ea(a){return a>0?1-1/(1.001-a):-a}function Ea(a,e,i){return(a-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const No={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!No.API_URL)return null;try{const a=new URL(No.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.1.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function sc(a){return No.API_URL_REGEX.test(a)}function gd(a){return No.API_SPRITE_REGEX.test(a)}let lc,cc,uc,ru,nu,ef;function Ju(){return lc==null&&(lc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),lc}const ps={now:()=>ru!==void 0?ru:performance.now(),setNow(a){ru=a},restoreNow(){ru=void 0},frame(a){const e=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(a,e=0){const{width:i,height:u}=a;nu||(nu=document.createElement("canvas"));const h=nu.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>nu.width||u>nu.height)&&(nu.width=i,nu.height=u),h.clearRect(-e,-e,i+2*e,u+2*e),h.drawImage(a,0,0,i,u),h.getImageData(-e,-e,i+2*e,u+2*e)},resolveURL:a=>(cc||(cc=document.createElement("a")),cc.href=a,cc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(uc==null&&(uc=window.matchMedia("(prefers-reduced-motion: reduce)")),uc.matches)},hasCanvasFingerprintNoise(){if(ef!==void 0)return ef;if(!Ju())return ef=!1,!1;const a=new OffscreenCanvas(85,1),e=a.getContext("2d",{willReadFrequently:!0});let i=0;for(let h=0;h<a.width;++h)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(h,0,1,1);const u=e.getImageData(0,0,a.width,a.height);i=0;for(let h=0;h<u.data.length;++h)if(h%4!=3&&i++!==u.data[h])return ef=!0,!0;return ef=!1,!1}};function Aa(a,e){const i=a.indexOf("?");if(i<0)return`${a}?${new URLSearchParams(e).toString()}`;const u=new URLSearchParams(a.slice(i));for(const h in e)u.set(h,e[h]);return`${a.slice(0,i)}?${u.toString()}`}function ua(a,e={persistentParams:[]}){const i=a.indexOf("?");if(i<0)return a;const u=new URLSearchParams,h=new URLSearchParams(a.slice(i));for(const g of e.persistentParams){const w=h.get(g);w&&u.set(g,w)}const p=u.toString();return`${a.slice(0,i)}${p.length>0?`?${p}`:""}`}const Pl="mapbox-tiles";let ns=500,oi=50;const Qu=["language","worldview","jobid"];let Rs,iu;function hc(){try{return caches}catch{}}function ou(){const a=hc();a&&Rs==null&&(Rs=a.open(Pl))}let _d=1/0;const tf={supported:!1,testSupport:function(a){!ms&&Na&&(is?th(a):Ho=a)}};let Ho,Na,ms=!1,is=!1;const eh=typeof self<"u"?self:{};function th(a){const e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,Na),a.isContextLost())return;tf.supported=!0}catch{}a.deleteTexture(e),ms=!0}eh.document&&(Na=eh.document.createElement("img"),Na.onload=function(){Ho&&th(Ho),Ho=null,is=!0},Na.onerror=function(){ms=!0,Ho=null},Na.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const gs={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(gs);class bn extends Error{constructor(e,i,u){i===401&&sc(u)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const rf=qn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ll=function(a,e){if(!(/^file:/.test(i=a.url)||/^file:/.test(rf())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(u,h){const p=new AbortController,g=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:rf(),referrerPolicy:u.referrerPolicy,signal:p.signal});let w=!1,E=!1;const P=(O=g.url).indexOf("sku=")>0&&sc(O);var O;u.type==="json"&&g.headers.set("Accept","application/json");const D=(U,$,X)=>{if(E)return;if(U&&U.message!=="SecurityError"&&fn(U.toString()),$&&X)return L($);const J=Date.now();fetch(g).then((ie=>{if(ie.ok){const de=P?ie.clone():null;return L(ie,de,J)}return h(new bn(ie.statusText,ie.status,u.url))})).catch((ie=>{ie.name!=="AbortError"&&h(new Error(`${ie.message} ${u.url}`))}))},L=(U,$,X)=>{(u.type==="arrayBuffer"?U.arrayBuffer():u.type==="json"?U.json():U.text()).then((J=>{E||($&&X&&(function(ie,de,he){if(ou(),Rs==null)return;const ge=Dn(de.headers.get("Cache-Control")||"");if(ge["no-store"])return;const Fe={status:de.status,statusText:de.statusText,headers:new Headers};de.headers.forEach(((je,Ue)=>Fe.headers.set(Ue,je))),ge["max-age"]&&Fe.headers.set("Expires",new Date(he+1e3*ge["max-age"]).toUTCString());const Me=Fe.headers.get("Expires");if(!Me||new Date(Me).getTime()-he<42e4)return;let Oe=ua(ie.url,{persistentParams:Qu});if(de.status===206){const je=ie.headers.get("Range");if(!je)return;Fe.status=200,Oe=Aa(Oe,{range:je})}(function(je,Ue){if(iu===void 0)try{new Response(new ReadableStream),iu=!0}catch{iu=!1}iu?Ue(je.body):je.blob().then(Ue).catch((ut=>fn(ut.message)))})(de,(je=>{const Ue=new Response((ut=de.status)!==200&&ut!==404&&[101,103,204,205,304].includes(ut)?null:je,Fe);var ut;ou(),Rs?.then((Ze=>Ze.put(Oe,Ue))).catch((Ze=>fn(Ze.message)))}))})(g,$,X),w=!0,h(null,J,U.headers.get("Cache-Control"),U.headers.get("Expires")))})).catch((J=>{E||h(new Error(J.message))}))};return P?(function(U,$){if(ou(),Rs==null)return $(null);Rs.then((X=>{let J=ua(U.url,{persistentParams:Qu});const ie=U.headers.get("Range");ie&&(J=Aa(J,{range:ie})),X.match(J).then((de=>{const he=(function(ge){if(!ge)return!1;const Fe=new Date(ge.headers.get("Expires")||0),Me=Dn(ge.headers.get("Cache-Control")||"");return Number(Fe)>Date.now()&&!Me["no-cache"]})(de);X.delete(J).catch($),he&&X.put(J,de.clone()).catch($),$(null,de,he)})).catch($)})).catch($)})(g,D):D(null,null),{cancel:()=>{E=!0,w||p.abort()}}})(a,e);if(qn(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,e,void 0,!0)}var i;return(function(u,h){const p=new XMLHttpRequest;p.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const g in u.headers)p.setRequestHeader(g,u.headers[g]);return u.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=u.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let g=p.response;if(u.type==="json")try{g=JSON.parse(p.response)}catch(w){return h(w)}h(null,g,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new bn(p.statusText,p.status,u.url))},p.send(u.body),{cancel:()=>p.abort()}})(a,e)},nf=function(a,e){return ll(nt(a,{type:"arrayBuffer"}),e)};function Hm(a){const e=document.createElement("a");return e.href=a,e.protocol===location.protocol&&e.host===location.host}const fc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let dc,pc;dc=[],pc=0;const Il=function(a,e){if(tf.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),pc>=No.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:a,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return dc.push(p),p}pc++;let i=!1;const u=()=>{if(!i)for(i=!0,pc--;dc.length&&pc<No.MAX_PARALLEL_IMAGE_REQUESTS;){const p=dc.shift(),{requestParameters:g,callback:w,cancelled:E}=p;E||(p.cancel=Il(g,w).cancel)}},h=nf(a,((p,g,w,E)=>{u(),p?e(p):g&&(self.createImageBitmap?(function(P,O){const D=new Blob([new Uint8Array(P)],{type:"image/png"});createImageBitmap(D).then((L=>{O(null,L)})).catch((L=>{O(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(g,((P,O)=>e(P,O,w,E))):(function(P,O){const D=new Image;D.onload=()=>{O(null,D),URL.revokeObjectURL(D.src),D.onload=null,requestAnimationFrame((()=>{D.src=fc}))},D.onerror=()=>O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new Blob([new Uint8Array(P)],{type:"image/png"});D.src=P.byteLength?URL.createObjectURL(L):fc})(g,((P,O)=>e(P,O,w,E))))}));return{cancel:()=>{h.cancel(),u()}}};var rh,Cl,of,nh={exports:{}},au={exports:{}},yd={exports:{}},mc=(function(){if(of)return nh.exports;of=1;var a=(rh||(rh=1,au.exports=function(i,u){var h,p,g,w,E,P,O,D;for(p=i.length-(h=3&i.length),g=u,E=3432918353,P=461845907,D=0;D<p;)O=255&i.charCodeAt(D)|(255&i.charCodeAt(++D))<<8|(255&i.charCodeAt(++D))<<16|(255&i.charCodeAt(++D))<<24,++D,g=27492+(65535&(w=5*(65535&(g=(g^=O=(65535&(O=(O=(65535&O)*E+(((O>>>16)*E&65535)<<16)&4294967295)<<15|O>>>17))*P+(((O>>>16)*P&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(O=0,h){case 3:O^=(255&i.charCodeAt(D+2))<<16;case 2:O^=(255&i.charCodeAt(D+1))<<8;case 1:g^=O=(65535&(O=(O=(65535&(O^=255&i.charCodeAt(D)))*E+(((O>>>16)*E&65535)<<16)&4294967295)<<15|O>>>17))*P+(((O>>>16)*P&65535)<<16)&4294967295}return g^=i.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),au.exports),e=(Cl||(Cl=1,yd.exports=function(i,u){for(var h,p=i.length,g=u^p,w=0;p>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(w)|(255&i.charCodeAt(++w))<<8|(255&i.charCodeAt(++w))<<16|(255&i.charCodeAt(++w))<<24))+((1540483477*(h>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++w;switch(p){case 3:g^=(255&i.charCodeAt(w+2))<<16;case 2:g^=(255&i.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&i.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),yd.exports);return nh.exports=a,nh.exports.murmur3=a,nh.exports.murmur2=e,nh.exports})(),gc=al(mc);class cl{constructor(e,...i){nt(this,i[0]||{}),this.type=e}}class Co extends cl{constructor(e,i={}){super("error",nt({error:e},i))}}function af(a,e,i){i[a]&&i[a].indexOf(e)!==-1||(i[a]=i[a]||[],i[a].push(e))}function ih(a,e,i){if(i&&i[a]){const u=i[a].indexOf(e);u!==-1&&i[a].splice(u,1)}}class _c{on(e,i){return this._listeners=this._listeners||{},af(e,i,this._listeners),this}off(e,i){return ih(e,i,this._listeners),ih(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},af(e,i,this._oneTimeListeners),this):new Promise((u=>{this.once(e,u)}))}fire(e,i){const u=typeof e=="string"?new cl(e,i):e,h=u.type;if(this.listens(h)){u.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const E of p)E.call(this,u);const g=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const E of g)ih(h,E,this._oneTimeListeners),E.call(this,u);const w=this._eventedParent;w&&(nt(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(u))}else u instanceof Co&&console.error(u.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class ta{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new ta(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,u]=e.split("");return new ta({name:i,iconsetId:u})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return ta.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var oh,sf={},Pa=(function(){if(oh)return sf;oh=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(p){return(p=Math.round(p))<0?0:p>255?255:p}function i(p){return e(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function u(p){return(g=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:g>1?1:g;var g}function h(p,g,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?p+(g-p)*w*6:2*w<1?g:3*w<2?p+(g-p)*(2/3-w)*6:p}try{sf.parseCSSColor=function(p){var g,w=p.replace(/ /g,"").toLowerCase();if(w in a)return a[w].slice();if(w[0]==="#")return w.length===4?(g=parseInt(w.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:w.length===7&&(g=parseInt(w.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var E=w.indexOf("("),P=w.indexOf(")");if(E!==-1&&P+1===w.length){var O=w.substr(0,E),D=w.substr(E+1,P-(E+1)).split(","),L=1;switch(O){case"rgba":if(D.length!==4)return null;L=u(D.pop());case"rgb":return D.length!==3?null:[i(D[0]),i(D[1]),i(D[2]),L];case"hsla":if(D.length!==4)return null;L=u(D.pop());case"hsl":if(D.length!==3)return null;var U=(parseFloat(D[0])%360+360)%360/360,$=u(D[1]),X=u(D[2]),J=X<=.5?X*($+1):X+$-X*$,ie=2*X-J;return[e(255*h(ie,J,U+1/3)),e(255*h(ie,J,U)),e(255*h(ie,J,U-1/3)),L];default:return null}}return null}}catch{}return sf})();class wn{constructor(e,i,u,h=1){this.r=e,this.g=i,this.b=u,this.a=h}static parse(e){if(!e)return;if(e instanceof wn)return e;if(typeof e!="string")return;const i=Pa.parseCSSColor(e);return i?new wn(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,u,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*u)},${h})`}toNonPremultipliedRenderColor(e){const{r:i,g:u,b:h,a:p}=this;return new ul(e,i,u,h,p)}toPremultipliedRenderColor(e){const{r:i,g:u,b:h,a:p}=this;return new Wm(e,i*p,u*p,h*p,p)}clone(){return new wn(this.r,this.g,this.b,this.a)}}class su{constructor(e,i,u,h,p,g=!1){if(this.premultiplied=!1,this.premultiplied=g,e){const w=e.image.height,E=w*w;this.premultiplied?(i=p===0?0:i/p*(w-1),u=p===0?0:u/p*(w-1),h=p===0?0:h/p*(w-1)):(i*=w-1,u*=w-1,h*=w-1);const P=Math.floor(i),O=Math.floor(u),D=Math.floor(h),L=Math.ceil(i),U=Math.ceil(u),$=Math.ceil(h),X=i-P,J=u-O,ie=h-D,de=e.image.data,he=4*(P+O*E+D*w),ge=4*(P+O*E+$*w),Fe=4*(P+U*E+D*w),Me=4*(P+U*E+$*w),Oe=4*(L+O*E+D*w),je=4*(L+O*E+$*w),Ue=4*(L+U*E+D*w),ut=4*(L+U*E+$*w);if(he<0||ut>=de.length)throw new Error("out of range");this.r=Sr(Sr(Sr(de[he],de[ge],ie),Sr(de[Fe],de[Me],ie),J),Sr(Sr(de[Oe],de[je],ie),Sr(de[Ue],de[ut],ie),J),X)/255*(this.premultiplied?p:1),this.g=Sr(Sr(Sr(de[he+1],de[ge+1],ie),Sr(de[Fe+1],de[Me+1],ie),J),Sr(Sr(de[Oe+1],de[je+1],ie),Sr(de[Ue+1],de[ut+1],ie),J),X)/255*(this.premultiplied?p:1),this.b=Sr(Sr(Sr(de[he+2],de[ge+2],ie),Sr(de[Fe+2],de[Me+2],ie),J),Sr(Sr(de[Oe+2],de[je+2],ie),Sr(de[Ue+2],de[ut+2],ie),J),X)/255*(this.premultiplied?p:1),this.a=p}else this.r=i,this.g=u,this.b=h,this.a=p}toArray(){const{r:e,g:i,b:u,a:h}=this;return[255*e,255*i,255*u,h]}toHslaArray(){let{r:e,g:i,b:u,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];e/=h,i/=h,u/=h}const p=Math.min(Math.max(e,0),1),g=Math.min(Math.max(i,0),1),w=Math.min(Math.max(u,0),1),E=Math.min(p,g,w),P=Math.max(p,g,w),O=(E+P)/2;if(E===P)return[0,0,100*O,h];const D=P-E,L=O>.5?D/(2-P-E):D/(P+E);let U=0;return P===p?U=(g-w)/D+(g<w?6:0):P===g?U=(w-p)/D+2:P===w&&(U=(p-g)/D+4),U*=60,[Math.min(Math.max(U,0),360),Math.min(Math.max(100*L,0),100),Math.min(Math.max(100*O,0),100),h]}toArray01(){const{r:e,g:i,b:u,a:h}=this;return[e,i,u,h]}toArray01Scaled(e){const{r:i,g:u,b:h}=this;return[i*e,u*e,h*e]}toArray01Linear(){const{r:e,g:i,b:u,a:h}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(u,2.2),h]}}class ul extends su{constructor(e,i,u,h,p){super(e,i,u,h,p,!1)}}class Wm extends su{constructor(e,i,u,h,p){super(e,i,u,h,p,!0)}}function Sr(a,e,i){return a*(1-i)+e*i}function vd(a,e,i){return a.map(((u,h)=>Sr(u,e[h],i)))}wn.black=new wn(0,0,0,1),wn.white=new wn(1,1,1,1),wn.transparent=new wn(0,0,0,0),wn.red=new wn(1,0,0,1),wn.blue=new wn(0,0,1,1);var Ml=Object.freeze({__proto__:null,array:vd,color:function(a,e,i){return new wn(Sr(a.r,e.r,i),Sr(a.g,e.g,i),Sr(a.b,e.b,i),Sr(a.a,e.a,i))},number:Sr});function hl(a,...e){for(const i of e)for(const u in i)a[u]=i[u];return a}class ja extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Bp{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[u,h]of i)this.bindings[u]=h}concat(e){return new Bp(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ah={kind:"null"},yr={kind:"number"},kn={kind:"string"},Fn={kind:"boolean"},Ua={kind:"color"},Ol={kind:"object"},Nn={kind:"value"},xd={kind:"collator"},sh={kind:"formatted"},lf={kind:"resolvedImage"};function ra(a,e){return{kind:"array",itemType:a,N:e}}function io(a){if(a.kind==="array"){const e=io(a.itemType);return typeof a.N=="number"?`array<${e}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${e}>`}return a.kind}const I_=[ah,yr,kn,Fn,Ua,sh,Ol,ra(Nn),lf];function yc(a,e){if(e.kind==="error")return null;if(a.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!yc(a.itemType,e.itemType))&&(typeof a.N!="number"||a.N===e.N))return null}else{if(a.kind===e.kind)return null;if(a.kind==="value"){for(const i of I_)if(!yc(i,e))return null}}return`Expected ${io(a)} but found ${io(e)} instead.`}function vc(a,e){return e.some((i=>i.kind===a.kind))}function cf(a,e){return e.some((i=>i==="null"?a===null:i==="array"?Array.isArray(a):i==="object"?a&&!Array.isArray(a)&&typeof a=="object":i===typeof a))}function bd(a,e){return a.kind==="array"&&e.kind==="array"?a.N===e.N&&bd(a.itemType,e.itemType):a.kind===e.kind}class lh{constructor(e,i,u){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class wd{constructor(e,i,u,h,p){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=u,this.fontStack=h,this.textColor=p}}class ha{constructor(e){this.sections=e}static fromString(e){return new ha([new wd(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof ha?e:ha.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const h=i.image.getPrimary().id.toString();e.push(["image",h]);continue}e.push(i.text);const u={};i.fontStack&&(u["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(u["font-scale"]=i.scale),i.textColor&&(u["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(u)}return e}}class Rl{constructor(e,i={}){if(this.id=ta.from(e),this.options=Object.assign({},i),i.transform){const{a:u,b:h,c:p,d:g,e:w,f:E}=i.transform;this.options.transform=new DOMMatrix([u,h,p,g,w,E])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:u,d:h,e:p,f:g}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:u,d:h,e:p,f:g}})}static parse(e){let i,u,h,p;try{({name:i,iconsetId:u,params:h,transform:p}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:g,b:w,c:E,d:P,e:O,f:D}=p||{};return new Rl({name:i,iconsetId:u},{params:h,transform:new DOMMatrix([g,w,E,P,O,D])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class Ia{constructor(e,i,u,h,p=!1){this.primaryId=ta.from(e),this.primaryOptions=i,u&&(this.secondaryId=ta.from(u)),this.secondaryOptions=h,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Rl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Rl(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Ia.build({name:e}):e}static build(e,i,u,h){return!e||typeof e=="object"&&!("name"in e)?null:new Ia(e,u,i,h)}}function lu(a,e,i,u){return typeof a=="number"&&a>=0&&a<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[a,e,i,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[a,e,i,u]:[a,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Wr(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof wn||a instanceof lh||a instanceof ha||a instanceof Ia)return!0;if(Array.isArray(a)){for(const e of a)if(!Wr(e))return!1;return!0}if(typeof a=="object"){for(const e in a)if(!Wr(a[e]))return!1;return!0}return!1}function er(a){if(a===null)return ah;if(typeof a=="string")return kn;if(typeof a=="boolean")return Fn;if(typeof a=="number")return yr;if(a instanceof wn)return Ua;if(a instanceof lh)return xd;if(a instanceof ha)return sh;if(a instanceof Ia)return lf;if(Array.isArray(a)){const e=a.length;let i;for(const u of a){const h=er(u);if(i){if(i===h)continue;i=Nn;break}i=h}return ra(i||Nn,e)}return Ol}function Va(a){const e=typeof a;return a===null?"":e==="string"||e==="number"||e==="boolean"?String(a):a instanceof ha||a instanceof Ia||a instanceof wn?a.toString():JSON.stringify(a)}class Ir{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Wr(e[1]))return i.error("invalid value");const u=e[1];let h=er(u);const p=i.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new Ir(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof wn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ha?this.value.serialize():this.value}}class Ji{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const ch={string:kn,number:yr,boolean:Fn,object:Ol};class Er{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let u,h=1;const p=e[0];if(p==="array"){let w,E;if(e.length>2){const P=e[1];if(typeof P!="string"||!(P in ch)||P==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);w=ch[P],h++}else w=Nn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);E=e[2],h++}u=ra(w,E)}else u=ch[p];const g=[];for(;h<e.length;h++){const w=i.parse(e[h],h,Nn);if(!w)return null;g.push(w)}return new Er(u,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const u=this.args[i].evaluate(e);if(!yc(this.type,er(u)))return u;if(i===this.args.length-1)throw new Ji(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${io(er(u))} but was expected to be of type ${io(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const u=e.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){i.push(u.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map((u=>u.serialize())))}}class cu{constructor(e){this.type=sh,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const u=e[1];if(!Array.isArray(u)&&typeof u=="object")return i.error("First argument must be an image or text section.");const h=[];let p=!1;for(let g=1;g<=e.length-1;++g){const w=e[g];if(p&&typeof w=="object"&&!Array.isArray(w)){p=!1;let E=null;if(w["font-scale"]&&(E=i.parseObjectValue(w["font-scale"],g,"font-scale",yr),!E))return null;let P=null;if(w["text-font"]&&(P=i.parseObjectValue(w["text-font"],g,"text-font",ra(kn)),!P))return null;let O=null;if(w["text-color"]&&(O=i.parseObjectValue(w["text-color"],g,"text-color",Ua),!O))return null;const D=h[h.length-1];D.scale=E,D.font=P,D.textColor=O}else{const E=i.parse(e[g],g,Nn);if(!E)return null;const P=E.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:E,scale:null,font:null,textColor:null})}}return new cu(h)}evaluate(e){return new ha(this.sections.map((i=>{const u=i.content.evaluate(e);return bd(er(u),lf)?new wd("",u,null,null,null):new wd(Va(u),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const u={};i.scale&&(u["font-scale"]=i.scale.serialize()),i.font&&(u["text-font"]=i.font.serialize()),i.textColor&&(u["text-color"]=i.textColor.serialize()),e.push(u)}return e}}class uu{constructor(e,i,u,h){this._imageWarnHistory={},this.type=lf,this.namePrimary=e,this.nameSecondary=i,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let u=1;const h=[];function p(){if(u<e.length){const w=i.parse(e[u],u++,kn);return w?(h.push({image:w,options:{}}),!0):(i.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(u<e.length){const E=e[u];if((w=E)===null||typeof w!="object"||Array.isArray(w))return!0;const P=E.params,O=E.iconset,D=i.concat(u);if(!P&&!O)return u++,!0;if(P){if(typeof P!="object"||P.constructor!==Object)return D.error('Image options "params" should be an object'),!1;const L={},U=D.concat(void 0,"params");for(const $ in P){if(!$)return U.error("Image parameter name should be non-empty"),!1;const X=U.concat(void 0,$).parse(P[$],void 0,Ua,void 0,{typeAnnotation:"coerce"});if(!X)return!1;L[$]=X}h[h.length-1].options.params=L}if(O){if(typeof O!="object"||O.constructor!==Object)return D.error('Image options "iconset" should be an object'),!1;if(!O.id)return D.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=O}return u++,!0}var w;return!0}for(let w=0;w<2;w++)if(!p()||!g())return;return new uu(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(e,i){const u={};if(i){for(const h in i)if(i[h])try{u[h]=i[h].evaluate(e)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,h=Ia.build(i,u,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(h&&e.availableImages){const p=h.getPrimary().id;if(h.available=e.availableImages.some((g=>ta.isEqual(g,p))),h.available){const g=h.getSecondary()?h.getSecondary().id:null;g&&(h.available=e.availableImages.some((w=>ta.isEqual(w,g))))}}return h}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const u={};if(i&&(u.iconset={id:i}),e){u.params={};for(const h in e)e[h]&&(u.params[h]=e[h].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Dl(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}const hu={"to-boolean":Fn,"to-color":Ua,"to-number":yr,"to-string":kn};class _s{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const u=e[0],h=[];let p=ah;if(u==="to-array"){if(!Array.isArray(e[1]))return null;const g=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);p=ra(i.expectedType.itemType,g)}else{if(!(g>0&&Wr(e[1][0])))return null;p=ra(er(e[1][0]),g)}for(let w=0;w<g;w++){const E=e[1][w];let P;if(Dl(E)==="array")P=i.parse(E,void 0,p.itemType);else{const O=Dl(E);if(O!==p.itemType.kind)return i.error(`Expected ${p.itemType.kind} but found ${O}.`);P=i.registry.literal.parse(["literal",E===void 0?null:E],i)}if(!P)return null;h.push(P)}}else{if((u==="to-boolean"||u==="to-string")&&e.length!==2)return i.error("Expected one argument.");p=hu[u];for(let g=1;g<e.length;g++){const w=i.parse(e[g],g,Nn);if(!w)return null;h.push(w)}}return new _s(p,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,u;for(const h of this.args){if(i=h.evaluate(e),u=null,i instanceof wn)return i;if(typeof i=="string"){const p=e.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(u=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:lu(i[0],i[1],i[2],i[3]),!u))return new wn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ji(u||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const u of this.args){if(i=u.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new Ji(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ha.fromString(Va(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ia.build(Va(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((i=>i.evaluate(e))):Va(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new cu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new uu(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((i=>{e.push(i.serialize())})),e}}const fa=["Unknown","Point","LineString","Polygon"];class uf{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?fa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*i-e[0])+this.featureDistanceData.bearing[1]*(h*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=wn.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class bo{constructor(e,i,u,h,p){this.name=e,this.type=i,this._evaluate=u,this.args=h,this._overloadIndex=p}evaluate(e){if(!this._evaluate){const i=bo.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,i){const u=e[0],h=bo.definitions[u];if(!h)return i.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,g=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,w=[];let E=null,P=-1;for(const[O,D]of g){if(Array.isArray(O)&&O.length!==e.length-1)continue;w.push(O),P++,E=new vh(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const L=[];let U=!1;for(let $=1;$<e.length;$++){const X=e[$],J=Array.isArray(O)?O[$-1]:O.type,ie=E.parse(X,1+L.length,J);if(!ie){U=!0;break}L.push(ie)}if(!U)if(Array.isArray(O)&&O.length!==L.length)E.error(`Expected ${O.length} arguments, but found ${L.length} instead.`);else{for(let $=0;$<L.length;$++){const X=Array.isArray(O)?O[$]:O.type,J=L[$];E.concat($+1).checkSubtype(X,J.type)}if(E.errors.length===0)return new bo(u,p,D,L,P)}}if(w.length===1)i.errors.push(...E.errors);else{const O=(w.length?w:g.map((([L])=>L))).map(Sd).join(" | "),D=[];for(let L=1;L<e.length;L++){const U=i.parse(e[L],1+D.length);if(!U)return null;D.push(io(U.type))}i.error(`Expected arguments of type ${O}, but found (${D.join(", ")}) instead.`)}return null}static register(e,i){bo.definitions=i;for(const u in i)e[u]=bo}}function Sd(a){return Array.isArray(a)?`(${a.map(io).join(", ")})`:`(${io(a.type)}...)`}class $a{constructor(e,i,u){this.type=xd,this.locale=u,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const u=e[1];if(typeof u!="object"||Array.isArray(u))return i.error("Collator options argument must be an object.");const h=u["case-sensitive"]===void 0?i.parse(!1,1,Fn):i.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Fn);if(!h)return null;const p=u["diacritic-sensitive"]===void 0?i.parse(!1,1,Fn):i.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Fn);if(!p)return null;let g=null;return u.locale&&(g=i.parseObjectValue(u.locale,1,"locale",kn),!g)?null:new $a(h,p,g)}evaluate(e){return new lh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function wo(a,e,i=0,u=a.length-1,h=Td){for(;u>i;){if(u-i>600){const E=u-i+1,P=e-i+1,O=Math.log(E),D=.5*Math.exp(2*O/3),L=.5*Math.sqrt(O*D*(E-D)/E)*(P-E/2<0?-1:1);wo(a,e,Math.max(i,Math.floor(e-P*D/E+L)),Math.min(u,Math.floor(e+(E-P)*D/E+L)),h)}const p=a[e];let g=i,w=u;for(hf(a,i,e),h(a[u],p)>0&&hf(a,i,u);g<w;){for(hf(a,g,w),g++,w--;h(a[g],p)<0;)g++;for(;h(a[w],p)>0;)w--}h(a[i],p)===0?hf(a,i,w):(w++,hf(a,w,u)),w<=e&&(i=w+1),e<=w&&(u=w-1)}}function hf(a,e,i){const u=a[e];a[e]=a[i],a[i]=u}function Td(a,e){return a<e?-1:a>e?1:0}function C_(a){let e=0;for(let i,u,h=0,p=a.length,g=p-1;h<p;g=h++)i=a[h],u=a[g],e+=(u.x-i.x)*(i.y+u.y);return e}function kl(a,e){a[0]=Math.min(a[0],e[0]),a[1]=Math.min(a[1],e[1]),a[2]=Math.max(a[2],e[0]),a[3]=Math.max(a[3],e[1])}function xc(a,e){return!(a[0]<=e[0]||a[2]>=e[2]||a[1]<=e[1]||a[3]>=e[3])}function Ll(a,e,i){const u=a[0]-e[0],h=a[1]-e[1],p=a[0]-i[0],g=a[1]-i[1];return u*g-p*h==0&&u*p<=0&&h*g<=0}function fu(a,e,i=!1){let u=!1;for(let w=0,E=e.length;w<E;w++){const P=e[w];for(let O=0,D=P.length,L=D-1;O<D;L=O++){const U=P[L],$=P[O];if(Ll(a,U,$))return i;(p=U)[1]>(h=a)[1]!=(g=$)[1]>h[1]&&h[0]<(g[0]-p[0])*(h[1]-p[1])/(g[1]-p[1])+p[0]&&(u=!u)}}var h,p,g;return u}function Np(a,e,i,u){const h=u[0]-i[0],p=u[1]-i[1],g=(a[0]-i[0])*p-h*(a[1]-i[1]),w=(e[0]-i[0])*p-h*(e[1]-i[1]);return g>0&&w<0||g<0&&w>0}function ff(a,e,i,u){return(h=[u[0]-i[0],u[1]-i[1]])[0]*(p=[e[0]-a[0],e[1]-a[1]])[1]-h[1]*p[0]!=0&&!(!Np(a,e,i,u)||!Np(i,u,a,e));var h,p}function jp(a){const e=new kt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new kt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of a[0])e.x>u.x&&(e.x=u.x),e.y>u.y&&(e.y=u.y),i.x<u.x&&(i.x=u.x),i.y<u.y&&(i.y=u.y);return{min:e,max:i}}const bc=8192;function M_(a,e){const i=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*bc),Math.round(u*h*bc)]}function Zm(a,e){for(let i=0;i<e.length;i++)if(fu(a,e[i]))return!0;return!1}function O_(a,e,i){for(const u of i)for(let h=0,p=u.length,g=p-1;h<p;g=h++)if(ff(a,e,u[g],u[h]))return!0;return!1}function ys(a,e){for(let i=0;i<a.length;++i)if(!fu(a[i],e))return!1;for(let i=0;i<a.length-1;++i)if(O_(a[i],a[i+1],e))return!1;return!0}function uh(a,e){for(let i=0;i<e.length;i++)if(ys(a,e[i]))return!0;return!1}function Ed(a,e,i){const u=[];for(let h=0;h<a.length;h++){const p=[];for(let g=0;g<a[h].length;g++){const w=M_(a[h][g],i);kl(e,w),p.push(w)}u.push(p)}return u}function zl(a,e,i){const u=[];for(let h=0;h<a.length;h++){const p=Ed(a[h],e,i);u.push(p)}return u}function Up(a,e,i,u){if(a[0]<i[0]||a[0]>i[2]){const h=.5*u;let p=a[0]-i[0]>h?-u:i[0]-a[0]>h?u:0;p===0&&(p=a[0]-i[2]>h?-u:i[2]-a[0]>h?u:0),a[0]+=p}kl(e,a)}function Vp(a,e,i,u){const h=Math.pow(2,u.z)*bc,p=[u.x*bc,u.y*bc],g=[];if(!a)return g;for(const w of a)for(const E of w){const P=[E.x+p[0],E.y+p[1]];Up(P,e,i,h),g.push(P)}return g}function hh(a,e,i,u){const h=Math.pow(2,u.z)*bc,p=[u.x*bc,u.y*bc],g=[];if(!a)return g;for(const E of a){const P=[];for(const O of E){const D=[O.x+p[0],O.y+p[1]];kl(e,D),P.push(D)}g.push(P)}if(e[2]-e[0]<=h/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of g)for(const P of E)Up(P,e,i,h)}var w;return g}class wc{constructor(e,i){this.type=Fn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Wr(e[1])){const u=e[1];if(u.type==="FeatureCollection")for(let h=0;h<u.features.length;++h){const p=u.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new wc(u,u.features[h].geometry)}else if(u.type==="Feature"){const h=u.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new wc(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new wc(u,u)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,u){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const w=Ed(u.coordinates,p,g),E=Vp(i.geometry(),h,p,g);if(!xc(h,p))return!1;for(const P of E)if(!fu(P,w))return!1}if(u.type==="MultiPolygon"){const w=zl(u.coordinates,p,g),E=Vp(i.geometry(),h,p,g);if(!xc(h,p))return!1;for(const P of E)if(!Zm(P,w))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,u){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(u.type==="Polygon"){const w=Ed(u.coordinates,p,g),E=hh(i.geometry(),h,p,g);if(!xc(h,p))return!1;for(const P of E)if(!ys(P,w))return!1}if(u.type==="MultiPolygon"){const w=zl(u.coordinates,p,g),E=hh(i.geometry(),h,p,g);if(!xc(h,p))return!1;for(const P of E)if(!uh(P,w))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const df={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},na=1/298.257223563,pf=na*(2-na),fl=Math.PI/180;class Sc{static fromTile(e,i,u){const h=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),p=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/fl;return new Sc(p,u)}static get units(){return df}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!df[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(df).join(", ")}`);const u=6378.137*fl*(i?df[i]:1),h=Math.cos(e*fl),p=1/(1-pf*(1-h*h)),g=Math.sqrt(p);this.kx=u*g*h,this.ky=u*g*p*(1-pf)}distance(e,i){const u=Wo(e[0]-i[0])*this.kx,h=(e[1]-i[1])*this.ky;return Math.sqrt(u*u+h*h)}bearing(e,i){const u=Wo(i[0]-e[0])*this.kx;return Math.atan2(u,(i[1]-e[1])*this.ky)/fl}destination(e,i,u){const h=u*fl;return this.offset(e,Math.sin(h)*i,Math.cos(h)*i)}offset(e,i,u){return[e[0]+i/this.kx,e[1]+u/this.ky]}lineDistance(e){let i=0;for(let u=0;u<e.length-1;u++)i+=this.distance(e[u],e[u+1]);return i}area(e){let i=0;for(let u=0;u<e.length;u++){const h=e[u];for(let p=0,g=h.length,w=g-1;p<g;w=p++)i+=Wo(h[p][0]-h[w][0])*(h[p][1]+h[w][1])*(u?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let u=0;if(i<=0)return e[0];for(let h=0;h<e.length-1;h++){const p=e[h],g=e[h+1],w=this.distance(p,g);if(u+=w,u>i)return du(p,g,(i-(u-w))/w)}return e[e.length-1]}pointToSegmentDistance(e,i,u){let[h,p]=i,g=Wo(u[0]-h)*this.kx,w=(u[1]-p)*this.ky;if(g!==0||w!==0){const E=(Wo(e[0]-h)*this.kx*g+(e[1]-p)*this.ky*w)/(g*g+w*w);E>1?(h=u[0],p=u[1]):E>0&&(h+=g/this.kx*E,p+=w/this.ky*E)}return g=Wo(e[0]-h)*this.kx,w=(e[1]-p)*this.ky,Math.sqrt(g*g+w*w)}pointOnLine(e,i){let u=1/0,h=e[0][0],p=e[0][1],g=0,w=0;for(let E=0;E<e.length-1;E++){let P=e[E][0],O=e[E][1],D=Wo(e[E+1][0]-P)*this.kx,L=(e[E+1][1]-O)*this.ky,U=0;D===0&&L===0||(U=(Wo(i[0]-P)*this.kx*D+(i[1]-O)*this.ky*L)/(D*D+L*L),U>1?(P=e[E+1][0],O=e[E+1][1]):U>0&&(P+=D/this.kx*U,O+=L/this.ky*U)),D=Wo(i[0]-P)*this.kx,L=(i[1]-O)*this.ky;const $=D*D+L*L;$<u&&(u=$,h=P,p=O,g=E,w=U)}return{point:[h,p],index:g,t:Math.max(0,Math.min(1,w))}}lineSlice(e,i,u){let h=this.pointOnLine(u,e),p=this.pointOnLine(u,i);if(h.index>p.index||h.index===p.index&&h.t>p.t){const P=h;h=p,p=P}const g=[h.point],w=h.index+1,E=p.index;!Ad(u[w],g[0])&&w<=E&&g.push(u[w]);for(let P=w+1;P<=E;P++)g.push(u[P]);return Ad(u[E],p.point)||g.push(p.point),g}lineSliceAlong(e,i,u){let h=0;const p=[];for(let g=0;g<u.length-1;g++){const w=u[g],E=u[g+1],P=this.distance(w,E);if(h+=P,h>e&&p.length===0&&p.push(du(w,E,(e-(h-P))/P)),h>=i)return p.push(du(w,E,(i-(h-P))/P)),p;h>e&&p.push(E)}return p}bufferPoint(e,i){const u=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-u,e[0]+h,e[1]+u]}bufferBBox(e,i){const u=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-u,e[2]+h,e[3]+u]}insideBBox(e,i){return Wo(e[0]-i[0])>=0&&Wo(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Ad(a,e){return a[0]===e[0]&&a[1]===e[1]}function du(a,e,i){const u=Wo(e[0]-a[0]);return[a[0]+u*i,a[1]+(e[1]-a[1])*i]}function Wo(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class fh{constructor(e=[],i=((u,h)=>u<h?-1:u>h?1:0)){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:u}=this,h=i[e];for(;e>0;){const p=e-1>>1,g=i[p];if(u(h,g)>=0)break;i[e]=g,e=p}i[e]=h}_down(e){const{data:i,compare:u}=this,h=this.length>>1,p=i[e];for(;e<h;){let g=1+(e<<1);const w=g+1;if(w<this.length&&u(i[w],i[g])<0&&(g=w),u(i[g],p)>=0)break;i[e]=i[g],e=g}i[e]=p}}var Wt=8192;function dh(a,e){return e.dist-a.dist}const mf=100,gf=50;function ph(a){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==a.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==a[i])return!1;return!0}function Tc(a){return a[1]-a[0]+1}function os(a,e){const i=a[1]>=a[0]&&a[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function _f(a,e){if(a[0]>a[1])return[null,null];const i=Tc(a);if(e){if(i===2)return[a,null];const u=Math.floor(i/2);return[[a[0],a[0]+u],[a[0]+u,a[1]]]}{if(i===1)return[a,null];const u=Math.floor(i/2)-1;return[[a[0],a[0]+u],[a[0]+u+1,a[1]]]}}function Ca(a,e){const i=[1/0,1/0,-1/0,-1/0];if(!os(e,a.length))return i;for(let u=e[0];u<=e[1];++u)kl(i,a[u]);return i}function pu(a){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<a.length;++i)for(let u=0;u<a[i].length;++u)kl(e,a[i][u]);return e}function as(a,e,i){if(ph(a)||ph(e))return NaN;let u=0,h=0;return a[2]<e[0]&&(u=e[0]-a[2]),a[0]>e[2]&&(u=a[0]-e[2]),a[1]>e[3]&&(h=a[1]-e[3]),a[3]<e[1]&&(h=e[1]-a[3]),i.distance([0,0],[u,h])}function gn(a){return 360*a-180}function R_(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function mu(a,e){const i=Math.pow(2,e.z),u=(a.y/Wt+e.y)/i;return[gn((a.x/Wt+e.x)/i),R_(u)]}function D_(a,e){const i=[];for(let u=0;u<a.length;++u)i.push(mu(a[u],e));return i}function Pd(a,e,i){const u=i.pointOnLine(e,a).point;return i.distance(a,u)}function $p(a,e,i,u,h){const p=i.slice(u[0],u[1]+1);let g=1/0;for(let w=e[0];w<=e[1];++w)if((g=Math.min(g,Pd(a[w],p,h)))===0)return 0;return g}function cn(a,e,i,u,h){const p=Math.min(h.pointToSegmentDistance(a,i,u),h.pointToSegmentDistance(e,i,u)),g=Math.min(h.pointToSegmentDistance(i,a,e),h.pointToSegmentDistance(u,a,e));return Math.min(p,g)}function qp(a,e,i,u,h){if(!os(e,a.length)||!os(u,i.length))return NaN;let p=1/0;for(let g=e[0];g<e[1];++g)for(let w=u[0];w<u[1];++w){if(ff(a[g],a[g+1],i[w],i[w+1]))return 0;p=Math.min(p,cn(a[g],a[g+1],i[w],i[w+1],h))}return p}function Id(a,e,i,u,h){if(!os(e,a.length)||!os(u,i.length))return NaN;let p=1/0;for(let g=e[0];g<=e[1];++g)for(let w=u[0];w<=u[1];++w)if((p=Math.min(p,h.distance(a[g],i[w])))===0)return p;return p}function yf(a,e,i){if(fu(a,e,!0))return 0;let u=1/0;for(const h of e){const p=h.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[p-1]&&(u=Math.min(u,i.pointToSegmentDistance(a,h[p-1],h[0])))===0||(u=Math.min(u,Pd(a,h,i)))===0)return u}return u}function Xm(a,e,i,u){if(!os(e,a.length))return NaN;for(let p=e[0];p<=e[1];++p)if(fu(a[p],i,!0))return 0;let h=1/0;for(let p=e[0];p<e[1];++p)for(const g of i)for(let w=0,E=g.length,P=E-1;w<E;P=w++){if(ff(a[p],a[p+1],g[P],g[w]))return 0;h=Math.min(h,cn(a[p],a[p+1],g[P],g[w],u))}return h}function Cd(a,e){for(const i of a)for(let u=0;u<=i.length-1;++u)if(fu(i[u],e,!0))return!0;return!1}function vf(a,e,i,u=1/0){const h=pu(a),p=pu(e);if(u!==1/0&&as(h,p,i)>=u)return u;if(xc(h,p)){if(Cd(a,e))return 0}else if(Cd(e,a))return 0;let g=u;for(const w of a)for(let E=0,P=w.length,O=P-1;E<P;O=E++)for(const D of e)for(let L=0,U=D.length,$=U-1;L<U;$=L++){if(ff(w[O],w[E],D[$],D[L]))return 0;g=Math.min(g,cn(w[O],w[E],D[$],D[L],i))}return g}function gu(a,e,i,u,h,p,g){if(p===null||g===null)return;const w=as(Ca(u,p),Ca(h,g),i);w<e&&a.push({dist:w,range1:p,range2:g})}function mh(a,e,i,u,h=1/0){let p=Math.min(u.distance(a[0],i[0][0]),h);if(p===0)return p;const g=new fh([{dist:0,range1:[0,a.length-1],range2:[0,0]}],dh),w=e?gf:mf,E=pu(i);for(;g.length;){const P=g.pop();if(P.dist>=p)continue;const O=P.range1;if(Tc(O)<=w){if(!os(O,a.length))return NaN;if(e){const D=Xm(a,O,i,u);if((p=Math.min(p,D))===0)return p}else for(let D=O[0];D<=O[1];++D){const L=yf(a[D],i,u);if((p=Math.min(p,L))===0)return p}}else{const D=_f(O,e);if(D[0]!==null){const L=as(Ca(a,D[0]),E,u);L<p&&g.push({dist:L,range1:D[0],range2:[0,0]})}if(D[1]!==null){const L=as(Ca(a,D[1]),E,u);L<p&&g.push({dist:L,range1:D[1],range2:[0,0]})}}}return p}function Gp(a,e,i,u,h,p=1/0){let g=Math.min(p,h.distance(a[0],i[0]));if(g===0)return g;const w=new fh([{dist:0,range1:[0,a.length-1],range2:[0,i.length-1]}],dh),E=e?gf:mf,P=u?gf:mf;for(;w.length;){const O=w.pop();if(O.dist>=g)continue;const D=O.range1,L=O.range2;if(Tc(D)<=E&&Tc(L)<=P){if(!os(D,a.length)||!os(L,i.length))return NaN;if(e&&u?g=Math.min(g,qp(a,D,i,L,h)):e||u?e&&!u?g=Math.min(g,$p(i,L,a,D,h)):!e&&u&&(g=Math.min(g,$p(a,D,i,L,h))):g=Math.min(g,Id(a,D,i,L,h)),g===0)return g}else{const U=_f(D,e),$=_f(L,u);gu(w,g,h,a,i,U[0],$[0]),gu(w,g,h,a,i,U[0],$[1]),gu(w,g,h,a,i,U[1],$[0]),gu(w,g,h,a,i,U[1],$[1])}}return g}function Hp(a,e,i,u,h=1/0){let p=h;const g=Ca(a,[0,a.length-1]);for(const w of i)if(!(p!==1/0&&as(g,Ca(w,[0,w.length-1]),u)>=p)&&(p=Math.min(p,Gp(a,e,w,!0,u,p)),p===0))return p;return p}function Md(a,e,i,u,h=1/0){let p=h;const g=Ca(a,[0,a.length-1]);for(const w of i){if(p!==1/0&&as(g,pu(w),u)>=p)continue;const E=mh(a,e,w,u,p);if(isNaN(E))return E;if((p=Math.min(p,E))===0)return p}return p}function Od(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class dl{constructor(e,i){this.type=yr,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Wr(e[1])){const u=e[1];if(u.type==="FeatureCollection"){for(let h=0;h<u.features.length;++h)if(Od(u.features[h].geometry.type))return new dl(u,u.features[h].geometry)}else if(u.type==="Feature"){if(Od(u.geometry.type))return new dl(u,u.geometry)}else if(Od(u.type))return new dl(u,u)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),u=e.canonicalID();if(i!=null&&u!=null){if(e.geometryType()==="Point")return(function(h,p,g){const w=[];for(const P of h)for(const O of P)w.push(mu(O,p));const E=new Sc(w[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?Gp(w,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",E):g.type==="MultiLineString"?Hp(w,!1,g.coordinates,E):g.type==="Polygon"||g.type==="MultiPolygon"?Md(w,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,E):null})(i,u,this.geometries);if(e.geometryType()==="LineString")return(function(h,p,g){const w=[];for(const P of h){const O=[];for(const D of P)O.push(mu(D,p));w.push(O)}const E=new Sc(w[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Hp(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",w,E);if(g.type==="MultiLineString"){let P=1/0;for(let O=0;O<g.coordinates.length;O++){const D=Hp(g.coordinates[O],!0,w,E,P);if(isNaN(D))return D;if((P=Math.min(P,D))===0)return P}return P}if(g.type==="Polygon"||g.type==="MultiPolygon"){let P=1/0;for(let O=0;O<w.length;O++){const D=Md(w[O],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,E,P);if(isNaN(D))return D;if((P=Math.min(P,D))===0)return P}return P}return null})(i,u,this.geometries);if(e.geometryType()==="Polygon")return(function(h,p,g){const w=[];for(const P of(function(O,D){const L=O.length;if(L<=1)return[O];const U=[];let $,X;for(let J=0;J<L;J++){const ie=C_(O[J]);ie!==0&&(O[J].area=Math.abs(ie),X===void 0&&(X=ie<0),X===ie<0?($&&U.push($),$=[O[J]]):$.push(O[J]))}return $&&U.push($),U})(h)){const O=[];for(let D=0;D<P.length;++D)O.push(D_(P[D],p));w.push(O)}const E=new Sc(w[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Md(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",w,E);if(g.type==="MultiLineString"){let P=1/0;for(let O=0;O<g.coordinates.length;O++){const D=Md(g.coordinates[O],!0,w,E,P);if(isNaN(D))return D;if((P=Math.min(P,D))===0)return P}return P}return g.type==="Polygon"||g.type==="MultiPolygon"?(function(P,O,D){let L=1/0;for(const U of P)for(const $ of O){const X=vf(U,$,D,L);if(isNaN(X))return X;if((L=Math.min(L,X))===0)return L}return L})(g.type==="Polygon"?[g.coordinates]:g.coordinates,w,E):null})(i,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Fl(a){if(a instanceof bo&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof wc||a instanceof dl)return!1;if(a instanceof yh)return a.featureConstant;let e=!0;return a.eachChild((i=>{e&&!Fl(i)&&(e=!1)})),e}function gh(a){if(a instanceof bo&&a.name==="feature-state")return!1;let e=!0;return a.eachChild((i=>{e&&!gh(i)&&(e=!1)})),e}function _h(a){if(a instanceof yh)return new Set([a.key]);let e=new Set;return a.eachChild((i=>{e=new Set([...e,..._h(i)])})),e}function Ec(a,e){if(a instanceof bo&&e.indexOf(a.name)>=0)return!1;let i=!0;return a.eachChild((u=>{i&&!Ec(u,e)&&(i=!1)})),i}function Rd(a,e,i){return[a,e,i].filter(Boolean).join("")}function Wp(a,e){switch(a){case"string":return Va(e);case"number":return+e;case"boolean":return!!e;case"color":return wn.parse(e);case"formatted":return ha.fromString(Va(e));case"resolvedImage":return Ia.build(Va(e))}return e}function Zp(a,e,i,u){return u!==void 0&&(a=u*Math.round(a/u)),e!==void 0&&a<e&&(a=e),i!==void 0&&a>i&&(a=i),a}class yh{constructor(e,i,u,h=!1){this.type=e,this.key=i,this.scope=u,this.featureConstant=h}static parse(e,i){let u=i.expectedType;if(u==null&&(u=Nn),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const h=i.parse(e[1],1);if(!(h instanceof Ir))return i.error("Key name of 'config' expression must be a string literal.");let p,g=!0;const w=Va(h.value);if(e.length>=3){const E=i.parse(e[2],2);if(!(E instanceof Ir))return i.error("Scope of 'config' expression must be a string literal.");p=Va(E.value)}if(i.options){const E=Rd(w,p,i._scope),P=i.options.get(E);P&&(g=Fl(P.value||P.default))}return new yh(u,w,p,g)}evaluate(e){const i=Rd(this.key,this.scope,e.scope),u=e.getConfig(i);if(!u)return null;const{type:h,value:p,values:g,minValue:w,maxValue:E,stepValue:P}=u,O=u.default.evaluate(e);let D=O;if(p){const L=e.scope;e.scope=(L||"").split("").slice(1).join(""),D=p.evaluate(e),e.scope=L}return h&&(D=Wp(h,D)),D===void 0||w===void 0&&E===void 0&&P===void 0||(typeof D=="number"?D=Zp(D,w,E,P):Array.isArray(D)&&(D=D.map((L=>typeof L=="number"?Zp(L,w,E,P):L)))),p!==void 0&&D!==void 0&&g&&!g.includes(D)&&(D=O,h&&(D=Wp(h,D))),(h&&h!==this.type||D!==void 0&&!bd(er(D),this.type))&&(D=Wp(this.type.kind,D)),D}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Dd{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const u=e[1];return i.scope.has(u)?new Dd(u,i.scope.get(u)):i.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class vh{constructor(e,i=[],u,h=new Bp,p=[],g,w){this.registry=e,this.path=i,this.key=i.map((E=>typeof E=="string"?`['${E}']`:`[${E}]`)).join(""),this.scope=h,this.errors=p,this.expectedType=u,this._scope=g,this.options=w}parse(e,i,u,h,p={}){return i||u?this.concat(i,null,u,h)._parse(e,p):this._parse(e,p)}parseObjectValue(e,i,u,h,p,g={}){return this.concat(i,u,h,p)._parse(e,g)}_parse(e,i){function u(h,p,g){return g==="assert"?new Er(p,[h]):g==="coerce"?new _s(p,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const g=this.expectedType,w=p.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||w.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(g,w))return null}else p=u(p,g,i.typeAnnotation||"coerce");else p=u(p,g,i.typeAnnotation||"assert")}if(!(p instanceof Ir)&&p.type.kind!=="resolvedImage"&&pl(p)){const g=new uf(this._scope,this.options);try{p=new Ir(p.type,p.evaluate(g))}catch(w){return this.error(w.message),null}}return p}return _s.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,u,h){let p=typeof e=="number"?this.path.concat(e):this.path;p=typeof i=="string"?p.concat(i):p;const g=h?this.scope.concat(h):this.scope;return new vh(this.registry,p,u||null,g,this.errors,this._scope,this.options)}error(e,...i){const u=`${this.key}${i.map((h=>`[${h}]`)).join("")}`;this.errors.push(new ja(u,e))}checkSubtype(e,i){const u=yc(e,i);return u&&this.error(u),u}}function pl(a){if(a instanceof Dd)return pl(a.boundExpression);if(a instanceof bo&&a.name==="error"||a instanceof $a||a instanceof wc||a instanceof dl||a instanceof yh)return!1;const e=a instanceof _s||a instanceof Er;let i=!0;return a.eachChild((u=>{i=e?i&&pl(u):i&&u instanceof Ir})),!!i&&Fl(a)&&Ec(a,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function xf(a,e){const i=a.length-1;let u,h,p=0,g=i,w=0;for(;p<=g;)if(w=Math.floor((p+g)/2),u=a[w],h=a[w+1],u<=e){if(w===i||e<h)return w;p=w+1}else{if(!(u>e))throw new Ji("Input is not a number.");g=w-1}return 0}class ml{constructor(e,i,u){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,p]of u)this.labels.push(h),this.outputs.push(p)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const u=i.parse(e[1],1,yr);if(!u)return null;const h=[];let p=null;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let g=1;g<e.length;g+=2){const w=g===1?-1/0:e[g],E=e[g+1],P=g,O=g+1;if(typeof w!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(h.length&&h[h.length-1][0]>=w)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const D=i.parse(E,O,p);if(!D)return null;p=p||D.type,h.push([w,D])}return new ml(p,u,h)}evaluate(e){const i=this.labels,u=this.outputs;if(i.length===1)return u[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return u[0].evaluate(e);const p=i.length;return h>=i[p-1]?u[p-1].evaluate(e):u[xf(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Ds=.95047,xh=1.08883,gl=4/29,Ac=6/29,Km=3*Ac*Ac,Xp=Ac*Ac*Ac,_u=Math.PI/180,bh=180/Math.PI;function Pc(a){return a>Xp?Math.pow(a,1/3):a/Km+gl}function wh(a){return a>Ac?a*a*a:Km*(a-gl)}function bf(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function Bl(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function _l(a){const e=Bl(a.r),i=Bl(a.g),u=Bl(a.b),h=Pc((.4124564*e+.3575761*i+.1804375*u)/Ds),p=Pc((.2126729*e+.7151522*i+.072175*u)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-Pc((.0193339*e+.119192*i+.9503041*u)/xh)),alpha:a.a}}function Ii(a){let e=(a.l+16)/116,i=isNaN(a.a)?e:e+a.a/500,u=isNaN(a.b)?e:e-a.b/200;return e=1*wh(e),i=Ds*wh(i),u=xh*wh(u),new wn(bf(3.2404542*i-1.5371385*e-.4985314*u),bf(-.969266*i+1.8760108*e+.041556*u),bf(.0556434*i-.2040259*e+1.0572252*u),a.alpha)}function $i(a,e,i){const u=e-a;return a+i*(u>180||u<-180?u-360*Math.round(u/360):u)}const ss={forward:_l,reverse:Ii,interpolate:function(a,e,i){return{l:Sr(a.l,e.l,i),a:Sr(a.a,e.a,i),b:Sr(a.b,e.b,i),alpha:Sr(a.alpha,e.alpha,i)}}},Mo={forward:function(a){const{l:e,a:i,b:u}=_l(a),h=Math.atan2(u,i)*bh;return{h:h<0?h+360:h,c:Math.sqrt(i*i+u*u),l:e,alpha:a.a}},reverse:function(a){const e=a.h*_u,i=a.c;return Ii({l:a.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:a.alpha})},interpolate:function(a,e,i){return{h:$i(a.h,e.h,i),c:Sr(a.c,e.c,i),l:Sr(a.l,e.l,i),alpha:Sr(a.alpha,e.alpha,i)}}};var ia=Object.freeze({__proto__:null,hcl:Mo,lab:ss});class So{constructor(e,i,u,h,p){this.type=e,this.operator=i,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(const[g,w]of p)this.labels.push(g),this.outputs.push(w)}static interpolationFactor(e,i,u,h){let p=0;if(e.name==="exponential")p=Ic(i,e.base,u,h);else if(e.name==="linear")p=Ic(i,1,u,h);else if(e.name==="cubic-bezier"){const g=e.controlPoints;p=new eu(g[0],g[1],g[2],g[3]).solve(Ic(i,1,u,h))}return p}static parse(e,i){let[u,h,p,...g]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const P=h[1];if(typeof P!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:P}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const P=h.slice(1);if(P.length!==4||P.some((O=>typeof O!="number"||O<0||O>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:P}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,yr),!p)return null;const w=[];let E=null;u==="interpolate-hcl"||u==="interpolate-lab"?E=Ua:i.expectedType&&i.expectedType.kind!=="value"&&(E=i.expectedType);for(let P=0;P<g.length;P+=2){const O=g[P],D=g[P+1],L=P+3,U=P+4;if(typeof O!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(w.length&&w[w.length-1][0]>=O)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const $=i.parse(D,U,E);if(!$)return null;E=E||$.type,w.push([O,$])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new So(E,u,h,p,w):i.error(`Type ${io(E)} is not interpolatable.`)}evaluate(e){const i=this.labels,u=this.outputs;if(i.length===1)return u[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return u[0].evaluate(e);const p=i.length;if(h>=i[p-1])return u[p-1].evaluate(e);const g=xf(i,h),w=So.interpolationFactor(this.interpolation,h,i[g],i[g+1]),E=u[g].evaluate(e),P=u[g+1].evaluate(e);return this.operator==="interpolate"?Ml[this.type.kind.toLowerCase()](E,P,w):this.operator==="interpolate-hcl"?Mo.reverse(Mo.interpolate(Mo.forward(E),Mo.forward(P),w)):ss.reverse(ss.interpolate(ss.forward(E),ss.forward(P),w))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let u=0;u<this.labels.length;u++)i.push(this.labels[u],this.outputs[u].serialize());return i}}function Ic(a,e,i,u){const h=u-i,p=a-i;return h===0?0:e===1?p/h:(Math.pow(e,p)-1)/(Math.pow(e,h)-1)}class oa{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let u=null;const h=i.expectedType;h&&h.kind!=="value"&&(u=h);const p=[];for(const w of e.slice(1)){const E=i.parse(w,1+p.length,u,void 0,{typeAnnotation:"omit"});if(!E)return null;u=u||E.type,p.push(E)}const g=h&&p.some((w=>yc(h,w.type)));return new oa(g?Nn:u,p)}evaluate(e){let i,u=null,h=0;for(const p of this.args){if(h++,u=p.evaluate(e),u&&u instanceof Ia&&!u.available&&(i||(i=u),u=null,h===this.args.length))return i;if(u!==null)break}return u}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class Cc{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const u=[];for(let p=1;p<e.length-1;p+=2){const g=e[p];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const w=i.parse(e[p+1],p+1);if(!w)return null;u.push([g,w])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,u);return h?new Cc(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,u]of this.bindings)e.push(i,u.serialize());return e.push(this.result.serialize()),e}}class wf{constructor(e,i,u){this.type=e,this.index=i,this.input=u}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=i.parse(e[1],1,yr),h=i.parse(e[2],2,ra(i.expectedType||Nn));return u&&h?new wf(h.type.itemType,u,h):null}evaluate(e){const i=this.index.evaluate(e),u=this.input.evaluate(e);if(i<0)throw new Ji(`Array index out of bounds: ${i} < 0.`);if(i>=u.length)throw new Ji(`Array index out of bounds: ${i} > ${u.length-1}.`);if(i!==Math.floor(i))throw new Ji(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return u[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class kd{constructor(e,i,u){this.type=e,this.index=i,this.input=u}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=i.parse(e[1],1,yr),h=i.parse(e[2],2,ra(i.expectedType||Nn));return u&&h?new kd(h.type.itemType,u,h):null}evaluate(e){const i=this.index.evaluate(e),u=this.input.evaluate(e);if(i<0)throw new Ji(`Array index out of bounds: ${i} < 0.`);if(i>u.length-1)throw new Ji(`Array index out of bounds: ${i} > ${u.length-1}.`);if(i===Math.floor(i))return u[i];const h=Math.floor(i),p=Math.ceil(i),g=u[h],w=u[p];if(typeof g!="number"||typeof w!="number")throw new Ji(`Cannot interpolate between non-number values at index ${i}.`);const E=i-h;return g*(1-E)+w*E}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Sh{constructor(e,i){this.type=Fn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=i.parse(e[1],1,Nn),h=i.parse(e[2],2,Nn);return u&&h?vc(u.type,[Fn,kn,yr,ah,Nn])?new Sh(u,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${io(u.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(u==null)return!1;if(!cf(i,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${io(er(i))} instead.`);if(!cf(u,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${io(er(u))} instead.`);return u.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Sf{constructor(e,i,u){this.type=yr,this.needle=e,this.haystack=i,this.fromIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=i.parse(e[1],1,Nn),h=i.parse(e[2],2,Nn);if(!u||!h)return null;if(!vc(u.type,[Fn,kn,yr,ah,Nn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${io(u.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,yr);return p?new Sf(u,h,p):null}return new Sf(u,h)}evaluate(e){const i=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!cf(i,["boolean","string","number","null"]))throw new Ji(`Expected first argument to be of type boolean, string, number or null, but found ${io(er(i))} instead.`);if(!cf(u,["string","array"]))throw new Ji(`Expected second argument to be of type array or string, but found ${io(er(u))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return u.indexOf(i,h)}return u.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class vs{constructor(e,i,u,h,p,g){this.inputType=e,this.type=i,this.input=u,this.cases=h,this.outputs=p,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let u,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const p={},g=[];for(let P=2;P<e.length-1;P+=2){let O=e[P];const D=e[P+1];Array.isArray(O)||(O=[O]);const L=i.concat(P);if(O.length===0)return L.error("Expected at least one branch label.");for(const $ of O){if(typeof $!="number"&&typeof $!="string")return L.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return L.error("Numeric branch labels must be integer values.");if(u){if(L.checkSubtype(u,er($)))return null}else u=er($);if(p[String($)]!==void 0)return L.error("Branch labels must be unique.");p[String($)]=g.length}const U=i.parse(D,P,h);if(!U)return null;h=h||U.type,g.push(U)}const w=i.parse(e[1],1,Nn);if(!w)return null;const E=i.parse(e[e.length-1],e.length-1,h);return E?w.type.kind!=="value"&&i.concat(1).checkSubtype(u,w.type)?null:new vs(u,h,w,p,g,E):null}evaluate(e){const i=this.input.evaluate(e);return(bd(er(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),u=[],h={};for(const g of i){const w=h[this.cases[g]];w===void 0?(h[this.cases[g]]=u.length,u.push([this.cases[g],[g]])):u[w][1].push(g)}const p=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,w]of u)e.push(w.length===1?p(w[0]):w.map(p)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}class yu{constructor(e,i,u){this.type=e,this.branches=i,this.otherwise=u}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const h=[];for(let g=1;g<e.length-1;g+=2){const w=i.parse(e[g],g,Fn);if(!w)return null;const E=i.parse(e[g+1],g+1,u);if(!E)return null;h.push([w,E]),u=u||E.type}const p=i.parse(e[e.length-1],e.length-1,u);return p?new yu(u,h,p):null}evaluate(e){for(const[i,u]of this.branches)if(i.evaluate(e))return u.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,u]of this.branches)e(i),e(u);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class Nl{constructor(e,i,u,h){this.type=e,this.input=i,this.beginIndex=u,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=i.parse(e[1],1,Nn),h=i.parse(e[2],2,yr);if(!u||!h)return null;if(!vc(u.type,[ra(Nn),kn,Nn]))return i.error(`Expected first argument to be of type array or string, but found ${io(u.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,yr);return p?new Nl(u.type,u,h,p):null}return new Nl(u.type,u,h)}evaluate(e){const i=this.input.evaluate(e),u=this.beginIndex.evaluate(e);if(!cf(i,["string","array"]))throw new Ji(`Expected first argument to be of type array or string, but found ${io(er(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(u,h)}return i.slice(u)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Ld{constructor(e,i){this.type=ra(kn),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=i.parse(e[1],1,kn),h=i.parse(e[2],2,kn);return u&&h?new Ld(u,h):void 0}evaluate(e){const i=this.str.evaluate(e),u=this.delimiter.evaluate(e);return i.split(u)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Kp(a,e){return a==="=="||a==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function jl(a,e,i,u){return u.compare(e,i)===0}function ks(a,e,i){const u=a!=="=="&&a!=="!=";return class tV{constructor(p,g,w){this.type=Fn,this.lhs=p,this.rhs=g,this.collator=w,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const w=p[0];let E=g.parse(p[1],1,Nn);if(!E)return null;if(!Kp(w,E.type))return g.concat(1).error(`"${w}" comparisons are not supported for type '${io(E.type)}'.`);let P=g.parse(p[2],2,Nn);if(!P)return null;if(!Kp(w,P.type))return g.concat(2).error(`"${w}" comparisons are not supported for type '${io(P.type)}'.`);if(E.type.kind!==P.type.kind&&E.type.kind!=="value"&&P.type.kind!=="value")return g.error(`Cannot compare types '${io(E.type)}' and '${io(P.type)}'.`);u&&(E.type.kind==="value"&&P.type.kind!=="value"?E=new Er(P.type,[E]):E.type.kind!=="value"&&P.type.kind==="value"&&(P=new Er(E.type,[P])));let O=null;if(p.length===4){if(E.type.kind!=="string"&&P.type.kind!=="string"&&E.type.kind!=="value"&&P.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(O=g.parse(p[3],3,xd),!O)return null}return new tV(E,P,O)}evaluate(p){const g=this.lhs.evaluate(p),w=this.rhs.evaluate(p);if(u&&this.hasUntypedArgument){const E=er(g),P=er(w);if(E.kind!==P.kind||E.kind!=="string"&&E.kind!=="number")throw new Ji(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${E.kind}, ${P.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const E=er(g),P=er(w);if(E.kind!=="string"||P.kind!=="string")return e(p,g,w)}return this.collator?i(p,g,w,this.collator.evaluate(p)):e(p,g,w)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[a];return this.eachChild((g=>{p.push(g.serialize())})),p}}}const vu=ks("==",(function(a,e,i){return e===i}),jl),Tf=ks("!=",(function(a,e,i){return e!==i}),(function(a,e,i,u){return!jl(0,e,i,u)})),zd=ks("<",(function(a,e,i){return e<i}),(function(a,e,i,u){return u.compare(e,i)<0})),xs=ks(">",(function(a,e,i){return e>i}),(function(a,e,i,u){return u.compare(e,i)>0})),bs=ks("<=",(function(a,e,i){return e<=i}),(function(a,e,i,u){return u.compare(e,i)<=0})),yl=ks(">=",(function(a,e,i){return e>=i}),(function(a,e,i,u){return u.compare(e,i)>=0}));class Ls{constructor(e,i,u,h,p,g){this.type=kn,this.number=e,this.locale=i,this.currency=u,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const u=i.parse(e[1],1,yr);if(!u)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=i.parseObjectValue(h.locale,2,"locale",kn),!p))return null;let g=null;if(h.currency&&(g=i.parseObjectValue(h.currency,2,"currency",kn),!g))return null;let w=null;if(h.unit&&(w=i.parseObjectValue(h.unit,2,"unit",kn),!w))return null;let E=null;if(h["min-fraction-digits"]&&(E=i.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",yr),!E))return null;let P=null;return h["max-fraction-digits"]&&(P=i.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",yr),!P)?null:new Ls(u,p,g,w,E,P)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class zs{constructor(e){this.type=yr,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const u=i.parse(e[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${io(u.type)} instead.`):new zs(u):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Ji(`Expected value to be of type string or array, but found ${io(er(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((i=>{e.push(i.serialize())})),e}}function Mc(a){return function(){a=1831565813+(a|=0)|0;let e=Math.imul(a^a>>>15,1|a);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const xu={"==":vu,"!=":Tf,">":xs,"<":zd,">=":yl,"<=":bs,array:Er,at:wf,"at-interpolated":kd,boolean:Er,case:yu,coalesce:oa,collator:$a,format:cu,image:uu,in:Sh,"index-of":Sf,interpolate:So,"interpolate-hcl":So,"interpolate-lab":So,length:zs,let:Cc,literal:Ir,match:vs,number:Er,"number-format":Ls,object:Er,slice:Nl,step:ml,string:Er,"to-boolean":_s,"to-color":_s,"to-number":_s,"to-string":_s,var:Dd,within:wc,distance:dl,config:yh,split:Ld};function Ef(a,[e,i,u,h]){e=e.evaluate(a),i=i.evaluate(a),u=u.evaluate(a);const p=h?h.evaluate(a):1,g=lu(e,i,u,p);if(g)throw new Ji(g);return new wn(e/255,i/255,u/255,p)}function Fd(a,[e,i,u,h]){e=e.evaluate(a),i=i.evaluate(a),u=u.evaluate(a);const p=h?h.evaluate(a):1,g=(function(P,O,D,L){return typeof P=="number"&&P>=0&&P<=360?typeof O=="number"&&O>=0&&O<=100&&typeof D=="number"&&D>=0&&D<=100?L===void 0||typeof L=="number"&&L>=0&&L<=1?null:`Invalid hsla value [${[P,O,D,L].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof L=="number"?[P,O,D,L]:[P,O,D]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof L=="number"?[P,O,D,L]:[P,O,D]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,u,p);if(g)throw new Ji(g);const w=`hsla(${e}, ${i}%, ${u}%, ${p})`,E=wn.parse(w);if(!E)throw new Ji(`Failed to parse HSLA color: ${w}`);return E}function qa(a,e){return a in e}function da(a,e){const i=e[a];return i===void 0?null:i}function Ci(a){return{type:a}}function ls(a){return{result:"success",value:a}}function Ul(a){return{result:"error",value:a}}function Vl(a,e){return!!a&&!!a.parameters&&a.parameters.indexOf(e)>-1}function Th(a){return a["property-type"]==="data-driven"}function Bd(a){return Vl(a.expression,"measure-light")}function Yp(a){return Vl(a.expression,"zoom")}function bu(a){return!!a.expression&&a.expression.interpolated}function Af(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function wu(a){return a}function Pf(a,e){const i=e.type==="color",u=a.stops&&typeof a.stops[0][0]=="object",h=u||!(u||a.property!==void 0),p=a.type||(bu(e)?"exponential":"interval");if(i&&((a=hl({},a)).stops&&(a.stops=a.stops.map((P=>[P[0],wn.parse(P[1])]))),a.default=wn.parse(a.default?a.default:e.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!ia[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let g,w,E;if(p==="exponential")g=Jp;else if(p==="interval")g=If;else if(p==="categorical"){g=Tu,w=Object.create(null);for(const P of a.stops)w[P[0]]=P[1];E=typeof a.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);g=$l}if(u){const P={},O=[];for(let U=0;U<a.stops.length;U++){const $=a.stops[U],X=$[0].zoom;P[X]===void 0&&(P[X]={zoom:X,type:a.type,property:a.property,default:a.default,stops:[]},O.push(X)),P[X].stops.push([$[0].value,$[1]])}const D=[];for(const U of O)D.push([P[U].zoom,Pf(P[U],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:So.interpolationFactor.bind(void 0,L),zoomStops:D.map((U=>U[0])),evaluate:({zoom:U},$)=>Jp({stops:D,base:a.base},e,U).evaluate(U,$)}}if(h){const P=p==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:So.interpolationFactor.bind(void 0,P),zoomStops:a.stops.map((O=>O[0])),evaluate:({zoom:O})=>g(a,e,O,w,E)}}return{kind:"source",evaluate(P,O){const D=O&&O.properties?O.properties[a.property]:void 0;return D===void 0?Su(a.default,e.default):g(a,e,D,w,E)}}}function Su(a,e,i){return a!==void 0?a:e!==void 0?e:i!==void 0?i:void 0}function Tu(a,e,i,u,h){return Su(typeof i===h?u[i]:void 0,a.default,e.default)}function If(a,e,i){if(Dl(i)!=="number")return Su(a.default,e.default);const u=a.stops.length;if(u===1||i<=a.stops[0][0])return a.stops[0][1];if(i>=a.stops[u-1][0])return a.stops[u-1][1];const h=xf(a.stops.map((p=>p[0])),i);return a.stops[h][1]}function Jp(a,e,i){const u=a.base!==void 0?a.base:1;if(Dl(i)!=="number")return Su(a.default,e.default);const h=a.stops.length;if(h===1||i<=a.stops[0][0])return a.stops[0][1];if(i>=a.stops[h-1][0])return a.stops[h-1][1];const p=xf(a.stops.map((O=>O[0])),i),g=(function(O,D,L,U){const $=U-L,X=O-L;return $===0?0:D===1?X/$:(Math.pow(D,X)-1)/(Math.pow(D,$)-1)})(i,u,a.stops[p][0],a.stops[p+1][0]),w=a.stops[p][1],E=a.stops[p+1][1];let P=Ml[e.type]||wu;if(a.colorSpace&&a.colorSpace!=="rgb"){const O=ia[a.colorSpace];P=(D,L)=>O.reverse(O.interpolate(O.forward(D),O.forward(L),g))}return typeof w.evaluate=="function"?{evaluate(...O){const D=w.evaluate.apply(void 0,O),L=E.evaluate.apply(void 0,O);if(D!==void 0&&L!==void 0)return P(D,L,g)}}:P(w,E,g)}function $l(a,e,i){return e.type==="color"?i=wn.parse(i):e.type==="formatted"?i=ha.fromString(i.toString()):e.type==="resolvedImage"?i=Ia.build(i.toString()):Dl(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Su(i,a.default,e.default)}bo.register(xu,{error:[{kind:"error"},[kn],(a,[e])=>{throw new Ji(e.evaluate(a))}],typeof:[kn,[Nn],(a,[e])=>io(er(e.evaluate(a)))],"to-rgba":[ra(yr,4),[Ua],(a,[e])=>e.evaluate(a).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[ra(yr,4),[Ua],(a,[e])=>e.evaluate(a).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ua,[yr,yr,yr],Ef],rgba:[Ua,[yr,yr,yr,yr],Ef],hsl:[Ua,[yr,yr,yr],Fd],hsla:[Ua,[yr,yr,yr,yr],Fd],has:{type:Fn,overloads:[[[kn],(a,[e])=>qa(e.evaluate(a),a.properties())],[[kn,Ol],(a,[e,i])=>qa(e.evaluate(a),i.evaluate(a))]]},get:{type:Nn,overloads:[[[kn],(a,[e])=>da(e.evaluate(a),a.properties())],[[kn,Ol],(a,[e,i])=>da(e.evaluate(a),i.evaluate(a))]]},"feature-state":[Nn,[kn],(a,[e])=>da(e.evaluate(a),a.featureState||{})],properties:[Ol,[],a=>a.properties()],"geometry-type":[kn,[],a=>a.geometryType()],worldview:[kn,[],a=>a.globals.worldview||""],id:[Nn,[],a=>a.id()],zoom:[yr,[],a=>a.globals.zoom],pitch:[yr,[],a=>a.globals.pitch||0],"distance-from-center":[yr,[],a=>a.distanceFromCenter()],"measure-light":[yr,[kn],(a,[e])=>a.measureLight(e.evaluate(a))],"heatmap-density":[yr,[],a=>a.globals.heatmapDensity||0],"line-progress":[yr,[],a=>a.globals.lineProgress||0],"raster-value":[yr,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[yr,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[yr,[],a=>a.globals.skyRadialProgress||0],accumulated:[Nn,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[yr,Ci(yr),(a,e)=>{let i=0;for(const u of e)i+=u.evaluate(a);return i}],"*":[yr,Ci(yr),(a,e)=>{let i=1;for(const u of e)i*=u.evaluate(a);return i}],"-":{type:yr,overloads:[[[yr,yr],(a,[e,i])=>e.evaluate(a)-i.evaluate(a)],[[yr],(a,[e])=>-e.evaluate(a)]]},"/":[yr,[yr,yr],(a,[e,i])=>e.evaluate(a)/i.evaluate(a)],"%":[yr,[yr,yr],(a,[e,i])=>e.evaluate(a)%i.evaluate(a)],ln2:[yr,[],()=>Math.LN2],pi:[yr,[],()=>Math.PI],e:[yr,[],()=>Math.E],"^":[yr,[yr,yr],(a,[e,i])=>Math.pow(e.evaluate(a),i.evaluate(a))],sqrt:[yr,[yr],(a,[e])=>Math.sqrt(e.evaluate(a))],log10:[yr,[yr],(a,[e])=>Math.log(e.evaluate(a))/Math.LN10],ln:[yr,[yr],(a,[e])=>Math.log(e.evaluate(a))],log2:[yr,[yr],(a,[e])=>Math.log(e.evaluate(a))/Math.LN2],sin:[yr,[yr],(a,[e])=>Math.sin(e.evaluate(a))],cos:[yr,[yr],(a,[e])=>Math.cos(e.evaluate(a))],tan:[yr,[yr],(a,[e])=>Math.tan(e.evaluate(a))],asin:[yr,[yr],(a,[e])=>Math.asin(e.evaluate(a))],acos:[yr,[yr],(a,[e])=>Math.acos(e.evaluate(a))],atan:[yr,[yr],(a,[e])=>Math.atan(e.evaluate(a))],min:[yr,Ci(yr),(a,e)=>Math.min(...e.map((i=>i.evaluate(a))))],max:[yr,Ci(yr),(a,e)=>Math.max(...e.map((i=>i.evaluate(a))))],abs:[yr,[yr],(a,[e])=>Math.abs(e.evaluate(a))],round:[yr,[yr],(a,[e])=>{const i=e.evaluate(a);return i<0?-Math.round(-i):Math.round(i)}],floor:[yr,[yr],(a,[e])=>Math.floor(e.evaluate(a))],ceil:[yr,[yr],(a,[e])=>Math.ceil(e.evaluate(a))],"filter-==":[Fn,[kn,Nn],(a,[e,i])=>a.properties()[e.value]===i.value],"filter-id-==":[Fn,[Nn],(a,[e])=>a.id()===e.value],"filter-type-==":[Fn,[kn],(a,[e])=>a.geometryType()===e.value],"filter-<":[Fn,[kn,Nn],(a,[e,i])=>{const u=a.properties()[e.value],h=i.value;return typeof u==typeof h&&u<h}],"filter-id-<":[Fn,[Nn],(a,[e])=>{const i=a.id(),u=e.value;return typeof i==typeof u&&i<u}],"filter->":[Fn,[kn,Nn],(a,[e,i])=>{const u=a.properties()[e.value],h=i.value;return typeof u==typeof h&&u>h}],"filter-id->":[Fn,[Nn],(a,[e])=>{const i=a.id(),u=e.value;return typeof i==typeof u&&i>u}],"filter-<=":[Fn,[kn,Nn],(a,[e,i])=>{const u=a.properties()[e.value],h=i.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[Fn,[Nn],(a,[e])=>{const i=a.id(),u=e.value;return typeof i==typeof u&&i<=u}],"filter->=":[Fn,[kn,Nn],(a,[e,i])=>{const u=a.properties()[e.value],h=i.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[Fn,[Nn],(a,[e])=>{const i=a.id(),u=e.value;return typeof i==typeof u&&i>=u}],"filter-has":[Fn,[Nn],(a,[e])=>e.value in a.properties()],"filter-has-id":[Fn,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Fn,[ra(kn)],(a,[e])=>e.value.indexOf(a.geometryType())>=0],"filter-id-in":[Fn,[ra(Nn)],(a,[e])=>e.value.indexOf(a.id())>=0],"filter-in-small":[Fn,[kn,ra(Nn)],(a,[e,i])=>i.value.indexOf(a.properties()[e.value])>=0],"filter-in-large":[Fn,[kn,ra(Nn)],(a,[e,i])=>(function(u,h,p,g){for(;p<=g;){const w=p+g>>1;if(h[w]===u)return!0;h[w]>u?g=w-1:p=w+1}return!1})(a.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Fn,overloads:[[[Fn,Fn],(a,[e,i])=>e.evaluate(a)&&i.evaluate(a)],[Ci(Fn),(a,e)=>{for(const i of e)if(!i.evaluate(a))return!1;return!0}]]},any:{type:Fn,overloads:[[[Fn,Fn],(a,[e,i])=>e.evaluate(a)||i.evaluate(a)],[Ci(Fn),(a,e)=>{for(const i of e)if(i.evaluate(a))return!0;return!1}]]},"!":[Fn,[Fn],(a,[e])=>!e.evaluate(a)],"is-supported-script":[Fn,[kn],(a,[e])=>{const i=a.globals&&a.globals.isSupportedScript;return!i||i(e.evaluate(a))}],upcase:[kn,[kn],(a,[e])=>e.evaluate(a).toUpperCase()],downcase:[kn,[kn],(a,[e])=>e.evaluate(a).toLowerCase()],concat:[kn,Ci(Nn),(a,e)=>e.map((i=>Va(i.evaluate(a)))).join("")],"resolved-locale":[kn,[xd],(a,[e])=>e.evaluate(a).resolvedLocale()],random:[yr,[yr,yr,Nn],(a,e)=>{const[i,u,h]=e.map((g=>g.evaluate(a)));if(i>u||i===u)return i;let p;if(typeof h=="string")p=(function(g){let w=0;if(g.length===0)return w;for(let E=0;E<g.length;E++)w=(w<<5)-w+g.charCodeAt(E),w|=0;return w})(h);else{if(typeof h!="number")throw new Ji(`Invalid seed input: ${h}`);p=h}return i+Mc(p)()*(u-i)}]});class Oc{constructor(e,i,u,h){this.expression=e,this._warningHistory={},this._evaluator=new uf(u,h),this._defaultValue=i?(function(p){return p.type==="color"&&(Af(p.default)||Array.isArray(p.default))?new wn(0,0,0,0):p.type==="color"?wn.parse(p.default)||null:p.default===void 0?null:p.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=_h(e)}evaluateWithoutErrorHandling(e,i,u,h,p,g,w,E){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,u,h,p,g,w,E){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=E||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new Ji(`Expected value to be one of ${Object.keys(this._enumValues).map((O=>JSON.stringify(O))).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${P.message}`)),this._defaultValue}}}function Nd(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in xu}function vl(a,e,i,u){const h=new vh(xu,[],e?(function(g){const w={color:Ua,string:kn,number:yr,enum:kn,boolean:Fn,formatted:sh,resolvedImage:lf};return g.type==="array"?ra(w[g.value]||Nn,g.length):w[g.type]})(e):void 0,void 0,void 0,i,u),p=h.parse(a,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?ls(new Oc(p,e,i,u)):Ul(h.errors)}class Eu{constructor(e,i,u,h){this.kind=e,this._styleExpression=i,this.isLightConstant=u,this.isLineProgressConstant=h,this.isStateDependent=e!=="constant"&&!gh(i.expression),this.configDependencies=_h(i.expression)}evaluateWithoutErrorHandling(e,i,u,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,u,h,p,g)}evaluate(e,i,u,h,p,g){return this._styleExpression.evaluate(e,i,u,h,p,g)}}class cs{constructor(e,i,u,h,p,g){this.kind=e,this.zoomStops=u,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!gh(i.expression),this.isLightConstant=p,this.isLineProgressConstant=g,this.configDependencies=_h(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,u,h,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,u,h,p,g)}evaluate(e,i,u,h,p,g){return this._styleExpression.evaluate(e,i,u,h,p,g)}interpolationFactor(e,i,u){return this.interpolationType?So.interpolationFactor(this.interpolationType,e,i,u):0}}function Cf(a,e,i,u){if((a=vl(a,e,i,u)).result==="error")return a;const h=a.value.expression,p=Fl(h);if(!p&&!Th(e))return Ul([new ja("","data expressions not supported")]);const g=Ec(h,["zoom","pitch","distance-from-center"]);if(!g&&!Yp(e))return Ul([new ja("","zoom expressions not supported")]);const w=Ec(h,["measure-light"]);if(!w&&!Bd(e))return Ul([new ja("","measure-light expression not supported")]);const E=Ec(h,["line-progress"]);if(!E&&!(function(D){return Vl(D.expression,"line-progress")})(e))return Ul([new ja("","line-progress expression not supported")]);const P=e.expression&&e.expression.relaxZoomRestriction,O=Au(h);return O||g||P?O instanceof ja?Ul([O]):O instanceof So&&!bu(e)?Ul([new ja("",'"interpolate" expressions cannot be used with this property')]):ls(O?new cs(p&&E?"camera":"composite",a.value,O.labels,O instanceof So?O.interpolation:void 0,w,E):new Eu(p&&E?"constant":"source",a.value,w,E)):Ul([new ja("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ql{constructor(e,i){this._parameters=e,this._specification=i,hl(this,Pf(this._parameters,this._specification))}static deserialize(e){return new ql(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Au(a){let e=null;if(a instanceof Cc)e=Au(a.result);else if(a instanceof oa){for(const i of a.args)if(e=Au(i),e)break}else(a instanceof ml||a instanceof So)&&a.input instanceof bo&&a.input.name==="zoom"&&(e=a);return e instanceof ja||a.eachChild((i=>{const u=Au(i);u instanceof ja?e=u:e&&u&&e!==u&&(e=new ja("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var Mf,Pu,Ga=(function(){if(Pu)return Mf;Pu=1,Mf=e;var a=3;function e(i,u,h){var p=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var g=new Int32Array(this.arrayBuffer);i=g[0],this.d=(u=g[1])+2*(h=g[2]);for(var w=0;w<this.d*this.d;w++){var E=g[a+w],P=g[a+w+1];p.push(E===P?null:g.subarray(E,P))}var O=g[a+p.length+1];this.keys=g.subarray(g[a+p.length],O),this.bboxes=g.subarray(O),this.insert=this._insertReadonly}else{this.d=u+2*h;for(var D=0;D<this.d*this.d;D++)p.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=i,this.padding=h,this.scale=u/i,this.uid=0;var L=h/u*i;this.min=-L,this.max=i+L}return e.prototype.insert=function(i,u,h,p,g){this._forEachCell(u,h,p,g,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(g)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,u,h,p,g,w){this.cells[g].push(w)},e.prototype.query=function(i,u,h,p,g){var w=this.min,E=this.max;if(i<=w&&u<=w&&E<=h&&E<=p&&!g)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(i,u,h,p,this._queryCell,P,{},g),P},e.prototype._queryCell=function(i,u,h,p,g,w,E,P){var O=this.cells[g];if(O!==null)for(var D=this.keys,L=this.bboxes,U=0;U<O.length;U++){var $=O[U];if(E[$]===void 0){var X=4*$;(P?P(L[X+0],L[X+1],L[X+2],L[X+3]):i<=L[X+2]&&u<=L[X+3]&&h>=L[X+0]&&p>=L[X+1])?(E[$]=!0,w.push(D[$])):E[$]=!1}}},e.prototype._forEachCell=function(i,u,h,p,g,w,E,P){for(var O=this._convertToCellCoord(i),D=this._convertToCellCoord(u),L=this._convertToCellCoord(h),U=this._convertToCellCoord(p),$=O;$<=L;$++)for(var X=D;X<=U;X++){var J=this.d*X+$;if((!P||P(this._convertFromCellCoord($),this._convertFromCellCoord(X),this._convertFromCellCoord($+1),this._convertFromCellCoord(X+1)))&&g.call(this,i,u,h,p,J,w,E,P))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,u=a+this.cells.length+1+1,h=0,p=0;p<this.cells.length;p++)h+=this.cells[p].length;var g=new Int32Array(u+h+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var w=u,E=0;E<i.length;E++){var P=i[E];g[a+E]=w,g.set(P,w),w+=P.length}return g[a+i.length]=w,g.set(this.keys,w),g[a+i.length+1]=w+=this.keys.length,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer},Mf})(),Ha=al(Ga);const Iu={};function ir(a,e,i={}){Object.defineProperty(a,"_classRegistryKey",{value:e,writable:!1}),Iu[e]={klass:a,omit:i.omit||[]}}ir(Object,"Object"),Ha.serialize=function(a,e){const i=a.toArrayBuffer();return e&&e.add(i),{buffer:i}},Ha.deserialize=function(a){return new Ha(a.buffer)},Object.defineProperty(Ha,"name",{value:"Grid"}),ir(Ha,"Grid"),delete kt.prototype.constructor,typeof DOMMatrix<"u"&&ir(DOMMatrix,"DOMMatrix"),ir(wn,"Color"),ir(Error,"Error"),ir(ha,"Formatted"),ir(wd,"FormattedSection"),ir(bn,"AJAXError"),ir(Ia,"ResolvedImage"),ir(ql,"StylePropertyFunction"),ir(Oc,"StyleExpression",{omit:["_evaluator"]}),ir(ta,"ImageId"),ir(Rl,"ImageVariant"),ir(cs,"ZoomDependentExpression"),ir(Eu,"ZoomConstantExpression"),ir(bo,"CompoundExpression",{omit:["_evaluate"]});for(const a in xu)Iu[xu[a]._classRegistryKey]||ir(xu[a],`Expression${a}`);function ws(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Ss(a){return self.ImageBitmap&&a instanceof ImageBitmap}function Fs(a,e){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(ws(a)||Ss(a))return e&&e.add(a),a;if(ArrayBuffer.isView(a))return e&&e.add(a.buffer),a;if(a instanceof ImageData)return e&&e.add(a.data.buffer),a;if(Array.isArray(a)){const i=[];for(const u of a)i.push(Fs(u,e));return i}if(a instanceof Map){const i={$name:"Map",entries:[]};for(const[u,h]of a.entries())i.entries.push(Fs(u),Fs(h,e));return i}if(a instanceof Set){const i={$name:"Set"};let u=0;for(const h of a.values())i[++u]=Fs(h);return i}if(a instanceof DOMMatrix){const i={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of u)i[h]=a[h];return i}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){const i=a.constructor,u=i._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const h=i.serialize?i.serialize(a,e):{};if(!i.serialize){for(const p in a)a.hasOwnProperty(p)&&(Iu[u].omit.indexOf(p)>=0||(h[p]=Fs(a[p],e)));a instanceof Error&&(h.message=a.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof a)}function pa(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||ws(a)||Ss(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(pa);if(typeof a=="object"){const e=a.$name||"Object";if(e==="Map"){const h=a.entries||[],p=new Map;for(let g=0;g<h.length;g+=2)p.set(pa(h[g]),pa(h[g+1]));return p}if(e==="Set"){const h=new Set;for(const p of Object.keys(a))p!=="$name"&&h.add(pa(a[p]));return h}if(e==="DOMMatrix"){let h;return h=a.is2D?[a.a,a.b,a.c,a.d,a.e,a.f]:[a.m11,a.m12,a.m13,a.m14,a.m21,a.m22,a.m23,a.m24,a.m31,a.m32,a.m33,a.m34,a.m41,a.m42,a.m43,a.m44],new DOMMatrix(h)}if(e==="BigInt")return BigInt(a.value);const{klass:i}=Iu[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(a);const u=Object.create(i.prototype);for(const h of Object.keys(a))h!=="$name"&&(u[h]=pa(a[h]));return u}throw new Error("can't deserialize object of type "+typeof a)}const wr={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function xl(a){for(const e of a)if(Cu(e.charCodeAt(0)))return!0;return!1}function jd(a){for(const e of a)if(!Ym(e.charCodeAt(0)))return!1;return!0}function Ym(a){return!(wr.Arabic(a)||wr["Arabic Supplement"](a)||wr["Arabic Extended-A"](a)||wr["Arabic Presentation Forms-A"](a)||wr["Arabic Presentation Forms-B"](a))}function Cu(a){return!(a!==746&&a!==747&&(a<4352||!(wr["Bopomofo Extended"](a)||wr.Bopomofo(a)||wr["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||wr["CJK Compatibility Ideographs"](a)||wr["CJK Compatibility"](a)||wr["CJK Radicals Supplement"](a)||wr["CJK Strokes"](a)||!(!wr["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||wr["CJK Unified Ideographs Extension A"](a)||wr["CJK Unified Ideographs"](a)||wr["Enclosed CJK Letters and Months"](a)||wr["Hangul Compatibility Jamo"](a)||wr["Hangul Jamo Extended-A"](a)||wr["Hangul Jamo Extended-B"](a)||wr["Hangul Jamo"](a)||wr["Hangul Syllables"](a)||wr.Hiragana(a)||wr["Ideographic Description Characters"](a)||wr.Kanbun(a)||wr["Kangxi Radicals"](a)||wr["Katakana Phonetic Extensions"](a)||wr.Katakana(a)&&a!==12540||!(!wr["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!wr["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||wr["Unified Canadian Aboriginal Syllabics"](a)||wr["Unified Canadian Aboriginal Syllabics Extended"](a)||wr["Vertical Forms"](a)||wr["Yijing Hexagram Symbols"](a)||wr["Yi Syllables"](a)||wr["Yi Radicals"](a))))}function Of(a){return!(Cu(a)||(function(e){return!!(wr["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||wr["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||wr["Letterlike Symbols"](e)||wr["Number Forms"](e)||wr["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||wr["Control Pictures"](e)&&e!==9251||wr["Optical Character Recognition"](e)||wr["Enclosed Alphanumerics"](e)||wr["Geometric Shapes"](e)||wr["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||wr["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||wr["CJK Symbols and Punctuation"](e)||wr.Katakana(e)||wr["Private Use Area"](e)||wr["CJK Compatibility Forms"](e)||wr["Small Form Variants"](e)||wr["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(a))}function Eh(a){return wr.Arabic(a)||wr["Arabic Supplement"](a)||wr["Arabic Extended-A"](a)||wr["Arabic Presentation Forms-A"](a)||wr["Arabic Presentation Forms-B"](a)}function us(a){return a>=1424&&a<=2303||wr["Arabic Presentation Forms-A"](a)||wr["Arabic Presentation Forms-B"](a)}function Rf(a,e){return!(!e&&us(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||wr.Khmer(a))}function Df(a){for(const e of a)if(us(e.charCodeAt(0)))return!0;return!1}const Oo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let kf=null,To=Oo.unavailable,Gl=null;const Ud=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(To=Oo.error),kf&&kf(a)};function Qi(){Ah.fire(new cl("pluginStateChange",{pluginStatus:To,pluginURL:Gl}))}const Ah=new _c,Lf=function(){return To},Vd=function(){if(To!==Oo.deferred||!Gl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");To=Oo.loading,Qi(),Gl&&nf({url:Gl},(a=>{a?Ud(a):(To=Oo.loaded,Qi())}))},hs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>To===Oo.loaded||hs.applyArabicShaping!=null,isLoading:()=>To===Oo.loading,setState(a){To=a.pluginStatus,Gl=a.pluginURL},isParsing:()=>To===Oo.parsing,isParsed:()=>To===Oo.parsed,getPluginURL:()=>Gl};class Un{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,u){for(const h of i)if(!Rf(h.charCodeAt(0),u))return!1;return!0})(e,hs.isLoaded())}}class Bs{constructor(e,i,u,h){this.property=e,this.value=i,this.expression=(function(p,g,w,E){if(Af(p))return new ql(p,g);if(Nd(p)||Array.isArray(p)&&p.length>0){const P=Cf(p,g,w,E);if(P.result==="error")throw new Error(P.value.map((O=>`${O.key}: ${O.message}`)).join(", "));return P.value}{let P=p;return typeof p=="string"&&g.type==="color"&&(P=wn.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>P}}})(i===void 0?e.specification.default:i,e.specification,u,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,u){return this.property.possiblyEvaluate(this,e,i,u)}}class Zi{constructor(e,i,u){this.property=e,this.value=new Bs(e,void 0,i,u)}transitioned(e,i){return new jo(this.property,this.value,i,nt({},e.transition,this.transition),e.now)}untransitioned(){return new jo(this.property,this.value,null,{},0)}}class so{constructor(e,i,u){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=u,this.configDependencies=new Set}getValue(e){return Jr(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Zi(this._values[e].property,this._scope,this._options)),this._values[e].value=new Bs(this._values[e].property,i===null?void 0:Jr(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const u=this._properties.properties;if(e)for(const h in e){const p=e[h];if(h.endsWith("-transition")){const g=h.slice(0,-11);u[g]&&this.setTransition(g,p)}else u.hasOwnProperty(h)&&this.setValue(h,p)}}getTransition(e){return Jr(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Zi(this._values[e].property)),this._values[e].transition=Jr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const u=this.getValue(i);u!==void 0&&(e[i]=u);const h=this.getTransition(i);h!==void 0&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const u=new zf(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(e,i._values[h]);return u}untransitioned(){const e=new zf(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class jo{constructor(e,i,u,h,p){const g=h.delay||0,w=h.duration||0;p=p||0,this.property=e,this.value=i,this.begin=p+g,this.end=this.begin+w,e.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(e,i,u){const h=e.now||0,p=this.value.possiblyEvaluate(e,i,u),g=this.prior;if(g){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return g.possiblyEvaluate(e,i,u);{const w=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,u),p,se(w))}}return p}}class zf{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,u){const h=new js(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,i,u);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ts{constructor(e,i,u){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=u,this.configDependencies=new Set}getValue(e){return Jr(this._values[e].value)}setValue(e,i){this._values[e]=new Bs(this._values[e].property,i===null?void 0:Jr(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const u=this.getValue(i);u!==void 0&&(e[i]=u)}return e}possiblyEvaluate(e,i,u){const h=new js(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,i,u);return h}}class Ns{constructor(e,i,u){this.property=e,this.value=i,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,u,h){return this.property.evaluate(this.value,this.parameters,e,i,u,h)}}class js{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ct{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,u){const h=Ml[this.specification.type];return h?h(e,i,u):e}}class Qt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,u,h){return new Ns(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},u,h)}:e.expression,i)}interpolate(e,i,u){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ns(this,{kind:"constant",value:void 0},e.parameters);const h=Ml[this.specification.type];return h?new Ns(this,{kind:"constant",value:h(e.value.value,i.value.value,u)},e.parameters):e}evaluate(e,i,u,h,p,g){return e.kind==="constant"?e.value:e.evaluate(i,u,h,p,g)}}class Rc{constructor(e){this.specification=e}possiblyEvaluate(e,i,u,h){return!!e.expression.evaluate(i,null,{},u,h)}interpolate(){return!1}}class Ai{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Un(0,{});for(const u in e){const h=e[u];h.specification.overridable&&this.overridableProperties.push(u);const p=this.defaultPropertyValues[u]=new Bs(h,void 0),g=this.defaultTransitionablePropertyValues[u]=new Zi(h);this.defaultTransitioningPropertyValues[u]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=p.possiblyEvaluate(i)}}}ir(Qt,"DataDrivenProperty"),ir(Ct,"DataConstantProperty"),ir(Rc,"ColorRampProperty");var Ge=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"expression"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function fs(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Hl(a){if(Array.isArray(a))return a.map(Hl);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const e={};for(const i in a)e[i]=Hl(a[i]);return e}return fs(a)}function Mu(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const e of a.slice(1))if(!Mu(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Dc(a,e="",i=null,u="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Mu(a)||(a=Bf(a));const h=a;let p=!0;try{p=(function(O){if(!Ou(O))return O;let D=Hl(O);return Ff(D),D=$d(D),D})(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let g=null,w=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){w=Ge[`filter_${u}`];const O=vl(p,w,e,i);if(O.result==="error")throw new Error(O.value.map((D=>`${D.key}: ${D.message}`)).join(", "));g=(D,L,U)=>O.value.evaluate(D,L,{},U)}let E=null,P=null;if(p!==h){const O=vl(h,w,e,i);if(O.result==="error")throw new Error(O.value.map((D=>`${D.key}: ${D.message}`)).join(", "));E=(D,L,U,$,X)=>O.value.evaluate(D,L,{},U,void 0,void 0,$,X),P=!Fl(O.value.expression)}return{filter:g,dynamicFilter:E||void 0,needGeometry:qd(p),needFeature:!!P}}function $d(a){if(!Array.isArray(a))return a;const e=(function(i){if(Us.has(i[0])){for(let u=1;u<i.length;u++)if(Ou(i[u]))return!0}return i})(a);return e===!0?e:e.map((i=>$d(i)))}function Ff(a){let e=!1;const i=[];if(a[0]==="case"){for(let u=1;u<a.length-1;u+=2)e=e||Ou(a[u]),i.push(a[u+1]);i.push(a[a.length-1])}else if(a[0]==="match"){e=e||Ou(a[1]);for(let u=2;u<a.length-1;u+=2)i.push(a[u+1]);i.push(a[a.length-1])}else if(a[0]==="step"){e=e||Ou(a[1]);for(let u=1;u<a.length-1;u+=2)i.push(a[u+1])}e&&(a.length=0,a.push("any",...i));for(let u=1;u<a.length;u++)Ff(a[u])}function Ou(a){if(!Array.isArray(a))return!1;if((e=a[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<a.length;i++)if(Ou(a[i]))return!0;return!1}const Us=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Jm(a,e){return a<e?-1:a>e?1:0}function qd(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let e=1;e<a.length;e++)if(qd(a[e]))return!0;return!1}function Bf(a){if(!a)return!0;const e=a[0];return a.length<=1?e!=="any":e==="=="?Gd(a[1],a[2],"=="):e==="!="?Ru(Gd(a[1],a[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Gd(a[1],a[2],e):e==="any"?(i=a.slice(1),["any"].concat(i.map(Bf))):e==="all"?["all"].concat(a.slice(1).map(Bf)):e==="none"?["all"].concat(a.slice(1).map(Bf).map(Ru)):e==="in"?Ph(a[1],a.slice(2)):e==="!in"?Ru(Ph(a[1],a.slice(2))):e==="has"?Qp(a[1]):e!=="!has"||Ru(Qp(a[1]));var i}function Gd(a,e,i){switch(a){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,a,e]}}function Ph(a,e){if(e.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",a,["literal",e.sort(Jm)]]:["filter-in-small",a,["literal",e]]}}function Qp(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Ru(a){return["!",a]}const kc="";function Du(a,e){return e?`${a}${kc}${e}`:a}const Hd="-transition",Qm=new Set(["fill","line","background","hillshade","raster"]);class Zo extends _c{constructor(e,i,u,h,p){if(super(),this.id=e.id,this.fqid=Du(this.id,u),this.type=e.type,this.scope=u,this.lut=h,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const g=vl(this.filter,Ge[`filter_${e.type}`]);g.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...g.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new Ts(i.layout,this.scope,p),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new so(i.paint,this.scope,p);for(const g in e.paint)this.setPaintProperty(g,e.paint[g]);for(const g in e.layout)this.setLayoutProperty(g,e.layout[g]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new js(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Qm.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const u=this._unevaluatedLayout;u._properties.properties[e]&&(u.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Hd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const u=this._transitionablePaint,h=u._properties.properties;if(e.endsWith(Hd)){const D=e.slice(0,-11);return h[D]&&u.setTransition(D,i||void 0),!1}if(!h[e])return!1;const p=u._values[e],g=p.value.isDataDriven(),w=p.value;u.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const E=u._values[e].value,P=E.isDataDriven(),O=e.endsWith("pattern")||e==="line-dasharray";return P||g||O||this._handleOverridablePaintPropertyUpdate(e,w,E)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,u){return null}_handleOverridablePaintPropertyUpdate(e,i,u){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return ln({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ns&&Th(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Dc(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,u,h,p,g,w,E,P){}}const eg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ih{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ni{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function mn(a,e=1){let i=0,u=0;return{members:a.map((h=>{const p=eg[h.type].BYTES_PER_ELEMENT,g=i=Wd(i,Math.max(e,p)),w=h.components||1;return u=Math.max(u,p),i+=p*w,{name:h.name,type:h.type,components:w,offset:g}})),size:Wd(i,Math.max(u,e)),alignment:e}}function Wd(a,e){return Math.ceil(a/e)*e}class ma extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const u=this.length;return this.resize(u+1),this.emplace(u,e,i)}emplace(e,i,u){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=u,e}}ma.prototype.bytesPerElement=4,ir(ma,"StructArrayLayout2i4");class Ch extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,u)}emplace(e,i,u,h){const p=3*e;return this.int16[p+0]=i,this.int16[p+1]=u,this.int16[p+2]=h,e}}Ch.prototype.bytesPerElement=6,ir(Ch,"StructArrayLayout3i6");class ku extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,u,h)}emplace(e,i,u,h,p){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=u,this.int16[g+2]=h,this.int16[g+3]=p,e}}ku.prototype.bytesPerElement=8,ir(ku,"StructArrayLayout4i8");class Lu extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Lu.prototype.bytesPerElement=4,ir(Lu,"StructArrayLayout1f4");class em extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,u)}emplace(e,i,u,h){const p=4*e,g=2*e;return this.int16[p+0]=i,this.int16[p+1]=u,this.float32[g+1]=h,e}}em.prototype.bytesPerElement=8,ir(em,"StructArrayLayout2i1f8");class Zd extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,u)}emplace(e,i,u,h){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=u,this.int16[p+2]=h,e}}Zd.prototype.bytesPerElement=8,ir(Zd,"StructArrayLayout3i8");class Nf extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,u,h,p)}emplace(e,i,u,h,p,g){const w=5*e;return this.int16[w+0]=i,this.int16[w+1]=u,this.int16[w+2]=h,this.int16[w+3]=p,this.int16[w+4]=g,e}}Nf.prototype.bytesPerElement=10,ir(Nf,"StructArrayLayout5i10");class jf extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,u,h,p,g,w)}emplace(e,i,u,h,p,g,w,E){const P=6*e,O=12*e,D=3*e;return this.int16[P+0]=i,this.int16[P+1]=u,this.uint8[O+4]=h,this.uint8[O+5]=p,this.uint8[O+6]=g,this.uint8[O+7]=w,this.float32[D+2]=E,e}}jf.prototype.bytesPerElement=12,ir(jf,"StructArrayLayout2i4ub1f12");class ga extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,u)}emplace(e,i,u,h){const p=3*e;return this.float32[p+0]=i,this.float32[p+1]=u,this.float32[p+2]=h,e}}ga.prototype.bytesPerElement=12,ir(ga,"StructArrayLayout3f12");class Lc extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,u,h,p)}emplace(e,i,u,h,p,g){const w=6*e,E=3*e;return this.uint16[w+0]=i,this.uint16[w+1]=u,this.uint16[w+2]=h,this.uint16[w+3]=p,this.float32[E+2]=g,e}}Lc.prototype.bytesPerElement=12,ir(Lc,"StructArrayLayout4ui1f12");class Mh extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,u,h)}emplace(e,i,u,h,p){const g=4*e;return this.uint16[g+0]=i,this.uint16[g+1]=u,this.uint16[g+2]=h,this.uint16[g+3]=p,e}}Mh.prototype.bytesPerElement=8,ir(Mh,"StructArrayLayout4ui8");class Xd extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,u,h,p,g)}emplace(e,i,u,h,p,g,w){const E=6*e;return this.int16[E+0]=i,this.int16[E+1]=u,this.int16[E+2]=h,this.int16[E+3]=p,this.int16[E+4]=g,this.int16[E+5]=w,e}}Xd.prototype.bytesPerElement=12,ir(Xd,"StructArrayLayout6i12");class Wa extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g,w,E,P,O,D,L){const U=this.length;return this.resize(U+1),this.emplace(U,e,i,u,h,p,g,w,E,P,O,D,L)}emplace(e,i,u,h,p,g,w,E,P,O,D,L,U){const $=12*e;return this.int16[$+0]=i,this.int16[$+1]=u,this.int16[$+2]=h,this.int16[$+3]=p,this.uint16[$+4]=g,this.uint16[$+5]=w,this.uint16[$+6]=E,this.uint16[$+7]=P,this.int16[$+8]=O,this.int16[$+9]=D,this.int16[$+10]=L,this.int16[$+11]=U,e}}Wa.prototype.bytesPerElement=24,ir(Wa,"StructArrayLayout4i4ui4i24");class zc extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,u,h,p,g)}emplace(e,i,u,h,p,g,w){const E=10*e,P=5*e;return this.int16[E+0]=i,this.int16[E+1]=u,this.int16[E+2]=h,this.float32[P+2]=p,this.float32[P+3]=g,this.float32[P+4]=w,e}}zc.prototype.bytesPerElement=20,ir(zc,"StructArrayLayout3i3f20");class Vs extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,u,h)}emplace(e,i,u,h,p){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=u,this.float32[g+2]=h,this.float32[g+3]=p,e}}Vs.prototype.bytesPerElement=16,ir(Vs,"StructArrayLayout4f16");class Kd extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Kd.prototype.bytesPerElement=4,ir(Kd,"StructArrayLayout1ul4");class $s extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const u=this.length;return this.resize(u+1),this.emplace(u,e,i)}emplace(e,i,u){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=u,e}}$s.prototype.bytesPerElement=4,ir($s,"StructArrayLayout2ui4");class Yd extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g,w,E,P,O,D,L,U){const $=this.length;return this.resize($+1),this.emplace($,e,i,u,h,p,g,w,E,P,O,D,L,U)}emplace(e,i,u,h,p,g,w,E,P,O,D,L,U,$){const X=20*e,J=10*e;return this.int16[X+0]=i,this.int16[X+1]=u,this.int16[X+2]=h,this.int16[X+3]=p,this.int16[X+4]=g,this.float32[J+3]=w,this.float32[J+4]=E,this.float32[J+5]=P,this.float32[J+6]=O,this.int16[X+14]=D,this.uint32[J+8]=L,this.uint16[X+18]=U,this.uint16[X+19]=$,e}}Yd.prototype.bytesPerElement=40,ir(Yd,"StructArrayLayout5i4f1i1ul2ui40");class Oh extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,u,h,p,g,w)}emplace(e,i,u,h,p,g,w,E){const P=8*e;return this.int16[P+0]=i,this.int16[P+1]=u,this.int16[P+2]=h,this.int16[P+4]=p,this.int16[P+5]=g,this.int16[P+6]=w,this.int16[P+7]=E,e}}Oh.prototype.bytesPerElement=16,ir(Oh,"StructArrayLayout3i2i2i16");class qs extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,u,h,p)}emplace(e,i,u,h,p,g){const w=4*e,E=8*e;return this.float32[w+0]=i,this.float32[w+1]=u,this.float32[w+2]=h,this.int16[E+6]=p,this.int16[E+7]=g,e}}qs.prototype.bytesPerElement=16,ir(qs,"StructArrayLayout2f1f2i16");class Fc extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,u,h,p,g)}emplace(e,i,u,h,p,g,w){const E=20*e,P=5*e;return this.uint8[E+0]=i,this.uint8[E+1]=u,this.float32[P+1]=h,this.float32[P+2]=p,this.float32[P+3]=g,this.float32[P+4]=w,e}}Fc.prototype.bytesPerElement=20,ir(Fc,"StructArrayLayout2ub4f20");class ai extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,u)}emplace(e,i,u,h){const p=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=u,this.uint16[p+2]=h,e}}ai.prototype.bytesPerElement=6,ir(ai,"StructArrayLayout3ui6");class Rh extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g,w,E,P,O,D,L,U,$,X,J,ie,de,he,ge,Fe){const Me=this.length;return this.resize(Me+1),this.emplace(Me,e,i,u,h,p,g,w,E,P,O,D,L,U,$,X,J,ie,de,he,ge,Fe)}emplace(e,i,u,h,p,g,w,E,P,O,D,L,U,$,X,J,ie,de,he,ge,Fe,Me){const Oe=30*e,je=15*e,Ue=60*e;return this.int16[Oe+0]=i,this.int16[Oe+1]=u,this.int16[Oe+2]=h,this.float32[je+2]=p,this.float32[je+3]=g,this.uint16[Oe+8]=w,this.uint16[Oe+9]=E,this.uint32[je+5]=P,this.uint32[je+6]=O,this.uint32[je+7]=D,this.uint16[Oe+16]=L,this.uint16[Oe+17]=U,this.uint16[Oe+18]=$,this.float32[je+10]=X,this.float32[je+11]=J,this.uint8[Ue+48]=ie,this.uint8[Ue+49]=de,this.uint8[Ue+50]=he,this.uint32[je+13]=ge,this.int16[Oe+28]=Fe,this.uint8[Ue+58]=Me,e}}Rh.prototype.bytesPerElement=60,ir(Rh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Jd extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g,w,E,P,O,D,L,U,$,X,J,ie,de,he,ge,Fe,Me,Oe,je,Ue,ut,Ze,_t,qt,Et,Lt,Ut,lt){const zt=this.length;return this.resize(zt+1),this.emplace(zt,e,i,u,h,p,g,w,E,P,O,D,L,U,$,X,J,ie,de,he,ge,Fe,Me,Oe,je,Ue,ut,Ze,_t,qt,Et,Lt,Ut,lt)}emplace(e,i,u,h,p,g,w,E,P,O,D,L,U,$,X,J,ie,de,he,ge,Fe,Me,Oe,je,Ue,ut,Ze,_t,qt,Et,Lt,Ut,lt,zt){const Qe=20*e,ct=40*e,Gt=80*e;return this.float32[Qe+0]=i,this.float32[Qe+1]=u,this.int16[ct+4]=h,this.int16[ct+5]=p,this.int16[ct+6]=g,this.int16[ct+7]=w,this.int16[ct+8]=E,this.int16[ct+9]=P,this.int16[ct+10]=O,this.int16[ct+11]=D,this.int16[ct+12]=L,this.uint16[ct+13]=U,this.uint16[ct+14]=$,this.uint16[ct+15]=X,this.uint16[ct+16]=J,this.uint16[ct+17]=ie,this.uint16[ct+18]=de,this.uint16[ct+19]=he,this.uint16[ct+20]=ge,this.uint16[ct+21]=Fe,this.uint16[ct+22]=Me,this.uint16[ct+23]=Oe,this.uint16[ct+24]=je,this.uint16[ct+25]=Ue,this.uint16[ct+26]=ut,this.uint16[ct+27]=Ze,this.uint32[Qe+14]=_t,this.float32[Qe+15]=qt,this.float32[Qe+16]=Et,this.float32[Qe+17]=Lt,this.float32[Qe+18]=Ut,this.uint8[Gt+76]=lt,this.uint16[ct+39]=zt,e}}Jd.prototype.bytesPerElement=80,ir(Jd,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Qd extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,u,h,p,g)}emplace(e,i,u,h,p,g,w){const E=6*e;return this.float32[E+0]=i,this.float32[E+1]=u,this.float32[E+2]=h,this.float32[E+3]=p,this.float32[E+4]=g,this.float32[E+5]=w,e}}Qd.prototype.bytesPerElement=24,ir(Qd,"StructArrayLayout6f24");class Bc extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,u,h,p)}emplace(e,i,u,h,p,g){const w=5*e;return this.float32[w+0]=i,this.float32[w+1]=u,this.float32[w+2]=h,this.float32[w+3]=p,this.float32[w+4]=g,e}}Bc.prototype.bytesPerElement=20,ir(Bc,"StructArrayLayout5f20");class ep extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,u,h,p,g,w)}emplace(e,i,u,h,p,g,w,E){const P=7*e;return this.float32[P+0]=i,this.float32[P+1]=u,this.float32[P+2]=h,this.float32[P+3]=p,this.float32[P+4]=g,this.float32[P+5]=w,this.float32[P+6]=E,e}}ep.prototype.bytesPerElement=28,ir(ep,"StructArrayLayout7f28");class Dh extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g,w,E,P,O,D){const L=this.length;return this.resize(L+1),this.emplace(L,e,i,u,h,p,g,w,E,P,O,D)}emplace(e,i,u,h,p,g,w,E,P,O,D,L){const U=11*e;return this.float32[U+0]=i,this.float32[U+1]=u,this.float32[U+2]=h,this.float32[U+3]=p,this.float32[U+4]=g,this.float32[U+5]=w,this.float32[U+6]=E,this.float32[U+7]=P,this.float32[U+8]=O,this.float32[U+9]=D,this.float32[U+10]=L,e}}Dh.prototype.bytesPerElement=44,ir(Dh,"StructArrayLayout11f44");class tm extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g,w,E,P){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,u,h,p,g,w,E,P)}emplace(e,i,u,h,p,g,w,E,P,O){const D=9*e;return this.float32[D+0]=i,this.float32[D+1]=u,this.float32[D+2]=h,this.float32[D+3]=p,this.float32[D+4]=g,this.float32[D+5]=w,this.float32[D+6]=E,this.float32[D+7]=P,this.float32[D+8]=O,e}}tm.prototype.bytesPerElement=36,ir(tm,"StructArrayLayout9f36");class Eo extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const u=this.length;return this.resize(u+1),this.emplace(u,e,i)}emplace(e,i,u){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=u,e}}Eo.prototype.bytesPerElement=8,ir(Eo,"StructArrayLayout2f8");class aa extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,u,h)}emplace(e,i,u,h,p){const g=6*e;return this.uint32[3*e+0]=i,this.uint16[g+2]=u,this.uint16[g+3]=h,this.uint16[g+4]=p,e}}aa.prototype.bytesPerElement=12,ir(aa,"StructArrayLayout1ul3ui12");class tp extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}tp.prototype.bytesPerElement=2,ir(tp,"StructArrayLayout1ui2");class Uf extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g,w,E,P,O,D,L,U,$,X,J){const ie=this.length;return this.resize(ie+1),this.emplace(ie,e,i,u,h,p,g,w,E,P,O,D,L,U,$,X,J)}emplace(e,i,u,h,p,g,w,E,P,O,D,L,U,$,X,J,ie){const de=16*e;return this.float32[de+0]=i,this.float32[de+1]=u,this.float32[de+2]=h,this.float32[de+3]=p,this.float32[de+4]=g,this.float32[de+5]=w,this.float32[de+6]=E,this.float32[de+7]=P,this.float32[de+8]=O,this.float32[de+9]=D,this.float32[de+10]=L,this.float32[de+11]=U,this.float32[de+12]=$,this.float32[de+13]=X,this.float32[de+14]=J,this.float32[de+15]=ie,e}}Uf.prototype.bytesPerElement=64,ir(Uf,"StructArrayLayout16f64");class zu extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,g,w){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,u,h,p,g,w)}emplace(e,i,u,h,p,g,w,E){const P=10*e,O=5*e;return this.uint16[P+0]=i,this.uint16[P+1]=u,this.uint16[P+2]=h,this.uint16[P+3]=p,this.float32[O+2]=g,this.float32[O+3]=w,this.float32[O+4]=E,e}}zu.prototype.bytesPerElement=20,ir(zu,"StructArrayLayout4ui3f20");class rp extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}rp.prototype.bytesPerElement=2,ir(rp,"StructArrayLayout1i2");class Vf extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Vf.prototype.bytesPerElement=1,ir(Vf,"StructArrayLayout1ub1");class $f extends Ih{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}$f.prototype.size=40;class rm extends Yd{get(e){return new $f(this,e)}}ir(rm,"CollisionBoxArray");class kh extends Ih{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}kh.prototype.size=60;class Lh extends Rh{get(e){return new kh(this,e)}}ir(Lh,"PlacedSymbolArray");class np extends Ih{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}np.prototype.size=80;class ip extends Jd{get(e){return new np(this,e)}}ir(ip,"SymbolInstanceArray");class qf extends Lu{getoffsetX(e){return this.float32[1*e+0]}}ir(qf,"GlyphOffsetArray");class nm extends ma{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ir(nm,"SymbolLineVertexArray");class zh extends Ih{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}zh.prototype.size=12;class Gf extends aa{get(e){return new zh(this,e)}}ir(Gf,"FeatureIndexArray");class tg extends $s{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ir(tg,"FillExtrusionCentroidArray");class im extends Ih{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}im.prototype.size=6;class op extends Ch{get(e){return new im(this,e)}}ir(op,"FillExtrusionWallArray");const om=mn([{name:"a_pos",components:2,type:"Int16"}],4),ap=mn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Wl=mn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Si{constructor(e=[]){this.segments=e}_prepareSegment(e,i,u,h){let p=this.segments[this.segments.length-1];return e>Si.MAX_VERTEX_ARRAY_LENGTH&&fn(`Max vertices per segment is ${Si.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Si.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:i,primitiveOffset:u,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}prepareSegment(e,i,u,h){return this._prepareSegment(e,i.length,u.length,h)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,u,h){return new Si([{vertexOffset:e,primitiveOffset:i,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}function am(a,e){return 256*(a=we(Math.floor(a),0,255))+we(Math.floor(e),0,255)}Si.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ir(Si,"SegmentVector");const sm=mn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),sp=mn([{name:"a_pattern_b",components:4,type:"Uint16"}]),rg=mn([{name:"a_dash",components:4,type:"Uint16"}]);class Zl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,u,h){this.ids.push(Ro(e)),this.positions.push(i,u,h)}eachPosition(e,i){const u=Ro(e);let h=0,p=this.ids.length-1;for(;h<p;){const g=h+p>>1;this.ids[g]>=u?p=g:h=g+1}for(;this.ids[h]===u;)i(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,i){const u=new Float64Array(e.ids),h=new Uint32Array(e.positions);return lm(u,h,0,u.length-1),i&&(i.add(u.buffer),i.add(h.buffer)),{ids:u,positions:h}}static deserialize(e){const i=new Zl;let u;i.ids=e.ids,i.positions=e.positions;for(const h of i.ids)h!==u&&i.uniqueIds.push(h),u=h;return i.indexed=!0,i}}function Ro(a){const e=+a;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:gc(String(a))}function lm(a,e,i,u){for(;i<u;){const h=a[i+u>>1];let p=i-1,g=u+1;for(;;){do p++;while(a[p]<h);do g--;while(a[g]>h);if(p>=g)break;lp(a,p,g),lp(e,3*p,3*g),lp(e,3*p+1,3*g+1),lp(e,3*p+2,3*g+2)}g-i<u-g?(lm(a,e,i,g),i=g+1):(lm(a,e,g+1,u),u=g)}}function lp(a,e,i){const u=a[e];a[e]=a[i],a[i]=u}ir(Zl,"FeaturePositionMap");class Ma{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Uo extends Ma{constructor(e){super(e),this.current=0}set(e,i,u){this.fetchUniformLocation(e,i)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class qi extends Ma{constructor(e){super(e),this.current=0}set(e,i,u){this.fetchUniformLocation(e,i)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class jr extends Ma{constructor(e){super(e),this.current=[0,0]}set(e,i,u){this.fetchUniformLocation(e,i)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Gs extends Ma{constructor(e){super(e),this.current=[0,0,0]}set(e,i,u){this.fetchUniformLocation(e,i)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class Fu extends Ma{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,u){this.fetchUniformLocation(e,i)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class cp extends Ma{constructor(e){super(e),this.current=wn.transparent.toPremultipliedRenderColor(null)}set(e,i,u){this.fetchUniformLocation(e,i)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const ng=new Float32Array(16);class Xl extends Ma{constructor(e){super(e),this.current=ng}set(e,i,u){if(this.fetchUniformLocation(e,i)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const up=new Float32Array(9),hp=new Float32Array(4);class fp extends Ma{constructor(e){super(e),this.current=hp}set(e,i,u){if(this.fetchUniformLocation(e,i)){for(let h=0;h<4;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function dp(a){return[am(255*a.r,255*a.g),am(255*a.b,255*a.a)]}class Fh{constructor(e,i,u,h){this.value=e,this.uniformNames=i.map((p=>`u_${p}`)),this.type=u,this.context=h}setUniform(e,i,u,h,p){const g=h.constantOr(this.value);i.set(e,p,g instanceof wn?g.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(e,i){return this.type==="color"?new cp(e):new qi(e)}}class Nc{constructor(e,i){this.uniformNames=i.map((u=>`u_${u}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,u,h,p){let g=null;p!=="u_pattern"&&p!=="u_dash"||(g=this.pattern),p==="u_pattern_b"&&(g=this.patternTransition),p==="u_pixel_ratio"&&(g=this.pixelRatio),g&&i.set(e,p,g)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Fu(e):new qi(e)}}class Hs{constructor(e,i,u,h){this.expression=e,this.type=u,this.maxValue=0,this.paintVertexAttributes=i.map((p=>({name:`a_${p}`,type:"Float32",components:u==="color"?2:1,offset:0}))),this.paintVertexArray=new h}populatePaintArray(e,i,u,h,p,g,w,E){const P=this.paintVertexArray.length,O=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Un(0,{brightness:g,worldview:E}),i,{},p,h,w):this.expression.kind==="constant"&&this.expression.value,D=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Un(0,{brightness:g,worldview:E}),i,{},p,h,w):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(P,e,O,D?null:this.context.lut)}updatePaintArray(e,i,u,h,p,g,w,E){const P=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:w,worldview:E},u,h,void 0,p):this.expression.kind==="constant"&&this.expression.value,O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Un(0,{brightness:w,worldview:E}),u,h,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,i,P,O?null:this.context.lut)}_setPaintValue(e,i,u,h){if(this.type==="color"){const p=dp(u.toPremultipliedRenderColor(h));for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ni{constructor(e,i,u,h,p,g){this.expression=e,this.uniformNames=i.map((w=>`u_${w}_t`)),this.type=u,this.useIntegerZoom=h,this.context=p,this.maxValue=0,this.paintVertexAttributes=i.map((w=>({name:`a_${w}`,type:"Float32",components:u==="color"?4:2,offset:0}))),this.paintVertexArray=new g}populatePaintArray(e,i,u,h,p,g,w,E){const P=this.expression.evaluate(new Un(this.context.zoom,{brightness:g,worldview:E}),i,{},p,h,w),O=this.expression.evaluate(new Un(this.context.zoom+1,{brightness:g,worldview:E}),i,{},p,h,w),D=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Un(0,{brightness:g,worldview:E}),i,{},p,h,w):this.lutExpression.value)==="none",L=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(L,e,P,O,D?null:this.context.lut)}updatePaintArray(e,i,u,h,p,g,w,E){const P=this.expression.evaluate({zoom:this.context.zoom,brightness:w,worldview:E},u,h,void 0,p),O=this.expression.evaluate({zoom:this.context.zoom+1,brightness:w,worldview:E},u,h,void 0,p),D=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Un(0,{brightness:w,worldview:E}),u,h,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,i,P,O,D?null:this.context.lut)}_setPaintValue(e,i,u,h,p){if(this.type==="color"){const g=dp(u.toPremultipliedRenderColor(p)),w=dp(u.toPremultipliedRenderColor(p));for(let E=e;E<i;E++)this.paintVertexArray.emplace(E,g[0],g[1],w[0],w[1])}else{for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,u,h,p){const g=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,w=we(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);i.set(e,p,w)}getBinding(e,i){return new qi(e)}}class lo{constructor(e,i,u,h,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(u==="array"?rg:sm).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new h,this.paintTransitionVertexArray=new Mh}populatePaintArray(e,i,u,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(p,e,i.patterns&&i.patterns[this.layerId],u)}updatePaintArray(e,i,u,h,p,g,w){this._setPaintValues(e,i,u.patterns&&u.patterns[this.layerId],g)}_setPaintValues(e,i,u,h){if(!h||!u)return;const p=h[u[0]],g=h[u[1]];if(p){if(p){const{tl:w,br:E,pixelRatio:P}=p;for(let O=e;O<i;O++)this.paintVertexArray.emplace(O,w[0],w[1],E[0],E[1],P)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:w,br:E}=g;for(let P=e;P<i;P++)this.paintTransitionVertexArray.emplace(P,w[0],w[1],E[0],E[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,sp.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class co{constructor(e,i,u=(()=>!0)){this.binders={},this._buffers=[],this.context=i;const h=[];for(const p in e.paint._values){const g=e.paint.get(p);if(p.endsWith("-use-theme")||!u(p)||!(g instanceof Ns&&Th(g.property.specification)))continue;const w=Ws(p,e.type),E=g.value,P=g.property.specification.type,O=!!g.property.useIntegerZoom,D=p==="line-dasharray"||p.endsWith("pattern"),L=e.paint.get(`${p}-use-theme`),U=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||L&&L.value.kind!=="constant";if(E.kind!=="constant"||U)if(E.kind==="source"||U||D){const $=ag(p,P,"source");this.binders[p]=D?new lo(E,w,P,$,e.id):new Hs(E,w,P,$),h.push(`/a_${p}`)}else{const $=ag(p,P,"composite");this.binders[p]=new Ni(E,w,P,O,i,$),h.push(`/z_${p}`)}else this.binders[p]=D?new Nc(E.value,w):new Fh(E.value,w,P,i),h.push(`/u_${p}`);L&&(this.binders[p].lutExpression=L.value)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Hs||i instanceof Ni?i.maxValue:0}populatePaintArrays(e,i,u,h,p,g,w,E){for(const P in this.binders){const O=this.binders[P];O.context=this.context,(O instanceof Hs||O instanceof Ni||O instanceof lo)&&O.populatePaintArray(e,i,u,h,p,g,w,E)}}setConstantPatternPositions(e,i){for(const u in this.binders){const h=this.binders[u];h instanceof Nc&&h.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof lo?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,u,h,p,g,w,E,P,O){let D=!1;const L=Object.keys(e),U=L.length!==0&&!E,$=U?L:i.uniqueIds;this.context.lut=p.lut;for(const X in this.binders){const J=this.binders[X];if(J.context=this.context,(J instanceof Hs||J instanceof Ni||J instanceof lo)&&J.expression&&J.expression.kind&&J.expression.kind!=="constant"&&(J.expression.isStateDependent===!0||J.expression.isLightConstant===!1)){const ie=p.paint.get(X);J.expression=ie.value;for(const de of $){const he=e[de.toString()];i.eachPosition(de,((ge,Fe,Me)=>{const Oe=h.feature(ge);J.updatePaintArray(Fe,Me,Oe,he,g,w,P,O)}))}if(!U)for(const de of u.uniqueIds){const he=e[de.toString()];u.eachPosition(de,((ge,Fe,Me)=>{const Oe=h.feature(ge);J.updatePaintArray(Fe,Me,Oe,he,g,w,P,O)}))}D=!0}}return D}defines(){const e=[];for(const i in this.binders){const u=this.binders[i];(u instanceof Fh||u instanceof Nc)&&e.push(...u.uniformNames.map((h=>`#define HAS_UNIFORM_${h}`)))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const u=this.binders[i];if(u instanceof Hs||u instanceof Ni||u instanceof lo)for(let h=0;h<u.paintVertexAttributes.length;h++)e.push(u.paintVertexAttributes[h].name);if(u instanceof lo)for(let h=0;h<sp.members.length;h++)e.push(sp.members[h].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const u=this.binders[i];if(u instanceof Fh||u instanceof Nc||u instanceof Ni)for(const h of u.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof Fh||h instanceof Nc||h instanceof Ni)for(const p of h.uniformNames)i.push({name:p,property:u,binding:h.getBinding(e,p)})}return i}setUniforms(e,i,u,h,p){for(const{name:g,property:w,binding:E}of u)this.binders[w].setUniform(e,E,p,h.get(w),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Hs||i instanceof Ni||i instanceof lo)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof lo&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const u=this.binders[i];(u instanceof Hs||u instanceof Ni||u instanceof lo)&&u.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Hs||i instanceof Ni||i instanceof lo)&&i.destroy()}}}class Za{constructor(e,i,u=(()=>!0)){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new co(h,i,u);this.needsUpload=!1,this._featureMap=new Zl,this._featureMapWithoutIds=new Zl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,u,h,p,g,w,E,P){for(const O in this.programConfigurations)this.programConfigurations[O].populatePaintArrays(e,i,h,p,g,w,E,P);i.id!==void 0?this._featureMap.add(i.id,u,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,u,h,p,g,w,E){for(const P of u)this.needsUpload=this.programConfigurations[P.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,P,h,p,g,w||0,E)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const ig={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Ws(a,e){return ig[a]||[a.replace(`${e}-`,"").replace(/-/g,"_")]}const og={"line-pattern":{source:Lc,composite:Lc},"fill-pattern":{source:Lc,composite:Lc},"fill-extrusion-pattern":{source:Lc,composite:Lc},"line-dasharray":{source:Mh,composite:Mh}},bl={color:{source:Eo,composite:Vs},number:{source:Lu,composite:Eo}};function ag(a,e,i){const u=og[a];return u&&u[i]||bl[e][i]}ir(Fh,"ConstantBinder"),ir(Nc,"PatternConstantBinder"),ir(Hs,"SourceExpressionBinder"),ir(lo,"PatternCompositeBinder"),ir(Ni,"CompositeExpressionBinder"),ir(co,"ProgramConfiguration",{omit:["_buffers"]}),ir(Za,"ProgramConfigurationSet");const Xo=Wt/Math.PI/2,cm=5,f=6,n=16383,l=64,d=[l,32,16],y=-Xo,x=Xo;function S(a,e,i,u=Xo){return i=Cn(i),[a*Math.sin(i)*u,-e*u,a*Math.cos(i)*u]}function A(a,e,i){return S(Math.cos(Cn(a)),Math.sin(Cn(a)),e,i)}const C=63710088e-1,k=2*Math.PI*C;class z{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new z(it(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,u=this.lat*i,h=e.lat*i,p=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return C*Math.acos(Math.min(p,1))}toBounds(e=0){const i=360*e/40075017,u=i/Math.cos(Math.PI/180*this.lat);return new V({lng:this.lng-u,lat:this.lat-i},{lng:this.lng+u,lat:this.lat+i})}toEcef(e){return A(this.lat,this.lng,Xo+e*Xo/C)}static convert(e){if(e instanceof z)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new z(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new z(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class V{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const u=e;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=e;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(e){return this._ne=e instanceof z?new z(e.lng,e.lat):z.convert(e),this}setSouthWest(e){return this._sw=e instanceof z?new z(e.lng,e.lat):z.convert(e),this}extend(e){const i=this._sw,u=this._ne;let h,p;if(e instanceof z)h=e,p=e;else{if(!(e instanceof V))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(V.convert(e)):this.extend(z.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(z.convert(e)):this;if(h=e._sw,p=e._ne,!h||!p)return this}return i||u?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),u.lng=Math.max(p.lng,u.lng),u.lat=Math.max(p.lat,u.lat)):(this._sw=new z(h.lng,h.lat),this._ne=new z(p.lng,p.lat)),this}getCenter(){return new z((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new z(this.getWest(),this.getNorth())}getSouthEast(){return new z(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:u}=z.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(e){if(e)return e instanceof V?e:new V(e)}}const j=0,q=25.5;function Q(a){return k*Math.cos(a*Math.PI/180)}function Y(a){return(180+a)/360}function re(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function te(a,e){return a/Q(e)}function ce(a){return 360*a-180}function me(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function ye(a,e){return a*Q(me(e))}const Ee=85.051129;function Ce(a){return Math.cos(Cn(we(a,-Ee,Ee)))}function Re(a,e){const i=we(e,j,q),u=Math.pow(2,i);return Ce(a)*k/(512*u)}function Ae(a){return 1/Math.cos(a*Math.PI/180)}function Pe(a,e=0){const i=Math.exp(Math.PI*(1-(a.y+e/Wt)/(1<<a.z)*2));return 80150034*i/(i*i+1)/Wt/(1<<a.z)}class Ie{constructor(e,i,u=0){this.x=+e,this.y=+i,this.z=+u}static fromLngLat(e,i=0){const u=z.convert(e);return new Ie(Y(u.lng),re(u.lat),te(i,u.lat))}toLngLat(){return new z(ce(this.x),me(this.y))}toAltitude(){return ye(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/k*Ae(me(this.y))}}function Ye(a,e,i,u,h,p,g,w,E){const P=(e+u)/2,O=(i+h)/2,D=new kt(P,O);w(D),(function(L,U,$,X,J,ie){const de=$-J,he=X-ie;return Math.abs((X-U)*de-($-L)*he)/Math.hypot(de,he)})(D.x,D.y,p.x,p.y,g.x,g.y)>=E?(Ye(a,e,i,P,O,p,D,w,E),Ye(a,P,O,u,h,D,g,w,E)):a.push(g)}function Be(a,e,i){let u=a[0],h=u.x,p=u.y;e(u);const g=[u];for(let w=1;w<a.length;w++){const E=a[w],{x:P,y:O}=E;e(E),Ye(g,h,p,P,O,u,E,e,i),h=P,p=O,u=E}return g}function dt(a,e,i,u){if(u(e,i)){const h=e.add(i)._mult(.5);dt(a,e,h,u),dt(a,h,i,u)}else a.push(i)}function rt(a,e){let i=a[0];const u=[i];for(let h=1;h<a.length;h++){const p=a[h];dt(u,i,p,e),i=p}return u}const xt=Math.pow(2,14)-1,It=-xt-1;function We(a,e){const i=Math.round(a.x*e),u=Math.round(a.y*e);return a.x=we(i,It,xt),a.y=we(u,It,xt),(i<a.x||i>a.x+1||u<a.y||u>a.y+1)&&fn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function ze(a,e,i){const u=a.loadGeometry(),h=a.extent,p=Wt/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:w,x:E,y:P,projection:O}=i,D=L=>{const U=ce((e.x+L.x/h)/g),$=me((e.y+L.y/h)/g),X=O.project(U,$);L.x=(X.x*w-E)*h,L.y=(X.y*w-P)*h};for(let L=0;L<u.length;L++)if(a.type!==1)u[L]=Be(u[L],D,1);else{const U=[];for(const $ of u[L])$.x<0||$.x>=h||$.y<0||$.y>=h||(D($),U.push($));u[L]=U}}for(const g of u)for(const w of g)We(w,p);return u}function ot(a,e){return{type:a.type,id:a.id,properties:a.properties,geometry:e?ze(a):[]}}class tt{constructor(e,i,u,h,p){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=h,this._values=p,e.readFields(At,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,u=[];let h,p=1,g=0,w=0,E=0;for(;e.pos<i;){if(g<=0){const P=e.readVarint();p=7&P,g=P>>3}if(g--,p===1||p===2)w+=e.readSVarint(),E+=e.readSVarint(),p===1&&(h&&u.push(h),h=[]),h&&h.push(new kt(w,E));else{if(p!==7)throw new Error(`unknown command ${p}`);h&&h.push(h[0].clone())}}return h&&u.push(h),u}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let u=1,h=0,p=0,g=0,w=1/0,E=-1/0,P=1/0,O=-1/0;for(;e.pos<i;){if(h<=0){const D=e.readVarint();u=7&D,h=D>>3}if(h--,u===1||u===2)p+=e.readSVarint(),g+=e.readSVarint(),p<w&&(w=p),p>E&&(E=p),g<P&&(P=g),g>O&&(O=g);else if(u!==7)throw new Error(`unknown command ${u}`)}return[w,P,E,O]}toGeoJSON(e,i,u){const h=this.extent*Math.pow(2,u),p=this.extent*e,g=this.extent*i,w=this.loadGeometry();function E(L){return[360*(L.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(L.y+g)/h)*Math.PI))-90]}function P(L){return L.map(E)}let O;if(this.type===1){const L=[];for(const $ of w)L.push($[0]);const U=P(L);O=L.length===1?{type:"Point",coordinates:U[0]}:{type:"MultiPoint",coordinates:U}}else if(this.type===2){const L=w.map(P);O=L.length===1?{type:"LineString",coordinates:L[0]}:{type:"MultiLineString",coordinates:L}}else{if(this.type!==3)throw new Error("unknown feature type");{const L=(function($){const X=$.length;if(X<=1)return[$];const J=[];let ie,de;for(let he=0;he<X;he++){const ge=Pt($[he]);ge!==0&&(de===void 0&&(de=ge<0),de===ge<0?(ie&&J.push(ie),ie=[$[he]]):ie&&ie.push($[he]))}return ie&&J.push(ie),J})(w),U=[];for(const $ of L)U.push($.map(P));O=U.length===1?{type:"Polygon",coordinates:U[0]}:{type:"MultiPolygon",coordinates:U}}}const D={type:"Feature",geometry:O,properties:this.properties};return this.id!=null&&(D.id=this.id),D}}function At(a,e,i){a===1?e.id=i.readVarint():a===2?(function(u,h){const p=u.readVarint()+u.pos;for(;u.pos<p;){const g=h._keys[u.readVarint()],w=h._values[u.readVarint()];h.properties[g]=w}})(i,e):a===3?e.type=i.readVarint():a===4&&(e._geometry=i.pos)}function Pt(a){let e=0;for(let i,u,h=0,p=a.length,g=p-1;h<p;g=h++)i=a[h],u=a[g],e+=(u.x-i.x)*(i.y+u.y);return e}tt.types=["Unknown","Point","LineString","Polygon"];class Dt{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Bt,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new tt(this._pbf,i,this.extent,this._keys,this._values)}}function Bt(a,e,i){a===15?e.version=i.readVarint():a===1?e.name=i.readString():a===5?e.extent=i.readVarint():a===2?e._features.push(i.pos):a===3?e._keys.push(i.readString()):a===4&&e._values.push((function(u){let h=null;const p=u.readVarint()+u.pos;for(;u.pos<p;){const g=u.readVarint()>>3;h=g===1?u.readString():g===2?u.readFloat():g===3?u.readDouble():g===4?u.readVarint64():g===5?u.readVarint():g===6?u.readSVarint():g===7?u.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(i))}class cr{constructor(e,i){this.layers=e.readFields(pr,{},i)}}function pr(a,e,i){if(a===3){const u=new Dt(i,i.readVarint()+i.pos);u.length&&(e[u.name]=u)}}const Jt="3d_elevation_id",dr="level";class ur{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,u){return this.get(e,!0,i,u)}optional(e,i,u){return this.get(e,!1,i,u)}success(){return this._valid}get(e,i,u,h){const p=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&p!==void 0&&!Number.isNaN(p)?u(h?h(p):p):i&&(this._valid=!1),this}}class Lr{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,u){return this.featureFunc(e,i,u)}parseVertex(e,i,u){return this.vertexFunc(e,i,u)}}const Vr=new Lr(((a,e,i)=>a.reset(e).require(Jt,(u=>{i.id=u})).optional("fixed_height_relative",(u=>{i.constantHeight=u}),vn.decodeRelativeHeight).geometry((u=>{i.bounds=u}),jp).success()),((a,e,i)=>a.reset(e).require(Jt,(u=>{i.id=u})).require("elevation_idx",(u=>{i.idx=u})).require("extent",(u=>{i.extent=u})).require("height_relative",(u=>{i.height=u}),vn.decodeRelativeHeight).geometry((u=>{i.position=u}),vn.getPoint).success())),Xr=new Lr(((a,e,i)=>a.reset(e).require(Jt,(u=>{i.id=u})).optional("fixed_height",(u=>{i.constantHeight=u}),vn.decodeMetricHeight).geometry((u=>{i.bounds=u}),jp).success()),((a,e,i)=>a.reset(e).require(Jt,(u=>{i.id=u})).require("elevation_idx",(u=>{i.idx=u})).require("extent",(u=>{i.extent=u})).require("height",(u=>{i.height=u}),vn.decodeMetricHeight).geometry((u=>{i.position=u}),vn.getPoint).success()));class vn{static getPoint(e){return rs(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],u=[],h=e.length,p=new ur;for(let w=0;w<h;w++){const E=e.feature(w),P=E.properties.version,O=(g=P)?g==="1.0.1"?Xr:void 0:Vr;if(O===void 0){fn(`Unknown elevation feature version number ${P||"(unknown)"}`);continue}const D=E.properties.hasOwnProperty("type")?E.properties.type:void 0;if(D){if(tt.types[E.type]==="Point"&&D==="curve_point"){const L={};O.parseVertex(p,E,L)&&i.push(L)}else if(tt.types[E.type]==="Polygon"&&D==="curve_meta"){const L={};O.parseFeature(p,E,L)&&u.push(L)}}}var g;return{vertices:i,features:u}}}class Ur{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,u){const h=ii(i,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/h;return u[0]=this.pos[0]+this.dir[0]*p,u[1]=this.pos[1]+this.dir[1]*p,!0}}class Sn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,u){const h=vr(i,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/h;return u[0]=this.pos[0]+this.dir[0]*p,u[1]=this.pos[1]+this.dir[1]*p,u[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,i,u){if((function(U,$){var X=U[0],J=U[1],ie=U[2],de=$[0],he=$[1],ge=$[2];return Math.abs(X-de)<=M*Math.max(1,Math.abs(X),Math.abs(de))&&Math.abs(J-he)<=M*Math.max(1,Math.abs(J),Math.abs(he))&&Math.abs(ie-ge)<=M*Math.max(1,Math.abs(ie),Math.abs(ge))})(this.pos,e)||i===0)return u[0]=u[1]=u[2]=0,!1;const[h,p,g]=this.dir,w=this.pos[0]-e[0],E=this.pos[1]-e[1],P=this.pos[2]-e[2],O=h*h+p*p+g*g,D=2*(w*h+E*p+P*g),L=D*D-4*O*(w*w+E*E+P*P-i*i);if(L<0){const U=Math.max(-D/2,0),$=w+h*U,X=E+p*U,J=P+g*U,ie=Math.hypot($,X,J);return u[0]=$*i/ie,u[1]=X*i/ie,u[2]=J*i/ie,!1}{const U=(-D-Math.sqrt(L))/(2*O);if(U<0){const $=Math.hypot(w,E,P);return u[0]=w*i/$,u[1]=E*i/$,u[2]=P*i/$,!1}return u[0]=w+h*U,u[1]=E+p*U,u[2]=P+g*U,!0}}}class Mn{constructor(e,i,u,h,p){this.TL=e,this.TR=i,this.BR=u,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(e,i,u){const h=[-1,1,1],p=[1,1,1],g=[1,-1,1],w=[-1,-1,1],E=Ar(h,h,e),P=Ar(p,p,e),O=Ar(g,g,e),D=Ar(w,w,e);return new Mn(E,P,O,D,i/u)}}function Xn(a,e,i){let u=1/0,h=-1/0;const p=[];for(const g of a){In(p,g,e);const w=vr(p,i);u=Math.min(u,w),h=Math.max(h,w)}return[u,h]}function Hr(a,e){let i=!0;for(let u=0;u<a.planes.length;u++){const h=a.planes[u];let p=0;for(let g=0;g<e.length;g++)p+=vr(h,e[g])+h[3]>=0;if(p===0)return 0;p!==e.length&&(i=!1)}return i?2:1}function Tn(a,e){for(const i of a.projections){const u=Xn(e,a.points[0],i.axis);if(i.projection[1]<u[0]||i.projection[0]>u[1])return 0}return 1}function _n(a,e){let i=0;const u=[0,0,0,0];for(let g=0;g<a.length;g++)u[0]=a[g][0],u[1]=a[g][1],u[2]=a[g][2],u[3]=1,(h=u)[0]*(p=e)[0]+h[1]*p[1]+h[2]*p[2]+h[3]*p[3]>=0&&i++;var h,p;return i}class Ln{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Rr.fromPoints(this.points),this.projections=[],this.frustumEdges=[In([],this.points[2],this.points[3]),In([],this.points[0],this.points[3]),In([],this.points[4],this.points[0]),In([],this.points[5],this.points[1]),In([],this.points[6],this.points[2]),In([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const h=[0,-u[2],u[1]],p=[u[2],0,-u[0]];this.projections.push({axis:h,projection:Xn(this.points,this.points[0],h)}),this.projections.push({axis:p,projection:Xn(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(e,i,u,h){const p=Math.pow(2,u),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((P=>{const O=Vi([],P,e),D=1/O[3]/i*p;return(L=O)[0]=(U=O)[0]*($=[D,D,h?1/O[3]:D,D])[0],L[1]=U[1]*$[1],L[2]=U[2]*$[2],L[3]=U[3]*$[3],L;var L,U,$})),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((P=>{const O=Tr([],Br([],In([],g[P[0]],g[P[1]]),In([],g[P[2]],g[P[1]]))),D=-vr(O,g[P[1]]);return O.concat(D)})),E=[];for(let P=0;P<g.length;P++)E.push([g[P][0],g[P][1],g[P][2]]);return new Ln(E,w)}intersectsPrecise(e,i,u){for(let h=0;h<i.length;h++)if(!_n(e,i[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!_n(e,this.planes[h]))return 0;for(const h of u)for(const p of this.frustumEdges){const g=Br([],h,p),w=ft(g);if(w===0)continue;qe(g,g,1/w);const E=Xn(this.points,this.points[0],g),P=Xn(e,this.points[0],g);if(E[0]>P[1]||P[0]>E[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const u=i[3];if(vr([i[0],i[1],i[2]],e)+u<0)return!1}return!0}}class Rr{static fromPoints(e){const i=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const h of e)yt(i,i,h),Vt(u,u,h);return new Rr(i,u)}static fromTileIdAndHeight(e,i,u){const h=1<<e.canonical.z,p=e.canonical.x,g=e.canonical.y;return new Rr([p/h,g/h,i],[(p+1)/h,(g+1)/h,u])}static applyTransform(e,i){const u=e.getCorners();for(let h=0;h<u.length;++h)Ar(u[h],u[h],i);return Rr.fromPoints(u)}static applyTransformFast(e,i){const u=[i[12],i[13],i[14]],h=[...u];for(let p=0;p<3;p++)for(let g=0;g<3;g++){const w=i[4*g+p],E=w*e.min[g],P=w*e.max[g];u[p]+=Math.min(E,P),h[p]+=Math.max(E,P)}return new Rr(u,h)}static projectAabbCorners(e,i){const u=e.getCorners();for(let h=0;h<u.length;++h)Ar(u[h],u[h],i);return u}constructor(e,i){this.min=e,this.max=i,this.center=qe([],gt([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],u=vt(this.min),h=vt(this.max);for(let p=0;p<i.length;p++)u[p]=i[p]?this.min[p]:this.center[p],h[p]=i[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new Rr(u,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Hr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Hr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Tn(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Tn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ir(Rr,"Aabb");class Gn{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,u=i[1],h=-i[0],p=(e.extent+1)*this.metersToTile;return[new kt(Math.trunc(e.position[0]+u*p),Math.trunc(e.position[1]+h*p)),new kt(Math.trunc(e.position[0]-u*p),Math.trunc(e.position[1]-h*p))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class On{constructor(e,i,u,h,p,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:u,max:u},this.safeArea=i,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=p,this.edges=this.edges.filter((w=>{return w.a<this.vertices.length&&w.b<this.vertices.length&&!((E=this.vertices[w.a].position)[0]===(P=this.vertices[w.b].position)[0]&&E[1]===P[1]);var E,P})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const w of this.vertices)this.vertexProps.push({dir:rs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,w.height),this.heightRange.max=Math.max(this.heightRange.max,w.height);for(const w of this.edges){const E=this.vertices[w.a].position,P=this.vertices[w.b].position,O=il(xo(),P,E),D=ol(O),L=oc(xo(),O,1/D);this.edgeProps.push({vec:O,dir:L,len:D});const U=this.vertexProps[w.a].dir,$=this.vertexProps[w.b].dir;Al(U,U,L),Al($,$,L)}for(const w of this.vertexProps)w.dir[0]===0&&w.dir[1]===0||ac(w.dir,w.dir);this.tessellate(g)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[u,h]=i;return Sr(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,h)}computeSlopeNormal(e,i){const u=this.getClosestEdge(e);if(!u)return bt(0,0,1);const h=u[0],p=this.edges[h],g=this.edgeProps[h].vec,w=bt(g[0],g[1],(this.vertices[p.b].height-this.vertices[p.a].height)*i),E=bt(w[1],-w[0],0);Br(E,E,w);const P=ft(E);return P>0?qe(E,E,1/P):bt(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,u=Number.POSITIVE_INFINITY,h=0;const p=rs(e.x,e.y);for(let g=0;g<this.edges.length;g++){const w=this.edges[g],E=this.edgeProps[g].dir,P=new Ur(p,this.edgeProps[g].dir),O=this.vertices[w.a].position,D=this.vertices[w.b].position,L=xo(),U=xo(),$=P.intersectsPlane(O,this.vertexProps[w.a].dir,L),X=P.intersectsPlane(D,this.vertexProps[w.b].dir,U);if(!$||!X)continue;const J=il(xo(),U,L),ie=il(xo(),p,L),de=ii(J,J),he=de>0?ii(ie,J)/de:0,ge=we(he,0,1),Fe=Math.abs((he-ge)*this.edgeProps[g].len),Me=il(xo(),p,O),Oe=Fe+Math.abs(ii(Me,rs(E[1],-E[0])));Oe<u&&(i=g,u=Oe,h=ge)}return[i,h]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const u=this.edges[i].a,h=this.edges[i].b,{position:p,height:g,extent:w}=this.vertices[u],{position:E,height:P,extent:O}=this.vertices[h],D=this.vertexProps[u].dir,L=this.vertexProps[h].dir,U=bt(p[0]/e,p[1]/e,g),$=bt(E[0]/e,E[1]/e,P),X=bt(D[1],-D[0],0);qe(X,X,w);const J=bt(L[1],-L[0],0);if(qe(J,J,O),this.distSqLines(bt(U[0]+.5*X[0],U[1]+.5*X[1],U[2]+.5*X[2]),bt($[0]-.5*J[0],$[1]-.5*J[1],$[2]-.5*J[2]),bt(U[0]-.5*X[0],U[1]-.5*X[1],U[2]-.5*X[2]),bt($[0]+.5*J[0],$[1]+.5*J[1],$[2]+.5*J[2]))<=.0025000000000000005)continue;const ie=this.vertices.length,de=Al(xo(),p,E);this.vertices.push({position:oc(de,de,.5),height:.5*(g+P),extent:.5*(w+O)});const he=Al(xo(),D,L);this.vertexProps.push({dir:ac(he,he)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:u,b:ie}),this.edges.push({a:ie,b:h});const ge=il(xo(),this.vertices[ie].position,p),Fe=ol(ge),Me={vec:ge,dir:oc(xo(),ge,1/Fe),len:Fe};this.edgeProps.push(Me),this.edgeProps.push(Me)}}distSqLines(e,i,u,h){const p=Rt($e(),i,e),g=Rt($e(),h,u),w=Rt($e(),e,u),E=vr(p,p),P=vr(p,g),O=vr(p,w),D=vr(g,g),L=vr(g,w),U=E*D-P*P;if(U===0){const J=vr(w,g)/vr(g,g);return ar(or($e(),u,h,J),e)}const $=(P*L-O*D)/U,X=(E*L-P*O)/U;return ar(or($e(),e,i,$),or($e(),u,h,X))}}class Ti{static parseFrom(e,i){const u=vn.parse(e);if(!u)return[];let{vertices:h,features:p}=u;const g=1/Pe(i);p.sort(((O,D)=>O.id-D.id)),h.sort(((O,D)=>O.id-D.id||O.idx-D.idx)),h=h.filter(((O,D,L)=>D===L.findIndex((U=>U.id===O.id&&U.idx===O.idx))));const w=new Array;let E=0;const P=h.length;for(const O of p){if(O.constantHeight){w.push(new On(O.id,O.bounds,O.constantHeight));continue}for(;E!==P&&h[E].id<O.id;)E++;if(E===P||h[E].id!==O.id)continue;const D=new Array,L=new Array,U=E;for(;E!==P&&h[E].id===O.id;){const $=h[E];if(D.push({position:$.position,height:$.height,extent:$.extent}),E!==U&&h[E-1].idx===$.idx-1){const X=E-U;L.push({a:X-1,b:X})}E++}w.push(new On(O.id,O.bounds,void 0,D,L,g))}return w}static getElevationFeature(e,i){if(!i)return;const u=+e.properties[Jt];return Number.isNaN(u)?void 0:i.find((h=>h.id===u))}}class xn{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*Wt,this.yOffset=(e.y*this.zScale-i.y)*Wt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,u){const h=this.constantElevation(i,u);return h??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),u))}computeBiasedHeight(e,i){return i<=0?e:e+i*Ne(0,i,e>=0?e:Math.abs(.5*e))}}ir(On,"ElevationFeature");class zn{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ma,this.indexArray=new ai,this.segments=new Si,this.programConfigurations=new Za(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Lu),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,u,h){const p=this.layers[0],g=[];let w=null;p.type==="circle"&&(w=p.layout.get("circle-sort-key"));for(const{feature:P,id:O,index:D,sourceLayerIndex:L}of e){const U=this.layers[0]._featureFilter.needGeometry,$=ot(P,U);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{worldview:this.worldview}),$,u))continue;const X=w?w.evaluate($,{},u):void 0,J={id:O,properties:P.properties,type:P.type,sourceLayerIndex:L,index:D,geometry:U?$.geometry:ze(P,u,h),patterns:{},sortKey:X};g.push(J)}w&&g.sort(((P,O)=>P.sortKey-O.sortKey));let E=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Xd,E=h.projection);for(const P of g){const{geometry:O,index:D,sourceLayerIndex:L}=P,U=e[D].feature;this.addFeature(P,O,D,i.availableImages,u,E,i.brightness,i.elevationFeatures),i.featureIndex.insert(U,O,D,L,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,u,h,p,g,w){this.programConfigurations.updatePaintArrays(e,i,p,u,h,g,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,om.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Wl.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,ap.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,u,h,p,g,w,E){let P;this.elevationMode!=="none"&&(P=Ti.getElevationFeature(e,E));for(const O of i)for(const D of O){const L=D.x,U=D.y;if(L<0||L>=Wt||U<0||U>=Wt)continue;if(g){const J=g.projectTilePoint(L,U,p),ie=g.upVector(p,L,U);this.addGlobeExtVertex(J,ie),this.addGlobeExtVertex(J,ie),this.addGlobeExtVertex(J,ie),this.addGlobeExtVertex(J,ie)}const $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),X=$.vertexLength;if(this.addCircleVertex(L,U,-1,-1),this.addCircleVertex(L,U,1,-1),this.addCircleVertex(L,U,1,1),this.addCircleVertex(L,U,-1,1),this.elevationMode!=="none"){const J=P?P.pointElevation(new kt(L,U)):0;this.hasElevation=this.hasElevation||J!==0;for(let ie=0;ie<4;ie++)this.elevatedLayoutVertexArray.emplaceBack(J)}this.indexArray.emplaceBack(X,X+1,X+2),this.indexArray.emplaceBack(X,X+2,X+3),$.vertexLength+=4,$.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,{},h,p,w,void 0,this.worldview)}addCircleVertex(e,i,u,h){this.layoutVertexArray.emplaceBack(2*e+(u+1)/2,2*i+(h+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Wn(a,e){for(let i=0;i<a.length;i++)if(Yo(e,a[i]))return!0;for(let i=0;i<e.length;i++)if(Yo(a,e[i]))return!0;return!!Do(a,e)}function Gi(a,e,i){return!!Yo(a,e)||!!Ao(e,a,i)}function ti(a,e){if(a.length===1)return Xa(e,a[0]);for(let i=0;i<e.length;i++){const u=e[i];for(let h=0;h<u.length;h++)if(Yo(a,u[h]))return!0}for(let i=0;i<a.length;i++)if(Xa(e,a[i]))return!0;for(let i=0;i<e.length;i++)if(Do(a,e[i]))return!0;return!1}function ji(a,e,i){if(a.length>1){if(Do(a,e))return!0;for(let u=0;u<e.length;u++)if(Ao(e[u],a,i))return!0}for(let u=0;u<a.length;u++)if(Ao(a[u],e,i))return!0;return!1}function Do(a,e){if(a.length===0||e.length===0)return!1;for(let i=0;i<a.length-1;i++){const u=a[i],h=a[i+1];for(let p=0;p<e.length-1;p++)if(Ko(u,h,e[p],e[p+1]))return!0}return!1}function Ko(a,e,i,u){return Fi(a,i,u)!==Fi(e,i,u)&&Fi(a,e,i)!==Fi(a,e,u)}function Vo(a,e,i){return(a.x-i.x)*(e.y-i.y)-(a.y-i.y)*(e.x-i.x)}function ko(a,e,i,u){const h=Vo(a,e,u),p=Vo(a,e,i);if(Math.sign(h)===Math.sign(p))return;const g=Vo(i,u,a),w=g+p-h;return Math.sign(g)!==Math.sign(w)?[g/(g-w),p/(p-h)]:void 0}function Ao(a,e,i){const u=i*i;if(e.length===1)return a.distSqr(e[0])<u;for(let h=1;h<e.length;h++)if(Oa(a,e[h-1],e[h])<u)return!0;return!1}function Oa(a,e,i){const u=e.distSqr(i);if(u===0)return a.distSqr(e);const h=((a.x-e.x)*(i.x-e.x)+(a.y-e.y)*(i.y-e.y))/u;return a.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function Xa(a,e){let i,u,h,p=!1;for(let g=0;g<a.length;g++){i=a[g];for(let w=0,E=i.length-1;w<i.length;E=w++)u=i[w],h=i[E],u.y>e.y!=h.y>e.y&&e.x<(h.x-u.x)*(e.y-u.y)/(h.y-u.y)+u.x&&(p=!p)}return p}function Yo(a,e){let i=!1;for(let u=0,h=a.length-1;u<a.length;h=u++){const p=a[u],g=a[h];p.y>e.y!=g.y>e.y&&e.x<(g.x-p.x)*(e.y-p.y)/(g.y-p.y)+p.x&&(i=!i)}return i}function Mi(a,e,i,u,h){for(const g of a)if(e<=g.x&&i<=g.y&&u>=g.x&&h>=g.y)return!0;const p=[new kt(e,i),new kt(e,h),new kt(u,h),new kt(u,i)];if(a.length>2){for(const g of p)if(Yo(a,g))return!0}for(let g=0;g<a.length-1;g++)if(Oi(a[g],a[g+1],p))return!0;return!1}function Oi(a,e,i){const u=i[0],h=i[2];if(a.x<u.x&&e.x<u.x||a.x>h.x&&e.x>h.x||a.y<u.y&&e.y<u.y||a.y>h.y&&e.y>h.y)return!1;const p=Fi(a,e,i[0]);return p!==Fi(a,e,i[1])||p!==Fi(a,e,i[2])||p!==Fi(a,e,i[3])}function Jn(a,e,i,u,h,p){let g=e.y-a.y,w=a.x-e.x;if(p=p||0){const E=g*g+w*w;if(E===0)return!0;const P=Math.sqrt(E);g/=P,w/=P}return!((i.x-a.x)*g+(i.y-a.y)*w-p<0||(u.x-a.x)*g+(u.y-a.y)*w-p<0||(h.x-a.x)*g+(h.y-a.y)*w-p<0)}function eo(a,e,i,u,h,p,g){return!(Jn(a,e,u,h,p,g)||Jn(e,i,u,h,p,g)||Jn(i,a,u,h,p,g)||Jn(u,h,a,e,i,g)||Jn(h,p,a,e,i,g)||Jn(p,u,a,e,i,g))}function uo(a,e,i){const u=e.paint.get(a).value;return u.kind==="constant"?u.value:i.programConfigurations.get(e.id).getMaxValue(a)}function Pi(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Ka(a,e,i,u,h){if(!e[0]&&!e[1])return a;const p=kt.convert(e)._mult(h);i==="viewport"&&p._rotate(-u);const g=[];for(let w=0;w<a.length;w++)g.push(a[w].sub(p));return g}function Kl(a,e,i,u){const h=kt.convert(a)._mult(u);return e==="viewport"&&h._rotate(-i),h}let jc,Bu;function Uc(a,e,i){var u=2*Math.PI*6378137/256/Math.pow(2,i);return[a*u-2*Math.PI*6378137/2,e*u-2*Math.PI*6378137/2]}ir(zn,"CircleBucket",{omit:["layers"]});class _a{constructor(e,i,u){this.z=e,this.x=i,this.y=u,this.key=Ya(0,e,e,i,u)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const u=(function(p,g,w){var E=Uc(256*p,256*(g=Math.pow(2,w)-g-1),w),P=Uc(256*(p+1),256*(g+1),w);return E[0]+","+E[1]+","+P[0]+","+P[1]})(this.x,this.y,this.z),h=(function(p,g,w){let E,P="";for(let O=p;O>0;O--)E=1<<O-1,P+=(g&E?1:0)+(w&E?2:0);return P})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Es{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Ya(e,i.z,i.z,i.x,i.y)}}class Hi{constructor(e,i,u,h,p){this.overscaledZ=e,this.wrap=i,this.canonical=new _a(u,+h,+p),this.key=i===0&&e===u?this.canonical.key:Ya(i,e,u,h,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Hi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hi(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Ya(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-e;return Ya(this.wrap*+i,e,e,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Hi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new Hi(i,this.wrap,i,u,h),new Hi(i,this.wrap,i,u+1,h),new Hi(i,this.wrap,i,u,h+1),new Hi(i,this.wrap,i,u+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Hi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Hi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Es(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ya(a,e,i,u,h){const p=1<<Math.min(i,22);let g=p*(h%p)+u%p;return a&&i<22&&(g+=p*p*((a<0?-2*a-1:2*a)%(1<<2*(22-i)))),16*(32*g+i)+(e-i)}const Nu=[a=>{let e=a.canonical.x-1,i=a.wrap;return e<0&&(e=(1<<a.canonical.z)-1,i--),new Hi(a.overscaledZ,i,a.canonical.z,e,a.canonical.y)},a=>{let e=a.canonical.x+1,i=a.wrap;return e===1<<a.canonical.z&&(e=0,i++),new Hi(a.overscaledZ,i,a.canonical.z,e,a.canonical.y)},a=>new Hi(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new Hi(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];ir(_a,"CanonicalTileID"),ir(Hi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const sg=mn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:lg}=sg,um=mn([{name:"a_pos_3",components:3,type:"Int16"}]);var Nv=mn([{name:"a_pos",type:"Int16",components:2}]);function Hf(a){return a*Xo/C}const _=[new Rr([y,y,y],[x,x,x]),new Rr([y,y,y],[0,0,x]),new Rr([0,y,y],[x,0,x]),new Rr([y,0,y],[0,x,x]),new Rr([0,0,y],[x,x,x])];function b(a,e,i,u=!0){const h=qe([],a._camera.position,a.worldSize),p=[e,i,1,1];Vi(p,p,a.pixelMatrixInverse),qo(p,p,1/p[3]);const g=Tr([],In([],p,h)),w=a.globeMatrix,E=[w[12],w[13],w[14]],P=In([],E,h),O=ft(P),D=Tr([],P),L=a.worldSize/(2*Math.PI),U=vr(D,g),$=Math.asin(L/O);if($<Math.acos(U)){if(!u)return null;const ut=[],Ze=[];qe(ut,g,O/U),Tr(Ze,In(Ze,ut,P)),Tr(g,gt(g,P,qe(g,Ze,Math.tan($)*O)))}const X=[];new Sn(h,g).closestPointOnSphere(E,L,X);const J=Tr([],Ei(w,0)),ie=Tr([],Ei(w,1)),de=Tr([],Ei(w,2)),he=vr(J,X),ge=vr(ie,X),Fe=vr(de,X),Me=et(Math.asin(-ge/L));let Oe=et(Math.atan2(he,Fe));Oe=a.center.lng+(function(ut,Ze){const _t=(Ze-ut+180)%360-180;return _t<-180?_t+360:_t})(a.center.lng,Oe);const je=Y(Oe),Ue=we(re(Me),0,1);return new Ie(je,Ue)}class I{constructor(e,i,u){this.a=In([],e,u),this.b=In([],i,u),this.center=u;const h=Tr([],this.a),p=Tr([],this.b);this.angle=Math.acos(vr(h,p))}}function N(a,e){if(a.angle===0)return null;let i;return i=a.a[e]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[e]/a.a[e]/Math.sin(a.angle)-1/Math.tan(a.angle)),i<0||i>1?null:(function(u,h,p,g){const w=Math.sin(p);return u*(Math.sin((1-g)*p)/w)+h*(Math.sin(g*p)/w)})(a.a[e],a.b[e],a.angle,we(i,0,1))+a.center[e]}function W(a){if(a.z<=1)return _[a.z+2*a.y+a.x];const e=Zt(st(a));return Rr.fromPoints(e)}function ne(a,e,i){return qe(a,a,1-i),mt(a,a,e,i)}function Se(a,e,i){for(const u of a)Ar(u,u,e),qe(u,u,i)}function Je(a,e,i,u){const h=e/a.worldSize,p=a.globeMatrix;if(i.z<=1){const Ue=W(i).getCorners();return Se(Ue,p,h),Rr.fromPoints(Ue)}const g=st(i,u),w=Zt(g,Xo+Hf(a._tileCoverLift));Se(w,p,h);const E=Number.MAX_VALUE,P=[-E,-E,-E],O=[E,E,E];if(g.contains(a.center)){for(const Ze of w)yt(O,O,Ze),Vt(P,P,Ze);P[2]=0;const Ue=a.point,ut=[Ue.x*h,Ue.y*h,0];return yt(O,O,ut),Vt(P,P,ut),new Rr(O,P)}if(a._tileCoverLift>0){for(const Ue of w)yt(O,O,Ue),Vt(P,P,Ue);return new Rr(O,P)}const D=[p[12]*h,p[13]*h,p[14]*h],L=g.getCenter(),U=we(a.center.lat,-Ee,Ee),$=we(L.lat,-Ee,Ee),X=Y(a.center.lng),J=re(U);let ie=X-Y(L.lng);const de=J-re($);ie>.5?ie-=1:ie<-.5&&(ie+=1);let he=0;Math.abs(ie)>Math.abs(de)?he=ie>=0?1:3:(he=de>=0?0:2,mt(D,D,[p[4]*h,p[5]*h,p[6]*h],-Math.sin(Cn(de>=0?g.getSouth():g.getNorth()))*Xo));const ge=w[he],Fe=w[(he+1)%4],Me=new I(ge,Fe,D),Oe=[N(Me,0)||ge[0],N(Me,1)||ge[1],N(Me,2)||ge[2]],je=pt(a.zoom);if(je>0){const Ue=(function({x:Ze,y:_t,z:qt},Et,Lt,Ut,lt){const zt=1/(1<<qt);let Qe=Ze*zt,ct=Qe+zt,Gt=_t*zt,Ft=Gt+zt,gr=0;const lr=(Qe+ct)/2-Ut;return lr>.5?gr=-1:lr<-.5&&(gr=1),Qe=((Qe+gr)*Et-(Ut*=Et))*Lt+Ut,ct=((ct+gr)*Et-Ut)*Lt+Ut,Gt=(Gt*Et-(lt*=Et))*Lt+lt,Ft=(Ft*Et-lt)*Lt+lt,[[Qe,Ft,0],[ct,Ft,0],[ct,Gt,0],[Qe,Gt,0]]})(i,e,a._pixelsPerMercatorPixel,X,J);for(let Ze=0;Ze<w.length;Ze++)ne(w[Ze],Ue[Ze],je);const ut=gt([],Ue[he],Ue[(he+1)%4]);qe(ut,ut,.5),ne(Oe,ut,je)}for(const Ue of w)yt(O,O,Ue),Vt(P,P,Ue);return O[2]=Math.min(ge[2],Fe[2]),yt(O,O,Oe),Vt(P,P,Oe),new Rr(O,P)}function st({x:a,y:e,z:i},u=!1){const h=1/(1<<i),p=new z(ce(a*h),e===(1<<i)-1&&u?-90:me((e+1)*h)),g=new z(ce((a+1)*h),e===0&&u?90:me(e*h));return new V(p,g)}function Zt(a,e=Xo){const i=Cn(a.getNorth()),u=Cn(a.getSouth()),h=Math.cos(i),p=Math.cos(u),g=Math.sin(i),w=Math.sin(u),E=a.getWest(),P=a.getEast();return[S(p,w,E,e),S(p,w,P,e),S(h,g,P,e),S(h,g,E,e)]}function mr(a,e,i,u){const h=1<<i.z,p=(a/Wt+i.x)/h;return A(me((e/Wt+i.y)/h),ce(p),u)}function br({min:a,max:e}){return n/Math.max(e[0]-a[0],e[1]-a[1],e[2]-a[2])}const _r=new Float64Array(16);function $r(a){const e=br(a),i=Te(_r,[e,e,e]);return fe(i,i,Gr([],a.min))}function Kr(a){const e=(u=a.min,(i=_r)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=u[0],i[13]=u[1],i[14]=u[2],i[15]=1,i);var i,u;const h=1/br(a);return ue(e,e,[h,h,h])}function Qr(a){const e=Wt/(2*Math.PI);return a/(2*Math.PI)/e}function Lo(a,e){return Wt/(512*Math.pow(2,a))*br(W(e))}function Mt(a,e,i,u,h){const p=Qr(i),g=[a,e,-i/(2*Math.PI)],w=H(new Float64Array(16));return fe(w,w,g),ue(w,w,[p,p,p]),_e(w,w,Cn(-h)),le(w,w,Cn(-u)),w}function pt(a){return Ne(cm,f,a)}function jt(a,e){const i=A(e.lat,e.lng),u=(function($){const X=A($._center.lat,$._center.lng);let J=Br([],bt(0,1,0),X);const ie=De([],-$.angle,X);J=Ar(J,J,ie),De(ie,-$._pitch,J);const de=Tr([],X);return qe(de,de,Hf($.cameraToCenterDistance/$.pixelsPerMeter)),Ar(de,de,ie),gt([],X,de)})(a);return g=(h=Rt([],u,i))[0],w=h[1],E=h[2],P=(p=i)[0],O=p[1],D=p[2],U=(L=Math.sqrt(g*g+w*w+E*E)*Math.sqrt(P*P+O*O+D*D))&&vr(h,p)/L,Math.acos(Math.min(Math.max(U,-1),1));var h,p,g,w,E,P,O,D,L,U}function Pr(a,e){return jt(a,e)>Math.PI/2*1.01}const sn=Cn(85),En=Math.cos(sn),An=Math.sin(sn),jn=ee(),sa=a=>{const e=[];return a.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Ri(a,e,i,u,h,p,g,w,E){if(p&&a.queryGeometry.isAboveHorizon)return!1;p&&(E*=a.pixelToTileUnitsFactor);const P=a.tileID.canonical,O=i.projection.upVectorScale(P,i.center.lat,i.worldSize).metersToTile;for(const D of e)for(const L of D){const U=L.add(w),$=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(U.x,U.y,!0):0,X=i.projection.projectTilePoint(U.x,U.y,P);if($>0){const he=i.projection.upVector(P,U.x,U.y);X.x+=he[0]*O*$,X.y+=he[1]*O*$,X.z+=he[2]*O*$}const J=p?U:Bh(X.x,X.y,X.z,u),ie=p?a.tilespaceRays.map((he=>nV(he,$))):a.queryGeometry.screenGeometry,de=Vi([],[X.x,X.y,X.z,1],u);if(!g&&p?E*=de[3]/i.cameraToCenterDistance:g&&!p&&(E*=i.cameraToCenterDistance/de[3]),p){const he=me((L.y/Wt+P.y)/(1<<P.z));E/=i.projection.pixelsPerMeter(he,1)/te(1,he)}if(Gi(ie,J,E))return!0}return!1}function Bh(a,e,i,u){const h=Vi([],[a,e,i,1],u);return new kt(h[0]/h[3],h[1]/h[3])}const jv=bt(0,0,0),rV=bt(0,0,1);function nV(a,e){const i=$e();return jv[2]=e,a.intersectsPlane(jv,rV,i),new kt(i[0],i[1])}class DI extends zn{}let kI,LI,zI,FI;function BI(a,{width:e,height:i},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*u);return a.width=e,a.height=i,a.data=h,a}function NI(a,e,i){const{width:u,height:h}=e;u===a.width&&h===a.height||(t1(a,e,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,h)},i,null),a.width=u,a.height=h,a.data=e.data)}function t1(a,e,i,u,h,p,g,w){if(h.width===0||h.height===0)return e;if(h.width>a.width||h.height>a.height||i.x>a.width-h.width||i.y>a.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||u.x>e.width-h.width||u.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const E=a.data,P=e.data,O=p===4&&w;for(let D=0;D<h.height;D++){const L=((i.y+D)*a.width+i.x)*p,U=((u.y+D)*e.width+u.x)*p;if(O)for(let $=0;$<h.width;$++){const X=L+$*p+3,J=U+$*p;P[J+0]=255,P[J+1]=255,P[J+2]=255,P[J+3]=E[X]}else if(g)for(let $=0;$<h.width;$++){const X=L+$*p,J=U+$*p,ie=new wn(E[X+0]/255,E[X+1]/255,E[X+2]/255,E[X+3]).toNonPremultipliedRenderColor(g).toArray();P[J+0]=ie[0],P[J+1]=ie[1],P[J+2]=ie[2],P[J+3]=ie[3]}else for(let $=0;$<h.width*p;$++)P[U+$]=E[L+$]}return e}ir(DI,"HeatmapBucket",{omit:["layers"]});class pp{constructor(e,i){BI(this,e,1,i)}resize(e){NI(this,new pp(e),1)}clone(){return new pp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,u,h,p){t1(e,i,u,h,p,1,null)}}class ya{constructor(e,i){BI(this,e,4,i)}resize(e){NI(this,new ya(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ya({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,u,h,p,g,w){t1(e,i,u,h,p,4,g,w)}}class jI{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function k_(a){const e={},i=a.resolution||256,u=a.clips?a.clips.length:1,h=a.image||new ya({width:i,height:u}),p=(g,w,E)=>{e[a.evaluationKey]=E;const P=a.expression.evaluate(e),O=P?P.toNonPremultipliedRenderColor(null):null;O&&(h.data[g+w+0]=Math.floor(255*O.r),h.data[g+w+1]=Math.floor(255*O.g),h.data[g+w+2]=Math.floor(255*O.b),h.data[g+w+3]=Math.floor(255*O.a))};if(a.clips)for(let g=0,w=0;g<u;++g,w+=4*i)for(let E=0,P=0;E<i;E++,P+=4){const O=E/(i-1),{start:D,end:L}=a.clips[g];p(w,P,D*(1-O)+L*O)}else for(let g=0,w=0;g<i;g++,w+=4)p(0,w,g/(i-1));return h}ir(pp,"AlphaImage"),ir(ya,"RGBAImage");const iV=mn([{name:"a_pos",components:2,type:"Int16"}],4),oV=mn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),aV=mn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),sV=mn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function cg(a,e,i=2){const u=e&&e.length,h=u?e[0]*i:a.length;let p=UI(a,0,h,i,!0);const g=[];if(!p||p.next===p.prev)return g;let w,E,P;if(u&&(p=(function(O,D,L,U){const $=[];for(let X=0,J=D.length;X<J;X++){const ie=UI(O,D[X]*U,X<J-1?D[X+1]*U:O.length,U,!1);ie===ie.next&&(ie.steiner=!0),$.push(mV(ie))}$.sort(fV);for(let X=0;X<$.length;X++)L=dV($[X],L);return L})(a,e,p,i)),a.length>80*i){w=a[0],E=a[1];let O=w,D=E;for(let L=i;L<h;L+=i){const U=a[L],$=a[L+1];U<w&&(w=U),$<E&&(E=$),U>O&&(O=U),$>D&&(D=$)}P=Math.max(O-w,D-E),P=P!==0?32767/P:0}return L_(p,g,i,w,E,P,0),g}function UI(a,e,i,u,h){let p;if(h===(function(g,w,E,P){let O=0;for(let D=w,L=E-P;D<E;D+=P)O+=(g[L]-g[D])*(g[D+1]+g[L+1]),L=D;return O})(a,e,i,u)>0)for(let g=e;g<i;g+=u)p=GI(g/u|0,a[g],a[g+1],p);else for(let g=i-u;g>=e;g-=u)p=GI(g/u|0,a[g],a[g+1],p);return p&&ug(p,p.next)&&(B_(p),p=p.next),p}function hm(a,e){if(!a)return a;e||(e=a);let i,u=a;do if(i=!1,u.steiner||!ug(u,u.next)&&$o(u.prev,u,u.next)!==0)u=u.next;else{if(B_(u),u=e=u.prev,u===u.next)break;i=!0}while(i||u!==e);return e}function L_(a,e,i,u,h,p,g){if(!a)return;!g&&p&&(function(E,P,O,D){let L=E;do L.z===0&&(L.z=r1(L.x,L.y,P,O,D)),L.prevZ=L.prev,L.nextZ=L.next,L=L.next;while(L!==E);L.prevZ.nextZ=null,L.prevZ=null,(function(U){let $,X=1;do{let J,ie=U;U=null;let de=null;for($=0;ie;){$++;let he=ie,ge=0;for(let Me=0;Me<X&&(ge++,he=he.nextZ,he);Me++);let Fe=X;for(;ge>0||Fe>0&&he;)ge!==0&&(Fe===0||!he||ie.z<=he.z)?(J=ie,ie=ie.nextZ,ge--):(J=he,he=he.nextZ,Fe--),de?de.nextZ=J:U=J,J.prevZ=de,de=J;ie=he}de.nextZ=null,X*=2}while($>1)})(L)})(a,u,h,p);let w=a;for(;a.prev!==a.next;){const E=a.prev,P=a.next;if(p?cV(a,u,h,p):lV(a))e.push(E.i,a.i,P.i),B_(a),a=P.next,w=P.next;else if((a=P)===w){g?g===1?L_(a=uV(hm(a),e),e,i,u,h,p,2):g===2&&hV(a,e,i,u,h,p):L_(hm(a),e,i,u,h,p,1);break}}}function lV(a){const e=a.prev,i=a,u=a.next;if($o(e,i,u)>=0)return!1;const h=e.x,p=i.x,g=u.x,w=e.y,E=i.y,P=u.y,O=Math.min(h,p,g),D=Math.min(w,E,P),L=Math.max(h,p,g),U=Math.max(w,E,P);let $=u.next;for(;$!==e;){if($.x>=O&&$.x<=L&&$.y>=D&&$.y<=U&&z_(h,w,p,E,g,P,$.x,$.y)&&$o($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function cV(a,e,i,u){const h=a.prev,p=a,g=a.next;if($o(h,p,g)>=0)return!1;const w=h.x,E=p.x,P=g.x,O=h.y,D=p.y,L=g.y,U=Math.min(w,E,P),$=Math.min(O,D,L),X=Math.max(w,E,P),J=Math.max(O,D,L),ie=r1(U,$,e,i,u),de=r1(X,J,e,i,u);let he=a.prevZ,ge=a.nextZ;for(;he&&he.z>=ie&&ge&&ge.z<=de;){if(he.x>=U&&he.x<=X&&he.y>=$&&he.y<=J&&he!==h&&he!==g&&z_(w,O,E,D,P,L,he.x,he.y)&&$o(he.prev,he,he.next)>=0||(he=he.prevZ,ge.x>=U&&ge.x<=X&&ge.y>=$&&ge.y<=J&&ge!==h&&ge!==g&&z_(w,O,E,D,P,L,ge.x,ge.y)&&$o(ge.prev,ge,ge.next)>=0))return!1;ge=ge.nextZ}for(;he&&he.z>=ie;){if(he.x>=U&&he.x<=X&&he.y>=$&&he.y<=J&&he!==h&&he!==g&&z_(w,O,E,D,P,L,he.x,he.y)&&$o(he.prev,he,he.next)>=0)return!1;he=he.prevZ}for(;ge&&ge.z<=de;){if(ge.x>=U&&ge.x<=X&&ge.y>=$&&ge.y<=J&&ge!==h&&ge!==g&&z_(w,O,E,D,P,L,ge.x,ge.y)&&$o(ge.prev,ge,ge.next)>=0)return!1;ge=ge.nextZ}return!0}function uV(a,e){let i=a;do{const u=i.prev,h=i.next.next;!ug(u,h)&&$I(u,i,i.next,h)&&F_(u,h)&&F_(h,u)&&(e.push(u.i,i.i,h.i),B_(i),B_(i.next),i=a=h),i=i.next}while(i!==a);return hm(i)}function hV(a,e,i,u,h,p){let g=a;do{let w=g.next.next;for(;w!==g.prev;){if(g.i!==w.i&&gV(g,w)){let E=qI(g,w);return g=hm(g,g.next),E=hm(E,E.next),L_(g,e,i,u,h,p,0),void L_(E,e,i,u,h,p,0)}w=w.next}g=g.next}while(g!==a)}function fV(a,e){let i=a.x-e.x;return i===0&&(i=a.y-e.y,i===0)&&(i=(a.next.y-a.y)/(a.next.x-a.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function dV(a,e){const i=(function(h,p){let g=p;const w=h.x,E=h.y;let P,O=-1/0;if(ug(h,g))return g;do{if(ug(h,g.next))return g.next;if(E<=g.y&&E>=g.next.y&&g.next.y!==g.y){const X=g.x+(E-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(X<=w&&X>O&&(O=X,P=g.x<g.next.x?g:g.next,X===w))return P}g=g.next}while(g!==p);if(!P)return null;const D=P,L=P.x,U=P.y;let $=1/0;g=P;do{if(w>=g.x&&g.x>=L&&w!==g.x&&VI(E<U?w:O,E,L,U,E<U?O:w,E,g.x,g.y)){const X=Math.abs(E-g.y)/(w-g.x);F_(g,h)&&(X<$||X===$&&(g.x>P.x||g.x===P.x&&pV(P,g)))&&(P=g,$=X)}g=g.next}while(g!==D);return P})(a,e);if(!i)return e;const u=qI(i,a);return hm(u,u.next),hm(i,i.next)}function pV(a,e){return $o(a.prev,a,e.prev)<0&&$o(e.next,a,a.next)<0}function r1(a,e,i,u,h){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-i)*h|0)|a<<8))|a<<4))|a<<2))|a<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-u)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function mV(a){let e=a,i=a;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==a);return i}function VI(a,e,i,u,h,p,g,w){return(h-g)*(e-w)>=(a-g)*(p-w)&&(a-g)*(u-w)>=(i-g)*(e-w)&&(i-g)*(p-w)>=(h-g)*(u-w)}function z_(a,e,i,u,h,p,g,w){return!(a===g&&e===w)&&VI(a,e,i,u,h,p,g,w)}function gV(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!(function(i,u){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==u.i&&h.next.i!==u.i&&$I(h,h.next,i,u))return!0;h=h.next}while(h!==i);return!1})(a,e)&&(F_(a,e)&&F_(e,a)&&(function(i,u){let h=i,p=!1;const g=(i.x+u.x)/2,w=(i.y+u.y)/2;do h.y>w!=h.next.y>w&&h.next.y!==h.y&&g<(h.next.x-h.x)*(w-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==i);return p})(a,e)&&($o(a.prev,a,e.prev)||$o(a,e.prev,e))||ug(a,e)&&$o(a.prev,a,a.next)>0&&$o(e.prev,e,e.next)>0)}function $o(a,e,i){return(e.y-a.y)*(i.x-e.x)-(e.x-a.x)*(i.y-e.y)}function ug(a,e){return a.x===e.x&&a.y===e.y}function $I(a,e,i,u){const h=Vv($o(a,e,i)),p=Vv($o(a,e,u)),g=Vv($o(i,u,a)),w=Vv($o(i,u,e));return h!==p&&g!==w||!(h!==0||!Uv(a,i,e))||!(p!==0||!Uv(a,u,e))||!(g!==0||!Uv(i,a,u))||!(w!==0||!Uv(i,e,u))}function Uv(a,e,i){return e.x<=Math.max(a.x,i.x)&&e.x>=Math.min(a.x,i.x)&&e.y<=Math.max(a.y,i.y)&&e.y>=Math.min(a.y,i.y)}function Vv(a){return a>0?1:a<0?-1:0}function F_(a,e){return $o(a.prev,a,a.next)<0?$o(a,e,a.next)>=0&&$o(a,a.prev,e)>=0:$o(a,e,a.prev)<0||$o(a,a.next,e)<0}function qI(a,e){const i=n1(a.i,a.x,a.y),u=n1(e.i,e.x,e.y),h=a.next,p=e.prev;return a.next=e,e.prev=a,i.next=h,h.prev=i,u.next=i,i.prev=u,p.next=u,u.prev=p,u}function GI(a,e,i,u){const h=n1(a,e,i);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function B_(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function n1(a,e,i){return{i:a,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function N_(a,e){const i=a.length;if(i<=1)return[a];const u=[];let h,p;for(let g=0;g<i;g++){const w=$n(a[g]);w!==0&&(a[g].area=Math.abs(w),p===void 0&&(p=w<0),p===w<0?(h&&u.push(h),h=[a[g]]):h.push(a[g]))}if(h&&u.push(h),e>1)for(let g=0;g<u.length;g++)u[g].length<=e||(wo(u[g],e,1,u[g].length-1,_V),u[g]=u[g].slice(0,e));return u}function _V(a,e){return e.area-a.area}function HI(a,e,i=1){if(!a)return null;const u=typeof a=="string"?Ia.from(a).getPrimary():a.getPrimary(),h=typeof a=="string"?null:a.getSecondary();for(const p of[u,h]){if(!p)continue;const g=p.id.toString();e.has(g)||e.set(g,[]),p.scaleSelf(i),e.get(g).push(p)}return{primary:u.toString(),secondary:h?h.toString():null}}function i1(a,e,i,u){const h=u.patternDependencies;let p=!1;for(const g of e){const w=g.paint.get(`${a}-pattern`);w.isConstant()||(p=!0),HI(w.constantOr(null),h,i)&&(p=!0)}return p}function o1(a,e,i,u,h,p){const g=p.patternDependencies;for(const w of e){const E=w.paint.get(`${a}-pattern`).value;if(E.kind!=="constant"){let P=E.evaluate({zoom:u},i,{},p.availableImages);P=P&&P.name?P.name:P;const O=HI(P,g,h);if(!O)continue;const{primary:D,secondary:L}=O;D&&(i.patterns[w.id]=[D,L].filter(Boolean))}}return i}class WI{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,u]of e.polygons)this.add(i,...u)}}class fm{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new fm;let i=[];for(const P of e)i.push(...P.portals);if(i.length===0)return new fm;const u=(P,O)=>P<=0&&O<=0||P>=Wt&&O>=Wt;for(const P of i){const O=P.va,D=P.vb;(u(O.x,D.x)||u(O.y,D.y))&&(P.type="border")}const h=i.filter((P=>P.type!=="unevaluated")),p=i.filter((P=>P.type==="unevaluated"));if(p.length===0)return new fm;p.sort(((P,O)=>P.hash===O.hash?P.isTunnel===O.isTunnel?0:P.isTunnel?-1:1:P.hash<O.hash?1:-1)),i=h.concat(p);let g=h.length,w=g,E=g;do if(w++,w===i.length||i[g].hash!==i[w].hash){if(w-g==2){E<g&&(i[E]=i[g],i[g]=null);const P=i[E],O=i[w-1];P.type=P.isTunnel!==O.isTunnel?"tunnel":"polygon",P.connection={a:P.connection.a,b:O.connection.a},E++}g=w}while(g!==i.length);return i.splice(E),i.sort(((P,O)=>P.hash<O.hash?1:-1)),{portals:i}}}ir(fm,"ElevationPortalGraph"),ir(WI,"ElevationPolygons");class yV{constructor(e,i,u){this.outPositions=e,this.outNormals=i,this.outIndices=u,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,u){let h=e[2];u!=null&&(h*=u);const p=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),g=this.vertexLookup.get(p);if(g!=null)return g;const w=this.outPositions.length;this.vertexLookup.set(p,w);const E=Math.trunc(16384*i[0]),P=Math.trunc(16384*i[1]),O=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],h),this.outNormals.emplaceBack(E,P,O),w}addTriangle(e,i,u){this.outIndices.emplaceBack(e,i,u)}addTriangles(e,i,u){if(e.length===0)return;const h=u.length===1,p=$e(),g=$e();for(let w=0;w<e.length;w+=3){const E=i[e[w+0]],P=i[e[w+1]],O=i[e[w+2]],D=h?u[0]:u[e[w+1]],L=h?u[0]:u[e[w+2]];St(p,E.x,E.y,h?u[0]:u[e[w+0]]);const U=this.addVertex(p,g);St(p,P.x,P.y,D);const $=this.addVertex(p,g);St(p,O.x,O.y,L);const X=this.addVertex(p,g);this.outIndices.emplaceBack(U,$,X)}}addQuad(e,i,u,h,p,g){const w=this.addVertex(e,p,g),E=this.addVertex(i,p,g),P=this.addVertex(u,p,g),O=this.addVertex(h,p,g);this.addTriangle(w,E,P),this.addTriangle(P,O,w)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Zs{constructor(e,i,u,h){this.unevaluatedPortals=new fm,this.portalPolygons=new WI,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new em,this.vertexNormals=new Zd,this.indexArray=new ai,this.tileToMeters=Pe(e),this.bridgeProgramConfigurations=new Za(i,{zoom:u,lut:h},(p=>p!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new Za(i,{zoom:u,lut:h},(p=>p!=="fill-bridge-guard-rail-color"))}addVertices(e,i){const u=this.unevalVertices.length;for(let h=0;h<e.length;h++)this.unevalVertices.push(e[h]),this.unevalHeights.push(i[h]);return u}addTriangles(e,i,u){const h=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of e)h.push(p+i)}addRenderableRing(e,i,u,h,p,g){const w=[new kt(p.min.x,p.min.y),new kt(p.max.x,p.min.y),new kt(p.max.x,p.max.y),new kt(p.min.x,p.max.y)];for(let E=0;E<u-1;E++){const P=i+E,O=P+1,D=this.unevalVertices[P],L=this.unevalVertices[O];if(!(D.x>=p.min.x&&D.x<=p.max.x&&D.y>=p.min.y&&D.y<=p.max.y||L.x>=p.min.x&&L.x<=p.max.x&&L.y>=p.min.y&&L.y<=p.max.y||Oi(D,L,w))||this.isOnBorder(D.x,L.x)||this.isOnBorder(D.y,L.y))continue;const U=Zs.computeEdgeHash(this.unevalVertices[P],this.unevalVertices[O]);let $,X=this.vertexHashLookup.get(Zs.computePosHash(D));X!=null?$=X.next:(X=this.vertexHashLookup.get(Zs.computePosHash(L)),$=X!=null?X.prev:U),this.unevalEdges.push({polygonIdx:e,a:P,b:O,hash:U,portalHash:$,isTunnel:h,type:"unevaluated",featureInfo:g})}}addPortalCandidates(e,i,u,h,p){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:p});const g=i[0];this.vertexHashLookup.clear();let w=Zs.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let E=0;E<g.length-1;E++){const P=g[E+0],O=g[E+1],D=rs(O.x-P.x,O.y-P.y),L=ol(D);if(L===0)continue;let U="unevaluated";const $=h.pointElevation(P),X=h.pointElevation(O);Math.abs($)<.01&&Math.abs(X)<.01?U="entrance":(this.isOnBorder(P.x,O.x)||this.isOnBorder(P.y,O.y))&&(U="border");const J=Zs.computeEdgeHash(P,O);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:P,vb:O,vab:D,length:L,hash:J,isTunnel:u,type:U});const ie=Zs.computePosHash(P);this.vertexHashLookup.set(ie,{prev:w,next:J}),w=J}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=L=>{L.primitiveLength=this.indexArray.length-L.primitiveOffset},h=new yV(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const p=i(),g=i(),w=i(),E=(L,U)=>{L.sort(((X,J)=>X.type===U&&J.type!==U?-1:X.type!==U&&J.type===U?1:0));const $=L.findIndex((X=>X.type!==U));return $>=0?$:L.length};let P=0;this.unevalEdges.length>0&&(P=E(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:P},this.tileToMeters)),u(w);const O=i(),D=i();if(this.unevalEdges.length>0){const L=this.unevalEdges.splice(P),U=E(L,"tunnel")+P;this.unevalEdges.push(...L),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:P},{min:P,max:U})}u(O),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(D),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(g),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(p),this.maskSegments=Si.simpleSegment(0,D.primitiveOffset,0,D.primitiveLength),this.depthSegments=Si.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableBridgeSegments=Si.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.renderableTunnelSegments=Si.simpleSegment(0,O.primitiveOffset,0,O.primitiveLength),this.shadowCasterSegments=Si.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}update(e,i,u,h,p,g,w,E){this.bridgeProgramConfigurations.updatePaintArrays(e,i,p,u,h,g,w,E),this.tunnelProgramConfigurations.updatePaintArrays(e,i,p,u,h,g,w,E)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,aV.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,sV.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,u,h,p){const g=(w,E)=>{for(let P=0;P<E.length-1;P++){const O=E[P].featureIndex,D=E[P+1].vertexStart,L=e.feature(O);w.populatePaintArrays(D,L,O,{},u,i,h,void 0,p)}};g(this.bridgeProgramConfigurations,this.bridgeFeatureSections),g(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,u,h,p){const g=new Map;for(let w=h;w<p;w++){const E=u[w],P=E.a,O=E.b,D=Zs.computePosHash(e[P]),L=Zs.computePosHash(e[O]);let U=g.get(D);U||(U={},g.set(D,U));let $=g.get(L);$||($={},g.set(L,$)),i[P]<=0&&i[O]<=0||(U.to=O,$.from=P)}return g}isTerminalVertex(e,i){const u=Zs.computePosHash(this.unevalVertices[e]),h=i.get(u);return!h||!h.from||!h.to}constructBridgeStructures(e,i,u,h,p,g){e.clearVertexLookup();const w=this.computeVertexConnections(i,u,h,p.min,p.max),E=1/g,P=.5*E,O=(Lt,Ut)=>St(Lt,i[Ut].x,i[Ut].y,u[Ut]*E),D=$e(),L=$e(),U=$e(),$=$e(),X=$e(),J=(Lt,Ut)=>{const lt=w.get(Zs.computePosHash(i[Ut])),zt=lt.from,Qe=lt.to;if(!zt||!Qe)return;O(D,zt),O(L,Ut),O(U,Qe),ui($),Rn(D,L)||(In(X,L,D),Tr($,X)),Rn(U,L)||(In(X,U,L),gt($,$,Tr(X,X)));const ct=Yi($);return ct>0?qe(Lt,$,1/ct):void 0};let ie=Number.POSITIVE_INFINITY;this.sortSubarray(h,p.min,p.max,((Lt,Ut)=>Lt.featureInfo.featureIndex-Ut.featureInfo.featureIndex));const de=$e(),he=$e(),ge=$e(),Fe=$e(),Me=$e(),Oe=$e(),je=$e(),Ue=$e(),ut=$e(),Ze=[$e(),$e(),$e(),$e()],_t=[$e(),$e(),$e(),$e()],qt=[{coord:new kt(0,0),height:0},{coord:new kt(0,0),height:0}],Et=(Lt,Ut)=>Lt>Ut;for(let Lt=p.min;Lt<p.max;Lt++){const Ut=h[Lt];if(!Ut.featureInfo.guardRailEnabled||!this.prepareEdgePoints(qt,i,u,Ut,Et))continue;const[lt,zt]=qt;if(St(de,lt.coord.x,lt.coord.y,E*lt.height),St(he,zt.coord.x,zt.coord.y,E*zt.height),Rn(de,he))continue;In(ge,he,de),Tr(ge,ge);const Qe=J(Ue,Ut.a)||ge,ct=J(ut,Ut.b)||ge;St(Fe,Qe[1],-Qe[0],0),Tr(Fe,Fe),St(Me,ct[1],-ct[0],0),Tr(Me,Me),Br(Ue,Fe,Qe),Tr(Oe,Ue),Br(Ue,Me,ct),Tr(je,Ue),gt(Ze[0],de,qe(Ue,In(Ue,Fe,Oe),P)),gt(Ze[1],de,qe(Ue,gt(Ue,Fe,Oe),P)),gt(Ze[2],de,qe(Ue,Oe,P)),Ze[3]=de,gt(_t[0],he,qe(Ue,In(Ue,Me,je),P)),gt(_t[1],he,qe(Ue,gt(Ue,Me,je),P)),gt(_t[2],he,qe(Ue,je,P)),_t[3]=he,ie=this.addFeatureSection(Ut.featureInfo.featureIndex,ie,this.bridgeFeatureSections,e);const Gt=e.addVertex(Ze[0],Fe,g),Ft=e.addVertex(Ze[1],Fe,g),gr=e.addVertex(_t[0],Me,g),lr=e.addVertex(_t[1],Me,g);e.addTriangle(Gt,Ft,gr),e.addTriangle(Ft,lr,gr);const Ot=e.addVertex(Ze[1],Oe,g),Nt=e.addVertex(Ze[2],Oe,g),fr=e.addVertex(_t[1],je,g),tr=e.addVertex(_t[2],je,g);e.addTriangle(Ot,Nt,fr),e.addTriangle(Nt,tr,fr),Gr(Fe,Fe),Gr(Me,Me);const Xt=e.addVertex(Ze[2],Fe,g),nr=e.addVertex(Ze[3],Fe,g),Cr=e.addVertex(_t[2],Me,g),Fr=e.addVertex(_t[3],Me,g);e.addTriangle(Xt,nr,Cr),e.addTriangle(nr,Fr,Cr);const Zr=this.isTerminalVertex(Ut.a,w),qr=this.isTerminalVertex(Ut.b,w);lt.height<.01&&Zr&&e.addQuad(Ze[3],Ze[2],Ze[1],Ze[0],Gr(Qe,Qe),g),zt.height<.01&&qr&&e.addQuad(_t[0],_t[1],_t[2],_t[3],ct,g)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,u,h,p,g){e.clearVertexLookup();let w=Number.POSITIVE_INFINITY;const E=(ie,de)=>ie.featureInfo.featureIndex-de.featureInfo.featureIndex;this.sortSubarray(h,p.min,p.max,E),this.sortSubarray(h,g.min,g.max,E);const P=ie=>Tr(ie,ie),O=[{coord:new kt(0,0),height:0},{coord:new kt(0,0),height:0}],D=(ie,de)=>ie<de,L=$e(),U=$e(),$=$e(),X=$e(),J=$e();for(let ie=p.min;ie<p.max;ie++){if(!this.prepareEdgePoints(O,i,u,h[ie],D))continue;const[de,he]=O,ge=P(St(J,-(he.coord.y-de.coord.y),he.coord.x-de.coord.x,0));w=this.addFeatureSection(h[ie].featureInfo.featureIndex,w,this.tunnelFeatureSections,e),e.addQuad(St(L,de.coord.x,de.coord.y,de.height),St(U,he.coord.x,he.coord.y,he.height),St($,he.coord.x,he.coord.y,h[ie].isTunnel?-.1:0),St(X,de.coord.x,de.coord.y,h[ie].isTunnel?-.1:0),ge)}for(let ie=g.min;ie<g.max;ie++){const de=h[ie];de.isTunnel&&([de.a,de.b]=[de.b,de.a]);const he=i[de.a],ge=i[de.b],Fe=P(St(J,-(ge.y-he.y),ge.x-he.x,0));w=this.addFeatureSection(de.featureInfo.featureIndex,w,this.tunnelFeatureSections,e),e.addQuad(St(L,ge.x,ge.y,0),St(U,he.x,he.y,0),St($,he.x,he.y,u[de.a]+4),St(X,ge.x,ge.y,u[de.b]+4),Fe),e.addQuad(St(L,he.x,he.y,0),St(U,ge.x,ge.y,0),St($,ge.x,ge.y,u[de.b]+4),St(X,he.x,he.y,u[de.a]+4),Fe)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,u,h){e.coord.x=i,e.coord.y=u,e.height=h}prepareEdgePoints(e,i,u,h,p){let g=i[h.a].x,w=i[h.a].y,E=i[h.b].x,P=i[h.b].y,O=u[h.a],D=u[h.b];const L=p(O,0),U=p(D,0);if(L&&U)return this.setElevatedPoint(e[0],g,w,O),this.setElevatedPoint(e[1],E,P,D),!0;if(!L&&!U)return!1;if(L){if(!U){const $=D/(D-O);E=Sr(E,g,$),P=Sr(P,w,$),D=Sr(D,O,$)}}else{const $=O/(O-D);g=Sr(g,E,$),w=Sr(w,P,$),O=Sr(O,D,$)}return this.setElevatedPoint(e[0],g,w,O),this.setElevatedPoint(e[1],E,P,D),!0}prepareEdges(e,i){if(i.length===0)return;i.sort(((w,E)=>w.hash===E.hash?E.polygonIdx-w.polygonIdx:E.hash>w.hash?1:-1));let u=0,h=0,p=0,g=i[u].polygonIdx;do h++,(h===i.length||i[u].hash!==i[h].hash)&&((h-u==1||i[h-1].polygonIdx!==g)&&(p<u&&(i[p]=i[u],i[u]=null),i[p].type="none",p++),u=h,u!==i.length&&(g=i[u].polygonIdx));while(u!==i.length);if(i.splice(p),i.length!==0&&e.length!==0){i.sort(((P,O)=>P.portalHash<O.portalHash?1:-1));let w=0,E=0;for(;w!==i.length&&E!==e.length;){const P=i[w],O=e[E];P.portalHash>O.hash?w++:O.hash>P.portalHash?E++:(P.type=O.type,w++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=Wt&&i>=Wt}addFeatureSection(e,i,u,h){return e!==i&&(i=e,u.push({featureIndex:e,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),i}sortSubarray(e,i,u,h){const p=e.slice(i,u);p.sort(h),e.splice(i,p.length,...p)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Zs.computePosHash(e))<<32n|BigInt(Zs.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var ZI,XI={exports:{}},KI=(ZI||(ZI=1,(function(a,e){(function(i){function u(ve,xe){return ve>xe?1:ve<xe?-1:0}var h=function(ve,xe){ve===void 0&&(ve=u),xe===void 0&&(xe=!1),this._compare=ve,this._root=null,this._size=0,this._noDuplicates=!!xe},p={size:{configurable:!0}};function g(ve,xe,at,Ht,Yt){var Kt=Yt-Ht;if(Kt>0){var hr=Ht+Math.floor(Kt/2),zr={key:xe[hr],data:at[hr],parent:ve};return zr.left=g(zr,xe,at,Ht,hr),zr.right=g(zr,xe,at,hr+1,Yt),zr}return null}function w(ve,xe,at,Ht,Yt){if(!(at>=Ht)){for(var Kt=ve[at+Ht>>1],hr=at-1,zr=Ht+1;;){do hr++;while(Yt(ve[hr],Kt)<0);do zr--;while(Yt(ve[zr],Kt)>0);if(hr>=zr)break;var dn=ve[hr];ve[hr]=ve[zr],ve[zr]=dn,dn=xe[hr],xe[hr]=xe[zr],xe[zr]=dn}w(ve,xe,at,zr,Yt),w(ve,xe,zr+1,Ht,Yt)}}h.prototype.rotateLeft=function(ve){var xe=ve.right;xe&&(ve.right=xe.left,xe.left&&(xe.left.parent=ve),xe.parent=ve.parent),ve.parent?ve===ve.parent.left?ve.parent.left=xe:ve.parent.right=xe:this._root=xe,xe&&(xe.left=ve),ve.parent=xe},h.prototype.rotateRight=function(ve){var xe=ve.left;xe&&(ve.left=xe.right,xe.right&&(xe.right.parent=ve),xe.parent=ve.parent),ve.parent?ve===ve.parent.left?ve.parent.left=xe:ve.parent.right=xe:this._root=xe,xe&&(xe.right=ve),ve.parent=xe},h.prototype._splay=function(ve){for(;ve.parent;){var xe=ve.parent;xe.parent?xe.left===ve&&xe.parent.left===xe?(this.rotateRight(xe.parent),this.rotateRight(xe)):xe.right===ve&&xe.parent.right===xe?(this.rotateLeft(xe.parent),this.rotateLeft(xe)):xe.left===ve&&xe.parent.right===xe?(this.rotateRight(xe),this.rotateLeft(xe)):(this.rotateLeft(xe),this.rotateRight(xe)):xe.left===ve?this.rotateRight(xe):this.rotateLeft(xe)}},h.prototype.splay=function(ve){for(var xe,at,Ht,Yt,Kt;ve.parent;)(at=(xe=ve.parent).parent)&&at.parent?((Ht=at.parent).left===at?Ht.left=ve:Ht.right=ve,ve.parent=Ht):(ve.parent=null,this._root=ve),Yt=ve.left,Kt=ve.right,ve===xe.left?(at&&(at.left===xe?(xe.right?(at.left=xe.right,at.left.parent=at):at.left=null,xe.right=at,at.parent=xe):(Yt?(at.right=Yt,Yt.parent=at):at.right=null,ve.left=at,at.parent=ve)),Kt?(xe.left=Kt,Kt.parent=xe):xe.left=null,ve.right=xe,xe.parent=ve):(at&&(at.right===xe?(xe.left?(at.right=xe.left,at.right.parent=at):at.right=null,xe.left=at,at.parent=xe):(Kt?(at.left=Kt,Kt.parent=at):at.left=null,ve.right=at,at.parent=ve)),Yt?(xe.right=Yt,Yt.parent=xe):xe.right=null,ve.left=xe,xe.parent=ve)},h.prototype.replace=function(ve,xe){ve.parent?ve===ve.parent.left?ve.parent.left=xe:ve.parent.right=xe:this._root=xe,xe&&(xe.parent=ve.parent)},h.prototype.minNode=function(ve){if(ve===void 0&&(ve=this._root),ve)for(;ve.left;)ve=ve.left;return ve},h.prototype.maxNode=function(ve){if(ve===void 0&&(ve=this._root),ve)for(;ve.right;)ve=ve.right;return ve},h.prototype.insert=function(ve,xe){var at=this._root,Ht=null,Yt=this._compare;if(this._noDuplicates)for(;at;){if(Ht=at,Yt(at.key,ve)===0)return;at=Yt(at.key,ve)<0?at.right:at.left}else for(;at;)Ht=at,at=Yt(at.key,ve)<0?at.right:at.left;return at={key:ve,data:xe,left:null,right:null,parent:Ht},Ht?Yt(Ht.key,at.key)<0?Ht.right=at:Ht.left=at:this._root=at,this.splay(at),this._size++,at},h.prototype.find=function(ve){for(var xe=this._root,at=this._compare;xe;){var Ht=at(xe.key,ve);if(Ht<0)xe=xe.right;else{if(!(Ht>0))return xe;xe=xe.left}}return null},h.prototype.contains=function(ve){for(var xe=this._root,at=this._compare;xe;){var Ht=at(ve,xe.key);if(Ht===0)return!0;xe=Ht<0?xe.left:xe.right}return!1},h.prototype.remove=function(ve){var xe=this.find(ve);if(!xe)return!1;if(this.splay(xe),xe.left)if(xe.right){var at=this.minNode(xe.right);at.parent!==xe&&(this.replace(at,at.right),at.right=xe.right,at.right.parent=at),this.replace(xe,at),at.left=xe.left,at.left.parent=at}else this.replace(xe,xe.left);else this.replace(xe,xe.right);return this._size--,!0},h.prototype.removeNode=function(ve){if(!ve)return!1;if(this.splay(ve),ve.left)if(ve.right){var xe=this.minNode(ve.right);xe.parent!==ve&&(this.replace(xe,xe.right),xe.right=ve.right,xe.right.parent=xe),this.replace(ve,xe),xe.left=ve.left,xe.left.parent=xe}else this.replace(ve,ve.left);else this.replace(ve,ve.right);return this._size--,!0},h.prototype.erase=function(ve){var xe=this.find(ve);if(xe){this.splay(xe);var at=xe.left,Ht=xe.right,Yt=null;at&&(at.parent=null,Yt=this.maxNode(at),this.splay(Yt),this._root=Yt),Ht&&(at?Yt.right=Ht:this._root=Ht,Ht.parent=Yt),this._size--}},h.prototype.pop=function(){var ve=this._root,xe=null;if(ve){for(;ve.left;)ve=ve.left;xe={key:ve.key,data:ve.data},this.remove(ve.key)}return xe},h.prototype.next=function(ve){var xe=ve;if(xe)if(xe.right)for(xe=xe.right;xe&&xe.left;)xe=xe.left;else for(xe=ve.parent;xe&&xe.right===ve;)ve=xe,xe=xe.parent;return xe},h.prototype.prev=function(ve){var xe=ve;if(xe)if(xe.left)for(xe=xe.left;xe&&xe.right;)xe=xe.right;else for(xe=ve.parent;xe&&xe.left===ve;)ve=xe,xe=xe.parent;return xe},h.prototype.forEach=function(ve){for(var xe=this._root,at=[],Ht=!1,Yt=0;!Ht;)xe?(at.push(xe),xe=xe.left):at.length>0?(ve(xe=at.pop(),Yt++),xe=xe.right):Ht=!0;return this},h.prototype.range=function(ve,xe,at,Ht){for(var Yt=[],Kt=this._compare,hr=this._root;Yt.length!==0||hr;)if(hr)Yt.push(hr),hr=hr.left;else{if(Kt((hr=Yt.pop()).key,xe)>0)break;if(Kt(hr.key,ve)>=0&&at.call(Ht,hr))return this;hr=hr.right}return this},h.prototype.keys=function(){for(var ve=this._root,xe=[],at=[],Ht=!1;!Ht;)ve?(xe.push(ve),ve=ve.left):xe.length>0?(ve=xe.pop(),at.push(ve.key),ve=ve.right):Ht=!0;return at},h.prototype.values=function(){for(var ve=this._root,xe=[],at=[],Ht=!1;!Ht;)ve?(xe.push(ve),ve=ve.left):xe.length>0?(ve=xe.pop(),at.push(ve.data),ve=ve.right):Ht=!0;return at},h.prototype.at=function(ve){for(var xe=this._root,at=[],Ht=!1,Yt=0;!Ht;)if(xe)at.push(xe),xe=xe.left;else if(at.length>0){if(xe=at.pop(),Yt===ve)return xe;Yt++,xe=xe.right}else Ht=!0;return null},h.prototype.load=function(ve,xe,at){if(ve===void 0&&(ve=[]),xe===void 0&&(xe=[]),at===void 0&&(at=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Ht=ve.length;return at&&w(ve,xe,0,Ht-1,this._compare),this._root=g(null,ve,xe,0,Ht),this._size=Ht,this},h.prototype.min=function(){var ve=this.minNode(this._root);return ve?ve.key:null},h.prototype.max=function(){var ve=this.maxNode(this._root);return ve?ve.key:null},h.prototype.isEmpty=function(){return this._root===null},p.size.get=function(){return this._size},h.createTree=function(ve,xe,at,Ht,Yt){return new h(at,Yt).load(ve,xe,Ht)},Object.defineProperties(h.prototype,p);var E=0,P=1,O=2,D=3,L=0,U=1,$=2,X=3;function J(ve,xe,at){xe===null?(ve.inOut=!1,ve.otherInOut=!0):(ve.isSubject===xe.isSubject?(ve.inOut=!xe.inOut,ve.otherInOut=xe.otherInOut):(ve.inOut=!xe.otherInOut,ve.otherInOut=xe.isVertical()?!xe.inOut:xe.inOut),xe&&(ve.prevInResult=!ie(xe,at)||xe.isVertical()?xe.prevInResult:xe));var Ht=ie(ve,at);ve.resultTransition=Ht?(function(Yt,Kt){var hr,zr=!Yt.inOut,dn=!Yt.otherInOut;switch(Kt){case L:hr=zr&&dn;break;case U:hr=zr||dn;break;case X:hr=zr^dn;break;case $:hr=Yt.isSubject?zr&&!dn:dn&&!zr}return hr?1:-1})(ve,at):0}function ie(ve,xe){switch(ve.type){case E:switch(xe){case L:return!ve.otherInOut;case U:return ve.otherInOut;case $:return ve.isSubject&&ve.otherInOut||!ve.isSubject&&!ve.otherInOut;case X:return!0}break;case O:return xe===L||xe===U;case D:return xe===$;case P:return!1}return!1}var de=function(ve,xe,at,Ht,Yt){this.left=xe,this.point=ve,this.otherEvent=at,this.isSubject=Ht,this.type=Yt||E,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},he={inResult:{configurable:!0}};function ge(ve,xe){return ve[0]===xe[0]&&ve[1]===xe[1]}de.prototype.isBelow=function(ve){var xe=this.point,at=this.otherEvent.point;return this.left?(xe[0]-ve[0])*(at[1]-ve[1])-(at[0]-ve[0])*(xe[1]-ve[1])>0:(at[0]-ve[0])*(xe[1]-ve[1])-(xe[0]-ve[0])*(at[1]-ve[1])>0},de.prototype.isAbove=function(ve){return!this.isBelow(ve)},de.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},he.inResult.get=function(){return this.resultTransition!==0},de.prototype.clone=function(){var ve=new de(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ve.contourId=this.contourId,ve.resultTransition=this.resultTransition,ve.prevInResult=this.prevInResult,ve.isExteriorRing=this.isExteriorRing,ve.inOut=this.inOut,ve.otherInOut=this.otherInOut,ve},Object.defineProperties(de.prototype,he);var Fe=11102230246251565e-32,Me=134217729,Oe=(3+8*Fe)*Fe;function je(ve,xe,at,Ht,Yt){var Kt,hr,zr,dn,pn=xe[0],en=Ht[0],Qn=0,Li=0;en>pn==en>-pn?(Kt=pn,pn=xe[++Qn]):(Kt=en,en=Ht[++Li]);var Yr=0;if(Qn<ve&&Li<at)for(en>pn==en>-pn?(zr=Kt-((hr=pn+Kt)-pn),pn=xe[++Qn]):(zr=Kt-((hr=en+Kt)-en),en=Ht[++Li]),Kt=hr,zr!==0&&(Yt[Yr++]=zr);Qn<ve&&Li<at;)en>pn==en>-pn?(zr=Kt-((hr=Kt+pn)-(dn=hr-Kt))+(pn-dn),pn=xe[++Qn]):(zr=Kt-((hr=Kt+en)-(dn=hr-Kt))+(en-dn),en=Ht[++Li]),Kt=hr,zr!==0&&(Yt[Yr++]=zr);for(;Qn<ve;)zr=Kt-((hr=Kt+pn)-(dn=hr-Kt))+(pn-dn),pn=xe[++Qn],Kt=hr,zr!==0&&(Yt[Yr++]=zr);for(;Li<at;)zr=Kt-((hr=Kt+en)-(dn=hr-Kt))+(en-dn),en=Ht[++Li],Kt=hr,zr!==0&&(Yt[Yr++]=zr);return Kt===0&&Yr!==0||(Yt[Yr++]=Kt),Yr}function Ue(ve){return new Float64Array(ve)}var ut=33306690738754716e-32,Ze=22204460492503146e-32,_t=11093356479670487e-47,qt=Ue(4),Et=Ue(8),Lt=Ue(12),Ut=Ue(16),lt=Ue(4);function zt(ve,xe,at){var Ht=(function(Yt,Kt,hr,zr,dn,pn){var en=(Kt-pn)*(hr-dn),Qn=(Yt-dn)*(zr-pn),Li=en-Qn;if(en===0||Qn===0||en>0!=Qn>0)return Li;var Yr=Math.abs(en+Qn);return Math.abs(Li)>=ut*Yr?Li:-(function(yi,si,Hn,Di,pi,li,fi){var Kn,tn,ei,ki,Dr,Pn,mi,Bi,vi,mo,ri,ho,As,va,la,Ps,Uh,go,zo=yi-pi,xa=Hn-pi,Ja=si-li,Ra=Di-li;qt[0]=(la=(Bi=zo-(mi=(Pn=Me*zo)-(Pn-zo)))*(mo=Ra-(vi=(Pn=Me*Ra)-(Pn-Ra)))-((va=zo*Ra)-mi*vi-Bi*vi-mi*mo))-((ri=la-(Uh=(Bi=Ja-(mi=(Pn=Me*Ja)-(Pn-Ja)))*(mo=xa-(vi=(Pn=Me*xa)-(Pn-xa)))-((Ps=Ja*xa)-mi*vi-Bi*vi-mi*mo)))+(Dr=la-ri))+(Dr-Uh),qt[1]=(As=va-((ho=va+ri)-(Dr=ho-va))+(ri-Dr))-((ri=As-Ps)+(Dr=As-ri))+(Dr-Ps),qt[2]=ho-((go=ho+ri)-(Dr=go-ho))+(ri-Dr),qt[3]=go;var bp=(function(Vue,lR){for(var cR=lR[0],uw=1;uw<4;uw++)cR+=lR[uw];return cR})(0,qt),gy=Ze*fi;if(bp>=gy||-bp>=gy||(Kn=yi-(zo+(Dr=yi-zo))+(Dr-pi),ei=Hn-(xa+(Dr=Hn-xa))+(Dr-pi),tn=si-(Ja+(Dr=si-Ja))+(Dr-li),ki=Di-(Ra+(Dr=Di-Ra))+(Dr-li),Kn===0&&tn===0&&ei===0&&ki===0)||(gy=_t*fi+Oe*Math.abs(bp),(bp+=zo*ki+Ra*Kn-(Ja*ei+xa*tn))>=gy||-bp>=gy))return bp;lt[0]=(la=(Bi=Kn-(mi=(Pn=Me*Kn)-(Pn-Kn)))*(mo=Ra-(vi=(Pn=Me*Ra)-(Pn-Ra)))-((va=Kn*Ra)-mi*vi-Bi*vi-mi*mo))-((ri=la-(Uh=(Bi=tn-(mi=(Pn=Me*tn)-(Pn-tn)))*(mo=xa-(vi=(Pn=Me*xa)-(Pn-xa)))-((Ps=tn*xa)-mi*vi-Bi*vi-mi*mo)))+(Dr=la-ri))+(Dr-Uh),lt[1]=(As=va-((ho=va+ri)-(Dr=ho-va))+(ri-Dr))-((ri=As-Ps)+(Dr=As-ri))+(Dr-Ps),lt[2]=ho-((go=ho+ri)-(Dr=go-ho))+(ri-Dr),lt[3]=go;var y8=je(4,qt,4,lt,Et);lt[0]=(la=(Bi=zo-(mi=(Pn=Me*zo)-(Pn-zo)))*(mo=ki-(vi=(Pn=Me*ki)-(Pn-ki)))-((va=zo*ki)-mi*vi-Bi*vi-mi*mo))-((ri=la-(Uh=(Bi=Ja-(mi=(Pn=Me*Ja)-(Pn-Ja)))*(mo=ei-(vi=(Pn=Me*ei)-(Pn-ei)))-((Ps=Ja*ei)-mi*vi-Bi*vi-mi*mo)))+(Dr=la-ri))+(Dr-Uh),lt[1]=(As=va-((ho=va+ri)-(Dr=ho-va))+(ri-Dr))-((ri=As-Ps)+(Dr=As-ri))+(Dr-Ps),lt[2]=ho-((go=ho+ri)-(Dr=go-ho))+(ri-Dr),lt[3]=go;var v8=je(y8,Et,4,lt,Lt);lt[0]=(la=(Bi=Kn-(mi=(Pn=Me*Kn)-(Pn-Kn)))*(mo=ki-(vi=(Pn=Me*ki)-(Pn-ki)))-((va=Kn*ki)-mi*vi-Bi*vi-mi*mo))-((ri=la-(Uh=(Bi=tn-(mi=(Pn=Me*tn)-(Pn-tn)))*(mo=ei-(vi=(Pn=Me*ei)-(Pn-ei)))-((Ps=tn*ei)-mi*vi-Bi*vi-mi*mo)))+(Dr=la-ri))+(Dr-Uh),lt[1]=(As=va-((ho=va+ri)-(Dr=ho-va))+(ri-Dr))-((ri=As-Ps)+(Dr=As-ri))+(Dr-Ps),lt[2]=ho-((go=ho+ri)-(Dr=go-ho))+(ri-Dr),lt[3]=go;var x8=je(v8,Lt,4,lt,Ut);return Ut[x8-1]})(Yt,Kt,hr,zr,dn,pn,Yr)})(ve[0],ve[1],xe[0],xe[1],at[0],at[1]);return Ht>0?-1:Ht<0?1:0}function Qe(ve,xe){var at=ve.point,Ht=xe.point;return at[0]>Ht[0]?1:at[0]<Ht[0]?-1:at[1]!==Ht[1]?at[1]>Ht[1]?1:-1:(function(Yt,Kt,hr,zr){return Yt.left!==Kt.left?Yt.left?1:-1:zt(hr,Yt.otherEvent.point,Kt.otherEvent.point)!==0?Yt.isBelow(Kt.otherEvent.point)?-1:1:!Yt.isSubject&&Kt.isSubject?1:-1})(ve,xe,at)}function ct(ve,xe,at){var Ht=new de(xe,!1,ve,ve.isSubject),Yt=new de(xe,!0,ve.otherEvent,ve.isSubject);return ge(ve.point,ve.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ve),Ht.contourId=Yt.contourId=ve.contourId,Qe(Yt,ve.otherEvent)>0&&(ve.otherEvent.left=!0,Yt.left=!1),ve.otherEvent.otherEvent=Yt,ve.otherEvent=Ht,at.push(Yt),at.push(Ht),at}function Gt(ve,xe){return ve[0]*xe[1]-ve[1]*xe[0]}function Ft(ve,xe){return ve[0]*xe[0]+ve[1]*xe[1]}function gr(ve,xe,at){var Ht=(function(dn,pn,en,Qn,Li){var Yr=[pn[0]-dn[0],pn[1]-dn[1]],yi=[Qn[0]-en[0],Qn[1]-en[1]];function si(Pn,mi,Bi){return[Pn[0]+mi*Bi[0],Pn[1]+mi*Bi[1]]}var Hn=[en[0]-dn[0],en[1]-dn[1]],Di=Gt(Yr,yi),pi=Di*Di,li=Ft(Yr,Yr);if(pi>0){var fi=Gt(Hn,yi)/Di;if(fi<0||fi>1)return null;var Kn=Gt(Hn,Yr)/Di;return Kn<0||Kn>1?null:fi===0||fi===1?[si(dn,fi,Yr)]:Kn===0||Kn===1?[si(en,Kn,yi)]:[si(dn,fi,Yr)]}if((pi=(Di=Gt(Hn,Yr))*Di)>0)return null;var tn=Ft(Yr,Hn)/li,ei=tn+Ft(Yr,yi)/li,ki=Math.min(tn,ei),Dr=Math.max(tn,ei);return ki<=1&&Dr>=0?ki===1?[si(dn,ki>0?ki:0,Yr)]:Dr===0?[si(dn,Dr<1?Dr:1,Yr)]:[si(dn,ki>0?ki:0,Yr),si(dn,Dr<1?Dr:1,Yr)]:null})(ve.point,ve.otherEvent.point,xe.point,xe.otherEvent.point),Yt=Ht?Ht.length:0;if(Yt===0||Yt===1&&(ge(ve.point,xe.point)||ge(ve.otherEvent.point,xe.otherEvent.point))||Yt===2&&ve.isSubject===xe.isSubject)return 0;if(Yt===1)return ge(ve.point,Ht[0])||ge(ve.otherEvent.point,Ht[0])||ct(ve,Ht[0],at),ge(xe.point,Ht[0])||ge(xe.otherEvent.point,Ht[0])||ct(xe,Ht[0],at),1;var Kt=[],hr=!1,zr=!1;return ge(ve.point,xe.point)?hr=!0:Qe(ve,xe)===1?Kt.push(xe,ve):Kt.push(ve,xe),ge(ve.otherEvent.point,xe.otherEvent.point)?zr=!0:Qe(ve.otherEvent,xe.otherEvent)===1?Kt.push(xe.otherEvent,ve.otherEvent):Kt.push(ve.otherEvent,xe.otherEvent),hr&&zr||hr?(xe.type=P,ve.type=xe.inOut===ve.inOut?O:D,hr&&!zr&&ct(Kt[1].otherEvent,Kt[0].point,at),2):zr?(ct(Kt[0],Kt[1].point,at),3):Kt[0]!==Kt[3].otherEvent?(ct(Kt[0],Kt[1].point,at),ct(Kt[1],Kt[2].point,at),3):(ct(Kt[0],Kt[1].point,at),ct(Kt[3].otherEvent,Kt[2].point,at),3)}function lr(ve,xe){if(ve===xe)return 0;if(zt(ve.point,ve.otherEvent.point,xe.point)!==0||zt(ve.point,ve.otherEvent.point,xe.otherEvent.point)!==0)return ge(ve.point,xe.point)?ve.isBelow(xe.otherEvent.point)?-1:1:ve.point[0]===xe.point[0]?ve.point[1]<xe.point[1]?-1:1:Qe(ve,xe)===1?xe.isAbove(ve.point)?-1:1:ve.isBelow(xe.point)?-1:1;if(ve.isSubject!==xe.isSubject)return ve.isSubject?-1:1;var at=ve.point,Ht=xe.point;return at[0]===Ht[0]&&at[1]===Ht[1]?(at=ve.otherEvent.point)[0]===(Ht=xe.otherEvent.point)[0]&&at[1]===Ht[1]?0:ve.contourId>xe.contourId?1:-1:Qe(ve,xe)===1?1:-1}var Ot=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Nt(ve,xe,at,Ht){var Yt,Kt=ve+1,hr=xe[ve].point,zr=xe.length;for(Kt<zr&&(Yt=xe[Kt].point);Kt<zr&&Yt[0]===hr[0]&&Yt[1]===hr[1];){if(!at[Kt])return Kt;++Kt<zr&&(Yt=xe[Kt].point)}for(Kt=ve-1;at[Kt]&&Kt>Ht;)Kt--;return Kt}Ot.prototype.isExterior=function(){return this.holeOf==null};var fr=Xt,tr=Xt;function Xt(ve,xe){if(!(this instanceof Xt))return new Xt(ve,xe);if(this.data=ve||[],this.length=this.data.length,this.compare=xe||nr,this.length>0)for(var at=(this.length>>1)-1;at>=0;at--)this._down(at)}function nr(ve,xe){return ve<xe?-1:ve>xe?1:0}Xt.prototype={push:function(ve){this.data.push(ve),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ve=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ve}},peek:function(){return this.data[0]},_up:function(ve){for(var xe=this.data,at=this.compare,Ht=xe[ve];ve>0;){var Yt=ve-1>>1,Kt=xe[Yt];if(at(Ht,Kt)>=0)break;xe[ve]=Kt,ve=Yt}xe[ve]=Ht},_down:function(ve){for(var xe=this.data,at=this.compare,Ht=this.length>>1,Yt=xe[ve];ve<Ht;){var Kt=1+(ve<<1),hr=Kt+1,zr=xe[Kt];if(hr<this.length&&at(xe[hr],zr)<0&&(Kt=hr,zr=xe[hr]),at(zr,Yt)>=0)break;xe[ve]=zr,ve=Kt}xe[ve]=Yt}},fr.default=tr;var Cr=Math.max,Fr=Math.min,Zr=0;function qr(ve,xe,at,Ht,Yt,Kt){var hr,zr,dn,pn,en,Qn;for(hr=0,zr=ve.length-1;hr<zr;hr++)if(pn=ve[hr+1],en=new de(dn=ve[hr],!1,void 0,xe),Qn=new de(pn,!1,en,xe),en.otherEvent=Qn,dn[0]!==pn[0]||dn[1]!==pn[1]){en.contourId=Qn.contourId=at,Kt||(en.isExteriorRing=!1,Qn.isExteriorRing=!1),Qe(en,Qn)>0?Qn.left=!0:en.left=!0;var Li=dn[0],Yr=dn[1];Yt[0]=Fr(Yt[0],Li),Yt[1]=Fr(Yt[1],Yr),Yt[2]=Cr(Yt[2],Li),Yt[3]=Cr(Yt[3],Yr),Ht.push(en),Ht.push(Qn)}}var yn=[];function nn(ve,xe,at){typeof ve[0][0][0]=="number"&&(ve=[ve]),typeof xe[0][0][0]=="number"&&(xe=[xe]);var Ht=(function(Yr,yi,si){var Hn=null;return Yr.length*yi.length==0&&(si===L?Hn=yn:si===$?Hn=Yr:si!==U&&si!==X||(Hn=Yr.length===0?yi:Yr)),Hn})(ve,xe,at);if(Ht)return Ht===yn?null:Ht;var Yt=[1/0,1/0,-1/0,-1/0],Kt=[1/0,1/0,-1/0,-1/0],hr=(function(Yr,yi,si,Hn,Di){var pi,li,fi,Kn,tn,ei,ki=new fr(null,Qe);for(fi=0,Kn=Yr.length;fi<Kn;fi++)for(tn=0,ei=(pi=Yr[fi]).length;tn<ei;tn++)(li=tn===0)&&Zr++,qr(pi[tn],!0,Zr,ki,si,li);for(fi=0,Kn=yi.length;fi<Kn;fi++)for(tn=0,ei=(pi=yi[fi]).length;tn<ei;tn++)li=tn===0,Di===$&&(li=!1),li&&Zr++,qr(pi[tn],!1,Zr,ki,Hn,li);return ki})(ve,xe,Yt,Kt,at);if(Ht=(function(Yr,yi,si,Hn,Di){var pi=null;return(si[0]>Hn[2]||Hn[0]>si[2]||si[1]>Hn[3]||Hn[1]>si[3])&&(Di===L?pi=yn:Di===$?pi=Yr:Di!==U&&Di!==X||(pi=Yr.concat(yi))),pi})(ve,xe,Yt,Kt,at))return Ht===yn?null:Ht;for(var zr=(function(Yr){var yi,si,Hn=(function(fi){var Kn,tn,ei,ki,Dr=[];for(tn=0,ei=fi.length;tn<ei;tn++)((Kn=fi[tn]).left&&Kn.inResult||!Kn.left&&Kn.otherEvent.inResult)&&Dr.push(Kn);for(var Pn=!1;!Pn;)for(Pn=!0,tn=0,ei=Dr.length;tn<ei;tn++)tn+1<ei&&Qe(Dr[tn],Dr[tn+1])===1&&(ki=Dr[tn],Dr[tn]=Dr[tn+1],Dr[tn+1]=ki,Pn=!1);for(tn=0,ei=Dr.length;tn<ei;tn++)(Kn=Dr[tn]).otherPos=tn;for(tn=0,ei=Dr.length;tn<ei;tn++)(Kn=Dr[tn]).left||(ki=Kn.otherPos,Kn.otherPos=Kn.otherEvent.otherPos,Kn.otherEvent.otherPos=ki);return Dr})(Yr),Di={},pi=[],li=function(){if(!Di[yi]){var fi=pi.length,Kn=(function(Dr,Pn,mi){var Bi=new Ot;if(Dr.prevInResult!=null){var vi=Dr.prevInResult,mo=vi.outputContourId;if(vi.resultTransition>0){var ri=Pn[mo];if(ri.holeOf!=null){var ho=ri.holeOf;Pn[ho].holeIds.push(mi),Bi.holeOf=ho,Bi.depth=Pn[mo].depth}else Pn[mo].holeIds.push(mi),Bi.holeOf=mo,Bi.depth=Pn[mo].depth+1}else Bi.holeOf=null,Bi.depth=Pn[mo].depth}else Bi.holeOf=null,Bi.depth=0;return Bi})(Hn[yi],pi,fi),tn=function(Dr){Di[Dr]=!0,Dr<Hn.length&&Hn[Dr]&&(Hn[Dr].outputContourId=fi)},ei=yi,ki=yi;for(Kn.points.push(Hn[yi].point);tn(ei),tn(ei=Hn[ei].otherPos),Kn.points.push(Hn[ei].point),!((ei=Nt(ei,Hn,Di,ki))==ki||ei>=Hn.length)&&Hn[ei];);pi.push(Kn)}};for(yi=0,si=Hn.length;yi<si;yi++)li();return pi})((function(Yr,yi,si,Hn,Di,pi){for(var li,fi,Kn,tn=new h(lr),ei=[],ki=Math.min(Hn[2],Di[2]);Yr.length!==0;){var Dr=Yr.pop();if(ei.push(Dr),pi===L&&Dr.point[0]>ki||pi===$&&Dr.point[0]>Hn[2])break;if(Dr.left){fi=li=tn.insert(Dr),li=li!==(Kn=tn.minNode())?tn.prev(li):null,fi=tn.next(fi);var Pn=li?li.key:null;if(J(Dr,Pn,pi),fi&&gr(Dr,fi.key,Yr)===2&&(J(Dr,Pn,pi),J(fi.key,Dr,pi)),li&&gr(li.key,Dr,Yr)===2){var mi=li;J(Pn,(mi=mi!==Kn?tn.prev(mi):null)?mi.key:null,pi),J(Dr,Pn,pi)}}else fi=li=tn.find(Dr=Dr.otherEvent),li&&fi&&(li=li!==Kn?tn.prev(li):null,fi=tn.next(fi),tn.remove(Dr),fi&&li&&gr(li.key,fi.key,Yr))}return ei})(hr,0,0,Yt,Kt,at)),dn=[],pn=0;pn<zr.length;pn++){var en=zr[pn];if(en.isExterior()){for(var Qn=[en.points],Li=0;Li<en.holeIds.length;Li++)Qn.push(zr[en.holeIds[Li]].points);dn.push(Qn)}}return dn}var di={UNION:U,DIFFERENCE:$,INTERSECTION:L,XOR:X};i.diff=function(ve,xe){return nn(ve,xe,$)},i.intersection=function(ve,xe){return nn(ve,xe,L)},i.operations=di,i.union=function(ve,xe){return nn(ve,xe,U)},i.xor=function(ve,xe){return nn(ve,xe,X)},Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,XI.exports)),XI.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function $v(a,e,i,u){const h=[],p=u===0?(g,w,E,P,O,D)=>{g.push(new kt(D,E+(D-w)/(P-w)*(O-E)))}:(g,w,E,P,O,D)=>{g.push(new kt(w+(D-E)/(O-E)*(P-w),D))};for(const g of a){const w=[];for(const E of g){if(E.length<=2)continue;const P=[];for(let L=0;L<E.length-1;L++){const U=E[L].x,$=E[L].y,X=E[L+1].x,J=E[L+1].y,ie=u===0?U:$,de=u===0?X:J;ie<e?de>e&&p(P,U,$,X,J,e):ie>i?de<i&&p(P,U,$,X,J,i):P.push(E[L]),de<e&&ie>=e&&p(P,U,$,X,J,e),de>i&&ie<=i&&p(P,U,$,X,J,i)}let O=E[E.length-1];const D=u===0?O.x:O.y;D>=e&&D<=i&&P.push(O),P.length&&(O=P[P.length-1],P[0].x===O.x&&P[0].y===O.y||P.push(P[0]),w.push(P))}w.length&&h.push(w)}return h}function vV(a,e){const i=a1(a),u=a1([e]),h=KI.intersection(i,u);return h==null?[]:YI(h)}function xV(a,e){let u=a1(a,65536);for(;e.valid();e.next()){const[h,p]=e.get(),g=h.x*65536,w=h.y*65536,E=p.x*65536,P=p.y*65536,O=E-g,D=P-w,L=Math.hypot(O,D),U=Math.trunc(D/L*3),$=-Math.trunc(O/L*3);u=KI.diff(u,[[[g,w],[E,P],[E+U,P+$],[g+U,w+$],[g,w]]])}return YI(u,1/65536)}function a1(a,e=1){return[a.map((i=>i.map((u=>[u.x*e,u.y*e]))))]}function YI(a,e=1){return a.map((i=>i.map(((u,h)=>{const p=u.map((g=>new kt(g[0]*e,g[1]*e).round()));return h>0&&p.reverse(),p}))))}class s1{constructor(e,i){this.layoutVertexArray=new ma,this.indexArray=new ai,this.lineIndexArray=new $s,this.triangleSegments=new Si,this.lineSegments=new Si,this.programConfigurations=new Za(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Lu)}update(e,i,u,h,p,g,w,E){this.programConfigurations.updatePaintArrays(e,i,p,u,h,g,w,E)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,iV.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,oV.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,u,h,p,g,w){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,u,h,p,g,void 0,w)}}class l1{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new s1(e,!1),this.elevationBufferData=new s1(e,!0),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,u,h){this.hasPattern=i1("fill",this.layers,this.pixelRatio,i);const p=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:w,id:E,index:P,sourceLayerIndex:O}of e){const D=this.layers[0]._featureFilter.needGeometry,L=ot(w,D);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{worldview:this.worldview}),L,u))continue;const U=p?p.evaluate(L,{},u,i.availableImages):void 0,$={id:E,properties:w.properties,type:w.type,sourceLayerIndex:O,index:P,geometry:D?L.geometry:ze(w,u,h),patterns:{},sortKey:U};g.push($)}p&&g.sort(((w,E)=>w.sortKey-E.sortKey));for(const w of g){const{geometry:E,index:P,sourceLayerIndex:O}=w;if(this.hasPattern){const D=o1("fill",this.layers,w,this.zoom,this.pixelRatio,i);this.patternFeatures.push(D)}else this.addFeature(w,E,P,u,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[P].feature,E,P,O,this.index)}}update(e,i,u,h,p,g,w){this.bufferData.update(e,i,u,h,p,g,w,this.worldview),this.elevationBufferData.update(e,i,u,h,p,g,w,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,u,h,p,g,w,this.worldview)}addFeatures(e,i,u,h,p,g){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,i,u,h,g,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,u,h,p,g=[],w,E){const P=N_(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,P,h,u,E):this.addGeometry(P,this.bufferData),this.bufferData.populatePaintArrays(e,u,p,g,h,w,this.worldview),this.elevationBufferData.populatePaintArrays(e,u,p,g,h,w,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,u,h,p){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,u,h,p,this.worldview))}addElevatedRoadFeature(e,i,u,h,p){const g=new Array,w=Ti.getElevationFeature(e,p);if(!w)return void this.addGeometry(i,this.bufferData);{const P=this.clipPolygonsToTile(i,1);P.length>0&&g.push({polygons:P,elevationFeature:w,elevationTileID:u})}const E={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},u),featureIndex:h};for(const P of g)if(P.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Zs(P.elevationTileID,this.layers,this.zoom,this.lut));const D=P.elevationFeature.isTunnel();let L=0;e.properties.hasOwnProperty(dr)&&(L=+e.properties[dr]);for(const U of P.polygons)this.elevatedStructures.addPortalCandidates(P.elevationFeature.id,U,D,P.elevationFeature,L)}P.elevationFeature.constantHeight==null&&(P.polygons=this.prepareElevatedPolygons(P.polygons,P.elevationFeature,P.elevationTileID));const O=new xn(u,P.elevationTileID);this.addElevatedGeometry(P.polygons,O,P.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,E)}}addElevatedGeometry(e,i,u,h,p,g){const w={elevation:u,elevationSampler:i,bias:h,index:p,featureInfo:g},[E,P]=this.addGeometry(e,this.elevationBufferData,w);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:E,max:P}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,E),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,P))}addGeometry(e,i,u){let h=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,g=null;u&&(g=u.elevationSampler.constantElevation(u.elevation,u.bias),g!=null&&(h=g,p=g));const w=(E,P,O)=>{if(u!=null)if(P.push(E),g!=null)i.elevatedLayoutVertexArray.emplaceBack(g),O.push(g);else{const D=u.elevationSampler.pointElevation(E,u.elevation,u.bias);i.elevatedLayoutVertexArray.emplaceBack(D),O.push(D),h=Math.min(h,D),p=Math.max(p,D)}};for(const E of e){let P=0;for(const he of E)P+=he.length;const O=i.triangleSegments.prepareSegment(P,i.layoutVertexArray,i.indexArray),D=O.vertexLength,L=[],U=[],$=[],X=[],J=[],ie=i.layoutVertexArray.length;for(const he of E){if(he.length===0)continue;he!==E[0]&&U.push(L.length/2);const ge=i.lineSegments.prepareSegment(he.length,i.layoutVertexArray,i.lineIndexArray),Fe=ge.vertexLength;u&&J.push(i.layoutVertexArray.length-ie),w(he[0],$,X),i.layoutVertexArray.emplaceBack(he[0].x,he[0].y),i.lineIndexArray.emplaceBack(Fe+he.length-1,Fe),L.push(he[0].x),L.push(he[0].y);for(let Me=1;Me<he.length;Me++)w(he[Me],$,X),i.layoutVertexArray.emplaceBack(he[Me].x,he[Me].y),i.lineIndexArray.emplaceBack(Fe+Me-1,Fe+Me),L.push(he[Me].x),L.push(he[Me].y);ge.vertexLength+=he.length,ge.primitiveLength+=he.length}const de=cg(L,U);for(let he=0;he<de.length;he+=3)i.indexArray.emplaceBack(D+de[he],D+de[he+1],D+de[he+2]);if(de.length>0&&u&&this.elevationMode==="hd-road-base"){const he=u.elevation.isTunnel(),ge=u.elevation.safeArea,Fe=this.elevatedStructures.addVertices($,X);this.elevatedStructures.addTriangles(de,Fe,he);const Me=J.length;if(Me>0){for(let Oe=0;Oe<Me-1;Oe++)this.elevatedStructures.addRenderableRing(u.index,J[Oe]+Fe,J[Oe+1]-J[Oe],he,ge,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,J[Me-1]+Fe,$.length-J[Me-1],he,ge,u.featureInfo)}}O.vertexLength+=P,O.primitiveLength+=de.length/3}return[h,p]}prepareElevatedPolygons(e,i,u){const h=1/Pe(u),p=[];for(const g of e){const w=xV(g,new Gn(i,h));p.push(...w)}return p}clipPolygonsToTile(e,i){const u=-i,h=-i,p=Wt+i,g=Wt+i;let w=0;const E=[],P=[];for(;w<e.length;w++){const L=e[w],U=jp(L);(U.min.x>=u&&U.max.x<=p&&U.min.y>=h&&U.max.y<=g?E:P).push(L)}if(E.length===e.length)return e;const O=[new kt(u,h),new kt(p,h),new kt(p,g),new kt(u,g),new kt(u,h)],D=E;for(const L of P)D.push(...vV(L,O));return D}}let JI,QI,eC,tC;ir(l1,"FillBucket",{omit:["layers","patternFeatures"]}),ir(s1,"FillBufferData"),ir(Zs,"ElevatedStructures");class qv{constructor(e,i,u,h){if(this.triangleCount=i.length/3,this.min=new kt(0,0),this.max=new kt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[p,g]=[e[0].clone(),e[0].clone()];for(let D=1;D<e.length;++D){const L=e[D];p.x=Math.min(p.x,L.x),p.y=Math.min(p.y,L.y),g.x=Math.max(g.x,L.x),g.y=Math.max(g.y,L.y)}if(h){const D=Math.ceil(Math.max(g.x-p.x,g.y-p.y)/h);u=Math.max(u,D)}if(u===0)return;this.min=p,this.max=g;const w=this.max.sub(this.min);w.x=Math.max(w.x,1),w.y=Math.max(w.y,1);const E=Math.max(w.x,w.y)/u;this.cellsX=Math.max(1,Math.ceil(w.x/E)),this.cellsY=Math.max(1,Math.ceil(w.y/E)),this.xScale=1/E,this.yScale=1/E;const P=[];for(let D=0;D<this.triangleCount;D++){const L=e[i[3*D+0]].sub(this.min),U=e[i[3*D+1]].sub(this.min),$=e[i[3*D+2]].sub(this.min),X=Nh(Math.floor(Math.min(L.x,U.x,$.x)),this.xScale,this.cellsX),J=Nh(Math.floor(Math.max(L.x,U.x,$.x)),this.xScale,this.cellsX),ie=Nh(Math.floor(Math.min(L.y,U.y,$.y)),this.yScale,this.cellsY),de=Nh(Math.floor(Math.max(L.y,U.y,$.y)),this.yScale,this.cellsY),he=new kt(0,0),ge=new kt(0,0),Fe=new kt(0,0),Me=new kt(0,0);for(let Oe=ie;Oe<=de;++Oe){he.y=ge.y=Oe*E,Fe.y=Me.y=(Oe+1)*E;for(let je=X;je<=J;++je)he.x=Fe.x=je*E,ge.x=Me.x=(je+1)*E,(eo(L,U,$,he,ge,Me)||eo(L,U,$,he,Me,Fe))&&P.push({cellIdx:Oe*this.cellsX+je,triIdx:D})}}if(P.length===0)return;P.sort(((D,L)=>D.cellIdx-L.cellIdx||D.triIdx-L.triIdx));let O=0;for(;O<P.length;){const D=P[O].cellIdx,L={start:this.payload.length,len:0};for(;O<P.length&&P[O].cellIdx===D;)++L.len,this.payload.push(P[O++].triIdx);this.cells[D]=L}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const u=Nh(e.x-this.min.x,this.xScale,this.cellsX),h=Nh(e.y-this.min.y,this.yScale,this.cellsY),p=this.cells[h*this.cellsX+u];if(p){this._lazyInitLookup();for(let g=0;g<p.len;g++){const w=this.payload[p.start+g],E=Math.floor(w/8),P=1<<w%8;if(!(this.lookup[E]&P)&&(this.lookup[E]|=P,i.push(w),i.length===this.triangleCount))return}}}query(e,i,u){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const h=Nh(e.x-this.min.x,this.xScale,this.cellsX),p=Nh(i.x-this.min.x,this.xScale,this.cellsX),g=Nh(e.y-this.min.y,this.yScale,this.cellsY),w=Nh(i.y-this.min.y,this.yScale,this.cellsY);for(let E=g;E<=w;E++)for(let P=h;P<=p;P++){const O=this.cells[E*this.cellsX+P];if(O)for(let D=0;D<O.len;D++){const L=this.payload[O.start+D],U=Math.floor(L/8),$=1<<L%8;if(!(this.lookup[U]&$)&&(this.lookup[U]|=$,u.push(L),u.length===this.triangleCount))return}}}}function Nh(a,e,i){return Math.max(0,Math.min(i-1,Math.floor(a*e)))}ir(qv,"TriangleGridIndex");class rC{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const u of this.footprints)i.push({footprint:u,id:e})}populate(e,i,u,h){const p=[];for(const{feature:g,id:w,index:E,sourceLayerIndex:P}of e){const O=this.layers[0]._featureFilter.needGeometry,D=ot(g,O);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{worldview:this.worldview}),D,u))continue;const L={id:w,properties:g.properties,type:g.type,sourceLayerIndex:P,index:E,geometry:O?D.geometry:ze(g,u,h),patterns:{}};p.push(L)}for(const g of p){const{geometry:w,index:E,sourceLayerIndex:P}=g;this.addFeature(g,w,E,u,{},i.availableImages,i.brightness),i.featureIndex.insert(e[E].feature,w,E,P,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,u,h,p,g,w){}destroy(){}addFeature(e,i,u,h,p,g=[],w){for(const E of N_(i,2)){const P=[],O=[],D=[],L=new kt(1/0,1/0),U=new kt(-1/0,-1/0);for(const J of E)if(J.length!==0){J!==E[0]&&D.push(O.length/2);for(let ie=0;ie<J.length;ie++)O.push(J[ie].x),O.push(J[ie].y),P.push(J[ie]),L.x=Math.min(L.x,J[ie].x),L.y=Math.min(L.y,J[ie].y),U.x=Math.max(U.x,J[ie].x),U.y=Math.max(U.y,J[ie].y)}const $=cg(O,D),X=new qv(P,$,8,256);this.footprints.push({vertices:P,indices:$,grid:X,min:L,max:U})}}}ir(rC,"ClipBucket",{omit:["layers"]});const bV=mn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),wV=mn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),SV=mn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),TV=mn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),EV=mn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),AV=mn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:PV}=bV,j_=Number.MAX_SAFE_INTEGER,nC=j_-1;function iC(a,e,i,u){return a.order<e||a.order===j_||!(a.clipMask&i)||(function(h,p){return p.length!==0&&p.find((g=>g===h))===void 0})(u,a.clipScope)}function Gv(a,e){return a.x-e.x||a.y-e.y}function oC(a,e){return Gv(a.min,e.min)===0&&Gv(a.max,e.max)===0}function c1(a,e){return!(a.min.x>e.max.x||a.max.x<e.min.x||a.min.y>e.max.y||a.max.y<e.min.y)}function Hv(a,e){if(a.length!==e.length)return!1;for(let i=0;i<a.length;i++)if(a[i].sourceId!==e[i].sourceId||!oC(a[i],e[i])||a[i].order!==e[i].order||a[i].clipMask!==e[i].clipMask||!sl(a[i].clipScope,e[i].clipScope))return!1;return!0}function aC(a,e,i){const u=1/Wt,h=1/(1<<i.canonical.z),p=(e.x*u+i.canonical.x)*h+i.wrap,g=(e.y*u+i.canonical.y)*h;return{min:new kt((a.x*u+i.canonical.x)*h+i.wrap,(a.y*u+i.canonical.y)*h),max:new kt(p,g)}}function IV(a,e,i){const u=1<<i.canonical.z,h=((e.x-i.wrap)*u-i.canonical.x)*Wt,p=(e.y*u-i.canonical.y)*Wt;return{min:new kt(((a.x-i.wrap)*u-i.canonical.x)*Wt,(a.y*u-i.canonical.y)*Wt),max:new kt(h,p)}}function u1(a,e,i,u,h,p,g){const w=a.indices,E=a.vertices,P=[];for(let O=u;O<u+h;O+=3){const D=e[i[O+0]+p],L=e[i[O+1]+p],U=e[i[O+2]+p],$=Math.min(D.x,L.x,U.x),X=Math.max(D.x,L.x,U.x),J=Math.min(D.y,L.y,U.y),ie=Math.max(D.y,L.y,U.y);P.length=0,a.grid.query(new kt($,J),new kt(X,ie),P);for(let de=0;de<P.length;de++){const he=P[de];if(eo(E[w[3*he+0]],E[w[3*he+1]],E[w[3*he+2]],D,L,U,g))return!0}}return!1}function sC(a,e,i,u){if(!a||!i)return!1;let h=a.vertices;if(!e.canonical.equals(u.canonical)||e.wrap!==u.wrap){if(i.vertices.length<a.vertices.length)return sC(i,u,a,e);const p=e.canonical,g=u.canonical,w=Math.pow(2,g.z-p.z);h=a.vertices.map((E=>new kt((E.x+p.x*Wt)*w-g.x*Wt,(E.y+p.y*Wt)*w-g.y*Wt)))}return u1(i,h,a.indices,0,a.indices.length,0,0)}function lC(a,e,i,u){const h=Math.pow(2,u.z-i.z);return new kt((a+i.x*Wt)*h-u.x*Wt,(e+i.y*Wt)*h-u.y*Wt)}function h1(a,e){const i=[];e.grid.queryPoint(a,i);const u=e.indices,h=e.vertices;for(let p=0;p<i.length;p++){const g=i[p];if(Yo([h[u[3*g+0]],h[u[3*g+1]],h[u[3*g+2]]],a))return!0}return!1}const f1=[new kt(0,0),new kt(Wt,0),new kt(Wt,Wt),new kt(0,Wt)];function cC(a,e){const i=[];let u=[];if(!e||a.length<2)return[a];if(a.length===2)return Oi(a[0],a[1],f1)?[a]:[];for(let h=0;h<a.length+2;h++){const p=a[h%a.length],g=a[(h+1)%a.length],w=Oi(h===0?a[a.length-1]:a[(h-1)%a.length],p,f1),E=Oi(p,g,f1),P=w||E;P&&u.push(p),P&&E||u.length>0&&(u.length>1&&i.push(u),u=[])}return u.length>1&&i.push(u),i}const d1=tt.types,CV=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],MV=["fill-extrusion-flood-light-ground-radius"],OV=Math.pow(2,13),RV=Math.pow(2,15)-1,uC=new kt(0,1),mp=2147483648;function U_(a,e,i,u,h,p,g,w){a.emplaceBack((e<<1)+g,(i<<1)+p,(Math.floor(u*OV)<<1)+h,Math.round(w))}function V_(a,e,i){a.emplaceBack(e.x*Wt,e.y*Wt,i?1:0)}function Wv(a,e,i,u,h,p){a.emplaceBack(e.x,e.y,(i.x<<1)+u,(i.y<<1)+h,p)}function $_(a,e,i){a.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class hC{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class fC{constructor(){this.centroidXY=new kt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new kt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new kt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new kt(this.max.x-this.min.x,this.max.y-this.min.y)}}class dC{constructor(){this.acc=new kt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,u){this.accCount++,this.acc._add(i);let h=!!this.borders;i.x<e.min.x?(e.min.x=i.x,h=!0):i.x>e.max.x&&(e.max.x=i.x,h=!0),i.y<e.min.y?(e.min.y=i.y,h=!0):i.y>e.max.y&&(e.max.y=i.y,h=!0),((i.x===0||i.x===Wt)&&i.x===u.x)!=((i.y===0||i.y===Wt)&&i.y===u.y)&&this.processBorderOverlap(i,u),h&&this.checkBorderIntersection(i,u)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Sr(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Wt!=e.x>Wt&&this.addBorderIntersection(1,Sr(i.y,e.y,(Wt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Sr(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Wt!=e.y>Wt&&this.addBorderIntersection(3,Sr(i.x,e.x,(Wt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[e];i<u[0]&&(u[0]=i),i>u[1]&&(u[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const u=e.x===0?0:1;this.addBorderIntersection(u,i.y),this.addBorderIntersection(u,e.y)}else{const u=e.y===0?2:3;this.addBorderIntersection(u,i.x),this.addBorderIntersection(u,e.x)}}centroid(){return this.accCount===0?new kt(0,0):new kt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,i)=>e+ +(i[0]!==Number.MAX_VALUE)),0):0}}function pC(a,e){const i=a.add(e)._unit(),u=we(a.x*i.x+a.y*i.y,-1,1);var h,p,g;return h=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(h)))/4*RV*((p=a).x*(g=e).y-p.y*g.x<0?-1:1)}const DV=[a=>a.x<0,a=>a.x>Wt,a=>a.y<0,a=>a.y>Wt];function kV(a,e,i,u){const h=[4];if(u===0)return h;i._mult(u);const p=a.sub(i),g=e.sub(i),w=[a,e,p,g];for(let E=0;E<4;E++)for(const P of w)if(DV[E](P)){h.push(E);break}return h}class p1{constructor(e){this.vertexArray=new Nf,this.indexArray=new ai,this.programConfigurations=new Za(e.layers,{zoom:e.zoom,lut:e.lut},(i=>MV.includes(i))),this._segments=new Si,this.hiddenByLandmarkVertexArray=new Vf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Si}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,u,h=!1){const p=e.length;if(p>2){let g=Math.max(0,this._segments.get().length-1);const w=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let E;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const P=e[0],O=e[1];E=pC(P.sub(e[p-1])._perp()._unit(),O.sub(P)._perp()._unit())}for(let P=0;P<p;P++){const O=P===p-1?0:P+1,D=e[P],L=e[O],U=e[O===p-1?0:O+1],$=L.sub(D)._perp()._unit(),X=pC($,U.sub(L)._perp()._unit()),J=E,ie=X;if(m1(D,L,i)||h&&_C(D,i)&&_C(L,i)){E=X;continue}const de=w.vertexLength;Wv(this.vertexArray,D,L,1,1,J),Wv(this.vertexArray,D,L,1,0,J),Wv(this.vertexArray,D,L,0,1,ie),Wv(this.vertexArray,D,L,0,0,ie),w.vertexLength+=4;const he=kV(D,L,$,u);for(const ge of he)this._segmentToGroundQuads[g].push({id:de,region:ge}),this._segmentToRegionTriCounts[g][ge]+=2,w.primitiveLength+=2;E=X}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let u=0;u<i;u++)this._segmentToGroundQuads[u].sort(((h,p)=>h.region-p.region));for(let u=0;u<i;u++){const h=this._segmentToGroundQuads[u],p=e[u],g=this._segmentToRegionTriCounts[u];g.reduce(((E,P)=>E+P),0);let w=0;for(let E=0;E<=4;E++){const P=g[E];if(P!==0){let O=this.regionSegments[E];O||(O=this.regionSegments[E]=new Si);const D={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+w,vertexLength:p.vertexLength,primitiveLength:P};O.get().push(D)}w+=P}for(let E=0;E<h.length;E++){const P=h[E].id;this.indexArray.emplaceBack(P,P+1,P+3),this.indexArray.emplaceBack(P,P+3,P+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,u,h,p,g,w){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,u,h,p,g,void 0,w)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,wV.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,u,h,p,g,w,E){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,u,h,p,g,w,E)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&mp))}updateHiddenByLandmarkRange(e,i,u){if(!this.hasData())return;const h=i+e;if(i!==0){for(let p=e;p<h;++p)this.hiddenByLandmarkVertexArray.emplace(p,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,EV.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Zv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ai,this.footprintVertices=new ma,this.footprintSegments=[],this.layoutVertexArray=new ku,this.centroidVertexArray=new tg,this.wallVertexArray=new op,this.indexArray=new ai,this.programConfigurations=new Za(e.layers,{zoom:e.zoom,lut:e.lut},(i=>CV.includes(i))),this.segments=new Si,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.groundEffect=new p1(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,u,h){this.features=[],this.hasPattern=i1("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Pe(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:g,index:w,sourceLayerIndex:E}of e){const P=this.layers[0]._featureFilter.needGeometry,O=ot(p,P);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{worldview:this.worldview}),O,u))continue;const D={id:g,sourceLayerIndex:E,index:w,geometry:P?O.geometry:ze(p,u,h),properties:p.properties,type:p.type,patterns:{}},L=this.layoutVertexArray.length,U=d1[D.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:p.id,feature:o1("fill-extrusion",this.layers,D,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const $ of D.geometry)for(const X of cC($,U))this.addFeature(p.id,D,[X],w,u,{},i.availableImages,h,i.brightness);else this.addFeature(p.id,D,D.geometry,w,u,{},i.availableImages,h,i.brightness);i.featureIndex.insert(p,D.geometry,w,E,this.index,L)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,u,h,p,g){for(const{featureId:w,feature:E}of this.features){const P=d1[E.type]==="Polygon",{geometry:O}=E;if(this.wallMode)for(const D of O)for(const L of cC(D,P))this.addFeature(w,E,[L],E.index,i,u,h,p,g);else this.addFeature(w,E,O,E.index,i,u,h,p,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,u,h,p,g,w){this.programConfigurations.updatePaintArrays(e,i,p,u,h,g,w,this.worldview),this.groundEffect.update(e,i,p,u,h,g,w,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,PV),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,TV.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,AV.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,SV.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,u,h,p,g,w,E,P){const O=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,D=[new kt(0,0),new kt(Wt,Wt)],L=E.projection,U=L.name==="globe",$=this.wallMode||d1[i.type]==="Polygon",X=new dC;X.centroidDataIndex=this.centroidData.length;const J=new fC;J.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(J.buildingId=i.properties.building_id);const ie=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},p)<=0,de=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},p);let he;if(J.height=de,J.vertexArrayOffset=this.layoutVertexArray.length,J.groundVertexArrayOffset=this.groundEffect.vertexArray.length,U&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Xd),this.wallMode){if(U)return void fn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;he=(function(Ze){const _t=Ze[0].x===Ze[Ze.length-1].x&&Ze[0].y===Ze[Ze.length-1].y;(function(Nt){let fr=0;const tr=Nt.length;for(let Xt=0;Xt<tr;Xt++)fr+=(Nt[(Xt+1)%tr].x-Nt[Xt].x)*(Nt[(Xt+1)%tr].y+Nt[Xt].y);return fr>=0})(Ze)||(Ze=Ze.reverse());const Et={geometry:[],joinNormals:[],indices:[]},Lt=[],Ut=[],lt=[];let zt=Ze.length;for(;zt>=2&&Ze[zt-1].equals(Ze[zt-2]);)zt--;if(zt<(_t?3:2))return Et;let Qe,ct,Gt,Ft,gr,lr=0;for(;lr<zt-1&&Ze[lr].equals(Ze[lr+1]);)lr++;_t&&(Qe=Ze[zt-2],gr=Ze[lr].sub(Qe)._unit()._perp());for(let Nt=lr;Nt<zt;Nt++){if(Gt=Nt===zt-1?_t?Ze[lr+1]:void 0:Ze[Nt+1],Gt&&Ze[Nt].equals(Gt))continue;gr&&(Ft=gr),Qe&&(ct=Qe),Qe=Ze[Nt],gr=Gt?Gt.sub(Qe)._unit()._perp():Ft,Ft=Ft||gr;let fr=Ft.add(gr);fr.x===0&&fr.y===0||fr._unit();const tr=fr.x*gr.x+fr.y*gr.y,Xt=tr!==0?1/tr:1/0,nr=Ft.x*gr.y-Ft.y*gr.x>0;let Cr="miter";const Fr=2;Cr==="miter"&&Xt>Fr&&(Cr="bevel"),Cr==="bevel"&&(Xt>100&&(Cr="flipbevel"),Xt<Fr&&(Cr="miter"));const Zr=(qr,yn,nn,di)=>{const ve=new kt(qr.x,qr.y),xe=new kt(qr.x,qr.y);ve.x+=yn.x*di,ve.y+=yn.y*di,xe.x-=yn.x*Math.max(nn,1),xe.y-=yn.y*Math.max(nn,1),lt.push(yn),Lt.push(ve),Ut.push(xe)};if(Cr==="miter")fr._mult(Xt),Zr(Qe,fr,0,0);else if(Cr==="flipbevel")fr=gr.mult(-1),Zr(Qe,fr,0,0),Zr(Qe,fr.mult(-1),0,0);else{const qr=-Math.sqrt(Xt*Xt-1),yn=nr?qr:0,nn=nr?0:qr;ct&&Zr(Qe,Ft,yn,nn),Gt&&Zr(Qe,gr,yn,nn)}}Et.geometry=[...Lt,...Ut.reverse(),Lt[0]],Et.joinNormals=[...lt,...lt.reverse(),lt[lt.length-1]];const Ot=Et.geometry.length-1;for(let Nt=0;Nt<Ot/2;Nt++)if(Nt+1<Ot/2){let fr=Nt,tr=Nt+1,Xt=Ot-1-Nt,nr=Ot-2-Nt;fr=fr===0?Ot-1:fr-1,tr=tr===0?Ot-1:tr-1,Xt=Xt===0?Ot-1:Xt-1,nr=nr===0?Ot-1:nr-1,Et.indices.push(Xt),Et.indices.push(tr),Et.indices.push(fr),Et.indices.push(Xt),Et.indices.push(nr),Et.indices.push(tr)}return Et})(u[0]),u=[he.geometry]}const ge=(Ze,_t)=>Ze<(_t.length-1)/2||Ze===_t.length-1,Fe=this.wallMode?[u]:N_(u,500);for(let Ze=Fe.length-1;Ze>=0;Ze--){const _t=Fe[Ze];(_t.length===0||(Me=_t[0]).every((qt=>qt.x<=0))||Me.every((qt=>qt.x>=Wt))||Me.every((qt=>qt.y<=0))||Me.every((qt=>qt.y>=Wt)))&&Fe.splice(Ze,1)}var Me;let Oe;if(U)Oe=bC(Fe,D,p);else{Oe=[];for(const Ze of Fe)Oe.push({polygon:Ze,bounds:D})}const je=$?this.edgeRadius:0,Ue=je>0&&this.zoom<17,ut=(Ze,_t)=>{if(Ze.length===0)return!1;const qt=Ze[Ze.length-1];return _t.x===qt.x&&_t.y===qt.y};for(const{polygon:Ze,bounds:_t}of Oe){let qt=0,Et=0;for(const zt of Ze)$&&!zt[0].equals(zt[zt.length-1])&&zt.push(zt[0]),Et+=$?zt.length-1:zt.length;const Lt=this.segments.prepareSegment(($?5:4)*Et,this.layoutVertexArray,this.indexArray);J.footprintSegIdx<0&&(J.footprintSegIdx=this.footprintSegments.length),J.polygonSegIdx<0&&(J.polygonSegIdx=this.polygonSegments.length);const Ut={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},lt=new hC;if(lt.vertexOffset=this.footprintVertices.length,lt.indexOffset=3*this.footprintIndices.length,lt.ringIndices=[],$){const zt=[],Qe=[];qt=Lt.vertexLength;for(let Gt=0;Gt<Ze.length;Gt++){const Ft=Ze[Gt];Ft.length&&Gt!==0&&Qe.push(zt.length/2);const gr=[];let lr,Ot;lr=Ft[1].sub(Ft[0])._perp()._unit(),lt.ringIndices.push(Ft.length-1);for(let Nt=1;Nt<Ft.length;Nt++){const fr=Ft[Nt],tr=Ft[Nt===Ft.length-1?1:Nt+1],Xt=fr.clone();if(je){Ot=tr.sub(fr)._perp()._unit();const nr=lr.add(Ot)._unit(),Cr=je*Math.min(4,1/(lr.x*nr.x+lr.y*nr.y));Xt.x+=Cr*nr.x,Xt.y+=Cr*nr.y,Xt.x=Math.round(Xt.x),Xt.y=Math.round(Xt.y),lr=Ot}if(!ie||je!==0&&!Ue||ut(gr,Xt)||gr.push(Xt),U_(this.layoutVertexArray,Xt.x,Xt.y,0,0,1,1,0),this.wallMode){const nr=ge(Nt,Ft);V_(this.wallVertexArray,he.joinNormals[Nt],!nr)}Lt.vertexLength++,this.footprintVertices.emplaceBack(fr.x,fr.y),zt.push(fr.x,fr.y),U&&$_(this.layoutVertexExtArray,L.projectTilePoint(Xt.x,Xt.y,p),L.upVector(p,Xt.x,Xt.y))}ie&&(je===0||Ue)&&(gr.length!==0&&ut(gr,gr[0])&&gr.pop(),this.groundEffect.addData(gr,_t,O))}const ct=this.wallMode?he.indices:cg(zt,Qe);for(let Gt=0;Gt<ct.length;Gt+=3)this.footprintIndices.emplaceBack(lt.vertexOffset+ct[Gt+0],lt.vertexOffset+ct[Gt+1],lt.vertexOffset+ct[Gt+2]),this.indexArray.emplaceBack(qt+ct[Gt],qt+ct[Gt+2],qt+ct[Gt+1]),Lt.primitiveLength++;lt.indexCount+=ct.length,lt.vertexCount+=this.footprintVertices.length-lt.vertexOffset}for(let zt=0;zt<Ze.length;zt++){const Qe=Ze[zt];X.startRing(J,Qe[0]);let ct=Qe.length>4&&yC(Qe[Qe.length-2],Qe[0],Qe[1]),Gt=je?LV(Qe[Qe.length-2],Qe[0],Qe[1],je):0;const Ft=[];let gr,lr,Ot;lr=Qe[1].sub(Qe[0])._perp()._unit();let Nt=!0;for(let fr=1,tr=0;fr<Qe.length;fr++){let Xt=Qe[fr-1],nr=Qe[fr];const Cr=Qe[fr===Qe.length-1?1:fr+1];if(X.appendEdge(J,nr,Xt),m1(nr,Xt,_t)){je&&(lr=Cr.sub(nr)._perp()._unit(),Nt=!Nt);continue}const Fr=nr.sub(Xt)._perp(),Zr=Fr.x/(Math.abs(Fr.x)+Math.abs(Fr.y)),qr=Fr.y>0?1:0,yn=Xt.dist(nr);if(tr+yn>32768&&(tr=0),je){Ot=Cr.sub(nr)._perp()._unit();let xe=gC(Xt,nr,Cr,mC(lr,Ot),je);isNaN(xe)&&(xe=0);const at=nr.sub(Xt)._unit();Xt=Xt.add(at.mult(Gt))._round(),nr=nr.add(at.mult(-xe))._round(),Gt=xe,lr=Ot,ie&&this.zoom>=17&&(ut(Ft,Xt)||Ft.push(Xt),ut(Ft,nr)||Ft.push(nr))}const nn=Lt.vertexLength,di=Qe.length>4&&yC(Xt,nr,Cr);let ve=vC(tr,ct,Nt);if(U_(this.layoutVertexArray,Xt.x,Xt.y,Zr,qr,0,0,ve),U_(this.layoutVertexArray,Xt.x,Xt.y,Zr,qr,0,1,ve),this.wallMode){const xe=ge(fr-1,Qe),at=he.joinNormals[fr-1];V_(this.wallVertexArray,at,xe),V_(this.wallVertexArray,at,xe)}if(tr+=yn,ve=vC(tr,di,!Nt),ct=di,U_(this.layoutVertexArray,nr.x,nr.y,Zr,qr,0,0,ve),U_(this.layoutVertexArray,nr.x,nr.y,Zr,qr,0,1,ve),this.wallMode){const xe=ge(fr,Qe),at=he.joinNormals[fr];V_(this.wallVertexArray,at,xe),V_(this.wallVertexArray,at,xe)}if(Lt.vertexLength+=4,this.indexArray.emplaceBack(nn+0,nn+1,nn+2),this.indexArray.emplaceBack(nn+1,nn+3,nn+2),Lt.primitiveLength+=2,je){const xe=qt+(fr===1?Qe.length-2:fr-2),at=fr===1?qt:xe+1;if(this.indexArray.emplaceBack(nn+1,xe,nn+3),this.indexArray.emplaceBack(xe,at,nn+3),Lt.primitiveLength+=2,gr===void 0&&(gr=nn),!m1(Cr,Qe[fr],_t)){const Ht=fr===Qe.length-1?gr:Lt.vertexLength;this.indexArray.emplaceBack(nn+2,nn+3,Ht),this.indexArray.emplaceBack(nn+3,Ht+1,Ht),this.indexArray.emplaceBack(nn+3,at,Ht+1),Lt.primitiveLength+=3}Nt=!Nt}if(U){const xe=this.layoutVertexExtArray,at=L.projectTilePoint(Xt.x,Xt.y,p),Ht=L.projectTilePoint(nr.x,nr.y,p),Yt=L.upVector(p,Xt.x,Xt.y),Kt=L.upVector(p,nr.x,nr.y);$_(xe,at,Yt),$_(xe,at,Yt),$_(xe,Ht,Kt),$_(xe,Ht,Kt)}}$&&(qt+=Qe.length-1),ie&&je&&this.zoom>=17&&(Ft.length!==0&&ut(Ft,Ft[0])&&Ft.pop(),this.groundEffect.addData(Ft,_t,O,je>0))}this.footprintSegments.push(lt),Ut.triangleCount=this.indexArray.length-Ut.triangleArrayOffset,this.polygonSegments.push(Ut),++J.footprintSegLen,++J.polygonSegLen}if(J.vertexCount=this.layoutVertexArray.length-J.vertexArrayOffset,J.groundVertexCount=this.groundEffect.vertexArray.length-J.groundVertexArrayOffset,J.vertexCount!==0){if(J.centroidXY=X.borders?uC:this.encodeCentroid(X,J),this.centroidData.push(J),X.borders){this.featuresOnBorder.push(X);const Ze=this.featuresOnBorder.length-1;for(let _t=0;_t<X.borders.length;_t++)X.borders[_t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[_t].push(Ze)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,g,w,p,P,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,h,g,w,p,P,this.worldview),this.maxHeight=Math.max(this.maxHeight,de)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((i,u)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[u].borders[e][0]))}splitToSubtiles(){const e=[];for(let w=0;w<this.centroidData.length;w++){const E=this.centroidData[w],P=+(E.min.y+E.max.y>Wt),O=2*P+(+(E.min.x+E.max.x>Wt)^P);for(let D=0;D<E.polygonSegLen;D++){const L=E.polygonSegIdx+D;e.push({centroidIdx:w,subtile:O,polygonSegmentIdx:L,triangleSegmentIdx:this.polygonSegments[L].triangleSegIdx})}}const i=new ai;e.sort(((w,E)=>w.triangleSegmentIdx===E.triangleSegmentIdx?w.subtile-E.subtile:w.triangleSegmentIdx-E.triangleSegmentIdx));let u=0,h=0,p=0;for(const w of e){if(w.triangleSegmentIdx!==u)break;p++}const g=e.length;for(;h!==e.length;){u=e[h].triangleSegmentIdx;let w=0,E=h,P=h;for(let O=E;O<p&&e[O].subtile===w;O++)P++;for(;E!==p;){const O=e[E];w=O.subtile;const D=this.centroidData[O.centroidIdx].min.clone(),L=this.centroidData[O.centroidIdx].max.clone(),U={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let $=E;$<P;$++){const X=e[$],J=this.polygonSegments[X.polygonSegmentIdx],ie=this.centroidData[X.centroidIdx].min,de=this.centroidData[X.centroidIdx].max,he=this.indexArray.uint16;for(let ge=J.triangleArrayOffset;ge<J.triangleArrayOffset+J.triangleCount;ge++)i.emplaceBack(he[3*ge],he[3*ge+1],he[3*ge+2]);U.primitiveLength+=J.triangleCount,D.x=Math.min(D.x,ie.x),D.y=Math.min(D.y,ie.y),L.x=Math.max(L.x,de.x),L.y=Math.max(L.y,de.y)}U.primitiveLength>0&&this.triangleSubSegments.push({segment:U,min:D,max:L}),E=P;for(let $=E;$<p&&e[$].subtile===e[E].subtile;$++)P++}h=p;for(let O=h;O<g&&e[O].triangleSegmentIdx===e[h].triangleSegmentIdx;O++)p++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,u){const h=new Si;if(this.wallMode){for(const X of this.triangleSubSegments)h.segments.push(X.segment);return h}let p=0,g=0;const w=1<<e.canonical.z;if(i){const X=i.getMinMaxForTile(e);X&&(p=X.min,g=X.max)}g+=this.maxHeight;const E=e.toUnwrapped();let P;const O=[E.canonical.x/w+E.wrap,E.canonical.y/w],D=[(E.canonical.x+1)/w+E.wrap,(E.canonical.y+1)/w],L=(X,J,ie)=>[X[0]*(1-ie[0])+J[0]*ie[0],X[1]*(1-ie[1])+J[1]*ie[1]],U=[],$=[];for(const X of this.triangleSubSegments){U[0]=X.min.x/Wt,U[1]=X.min.y/Wt,$[0]=X.max.x/Wt,$[1]=X.max.y/Wt;const J=L(O,D,U),ie=L(O,D,$);if(new Rr([J[0],J[1],p],[ie[0],ie[1],g]).intersectsPrecise(u)===0){P&&(h.segments.push(P),P=void 0);continue}const de=X.segment;P&&P.vertexOffset!==de.vertexOffset&&(h.segments.push(P),P=void 0),P?(P.vertexLength+=de.vertexLength,P.primitiveLength+=de.primitiveLength):P={vertexOffset:de.vertexOffset,primitiveLength:de.primitiveLength,vertexLength:de.vertexLength,primitiveOffset:de.primitiveOffset,sortKey:void 0,vaos:{}}}return P&&h.segments.push(P),h}encodeCentroid(e,i){const u=e.centroid(),h=i.span(),p=Math.min(7,Math.round(h.x*this.tileToMeter/10)),g=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new kt(we(u.x,1,Wt-1)<<3|p,we(u.y,1,Wt-1)<<3|g)}encodeBorderCentroid(e){if(!e.borders)return new kt(0,0);const i=e.borders,u=Number.MAX_VALUE;if(i[0][0]!==u||i[1][0]!==u){const h=i[0][0]!==u?0:1;return new kt(6|(i[0][0]!==u?0:65528),(i[h][0]+i[h][1])/2<<3|6)}{const h=i[2][0]!==u?2:3;return new kt((i[h][0]+i[h][1])/2<<3|6,6|(i[2][0]!==u?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,u=e.vertexCount+e.vertexArrayOffset,h=e.flags&mp?uC:e.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==h.y||p!==h.x){for(let g=i;g<u;++g)this.centroidVertexArray.emplace(g,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,u){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped());if(Hv(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const p=[];for(const g of this.activeReplacements){if(g.order<u)continue;const w=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));if(g.footprint.buildingId){const E=g.footprint.buildingId;for(const P of this.centroidData)P.buildingId===E&&(P.flags|=mp)}else for(const E of this.centroidData)if(!(E.flags&mp||g.min.x>E.max.x||E.min.x>g.max.x||g.min.y>E.max.y||E.min.y>g.max.y))for(let P=0;P<E.footprintSegLen;P++){const O=this.footprintSegments[E.footprintSegIdx+P];if(p.length=0,zV(this.footprintVertices,O.vertexOffset,O.vertexCount,g.footprintTileId.canonical,e.canonical,p),u1(g.footprint,p,this.footprintIndices.uint16,O.indexOffset,O.indexCount,-O.vertexOffset,-w)){E.flags|=mp;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,u){let h=!1;for(let p=0;p<u.footprintSegLen;p++){const g=this.footprintSegments[u.footprintSegIdx+p];let w=0;for(const E of g.ringIndices){for(let P=w,O=E+w-1;P<E+w;O=P++){const D=this.footprintVertices.int16[2*(P+g.vertexOffset)+0],L=this.footprintVertices.int16[2*(P+g.vertexOffset)+1],U=this.footprintVertices.int16[2*(O+g.vertexOffset)+1];L>i!=U>i&&e<(this.footprintVertices.int16[2*(O+g.vertexOffset)+0]-D)*(i-L)/(U-L)+D&&(h=!h)}w=E}}return h}getHeightAtTileCoord(e,i){let u=Number.NEGATIVE_INFINITY,h=!0;const p=4*(e+Wt)*Wt+(i+Wt);if(this.partLookup.hasOwnProperty(p)){const g=this.partLookup[p];return g?{height:g.height,hidden:!!(g.flags&mp)}:void 0}for(const g of this.centroidData)e>g.max.x||g.min.x>e||i>g.max.y||g.min.y>i||g.height<=u||this.footprintContainsPoint(e,i,g)&&(u=g.height,this.partLookup[p]=g,h=!!(g.flags&mp));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.partLookup[p]=void 0}}function mC(a,e){const i=a.add(e)._unit();return a.x*i.x+a.y*i.y}function LV(a,e,i,u){const h=e.sub(a)._perp()._unit(),p=i.sub(e)._perp()._unit();return gC(a,e,i,mC(h,p),u)}function gC(a,e,i,u,h){const p=Math.sqrt(1-u*u);return Math.min(a.dist(e)/3,e.dist(i)/3,h*p/u)}function m1(a,e,i){return a.x<i[0].x&&e.x<i[0].x||a.x>i[1].x&&e.x>i[1].x||a.y<i[0].y&&e.y<i[0].y||a.y>i[1].y&&e.y>i[1].y}function _C(a,e){return a.x<e[0].x||a.x>e[1].x||a.y<e[0].y||a.y>e[1].y}function yC(a,e,i){if(a.x<0||a.x>=Wt||e.x<0||e.x>=Wt||i.x<0||i.x>=Wt)return!1;const u=i.sub(e),h=u.perp(),p=a.sub(e);return(u.x*p.x+u.y*p.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function vC(a,e,i){const u=e?2|a:-3&a;return i?1|u:-2&u}function xC(){const a=Math.PI/32,e=Math.tan(a),i=C;return i*Math.sqrt(1+2*e*e)-i}function bC(a,e,i){const u=1<<i.z,h=ce(i.x/u),p=ce((i.x+1)/u),g=me(i.y/u),w=me((i.y+1)/u);return(function(E,P,O,D,L=0,U){const $=[];if(!E.length||!O||!D)return $;const X=(Me,Oe)=>{for(const je of Me)$.push({polygon:je,bounds:Oe})},J=Math.ceil(Math.log2(O)),ie=Math.ceil(Math.log2(D)),de=J-ie,he=[];for(let Me=0;Me<Math.abs(de);Me++)he.push(de>0?0:1);for(let Me=0;Me<Math.min(J,ie);Me++)he.push(0),he.push(1);let ge=E;if(ge=$v(ge,P[0].y-L,P[1].y+L,1),ge=$v(ge,P[0].x-L,P[1].x+L,0),!ge.length)return $;const Fe=[];for(he.length?Fe.push({polygons:ge,bounds:P,depth:0}):X(ge,P);Fe.length;){const Me=Fe.pop(),Oe=Me.depth,je=he[Oe],Ue=Me.bounds[0],ut=Me.bounds[1],Ze=je===0?Ue.x:Ue.y,_t=je===0?ut.x:ut.y,qt=U?U(je,Ze,_t):.5*(Ze+_t),Et=$v(Me.polygons,Ze-L,qt+L,je),Lt=$v(Me.polygons,qt-L,_t+L,je);if(Et.length){const Ut=[Ue,new kt(je===0?qt:ut.x,je===1?qt:ut.y)];he.length>Oe+1?Fe.push({polygons:Et,bounds:Ut,depth:Oe+1}):X(Et,Ut)}if(Lt.length){const Ut=[new kt(je===0?qt:Ue.x,je===1?qt:Ue.y),ut];he.length>Oe+1?Fe.push({polygons:Lt,bounds:Ut,depth:Oe+1}):X(Lt,Ut)}}return $})(a,e,Math.ceil((p-h)/11.25),Math.ceil((g-w)/11.25),1,((E,P,O)=>{if(E===0)return .5*(P+O);{const D=me((i.y+P/Wt)/u);return(re(.5*(me((i.y+O/Wt)/u)+D))*u-i.y)*Wt}}))}function zV(a,e,i,u,h,p){const g=Math.pow(2,u.z-h.z);for(let w=0;w<i;w++){let E=a.int16[2*(w+e)+0],P=a.int16[2*(w+e)+1];E=(E+h.x*Wt)*g-u.x*Wt,P=(P+h.y*Wt)*g-u.y*Wt,p.push(new kt(E,P))}}let wC,SC;ir(Zv,"FillExtrusionBucket",{omit:["layers","features"]}),ir(fC,"PartData"),ir(hC,"FootprintSegment"),ir(dC,"BorderCentroidData"),ir(p1,"GroundEffect");class dm extends kt{constructor(e,i,u){super(e,i),this.z=u}}class TC extends dm{constructor(e,i,u,h){super(e,i,u),this.w=h}}function EC(a,e,i,u){const h=i==="x"?"y":"x",p=(u-a[i])/(e[i]-a[i]);a[h]=Math.round(a[h]+(e[h]-a[h])*p),a[i]=u,a.hasOwnProperty("z")&&(a.z=Sr(a.z,e.z,p)),a.hasOwnProperty("w")&&(a.w=Sr(a.w,e.w,p))}function AC(a,e,i,u){const h=i,p=u;for(const g of["x","y"]){let w=a,E=e;w[g]>=E[g]&&(w=e,E=a),w[g]<h&&E[g]>h&&EC(w,E,g,h),w[g]<p&&E[g]>p&&EC(E,w,g,p)}}function Xv(a,e,i,u,h,p){const g=[];for(let w=0;w<a.length;w++){const E=a[w];let P;const O=g.length;let D=0;for(let L=0;L<E.length-1;L++){let U=E[L],$=E[L+1],X=0;const J=D;let ie,de;p&&(X=Math.hypot($.x-U.x,$.y-U.y),D+=X,ie=U,de=$),U.x<e&&$.x<e||(U.x<e?U=new kt(e,U.y+(e-U.x)/($.x-U.x)*($.y-U.y))._round():$.x<e&&($=new kt(e,U.y+(e-U.x)/($.x-U.x)*($.y-U.y))._round()),U.y<i&&$.y<i||(U.y<i?U=new kt(U.x+(i-U.y)/($.y-U.y)*($.x-U.x),i)._round():$.y<i&&($=new kt(U.x+(i-U.y)/($.y-U.y)*($.x-U.x),i)._round()),U.x>=u&&$.x>=u||(U.x>=u?U=new kt(u,U.y+(u-U.x)/($.x-U.x)*($.y-U.y))._round():$.x>=u&&($=new kt(u,U.y+(u-U.x)/($.x-U.x)*($.y-U.y))._round()),U.y>=h&&$.y>=h||(U.y>=h?U=new kt(U.x+(h-U.y)/($.y-U.y)*($.x-U.x),h)._round():$.y>=h&&($=new kt(U.x+(h-U.y)/($.y-U.y)*($.x-U.x),h)._round()),P&&U.equals(P[P.length-1])||(P=[U],g.push(P),p&&p.push({progress:{min:J+PC(ie,de,U)*X,max:1},parentIndex:w,prevPoint:ie,nextPoint:de})),P.push($),p&&(p[p.length-1].progress.max=J+PC(ie,de,$)*X,p[p.length-1].nextPoint=de)))))}if(p&&D>0)for(let L=O;L<g.length;L++)p[L].progress.min/=D,p[L].progress.max/=D}return g}function FV(a,e,i,u,h){if(a.length<2)return void u.push(a);const p=[];for(;e.valid();){const[P,O]=e.get();for(let D=0;D<a.length-1;D++){const L=a[D],U=a[D+1],$=ko(L,U,P,O);if($){const[X]=$,J=new kt(Sr(L.x,U.x,X),Sr(L.y,U.y,X));p.push({t:D+X,distance:0,point:J})}}e.next()}if(p.length===0)return void u.push(a);p.sort(((P,O)=>P.t-O.t));let g=0,w=0,E=[];for(u.push(E);g!==a.length;){if(w===p.length){for(;g!==a.length;)E.length!==0&&E[E.length-1].equals(a[g])||E.push(a[g]),g++;break}p[w].t<=g?(E.length!==0&&E[E.length-1].equals(p[w].point)||E.push(p[w].point),Math.trunc(p[w].t),w++):(E.length!==0&&E[E.length-1].equals(a[g])||E.push(a[g]),g++)}}function PC(a,e,i){return a.x!==e.x?(i.x-a.x)/(e.x-a.x):a.y!==e.y?(i.y-a.y)/(e.y-a.y):0}function q_(a,e){return a.x*e.x+a.y*e.y}function IC(a,e){if(a.length===1){let i=0;const u=e[i++];let h;for(;!h||u.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const p=e[i],g=a[0],w=h.sub(u),E=p.sub(u),P=g.sub(u),O=q_(w,w),D=q_(w,E),L=q_(E,E),U=q_(P,w),$=q_(P,E),X=O*L-D*D,J=(L*U-D*$)/X,ie=(O*$-D*U)/X,de=u.z*(1-J-ie)+h.z*J+p.z*ie;if(isFinite(de))return de}return 1/0}{let i=1/0;for(const u of e)i=Math.min(i,u.z);return i}}function CC(a,e,i,u,h,p,g,w){const E=g*h.getElevationAt(a,e,!0,!0),P=p[0]!==0,O=P?p[1]===0?g*(p[0]/7-450):g*(function(D,L,U){const $=Math.floor(L[0]/8),X=Math.floor(L[1]/8),J=10*(L[0]-8*$),ie=10*(L[1]-8*X),de=D.getElevationAt($,X,!0,!0),he=D.getMeterToDEM(U),ge=Math.floor(.5*(J*he-1)),Fe=Math.floor(.5*(ie*he-1)),Me=D.tileCoordToPixel($,X),Oe=2*ge+1,je=2*Fe+1,Ue=(function(Lt,Ut,lt,zt,Qe){return[Lt.getElevationAtPixel(Ut,lt,!0),Lt.getElevationAtPixel(Ut+Qe,lt,!0),Lt.getElevationAtPixel(Ut,lt+Qe,!0),Lt.getElevationAtPixel(Ut+zt,lt+Qe,!0)]})(D,Me.x-ge,Me.y-Fe,Oe,je),ut=Math.abs(Ue[0]-Ue[1]),Ze=Math.abs(Ue[2]-Ue[3]),_t=Math.abs(Ue[0]-Ue[2])+Math.abs(Ue[1]-Ue[3]),qt=Math.min(.25,.5*he*(ut+Ze)/Oe),Et=Math.min(.25,.5*he*_t/je);return de+Math.max(qt*J,Et*ie)})(h,p,w):E;return{base:E+(i===0?-1:i),top:P?Math.max(O+u,E+i+2):E+u}}class BV{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class NV{constructor(){this.tasks={},this.taskQueue=[],Or(["process"],this),this.invoker=new BV(this.process),this.nextId=0}add(e,i){const u=this.nextId++,h=(function({type:p,isSymbolTile:g,zoom:w}){return w=w||0,p==="message"?0:p!=="maybePrepare"||g?p!=="parseTile"||g?p==="parseTile"&&g?300-w:p==="maybePrepare"&&g?400-w:500:200-w:100-w})(i);if(h===0){try{e()}finally{}return null}return this.tasks[u]={fn:e,metadata:i,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((u=>!!this.tasks[u])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<i&&(i=p.priority,e=h)}if(e===null)return null;const u=this.taskQueue[e];return this.taskQueue.splice(e,1),u}remove(){this.invoker.remove()}}class MC{constructor(e,i,u){this.target=e,this.parent=i,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Or(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new NV}send(e,i,u,h,p=!1,g){const w=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=g,this.callbacks[w]=u);const E=new Set;return this.target.postMessage({id:w,type:e,hasCallback:!!u,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:Fs(i,E)},E),{cancel:()=>{u&&delete this.callbacks[w],this.target.postMessage({id:w,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const u=i.id;if(u&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h.cancel()}else if(i.mustQueue||qn(self)){const h=this.callbacks[u],p=this.scheduler.add((()=>this.processTask(u,i)),h&&h.metadata||{type:"message"});p&&(this.cancelCallbacks[u]=p)}else this.processTask(u,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const u=this.callbacks[e];delete this.callbacks[e],u&&(i.error?u(pa(i.error)):u(null,pa(i.data)))}else{const u=new Set,h=i.hasCallback?(g,w)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:g?Fs(g):null,data:Fs(w,u)},u)}:()=>{},p=pa(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,p,h);else if(this.parent.getWorkerSource){const g=i.type.split("."),{source:w,scope:E}=p;this.parent.getWorkerSource(i.sourceMapId,g[0],w,E)[g[1]](p,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var G_={workerUrl:"",workerClass:null,workerParams:void 0};const g1="mapboxgl_preloaded_worker_pool";class pm{constructor(){this.active={}}acquire(e,i=pm.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(G_.workerClass!=null?new G_.workerClass:new self.Worker(G_.workerUrl,G_.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((i=>{i.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[g1]}numActive(){return Object.keys(this.active).length}}pm.workerCount=2;class hg{constructor(e,i,u="Worker",h=pm.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Tt();const p=this.workerPool.acquire(this.id,h);for(let g=0;g<p.length;g++){const w=new hg.Actor(p[g],i,this.id);w.name=`${u} ${g}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,i,u){Ve(this.actors,((h,p)=>{h.send(e,i,p)}),u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let H_,_1;function Kv(){return H_||(H_=new pm),H_}hg.Actor=MC;class jV{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),u=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,u/i.BYTES_PER_ELEMENT),u}createFloatArray(e){const i=new Float32Array(e),u=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,u/i.BYTES_PER_ELEMENT),u}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let u=0;u<e.length;++u)this.module.heapU8[i+u]=e.charCodeAt(u);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,u=e.facadeGlazingColorRgb,h=e.roofColorRgb,p=e.wallColorRgb,g=e.normalScale;this.module.setStyle(i[0],i[1],i[2],u[0],u[1],u[2],h[0],h[1],h[2],p[0],p[1],p[2],g[0],g[1],g[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,u){this.module.setFauxFacadeOptions(e?1:0,i?1:0,u)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){for(const w of e){const E=this.createStringBuffer(w.roofType),P=[0],O=[];for(const U of w.coordinates)if(Array.isArray(U)){for(const $ of U)O.push($.x),O.push($.y);P.push(O.length)}const D=this.createIntArray(P),L=this.createFloatArray(O);this.module.addFeature(w.id,w.sourceId,w.minHeight,w.height,E,w.roofType.length,L,D,P.length-1),this.module.free(E),this.module.free(D),this.module.free(L)}for(const w of i){let E;E=w.entrances?JSON.parse(w.entrances):[];const P=this.createFloatArray(E),O=[];for(const L of w.coordinates)O.push(L.x),O.push(L.y);const D=this.createFloatArray(O);this.module.addFacade(w.sourceId,w.crossPerc,w.distanceToRoad,P,E.length,D,O.length),this.module.free(P),this.module.free(D)}if(!this.module.generateMesh()){const w=this.module.getLastError();return this.readStringBuffer(w)}const u=this.module.getMeshCount(),h=new Array(u);for(let w=0;w<u;w++){const E=this.module.getPositionsPtr(w),P=this.module.getPositionsLength(w),O=new Float32Array(this.module.heapF32.buffer,E,P),D=this.module.getNormalsPtr(w),L=this.module.getNormalsLength(w),U=new Float32Array(this.module.heapF32.buffer,D,L),$=this.module.getColorsPtr(w),X=this.module.getColorsLength(w),J=new Uint8Array(this.module.heapU8.buffer,$,X),ie=this.module.getAOPtr(w),de=this.module.getAOLength(w),he=new Float32Array(this.module.heapF32.buffer,ie,de),ge=this.module.getUVPtr(w),Fe=this.module.getUVLength(w),Me=new Float32Array(this.module.heapF32.buffer,ge,Fe),Oe=this.module.getFauxFacadePtr(w),je=this.module.getFauxFacadeLength(w),Ue=new Uint8Array(this.module.heapU8.buffer,Oe,je),ut=this.module.getIndicesPtr(w),Ze=this.module.getIndicesLength(w),_t=new Int32Array(this.module.heap32.buffer,ut,Ze),qt=this.module.getBuildingPart(w),Et=this.readStringBuffer(qt);h[w]={positions:O,normals:U,colors:J,ao:he,uv:Me,isFauxFacade:Ue,indices:_t,buildingPart:Et}}const p=this.module.getRingCount(),g=[];for(let w=0;w<p;w++){const E=this.module.getRingPtr(w),P=this.module.getRingLength(w),O=new Float32Array(this.module.heapF32.buffer,E,P);g.push(O)}return{meshes:h,modifiedPolygonRings:g}}}let W_,y1,ju,fg,v1,dg=null,pg=null,OC=null,Yv=null;function RC(){return qn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:y1||No.DRACO_URL}function DC(){if(qn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(fg)return fg;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return fg=WebAssembly.validate(a)?No.MESHOPT_SIMD_URL:No.MESHOPT_URL,fg}function UV(){return Yv}const Jv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},VV={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Z_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function kC(a,e,i){const u=i.json.bufferViews.length,h=i.buffers.length;e.bufferView=u,i.json.bufferViews[u]={buffer:h,byteLength:a.byteLength},i.buffers[h]=a}const x1="KHR_draco_mesh_compression";function $V(a,e){const i=a.extensions&&a.extensions[x1];if(!i)return;const u=new ju.Decoder,h=BC(e,i.bufferView),p=new ju.Mesh;if(!u.DecodeArrayToMesh(h,h.byteLength,p))throw new Error("Failed to decode Draco mesh");const g=e.json.accessors[a.indices],w=Jv[g.componentType],E=g.count*w.BYTES_PER_ELEMENT,P=ju._malloc(E);w===Uint16Array?u.GetTrianglesUInt16Array(p,E,P):u.GetTrianglesUInt32Array(p,E,P),kC(ju.memory.buffer.slice(P,P+E),g,e),ju._free(P);for(const O of Object.keys(i.attributes)){const D=u.GetAttributeByUniqueId(p,i.attributes[O]),L=e.json.accessors[a.attributes[O]],U=VV[L.componentType],$=L.count*Z_[L.type]*Jv[L.componentType].BYTES_PER_ELEMENT,X=ju._malloc($);u.GetAttributeDataArrayForAllPoints(p,D,ju[U],$,X),kC(ju.memory.buffer.slice(X,X+$),L,e),ju._free(X)}u.destroy(),p.destroy(),delete a.extensions[x1]}const Qv="EXT_meshopt_compression";function qV(a,e){if(!a.extensions||!a.extensions[Qv])return;const i=a.extensions[Qv],u=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),h=new Uint8Array(i.count*i.byteStride);v1.decodeGltfBuffer(h,i.count,i.byteStride,u,i.mode,i.filter),a.buffer=e.buffers.length,a.byteOffset=0,e.buffers[a.buffer]=h.buffer,delete a.extensions[Qv]}const LC=1179937895,zC=new TextDecoder("utf8");function FC(a,e){return new URL(a,e).href}function GV(a,e,i,u){return fetch(FC(a.uri,u)).then((h=>h.arrayBuffer())).then((h=>{e.buffers[i]=h}))}function BC(a,e){const i=a.json.bufferViews[e];return new Uint8Array(a.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function HV(a,e,i,u){if(a.uri){const h=FC(a.uri,u);return fetch(h).then((p=>p.blob())).then((p=>createImageBitmap(p))).then((p=>{e.images[i]=p}))}if(a.bufferView!==void 0){const h=BC(e,a.bufferView),p=new Blob([h],{type:a.mimeType});return createImageBitmap(p).then((g=>{e.images[i]=g}))}}function NC(a,e=0,i){const u={json:null,images:[],buffers:[]};if(new Uint32Array(a,e,1)[0]===LC){const O=new Uint32Array(a,e);let D=2;const L=(O[D++]>>2)-3,U=O[D++]>>2;if(D++,u.json=JSON.parse(zC.decode(O.subarray(D,D+U))),D+=U,D<L){const $=O[D++];D++;const X=e+(D<<2);u.buffers[0]=a.slice(X,X+$)}}else u.json=JSON.parse(zC.decode(new Uint8Array(a,e)));const{buffers:h,images:p,meshes:g,extensionsUsed:w,bufferViews:E}=u.json;let P=Promise.resolve();if(h){const O=[];for(let D=0;D<h.length;D++){const L=h[D];L.uri?O.push(GV(L,u,D,i)):u.buffers[D]||(u.buffers[D]=null)}P=Promise.all(O)}return P.then((()=>{const O=[],D=w&&w.includes(x1),L=w&&w.includes(Qv);if(D&&O.push((function(){if(!ju)return W_??(W_=(function(U){let $,X=null;function J(){$=new Uint8Array(X.buffer)}function ie(){throw new Error("Unexpected Draco error.")}const de={a:{a:ie,d:function(he,ge,Fe){return $.copyWithin(he,ge,ge+Fe)},c:function(he){const ge=$.length,Fe=Math.max(he>>>0,Math.ceil(1.2*ge)),Me=Math.ceil((Fe-ge)/65536);try{return X.grow(Me),J(),!0}catch{return!1}},b:ie}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(U,de):U.then((he=>he.arrayBuffer())).then((he=>WebAssembly.instantiate(he,de)))).then((he=>{const{Rb:ge,Qb:Fe,P:Me,T:Oe,X:je,Ja:Ue,La:ut,Qa:Ze,Va:_t,Wa:qt,eb:Et,jb:Lt,f:Ut,e:lt,yb:zt,zb:Qe,Ab:ct,Bb:Gt,Db:Ft,Gb:gr}=he.instance.exports;X=lt;const lr=(()=>{let Ot=0,Nt=0,fr=0,tr=0;return Xt=>{fr&&(ge(tr),ge(Ot),Nt+=fr,fr=Ot=0),Ot||(Nt+=128,Ot=Fe(Nt));const nr=Xt.length+7&-8;let Cr=Ot;nr>=Nt&&(fr=nr,Cr=tr=Fe(nr));for(let Fr=0;Fr<Xt.length;Fr++)$[Cr+Fr]=Xt[Fr];return Cr}})();return J(),Ut(),{memory:lt,_free:ge,_malloc:Fe,Mesh:class{constructor(){this.ptr=Me()}destroy(){Oe(this.ptr)}},Decoder:class{constructor(){this.ptr=Ue()}destroy(){Lt(this.ptr)}DecodeArrayToMesh(Ot,Nt,fr){const tr=lr(Ot),Xt=ut(this.ptr,tr,Nt,fr.ptr);return!!je(Xt)}GetAttributeByUniqueId(Ot,Nt){return{ptr:Ze(this.ptr,Ot.ptr,Nt)}}GetTrianglesUInt16Array(Ot,Nt,fr){_t(this.ptr,Ot.ptr,Nt,fr)}GetTrianglesUInt32Array(Ot,Nt,fr){qt(this.ptr,Ot.ptr,Nt,fr)}GetAttributeDataArrayForAllPoints(Ot,Nt,fr,tr,Xt){Et(this.ptr,Ot.ptr,Nt.ptr,fr,tr,Xt)}},DT_INT8:zt(),DT_UINT8:Qe(),DT_INT16:ct(),DT_UINT16:Gt(),DT_UINT32:Ft(),DT_FLOAT32:gr()}}))})(fetch(RC())),W_.then((U=>{ju=U,W_=void 0})))})()),L&&O.push((function(){if(v1)return;const U=(function($){let X;const J=WebAssembly.instantiateStreaming($,{}).then((he=>{X=he.instance,X.exports.__wasm_call_ctors()})),ie={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},de={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:J,supported:!0,decodeGltfBuffer(he,ge,Fe,Me,Oe,je){(function(Ue,ut,Ze,_t,qt,Et,Lt){const Ut=Ue.exports.sbrk,lt=_t+3&-4,zt=Ut(lt*qt),Qe=Ut(Et.length),ct=new Uint8Array(Ue.exports.memory.buffer);ct.set(Et,Qe);const Gt=ut(zt,_t,qt,Qe,Et.length);if(Gt===0&&Lt&&Lt(zt,lt,qt),Ze.set(ct.subarray(zt,zt+_t*qt)),Ut(zt-Ut(0)),Gt!==0)throw new Error(`Malformed buffer data: ${Gt}`)})(X,X.exports[de[Oe]],he,ge,Fe,Me,X.exports[ie[je]])}}})(fetch(DC()));return U.ready.then((()=>{v1=U}))})()),p)for(let U=0;U<p.length;U++)O.push(HV(p[U],u,U,i));return(O.length?Promise.all(O):Promise.resolve()).then((()=>{if(D&&g)for(const{primitives:U}of g)for(const $ of U)$V($,u);if(L&&g&&E)for(const U of E)qV(U,u);return u}))}))}function b1(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function w1(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class S1{constructor(e,i,u,h){this.context=e,this.format=u,this.useMipmap=h&&h.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:h&&h.premultiply})}update(e,i){const u=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,h=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:p}=this,{gl:g}=p,{x:w,y:E}=i&&i.position?i.position:{x:0,y:0},P=w+u,O=E+h;!this.size||this.size[0]===P&&this.size[1]===O||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!i||i.premultiply!==!1));const D=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&P>0&&O>0){const L=this.useMipmap?Math.floor(Math.log2(Math.max(P,O)))+1:1;g.texStorage2D(g.TEXTURE_2D,L,this.format,P,O),this.size=[P,O]}if(this.size)if(D)g.texSubImage2D(g.TEXTURE_2D,0,w,E,b1(this.format),w1(this.format),e);else{const L=e.data;L&&g.texSubImage2D(g.TEXTURE_2D,0,w,E,u,h,b1(this.format),w1(this.format),L)}this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,i,u=!1){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!u?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,u,h,p){const{context:g}=this,{gl:w}=g;w.bindTexture(w.TEXTURE_2D,this.texture),i!==this.magFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,this.useMipmap?e===w.NEAREST?w.NEAREST_MIPMAP_NEAREST:w.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),u!==this.wrapS&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,u),this.wrapS=u),h!==this.wrapT&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,h),this.wrapT=h),p!==this.compareMode&&(p?(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.COMPARE_REF_TO_TEXTURE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_FUNC,p)):w.texParameteri(w.TEXTURE_2D,w.TEXTURE_COMPARE_MODE,w.NONE),this.compareMode=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class X_{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}}const WV=mn([{name:"a_pos_3f",components:3,type:"Float32"}]),ZV=mn([{name:"a_color_3f",components:3,type:"Float32"}]),XV=mn([{name:"a_color_4f",components:4,type:"Float32"}]),KV=mn([{name:"a_uv_2f",components:2,type:"Float32"}]),YV=mn([{name:"a_normal_3f",components:3,type:"Float32"}]),JV=mn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),QV=mn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function jC(a,e){const i=ex(a.projection,a.zoom,a.width,a.height),u=(function(p,g,w,E,P){const O=new z(w.lng-180*gp,w.lat),D=new z(w.lng+180*gp,w.lat),L=p.project(O.lng,O.lat),U=p.project(D.lng,D.lat),$=-Math.atan2(U.y-L.y,U.x-L.x),X=Ie.fromLngLat(w);X.y=we(X.y,-1+gp,1-gp);const J=X.toLngLat(),ie=p.project(J.lng,J.lat),de=Ie.fromLngLat(J);de.x+=gp;const he=de.toLngLat(),ge=p.project(he.lng,he.lat),Fe=VC(ge.x-ie.x,ge.y-ie.y,$),Me=Ie.fromLngLat(J);Me.y+=gp;const Oe=Me.toLngLat(),je=p.project(Oe.lng,Oe.lat),Ue=VC(je.x-ie.x,je.y-ie.y,$),ut=Math.abs(Fe.x)/Math.abs(Ue.y),Ze=H([]);pe(Ze,Ze,-$*(1-(P?0:E)));const _t=H([]);return ue(_t,_t,[1,1-(1-ut)*E,1]),_t[4]=-Ue.x/Ue.y*E,pe(_t,_t,$),ae(_t,Ze,_t),_t})(a.projection,0,a.center,i,e),h=UC(a);return ue(u,u,[h,h,1]),u}function UC(a){const e=a.projection,i=ex(a.projection,a.zoom,a.width,a.height),u=T1(e,a.center),h=T1(e,z.convert(e.center));return Math.pow(2,u*i+(1-i)*h)}function ex(a,e,i,u,h=1/0){const p=a.range;if(!p)return 0;const g=Math.min(h,Math.max(i,u)),w=Math.log(g/1024)/Math.LN2;return Ne(p[0]+w,p[1]+w,e)}const gp=1/4e4;function T1(a,e){const i=we(e.lat,-Ee,Ee),u=new z(e.lng-180*gp,i),h=new z(e.lng+180*gp,i),p=a.project(u.lng,i),g=a.project(h.lng,i),w=Ie.fromLngLat(u),E=Ie.fromLngLat(h),P=g.x-p.x,O=g.y-p.y,D=E.x-w.x,L=E.y-w.y,U=Math.sqrt((D*D+L*L)/(P*P+O*O));return Math.log(U)/Math.LN2}function VC(a,e,i){const u=Math.cos(i),h=Math.sin(i);return{x:a*u-e*h,y:a*h+e*u}}function $C(a,e,i){H(a),pe(a,a,Cn(e[2])),_e(a,a,Cn(e[0])),le(a,a,Cn(e[1])),ue(a,a,i),ae(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function tx(a,e,i,u,h,p,g,w){const E=[i[0]-e[0],i[1]-e[1],0],P=[u[0]-e[0],u[1]-e[1],0];if(ft(E)<1e-12||ft(P)<1e-12)return Ba(a);const O=Br([],E,P);Tr(O,O),Rt(P,u,e),E[2]=(p-h)*w,P[2]=(g-h)*w;const D=E;return Br(D,E,P),Tr(D,D),nl(a,O,D)}function E1(a,e,i=!1){const u=pt(e.zoom),h=(function(p,g,w){const E=g.worldSize,P=[p[12],p[13],p[14]],O=me(P[1]/E),D=ce(P[0]/E),L=H([]),U=te(1,O)*E,$=te(1,0)*E*Re(O,g.zoom),X=1/Qr(E);let J=$*X;if(w){const ge=ex(g.projection,g.zoom,g.width,g.height,1024);J=X*g.projection.pixelSpaceConversion(g.center.lat,E,ge)}const ie=A(O,D);gt(ie,ie,qe([],Tr([],ie),U*J*P[2]));const de=(function(ge){const Fe=[ge[0],ge[1],ge[2]];let Me=[0,1,0];const Oe=Br([],Me,Fe);return Br(Me,Fe,Oe),Mr(Me)===0&&(Me=[0,1,0],Br(Oe,Fe,Me)),Tr(Oe,Oe),Tr(Me,Me),Tr(Fe,Fe),[Oe[0],Oe[1],Oe[2],0,Me[0],Me[1],Me[2],0,Fe[0],Fe[1],Fe[2],0,ge[0],ge[1],ge[2],1]})(ie);ue(L,L,[J,J,J*U]),fe(L,L,[-P[0],-P[1],-P[2]]);const he=ae([],g.globeMatrix,de);return ae(he,he,L),ae(he,he,p),he})(a,e,i);if(u>0){const p=(function(g,w){const E=w.worldSize,P=te(1,0)*E*Re(w.center.lat,w.zoom)/Qr(E),O=te(1,w.center.lat)*E,D=H([]);return le(D,D,Cn(w.center.lng)),_e(D,D,Cn(w.center.lat)),fe(D,D,[0,0,Xo]),ue(D,D,[P,P,P*O]),fe(D,D,[w.point.x-.5*E,w.point.y-.5*E,0]),ae(D,D,g),ae(D,w.globeMatrix,D)})(a,e);return(function(g,w,E){const P=($,X,J)=>{const ie=ft($),de=ft(X),he=ne($,X,J);return qe(he,he,1/ft(he)*Sr(ie,de,J))},O=P([g[0],g[1],g[2]],[w[0],w[1],w[2]],E),D=P([g[4],g[5],g[6]],[w[4],w[5],w[6]],E),L=P([g[8],g[9],g[10]],[w[8],w[9],w[10]],E),U=ne([g[12],g[13],g[14]],[w[12],w[13],w[14]],E);return[O[0],O[1],O[2],0,D[0],D[1],D[2],0,L[0],L[1],L[2],0,U[0],U[1],U[2],1]})(h,p,u)}return h}function qC(a,e,i,u){const h=Rr.projectAabbCorners(u,i);let p=Number.MAX_VALUE,g=-1;for(let P=0;P<h.length;++P){const O=h[P];O[0]=(.5*O[0]+.5)*e.width,O[1]=(.5-.5*O[1])*e.height,O[2]<p&&(g=P,p=O[2])}const w=P=>new kt(h[P][0],h[P][1]);let E;switch(g){case 0:case 6:E=[w(1),w(5),w(4),w(7),w(3),w(2),w(1)];break;case 1:case 7:E=[w(0),w(4),w(5),w(6),w(2),w(3),w(0)];break;case 3:case 5:E=[w(1),w(0),w(4),w(7),w(6),w(2),w(1)];break;default:E=[w(1),w(5),w(6),w(7),w(3),w(0),w(1)]}if(Wn(a,E))return p}const mm=64,mg={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function GC(a,e,i,u,h,p,g,w,E,P=!1){const O=i.zoom,D=i.project(u),L=Re(u.lat,O),U=1/L;H(a),fe(a,a,[D.x+g[0]*U,D.y+g[1]*U,g[2]]);let $=1,X=1;const J=i.worldSize;if(P){if(i.projection.name==="mercator"){let ge=0;i.elevation&&(ge=i.elevation.getAtPointOrZero(new Ie(D.x/J,D.y/J),0));const Fe=Vi([],[D.x,D.y,ge,1],i.projMatrix)[3]/i.cameraToCenterDistance;$=Fe,X=Fe*Re(i.center.lat,O)}else if(i.projection.name==="globe"){const ge=E1(a,i),Fe=[0,0,0,1];Vi(Fe,Fe,ae([],i.projMatrix,ge));const Me=Fe[3]/i.cameraToCenterDistance,Oe=pt(O),je=i.projection.pixelsPerMeter(u.lat,J)*Re(u.lat,O),Ue=i.projection.pixelsPerMeter(i.center.lat,J)*Re(i.center.lat,O);$=Me/Sr(je,Ce(i.center.lat),Oe),X=Me*L/je,$*=Ue,X*=Ue}}else $=U;ue(a,a,[$,$,X]);const ie=[...a],de=e.orientation,he=[];if($C(he,[de[0]+h[0],de[1]+h[1],de[2]+h[2]],p),ae(a,ie,he),w&&i.elevation){let ge=0;const Fe=[];if(E&&i.elevation){ge=(function(Oe,je,Ue,ut,Ze){const _t=je.elevation;if(!_t)return 0;const qt=Rr.projectAabbCorners(Ue,ut),Et=te(1,Ze.lat)*je.worldSize,Lt=(function(Nt,fr){const tr=[0,0,1],Xt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const nr of Xt){const Cr=Nt[nr.corners[0]],Fr=Nt[nr.corners[1]],Zr=Nt[nr.corners[2]],qr=[Fr[0]-Cr[0],Fr[1]-Cr[1],fr*(Fr[2]-Cr[2])],yn=Br(qr,qr,[Zr[0]-Cr[0],Zr[1]-Cr[1],fr*(Zr[2]-Cr[2])]);Tr(yn,yn),nr.dotProductWithUp=vr(yn,tr)}return Xt.sort(((nr,Cr)=>nr.dotProductWithUp-Cr.dotProductWithUp)),Xt[0].corners})(qt,Et),Ut=qt[Lt[0]],lt=qt[Lt[1]],zt=qt[Lt[2]],Qe=qt[Lt[3]],ct=_t.getAtPointOrZero(new Ie(Ut[0]/je.worldSize,Ut[1]/je.worldSize),0),Gt=_t.getAtPointOrZero(new Ie(lt[0]/je.worldSize,lt[1]/je.worldSize),0),Ft=_t.getAtPointOrZero(new Ie(zt[0]/je.worldSize,zt[1]/je.worldSize),0),gr=_t.getAtPointOrZero(new Ie(Qe[0]/je.worldSize,Qe[1]/je.worldSize),0),lr=(ct+gr)/2,Ot=(Gt+Ft)/2;return lr>Ot?Gt<Ft?tx(Oe,lt,Qe,Ut,Gt,gr,ct,Et):tx(Oe,zt,Ut,Qe,Ft,ct,gr,Et):ct<gr?tx(Oe,Ut,lt,zt,ct,Gt,Ft,Et):tx(Oe,Qe,zt,lt,gr,Ft,Gt,Et),Math.max(lr,Ot)})(Fe,i,e.aabb,a,u);const Me=ae([],Xe([],Fe),he);ae(a,ie,Me)}else ge=i.elevation.getAtPointOrZero(new Ie(D.x/J,D.y/J),0);ge!==0&&(a[14]+=ge)}}function K_(a,e,i=!1){a.uploaded||(a.gfxTexture=new S1(e,a.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:a.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function e$(a,e,i){a.indexBuffer=e.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=e.createVertexBuffer(a.vertexArray,WV.members,!1,!0),a.normalArray&&(a.normalBuffer=e.createVertexBuffer(a.normalArray,YV.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=e.createVertexBuffer(a.texcoordArray,KV.members,!1,!0)),a.colorArray&&(a.colorBuffer=e.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?ZV:XV).members,!1,!0)),a.featureArray&&(a.pbrBuffer=e.createVertexBuffer(a.featureArray,QV.members,!0)),a.segments=Si.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const u=a.material;u.pbrMetallicRoughness.baseColorTexture&&K_(u.pbrMetallicRoughness.baseColorTexture,e),u.pbrMetallicRoughness.metallicRoughnessTexture&&K_(u.pbrMetallicRoughness.metallicRoughnessTexture,e),u.normalTexture&&K_(u.normalTexture,e),u.occlusionTexture&&K_(u.occlusionTexture,e,i),u.emissionTexture&&K_(u.emissionTexture,e)}function A1(a,e,i){if(a.meshes)for(const u of a.meshes)e$(u,e,i);if(a.children)for(const u of a.children)A1(u,e,i)}function rx(a){if(a.meshes)for(const e of a.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(a.children)for(const e of a.children)rx(e)}function P1(a){if(a.meshes)for(const i of a.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(a.children)for(const i of a.children)P1(i)}function gm(a,e){const i=a.json.bufferViews[e.bufferView],u=Jv[e.componentType];return new u(a.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Z_[e.type]*u.BYTES_PER_ELEMENT?i.byteStride/u.BYTES_PER_ELEMENT:Z_[e.type]))}function I1(a,e,i,u){const h=Jv[e.componentType],p=(function(O){switch(O){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(h),g=a.json.bufferViews[e.bufferView],w=g.byteStride?g.byteStride/h.BYTES_PER_ELEMENT:Z_[e.type],E=i.float32,P=E.length/i.capacity;for(let O=0,D=0;O<e.count*w;O+=w,D+=P)for(let L=0;L<P;L++)E[D+L]=u[O+L]*p;i._trim()}function t$(a,e,i){const u=a.indices,h=a.attributes,p={};p.indexArray=new ai;const g=e.json.accessors[u],w=g.count/3;p.indexArray.reserve(w);const E=gm(e,g);for(let L=0;L<w;L++)p.indexArray.emplaceBack(E[3*L],E[3*L+1],E[3*L+2]);p.indexArray._trim(),p.vertexArray=new ga;const P=e.json.accessors[h.POSITION];p.vertexArray.reserve(P.count);const O=gm(e,P);for(let L=0;L<P.count;L++)p.vertexArray.emplaceBack(O[3*L],O[3*L+1],O[3*L+2]);if(p.vertexArray._trim(),p.aabb=new Rr(P.min,P.max),p.centroid=(function(L,U){const $=[0,0,0],X=L.length;if(X>0){for(let J=0;J<X;J++){const ie=3*L[J];$[0]+=U[ie],$[1]+=U[ie+1],$[2]+=U[ie+2]}$[0]/=X,$[1]/=X,$[2]/=X}return $})(E,O),h.COLOR_0!==void 0){const L=e.json.accessors[h.COLOR_0],U=Z_[L.type],$=gm(e,L);p.colorArray=U===3?new ga:new Vs,p.colorArray.resize(L.count),I1(e,L,p.colorArray,$)}if(h.NORMAL!==void 0){p.normalArray=new ga;const L=e.json.accessors[h.NORMAL];p.normalArray.resize(L.count);const U=gm(e,L);I1(e,L,p.normalArray,U)}if(h.TEXCOORD_0!==void 0&&i.length>0){p.texcoordArray=new Eo;const L=e.json.accessors[h.TEXCOORD_0];p.texcoordArray.resize(L.count);const U=gm(e,L);I1(e,L,p.texcoordArray,U)}if(h._FEATURE_ID_RGBA4444!==void 0){const L=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=gm(e,L))}h._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(gm(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));const D=a.material;return p.material=(function(L,U){const{emissiveFactor:$=[0,0,0],alphaMode:X="OPAQUE",alphaCutoff:J=.5,normalTexture:ie,occlusionTexture:de,emissiveTexture:he,doubleSided:ge}=L,{baseColorFactor:Fe=[1,1,1,1],metallicFactor:Me=1,roughnessFactor:Oe=1,baseColorTexture:je,metallicRoughnessTexture:Ue}=L.pbrMetallicRoughness||{},ut=de?U[de.index]:void 0;if(de&&de.extensions&&de.extensions.KHR_texture_transform&&ut){const Ze=de.extensions.KHR_texture_transform;ut.offsetScale=[Ze.offset[0],Ze.offset[1],Ze.scale[0],Ze.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new wn(...Fe),metallicFactor:Me,roughnessFactor:Oe,baseColorTexture:je?U[je.index]:void 0,metallicRoughnessTexture:Ue?U[Ue.index]:void 0},doubleSided:ge,emissiveFactor:new wn(...$),alphaMode:X,alphaCutoff:J,normalTexture:ie?U[ie.index]:void 0,occlusionTexture:ut,emissionTexture:he?U[he.index]:void 0,defined:L.defined===void 0}})(D!==void 0?e.json.materials[D]:{defined:!1},i),p}function HC(a,e,i){const{matrix:u,rotation:h,translation:p,scale:g,mesh:w,extras:E,children:P}=a,O={};if(O.matrix=u||(function(D,L,U,$){var X=L[0],J=L[1],ie=L[2],de=L[3],he=X+X,ge=J+J,Fe=ie+ie,Me=X*he,Oe=X*ge,je=X*Fe,Ue=J*ge,ut=J*Fe,Ze=ie*Fe,_t=de*he,qt=de*ge,Et=de*Fe,Lt=$[0],Ut=$[1],lt=$[2];return D[0]=(1-(Ue+Ze))*Lt,D[1]=(Oe+Et)*Lt,D[2]=(je-qt)*Lt,D[3]=0,D[4]=(Oe-Et)*Ut,D[5]=(1-(Me+Ze))*Ut,D[6]=(ut+_t)*Ut,D[7]=0,D[8]=(je+qt)*lt,D[9]=(ut-_t)*lt,D[10]=(1-(Me+Ue))*lt,D[11]=0,D[12]=U[0],D[13]=U[1],D[14]=U[2],D[15]=1,D})([],h||[0,0,0,1],p||[0,0,0],g||[1,1,1]),w!==void 0){O.meshes=i[w];const D=O.anchor=[0,0];for(const L of O.meshes){const{min:U,max:$}=L.aabb;D[0]+=U[0]+$[0],D[1]+=U[1]+$[1]}D[0]=Math.floor(D[0]/O.meshes.length/2),D[1]=Math.floor(D[1]/O.meshes.length/2)}if(E&&(E.id&&(O.id=E.id),E.lights&&(O.lights=(function(D){if(!D.length)return[];const L=(function(ie){const de=atob(ie),he=new Uint8Array(de.length);for(let ge=0;ge<de.length;ge++)he[ge]=de.codePointAt(ge);return he})(D),U=[],$=L.length/24,X=new Uint16Array(L.buffer),J=new Float32Array(L.buffer);for(let ie=0;ie<$;ie++){const de=X[2*ie*6]/30,he=X[2*ie*6+1]/30,ge=X[2*ie*6+10]/100,Fe=J[6*ie+1],Me=J[6*ie+2],Oe=J[6*ie+3],je=J[6*ie+4],Ue=Oe-Fe,ut=je-Me,Ze=Math.hypot(Ue,ut);U.push({pos:[Fe+.5*Ue,Me+.5*ut,he],normal:[ut/Ze,-Ue/Ze,0],width:Ze,height:de,depth:ge,points:[Fe,Me,Oe,je]})}return U})(E.lights))),P){const D=[];for(const L of P)D.push(HC(e.json.nodes[L],e,i));O.children=D}return O}function r$(a){if(a.vertices.length===0||a.indices.length===0)return null;const e=new qv(a.vertices,a.indices,8,256),[i,u]=[e.min.clone(),e.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:e,min:i,max:u}}function n$(a){if(!a.extras||!a.extras.ground)return null;const e=a.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const u=[];for(const g of i){if(!Array.isArray(g)||g.length!==2)continue;const w=g[0],E=g[1];typeof w=="number"&&typeof E=="number"&&u.push(new kt(w,E))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let h=0;for(let g=0;g<u.length;g++){const w=u[g],E=u[(g+1)%u.length],P=u[(g+2)%u.length];h+=(w.x-E.x)*(P.y-E.y)-(P.x-E.x)*(w.y-E.y)}h>0&&u.reverse();const p=cg(u.flatMap((g=>[g.x,g.y])),[]);return p.length===0?null:{vertices:u,indices:p}}function i$(a,e){const i=[],u=[];let h=0;const p=[];for(const g of a){h=i.length;const w=g.vertexArray.float32,E=g.indexArray.uint16;for(let P=0;P<g.vertexArray.length;P++)p[0]=w[3*P+0],p[1]=w[3*P+1],p[2]=w[3*P+2],Ar(p,p,e),i.push(new kt(p[0],p[1]));for(let P=0;P<3*g.indexArray.length;P++)u.push(E[P]+h)}if(u.length%3!=0)return null;for(let g=0;g<u.length;g+=3){const w=i[u[g+0]],E=i[u[g+1]],P=i[u[g+2]];(w.x-E.x)*(P.y-E.y)-(P.x-E.x)*(w.y-E.y)>0&&([u[g+1],u[g+2]]=[u[g+2],u[g+1]])}return{vertices:i,indices:u}}function WC(a){const e=(function(E,P){const O=[],D=WebGL2RenderingContext;if(E.json.textures)for(const L of E.json.textures){const U={magFilter:D.LINEAR,minFilter:D.NEAREST,wrapS:D.REPEAT,wrapT:D.REPEAT};L.sampler!==void 0&&Object.assign(U,E.json.samplers[L.sampler]),O.push({image:P[L.source],sampler:U,uploaded:!1})}return O})(a,a.images),i=(function(E,P){const O=[];for(const D of E.json.meshes){const L=[];for(const U of D.primitives)L.push(t$(U,E,P));O.push(L)}return O})(a,e),{scenes:u,scene:h,nodes:p}=a.json,g=u?u[h||0].nodes:p,w=[];for(const E of g)w.push(HC(p[E],a,i));return(function(E,P,O){const D={},L=new Set;for(let U=0;U<E.length;U++){const $=O[P[U]];if(!$.extras)continue;const X=$.extras["mapbox:footprint:version"],J=$.extras["mapbox:footprint:id"];(X||J)&&L.add(U),X==="1.0.0"&&J&&(D[J]=U)}for(let U=0;U<E.length;U++){if(L.has(U))continue;const $=E[U],X=O[P[U]];if(!X.extras)continue;let J=null;$.id in D&&(J=i$(E[D[$.id]].meshes,$.matrix)),J||(J=n$(X)),J&&($.footprint=r$(J))}if(L.size>0){const U=Array.from(L.values()).sort((($,X)=>$-X));for(let $=U.length-1;$>=0;$--)E.splice(U[$],1)}})(w,g,a.json.nodes),w}function o$(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const e=a.vertexArray.float32,i=a.aabb.min[0]-1,u=a.aabb.min[1]-1,h=mm/(a.aabb.max[0]-i+2),p=mm/(a.aabb.max[1]-u+2);for(let g=0;g<e.length;g+=3){const w=e[g+2],E=(e[g+0]-i)*h|0,P=(e[g+1]-u)*p|0;w>a.heightmap[P*mm+E]&&(a.heightmap[P*mm+E]=w)}}function ZC(a,e,i,u,h){i.reserve(i.length+4*a.length),u.reserve(u.length+10*a.length),h.reserve(h.length+10*a.length);let p=u.length;for(const g of a){const w=Math.min(10,Math.max(4,1.3*g.height))*e,E=[-g.normal[1],g.normal[0],0],P=Math.min(.29,.1*g.width/g.depth),O=g.width-2*g.depth*e*(P+.01),D=mt([],g.pos,E,O/2),L=mt([],g.pos,E,-O/2),U=[D[0],D[1],D[2]+g.height],$=[L[0],L[1],L[2]+g.height],X=mt([],g.normal,E,P);qe(X,X,w);const J=mt([],g.normal,E,-P);qe(J,J,w),gt(X,D,X),gt(J,L,J),D[2]+=.1,L[2]+=.1,u.emplaceBack(X[0],X[1],X[2]),u.emplaceBack(J[0],J[1],J[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(L[0],L[1],L[2]),u.emplaceBack(U[0],U[1],U[2]),u.emplaceBack($[0],$[1],$[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(L[0],L[1],L[2]),u.emplaceBack(X[0],X[1],X[2]),u.emplaceBack(J[0],J[1],J[2]);const ie=O/w/2;h.emplaceBack(-ie-P,-1,ie,.8),h.emplaceBack(ie+P,-1,ie,.8),h.emplaceBack(-ie,0,ie,1.3),h.emplaceBack(ie,0,ie,1.3),h.emplaceBack(ie+P,-.8,ie,.7),h.emplaceBack(ie+P,-.8,ie,.7),h.emplaceBack(0,0,ie,1.3),h.emplaceBack(0,0,ie,1.3),h.emplaceBack(ie+P,-1.2,ie,.8),h.emplaceBack(ie+P,-1.2,ie,.8),i.emplaceBack(6+p,4+p,8+p),i.emplaceBack(7+p,9+p,5+p),i.emplaceBack(0+p,1+p,2+p),i.emplaceBack(1+p,3+p,2+p),p+=10}}function a$(a,e){const i={};i.indexArray=new ai,i.vertexArray=new ga,i.colorArray=new Vs,ZC(a,e,i.indexArray,i.vertexArray,i.colorArray);const u={defined:!0};u.emissiveFactor=wn.black;const h={};return h.baseColorFactor=wn.white,u.pbrMetallicRoughness=h,i.material=u,i.aabb=new Rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const XC=mn([{name:"a_pos_3f",components:3,type:"Float32"}]),s$=mn([{name:"a_normal_3",components:3,type:"Int16"}]),KC=mn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),l$=mn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),YC=tt.types,C1=32767;function c$(a,e){const i=Wt+e;for(const u of a)for(const h of u)if(h.x<-e||h.x>i||h.y<-e||h.y>i)return!1;return!0}class JC{constructor(e){this.layoutAOArray=[],this.indexArrayForConflationUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.layoutVertexArray=new ga,this.layoutNormalArray=new Ch,this.layoutColorArray=new $s,this.indexArray=new ai,this.indexArrayForConflation=new ai,this.entranceBloom={layoutVertexArray:new ga,layoutVertexBuffer:null,layoutAttenuationArray:new Vs,layoutAttenuationBuffer:null,layoutColorArray:new $s,layoutColorBuffer:null,indexArray:new ai,indexArrayForConflation:new ai,indexBuffer:null,segmentsBucket:new Si},this.programConfigurations=new Za(e.layers,{zoom:e.zoom,lut:e.lut}),this.segmentsBucket=new Si,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.groundEffect=new p1(e)}get segments(){return this.segmentsBucket}get bloomGeometry(){return this.entranceBloom}updateFootprints(e,i){for(const u of this.footprints)i.push({footprint:u,id:e})}prepare(){return(function(){if(Yv!=null||OC!=null)return null;if(pg!=null)return pg;const e=fetch(No.BUILDING_GEN_URL);return pg=(function(i){let u,h,p,g;function w(){u=new Uint8Array(g.buffer),h=new Int32Array(g.buffer),p=new Float32Array(g.buffer)}function E(){throw new Error("Unexpected BuildingGen error.")}const P=()=>{},O={a:{a:E,f:function(D){const L=u.length,U=Math.max(D>>>0,Math.ceil(1.2*L)),$=Math.ceil((U-L)/65536);try{return g.grow($),w(),!0}catch{return!1}},g:E,b:P,c:P,d:P,e:P}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,O):i.then((D=>D.arrayBuffer())).then((D=>WebAssembly.instantiate(D,O)))).then((D=>{const L=D.instance.exports;return(0,L.g)(),g=L.f,w(),new jV({setStyle:L.h,setAOOptions:L.i,setMetricOptions:L.j,setStructuralOptions:L.k,setFacadeOptions:L.l,setFauxFacadeOptions:L.m,setFacadeClassifierOptions:L.n,addFeature:L.o,addFacade:L.p,generateMesh:L.q,getLastError:L.r,getMeshCount:L.s,getPositionsPtr:L.t,getPositionsLength:L.u,getNormalsPtr:L.v,getNormalsLength:L.w,getColorsPtr:L.x,getColorsLength:L.y,getAOPtr:L.z,getAOLength:L.A,getUVPtr:L.B,getUVLength:L.C,getFauxFacadePtr:L.D,getFauxFacadeLength:L.E,getIndicesPtr:L.F,getIndicesLength:L.G,getBuildingPart:L.H,getRingCount:L.I,getRingPtr:L.J,getRingLength:L.K,free:L.L,malloc:L.M,heapU8:u,heap32:h,heapF32:p})}))})(e).then((i=>(pg=null,Yv=i,Yv))).catch((i=>{fn("Could not load building-gen"),pg=null,OC=i})),pg})()}populate(e,i,u,h){const p=UV();if(!p)return;const g=Pe(u);this.tileToMeter=g,this.brightness=i.brightness,p.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,g],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:g,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),p.setAOOptions(!1,.3),p.setMetricOptions(!1,16),p.setStructuralOptions(!0),p.setFacadeOptions(4,!0),p.setFauxFacadeOptions(!1,!1,1),p.setFacadeClassifierOptions(3);const w=new Map;for(const{feature:E}of e){if(YC[E.type]!=="LineString")continue;const P=this.layers[0]._featureFilter.needGeometry,O=ot(E,P);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom),O,u))continue;const D=P?O.geometry:ze(E,u,h),L=[];for(const J of D)for(const ie of J)L.push({x:ie.x,y:ie.y});const U={coordinates:L,crossPerc:E.properties.cross_perc,distanceToRoad:E.properties.distance_to_road,entrances:E.properties.entrances,sourceId:0},$=E.properties.source_id;let X=w.get($);X||(X=[],w.set($,X)),X.push(U)}this.maxHeight=0;for(const{feature:E,index:P}of e){if(YC[E.type]==="LineString")continue;const O=this.layers[0]._featureFilter.needGeometry,D=ot(E,O);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom),D,u))continue;const L=O?D.geometry:ze(E,u,h),U=N_(L,500);if(!c$(L,163))continue;const $=this.layers[0],X=$.layout.get("building-base").evaluate(E,{},u),J=$.layout.get("building-height").evaluate(E,{},u),ie=$.layout.get("building-roof-shape").evaluate(E,{},u),de=$.paint.get("building-ambient-occlusion-intensity"),he=$.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(ie==="flat")continue;const ge=E.properties.source_id;let Fe;Fe=w.has(ge)?w.get(ge):[];const Me=[],Oe=new kt(1/0,1/0),je=new kt(-1/0,-1/0);for(const Ot of U)if(Ot.length>0){const Nt=[];for(const fr of Ot){const tr=[];for(let Xt=fr.length-1;Xt>=0;Xt--){const nr=fr[Xt];tr.push({x:nr.x,y:nr.y}),Oe.x=Math.min(Oe.x,nr.x),Oe.y=Math.min(Oe.y,nr.y),je.x=Math.max(je.x,nr.x),je.y=Math.max(je.y,nr.y)}Nt.push(tr)}Me.push({id:E.id,height:J,minHeight:X,sourceId:0,roofType:ie,coordinates:Nt})}const Ue=p.generateMesh(Me,Fe);if(typeof Ue=="string"||Ue.meshes.length===0||Ue.modifiedPolygonRings.length===0)continue;let ut=0;for(const Ot of Ue.meshes)ut+=Ot.positions.length/3;const Ze=this.segmentsBucket.prepareSegment(ut,this.layoutVertexArray,this.indexArray),_t=[];let qt=null,Et=0,Lt=-1;const Ut=this.indexArray.length;let lt=0;for(const Ot of Ue.meshes){const Nt=this.layoutVertexArray.length;if(Ot.buildingPart==="entrance"){const tr=new Array;for(let Fr=0;Fr<Ot.indices.length;Fr+=12){const Zr=Ot.positions[Fr+0],qr=Ot.positions[Fr+1],yn=Ot.positions[Fr+3],nn=Ot.positions[Fr+4],di=Ot.positions[Fr+2],ve=Ot.positions[Fr+8]-di,xe=1,at=yn-Zr,Ht=nn-qr,Yt=Math.hypot(at,Ht);tr.push({pos:[Zr+.5*at,qr+.5*Ht,di],normal:[Ht/Yt,-at/Yt,0],width:Yt,height:ve,depth:xe,points:[Zr,qr,yn,nn]})}const Xt=this.entranceBloom.segmentsBucket.prepareSegment(10*tr.length,this.entranceBloom.layoutVertexArray,this.entranceBloom.indexArray),nr=this.entranceBloom.layoutVertexArray.length;Et=this.entranceBloom.indexArray.length,ZC(tr,.5/this.tileToMeter,this.entranceBloom.indexArray,this.entranceBloom.layoutVertexArray,this.entranceBloom.layoutAttenuationArray);const Cr=this.entranceBloom.layoutVertexArray.length-nr;Lt=this.entranceBloom.indexArray.length-Et;for(let Fr=0;Fr<Cr;Fr++)this.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Xt.vertexLength+=Cr,Xt.primitiveLength+=Lt,qt={part:Ot.buildingPart,vertexOffset:nr,vertexLength:Cr}}for(let tr=0;tr<Ot.positions.length;tr+=3)lt=Math.max(lt,Ot.positions[tr+2]),this.layoutVertexArray.emplaceBack(Ot.positions[tr],Ot.positions[tr+1],Ot.positions[tr+2]);for(let tr=0;tr<Ot.normals.length;tr+=3)this.layoutNormalArray.emplaceBack(Ot.normals[tr+0]*C1,Ot.normals[tr+1]*C1,Ot.normals[tr+2]*C1);for(let tr=0;tr<Ot.ao.length;tr++)this.layoutAOArray.push(Ot.ao[tr]);for(let tr=0;tr<Ot.colors.length;tr+=3){const Xt=1+(Ot.ao[tr/3]-1)*de;this.layoutColorArray.emplaceBack(Ot.colors[tr]*Xt<<8|Ot.colors[tr+1]*Xt,Ot.colors[tr+2]*Xt<<8)}const fr=Ze.vertexLength;for(let tr=0;tr<Ot.indices.length;tr+=3)this.indexArray.emplaceBack(fr+Ot.indices[tr],fr+Ot.indices[tr+1],fr+Ot.indices[tr+2]);Ze.vertexLength+=Ot.positions.length/3,Ze.primitiveLength+=Ot.indices.length/3,(Ot.buildingPart==="roof"||Ot.buildingPart==="wall"||Ot.buildingPart==="facade_glazing"||Ot.buildingPart==="entrance")&&_t.push({part:Ot.buildingPart,vertexOffset:Nt,vertexLength:Ot.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,lt),this.buildingFeatures.push({feature:D,segment:Ze,parts:_t,buildingBloom:qt});const zt=this.indexArray.length-Ut,Qe=[],ct=[],Gt=new kt(1/0,1/0),Ft=new kt(-1/0,-1/0),gr=this.groundEffect.vertexArray.length;for(const Ot of Ue.modifiedPolygonRings){const Nt=[],fr=new kt(1/0,1/0),tr=new kt(-1/0,-1/0);for(let Xt=0;Xt<Ot.length;Xt+=2){const nr=Ot.length-Xt-2;fr.x=Math.min(fr.x,Ot[nr]),fr.y=Math.min(fr.y,Ot[nr+1]),tr.x=Math.max(tr.x,Ot[nr]),tr.y=Math.max(tr.y,Ot[nr+1]);const Cr=new kt(Ot[nr],Ot[nr+1]);Nt.push(Cr),Qe.push(Cr.x,Cr.y),ct.push(Cr.clone())}Gt.x=Math.min(Gt.x,fr.x),Gt.y=Math.min(Gt.y,fr.y),Ft.x=Math.max(Ft.x,tr.x),Ft.y=Math.max(Ft.y,tr.y),this.groundEffect.addData(Nt,[fr,tr],he)}const lr=this.groundEffect.vertexArray.length-gr;(Oe.x<0||je.x>Wt||Oe.y<0||je.y>Wt)&&this.featuresOnBorder.push({featureId:E.id,footprintIndex:this.footprints.length});{const Ot=cg(Qe,null,2),Nt=new qv(ct,Ot,8,256);let fr=E.id;E.properties&&E.properties.hasOwnProperty("building_id")&&(fr=E.properties.building_id),this.footprints.push({vertices:ct,indices:Ot,grid:Nt,min:Gt,max:Ft,buildingId:fr,hiddenFlags:0,indicesOffset:Ut,indicesLength:zt,bloomIndicesOffset:Et,bloomIndicesLength:Lt,groundEffectVertexOffset:gr,groundEffectVertexLength:lr,segment:Ze,height:lt})}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,E,P,{},i.availableImages,u,i.brightness),this.groundEffect.addPaintPropertiesData(E,P,{},i.availableImages,u,i.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0])}update(e,i,u,h,p,g,w){this.programConfigurations.updatePaintArrays(e,i,p,u,h,g,w),this.groundEffect.update(e,i,p,u,h,g,w)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,XC.members),this.layoutNormalBuffer=e.createVertexBuffer(this.layoutNormalArray,s$.members),this.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(this.entranceBloom.layoutVertexArray,XC.members),this.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(this.entranceBloom.layoutAttenuationArray,l$.members),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutNormalBuffer.destroy(),this.layoutColorBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segmentsBucket.destroy(),this.entranceBloom.layoutVertexBuffer.destroy(),this.entranceBloom.layoutColorBuffer.destroy(),this.entranceBloom.layoutAttenuationBuffer.destroy(),this.entranceBloom.indexBuffer.destroy(),this.entranceBloom.segmentsBucket.destroy())}updateFootprintHiddenFlags(e,i,u=!0){let h=!1;const p=u?i:0,g=0|(u?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const w of e){const E=this.footprints[w],P=E.hiddenFlags&g|p;E.hiddenFlags!==P&&(E.hiddenFlags=P,h=!0,this.groundEffect.updateHiddenByLandmarkRange(E.groundEffectVertexOffset,E.groundEffectVertexLength,E.hiddenFlags!==0))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),!this.indexArrayForConflationUploaded&&this.indexArray.length!==0){this.indexArrayForConflation.resize(this.indexArray.length),this.indexArrayForConflation.uint16.set(this.indexArray.uint16),this.entranceBloom.indexArrayForConflation.resize(this.entranceBloom.indexArray.length),this.entranceBloom.indexArrayForConflation.uint16.set(this.entranceBloom.indexArray.uint16);for(const i of this.footprints){const u=i.indicesOffset+i.indicesLength;if(i.hiddenFlags!==0){for(let p=i.indicesOffset;p<u;p++)this.indexArrayForConflation.uint16[3*p+0]=0,this.indexArrayForConflation.uint16[3*p+1]=0,this.indexArrayForConflation.uint16[3*p+2]=0;const h=i.bloomIndicesOffset+i.bloomIndicesLength;for(let p=i.bloomIndicesOffset;p<h;p++)this.entranceBloom.indexArrayForConflation.uint16[3*p+0]=0,this.entranceBloom.indexArrayForConflation.uint16[3*p+1]=0,this.entranceBloom.indexArrayForConflation.uint16[3*p+2]=0}}this.indexBuffer?this.indexBuffer.updateData(this.indexArrayForConflation):this.indexBuffer=e.createIndexBuffer(this.indexArrayForConflation,!0),this.entranceBloom.indexBuffer?this.entranceBloom.indexBuffer.updateData(this.entranceBloom.indexArrayForConflation):this.entranceBloom.indexBuffer=e.createIndexBuffer(this.entranceBloom.indexArrayForConflation,!0),this.indexArrayForConflationUploaded=!0}}uploadUpdatedColorBuffer(e){this.layoutColorBuffer?this.layoutColorBuffer.updateData(this.layoutColorArray):this.layoutColorBuffer=e.createVertexBuffer(this.layoutColorArray,KC.members,!0),this.entranceBloom.layoutColorBuffer?this.entranceBloom.layoutColorBuffer.updateData(this.entranceBloom.layoutColorArray):this.entranceBloom.layoutColorBuffer=e.createVertexBuffer(this.entranceBloom.layoutColorArray,KC.members,!0)}evaluate(e){const i=e.paint.get("building-ambient-occlusion-intensity");for(const u of this.buildingFeatures){const h=u.feature;h.properties["building-part"]="roof";const p=e.paint.get("building-color").evaluate(h,{},this.canonical),g=e.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);h.properties["building-part"]="wall";const w=e.paint.get("building-color").evaluate(h,{},this.canonical),E=e.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);h.properties["building-part"]="window";const P=e.paint.get("building-color").evaluate(h,{},this.canonical),O=e.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);h.properties["building-part"]="door";const D=e.paint.get("building-color").evaluate(h,{},this.canonical),L=e.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);for(const $ of u.parts){let X,J=p;$.part==="roof"?(J=p,X=g):$.part==="wall"?(J=w,X=E):$.part==="facade_glazing"?(J=P,X=O):$.part==="entrance"&&(J=D,X=L),X=we(X,0,1);for(let ie=0;ie<$.vertexLength;ie++){const de=$.vertexOffset+ie,he=1+(this.layoutAOArray[de]-1)*i;this.layoutColorArray.emplace(de,J.r*he*255<<8|J.g*he*255,J.b*he*255<<8|255*X)}}const U=u.buildingBloom;if(U)for(let $=0;$<U.vertexLength;$++)this.bloomGeometry.layoutColorArray.emplace(U.vertexOffset+$,255*D.r<<8|255*D.g,255*D.b<<8|51*L)}}needsEvaluation(e,i){const u=e.transform.projectionOptions,h=e.style.getBrightness();return!(this.uploaded&&u.name===this.projection.name&&this.brightness===h||(this.projection=u,this.brightness=h,0))}updateReplacement(e,i,u){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped());if(Hv(this.activeReplacements,h))return;this.activeReplacements=h;for(const g of this.footprints)g.hiddenFlags&=-2;const p=[];for(const g of this.activeReplacements){if(g.order<=nC)continue;const w=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));for(const E of this.footprints)E.min.x>g.max.x||E.max.x<g.min.x||E.min.y>g.max.y||E.max.y<g.min.y||(p.length=0,u$(E.vertices,0,E.vertices.length,g.footprintTileId.canonical,e.canonical,p),u1(g.footprint,p,E.indices,0,E.indices.length,0,-w)&&(E.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const g of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(g.groundEffectVertexOffset,g.groundEffectVertexLength,g.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,i){let u=Number.NEGATIVE_INFINITY,h=!0;const p=4*(e+Wt)*Wt+(i+Wt);if(this.footprintLookup.hasOwnProperty(p)){const w=this.footprintLookup[p];return w?{height:w.height,hidden:w.hiddenFlags!==0}:void 0}const g=new kt(e,i);for(const w of this.footprints)e>w.max.x||w.min.x>e||i>w.max.y||w.min.y>i||w.height<=u||h1(g,w)&&(u=w.height,this.footprintLookup[p]=w,h=w.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.footprintLookup[p]=void 0}}function u$(a,e,i,u,h,p){const g=Math.pow(2,u.z-h.z);for(let w=0;w<i;w++){let E=a[w+e].x,P=a[w+e].y;E=(E+h.x*Wt)*g-u.x*Wt,P=(P+h.y*Wt)*g-u.y*Wt,p.push(new kt(E,P))}}let QC,eM;ir(JC,"BuildingBucket",{omit:["layers"]});const h$=mn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),f$=mn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:d$}=h$,p$=mn([{name:"a_packed",components:3,type:"Float32"}]),{members:m$}=p$,g$=mn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:_$}=g$;class tM{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new pp({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const u=this.getKey(e,i);return this.positions[u]}trim(){const e=this.width,i=this.height=xr(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,u){const h=[];let p=e.length%2==1?-e[e.length-1]*u:0,g=e[0]*u,w=!0;h.push({left:p,right:g,isDash:w,zeroLength:e[0]===0});let E=e[0];for(let P=1;P<e.length;P++){w=!w;const O=e[P];p=E*u,E+=O,g=E*u,h.push({left:p,right:g,isDash:w,zeroLength:O===0})}return h}addRoundDash(e,i,u){const h=i/2;for(let p=-u;p<=u;p++){const g=this.width*(this.nextRow+u+p);let w=0,E=e[w];for(let P=0;P<this.width;P++){P/E.right>1&&(E=e[++w]);const O=Math.abs(P-E.left),D=Math.abs(P-E.right),L=Math.min(O,D);let U;const $=p/u*(h+1);if(E.isDash){const X=h-Math.abs($);U=Math.sqrt(L*L+X*X)}else U=h-Math.sqrt(L*L+$*$);this.image.data[g+P]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(e,i){for(let E=e.length-1;E>=0;--E){const P=e[E],O=e[E+1];P.zeroLength?e.splice(E,1):O&&O.isDash===P.isDash&&(O.left=P.left,e.splice(E,1))}const u=e[0],h=e[e.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);const p=this.width*this.nextRow;let g=0,w=e[g];for(let E=0;E<this.width;E++){E/w.right>1&&(w=e[++g]);const P=Math.abs(E-w.left),O=Math.abs(E-w.right),D=Math.min(P,O);this.image.data[p+E]=Math.max(0,Math.min(255,(w.isDash?D:-D)+i+128))}}addDash(e,i){const u=this.getKey(e,i);if(this.positions[u])return this.positions[u];const h=i==="round",p=h?7:0,g=2*p+1;if(this.nextRow+g>this.height)return fn("LineAtlas out of space"),null;e.length===0&&e.push(1);let w=0;for(let O=0;O<e.length;O++)e[O]<0&&(fn("Negative value is found in line dasharray, replacing values with 0"),e[O]=0),w+=e[O];if(w!==0){const O=this.width/w,D=this.getDashRanges(e,this.width,O);h?this.addRoundDash(D,O,p):this.addRegularDash(D,i==="square"?.5*O:0)}const E=this.nextRow+p;this.nextRow+=g;const P={tl:[E,p],br:[w,0]};return this.positions[u]=P,P}}ir(tM,"LineAtlas");const y$=tt.types,v$=Math.cos(Math.PI/180*37.5),x$=Math.cos(Math.PI/180*5);class M1{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new jf,this.layoutVertexArray2=new ga,this.patternVertexArray=new ga,this.indexArray=new ai,this.programConfigurations=new Za(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Si,this.maxLineLength=0,this.zOffsetVertexArray=new ga,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:Wt/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,u,h){this.hasPattern=i1("line",this.layers,this.pixelRatio,i);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Pe(u);const g=this.layers[0].layout.get("line-elevation-reference");if(g==="hd-road-markup")this.elevationType="road";else{const L=this.layers[0].layout.get("line-z-offset"),U=L.isConstant()&&!L.constantOr(0);this.elevationType=g!=="sea"&&g!=="ground"&&U?"none":"offset",this.elevationType==="offset"&&g==="none"&&fn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const w=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&w!==void 0;const E=[];for(const{feature:L,id:U,index:$,sourceLayerIndex:X}of e){const J=this.layers[0]._featureFilter.needGeometry,ie=ot(L,J);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{worldview:this.worldview}),ie,u))continue;const de=p?p.evaluate(ie,{},u):void 0,he={id:U,properties:L.properties,type:L.type,sourceLayerIndex:X,index:$,geometry:J?ie.geometry:ze(L,u,h),patterns:{},sortKey:de};E.push(he)}p&&E.sort(((L,U)=>L.sortKey-U.sortKey));const{lineAtlas:P,featureIndex:O}=i,D=this.addConstantDashes(P);for(const L of E){const{geometry:U,index:$,sourceLayerIndex:X}=L;if(D&&this.addFeatureDashes(L,P),this.hasPattern){const J=o1("line",this.layers,L,this.zoom,this.pixelRatio,i);this.patternFeatures.push(J)}else this.addFeature(L,U,$,u,P.positions,i.availableImages,i.brightness,i.elevationFeatures);O.insert(e[$].feature,U,$,X,this.index)}}addConstantDashes(e){let i=!1;for(const u of this.layers){const h=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")i=!0;else{const g=p.value,w=h.value;if(!w)continue;e.addDash(w,g)}}return i}addFeatureDashes(e,i){const u=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,g=h.layout.get("line-cap").value;if(p.kind==="constant"&&g.kind==="constant")continue;let w,E;if(p.kind==="constant"){if(w=p.value,!w)continue}else w=p.evaluate({zoom:u},e);E=g.kind==="constant"?g.value:g.evaluate({zoom:u},e),i.addDash(w,E),e.patterns[h.id]=[i.getKey(w,E)]}}update(e,i,u,h,p,g,w,E){this.programConfigurations.updatePaintArrays(e,i,p,u,h,g,w,E)}addFeatures(e,i,u,h,p,g){for(const w of this.patternFeatures)this.addFeature(w,w.geometry,w.index,i,u,h,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,m$)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,_$)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,f$.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,d$),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,u,h,p,g,w,E){const P=this.layers[0].layout,O=P.get("line-join").evaluate(e,{}),D=P.get("line-cap").evaluate(e,{}),L=P.get("line-miter-limit"),U=P.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=P.get("line-z-offset").value;const $=this.layers[0].paint.get("line-width").value;if($.kind!=="constant"&&$.isLineProgressConstant===!1&&(this.variableWidthValue=$),this.elevationType==="road"){const X=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,h,E,O,D,L,U)){const[J,ie]=this.clipRuntimeLinesToTile(i,1);for(let de=0;de<J.length;de++){const he=J[de],ge=ie[de],Fe={progress:{min:ge.progress.min,max:ge.progress.max},nextDir:this.computeSegNextDir(ge,he),prevDir:this.computeSegPrevDir(ge,he)};this.addLine(he,e,h,O,D,L,U,Fe)}this.fillNonElevatedRoadSegment(X)}}else for(const X of i)this.addLine(X,e,h,O,D,L,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,p,g,h,w,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return Xv(e,-i,-i,Wt+i,Wt+i)}clipRuntimeLinesToTile(e,i){const u=[];return[Xv(e,-i,-i,Wt+i,Wt+i,u),u]}addElevatedRoadFeature(e,i,u,h,p,g,w,E){const P=[],O=Ti.getElevationFeature(e,h);if(O){const D=this.clipLinesToTile(i,1),L=this.prepareElevatedLines(D,O,u);for(const U of L)P.push({geometry:U,elevation:O,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(P.length===0)return!1;for(const D of P){const L=this.layoutVertexArray.length;this.addLine(D.geometry,e,u,p,g,w,E);const U=new xn(u,D.elevationTileID);if(D.elevation)for(let $=L;$<this.layoutVertexArray.length;$++){const X=new kt(this.layoutVertexArray.int16[6*$]>>1,this.layoutVertexArray.int16[6*$+1]>>1),J=U.pointElevation(X,D.elevation,.05);this.updateHeightRange(J),this.zOffsetVertexArray.emplaceBack(J,0,0)}else this.fillNonElevatedRoadSegment(L)}return!0}prepareElevatedLines(e,i,u){if(i.constantHeight!=null)return e;const h=[],p=1/Pe(u);for(const g of e)FV(g,new Gn(i,p),0,h);return h}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,u,h,p,g,w,E){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const P=h==="none";this.patternJoinNone=this.hasPattern&&P,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const O=E&&E.progress.min>0,D=E&&E.progress.max<1;if(this.lineClips){let je={min:this.lineClips.start,max:this.lineClips.end},Ue=1;if(E){const _t=this.lineClips.end-this.lineClips.start;je=(function(qt,Et,Lt){return{min:Ea(qt.min,Et,Lt),max:Ea(qt.max,Et,Lt)}})(E.progress,{min:0,max:1},je),_t>0&&(Ue=(je.max-je.min)/_t)}const ut=+i.properties.mapbox_clip_feature_len,Ze=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(ut)||Number.isNaN(Ze)){for(let qt=0;qt<e.length-1;qt++)this.totalDistance+=e[qt].dist(e[qt+1]);const _t=this.totalDistance/(je.max-je.min);this.totalFeatureLength=Number.isFinite(_t)?_t:0,this.lineClips.start=je.min,this.lineClips.end=je.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ut,this.distance=Ze*Ue,this.lineClips.start=je.min,this.lineClips.end=je.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const L=y$[i.type]==="Polygon";let U=e.length;for(;U>=2&&e[U-1].equals(e[U-2]);)U--;let $=0;for(;$<U-1&&e[$].equals(e[$+1]);)$++;if(U<(L?3:2))return;h==="bevel"&&(g=1.05);const X=this.segments.prepareSegment(10*U,this.layoutVertexArray,this.indexArray);let J,ie,de,he,ge,Fe,Me,Oe;E&&E.prevDir&&(Fe=E.prevDir.perp()),E&&E.nextDir&&(Me=E.nextDir.perp()),this.e1=this.e2=-1,L&&(J=e[U-2],ge=e[$].sub(J)._unit()._perp());for(let je=$;je<U;je++){if(de=je===U-1?L?e[$+1]:void 0:e[je+1],de&&e[je].equals(de))continue;ge&&(he=ge),J&&(ie=J),J=e[je],Oe=this.evaluateLineProgressFeatures(ie?ie.dist(J):0),ge=de?de.sub(J)._unit()._perp():he,he=he||ge;const Ue=ie&&de;let ut=Ue?h:L||P?"butt":p;const Ze=he.x*ge.x+he.y*ge.y;if(P){const Qe=function(ct){if(ct.patternJoinNone){const Gt=ct.segmentPoints.length/2,Ft=ct.lineSoFar-ct.segmentStart;for(let gr=0;gr<Gt;++gr){const lr=ct.segmentPoints[2*gr+1],Ot=Math.round(ct.segmentPoints[2*gr])+.5+.25*lr;ct.patternVertexArray.emplaceBack(Ot,Ft,ct.segmentStart),ct.patternVertexArray.emplaceBack(Ot,Ft,ct.segmentStart)}ct.segmentPoints.length=0}ct.e1=ct.e2=-1};if(Ue&&Ze<x$){this.updateDistance(ie,J),this.addCurrentVertex(J,he,1,1,X,Oe),Qe(this),this.addCurrentVertex(J,ge,-1,-1,X,Oe);continue}if(ie){if(!de){this.updateDistance(ie,J),this.addCurrentVertex(J,he,1,1,X,Oe),Qe(this);continue}ut="miter"}}let _t=he.add(ge);_t.x===0&&_t.y===0||_t._unit();const qt=_t.x*ge.x+_t.y*ge.y,Et=qt!==0?1/qt:1/0,Lt=2*Math.sqrt(2-2*qt),Ut=qt<v$&&ie&&de,lt=he.x*ge.y-he.y*ge.x>0,zt=this.overscaling<=16?15*Wt/(512*this.overscaling):0;if(Ue&&ut==="round"){if(Et<w)ut="miter";else if(Et<=2){const Qe=O1(J,-10,Wt+10);ut=this.elevationType==="offset"&&(Qe||this.hasCrossSlope)?"miter":"fakeround"}}if(ut==="miter"&&Et>g&&(ut="bevel"),ut==="bevel"&&(Et>2&&(ut="flipbevel"),Et<g&&(ut="miter")),ie&&!(ut==="miter"&&Ut)&&this.updateDistance(ie,J),ut==="miter")if(Ut){const Qe=J.dist(ie);if(Qe>2*zt){const Gt=J.sub(J.sub(ie)._mult(zt/Qe)._round());this.updateDistance(ie,Gt),this.addCurrentVertex(Gt,he,0,0,X,Oe),ie=Gt}this.updateDistance(ie,J),_t._mult(Et),this.addCurrentVertex(J,_t,0,0,X,Oe);const ct=J.dist(de);if(ct>2*zt){const Gt=J.add(de.sub(J)._mult(zt/ct)._round());this.updateDistance(J,Gt),this.addCurrentVertex(Gt,ge,0,0,X,Oe),J=Gt}}else _t._mult(Et),this.addCurrentVertex(J,_t,0,0,X,Oe);else if(ut==="flipbevel"){if(Et>100)_t=ge.mult(-1);else{const Qe=Et*he.add(ge).mag()/he.sub(ge).mag();_t._perp()._mult(Qe*(lt?-1:1))}this.addCurrentVertex(J,_t,0,0,X,Oe),this.addCurrentVertex(J,_t.mult(-1),0,0,X,Oe)}else if(ut==="bevel"||ut==="fakeround"){Oe!=null&&ie&&this.addCurrentVertex(J,Me||he,-1,-1,X,Oe);const Qe=J.dist(ie)<=2*zt&&ut!=="bevel",ct=_t.mult(lt?1:-1);ct._mult(Et);const Gt=ge.mult(lt?-1:1),Ft=he.mult(lt?-1:1),gr=this.evaluateLineProgressFeatures(this.distance);if(Oe==null&&(this.addHalfVertex(J,ct.x,ct.y,!1,!lt,0,X,gr),Qe||this.addHalfVertex(J,ct.x+2*Ft.x,ct.y+2*Ft.y,!1,lt,0,X,gr)),ut==="fakeround"){const lr=Math.round(180*Lt/Math.PI/20);this.addHalfVertex(J,Ft.x,Ft.y,!1,lt,0,X,gr);for(let Ot=0;Ot<lr;Ot++){let Nt=Ot/lr;if(Nt!==.5){const tr=Nt-.5;Nt+=Nt*tr*(Nt-1)*((1.0904+Ze*(Ze*(3.55645-1.43519*Ze)-3.2452))*tr*tr+(.848013+Ze*(.215638*Ze-1.06021)))}const fr=Gt.sub(Ft)._mult(Nt)._add(Ft)._unit();this.addHalfVertex(J,fr.x,fr.y,!1,lt,0,X,gr)}this.addHalfVertex(J,Gt.x,Gt.y,!1,lt,0,X,gr)}Qe||Oe!=null||this.addHalfVertex(J,ct.x+2*Gt.x,ct.y+2*Gt.y,!1,lt,0,X,gr),Oe!=null&&de&&this.addCurrentVertex(J,Fe||ge,1,1,X,Oe)}else if(ut==="butt")this.addCurrentVertex(J,_t,0,0,X,Oe);else if(ut==="square"){if(!ie){const Qe=O?0:-1;this.addCurrentVertex(J,_t,Qe,Qe,X,Oe)}if(this.addCurrentVertex(J,_t,0,0,X,Oe),ie){const Qe=D?0:1;this.addCurrentVertex(J,_t,Qe,Qe,X,Oe)}}else if(ut==="round"){if(ie){const Qe=!Ue&&Me?Me:he;this.addCurrentVertex(J,Qe,0,0,X,Oe),!Ue&&D||this.addCurrentVertex(J,Qe,1,1,X,Oe,!0)}if(de){const Qe=!Ue&&Fe?Fe:ge;!Ue&&O||this.addCurrentVertex(J,Qe,-1,-1,X,Oe,!0),this.addCurrentVertex(J,Qe,0,0,X,Oe)}}}}addVerticesTo(e,i,u,h,p,g,w,E,P,O){const D=(i.w-e.w)/this.tessellationStep|0;let L=0;const U=this.scaledDistance;if(D>1){this.lineSoFar=e.w;const X=(i.x-e.x)/D,J=(i.y-e.y)/D,ie=(i.z-e.z)/D,de=(i.w-e.w)/D;for(let he=1;he<D;++he){e.x+=X,e.y+=J,e.z+=ie,this.lineSoFar+=de,L+=de;const ge=this.evaluateLineProgressFeatures(this.prevDistance+L);this.scaledDistance=(this.prevDistance+L)/this.totalDistance,this.addHalfVertex(e,u,h,O,!1,w,P,ge),this.addHalfVertex(e,p,g,O,!0,-E,P,ge)}}this.lineSoFar=i.w,this.scaledDistance=U;const $=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,u,h,O,!1,w,P,$),this.addHalfVertex(i,p,g,O,!0,-E,P,$)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):fn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,u,h,p,g,w=!1){const E=i.x+i.y*u,P=i.y-i.x*u,O=i.y*h-i.x,D=-i.y-i.x*h;if(g!=null){const L=this.elevationType==="offset",U=-10,$=Wt+10,X=g.zOffset,J=new TC(e.x,e.y,X,this.lineSoFar),ie=!!L&&O1(e,U,$),de=this.lineSoFar,he=this.distance;if(this.currentVertex)if(ie){const ge=this.currentVertexIsOutside,Fe=this.currentVertex,Me=new TC(e.x,e.y,X,this.lineSoFar);if(AC(Fe,Me,U,$),!O1(Me,U,$)){if(ge){this.e1=this.e2=-1,this.distance-=Fe.dist(J),this.lineSoFar=Fe.w;const Oe=this.evaluateLineProgressFeatures(Fe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Fe,E,P,w,!1,u,p,Oe),this.addHalfVertex(Fe,O,D,w,!0,-h,p,Oe),this.prevDistance=this.distance}this.distance=this.prevDistance+Fe.dist(Me),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Fe,Me,E,P,O,D,u,h,p,w),this.distance=he,this.scaledDistance=this.distance/this.totalDistance}}else{const ge=this.currentVertex;if(this.currentVertexIsOutside){AC(ge,J,U,$),this.e1=this.e2=-1,this.distance-=ge.dist(J),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=ge.w;const Fe=this.evaluateLineProgressFeatures(ge.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ge,E,P,w,!1,u,p,Fe),this.addHalfVertex(ge,O,D,w,!0,-h,p,Fe),this.prevDistance=this.distance,this.distance=he,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(ge,J,E,P,O,D,u,h,p,w)}else ie||(this.addHalfVertex(e,E,P,w,!1,u,p,g),this.addHalfVertex(e,O,D,w,!0,-h,p,g));this.currentVertex=J,this.currentVertexIsOutside=ie,this.lineSoFar=de}else this.addHalfVertex(e,E,P,w,!1,u,p,g),this.addHalfVertex(e,O,D,w,!0,-h,p,g)}addHalfVertex({x:e,y:i},u,h,p,g,w,E,P){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,w)),this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(i<<1)+(g?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(w===0?0:w<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const D=Sr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,D)}const O=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),E.primitiveLength++),g?this.e2=O:this.e1=O,P!=null&&this.zOffsetVertexArray.emplaceBack(P.zOffset,P.variableWidth,P.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function O1(a,e,i){return a.x<e||a.x>i||a.y<e||a.y>i}let rM,nM;function iM(a,e,i){return e*(Wt/(a.tileSize*Math.pow(2,i-a.tileID.overscaledZ)))}ir(M1,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const oM=(a,e,i)=>(1-i)*a+i*e;function aM(a,e){return 1/iM(a,1,e.tileZoom)}function sM(a,e,i,u){return a.translatePosMatrix(u||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const lM=a=>{const e=[];cM(a)&&e.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=a.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const u=a.layout.get("line-join").constantOr("miter")==="none",h=!!a.paint.get("line-pattern").constantOr(1);return u&&h&&e.push("LINE_JOIN_NONE"),e};function cM(a){const e=a.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let R1;const uM=()=>R1||(R1={layout:rM||(rM=new Ai({"line-cap":new Qt(Ge.layout_line["line-cap"]),"line-join":new Qt(Ge.layout_line["line-join"]),"line-miter-limit":new Ct(Ge.layout_line["line-miter-limit"]),"line-round-limit":new Ct(Ge.layout_line["line-round-limit"]),"line-sort-key":new Qt(Ge.layout_line["line-sort-key"]),"line-z-offset":new Qt(Ge.layout_line["line-z-offset"]),"line-elevation-reference":new Ct(Ge.layout_line["line-elevation-reference"]),"line-cross-slope":new Ct(Ge.layout_line["line-cross-slope"]),visibility:new Ct(Ge.layout_line.visibility),"line-width-unit":new Ct(Ge.layout_line["line-width-unit"])})),paint:nM||(nM=new Ai({"line-opacity":new Qt(Ge.paint_line["line-opacity"]),"line-color":new Qt(Ge.paint_line["line-color"]),"line-translate":new Ct(Ge.paint_line["line-translate"]),"line-translate-anchor":new Ct(Ge.paint_line["line-translate-anchor"]),"line-width":new Qt(Ge.paint_line["line-width"]),"line-gap-width":new Qt(Ge.paint_line["line-gap-width"]),"line-offset":new Qt(Ge.paint_line["line-offset"]),"line-blur":new Qt(Ge.paint_line["line-blur"]),"line-dasharray":new Qt(Ge.paint_line["line-dasharray"]),"line-pattern":new Qt(Ge.paint_line["line-pattern"]),"line-pattern-cross-fade":new Ct(Ge.paint_line["line-pattern-cross-fade"]),"line-gradient":new Rc(Ge.paint_line["line-gradient"]),"line-trim-offset":new Ct(Ge.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ct(Ge.paint_line["line-trim-fade-range"]),"line-trim-color":new Ct(Ge.paint_line["line-trim-color"]),"line-emissive-strength":new Ct(Ge.paint_line["line-emissive-strength"]),"line-border-width":new Qt(Ge.paint_line["line-border-width"]),"line-border-color":new Qt(Ge.paint_line["line-border-color"]),"line-occlusion-opacity":new Ct(Ge.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},R1);class b$ extends Qt{possiblyEvaluate(e,i){return i=new Un(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,u,h){return i=nt({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,u,h)}}let Y_;function hM(a,e){return e>0?e+2*a:a}const w$=mn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),S$=mn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),T$=mn([{name:"a_projected_pos",components:4,type:"Float32"}],4);mn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const E$=mn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),A$=mn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),P$=mn([{name:"a_texb",components:2,type:"Uint16"}]),I$=mn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),C$=mn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);mn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const fM=mn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),M$=mn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);mn([{name:"triangle",components:3,type:"Uint16"}]),mn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),mn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),mn([{type:"Float32",name:"offsetX"}]),mn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Jo=24;function O$(a,e,i){return a.sections.forEach((u=>{u.text=(function(h,p,g){const w=p.layout.get("text-transform").evaluate(g,{});return w==="uppercase"?h=h.toLocaleUpperCase():w==="lowercase"&&(h=h.toLocaleLowerCase()),hs.applyArabicShaping&&(h=hs.applyArabicShaping(h)),h})(u.text,e,i)})),a}const J_={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function R$(a){return a==="︶"||a==="﹈"||a==="︸"||a==="﹄"||a==="﹂"||a==="︾"||a==="︼"||a==="︺"||a==="︘"||a==="﹀"||a==="︐"||a==="︓"||a==="︔"||a==="｀"||a==="￣"||a==="︑"||a==="︒"}function D$(a){return a==="︵"||a==="﹇"||a==="︷"||a==="﹃"||a==="﹁"||a==="︽"||a==="︻"||a==="︹"||a==="︗"||a==="︿"}const D1=4294967296,dM=1/D1,pM=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let nx=class{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,e,i=this.length){for(;this.pos<i;){const u=this.readVarint(),h=u>>3,p=this.pos;this.type=7&u,a(h,e,this),this.pos===p&&this.skip(u)}return e}readMessage(a,e){return this.readFields(a,e,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*D1;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*D1;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const e=this.buf;let i,u;return u=e[this.pos++],i=127&u,u<128?i:(u=e[this.pos++],i|=(127&u)<<7,u<128?i:(u=e[this.pos++],i|=(127&u)<<14,u<128?i:(u=e[this.pos++],i|=(127&u)<<21,u<128?i:(u=e[this.pos],i|=(15&u)<<28,(function(h,p,g){const w=g.buf;let E,P;if(P=w[g.pos++],E=(112&P)>>4,P<128||(P=w[g.pos++],E|=(127&P)<<3,P<128)||(P=w[g.pos++],E|=(127&P)<<10,P<128)||(P=w[g.pos++],E|=(127&P)<<17,P<128)||(P=w[g.pos++],E|=(127&P)<<24,P<128)||(P=w[g.pos++],E|=(1&P)<<31,P<128))return gg(h,E,p);throw new Error("Expected varint not more than 10 bytes")})(i,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,e=this.pos;return this.pos=a,a-e>=12&&pM?pM.decode(this.buf.subarray(e,a)):(function(i,u,h){let p="",g=u;for(;g<h;){const w=i[g];let E,P,O,D=null,L=w>239?4:w>223?3:w>191?2:1;if(g+L>h)break;L===1?w<128&&(D=w):L===2?(E=i[g+1],(192&E)==128&&(D=(31&w)<<6|63&E,D<=127&&(D=null))):L===3?(E=i[g+1],P=i[g+2],(192&E)==128&&(192&P)==128&&(D=(15&w)<<12|(63&E)<<6|63&P,(D<=2047||D>=55296&&D<=57343)&&(D=null))):L===4&&(E=i[g+1],P=i[g+2],O=i[g+3],(192&E)==128&&(192&P)==128&&(192&O)==128&&(D=(15&w)<<18|(63&E)<<12|(63&P)<<6|63&O,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,L=1):D>65535&&(D-=65536,p+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),p+=String.fromCharCode(D),g+=L}return p})(this.buf,e,a)}readBytes(){const a=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,a);return this.pos=a,e}readPackedVarint(a=[],e){const i=this.readPackedEnd();for(;this.pos<i;)a.push(this.readVarint(e));return a}readPackedSVarint(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const e=this.readPackedEnd();for(;this.pos<e;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){const e=7&a;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(a,e){this.writeVarint(a<<3|e)}realloc(a){let e=this.length||16;for(;e<this.pos+a;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*dM),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*dM),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?(function(e,i){let u,h;if(e>=0?(u=e%4294967296|0,h=e/4294967296|0):(u=~(-e%4294967296),h=~(-e/4294967296),4294967295^u?u=u+1|0:(u=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(p,g,w){w.buf[w.pos++]=127&p|128,p>>>=7,w.buf[w.pos++]=127&p|128,p>>>=7,w.buf[w.pos++]=127&p|128,p>>>=7,w.buf[w.pos++]=127&p|128,w.buf[w.pos]=127&(p>>>=7)})(u,0,i),(function(p,g){const w=(7&p)<<4;g.buf[g.pos++]|=w|((p>>>=3)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p)))))})(h,i)})(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const e=this.pos;this.pos=(function(u,h,p){for(let g,w,E=0;E<h.length;E++){if(g=h.charCodeAt(E),g>55295&&g<57344){if(!w){g>56319||E+1===h.length?(u[p++]=239,u[p++]=191,u[p++]=189):w=g;continue}if(g<56320){u[p++]=239,u[p++]=191,u[p++]=189,w=g;continue}g=w-55296<<10|g-56320|65536,w=null}else w&&(u[p++]=239,u[p++]=191,u[p++]=189,w=null);g<128?u[p++]=g:(g<2048?u[p++]=g>>6|192:(g<65536?u[p++]=g>>12|224:(u[p++]=g>>18|240,u[p++]=g>>12&63|128),u[p++]=g>>6&63|128),u[p++]=63&g|128)}return p})(this.buf,a,this.pos);const i=this.pos-e;i>=128&&mM(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const e=a.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=a[i]}writeRawMessage(a,e){this.pos++;const i=this.pos;a(e,this);const u=this.pos-i;u>=128&&mM(i,u,this),this.pos=i-1,this.writeVarint(u),this.pos+=u}writeMessage(a,e,i){this.writeTag(a,2),this.writeRawMessage(e,i)}writePackedVarint(a,e){e.length&&this.writeMessage(a,k$,e)}writePackedSVarint(a,e){e.length&&this.writeMessage(a,L$,e)}writePackedBoolean(a,e){e.length&&this.writeMessage(a,B$,e)}writePackedFloat(a,e){e.length&&this.writeMessage(a,z$,e)}writePackedDouble(a,e){e.length&&this.writeMessage(a,F$,e)}writePackedFixed32(a,e){e.length&&this.writeMessage(a,N$,e)}writePackedSFixed32(a,e){e.length&&this.writeMessage(a,j$,e)}writePackedFixed64(a,e){e.length&&this.writeMessage(a,U$,e)}writePackedSFixed64(a,e){e.length&&this.writeMessage(a,V$,e)}writeBytesField(a,e){this.writeTag(a,2),this.writeBytes(e)}writeFixed32Field(a,e){this.writeTag(a,5),this.writeFixed32(e)}writeSFixed32Field(a,e){this.writeTag(a,5),this.writeSFixed32(e)}writeFixed64Field(a,e){this.writeTag(a,1),this.writeFixed64(e)}writeSFixed64Field(a,e){this.writeTag(a,1),this.writeSFixed64(e)}writeVarintField(a,e){this.writeTag(a,0),this.writeVarint(e)}writeSVarintField(a,e){this.writeTag(a,0),this.writeSVarint(e)}writeStringField(a,e){this.writeTag(a,2),this.writeString(e)}writeFloatField(a,e){this.writeTag(a,5),this.writeFloat(e)}writeDoubleField(a,e){this.writeTag(a,1),this.writeDouble(e)}writeBooleanField(a,e){this.writeVarintField(a,+e)}};function gg(a,e,i){return i?4294967296*e+(a>>>0):4294967296*(e>>>0)+(a>>>0)}function mM(a,e,i){const u=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(u);for(let h=i.pos-1;h>=a;h--)i.buf[h+u]=i.buf[h]}function k$(a,e){for(let i=0;i<a.length;i++)e.writeVarint(a[i])}function L$(a,e){for(let i=0;i<a.length;i++)e.writeSVarint(a[i])}function z$(a,e){for(let i=0;i<a.length;i++)e.writeFloat(a[i])}function F$(a,e){for(let i=0;i<a.length;i++)e.writeDouble(a[i])}function B$(a,e){for(let i=0;i<a.length;i++)e.writeBoolean(a[i])}function N$(a,e){for(let i=0;i<a.length;i++)e.writeFixed32(a[i])}function j$(a,e){for(let i=0;i<a.length;i++)e.writeSFixed32(a[i])}function U$(a,e){for(let i=0;i<a.length;i++)e.writeFixed64(a[i])}function V$(a,e){for(let i=0;i<a.length;i++)e.writeSFixed64(a[i])}const k1=3;function $$(a,e,i){e.glyphs=[],a===1&&i.readMessage(q$,e)}function q$(a,e,i){if(a===3){const{id:u,bitmap:h,width:p,height:g,left:w,top:E,advance:P}=i.readMessage(G$,{});e.glyphs.push({id:u,bitmap:new pp({width:p+2*k1,height:g+2*k1},h),metrics:{width:p,height:g,left:w,top:E,advance:P}})}else a===4?e.ascender=i.readSVarint():a===5&&(e.descender=i.readSVarint())}function G$(a,e,i){a===1?e.id=i.readVarint():a===2?e.bitmap=i.readBytes():a===3?e.width=i.readVarint():a===4?e.height=i.readVarint():a===5?e.left=i.readSVarint():a===6?e.top=i.readSVarint():a===7&&(e.advance=i.readVarint())}const gM=k1,Xs={horizontal:1,vertical:2,horizontalOnly:3};class Q_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const u=new Q_;return u.scale=e||1,u.fontStack=i,u}static forImage(e){const i=new Q_;return i.image=e,i}}class _g{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,u){const h=new _g;for(let p=0;p<e.sections.length;p++){const g=e.sections[p];g.image?h.addImageSection(g,u):h.addTextSection(g,i)}return h}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,u){let h="";for(let p=0;p<i.length;p++){const g=i.charCodeAt(p+1)||null,w=i.charCodeAt(p-1)||null;h+=!u&&(g&&Of(g)&&!J_[i[p+1]]||w&&Of(w)&&!J_[i[p-1]])||!J_[i[p]]?i[p]:J_[i[p]]}return h})(this.text,e)}trim(){let e=0;for(let u=0;u<this.text.length&&ix[this.text.charCodeAt(u)];u++)e++;let i=this.text.length;for(let u=this.text.length-1;u>=0&&u>=e&&ix[this.text.charCodeAt(u)];u--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const u=new _g;return u.text=this.text.substring(e,i),u.sectionIndex=this.sectionIndex.slice(e,i),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Q_.forText(e.scale,e.fontStack||i));const u=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(u)}addImageSection(e,i){const u=e.image?e.image.getPrimary():null;if(!u)return void fn("Can't add FormattedSection with an empty image.");u.scaleSelf(i);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(Q_.forImage(u)),this.sectionIndex.push(this.sections.length-1)):fn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function L1(a,e,i,u,h,p,g,w,E,P,O,D,L,U,$,X=1){const J=_g.fromFeature(a,h,X);D===Xs.vertical&&J.verticalizePunctuation(L);let ie=[];const de=(function(Oe,je,Ue,ut,Ze,_t){if(!Oe)return[];const qt=[],Et=(function(zt,Qe,ct,Gt,Ft,gr){let lr=0;for(let Ot=0;Ot<zt.length();Ot++){const Nt=zt.getSection(Ot);lr+=_M(zt.getCodePoint(Ot),Nt,Gt,Ft,Qe,gr)}return lr/Math.max(1,Math.ceil(lr/ct))})(Oe,je,Ue,ut,Ze,_t),Lt=Oe.text.indexOf("​")>=0;let Ut=0;for(let zt=0;zt<Oe.length();zt++){const Qe=Oe.getSection(zt),ct=Oe.getCodePoint(zt);if(ix[ct]||(Ut+=_M(ct,Qe,ut,Ze,je,_t)),zt<Oe.length()-1){const Gt=!((lt=ct)<11904||!(wr["Bopomofo Extended"](lt)||wr.Bopomofo(lt)||wr["CJK Compatibility Forms"](lt)||wr["CJK Compatibility Ideographs"](lt)||wr["CJK Compatibility"](lt)||wr["CJK Radicals Supplement"](lt)||wr["CJK Strokes"](lt)||wr["CJK Symbols and Punctuation"](lt)||wr["CJK Unified Ideographs Extension A"](lt)||wr["CJK Unified Ideographs"](lt)||wr["Enclosed CJK Letters and Months"](lt)||wr["Halfwidth and Fullwidth Forms"](lt)||wr.Hiragana(lt)||wr["Ideographic Description Characters"](lt)||wr["Kangxi Radicals"](lt)||wr["Katakana Phonetic Extensions"](lt)||wr.Katakana(lt)||wr["Vertical Forms"](lt)||wr["Yi Radicals"](lt)||wr["Yi Syllables"](lt)));(H$[ct]||Gt||Qe.image)&&qt.push(vM(zt+1,Ut,Et,qt,W$(ct,Oe.getCodePoint(zt+1),Gt&&Lt),!1))}}var lt;return xM(vM(Oe.length(),Ut,Et,qt,0,!0))})(J,P,p,e,u,U),{processBidirectionalText:he,processStyledBidirectionalText:ge}=hs;if(he&&J.sections.length===1){const Oe=he(J.toString(),de);for(const je of Oe){const Ue=new _g;Ue.text=je,Ue.sections=J.sections;for(let ut=0;ut<je.length;ut++)Ue.sectionIndex.push(0);ie.push(Ue)}}else if(ge){const Oe=ge(J.text,J.sectionIndex,de);for(const je of Oe){const Ue=new _g;Ue.text=je[0],Ue.sectionIndex=je[1],Ue.sections=J.sections,ie.push(Ue)}}else ie=(function(Oe,je){const Ue=[],ut=Oe.text;let Ze=0;for(const _t of je)Ue.push(Oe.substring(Ze,_t)),Ze=_t;return Ze<ut.length&&Ue.push(Oe.substring(Ze,ut.length)),Ue})(J,de);const Fe=[],Me={positionedLines:Fe,text:J.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:D,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Oe,je,Ue,ut,Ze,_t,qt,Et,Lt,Ut,lt,zt){let Qe=0,ct=0,Gt=0;const Ft=Et==="right"?1:Et==="left"?0:.5;let gr=!1;for(const Xt of Ze){const nr=Xt.getSections();for(const Cr of nr){if(Cr.image)continue;const Fr=je[Cr.fontStack];if(Fr&&(gr=Fr.ascender!==void 0&&Fr.descender!==void 0,!gr))break}if(!gr)break}let lr=0;for(const Xt of Ze){Xt.trim();const nr=Xt.getMaxScale(),Cr=(nr-1)*Jo,Fr={positionedGlyphs:[],lineOffset:0};Oe.positionedLines[lr]=Fr;const Zr=Fr.positionedGlyphs;let qr=0;if(!Xt.length()){ct+=_t,++lr;continue}let yn=0,nn=0;for(let ve=0;ve<Xt.length();ve++){const xe=Xt.getSection(ve),at=Xt.getSectionIndex(ve),Ht=Xt.getCodePoint(ve);let Yt=xe.scale,Kt=null,hr=null,zr=null,dn=Jo,pn=0,en=Lt;en===Xs.vertical&&((Ot=Ht)===12312||Ot===12313||Ot===12316||Ot===12540||Ot===12448)&&(en=Xs.horizontal);const Qn=!(en===Xs.horizontal||!lt&&!Cu(Ht)||lt&&(ix[Ht]||Eh(Ht)));if(xe.image){const Li=ut.get(xe.image.toString());if(!Li)continue;zr=xe.image,Oe.iconsInText=Oe.iconsInText||!0,hr=Li.paddedRect;const Yr=Li.displaySize;Yt=Yt*Jo/zt,Kt={width:Yr[0],height:Yr[1],left:0,top:-gM,advance:Qn?Yr[1]:Yr[0],localGlyph:!1},pn=gr?-Kt.height*Yt:nr*Jo-17-Yr[1]*Yt,dn=Kt.advance;const yi=(Qn?Yr[0]:Yr[1])*Yt-Jo*nr;yi>0&&yi>qr&&(qr=yi)}else{const Li=Ue[xe.fontStack];if(!Li)continue;Li[Ht]&&(hr=Li[Ht]);const Yr=je[xe.fontStack];if(!Yr)continue;const yi=Yr.glyphs[Ht];if(!yi)continue;if(Kt=yi.metrics,dn=Ht!==8203?Jo:0,gr){const si=Yr.ascender!==void 0?Math.abs(Yr.ascender):0,Hn=Yr.descender!==void 0?Math.abs(Yr.descender):0,Di=(si+Hn)*Yt;yn<Di&&(yn=Di,nn=(si-Hn)/2*Yt),pn=-si*Yt}else pn=(nr-Yt)*Jo-17}Qn?(Oe.verticalizable=!0,Zr.push({glyph:Ht,image:zr,x:Qe,y:ct+pn,vertical:Qn,scale:Yt,localGlyph:Kt.localGlyph,fontStack:xe.fontStack,sectionIndex:at,metrics:Kt,rect:hr}),Qe+=dn*Yt+Ut):(Zr.push({glyph:Ht,image:zr,x:Qe,y:ct+pn,vertical:Qn,scale:Yt,localGlyph:Kt.localGlyph,fontStack:xe.fontStack,sectionIndex:at,metrics:Kt,rect:hr}),Qe+=Kt.advance*Yt+Ut)}Zr.length!==0&&(Gt=Math.max(Qe-Ut,Gt),gr?bM(Zr,Ft,qr,nn,_t*nr/2):bM(Zr,Ft,qr,0,_t/2)),Qe=0;const di=_t*nr+qr;Fr.lineOffset=Math.max(qr,Cr),ct+=di,++lr}var Ot;const Nt=ct,{horizontalAlign:fr,verticalAlign:tr}=z1(qt);(function(Xt,nr,Cr,Fr,Zr,qr){const yn=(nr-Cr)*Zr,nn=-qr*Fr;for(const di of Xt)for(const ve of di.positionedGlyphs)ve.x+=yn,ve.y+=nn})(Oe.positionedLines,Ft,fr,tr,Gt,Nt),Oe.top+=-tr*Nt,Oe.bottom=Oe.top+Nt,Oe.left+=-fr*Gt,Oe.right=Oe.left+Gt,Oe.hasBaseline=gr})(Me,e,i,u,ie,g,w,E,D,P,L,$),!(function(Oe){for(const je of Oe)if(je.positionedGlyphs.length!==0)return!1;return!0})(Fe))return Me}const ix={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},H$={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function _M(a,e,i,u,h,p){if(e.image){const g=u.get(e.image.toString());return g?g.displaySize[0]*e.scale*Jo/p+h:0}{const g=i[e.fontStack],w=g&&g.glyphs[a];return w?w.metrics.advance*e.scale+h:0}}function yM(a,e,i,u){const h=Math.pow(a-e,2);return u?a<e?h/2:2*h:h+Math.abs(i)*i}function W$(a,e,i){let u=0;return a===10&&(u-=1e4),i&&(u+=150),a!==40&&a!==65288||(u+=50),e!==41&&e!==65289||(u+=50),u}function vM(a,e,i,u,h,p){let g=null,w=yM(e,i,h,p);for(const E of u){const P=yM(e-E.x,i,h,p)+E.badness;P<=w&&(g=E,w=P)}return{index:a,x:e,priorBreak:g,badness:w}}function xM(a){return a?xM(a.priorBreak).concat(a.index):[]}function z1(a){let e=.5,i=.5;switch(a){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function bM(a,e,i,u,h){if(!(e||i||u||h))return;const p=a.length-1,g=a[p],w=(g.x+g.metrics.advance*g.scale)*e;for(let E=0;E<=p;E++)a[E].x-=w,a[E].y+=i+u+h}function wM(a){return a.imagePrimary!==void 0&&a.top!==void 0&&a.bottom!==void 0&&a.left!==void 0&&a.right!==void 0}function Z$(a,e,i,u){const{horizontalAlign:h,verticalAlign:p}=z1(u),g=i[0]-a.displaySize[0]*h,w=i[1]-a.displaySize[1]*p;return{imagePrimary:a,imageSecondary:e,top:w,bottom:w+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function SM(a,e,i,u,h,p){const g=a.imagePrimary;let w;if(g.content){const J=g.content,ie=g.pixelRatio||1;w=[J[0]/ie,J[1]/ie,g.displaySize[0]-J[2]/ie,g.displaySize[1]-J[3]/ie]}const E=e.left*p,P=e.right*p;let O,D,L,U;i==="width"||i==="both"?(U=h[0]+E-u[3],D=h[0]+P+u[1]):(U=h[0]+(E+P-g.displaySize[0])/2,D=U+g.displaySize[0]);const $=e.top*p,X=e.bottom*p;return i==="height"||i==="both"?(O=h[1]+$-u[0],L=h[1]+X+u[2]):(O=h[1]+($+X-g.displaySize[1])/2,L=O+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:O,right:D,bottom:L,left:U,collisionPadding:w}}function TM(a){return!a.imagePrimary.stretchX}function EM(a){return!a.imagePrimary.stretchY}function AM(a){return{width:a.right-a.left,height:a.bottom-a.top}}const jh=128;function PM(a,e,i){const{expression:u}=e;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Un(a+1,{worldview:i}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:p}=u;let g=0;for(;g<h.length&&h[g]<=a;)g++;g=Math.max(0,g-1);let w=g;for(;w<h.length&&h[w]<a+1;)w++;w=Math.min(h.length-1,w);const E=h[g],P=h[w];return u.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:P,interpolationType:p}:{kind:"camera",minZoom:E,maxZoom:P,minSize:u.evaluate(new Un(E,{worldview:i})),maxSize:u.evaluate(new Un(P,{worldview:i})),interpolationType:p}}}function F1(a,{uSize:e,uSizeT:i},{lowerSize:u,upperSize:h}){return a.kind==="source"?u/jh:a.kind==="composite"?Sr(u/jh,h/jh,i):e}function ey(a,e,i=1){let u=0,h=0;if(a.kind==="constant")h=a.layoutSize*i;else if(a.kind!=="source"){const{interpolationType:p,minZoom:g,maxZoom:w}=a,E=p?we(So.interpolationFactor(p,e,g,w),0,1):0;a.kind==="camera"?h=Sr(a.minSize,a.maxSize,E)*i:u=E*i}return{uSizeT:u,uSize:h}}class Wf extends kt{constructor(e,i,u,h,p){super(e,i),this.angle=h,this.z=u,p!==void 0&&(this.segment=p)}clone(){return new Wf(this.x,this.y,this.z,this.angle,this.segment)}}function IM(a,e,i,u,h){if(e.segment===void 0)return!0;let p=e,g=e.segment+1,w=0;for(;w>-i/2;){if(g--,g<0)return!1;w-=a[g].dist(p),p=a[g]}w+=a[g].dist(a[g+1]),g++;const E=[];let P=0;for(;w<i/2;){const O=a[g],D=a[g+1];if(!D)return!1;let L=a[g-1].angleTo(O)-O.angleTo(D);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:L}),P+=L;w-E[0].distance>u;)P-=E.shift().angleDelta;if(P>h)return!1;g++,w+=O.dist(D)}return!0}function CM(a){let e=0;for(let i=0;i<a.length-1;i++)e+=a[i].dist(a[i+1]);return e}function MM(a,e,i){return a?.6*e*i:0}function OM(a,e){return Math.max(a?a.right-a.left:0,e?e.right-e.left:0)}function X$(a,e,i,u,h,p){const g=MM(i,h,p),w=OM(i,u)*p;let E=0;const P=CM(a)/2;for(let O=0;O<a.length-1;O++){const D=a[O],L=a[O+1],U=D.dist(L);if(E+U>P){const $=(P-E)/U,X=Sr(D.x,L.x,$),J=Sr(D.y,L.y,$),ie=new Wf(X,J,0,L.angleTo(D),O);return!g||IM(a,ie,w,g,e)?ie:void 0}E+=U}}function K$(a,e,i,u,h,p,g,w,E){const P=MM(u,p,g),O=OM(u,h),D=O*g,L=a[0].x===0||a[0].x===E||a[0].y===0||a[0].y===E;return e-D<e/4&&(e=D+e/4),RM(a,L?e/2*w%e:(O/2+2*p)*g*w%e,e,P,i,D,L,!1,E)}function RM(a,e,i,u,h,p,g,w,E){const P=p/2,O=CM(a);let D=0,L=e-i,U=[];for(let $=0;$<a.length-1;$++){const X=a[$],J=a[$+1],ie=X.dist(J),de=J.angleTo(X);for(;L+i<D+ie;){L+=i;const he=(L-D)/ie,ge=Sr(X.x,J.x,he),Fe=Sr(X.y,J.y,he);if(ge>=0&&ge<E&&Fe>=0&&Fe<E&&L-P>=0&&L+P<=O){const Me=new Wf(ge,Fe,0,de,$);u&&!IM(a,Me,p,u,h)||U.push(Me)}}D+=ie}return w||U.length||g||(U=RM(a,D/2,i,u,h,p,g,!0,E)),U}function DM(a){let e=0,i=0;for(const g of a)e+=g.w*g.h,i=Math.max(i,g.w);a.sort(((g,w)=>w.h-g.h));const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,p=0;for(const g of a)for(let w=u.length-1;w>=0;w--){const E=u[w];if(!(g.w>E.w||g.h>E.h)){if(g.x=E.x,g.y=E.y,p=Math.max(p,g.y+g.h),h=Math.max(h,g.x+g.w),g.w===E.w&&g.h===E.h){const P=u.pop();P&&w<u.length&&(u[w]=P)}else g.h===E.h?(E.x+=g.w,E.w-=g.w):g.w===E.w?(E.y+=g.h,E.h-=g.h):(u.push({x:E.x+g.w,y:E.y,w:E.w-g.w,h:g.h}),E.y+=g.h,E.h-=g.h);break}}return{w:h,h:p,fill:e/(h*p)||0}}ir(Wf,"Anchor");const _m=1;class ty{static getImagePositionScale(e,i,u){if(i&&e&&e.options&&e.options.transform){const h=e.options.transform;return{x:h.a,y:h.d}}return{x:u,y:u}}constructor(e,i,u,h){this.paddedRect=e;const{pixelRatio:p,version:g,stretchX:w,stretchY:E,content:P,sdf:O,usvg:D}=i;this.pixelRatio=p,this.stretchX=w,this.stretchY=E,this.content=P,this.version=g,this.padding=u,this.sdf=O,this.usvg=D,this.scale=ty.getImagePositionScale(h,D,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function B1(a,e,i){const u=Rl.parse(a),h=(function(p,g,w=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*w[0])+2*g,h:(p.data?p.data.height:p.height*w[1])+2*g}})(e,i,[u.options.transform.a,u.options.transform.d]);return{bin:h,imagePosition:new ty(h,e,i,u),imageVariant:u}}class kM{constructor(e,i,u){const h=new Map,p=new Map;this.haveRenderCallbacks=[];const g=[];this.addImages(e,h,_m,g),this.addImages(i,p,2,g);const{w,h:E}=DM(g),P=new ya({width:w||1,height:E||1});for(const[O,D]of e.entries()){const L=h.get(O).paddedRect;ya.copy(D.data,P,{x:0,y:0},{x:L.x+_m,y:L.y+_m},D.data,u,D.sdf)}for(const[O,D]of i.entries()){const L=p.get(O),U=L.paddedRect;let $=L.padding;const X=U.x+$,J=U.y+$,ie=D.data.width,de=D.data.height;$=$>1?$-1:$,ya.copy(D.data,P,{x:0,y:0},{x:X,y:J},D.data,u),ya.copy(D.data,P,{x:0,y:de-$},{x:X,y:J-$},{width:ie,height:$},u),ya.copy(D.data,P,{x:0,y:0},{x:X,y:J+de},{width:ie,height:$},u),ya.copy(D.data,P,{x:ie-$,y:0},{x:X-$,y:J},{width:$,height:de},u),ya.copy(D.data,P,{x:0,y:0},{x:X+ie,y:J},{width:$,height:de},u),ya.copy(D.data,P,{x:ie-$,y:de-$},{x:X-$,y:J-$},{width:$,height:$},u),ya.copy(D.data,P,{x:0,y:de-$},{x:X+ie,y:J-$},{width:$,height:$},u),ya.copy(D.data,P,{x:0,y:0},{x:X+ie,y:J+de},{width:$,height:$},u),ya.copy(D.data,P,{x:ie-$,y:0},{x:X-$,y:J+de},{width:$,height:$},u)}this.lut=u,this.image=P,this.iconPositions=h,this.patternPositions=p}addImages(e,i,u,h){for(const[p,g]of e.entries()){const{bin:w,imagePosition:E,imageVariant:P}=B1(p,g,u);i.set(p,E),h.push(w),g.hasRenderCallback&&this.haveRenderCallbacks.push(P.id)}}patchUpdatedImages(e,i,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((h=>e.hasImage(h,u))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const h of e.getUpdatedImages(u)){for(const p of this.iconPositions.keys()){const g=Rl.parse(p);if(ta.isEqual(g.id,h)){const w=e.getImage(h,u);this.patchUpdatedImage(this.iconPositions.get(p),w,i)}}for(const p of this.patternPositions.keys()){const g=Rl.parse(p);if(ta.isEqual(g.id,h)){const w=e.getImage(h,u);this.patchUpdatedImage(this.patternPositions.get(p),w,i)}}}}patchUpdatedImage(e,i,u){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,p]=e.tl,g=e.sdf;if(this.lut||g){const w={width:i.data.width,height:i.data.height},E=new ya(w);ya.copy(i.data,E,{x:0,y:0},{x:0,y:0},w,this.lut,g),u.update(E,{position:{x:h,y:p}})}else u.update(i.data,{position:{x:h,y:p}})}}ir(ty,"ImagePosition"),ir(kM,"ImageAtlas");const ry=1e20;function LM(a,e,i,u,h,p,g,w,E){for(let P=e;P<e+u;P++)zM(a,i*p+P,p,h,g,w,E);for(let P=i;P<i+h;P++)zM(a,P*p+e,1,u,g,w,E)}function zM(a,e,i,u,h,p,g){p[0]=0,g[0]=-ry,g[1]=ry,h[0]=a[e];for(let w=1,E=0,P=0;w<u;w++){h[w]=a[e+w*i];const O=w*w;do{const D=p[E];P=(h[w]-h[D]+O-D*D)/(w-D)/2}while(P<=g[E]&&--E>-1);E++,p[E]=w,g[E]=P,g[E+1]=ry}for(let w=0,E=0;w<u;w++){for(;g[E+1]<w;)E++;const P=p[E],O=w-P;a[e+w*i]=h[P]+O*O}}const Uu=2,N1={none:0,ideographs:1,all:2};class yg{constructor(e,i,u){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const u=[],h=this.url||No.GLYPHS_URL;for(const p in e)for(const g of e[p])u.push({stack:p,id:g});Ve(u,(({stack:p,id:g},w)=>{let E=this.entries[p];E||(E=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=E.glyphs[g];if(P!==void 0)return void w(null,{stack:p,id:g,glyph:P});if(P=this._tinySDF(E,p,g),P)return E.glyphs[g]=P,void w(null,{stack:p,id:g,glyph:P});const O=Math.floor(g/256);if(256*O>65535)return fn("glyphs > 65535 not supported"),void w(null,{stack:p,id:g,glyph:P});if(E.ranges[O])return void w(null,{stack:p,id:g,glyph:P});let D=E.requests[O];D||(D=E.requests[O]=[],yg.loadGlyphRange(p,O,h,this.requestManager,((L,U)=>{if(U){E.ascender=U.ascender,E.descender=U.descender;for(const $ in U.glyphs)this._doesCharSupportLocalGlyph(+$)||(E.glyphs[+$]=U.glyphs[+$]);E.ranges[O]=!0}for(const $ of D)$(L,U);delete E.requests[O]}))),D.push(((L,U)=>{L?w(L):U&&w(null,{stack:p,id:g,glyph:U.glyphs[g]||null})}))}),((p,g)=>{if(p)i(p);else if(g){const w={};for(const{stack:E,id:P,glyph:O}of g)w[E]===void 0&&(w[E]={}),w[E].glyphs===void 0&&(w[E].glyphs={}),w[E].glyphs[P]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics},w[E].ascender=this.entries[E].ascender,w[E].descender=this.entries[E].descender;i(null,w)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==N1.none&&(this.localGlyphMode===N1.all?!!this.localFontFamily:!!this.localFontFamily&&(wr["CJK Unified Ideographs"](e)||wr["Hangul Syllables"](e)||wr.Hiragana(e)||wr.Katakana(e)||wr["CJK Symbols and Punctuation"](e)||wr["CJK Unified Ideographs Extension A"](e)||wr["CJK Unified Ideographs Extension B"](e)||wr.Osage(e)))}_tinySDF(e,i,u){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let p=e.tinySDF;if(!p){let X="400";/bold/i.test(i)?X="900":/medium/i.test(i)?X="500":/light/i.test(i)&&(X="200"),p=e.tinySDF=new yg.TinySDF({fontFamily:h,fontWeight:X,fontSize:24*Uu,buffer:3*Uu,radius:8*Uu}),p.fontWeight=X}if(this.localGlyphs[p.fontWeight][u])return this.localGlyphs[p.fontWeight][u];const g=String.fromCodePoint(u),{data:w,width:E,height:P,glyphWidth:O,glyphHeight:D,glyphLeft:L,glyphTop:U,glyphAdvance:$}=p.draw(g);return this.localGlyphs[p.fontWeight][u]={id:u,bitmap:new pp({width:E,height:P},w),metrics:{width:O/Uu,height:D/Uu,left:L/Uu,top:U/Uu-27,advance:$/Uu,localGlyph:!0}}}}yg.loadGlyphRange=function(a,e,i,u,h){const p=256*e,g=p+255,w=u.transformRequest(u.normalizeGlyphsURL(i).replace("{fontstack}",a).replace("{range}",`${p}-${g}`),gs.Glyphs);nf(w,((E,P)=>{if(E)h(E);else if(P){const O={},D=(function(L){return new nx(L).readFields($$,{})})(P);for(const L of D.glyphs)O[L.id]=L;h(null,{glyphs:O,ascender:D.ascender,descender:D.descender})}}))},yg.TinySDF=class{constructor({fontSize:a=24,buffer:e=3,radius:i=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=i;const w=this.size=a+4*e,E=this._createCanvas(w),P=this.ctx=E.getContext("2d",{willReadFrequently:!0});P.font=`${g} ${p} ${a}px ${h}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(a){const e=document.createElement("canvas");return e.width=e.height=a,e}draw(a){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(a),g=Math.ceil(i),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),E=Math.min(this.size-this.buffer,g+Math.ceil(u)),P=w+2*this.buffer,O=E+2*this.buffer,D=Math.max(P*O,0),L=new Uint8ClampedArray(D),U={data:L,width:P,height:O,glyphWidth:w,glyphHeight:E,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(w===0||E===0)return U;const{ctx:$,buffer:X,gridInner:J,gridOuter:ie}=this;$.clearRect(X,X,w,E),$.fillText(a,X,X+g);const de=$.getImageData(X,X,w,E);ie.fill(ry,0,D),J.fill(0,0,D);for(let he=0;he<E;he++)for(let ge=0;ge<w;ge++){const Fe=de.data[4*(he*w+ge)+3]/255;if(Fe===0)continue;const Me=(he+X)*P+ge+X;if(Fe===1)ie[Me]=0,J[Me]=ry;else{const Oe=.5-Fe;ie[Me]=Oe>0?Oe*Oe:0,J[Me]=Oe<0?Oe*Oe:0}}LM(ie,0,0,P,O,P,this.f,this.v,this.z),LM(J,X,X,w,E,P,this.f,this.v,this.z);for(let he=0;he<D;he++){const ge=Math.sqrt(ie[he])-Math.sqrt(J[he]);L[he]=Math.round(255-255*(ge/this.radius+this.cutoff))}return U}};const _p=_m;function FM(a,e){return a+e[1]-e[0]}function BM(a,e,i,u,h=1){const p=[],g=a.imagePrimary,w=g.pixelRatio,E=g.paddedRect.w-2*_p,P=g.paddedRect.h-2*_p,O=(a.right-a.left)*h,D=(a.bottom-a.top)*h,L=g.stretchX||[[0,E]],U=g.stretchY||[[0,P]],$=L.reduce(FM,0),X=U.reduce(FM,0),J=E-$,ie=P-X;let de=0,he=$,ge=0,Fe=X,Me=0,Oe=J,je=0,Ue=ie;if(g.content&&u){const Ze=g.content;de=ox(L,0,Ze[0]),ge=ox(U,0,Ze[1]),he=ox(L,Ze[0],Ze[2]),Fe=ox(U,Ze[1],Ze[3]),Me=Ze[0]-de,je=Ze[1]-ge,Oe=Ze[2]-Ze[0]-he,Ue=Ze[3]-Ze[1]-Fe}const ut=(Ze,_t,qt,Et)=>{const Lt=ax(Ze.stretch-de,he,O,a.left*h),Ut=sx(Ze.fixed-Me,Oe,Ze.stretch,$),lt=ax(_t.stretch-ge,Fe,D,a.top*h),zt=sx(_t.fixed-je,Ue,_t.stretch,X),Qe=ax(qt.stretch-de,he,O,a.left*h),ct=sx(qt.fixed-Me,Oe,qt.stretch,$),Gt=ax(Et.stretch-ge,Fe,D,a.top*h),Ft=sx(Et.fixed-je,Ue,Et.stretch,X),gr=new kt(Lt,lt),lr=new kt(Qe,lt),Ot=new kt(Qe,Gt),Nt=new kt(Lt,Gt),fr=new kt(Ut/w,zt/w),tr=new kt(ct/w,Ft/w),Xt=e*Math.PI/180;if(Xt){const yn=Math.sin(Xt),nn=Math.cos(Xt),di=[nn,-yn,yn,nn];gr._matMult(di),lr._matMult(di),Nt._matMult(di),Ot._matMult(di)}const nr=Ze.stretch+Ze.fixed,Cr=qt.stretch+qt.fixed,Fr=_t.stretch+_t.fixed,Zr=Et.stretch+Et.fixed,qr=a.imageSecondary;return{tl:gr,tr:lr,bl:Nt,br:Ot,texPrimary:{x:g.paddedRect.x+_p+nr,y:g.paddedRect.y+_p+Fr,w:Cr-nr,h:Zr-Fr},texSecondary:qr?{x:qr.paddedRect.x+_p+nr,y:qr.paddedRect.y+_p+Fr,w:Cr-nr,h:Zr-Fr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fr,pixelOffsetBR:tr,minFontScaleX:Oe/w/O,minFontScaleY:Ue/w/D,isSDF:i}};if(u&&(g.stretchX||g.stretchY)){const Ze=NM(L,J,$),_t=NM(U,ie,X);for(let qt=0;qt<Ze.length-1;qt++){const Et=Ze[qt],Lt=Ze[qt+1];for(let Ut=0;Ut<_t.length-1;Ut++)p.push(ut(Et,_t[Ut],Lt,_t[Ut+1]))}}else p.push(ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:P+1}));return p}function ox(a,e,i){let u=0;for(const h of a)u+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return u}function NM(a,e,i){const u=[{fixed:-_p,stretch:0}];for(const[h,p]of a){const g=u[u.length-1];u.push({fixed:h-g.stretch,stretch:g.stretch}),u.push({fixed:h-g.stretch,stretch:g.stretch+(p-h)})}return u.push({fixed:e+_p,stretch:i}),u}function ax(a,e,i,u){return a/e*i+u}function sx(a,e,i,u){return a-e*i/u}function Y$(a,e,i,u){const h=e+a.positionedLines[u].lineOffset;return u===0?i+h/2:i+(h+(e+a.positionedLines[u-1].lineOffset))/2}function J$(a,e=1,i=!1){let u=1/0,h=1/0,p=-1/0,g=-1/0;const w=a[0];for(let U=0;U<w.length;U++){const $=w[U];(!U||$.x<u)&&(u=$.x),(!U||$.y<h)&&(h=$.y),(!U||$.x>p)&&(p=$.x),(!U||$.y>g)&&(g=$.y)}const E=Math.min(p-u,g-h);let P=E/2;const O=new fh([],Q$);if(E===0)return new kt(u,h);for(let U=u;U<p;U+=E)for(let $=h;$<g;$+=E)O.push(new vg(U+P,$+P,P,a));let D=(function(U){let $=0,X=0,J=0;const ie=U[0];for(let de=0,he=ie.length,ge=he-1;de<he;ge=de++){const Fe=ie[de],Me=ie[ge],Oe=Fe.x*Me.y-Me.x*Fe.y;X+=(Fe.x+Me.x)*Oe,J+=(Fe.y+Me.y)*Oe,$+=3*Oe}return new vg(X/$,J/$,0,U)})(a),L=O.length;for(;O.length;){const U=O.pop();(U.d>D.d||!D.d)&&(D=U,i&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,L)),U.max-D.d<=e||(P=U.h/2,O.push(new vg(U.p.x-P,U.p.y-P,P,a)),O.push(new vg(U.p.x+P,U.p.y-P,P,a)),O.push(new vg(U.p.x-P,U.p.y+P,P,a)),O.push(new vg(U.p.x+P,U.p.y+P,P,a)),L+=4)}return i&&(console.log(`num probes: ${L}`),console.log(`best distance: ${D.d}`)),D.p}function Q$(a,e){return e.max-a.max}class vg{constructor(e,i,u,h){this.p=new kt(e,i),this.h=u,this.d=(function(p,g){let w=!1,E=1/0;for(let P=0;P<g.length;P++){const O=g[P];for(let D=0,L=O.length,U=L-1;D<L;U=D++){const $=O[D],X=O[U];$.y>p.y!=X.y>p.y&&p.x<(X.x-$.x)*(p.y-$.y)/(X.y-$.y)+$.x&&(w=!w),E=Math.min(E,Oa(p,$,X))}}return(w?1:-1)*Math.sqrt(E)})(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const e6=Object.keys,j1=Number.POSITIVE_INFINITY,t6=Math.sqrt(2);function jM(a,[e,i]){let u=0,h=0;if(i===j1){e<0&&(e=0);const p=e/t6;switch(a){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(a){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=e;break;case"right":u=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),a){case"top-right":case"top-left":case"top":h=i-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-i}switch(a){case"top-right":case"bottom-right":case"right":u=-e;break;case"top-left":case"bottom-left":case"left":u=e}}return[u,h]}function lx(a,e,i,u,h,p,g,w,E){if(!e||!e.usvg)return;const P=AM(u),O=AM(h),D=p!=="both"&&p!=="width"||!TM(u)?1:O.width/P.width,L=p!=="both"&&p!=="height"||!EM(u)?1:O.height/P.height;i.scaleSelf(D,L);const U=i.toString();g.set(U,i),w.set(U,e);const{imagePosition:$}=B1(U,e,_m);E.set(U,$)}function UM(a,e,i,u,h,p,g,w,E){if(!a)return;const P=(function(O,D,L,U,$,X){if(O.kind==="camera")return O.maxSize;if(O.kind==="composite"){const J=D.possiblyEvaluate(new Un(O.maxZoom,{worldview:X}),L).evaluate($,{},L),ie=D.possiblyEvaluate(new Un(O.minZoom,{worldview:X}),L).evaluate($,{},L);return Math.max(J,ie)}return D.possiblyEvaluate(new Un(U,{worldview:X})).evaluate($,{},L)})(e,i,u,h,p,E);return a.scaleSelf(P*w*g)}function VM(a,e,i,u,h,p,g,w,E){return{iconPrimary:UM(a.getPrimary(),e,i,u,h,p,g,w,E),iconSecondary:UM(a.getSecondary(),e,i,u,h,p,g,w,E)}}function r6(a,e,i){if(!e)return;const u=i.get(a.toString()),h=i.get(e.toString());h&&(u.paddedRect.w===h.paddedRect.w&&u.paddedRect.h===h.paddedRect.h||fn(`Mismatch in icon variant sizes: ${a.toString()} and ${e.toString()}`),u.usvg!==h.usvg&&fn(`Mismatch in icon variant image types: ${a.id} and ${e.id}`))}function $M(a,e,i,u){if(!a)return;const h=e.get(i.toString());if(a.imagePrimary=h,u){const p=e.get(u.toString());a.imageSecondary=p}}function n6(a,e){for(const i in a.horizontal)qM(a.horizontal[i],e);qM(a.vertical,e)}function qM(a,e){if(a){for(const i of a.positionedLines)for(const u of i.positionedGlyphs)if(u.image!==null){const h=u.image.toString();u.rect=e.get(h).paddedRect}}}function U1(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function i6(a,e,i,u,h,p,g,w,E){const P=V1(p.horizontal)||p.vertical,O=i.get("icon-text-fit-padding").evaluate(u,{},h);let D,L=e;return e&&E!=="none"&&(a.allowVerticalPlacement&&p.vertical&&(D=SM(e,p.vertical,E,O,w,g)),P&&(L=SM(e,P,E,O,w,g))),{defaultShapedIcon:L,verticallyShapedIcon:D}}function o6(a,e,i,u,h,p,g,w,E,P,O,D,L,U,$,X,J,ie,de,he){let ge=g.textMaxSize.evaluate(e,{},L);ge===void 0?ge=w*g.textScaleFactor:ge*=g.textScaleFactor;const Fe=a.layers[0].layout,Me=V1(i.horizontal)||i.vertical,Oe=U.name==="globe",je=Jo,Ue=a.tilePixelRatio*ge/je,ut=(Ut=a.overscaling,a.zoom>18&&Ut>2&&(Ut>>=1),Math.max(Wt/(512*Ut),1)*Fe.get("symbol-spacing")),Ze=Fe.get("text-padding")*a.tilePixelRatio,_t=Fe.get("icon-padding")*a.tilePixelRatio,qt=Cn(Fe.get("text-max-angle")),Et=Fe.get("icon-rotation-alignment")==="map"&&he!=="point",Lt=ut/2;var Ut;a.hasAnyIconTextFit===!1&&J!=="none"&&(a.hasAnyIconTextFit=!0);const lt=e.properties?+e.properties[Jt]:null,zt=lt&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(lt):65535,Qe=(ct,Gt,Ft)=>{if(Gt.x<0||Gt.x>=Wt||Gt.y<0||Gt.y>=Wt)return;let gr=null;if(Oe){const{x:lr,y:Ot,z:Nt}=U.projectTilePoint(Gt.x,Gt.y,Ft);gr={anchor:new Wf(lr,Ot,Nt,0,void 0),up:U.upVector(Ft,Gt.x,Gt.y)}}(function(lr,Ot,Nt,fr,tr,Xt,nr,Cr,Fr,Zr,qr,yn,nn,di,ve,xe,at,Ht,Yt,Kt,hr,zr,dn,pn,en,Qn,Li,Yr,yi){const si=lr.addToLineVertexArray(Ot,fr);let Hn,Di,pi,li,fi,Kn,tn,ei=0,ki=0,Dr=0,Pn=0,mi=-1,Bi=-1;const vi={};let mo=gc("");const ri=Nt?Nt.anchor:Ot,ho=Yr!=="none";let As=0,va=0;if(Fr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const go=Fr.layout.get("text-offset").evaluate(hr,{},en);As=go[0]*Jo,va=go[1]*Jo}else As=Fr.layout.get("text-radial-offset").evaluate(hr,{},en)*Jo,va=j1;if(lr.allowVerticalPlacement&&tr.vertical){const go=tr.vertical;if(ve)Kn=$1(go),Cr&&(tn=$1(Cr));else{const zo=Fr.layout.get("text-rotate").evaluate(hr,{},en)+90;pi=cx(Zr,ri,Ot,qr,yn,nn,go,di,zo,xe),Cr&&(li=cx(Zr,ri,Ot,qr,yn,nn,Cr,Ht,zo))}}if(Xt){const go=lr.iconSizeData,zo=Fr.layout.get("icon-rotate").evaluate(hr,{},en),xa=BM(Xt,zo,dn,ho,zr.iconScaleFactor),Ja=Cr?BM(Cr,zo,dn,ho,zr.iconScaleFactor):void 0;Di=cx(Zr,ri,Ot,qr,yn,nn,Xt,Ht,zo,null),ei=4*xa.length;let Ra=null;go.kind==="source"?(Ra=[jh*Fr.layout.get("icon-size").evaluate(hr,{},en)*zr.iconScaleFactor],Ra[0]>yp&&fn(`${lr.layerIds[0]}: Value for "icon-size" is >= ${ny}. Reduce your "icon-size".`)):go.kind==="composite"&&(Ra=[jh*zr.compositeIconSizes[0].evaluate(hr,{},en)*zr.iconScaleFactor,jh*zr.compositeIconSizes[1].evaluate(hr,{},en)*zr.iconScaleFactor],(Ra[0]>yp||Ra[1]>yp)&&fn(`${lr.layerIds[0]}: Value for "icon-size" is >= ${ny}. Reduce your "icon-size".`)),lr.addSymbols(lr.icon,xa,Ra,Kt,Yt,hr,void 0,Nt,Ot,si.lineStartIndex,si.lineLength,-1,pn,en,Qn,Li),mi=lr.icon.placedSymbolArray.length-1,Ja&&(ki=4*Ja.length,lr.addSymbols(lr.icon,Ja,Ra,Kt,Yt,hr,Xs.vertical,Nt,Ot,si.lineStartIndex,si.lineLength,-1,pn,en,Qn,Li),Bi=lr.icon.placedSymbolArray.length-1)}for(const go in tr.horizontal){const zo=go,xa=tr.horizontal[zo];Hn||(mo=gc(xa.text),ve?fi=$1(xa):Hn=cx(Zr,ri,Ot,qr,yn,nn,xa,di,Fr.layout.get("text-rotate").evaluate(hr,{},en),xe));const Ja=xa.positionedLines.length===1;if(Dr+=GM(lr,Nt,Ot,xa,nr,Fr,ve,hr,xe,si,tr.vertical?Xs.horizontal:Xs.horizontalOnly,Ja?e6(tr.horizontal):[zo],vi,mi,zr,pn,en,Qn),Ja)break}tr.vertical&&(Pn+=GM(lr,Nt,Ot,tr.vertical,nr,Fr,ve,hr,xe,si,Xs.vertical,["vertical"],vi,Bi,zr,pn,en,Qn));let la=-1;const Ps=(go,zo)=>go?Math.max(go,zo):zo;la=Ps(fi,la),la=Ps(Kn,la),la=Ps(tn,la);const Uh=la>-1?1:0;lr.glyphOffsetArray.length>=65535&&fn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),hr.sortKey!==void 0&&lr.addToSortKeyRanges(lr.symbolInstances.length,hr.sortKey),lr.symbolInstances.emplaceBack(Ot.x,Ot.y,ri.x,ri.y,ri.z,vi.right>=0?vi.right:-1,vi.center>=0?vi.center:-1,vi.left>=0?vi.left:-1,vi.vertical>=0?vi.vertical:-1,mi,Bi,mo,Hn!==void 0?Hn:lr.collisionBoxArray.length,Hn!==void 0?Hn+1:lr.collisionBoxArray.length,pi!==void 0?pi:lr.collisionBoxArray.length,pi!==void 0?pi+1:lr.collisionBoxArray.length,Di!==void 0?Di:lr.collisionBoxArray.length,Di!==void 0?Di+1:lr.collisionBoxArray.length,li||lr.collisionBoxArray.length,li?li+1:lr.collisionBoxArray.length,qr,Dr,Pn,ei,ki,Uh,0,As,va,la,0,ho?1:0,yi)})(a,Gt,gr,ct,i,u,p,h,a.layers[0],a.collisionBoxArray,e.index,e.sourceLayerIndex,a.index,Ze,de,P,0,_t,Et,ie,e,g,O,D,L,$,X,J,zt)};if(he==="line")for(const ct of Xv(e.geometry,0,0,Wt,Wt)){const Gt=K$(ct,ut,qt,i.vertical||Me,u,je,Ue,a.overscaling,Wt);for(const Ft of Gt)Me&&a6(a,Me.text,Lt,Ft)||Qe(ct,Ft,L)}else if(he==="line-center"){for(const ct of e.geometry)if(ct.length>1){const Gt=X$(ct,qt,i.vertical||Me,u,je,Ue);Gt&&Qe(ct,Gt,L)}}else if(e.type==="Polygon")for(const ct of N_(e.geometry,0)){const Gt=J$(ct,16);Qe(ct[0],new Wf(Gt.x,Gt.y,0,0,void 0),L)}else if(e.type==="LineString")for(const ct of e.geometry)Qe(ct,new Wf(ct[0].x,ct[0].y,0,0,void 0),L);else if(e.type==="Point")for(const ct of e.geometry)for(const Gt of ct)Qe([Gt],new Wf(Gt.x,Gt.y,0,0,void 0),L)}const ny=255,yp=ny*jh;function GM(a,e,i,u,h,p,g,w,E,P,O,D,L,U,$,X,J,ie){const de=(function(Fe,Me,Oe,je,Ue,ut,Ze,_t){const qt=[];if(Me.positionedLines.length===0)return qt;const Et=je.layout.get("text-rotate").evaluate(ut,{})*Math.PI/180,Lt=(function(ct){const Gt=ct[0],Ft=ct[1],gr=Gt*Ft;return gr>0?[Gt,-Ft]:gr<0?[-Gt,Ft]:Gt===0?[Ft,Gt]:[Ft,-Gt]})(Oe);let Ut=Math.abs(Me.top-Me.bottom);for(const ct of Me.positionedLines)Ut-=ct.lineOffset;const lt=Me.positionedLines.length,zt=Ut/lt;let Qe=Me.top-Oe[1];for(let ct=0;ct<lt;++ct){const Gt=Me.positionedLines[ct];Qe=Y$(Me,zt,Qe,ct);for(const Ft of Gt.positionedGlyphs){if(!Ft.rect)continue;const gr=Ft.rect||{};let lr=gM+1,Ot=!0,Nt=1,fr=0;if(Ft.image){const hr=Ze.get(Ft.image.toString());if(!hr)continue;if(hr.sdf){fn("SDF images are not supported in formatted text and will be ignored.");continue}Ot=!1,Nt=hr.pixelRatio,lr=_m/Nt}const tr=(Ue||_t)&&Ft.vertical,Xt=Ft.metrics.advance*Ft.scale/2,nr=Ft.metrics,Cr=Ft.rect;if(Cr===null)continue;_t&&Me.verticalizable&&(fr=Ft.image?Xt-Ft.metrics.width*Ft.scale/2:0);const Fr=Ue?[Ft.x+Xt,Ft.y]:[0,0];let Zr=[0,0],qr=[0,0],yn=!1;Ue||(tr?(qr=[Ft.x+Xt+Lt[0],Ft.y+Lt[1]-fr],yn=!0):Zr=[Ft.x+Xt+Oe[0],Ft.y+Oe[1]-fr]);const nn=Cr.w*Ft.scale/(Nt*(Ft.localGlyph?Uu:1)),di=Cr.h*Ft.scale/(Nt*(Ft.localGlyph?Uu:1));let ve,xe,at,Ht;if(tr){const hr=Ft.y-Qe,zr=new kt(-Xt,Xt-hr),dn=-Math.PI/2,pn=new kt(...qr);ve=new kt(-Xt+Zr[0],Zr[1]),ve._rotateAround(dn,zr)._add(pn),ve.x+=-hr+Xt,ve.y-=(nr.left-lr)*Ft.scale;const en=Ft.image?nr.advance*Ft.scale:Jo*Ft.scale,Qn=String.fromCodePoint(Ft.glyph);R$(Qn)?ve.x+=(1-lr)*Ft.scale:D$(Qn)?ve.x+=en-nr.height*Ft.scale+(-lr-1)*Ft.scale:ve.x+=Ft.image||nr.width+2*lr===Cr.w&&nr.height+2*lr===Cr.h?(en-di)/2:(en-(nr.height+2*lr)*Ft.scale)/2,xe=new kt(ve.x,ve.y-nn),at=new kt(ve.x+di,ve.y),Ht=new kt(ve.x+di,ve.y-nn)}else{const hr=(nr.left-lr)*Ft.scale-Xt+Zr[0],zr=(-nr.top-lr)*Ft.scale+Zr[1],dn=hr+nn,pn=zr+di;ve=new kt(hr,zr),xe=new kt(dn,zr),at=new kt(hr,pn),Ht=new kt(dn,pn)}if(Et){let hr;hr=Ue?new kt(0,0):yn?new kt(Lt[0],Lt[1]):new kt(Oe[0],Oe[1]),ve._rotateAround(Et,hr),xe._rotateAround(Et,hr),at._rotateAround(Et,hr),Ht._rotateAround(Et,hr)}const Yt=new kt(0,0),Kt=new kt(0,0);qt.push({tl:ve,tr:xe,bl:at,br:Ht,texPrimary:gr,texSecondary:void 0,writingMode:Me.writingMode,glyphOffset:Fr,sectionIndex:Ft.sectionIndex,isSDF:Ot,pixelOffsetTL:Yt,pixelOffsetBR:Kt,minFontScaleX:0,minFontScaleY:0})}}return qt})(0,u,E,p,g,w,h,a.allowVerticalPlacement),he=a.textSizeData;let ge=null;he.kind==="source"?(ge=[jh*p.layout.get("text-size").evaluate(w,{},J)*$.textScaleFactor],ge[0]>yp&&fn(`${a.layerIds[0]}: Value for "text-size" is >= ${ny}. Reduce your "text-size".`)):he.kind==="composite"&&(ge=[jh*$.compositeTextSizes[0].evaluate(w,{},J)*$.textScaleFactor,jh*$.compositeTextSizes[1].evaluate(w,{},J)*$.textScaleFactor],(ge[0]>yp||ge[1]>yp)&&fn(`${a.layerIds[0]}: Value for "text-size" is >= ${ny}. Reduce your "text-size".`)),a.addSymbols(a.text,de,ge,E,g,w,O,e,i,P.lineStartIndex,P.lineLength,U,X,J,ie,!1);for(const Fe of D)L[Fe]=a.text.placedSymbolArray.length-1;return 4*de.length}function V1(a){for(const e in a)return a[e];return null}function cx(a,e,i,u,h,p,g,w,E,P){let O=g.top,D=g.bottom,L=g.left,U=g.right;if(wM(g)&&g.collisionPadding){const $=g.collisionPadding;L-=$[0],O-=$[1],U+=$[2],D+=$[3]}if(E){const $=new kt(L,O),X=new kt(U,O),J=new kt(L,D),ie=new kt(U,D),de=Cn(E);let he=new kt(0,0);P&&(he=new kt(P[0],P[1])),$._rotateAround(de,he),X._rotateAround(de,he),J._rotateAround(de,he),ie._rotateAround(de,he),L=Math.min($.x,X.x,J.x,ie.x),U=Math.max($.x,X.x,J.x,ie.x),O=Math.min($.y,X.y,J.y,ie.y),D=Math.max($.y,X.y,J.y,ie.y)}return a.emplaceBack(e.x,e.y,e.z,i.x,i.y,L,O,U,D,w,u,h,p),a.length-1}function $1(a){wM(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const e=a.bottom-a.top;return e>0?Math.max(10,e):null}function a6(a,e,i,u){const h=a.compareText;if(e in h){const p=h[e];for(let g=p.length-1;g>=0;g--)if(u.dist(p[g])<i)return!0}else h[e]=[];return h[e].push(u),!1}function HM(a,e){const i=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*e:0,h=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),p=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-a._pitch-i,.01));let g=Math.sin(a._pitch)*p+h;const w=h*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let E=Math.max(a.zoom-17,0);a.isOrthographic&&(E/=10),g*=1+E}return Math.min(1.01*g,w)}function iy(a,e){if(!e.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:e};const i=Math.pow(2,-a.z),u=a.x*i,h=(a.x+1)*i,p=a.y*i,g=(a.y+1)*i,w=ce(u),E=ce(h),P=me(p),O=me(g),D=e.project(w,P),L=e.project(E,P),U=e.project(E,O),$=e.project(w,O);let X=Math.min(D.x,L.x,U.x,$.x),J=Math.min(D.y,L.y,U.y,$.y),ie=Math.max(D.x,L.x,U.x,$.x),de=Math.max(D.y,L.y,U.y,$.y);const he=i/16;function ge(Me,Oe,je,Ue,ut,Ze){const _t=(je+ut)/2,qt=(Ue+Ze)/2,Et=e.project(ce(_t),me(qt)),Lt=Math.max(0,X-Et.x,J-Et.y,Et.x-ie,Et.y-de);X=Math.min(X,Et.x),ie=Math.max(ie,Et.x),J=Math.min(J,Et.y),de=Math.max(de,Et.y),Lt>he&&(ge(Me,Et,je,Ue,_t,qt),ge(Et,Oe,_t,qt,ut,Ze))}ge(D,L,u,p,h,p),ge(L,U,h,p,h,g),ge(U,$,h,g,u,g),ge($,D,u,g,u,p),X-=he,J-=he,ie+=he,de+=he;const Fe=1/Math.max(ie-X,de-J);return{scale:Fe,x:X*Fe,y:J*Fe,x2:ie*Fe,y2:de*Fe,projection:e}}function WM(a,{x:e,y:i},u=0){return new kt(((e-u)*a.scale-a.x)*Wt,(i*a.scale-a.y)*Wt)}const s6=H(new Float32Array(16));class vp{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new z(0,0)}projectTilePoint(e,i,u){return{x:e,y:i,z:0}}locationPoint(e,i,u,h=!0){return e._coordinatePoint(e.locationCoordinate(i,u),h)}pixelsPerMeter(e,i){return te(1,e)*i}pixelSpaceConversion(e,i,u){return 1}farthestPixelDistance(e){return HM(e,e.pixelsPerMeter)}pointCoordinate(e,i,u,h){const p=e.horizonLineFromTop(!1),g=new kt(i,Math.max(p,u));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,h))}pointCoordinate3D(e,i,u){const h=new kt(i,u);if(e.elevation)return e.elevation.pointCoordinate(h);{const p=this.pointCoordinate(e,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const u=e.horizonLineFromTop();return i.y<u}createInversionMatrix(e,i){return s6}createTileMatrix(e,i,u){let h,p,g;const w=u.canonical,E=H(new Float64Array(16));if(this.isReprojectedInTileSpace){const P=iy(w,this);h=1,p=P.x+u.wrap*P.scale,g=P.y,ue(E,E,[h/P.scale,h/P.scale,e.pixelsPerMeter/i])}else h=i/e.zoomScale(w.z),p=(w.x+Math.pow(2,w.z)*u.wrap)*h,g=w.y*h;return fe(E,E,[p,g,0]),ue(E,E,[h/Wt,h/Wt,1]),E}upVector(e,i,u){return[0,0,1]}upVectorScale(e,i,u){return{metersToTile:1}}}class l6 extends vp{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,u]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(Cn(i));this.n=(h+Math.sin(Cn(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:u,c:h,r0:p}=this,g=Cn(e-this.center[0]),w=Cn(i),E=Math.sqrt(h-2*u*Math.sin(w))/u;return{x:E*Math.sin(g*u),y:E*Math.cos(g*u)-p,z:0}}unproject(e,i){const{n:u,c:h,r0:p}=this,g=p+i;let w=Math.atan2(e,Math.abs(g))*Math.sign(g);g*u<0&&(w-=Math.PI*Math.sign(e)*Math.sign(g));const E=Cn(this.center[0])*u;w=it(w,-Math.PI-E,Math.PI-E);const P=we(et(w/u)+this.center[0],-180,180),O=Math.asin(we((h-(e*e+g*g)*u*u)/(2*u),-1,1)),D=we(et(O),-Ee,Ee);return new z(P,D)}}const oy=1.340264,ay=-.081106,sy=893e-6,ly=.003796,ux=Math.sqrt(3)/2;class c6 extends vp{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const u=Math.asin(ux*Math.sin(i)),h=u*u,p=h*h*h;return{x:.5*(e*Math.cos(u)/(ux*(oy+3*ay*h+p*(7*sy+9*ly*h)))/Math.PI+.5),y:1-.5*(u*(oy+ay*h+p*(sy+ly*h))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let u=i=(2*(1-i)-1)*Math.PI,h=u*u,p=h*h*h;for(let O,D,L,U=0;U<12&&(D=u*(oy+ay*h+p*(sy+ly*h))-i,L=oy+3*ay*h+p*(7*sy+9*ly*h),O=D/L,u=we(u-O,-Math.PI/3,Math.PI/3),h=u*u,p=h*h*h,!(Math.abs(O)<1e-12));++U);const g=ux*e*(oy+3*ay*h+p*(7*sy+9*ly*h))/Math.cos(u),w=Math.asin(Math.sin(u)/ux),E=we(180*g/Math.PI,-180,180),P=we(180*w/Math.PI,-Ee,Ee);return new z(E,P)}}class u6 extends vp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const u=360*(e-.5),h=we(360*(.5-i),-Ee,Ee);return new z(u,h)}}const xg=Math.PI/2;function hx(a){return Math.tan((xg+a)/2)}class h6 extends vp{constructor(e){super(e),this.center=e.center||[0,30];const[i,u]=this.parallels=e.parallels||[30,30];let h=Cn(i),p=Cn(u);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const g=Math.cos(h),w=hx(h);this.n=h===p?Math.sin(h):Math.log(g/Math.cos(p))/Math.log(hx(p)/w),this.f=g*Math.pow(hx(h),this.n)/this.n}project(e,i){i=Cn(i),this.southernCenter&&(i=-i),e=Cn(e-this.center[0]);const u=1e-6,{n:h,f:p}=this;p>0?i<-xg+u&&(i=-xg+u):i>xg-u&&(i=xg-u);const g=p/Math.pow(hx(i),h);let w=g*Math.sin(h*e),E=p-g*Math.cos(h*e);return w=.5*(w/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:w,y:this.southernCenter?E:1-E,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:u,f:h}=this,p=h-i,g=Math.sign(p),w=Math.sign(u)*Math.sqrt(e*e+p*p);let E=Math.atan2(e,Math.abs(p))*g;p*u<0&&(E-=Math.PI*Math.sign(e)*g);const P=we(et(E/u)+this.center[0],-180,180),O=we(et(2*Math.atan(Math.pow(h/w,1/u))-xg),-Ee,Ee);return new z(P,this.southernCenter?-O:O)}}class ZM extends vp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Y(e),y:re(i),z:0}}unproject(e,i){const u=ce(e),h=me(i);return new z(u,h)}}const XM=Cn(Ee);class f6 extends vp{project(e,i){const u=(i=Cn(i))*i,h=u*u;return{x:.5*((e=Cn(e))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let u=i=(2*(1-i)-1)*Math.PI,h=25,p=0,g=u*u;do{g=u*u;const P=g*g;p=(u*(1.007226+g*(.015085+P*(.028874*g-.044475-.005916*P)))-i)/(1.007226+g*(.045255+P*(.259866*g-.311325-.005916*11*P))),u=we(u-p,-XM,XM)}while(Math.abs(p)>1e-6&&--h>0);g=u*u;const w=we(et(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),E=et(u);return new z(w,E)}}const KM=Cn(Ee);class d6 extends vp{project(e,i){i=Cn(i),e=Cn(e);const u=Math.cos(i),h=2/Math.PI,p=Math.acos(u*Math.cos(e/2)),g=Math.sin(p)/p,w=.5*(e*h+2*u*Math.sin(e/2)/g)||0,E=.5*(i+Math.sin(i)/g)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(e,i){let u=e=(2*e-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,p=25;const g=1e-6;let w=0,E=0;do{const P=Math.cos(h),O=Math.sin(h),D=2*O*P,L=O*O,U=P*P,$=Math.cos(u/2),X=Math.sin(u/2),J=2*$*X,ie=X*X,de=1-U*$*$,he=de?1/de:0,ge=de?Math.acos(P*$)*Math.sqrt(1/de):0,Fe=.5*(2*ge*P*X+2*u/Math.PI)-e,Me=.5*(ge*O+h)-i,Oe=.5*he*(U*ie+ge*P*$*L)+1/Math.PI,je=he*(J*D/4-ge*O*X),Ue=.125*he*(D*X-ge*O*U*J),ut=.5*he*(L*$+ge*ie*P)+.5,Ze=je*Ue-ut*Oe;w=(Me*je-Fe*ut)/Ze,E=(Fe*Ue-Me*Oe)/Ze,u=we(u-w,-Math.PI,Math.PI),h=we(h-E,-KM,KM)}while((Math.abs(w)>g||Math.abs(E)>g)&&--p>0);return new z(et(u),et(h))}}class YM extends vp{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Cn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:u,cosPhi:h}=this;return{x:Cn(e)*h*u+.5,y:-Math.sin(Cn(i))/h*u+.5,z:0}}unproject(e,i){const{scale:u,cosPhi:h}=this,p=-(i-.5)/u,g=we(et((e-.5)/u)/h,-180,180),w=Math.asin(we(p*h,-1,1)),E=we(et(w),-Ee,Ee);return new z(g,E)}}class p6 extends ZM{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,u){const h=mr(e,i,u);return Ar(h,h,$r(W(u))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,i,u){const h=A(i.lat,i.lng),p=Tr([],h),g=u?e._centerAltitude+u:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;mt(h,h,p,te(1,0)*Wt*g);const w=H(new Float64Array(16));return ae(w,e.pixelMatrix,e.globeMatrix),Ar(h,h,w),new kt(h[0],h[1])}pixelsPerMeter(e,i){return te(1,0)*i}pixelSpaceConversion(e,i,u){const h=te(1,e)*i,p=Sr(te(1,45)*i,h,u);return this.pixelsPerMeter(e,i)/p}createTileMatrix(e,i,u){const h=Kr(W(u.canonical));return ae(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,i){const{center:u}=e,h=$r(W(i));return le(h,h,Cn(u.lng)),_e(h,h,Cn(u.lat)),ue(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,i,u,h){return b(e,i,u,!0)||new Ie(0,0)}pointCoordinate3D(e,i,u){const h=this.pointCoordinate(e,i,u,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,i){return!b(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=(function(h,p){const g=h.cameraToCenterDistance,w=h._centerAltitude*p,E=h._camera,P=h._camera.forward(),O=gt([],qe([],P,-g),[0,0,w]),D=h.worldSize/(2*Math.PI),L=[0,0,-D],U=h.width/h.height,$=Math.tan(h.fovAboveCenter),X=qe([],E.up(),$),J=qe([],E.right(),$*U),ie=Tr([],gt([],gt([],P,X),J)),de=[];let he;if(new Sn(O,ie).closestPointOnSphere(L,D,de)){const ge=gt([],de,L),Fe=In([],ge,O);he=Math.cos(h.fovAboveCenter)*ft(Fe)}else{const ge=In([],O,L),Fe=In([],L,O);Tr(Fe,Fe);const Me=ft(ge)-D;he=Math.sqrt(Me*(Me+2*D));const Oe=Math.acos(he/(D+Me))-Math.acos(vr(P,Fe));he*=Math.cos(Oe)}return 1.01*he})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),u=pt(e.zoom);if(u>0){const h=HM(e,te(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Sr(i,h+p*(1-Math.cos(g)),Math.pow(u,10))}return i}upVector(e,i,u){return mr(i,u,e,1)}upVectorScale(e){return{metersToTile:Hf(br(W(e)))}}}function JM(a){const e=a.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(a.name){case"mercator":return new ZM(a);case"equirectangular":return new u6(a);case"naturalEarth":return new f6(a);case"equalEarth":return new c6(a);case"winkelTripel":return new d6(a);case"albers":return i?new YM(a):new l6(a);case"lambertConformalConic":return i?new YM(a):new h6(a);case"globe":return new p6(a)}throw new Error(`Invalid projection name: ${a.name}`)}const m6=tt.types,g6=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fx(a,e,i,u,h,p,g,w,E,P,O,D,L){const U=w?Math.min(yp,Math.round(w[0])):0,$=w?Math.min(yp,Math.round(w[1])):0;a.emplaceBack(e,i,Math.round(32*u),Math.round(32*h),p,g,(U<<1)+(E?1:0),$,16*P,16*O,256*D,256*L)}function dx(a,e,i){a.emplaceBack(e,i)}function px(a,e,i,u,h,p,g){a.emplaceBack(e,i,u,h,p,g)}const mx=(a,e,i,u)=>{for(let h=0;h<e;h++)a.emplaceBack(i[0],i[1],i[2],u[0],u[1],u[2])};function gx(a,e,i,u,h){a.emplaceBack(e,i,u,h),a.emplaceBack(e,i,u,h),a.emplaceBack(e,i,u,h),a.emplaceBack(e,i,u,h)}function _6(a){for(const e of a.sections)if(Df(e.text))return!0;return!1}class q1{constructor(e){this.layoutVertexArray=new Wa,this.indexArray=new ai,this.programConfigurations=e,this.segments=new Si,this.dynamicLayoutVertexArray=new Vs,this.opacityVertexArray=new Kd,this.placedSymbolArray=new Lh,this.iconTransitioningVertexArray=new $s,this.globeExtVertexArray=new zc,this.zOffsetVertexArray=new Lu,this.orientationVertexArray=new Qd}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,u,h,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,w$.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,T$.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,g6,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,P$.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,S$.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,E$.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,A$.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}ir(q1,"SymbolBuffers");class G1{constructor(e,i,u){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new u,this.segments=new Si,this.collisionVertexArray=new Fc,this.collisionVertexArrayExt=new Vs}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,I$.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,C$.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ir(G1,"CollisionBuffers");class _x{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((g=>g.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=H([]),this.placementViewportMatrix=H([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=PM(this.zoom,i["text-size"],this.worldview),this.iconSizeData=PM(this.zoom,i["icon-size"],this.worldview);const u=this.layers[0].layout,h=u.get("symbol-sort-key"),p=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map((g=>Xs[g])),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new q1(new Za(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new q1(new Za(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new qf,this.lineVertexArray=new nm,this.symbolInstances=new ip}calculateGlyphDependencies(e,i,u,h,p){for(const g of e){const w=g.codePointAt(0);if(w===void 0)break;if(i[w]=!0,h&&p&&w<=65535){const E=J_[g];E&&(i[E.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Hv(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(e,i,u,h){const p=this.layers[0],g=p.layout,w=this.projection.name==="globe",E=g.get("text-font"),P=g.get("text-field"),O=g.get("icon-image"),[D,L]=g.get("icon-size-scale-range"),U=we(i.scaleFactor||1,D,L),$=(P.value.kind!=="constant"||P.value.value instanceof ha&&!P.value.value.isEmpty()||P.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),X=O.value.kind!=="constant"||!!O.value.value||Object.keys(O.parameters).length>0,J=g.get("symbol-sort-key");if(this.features=[],!$&&!X)return;const ie=i.iconDependencies,de=i.glyphDependencies,he=i.availableImages,ge=new Un(this.zoom,{worldview:this.worldview});for(const{feature:Fe,id:Me,index:Oe,sourceLayerIndex:je}of e){const Ue=p._featureFilter.needGeometry,ut=ot(Fe,Ue);if(!p._featureFilter.filter(ge,ut,u))continue;if(Ue||(ut.geometry=ze(Fe,u,h)),w&&Fe.type!==1&&u.z<=5){const Lt=ut.geometry,Ut=.98078528056,lt=(zt,Qe)=>vr(mr(zt.x,zt.y,u,1),mr(Qe.x,Qe.y,u,1))<Ut;for(let zt=0;zt<Lt.length;zt++)Lt[zt]=rt(Lt[zt],lt)}let Ze,_t;if($){const Lt=p.getValueAndResolveTokens("text-field",ut,u,he),Ut=ha.factory(Lt);_6(Ut)&&(this.hasRTLText=!0),(!this.hasRTLText||Lf()==="unavailable"||this.hasRTLText&&hs.isParsed())&&(Ze=O$(Ut,p,ut))}if(X){const Lt=p.getValueAndResolveTokens("icon-image",ut,u,he);_t=typeof Lt=="string"?Ia.build(Lt):Lt}if(!Ze&&!_t)continue;const qt=this.sortFeaturesByKey?J.evaluate(ut,{},u):void 0,Et={id:Me,text:Ze,icon:_t,index:Oe,sourceLayerIndex:je,geometry:ut.geometry,properties:Fe.properties,type:m6[Fe.type],sortKey:qt};if(this.features.push(Et),_t){const Lt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Ut,iconSecondary:lt}=VM(_t,this.iconSizeData,Lt["icon-size"],u,this.zoom,Et,this.pixelRatio,U,this.worldview),zt=Ut.id.toString();if(ie.has(zt)?ie.get(zt).push(Ut):ie.set(zt,[Ut]),lt){this.hasAnySecondaryIcon=!0;const Qe=lt.id.toString();ie.has(Qe)?ie.get(Qe).push(lt):ie.set(Qe,[lt])}}if(Ze){const Lt=E.evaluate(ut,{},u).join(","),Ut=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Xs.vertical)>=0;for(const lt of Ze.sections)if(lt.image){const zt=lt.image.getPrimary().scaleSelf(this.pixelRatio),Qe=zt.id.toString(),ct=ie.get(Qe)||[];ct.push(zt),ie.set(Qe,ct)}else{const zt=xl(Ze.toString()),Qe=lt.fontStack||Lt,ct=de[Qe]=de[Qe]||{};this.calculateGlyphDependencies(lt.text,ct,Ut,this.allowVerticalPlacement,zt)}}}if(g.get("symbol-placement")==="line"&&(this.features=(function(Fe){const Me={},Oe={},je=[];let Ue=0;function ut(Et){je.push(Fe[Et]),Ue++}function Ze(Et,Lt,Ut){const lt=Oe[Et];return delete Oe[Et],Oe[Lt]=lt,je[lt].geometry[0].pop(),je[lt].geometry[0]=je[lt].geometry[0].concat(Ut[0]),lt}function _t(Et,Lt,Ut){const lt=Me[Lt];return delete Me[Lt],Me[Et]=lt,je[lt].geometry[0].shift(),je[lt].geometry[0]=Ut[0].concat(je[lt].geometry[0]),lt}function qt(Et,Lt,Ut){const lt=Ut?Lt[0][Lt[0].length-1]:Lt[0][0];return`${Et}:${lt.x}:${lt.y}`}for(let Et=0;Et<Fe.length;Et++){const Lt=Fe[Et],Ut=Lt.geometry,lt=Lt.text?Lt.text.toString():null;if(!lt){ut(Et);continue}const zt=qt(lt,Ut),Qe=qt(lt,Ut,!0);if(zt in Oe&&Qe in Me&&Oe[zt]!==Me[Qe]){const ct=_t(zt,Qe,Ut),Gt=Ze(zt,Qe,je[ct].geometry);delete Me[zt],delete Oe[Qe],Oe[qt(lt,je[Gt].geometry,!0)]=Gt,je[ct].geometry=null}else zt in Oe?Ze(zt,Qe,Ut):Qe in Me?_t(zt,Qe,Ut):(ut(Et),Me[zt]=Ue-1,Oe[Qe]=Ue-1)}return je.filter((Et=>Et.geometry))})(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Fe of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Fe.id,this.elevationFeatures.length),this.elevationFeatures.push(Fe)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((Fe,Me)=>Fe.sortKey-Me.sortKey))}update(e,i,u,h,p,g,w){this.text.programConfigurations.updatePaintArrays(e,i,p,u,h,g,w,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,p,u,h,g,w,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const u=Pe(e),h=1/u;let p=!1,g=!1;for(let w=0;w<this.symbolInstances.length;w++){const E=this.symbolInstances.get(w),P=bt(1,0,0),O=bt(0,1,0),{numHorizontalGlyphVertices:D,numVerticalGlyphVertices:L,numIconVertices:U,numVerticalIconVertices:$}=E,X=D>0||L>0,J=U>0,ie=this.elevationFeatures[E.elevationFeatureIndex];if(ie){const de=new kt(E.tileAnchorX,E.tileAnchorY),he=.075+ie.pointElevation(de);E.zOffset!==he&&(i=!0,E.zOffset=he);const ge=ie.computeSlopeNormal(de,h),Fe=nl(Bo(),bt(0,0,1),ge);sr(P,P,Fe),sr(O,O,Fe),P[2]*=u,O[2]*=u,P[0]===1&&P[1]===0&&P[2]===0&&O[0]===0&&O[1]===1&&O[2]===0||(p=p||X,g=g||J)}if(X&&(mx(this.text.orientationVertexArray,D,P,O),mx(this.text.orientationVertexArray,L,P,O)),J){const{placedIconSymbolIndex:de,verticalPlacedIconSymbolIndex:he}=E;de>=0&&mx(this.icon.orientationVertexArray,U,P,O),he>=0&&mx(this.icon.orientationVertexArray,$,P,O)}}p||(this.text.orientationVertexArray=void 0),g||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(p,g,w)=>{u+=g,u>p.length&&p.resize(u);for(let E=-g;E<0;E++)p.emplace(E+u,w)},i=(p,g,w)=>{h+=g,h>p.length&&p.resize(h);for(let E=-g;E<0;E++)p.emplace(E+h,w)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,h=0;for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p),{numHorizontalGlyphVertices:w,numVerticalGlyphVertices:E,numIconVertices:P}=g,O=g.zOffset,D=P>0;if((w>0||E>0)&&(e(this.text.zOffsetVertexArray,w,O),e(this.text.zOffsetVertexArray,E,O)),D){const{placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:U}=g;L>=0&&i(this.icon.zOffsetVertexArray,P,O),U>=0&&i(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,O)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=JM(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const u=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:p}of i)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(e,i,u,h,p,g,w,E,P,O,D,L,U,$,X,J){const ie=e.indexArray,de=e.layoutVertexArray,he=e.globeExtVertexArray,ge=e.segments.prepareSegment(4*i.length,de,ie,this.canOverlap?g.sortKey:void 0),Fe=this.glyphOffsetArray.length,Me=ge.vertexLength,Oe=this.allowVerticalPlacement&&w===Xs.vertical?Math.PI/2:0,je=g.text&&g.text.sections;for(let ut=0;ut<i.length;ut++){const{tl:Ze,tr:_t,bl:qt,br:Et,texPrimary:Lt,texSecondary:Ut,pixelOffsetTL:lt,pixelOffsetBR:zt,minFontScaleX:Qe,minFontScaleY:ct,glyphOffset:Gt,isSDF:Ft,sectionIndex:gr}=i[ut],lr=ge.vertexLength,Ot=Gt[1];if(fx(de,P.x,P.y,Ze.x,Ot+Ze.y,Lt.x,Lt.y,u,Ft,lt.x,lt.y,Qe,ct),fx(de,P.x,P.y,_t.x,Ot+_t.y,Lt.x+Lt.w,Lt.y,u,Ft,zt.x,lt.y,Qe,ct),fx(de,P.x,P.y,qt.x,Ot+qt.y,Lt.x,Lt.y+Lt.h,u,Ft,lt.x,zt.y,Qe,ct),fx(de,P.x,P.y,Et.x,Ot+Et.y,Lt.x+Lt.w,Lt.y+Lt.h,u,Ft,zt.x,zt.y,Qe,ct),E){const{x:Nt,y:fr,z:tr}=E.anchor,[Xt,nr,Cr]=E.up;px(he,Nt,fr,tr,Xt,nr,Cr),px(he,Nt,fr,tr,Xt,nr,Cr),px(he,Nt,fr,tr,Xt,nr,Cr),px(he,Nt,fr,tr,Xt,nr,Cr),gx(e.dynamicLayoutVertexArray,Nt,fr,tr,Oe)}else gx(e.dynamicLayoutVertexArray,P.x,P.y,P.z,Oe);if(J){const Nt=Ut||Lt;dx(e.iconTransitioningVertexArray,Nt.x,Nt.y),dx(e.iconTransitioningVertexArray,Nt.x+Nt.w,Nt.y),dx(e.iconTransitioningVertexArray,Nt.x,Nt.y+Nt.h),dx(e.iconTransitioningVertexArray,Nt.x+Nt.w,Nt.y+Nt.h)}ie.emplaceBack(lr,lr+1,lr+2),ie.emplaceBack(lr+1,lr+2,lr+3),ge.vertexLength+=4,ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Gt[0]),ut!==i.length-1&&gr===i[ut+1].sectionIndex||e.programConfigurations.populatePaintArrays(de.length,g,g.index,{},U,$,X,je&&je[gr],this.worldview)}const Ue=E?E.anchor:P;e.placedSymbolArray.emplaceBack(Ue.x,Ue.y,Ue.z,P.x,P.y,Fe,this.glyphOffsetArray.length-Fe,Me,O,D,P.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],w,0,0,0,L,0)}_commitLayoutVertex(e,i,u,h,p,g,w){e.emplaceBack(i,u,h,p,g,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(e,i,u,h,p,g,w){const E=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),P=E.vertexLength,O=w.tileAnchorX,D=w.tileAnchorY;for(let U=0;U<4;U++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,i,e.padding,w.zOffset),this._commitLayoutVertex(u.layoutVertexArray,h,p,g,O,D,new kt(e.x1,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,p,g,O,D,new kt(e.x2,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,p,g,O,D,new kt(e.x2,e.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,p,g,O,D,new kt(e.x1,e.y2)),E.vertexLength+=4;const L=u.indexArray;L.emplaceBack(P,P+1),L.emplaceBack(P+1,P+2),L.emplaceBack(P+2,P+3),L.emplaceBack(P+3,P),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,u,h,p,g){for(let w=h;w<p;w++){const E=u.get(w),P=this.getSymbolInstanceTextSize(e,g,i,w);this._addCollisionDebugVertices(E,P,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,i,u,h,p,g){for(let w=h;w<p;w++){const E=u.get(w),P=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(E,P,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,i,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new G1(Oh,fM.members,$s),this.iconCollisionBox=new G1(Oh,fM.members,$s);const h=ey(this.iconSizeData,e),p=ey(this.textSizeData,e,u);for(let g=0;g<this.symbolInstances.length;g++){const w=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(p,e,i,w.textBoxStartIndex,w.textBoxEndIndex,w),this._addTextDebugCollisionBoxes(p,e,i,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w),this._addIconDebugCollisionBoxes(h,e,i,w.iconBoxStartIndex,w.iconBoxEndIndex,w),this._addIconDebugCollisionBoxes(h,e,i,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w)}}getSymbolInstanceTextSize(e,i,u,h){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),g=F1(this.textSizeData,e,p)/Jo;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,i,u){const h=this.icon.placedSymbolArray.get(u),p=F1(this.iconSizeData,e,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,i,u,h){e.emplaceBack(i,-u,-u,h),e.emplaceBack(i,u,-u,h),e.emplaceBack(i,u,u,h),e.emplaceBack(i,-u,u,h)}_updateTextDebugCollisionBoxes(e,i,u,h,p,g,w){for(let E=h;E<p;E++){const P=u.get(E),O=this.getSymbolInstanceTextSize(e,g,i,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,O,P.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(e,i,u,h,p,g,w){for(let E=h;E<p;E++){const P=u.get(E),O=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,O,P.padding,g.zOffset)}}updateCollisionDebugBuffers(e,i,u,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=ey(this.iconSizeData,e,h),g=ey(this.textSizeData,e,u);for(let w=0;w<this.symbolInstances.length;w++){const E=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(g,e,i,E.textBoxStartIndex,E.textBoxEndIndex,E,u),this._updateTextDebugCollisionBoxes(g,e,i,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,u),this._updateIconDebugCollisionBoxes(p,e,i,E.iconBoxStartIndex,E.iconBoxEndIndex,E,h),this._updateIconDebugCollisionBoxes(p,e,i,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,u,h,p,g,w,E,P){const O={};if(i<u){const{x1:D,y1:L,x2:U,y2:$,padding:X,projectedAnchorX:J,projectedAnchorY:ie,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:ge,featureIndex:Fe}=e.get(i);O.textBox={x1:D,y1:L,x2:U,y2:$,padding:X,projectedAnchorX:J,projectedAnchorY:ie,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:ge},O.textFeatureIndex=Fe}if(h<p){const{x1:D,y1:L,x2:U,y2:$,padding:X,projectedAnchorX:J,projectedAnchorY:ie,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:ge,featureIndex:Fe}=e.get(h);O.verticalTextBox={x1:D,y1:L,x2:U,y2:$,padding:X,projectedAnchorX:J,projectedAnchorY:ie,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:ge},O.verticalTextFeatureIndex=Fe}if(g<w){const{x1:D,y1:L,x2:U,y2:$,padding:X,projectedAnchorX:J,projectedAnchorY:ie,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:ge,featureIndex:Fe}=e.get(g);O.iconBox={x1:D,y1:L,x2:U,y2:$,padding:X,projectedAnchorX:J,projectedAnchorY:ie,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:ge},O.iconFeatureIndex=Fe}if(E<P){const{x1:D,y1:L,x2:U,y2:$,padding:X,projectedAnchorX:J,projectedAnchorY:ie,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:ge,featureIndex:Fe}=e.get(E);O.verticalIconBox={x1:D,y1:L,x2:U,y2:$,padding:X,projectedAnchorX:J,projectedAnchorY:ie,projectedAnchorZ:de,tileAnchorX:he,tileAnchorY:ge},O.verticalIconFeatureIndex=Fe}return O}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const u=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const u=e.placedSymbolArray.get(i),h=u.vertexStartIndex+4*u.numGlyphs;for(let p=u.vertexStartIndex;p<h;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),u=Math.cos(e),h=[],p=[],g=[];for(let w=0;w<this.symbolInstances.length;++w){g.push(w);const E=this.symbolInstances.get(w);h.push(0|Math.round(i*E.tileAnchorX+u*E.tileAnchorY)),p.push(E.featureIndex)}return g.sort(((w,E)=>h[w]-h[E]||p[E]-p[w])),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,i){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===i?u.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const u=this.symbolInstances.get(i);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:P}=u;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),P>=0&&this.addIndicesForPlacedSymbol(this.icon,P)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let QM,eO,H1;ir(_x,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),_x.addDynamicAttributes=gx;class tO{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ah,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ir(tO,"FormatSectionOverride",{omit:["defaultValue"]});const W1=()=>H1||(H1={layout:QM||(QM=new Ai({"symbol-placement":new Ct(Ge.layout_symbol["symbol-placement"]),"symbol-spacing":new Ct(Ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ct(Ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Qt(Ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ct(Ge.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ct(Ge.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Ct(Ge.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Ct(Ge.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ct(Ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ct(Ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ct(Ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new Qt(Ge.layout_symbol["icon-size"]),"icon-size-scale-range":new Ct(Ge.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Qt(Ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qt(Ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new Qt(Ge.layout_symbol["icon-image"]),"icon-rotate":new Qt(Ge.layout_symbol["icon-rotate"]),"icon-padding":new Ct(Ge.layout_symbol["icon-padding"]),"icon-keep-upright":new Ct(Ge.layout_symbol["icon-keep-upright"]),"icon-offset":new Qt(Ge.layout_symbol["icon-offset"]),"icon-anchor":new Qt(Ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ct(Ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ct(Ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ct(Ge.layout_symbol["text-rotation-alignment"]),"text-field":new Qt(Ge.layout_symbol["text-field"]),"text-font":new Qt(Ge.layout_symbol["text-font"]),"text-size":new Qt(Ge.layout_symbol["text-size"]),"text-size-scale-range":new Ct(Ge.layout_symbol["text-size-scale-range"]),"text-max-width":new Qt(Ge.layout_symbol["text-max-width"]),"text-line-height":new Qt(Ge.layout_symbol["text-line-height"]),"text-letter-spacing":new Qt(Ge.layout_symbol["text-letter-spacing"]),"text-justify":new Qt(Ge.layout_symbol["text-justify"]),"text-radial-offset":new Qt(Ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ct(Ge.layout_symbol["text-variable-anchor"]),"text-anchor":new Qt(Ge.layout_symbol["text-anchor"]),"text-max-angle":new Ct(Ge.layout_symbol["text-max-angle"]),"text-writing-mode":new Ct(Ge.layout_symbol["text-writing-mode"]),"text-rotate":new Qt(Ge.layout_symbol["text-rotate"]),"text-padding":new Ct(Ge.layout_symbol["text-padding"]),"text-keep-upright":new Ct(Ge.layout_symbol["text-keep-upright"]),"text-transform":new Qt(Ge.layout_symbol["text-transform"]),"text-offset":new Qt(Ge.layout_symbol["text-offset"]),"text-allow-overlap":new Ct(Ge.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ct(Ge.layout_symbol["text-ignore-placement"]),"text-optional":new Ct(Ge.layout_symbol["text-optional"]),visibility:new Ct(Ge.layout_symbol.visibility)})),paint:eO||(eO=new Ai({"icon-opacity":new Qt(Ge.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Qt(Ge.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Qt(Ge.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Qt(Ge.paint_symbol["text-emissive-strength"]),"icon-color":new Qt(Ge.paint_symbol["icon-color"]),"icon-halo-color":new Qt(Ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new Qt(Ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Qt(Ge.paint_symbol["icon-halo-blur"]),"icon-translate":new Ct(Ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ct(Ge.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ct(Ge.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Qt(Ge.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Qt(Ge.paint_symbol["text-occlusion-opacity"]),"text-color":new Qt(Ge.paint_symbol["text-color"],{runtimeType:Ua,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Qt(Ge.paint_symbol["text-halo-color"]),"text-halo-width":new Qt(Ge.paint_symbol["text-halo-width"]),"text-halo-blur":new Qt(Ge.paint_symbol["text-halo-blur"]),"text-translate":new Ct(Ge.paint_symbol["text-translate"]),"text-translate-anchor":new Ct(Ge.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ct(Ge.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ct(Ge.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ct(Ge.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ct(Ge.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Qt(Ge.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},H1);class yx extends Zo{constructor(e,i,u,h){super(e,W1(),i,u,h),this._colorAdjustmentMatrix=H([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const h=[];for(const p of u)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,u,h){return this._saturation===e&&this._contrast===i&&this._brightnessMin===u&&this._brightnessMax===h||(this._colorAdjustmentMatrix=(function(p,g,w,E){p=ea(p),g=no(g);const P=ee(),O=p/3,D=1-2*O,L=[D,O,O,0,O,D,O,0,O,O,D,0,0,0,0,1],U=.5-.5*g,$=E-w;return ae(P,[$,0,0,0,0,$,0,0,0,0,$,0,w,w,w,1],[g,0,0,0,0,g,0,0,0,0,g,0,U,U,U,1]),ae(P,P,L),P})(e,i,u,h),this._saturation=e,this._contrast=i,this._brightnessMin=u,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,u,h){const p=this.layout.get(e).evaluate(i,{},u,h),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||Nd(g.value)||!p?p:(function(w,E){return E.replace(/{([^{}]+)}/g,((P,O)=>O in w?String(w[O]):""))})(i.properties,p)}createBucket(e){return new _x(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of W1().paint.overridableProperties){if(!yx.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),u=new tO(i),h=new Oc(u,i.property.specification,this.scope,this.options);let p=null;p=i.value.kind==="constant"||i.value.kind==="source"?new Eu("source",h):new cs("composite",h,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Ns(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,u){return!(!this.layout||i.isDataDriven()||u.isDataDriven())&&yx.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const u=e.get("text-field"),h=W1().paint.properties[i];let p=!1;const g=w=>{for(const E of w)if(h.overrides&&h.overrides.hasOverride(E))return void(p=!0)};if(u.value.kind==="constant"&&u.value.value instanceof ha)g(u.value.value.sections);else if(u.value.kind==="source"){const w=P=>{p||(P instanceof Ir&&er(P.value)===sh?g(P.value.sections):P instanceof cu?g(P.sections):P.eachChild(w))},E=u.value;E._styleExpression&&w(E._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,u){return{config:new co(this,{zoom:i,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let rO,nO,iO,oO;var Z1=mn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function vx(a,e,i,u,h,p,g,w){const E=[a,e,1,i,u,1,h,p,1],P=[g,w,1],O=G([],E),[D,L,U]=un(P,P,O);return K(E,E,[D,0,0,0,L,0,0,0,U])}function aO(a,e,i,u,h,p,g,w){const E=(function(P,O,D,L,U,$,X,J){const ie=vx(0,0,1,0,1,1,0,1),de=vx(P,O,D,L,U,$,X,J);return K(de,de,G([],ie))})(a,e,i,u,h,p,g,w);return[E[2]/E[8]/Wt,E[5]/E[8]/Wt]}function xx(a){return[a[0],Math.min(Math.max(a[1],-Ee),Ee)]}class sO extends _c{constructor(e,i,u,h){super(),this.id=e,this.dispatcher=u,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new cl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Il(this.map._requestManager.transformRequest(this.url,gs.Image),((u,h)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new Co(u)):h&&(this.image=h instanceof HTMLImageElement?ps.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new X_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new cl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof X_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],u=e[0][1];for(const p of e)p[1]>u&&(u=p[1]),p[1]<i&&(i=p[1]);const h=(u+i)/2;if(h>Ee?this.onNorthPole=!0:h<-Ee&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=e.map(Ie.fromLngLat);this.tileID=(function(g){let w=1/0,E=1/0,P=-1/0,O=-1/0;for(const X of g)w=Math.min(w,X.x),E=Math.min(E,X.y),P=Math.max(P,X.x),O=Math.max(O,X.y);const D=Math.max(P-w,O-E),L=Math.max(0,Math.floor(-Math.log(D)/Math.LN2)),U=Math.pow(2,L);let $=Math.floor((w+P)/2*U);return $>1&&($-=1),new _a(L,$,Math.floor((E+O)/2*U))})(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new cl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof X_||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const ie in this.tiles){const de=this.tiles[ie];de.state!=="loaded"&&(de.state="loaded",de.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=iy(new _a(0,0,0),this.map.transform.projection),u=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(ie){const de=ie[1].x-ie[0].x,he=ie[1].y-ie[0].y,ge=ie[2].x-ie[1].x,Fe=ie[2].y-ie[1].y,Me=ie[3].x-ie[2].x,Oe=ie[3].y-ie[2].y,je=ie[0].x-ie[3].x,Ue=ie[0].y-ie[3].y,ut=de*Fe-ge*he,Ze=ge*Oe-Me*Fe,_t=Me*Ue-je*Oe,qt=je*he-de*Ue;return ut>0&&Ze>0&&_t>0&&qt>0||ut<0&&Ze<0&&_t<0&&qt<0})(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=iy(this.tileID,this.map.transform.projection),[p,g,w,E]=this.coordinates.map((ie=>{const de=h.projection.project(ie[0],ie[1]);return WM(h,de)._round()}));this.perspectiveTransform=aO(p.x,p.y,g.x,g.y,w.x,w.y,E.x,E.y);const P=this._boundsArray=new ku;P.emplaceBack(p.x,p.y,0,0),P.emplaceBack(g.x,g.y,Wt,0),P.emplaceBack(E.x,E.y,0,Wt),P.emplaceBack(w.x,w.y,Wt,Wt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(P,Z1.members),this.boundsSegments=Si.simpleSegment(0,0,4,2);const O=[],D=[xx((L=this.coordinates)[0]),xx(L[1]),xx(L[2]),xx(L[3])];var L;const[U,$,X,J]=(function(ie){let de=ie[0][0],he=de,ge=ie[0][1],Fe=ge;for(let Me=1;Me<ie.length;Me++)ie[Me][0]<de?de=ie[Me][0]:ie[Me][0]>he&&(he=ie[Me][0]),ie[Me][1]<ge?ge=ie[Me][1]:ie[Me][1]>Fe&&(Fe=ie[Me][1]);return[de,ge,he-de,Fe-ge]})(D);{const ie=new ku,[de,he,ge,Fe]=(function(lt){let zt=lt[0].x,Qe=zt,ct=lt[0].y,Gt=ct;for(let Ft=1;Ft<lt.length;Ft++)lt[Ft].x<zt?zt=lt[Ft].x:lt[Ft].x>Qe&&(Qe=lt[Ft].x),lt[Ft].y<ct?ct=lt[Ft].y:lt[Ft].y>Gt&&(Gt=lt[Ft].y);return[zt,ct,Qe-zt,Gt-ct]})(u),Me=lt=>[(lt.x-de)/ge,(lt.y-he)/Fe],[Oe,je,Ue,ut]=u.map(Me),Ze=(function(lt,zt,Qe,ct,Gt,Ft,gr,lr){const Ot=vx(0,0,1,0,1,1,0,1);return K(Ot,Ot,G([],vx(lt,zt,Qe,ct,Gt,Ft,gr,lr)))})(Oe[0],Oe[1],je[0],je[1],Ue[0],Ue[1],ut[0],ut[1]);this.elevatedGlobePerspectiveTransform=aO(Oe[0],Oe[1],je[0],je[1],Ue[0],Ue[1],ut[0],ut[1]);const _t=(lt,zt)=>{O.push(lt.lng);const Qe=Math.round((lt.lng-U)/X*Wt),ct=Math.round((lt.lat-$)/J*Wt),Gt=Me(zt),Ft=un([],[Gt[0],Gt[1],1],Ze),gr=Math.round(Ft[0]/Ft[2]*Wt),lr=Math.round(Ft[1]/Ft[2]*Wt);ie.emplaceBack(Qe,ct,gr,lr)},qt=u[3].x-u[0].x,Et=u[3].y-u[0].y,Lt=u[2].x-u[1].x,Ut=u[2].y-u[1].y;for(let lt=0;lt<65;lt++){const zt=lt/64,Qe=[u[0].x+zt*qt,u[0].y+zt*Et],ct=[u[1].x+zt*Lt,u[1].y+zt*Ut],Gt=ct[0]-Qe[0],Ft=ct[1]-Qe[1];for(let gr=0;gr<65;gr++){const lr=gr/64,Ot={x:Qe[0]+Gt*lr,y:Qe[1]+Ft*lr};_t(i.projection.unproject(Ot.x,Ot.y),Ot)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(ie,Z1.members)}{this.maxLongitudeTriangleSize=0;let ie=[],de=new ai;const he=(ge,Fe,Me)=>{de.emplaceBack(ge,Fe,Me);const Oe=O[ge],je=O[Fe],Ue=O[Me],ut=Math.min(Math.min(Oe,je),Ue),Ze=Math.max(Math.max(Oe,je),Ue)-ut;Ze>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ze),ie.push(ut+Ze/2)};for(let ge=0;ge<64;ge++)for(let Fe=0;Fe<64;Fe++){const Me=65*ge+Fe,Oe=Me+1,je=Me+65,Ue=je+1;he(Me,je,Oe),he(Oe,je,Ue)}[ie,de]=(function(ge,Fe){const Me=Array.from({length:ge.length},((Ue,ut)=>ut));Me.sort(((Ue,ut)=>ge[Ue]-ge[ut]));const Oe=[],je=new ai;for(let Ue=0;Ue<Me.length;Ue++){const ut=Me[Ue];Oe.push(ge[ut]);const Ze=3*ut,_t=Ze+1;je.emplaceBack(Fe.uint16[Ze],Fe.uint16[_t],Fe.uint16[_t+1])}return[Oe,je]})(ie,de),this.elevatedGlobeTrianglesCenterLongitudes=ie,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(de)}this.elevatedGlobeSegments=Si.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,X/Wt,0,J/Wt,0,0,$,U,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,u=i.gl;!this._dirty||this.texture instanceof X_||(this.texture?this.texture.update(this.image):(this.texture=new S1(i,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let h=(p=e+180)+360*Math.round((u[0]-p)/360);var p;const g=new Si,w=(D,L)=>{g.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:i.segments[0].vertexLength,primitiveLength:L,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-h)<=E){const D=ao(u,0,u.length,h+E);return D===u.length||w(D,_i(u,D+1,u.length,h+360-E)-D),g}h<u[0]&&(h+=360);const P=_i(u,0,u.length,h-E);if(P===u.length)return w(0,u.length),g;w(0,P-0);const O=ao(u,P+1,u.length,h+E);return O!==u.length&&w(O,u.length-O),g}}const y6=(Math.pow(256,2)-1)/16907520;class lO extends Zo{constructor(e,i,u,h){super(e,{layout:iO||(iO=new Ai({visibility:new Ct(Ge.layout_raster.visibility)})),paint:oO||(oO=new Ai({"raster-opacity":new Ct(Ge.paint_raster["raster-opacity"]),"raster-color":new Rc(Ge.paint_raster["raster-color"]),"raster-color-mix":new Ct(Ge.paint_raster["raster-color-mix"]),"raster-color-range":new Ct(Ge.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ct(Ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ct(Ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ct(Ge.paint_raster["raster-brightness-max"]),"raster-saturation":new Ct(Ge.paint_raster["raster-saturation"]),"raster-contrast":new Ct(Ge.paint_raster["raster-contrast"]),"raster-resampling":new Ct(Ge.paint_raster["raster-resampling"]),"raster-fade-duration":new Ct(Ge.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ct(Ge.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ct(Ge.paint_raster["raster-array-band"]),"raster-elevation":new Ct(Ge.paint_raster["raster-elevation"]),"raster-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},i,u,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof sO&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[u,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(h)||u===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=k_({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,h])}}let cO,uO,hO,fO,dO;class pO extends Zo{constructor(e,i,u,h){super(e,{layout:cO||(cO=new Ai({visibility:new Ct(Ge["layout_raster-particle"].visibility)})),paint:uO||(uO=new Ai({"raster-particle-array-band":new Ct(Ge["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ct(Ge["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Rc(Ge["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ct(Ge["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ct(Ge["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ct(Ge["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ct(Ge["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ct(Ge["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},i,u,h),this._updateColorRamp(),this.lastInvalidatedAt=ps.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=k_({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ps.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class v6 extends Zo{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function X1(a,e,i){const u=[0,0,1],h=Ba([]);return tl(h,h,i?-Cn(a)+Math.PI:Cn(a)),Os(h,h,-Cn(e)),sr(u,u,h),Tr(u,u)}const mO={None:0,Model:1,Symbol:2,FillExtrusion:4};class bx{constructor(e,i,u,h){this.message=(e?`${e}: `:"")+u,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function K1(a,e){const i=a.indexOf("://")===-1;try{return new URL(a,i&&e?"http://example.com":void 0),!0}catch{return!1}}class gO{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class _O{constructor(){this.instancedDataArray=new Uf,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Y1{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,u,h){this.tileToMeter=Pe(u);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:w,index:E,sourceLayerIndex:P}of e){const O=w??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),D=ot(g,p);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{worldview:this.worldview}),D,u))continue;const L={id:O,sourceLayerIndex:P,index:E,geometry:p?D.geometry:ze(g,u,h),properties:g.properties,type:g.type,patterns:{}},U=this.addFeature(L,L.geometry,D);U&&i.featureIndex.insert(g,L.geometry,E,P,this.index,this.instancesPerModel[U].instancedDataArray.length,Wt/32)}this.lookup=null}update(e,i,u,h){for(const p in this.instancesPerModel){const g=this.instancesPerModel[p];for(const w in e)g.idToFeaturesIndex.hasOwnProperty(w)&&(this.evaluate(g.features[g.idToFeaturesIndex[w]],e[w],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const u=this.instancesPerModel[i];for(const h of u.features){const p=this.layers[0],g=h.feature,w=this.canonical,E=p.paint.get("model-rotation").evaluate(g,{},w),P=p.paint.get("model-scale").evaluate(g,{},w),O=p.paint.get("model-translation").evaluate(g,{},w);Rn(h.rotation,E)&&Rn(h.scale,P)&&Rn(h.translation,O)||(this.evaluate(h,h.featureStates,u,!0),e=!0)}}return e}updateReplacement(e,i,u,h){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const p=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Hv(this.activeReplacements,p))return!1;this.activeReplacements=p;let g=!1;for(const w in this.instancesPerModel){const E=this.instancesPerModel[w],P=E.instancedDataArray;for(const O of E.features){const D=O.instancedDataOffset,L=O.instancedDataCount;for(let U=0;U<L;U++){const $=16*(U+D);let X=P.float32[$+0];const J=X>Wt;X=J?X-Wt:X;const ie=Math.floor(X),de=P.float32[$+1];let he=!1;for(const ge of this.activeReplacements)if(!iC(ge,u,mO.Model,h)&&!(ge.min.x>ie||ie>ge.max.x||ge.min.y>de||de>ge.max.y)&&(he=h1(lC(ie,de,e.canonical,ge.footprintTileId.canonical),ge.footprint),he))break;P.float32[$]=he?X+Wt:X,g=g||he!==J}}}return g}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const u=this.instancesPerModel[i];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=e.createVertexBuffer(u.instancedDataArray,JV.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const u=this.instancesPerModel[i];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,u){const h=this.layers[0],p=h.layout.get("model-id").evaluate(u,{},this.canonical);if(!p)return fn(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),p;(K1(p,!1)||this.styleDefinedModelURLs[p]!==void 0)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new _O);const g=this.instancesPerModel[p],w=g.instancedDataArray,E=new gO(u,w.length);for(const P of i)for(const O of P){if(O.x<0||O.x>=Wt||O.y<0||O.y>=Wt)continue;const D=(this.lookupDim-1)/Wt,L=this.lookupDim*(O.y*D|0)+O.x*D|0;if(this.lookup){if(this.lookup[L]!==0)continue;this.lookup[L]=1}this.instanceCount++;const U=w.length;w.resize(U+1),g.instancesEvaluatedElevation.push(0),w.float32[16*U]=O.x,w.float32[16*U+1]=O.y}return E.instancedDataCount=g.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(e.id&&(g.idToFeaturesIndex[e.id]=g.features.length),g.features.push(E),this.evaluate(E,{},g,!1)),p}getModelUris(){return this.modelUris}evaluate(e,i,u,h){const p=this.layers[0],g=e.feature,w=this.canonical,E=e.rotation=p.paint.get("model-rotation").evaluate(g,i,w),P=e.scale=p.paint.get("model-scale").evaluate(g,i,w),O=e.translation=p.paint.get("model-translation").evaluate(g,i,w),D=p.paint.get("model-color").evaluate(g,i,w);D.a=p.paint.get("model-color-mix-intensity").evaluate(g,i,w);const L=[];this.maxVerticalOffset<O[2]&&(this.maxVerticalOffset=O[2]),this.maxScale=Math.max(Math.max(this.maxScale,P[0]),Math.max(P[1],P[2])),$C(L,E,P);const U=Math.round(100*D.a)+D.b/1.05;for(let $=0;$<e.instancedDataCount;++$){const X=e.instancedDataOffset+$,J=16*X,ie=u.instancedDataArray.float32;let de=0;h&&(de=ie[J+6]-u.instancesEvaluatedElevation[X]);const he=0|ie[J+1];ie[J]=(0|ie[J])+D.r/1.05,ie[J+1]=he+D.g/1.05,ie[J+2]=U,ie[J+3]=1/(w.z>10?this.tileToMeter:Pe(w,he)),ie[J+4]=O[0],ie[J+5]=O[1],ie[J+6]=O[2]+de,ie[J+7]=L[0],ie[J+8]=L[1],ie[J+9]=L[2],ie[J+10]=L[4],ie[J+11]=L[5],ie[J+12]=L[6],ie[J+13]=L[8],ie[J+14]=L[9],ie[J+15]=L[10],u.instancesEvaluatedElevation[X]=O[2]}}}let yO,vO;ir(Y1,"ModelBucket",{omit:["layers"]}),ir(_O,"PerModelAttributes"),ir(gO,"ModelFeature");class bg{constructor(e,i,u){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=u}static create(e,i,u){const h=u||e.findDEMTileFor(i);if(!h||!h.dem)return;const p=h.dem,g=h.tileID,w=1<<i.canonical.z-g.canonical.z;return new bg(h,p.dim/Wt/w,[(i.canonical.x/w-g.canonical.x)*p.dim,(i.canonical.y/w-g.canonical.y)*p.dim])}tileCoordToPixel(e,i){const u=i*this._scale+this._offset[1];return new kt(Math.floor(e*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(e,i,u,h){const p=e*this._scale+this._offset[0],g=i*this._scale+this._offset[1],w=Math.floor(p),E=Math.floor(g),P=this._dem;return h=!!h,u?Sr(Sr(P.get(w,E,h),P.get(w,E+1,h),g-E),Sr(P.get(w+1,E,h),P.get(w+1,E+1,h),g-E),p-w):P.get(w,E,h)}getElevationAtPixel(e,i,u){return this._dem.get(e,i,!!u)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*te(1,e)*this._dem.stride}}const J1=new Float32Array(262144),ym=new Uint8Array(262144);function xO(a){let e=0;if(a.meshes)for(const i of a.meshes)e=Math.max(e,i.aabb.max[2]);if(a.children)for(const i of a.children)e=Math.max(e,xO(i));return e}function bO(a,e,i){if(a.meshes)for(const u of a.meshes){if(u.aabb.min[0]===1/0)continue;const h=Rr.applyTransform(u.aabb,a.matrix);i.insert(e,h.min[0],h.min[1],h.max[0],h.max[1])}if(a.children)for(const u of a.children)bO(u,e,i)}const wO=["","wall","door","roof","window","lamp","logo"];class SO{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:xO(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==e&&(u.transformedAabb=Rr.applyTransformFast(u.aabb,this.node.matrix),i.encapsulate(u.transformedAabb)),e++;this.aabb=i}return this.aabb}}class wx{constructor(e,i,u,h,p,g,w,E){this.id=u,this.layers=e,this.layerIds=this.layers.map((P=>P.fqid)),this.stateDependentLayerIds=this.layers.filter((P=>P.isStateDependent())).map((P=>P.id)),this.modelTraits|=mg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=mg.HasMapboxMeshFeatures),p&&(this.modelTraits|=mg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.worldview=E,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const P of i)this.nodesInfo.push(new SO(P)),bO(P,w.featureIndexArray.length,w.grid),w.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,w.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const u of this.getNodesInfo()){const h=u.node;h.footprint&&i.push({footprint:h.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const u=i?this.stateDependentLayers:this.layers;if(!sl(e,this.states))for(const h of u)this.evaluate(h,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const u of i){const h=u.node;this.uploaded?this.updatePbrBuffer(h):A1(h,e,!0)}for(const u of i)rx(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const u of e.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),i=!0);return i}needsReEvaluation(e,i,u){const h=e.transform.projectionOptions,p=e.style.getBrightness(),g=this.brightness!==p;if(!this.uploaded||this.dirty||h.name!==this.projection.name||cy(u.paint.get("model-color").value,g)||cy(u.paint.get("model-color-mix-intensity").value,g)||cy(u.paint.get("model-roughness").value,g)||cy(u.paint.get("model-emissive-strength").value,g)||cy(u.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=h,this.brightness=p;const w=this.getNodesInfo();for(const E of w)E.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const u=this.getNodesInfo(),h=this.id.canonical;for(const p of u){const g=p.feature;p.evaluatedTranslation=i.paint.get("model-translation").evaluate(g,{},h),p.evaluatedScale=i.paint.get("model-scale").evaluate(g,{},h)}}evaluate(e,i){const u=this.getNodesInfo();for(const h of u){if(!h.node.meshes)continue;const p=h.feature,g=i&&i[p.id];if(sl(g,h.state))continue;h.state=structuredClone(g);const w=h.node.meshes&&h.node.meshes[0].featureData,E=h.evaluatedColor[2],P=h.evaluatedRMEA[2],O=this.id.canonical;if(h.hasTranslucentParts=!1,w){for(let D=0;D<wO.length;D++){const L=wO[D];L.length&&(p.properties.part=L);const U=e.paint.get("model-color").evaluate(p,g,O).toPremultipliedRenderColor(null),$=e.paint.get("model-color-mix-intensity").evaluate(p,g,O);h.evaluatedColor[D]=[U.r,U.g,U.b,$],h.evaluatedRMEA[D][0]=e.paint.get("model-roughness").evaluate(p,g,O),h.evaluatedRMEA[D][2]=e.paint.get("model-emissive-strength").evaluate(p,g,O),h.evaluatedRMEA[D][3]=U.a,h.emissionHeightBasedParams[D]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,g,O),!h.hasTranslucentParts&&U.a<1&&(h.hasTranslucentParts=!0)}delete p.properties.part,b6(h,E!==h.evaluatedColor[2]||P!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(p,g,O);h.evaluatedTranslation=e.paint.get("model-translation").evaluate(p,g,O),h.evaluatedScale=e.paint.get("model-scale").evaluate(p,g,O),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,u,h){const p=e.findDEMTileFor(u);if(p&&(p.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const g=bg.create(e,u,p);if(!g)return;this.modelTraits&mg.HasMapboxMeshFeatures&&this.updateDEM(e,g,u,h);for(const w of this.getNodesInfo()){const E=w.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const P=E.footprint.vertices;let O=g.getElevationAt(P[0].x,P[0].y,!0,!0);for(let D=1;D<P.length;D++)O=Math.min(O,g.getElevationAt(P[D].x,P[D].y,!0,!0));E.elevation=O}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,u,h){let p=i._dem._modifiedForSources[h];if(p===void 0&&(i._dem._modifiedForSources[h]=[],p=i._dem._modifiedForSources[h]),p.includes(u.canonical))return;const g=i._dem.dim;p.push(u.canonical);let w=!1;for(const E of this.getNodesInfo()){const P=E.node;if(!P.footprint||!P.footprint.grid)continue;const O=P.footprint.grid,D=i.tileCoordToPixel(O.min.x,O.min.y),L=i.tileCoordToPixel(O.max.x,O.max.y),U=Math.min(Math.min(g-L.y,D.x),Math.min(D.y,g-L.x));if(U<0)continue;const $=we(U,2,5);let X=Math.max(0,D.x-$),J=Math.max(0,D.y-$),ie=Math.min(L.x+$,g-1),de=Math.min(L.y+$,g-1);for(let Me=J;Me<=de;++Me)for(let Oe=X;Oe<=ie;++Oe)ym[Me*g+Oe]=255;let he=0,ge=0;for(let Me=0;Me<O.cellsY;++Me)for(let Oe=0;Oe<O.cellsX;++Oe){if(!O.cells[Me*O.cellsX+Oe])continue;const je=i.tileCoordToPixel(O.min.x+Oe/O.xScale,O.min.y+Me/O.yScale),Ue=i.tileCoordToPixel(O.min.x+(Oe+1)/O.xScale,O.min.y+(Me+1)/O.yScale);for(let ut=je.y;ut<=Math.min(Ue.y+1,g-1);++ut)for(let Ze=je.x;Ze<=Math.min(Ue.x+1,g-1);++Ze)ym[ut*g+Ze]===255&&(ym[ut*g+Ze]=0,he+=i.getElevationAtPixel(Ze,ut),ge++)}const Fe=he/ge;X=Math.max(1,D.x-$),J=Math.max(1,D.y-$),ie=Math.min(L.x+$,g-2),de=Math.min(L.y+$,g-2),w=!0;for(let Me=J;Me<=de;++Me)for(let Oe=X;Oe<=ie;++Oe)ym[Me*g+Oe]===0&&(J1[Me*g+Oe]=i._dem.set(Oe,Me,Fe));for(let Me=1;Me<$;++Me){X=Math.max(1,D.x-Me),J=Math.max(1,D.y-Me),ie=Math.min(L.x+Me,g-2),de=Math.min(L.y+Me,g-2);for(let Oe=J;Oe<=de;++Oe)for(let je=X;je<=ie;++je){const Ue=Oe*g+je;if(ym[Ue]===255){let ut=0,Ze=0,_t=-1,qt=-1;for(let Et=-1;Et<=1;++Et)for(let Lt=-1;Lt<=1;++Lt){const Ut=(Oe+Et)*g+je+Lt;if(ym[Ut]>=Me)continue;const lt=J1[Ut],zt=Math.abs(lt);zt>Ze&&(ut=lt,Ze=zt,_t=Lt,qt=Et)}if(Ze>.1){const Et=1-(Me+.5*Math.abs(_t*qt))/$;let Lt=i._dem.get(je,Oe)+ut*Et;const Ut=i._dem.get(je+_t,Oe+qt),lt=i._dem.get(je-_t,Oe-qt,!0);(Lt-Ut)*(Lt-lt)>0&&(Lt=(Ut+lt)/2),J1[Ue]=i._dem.set(je,Oe,Lt),ym[Ue]=Me}}}}}w&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ps.now())}setFilter(e){this.filter=e?Dc(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new Un(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)rx(i.node),P1(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());for(const h of this.getNodesInfo()){const p=h.node.footprint;h.hiddenByReplacement=!!p&&!u.find((g=>g.footprint===p))}}getHeightAtTileCoord(e,i){const u=[],h=[0,0,0],p=H([]);for(const g of this.getNodesInfo()){const w=g.node.meshes[0],E=w.transformedAabb;if(e<E.min[0]||i<E.min[1]||e>E.max[0]||i>E.max[1])continue;if(g.node.hidden===!0)return{height:1/0,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};Z(p,g.node.matrix),h[0]=e,h[1]=i,Ar(h,h,p);const P=(h[0]-w.aabb.min[0])/(w.aabb.max[0]-w.aabb.min[0])*mm|0,O=Math.min(63,(h[1]-w.aabb.min[1])/(w.aabb.max[1]-w.aabb.min[1])*mm|0)*mm+Math.min(63,P),D=w.heightmap[O];if(!(D<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:D,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new kt(e,i),new kt(e,i),u),u.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function cy(a,e){return a instanceof Eu&&!a.isLightConstant&&e}function x6(a,e,i,u,h,p,g,w){let E=(61440&e|(61440&e)>>4)>>8,P=(3840&e|(3840&e)>>4)>>4,O=240&e|(240&e)>>4;i[3]>0&&(E=Sr(E,255*i[0],i[3]),P=Sr(P,255*i[1],i[3]),O=Sr(O,255*i[2],i[3]));const D=E<<8|P,L=O<<8|Math.floor(255*u[3]),U=(function(Me){const Oe=we(Me,0,2);return Math.min(Math.round(.5*Oe*255),255)})(u[2])<<8|15*u[0]<<4|15*u[1],$=we(h[0],0,1),X=we(h[1],0,1),J=we(h[2],0,1),ie=we(h[3],0,1);let de,he,ge,Fe;if($!==X&&g!==p&&X!==$){const Me=g-p;he=1/(Me*(X-$)),ge=-(p+Me*$)/(Me*(X-$));const Oe=we(h[4],-1,1);Fe=Math.pow(10,Oe),de=255*J<<8|255*ie}else de=65535,he=0,ge=1,Fe=1;if(a.emplaceBack(D,L,U,de,he,ge,Fe),w){const Me=w.length;w.clear();for(let Oe=0;Oe<Me;Oe++)w.emplaceBack(D,L,U,de,he,ge,Fe)}}function b6(a,e,i){const u=a.node;let h=0;const p=i&mg.HasMeshoptCompression;for(const g of u.meshes){if(u.lights&&u.lightMeshIndex===h||!g.featureData)continue;g.featureArray=new zu,g.featureArray.reserve(g.featureData.length);let w=e;for(const E of g.featureData){const P=p?65535&E:E>>16&65535,O=p?E>>16&65535:65535&E,D=(15&O)<8?15&O:0,L=a.evaluatedRMEA[D],U=a.evaluatedColor[D],$=a.emissionHeightBasedParams[D];let X;if(w&&D===2&&u.lights&&(X=new zu,X.resize(10*u.lights.length)),x6(g.featureArray,P,U,L,$,g.aabb.min[2],g.aabb.max[2],X),X&&w){w=!1;const J=u.meshes[u.lightMeshIndex];J.featureArray=X,J.featureArray._trim()}}g.featureArray._trim(),h++}}function TO(a,e,i,u){const h=1<<a.z;e.lat=me((u/Wt+a.y)/h),e.lng=ce((i/Wt+a.x)/h)}function w6(a,e,i,u){const h=a.getNodesInfo()[e];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let p=Number.MAX_VALUE;const g=h.node,w=i.tile,E=u.calculatePosMatrix(w.tileID.toUnwrapped(),u.worldSize),P=h.evaluatedScale;let O=0;u.elevation&&g.elevation&&(O=g.elevation*u.elevation.exaggeration()),fe(E,E,[(g.anchor?g.anchor[0]:0)*(P[0]-1),(g.anchor?g.anchor[1]:0)*(P[1]-1),O]),ue(E,E,P);const D=i.queryGeometry,L=D.isPointQuery()?D.screenBounds:D.screenGeometry,U=function(X){const J=ae([],E,X.matrix);ae(J,u.expandedFarZProjMatrix,J);for(let ie=0;ie<X.meshes.length;++ie){const de=X.meshes[ie];if(ie===X.lightMeshIndex)continue;const he=qC(L,u,J,de.aabb);he!=null&&(p=Math.min(he,p))}if(X.children)for(const ie of X.children)U(ie)};if(U(g),p===Number.MAX_VALUE)return;const $=new z(0,0);return TO(w.tileID.canonical,$,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:p,position:$,feature:h.feature}}ir(wx,"Tiled3dModelBucket",{omit:["layers"]}),ir(SO,"Tiled3dModelFeature");const S6={circle:class extends Zo{constructor(a,e,i,u){super(a,{layout:jc||(jc=new Ai({"circle-sort-key":new Qt(Ge.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Ct(Ge.layout_circle["circle-elevation-reference"]),visibility:new Ct(Ge.layout_circle.visibility)})),paint:Bu||(Bu=new Ai({"circle-radius":new Qt(Ge.paint_circle["circle-radius"]),"circle-color":new Qt(Ge.paint_circle["circle-color"]),"circle-blur":new Qt(Ge.paint_circle["circle-blur"]),"circle-opacity":new Qt(Ge.paint_circle["circle-opacity"]),"circle-translate":new Ct(Ge.paint_circle["circle-translate"]),"circle-translate-anchor":new Ct(Ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ct(Ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ct(Ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Qt(Ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Qt(Ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Qt(Ge.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ct(Ge.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u)}createBucket(a){return new zn(a)}queryRadius(a){const e=a;return uo("circle-radius",this,e)+uo("circle-stroke-width",this,e)+Pi(this.paint.get("circle-translate"))}queryIntersectsFeature(a,e,i,u,h,p,g,w){const E=Kl(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,a.pixelToTileUnitsFactor),P=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Ri(a,u,p,g,w,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,P)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,e,i){const u=sa(this);return{config:new co(this,{zoom:e,lut:i}),defines:u,overrideFog:!1}}is3D(a){return!a&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Zo{createBucket(a){return new DI(a)}constructor(a,e,i,u){super(a,{layout:kI||(kI=new Ai({visibility:new Ct(Ge.layout_heatmap.visibility)})),paint:LI||(LI=new Ai({"heatmap-radius":new Qt(Ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Qt(Ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ct(Ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Rc(Ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ct(Ge.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=k_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(a){return uo("heatmap-radius",this,a)}queryIntersectsFeature(a,e,i,u,h,p,g,w){const E=this.paint.get("heatmap-radius").evaluate(e,i);return Ri(a,u,p,g,w,!0,!0,new kt(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,e,i){return a==="heatmap"?{config:new co(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Zo{constructor(a,e,i,u){super(a,{layout:zI||(zI=new Ai({visibility:new Ct(Ge.layout_hillshade.visibility)})),paint:FI||(FI=new Ai({"hillshade-illumination-direction":new Ct(Ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ct(Ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ct(Ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ct(Ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ct(Ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ct(Ge.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ct(Ge.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,e,i){return{overrideFog:!1}}},fill:class extends Zo{constructor(a,e,i,u){super(a,{layout:JI||(JI=new Ai({"fill-sort-key":new Qt(Ge.layout_fill["fill-sort-key"]),visibility:new Ct(Ge.layout_fill.visibility),"fill-elevation-reference":new Ct(Ge.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Qt(Ge.layout_fill["fill-construct-bridge-guard-rail"])})),paint:QI||(QI=new Ai({"fill-antialias":new Ct(Ge.paint_fill["fill-antialias"]),"fill-opacity":new Qt(Ge.paint_fill["fill-opacity"]),"fill-color":new Qt(Ge.paint_fill["fill-color"]),"fill-outline-color":new Qt(Ge.paint_fill["fill-outline-color"]),"fill-translate":new Ct(Ge.paint_fill["fill-translate"]),"fill-translate-anchor":new Ct(Ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new Qt(Ge.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Ct(Ge.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Ct(Ge.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Qt(Ge.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Qt(Ge.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Qt(Ge.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u)}getProgramIds(){const a=this.paint.get("fill-pattern"),e=a&&a.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(a,e,i){return{config:new co(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(a,e){super.recalculate(a,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new l1(a)}queryRadius(){return Pi(this.paint.get("fill-translate"))}queryIntersectsFeature(a,e,i,u,h,p){return!a.queryGeometry.isAboveHorizon&&ti(Ka(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?e&&!a:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Zo{constructor(a,e,i,u){super(a,{layout:wC||(wC=new Ai({visibility:new Ct(Ge["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ct(Ge["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:SC||(SC=new Ai({"fill-extrusion-opacity":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Qt(Ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Qt(Ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Qt(Ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Qt(Ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Qt(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Qt(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Qt(Ge["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Qt(Ge["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ct(Ge["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Zv(a)}queryRadius(){return Pi(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,e,i,u,h,p,g,w,E){const P=Kl(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,a.pixelToTileUnitsFactor),O=this.paint.get("fill-extrusion-height").evaluate(e,i),D=this.paint.get("fill-extrusion-base").evaluate(e,i),L=[0,0],U=w&&p.elevation,$=p.elevation?p.elevation.exaggeration():1,X=a.tile.getBucket(this);if(U&&X instanceof Zv){const ge=X.centroidVertexArray,Fe=E+1;Fe<ge.length&&(L[0]=ge.geta_centroid_pos0(Fe),L[1]=ge.geta_centroid_pos1(Fe))}if(L[0]===0&&L[1]===1)return!1;p.projection.name==="globe"&&(u=bC([u],[new kt(0,0),new kt(Wt,Wt)],a.tileID.canonical).map((ge=>ge.polygon)).flat());const J=U?w:null,[ie,de]=(function(ge,Fe,Me,Oe,je,Ue,ut,Ze,_t,qt,Et){return ge.projection.name==="globe"?(function(Lt,Ut,lt,zt,Qe,ct,Gt,Ft,gr,lr,Ot){const Nt=[],fr=[],tr=Lt.projection.upVectorScale(Ot,Lt.center.lat,Lt.worldSize).metersToTile,Xt=[0,0,0,1],nr=[0,0,0,1],Cr=(Zr,qr,yn,nn)=>{Zr[0]=qr,Zr[1]=yn,Zr[2]=nn,Zr[3]=1},Fr=xC();lt>0&&(lt+=Fr),zt+=Fr;for(const Zr of Ut){const qr=[],yn=[];for(const nn of Zr){const di=nn.x+Qe.x,ve=nn.y+Qe.y,xe=Lt.projection.projectTilePoint(di,ve,Ot),at=Lt.projection.upVector(Ot,nn.x,nn.y);let Ht=lt,Yt=zt;if(Gt){const Kt=CC(di,ve,lt,zt,Gt,Ft,gr,lr);Ht+=Kt.base,Yt+=Kt.top}lt!==0?Cr(Xt,xe.x+at[0]*tr*Ht,xe.y+at[1]*tr*Ht,xe.z+at[2]*tr*Ht):Cr(Xt,xe.x,xe.y,xe.z),Cr(nr,xe.x+at[0]*tr*Yt,xe.y+at[1]*tr*Yt,xe.z+at[2]*tr*Yt),Ar(Xt,Xt,ct),Ar(nr,nr,ct),qr.push(new dm(Xt[0],Xt[1],Xt[2])),yn.push(new dm(nr[0],nr[1],nr[2]))}Nt.push(qr),fr.push(yn)}return[Nt,fr]})(ge,Fe,Me,Oe,je,Ue,ut,Ze,_t,qt,Et):ut?(function(Lt,Ut,lt,zt,Qe,ct,Gt,Ft,gr){const lr=[],Ot=[],Nt=[0,0,0,1];for(const fr of Lt){const tr=[],Xt=[];for(const nr of fr){const Cr=nr.x+zt.x,Fr=nr.y+zt.y,Zr=CC(Cr,Fr,Ut,lt,ct,Gt,Ft,gr);Nt[0]=Cr,Nt[1]=Fr,Nt[2]=Zr.base,Nt[3]=1,Vi(Nt,Nt,Qe),Nt[3]=Math.max(Nt[3],1e-5);const qr=new dm(Nt[0]/Nt[3],Nt[1]/Nt[3],Nt[2]/Nt[3]);Nt[0]=Cr,Nt[1]=Fr,Nt[2]=Zr.top,Nt[3]=1,Vi(Nt,Nt,Qe),Nt[3]=Math.max(Nt[3],1e-5);const yn=new dm(Nt[0]/Nt[3],Nt[1]/Nt[3],Nt[2]/Nt[3]);tr.push(qr),Xt.push(yn)}lr.push(tr),Ot.push(Xt)}return[lr,Ot]})(Fe,Me,Oe,je,Ue,ut,Ze,_t,qt):(function(Lt,Ut,lt,zt,Qe){const ct=[],Gt=[],Ft=Qe[8]*Ut,gr=Qe[9]*Ut,lr=Qe[10]*Ut,Ot=Qe[11]*Ut,Nt=Qe[8]*lt,fr=Qe[9]*lt,tr=Qe[10]*lt,Xt=Qe[11]*lt;for(const nr of Lt){const Cr=[],Fr=[];for(const Zr of nr){const qr=Zr.x+zt.x,yn=Zr.y+zt.y,nn=Qe[0]*qr+Qe[4]*yn+Qe[12],di=Qe[1]*qr+Qe[5]*yn+Qe[13],ve=Qe[2]*qr+Qe[6]*yn+Qe[14],xe=Qe[3]*qr+Qe[7]*yn+Qe[15],at=nn+Ft,Ht=di+gr,Yt=ve+lr,Kt=Math.max(xe+Ot,1e-5),hr=nn+Nt,zr=di+fr,dn=ve+tr,pn=Math.max(xe+Xt,1e-5);Cr.push(new dm(at/Kt,Ht/Kt,Yt/Kt)),Fr.push(new dm(hr/pn,zr/pn,dn/pn))}ct.push(Cr),Gt.push(Fr)}return[ct,Gt]})(Fe,Me,Oe,je,Ue)})(p,u,D,O,P,g,J,L,$,p.center.lat,a.tileID.canonical),he=a.queryGeometry;return(function(ge,Fe,Me){let Oe=1/0;ti(Me,Fe)&&(Oe=IC(Me,Fe[0]));for(let je=0;je<Fe.length;je++){const Ue=Fe[je],ut=ge[je];for(let Ze=0;Ze<Ue.length-1;Ze++){const _t=Ue[Ze],qt=[_t,Ue[Ze+1],ut[Ze+1],ut[Ze],_t];Wn(Me,qt)&&(Oe=Math.min(Oe,IC(Me,qt)))}}return Oe!==1/0&&Oe})(ie,de,he.isPointQuery()?he.screenBounds:he.screenGeometry)}},building:class extends Zo{constructor(a,e,i,u){super(a,{layout:QC||(QC=new Ai({visibility:new Ct(Ge.layout_building.visibility),"building-facade":new Qt(Ge.layout_building["building-facade"]),"building-facade-floors":new Qt(Ge.layout_building["building-facade-floors"]),"building-facade-window":new Qt(Ge.layout_building["building-facade-window"]),"building-roof-shape":new Qt(Ge.layout_building["building-roof-shape"]),"building-height":new Qt(Ge.layout_building["building-height"]),"building-base":new Qt(Ge.layout_building["building-base"])})),paint:eM||(eM=new Ai({"building-opacity":new Ct(Ge.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Ct(Ge.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Ct(Ge.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Ct(Ge.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Ct(Ge.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Ct(Ge.paint_building["building-vertical-scale"]),"building-cast-shadows":new Ct(Ge.paint_building["building-cast-shadows"]),"building-color":new Qt(Ge.paint_building["building-color"]),"building-emissive-strength":new Qt(Ge.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Ct(Ge.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Ct(Ge.paint_building["building-cutoff-fade-range"]),"building-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new JC(a)}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(a){return!0}},line:class extends Zo{constructor(a,e,i,u){const h=uM();super(a,h,e,i,u),h.layout&&(this.layout=new js(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ml,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,e){super.recalculate(a,e),this.paint._values["line-floorwidth"]=(()=>{if(Y_)return Y_;const i=uM();return Y_=new b$(i.paint.properties["line-width"].specification),Y_.useIntegerZoom=!0,Y_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new M1(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,e,i){const u=lM(this);return{config:new co(this,{zoom:e,lut:i}),defines:u,overrideFog:!1}}queryRadius(a){const e=a,i=hM(uo("line-width",this,e),uo("line-gap-width",this,e)),u=uo("line-offset",this,e);return i/2+Math.abs(u)+Pi(this.paint.get("line-translate"))}queryIntersectsFeature(a,e,i,u,h,p){if(a.queryGeometry.isAboveHorizon)return!1;const g=Ka(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,a.pixelToTileUnitsFactor),w=a.pixelToTileUnitsFactor/2*hM(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),E=this.paint.get("line-offset").evaluate(e,i);return E&&(u=(function(P,O){const D=[],L=new kt(0,0);for(let U=0;U<P.length;U++){const $=P[U],X=[];for(let J=0;J<$.length;J++){const ie=$[J],de=$[J+1],he=J===0?L:ie.sub($[J-1])._unit()._perp(),ge=J===$.length-1?L:de.sub(ie)._unit()._perp(),Fe=he._add(ge)._unit();Fe._mult(1/(Fe.x*ge.x+Fe.y*ge.y)),X.push(Fe._mult(O)._add(ie))}D.push(X)}return D})(u,E*a.pixelToTileUnitsFactor)),(function(P,O,D){for(let L=0;L<O.length;L++){const U=O[L];if(P.length>=3){for(let $=0;$<U.length;$++)if(Yo(P,U[$]))return!0}if(ji(P,U,D))return!0}return!1})(g,u,w)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:yx,background:class extends Zo{constructor(a,e,i,u){super(a,{layout:rO||(rO=new Ai({visibility:new Ct(Ge.layout_background.visibility)})),paint:nO||(nO=new Ai({"background-pitch-alignment":new Ct(Ge.paint_background["background-pitch-alignment"]),"background-color":new Ct(Ge.paint_background["background-color"]),"background-pattern":new Ct(Ge.paint_background["background-pattern"]),"background-opacity":new Ct(Ge.paint_background["background-opacity"]),"background-emissive-strength":new Ct(Ge.paint_background["background-emissive-strength"]),"background-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,e,i){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:lO,"raster-particle":pO,sky:class extends Zo{constructor(a,e,i,u){super(a,{layout:hO||(hO=new Ai({visibility:new Ct(Ge.layout_sky.visibility)})),paint:fO||(fO=new Ai({"sky-type":new Ct(Ge.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ct(Ge.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ct(Ge.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ct(Ge.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ct(Ge.paint_sky["sky-gradient-radius"]),"sky-gradient":new Rc(Ge.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ct(Ge.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ct(Ge.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ct(Ge.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=k_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(a,e){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),h=!u,p=a.style.light,g=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&fn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?X1(g.azimuthal,90-g.polar,e):X1(u[0],90-u[1],e)}const i=this.paint.get("sky-gradient-center");return X1(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends Zo{constructor(a,e,i,u){super(a,{paint:dO||(dO=new Ai({}))},e,null)}},model:class extends Zo{constructor(a,e,i,u){super(a,{layout:yO||(yO=new Ai({visibility:new Ct(Ge.layout_model.visibility),"model-id":new Qt(Ge.layout_model["model-id"])})),paint:vO||(vO=new Ai({"model-opacity":new Qt(Ge.paint_model["model-opacity"]),"model-rotation":new Qt(Ge.paint_model["model-rotation"]),"model-scale":new Qt(Ge.paint_model["model-scale"]),"model-translation":new Qt(Ge.paint_model["model-translation"]),"model-color":new Qt(Ge.paint_model["model-color"]),"model-color-mix-intensity":new Qt(Ge.paint_model["model-color-mix-intensity"]),"model-type":new Ct(Ge.paint_model["model-type"]),"model-cast-shadows":new Ct(Ge.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ct(Ge.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ct(Ge.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Qt(Ge.paint_model["model-emissive-strength"]),"model-roughness":new Qt(Ge.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Qt(Ge.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ct(Ge.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ct(Ge.paint_model["model-front-cutoff"]),"model-color-use-theme":new Qt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new Y1(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof wx?Wt-1:0}queryIntersectsFeature(a,e,i,u,h,p){if(!this.modelManager)return!1;const g=this.modelManager,w=a.tile.getBucket(this);if(!(w&&w instanceof Y1))return!1;for(const E in w.instancesPerModel){const P=w.instancesPerModel[E],O=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(P.idToFeaturesIndex.hasOwnProperty(O)){const D=P.features[P.idToFeaturesIndex[O]],L=g.getModel(E,this.scope);if(!L)return!1;let U=ee();const $=new z(0,0),X=w.canonical;let J=Number.MAX_VALUE;for(let ie=0;ie<D.instancedDataCount;++ie){const de=16*(D.instancedDataOffset+ie),he=P.instancedDataArray.float32,ge=[he[de+4],he[de+5],he[de+6]];TO(X,$,he[de],0|he[de+1]),GC(U,L,p,$,D.rotation,D.scale,ge,!1,!1,!1),p.projection.name==="globe"&&(U=E1(U,p));const Fe=ae([],p.projMatrix,U),Me=a.queryGeometry,Oe=qC(Me.isPointQuery()?Me.screenBounds:Me.screenGeometry,p,Fe,L.aabb);Oe!=null&&(J=Math.min(Oe,J))}return J!==Number.MAX_VALUE&&J}}return!1}_handleOverridablePaintPropertyUpdate(a,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const e=this._transitionablePaint._values[a];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof cs}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Zo{constructor(a,e,i,u){super(a,{layout:eC||(eC=new Ai({"clip-layer-types":new Ct(Ge.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ct(Ge.layout_clip["clip-layer-scope"])})),paint:tC||(tC=new Ai({}))},e,i,u)}recalculate(a,e){super.recalculate(a,e)}createBucket(a){return new rC(a)}is3D(a){return!0}}},Q1=new wn(0,0,0),ew={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},tw={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Sx={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},T6={PAINT_ORDER_FILL_AND_STROKE:1},uy={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},EO={MASK_TYPE_LUMINANCE:1};function E6(a,e,i){a===1&&e.icons.push((function(u,h){return(function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:g}=p;if(g.content_area){const{content_area:w}=g;w.top==null&&(w.top=w.left),w.width==null&&(w.width=p.usvg_tree.width),w.height==null&&(w.height=w.width)}return g.stretch_x&&g.stretch_x.length&&AO(g,"x"),g.stretch_y&&g.stretch_y.length&&AO(g,"y"),p})(u.readFields(A6,{name:void 0},h))})(i,i.readVarint()+i.pos))}function AO(a,e){const i=[],u=a[`stretch_${e}`];let h=null;for(let p=0;p<u.length;p++)h===null?h=i.length===0?u[0]:i[i.length-1][1]+u[p]:(i.push([h,h+u[p]]),h=null);a[`stretch_${e}_areas`]=i}function A6(a,e,i){a===1?e.name=i.readString():a===2?e.metadata=(function(u,h){return u.readFields(P6,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)})(i,i.readVarint()+i.pos):a===3&&(e.usvg_tree=(function(u,h){return u.readFields(M6,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function P6(a,e,i){a===1?e.stretch_x=i.readPackedVarint():a===2?e.stretch_y=i.readPackedVarint():a===3?e.content_area=(function(u,h){return u.readFields(I6,{left:0},h)})(i,i.readVarint()+i.pos):a===4&&e.variables.push((function(u,h){return u.readFields(C6,{name:void 0},h)})(i,i.readVarint()+i.pos))}function I6(a,e,i){a===1?e.left=i.readVarint():a===2?e.width=i.readVarint():a===3?e.top=i.readVarint():a===4&&(e.height=i.readVarint())}function C6(a,e,i){a===1?e.name=i.readString():a===2&&(e.rgb_color=Ax(i.readVarint()),e.value="rgb_color")}function M6(a,e,i){a===1?e.width=e.height=i.readVarint():a===2?e.height=i.readVarint():a===3?e.children.push(Tx(i,i.readVarint()+i.pos)):a===4?e.linear_gradients.push((function(u,h){return u.readFields(F6,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)})(i,i.readVarint()+i.pos)):a===5?e.radial_gradients.push((function(u,h){return u.readFields(N6,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)})(i,i.readVarint()+i.pos)):a===7?e.clip_paths.push((function(u,h){return u.readFields(j6,{children:[]},h)})(i,i.readVarint()+i.pos)):a===8&&e.masks.push((function(u,h){const p=u.readFields(U6,{left:0,width:20,mask_type:EO.MASK_TYPE_LUMINANCE,children:[]},h);return p.height==null&&(p.height=p.width),p.top==null&&(p.top=p.left),p})(i,i.readVarint()+i.pos))}function Tx(a,e){return a.readFields(O6,{},e)}function O6(a,e,i){a===1?(e.group=(function(u,h){return u.readFields(R6,{opacity:255,children:[]},h)})(i,i.readVarint()+i.pos),e.node="group"):a===2&&(e.path=(function(u,h){return u.readFields(k6,{paint_order:1,commands:[],step:1,diffs:[],rule:ew.PATH_RULE_NON_ZERO},h)})(i,i.readVarint()+i.pos),e.node="path")}function R6(a,e,i){a===1?e.transform=Ex(i,i.readVarint()+i.pos):a===2?e.opacity=i.readVarint():a===5?e.clip_path_idx=i.readVarint():a===6?e.mask_idx=i.readVarint():a===7&&e.children.push(Tx(i,i.readVarint()+i.pos))}function Ex(a,e){return a.readFields(D6,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function D6(a,e,i){a===1?e.sx=i.readFloat():a===2?e.ky=i.readFloat():a===3?e.kx=i.readFloat():a===4?e.sy=i.readFloat():a===5?e.tx=i.readFloat():a===6&&(e.ty=i.readFloat())}function k6(a,e,i){a===1?e.fill=(function(u,h){return u.readFields(L6,{rgb_color:Q1,paint:"rgb_color",opacity:255},h)})(i,i.readVarint()+i.pos):a===2?e.stroke=(function(u,h){return u.readFields(z6,{rgb_color:Q1,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)})(i,i.readVarint()+i.pos):a===3?e.paint_order=i.readVarint():a===5?i.readPackedVarint(e.commands):a===6?e.step=i.readFloat():a===7?i.readPackedSVarint(e.diffs):a===8&&(e.rule=i.readVarint())}function L6(a,e,i){a===1?(e.rgb_color=Ax(i.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):a===5&&(e.opacity=i.readVarint())}function Ax(a){return new wn((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function z6(a,e,i){a===1?(e.rgb_color=Ax(i.readVarint()),e.paint="rgb_color"):a===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):a===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):a===5?i.readPackedFloat(e.dasharray):a===6?e.dashoffset=i.readFloat():a===7?e.miterlimit=i.readFloat():a===8?e.opacity=i.readVarint():a===9?e.width=i.readFloat():a===10?e.linecap=i.readVarint():a===11&&(e.linejoin=i.readVarint())}function F6(a,e,i){a===1?e.transform=Ex(i,i.readVarint()+i.pos):a===2?e.spread_method=i.readVarint():a===3?e.stops.push(PO(i,i.readVarint()+i.pos)):a===4?e.x1=i.readFloat():a===5?e.y1=i.readFloat():a===6?e.x2=i.readFloat():a===7&&(e.y2=i.readFloat())}function PO(a,e){return a.readFields(B6,{offset:0,opacity:255,rgb_color:Q1},e)}function B6(a,e,i){a===1?e.offset=i.readFloat():a===2?e.opacity=i.readVarint():a===3&&(e.rgb_color=Ax(i.readVarint()))}function N6(a,e,i){a===1?e.transform=Ex(i,i.readVarint()+i.pos):a===2?e.spread_method=i.readVarint():a===3?e.stops.push(PO(i,i.readVarint()+i.pos)):a===4?e.cx=i.readFloat():a===5?e.cy=i.readFloat():a===6?e.r=i.readFloat():a===7?e.fx=i.readFloat():a===8?e.fy=i.readFloat():a===9&&(e.fr=i.readFloat())}function j6(a,e,i){a===1?e.transform=Ex(i,i.readVarint()+i.pos):a===2?e.clip_path_idx=i.readVarint():a===3&&e.children.push(Tx(i,i.readVarint()+i.pos))}function U6(a,e,i){a===1?e.left=e.top=i.readFloat():a===2?e.width=e.height=i.readFloat():a===3?e.top=i.readFloat():a===4?e.height=i.readFloat():a===5?e.mask_type=i.readVarint():a===6?e.mask_idx=i.readVarint():a===7&&e.children.push(Tx(i,i.readVarint()+i.pos))}class V6{static calculate(e={},i=[]){const u=new Map,h=new Map;if(Object.keys(e).length===0)return u;i.forEach((p=>{h.set(p.name,p.rgb_color||new wn(0,0,0))}));for(const[p,g]of Object.entries(e))h.has(p)?u.set(h.get(p).toString(),g):console.warn(`Ignoring unknown image variable "${p}"`);return u}}function wg(a,e=255,i){const u=e/255,h=a.toString(),p=i.has(h)?i.get(h).clone():a.clone();return p.a*=u,p.toString()}function hy(a,e){if(!Ju()){const i=document.createElement("canvas");return i.width=a,i.height=e,i}return new OffscreenCanvas(a,e)}function $6(a,e){const i=V6.calculate(e.params,a.metadata?a.metadata.variables:[]),u=a.usvg_tree,h=u.width,p=u.height,g=e.transform?e.transform:new DOMMatrix,w=Math.max(1,Math.round(h*g.a)),E=Math.max(1,Math.round(p*g.d)),P=new DOMMatrix([w/h,0,0,E/p,0,0]),O=hy(w,E).getContext("2d");return rw(O,P,u,u,i),O.getImageData(0,0,w,E)}function rw(a,e,i,u,h){for(const p of u.children)IO(a,e,i,p,h)}function IO(a,e,i,u,h){u.group?(a.save(),(function(p,g,w,E,P){const O=E.mask_idx!=null?w.masks[E.mask_idx]:null,D=E.clip_path_idx!=null?w.clip_paths[E.clip_path_idx]:null;if(E.transform&&(g=Sg(E.transform).preMultiplySelf(g)),!(function($,X,J){return $.opacity!==255||X||J})(E,D!=null,O!=null))return void rw(p,g,w,E,P);const L=hy(p.canvas.width,p.canvas.height),U=L.getContext("2d");rw(U,g,w,E,P),D&&LO(U,g,w,D),O&&zO(U,g,w,O,P),p.globalAlpha=E.opacity/255,p.drawImage(L,0,0)})(a,e,i,u.group,h),a.restore()):u.path&&(a.save(),(function(p,g,w,E,P){p.setTransform(g),E.paint_order===T6.PAINT_ORDER_FILL_AND_STROKE?(CO(p,w,E,P),OO(p,w,E,P)):(OO(p,w,E,P),CO(p,w,E,P))})(a,e,i,u.path,h),a.restore())}function CO(a,e,i,u){const h=i.fill;if(!h)return;const p=h.opacity/255;switch(a.save(),a.beginPath(),FO(i,a),h.paint){case"rgb_color":a.fillStyle=wg(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":{const g=e.linear_gradients[h.linear_gradient_idx];g.transform&&a.setTransform(Sg(g.transform).preMultiplySelf(a.getTransform())),a.fillStyle=RO(a,g,p,u);break}case"radial_gradient_idx":{const g=e.radial_gradients[h.radial_gradient_idx];g.transform&&a.setTransform(Sg(g.transform).preMultiplySelf(a.getTransform())),a.fillStyle=DO(a,g,p,u)}}a.fill(MO(i)),a.restore()}function MO(a){return a.rule===ew.PATH_RULE_NON_ZERO?"nonzero":a.rule===ew.PATH_RULE_EVEN_ODD?"evenodd":void 0}function OO(a,e,i,u){const h=i.stroke;if(!h)return;const p=BO(i);a.lineWidth=h.width,a.miterLimit=h.miterlimit,a.setLineDash(h.dasharray),a.lineDashOffset=h.dashoffset;const g=h.opacity/255;switch(h.paint){case"rgb_color":a.strokeStyle=wg(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":a.strokeStyle=RO(a,e.linear_gradients[h.linear_gradient_idx],g,u,!0);break;case"radial_gradient_idx":a.strokeStyle=DO(a,e.radial_gradients[h.radial_gradient_idx],g,u,!0)}switch(h.linejoin){case Sx.LINE_JOIN_MITER_CLIP:case Sx.LINE_JOIN_MITER:a.lineJoin="miter";break;case Sx.LINE_JOIN_ROUND:a.lineJoin="round";break;case Sx.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(h.linecap){case tw.LINE_CAP_BUTT:a.lineCap="butt";break;case tw.LINE_CAP_ROUND:a.lineCap="round";break;case tw.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(p)}function RO(a,e,i,u,h=!1){if(e.stops.length===1){const L=e.stops[0];return wg(L.rgb_color,L.opacity*i,u)}const{x1:p,y1:g,x2:w,y2:E}=e;let P=new DOMPoint(p,g),O=new DOMPoint(w,E);if(h){const L=Sg(e.transform);P=L.transformPoint(P),O=L.transformPoint(O)}const D=a.createLinearGradient(P.x,P.y,O.x,O.y);for(const L of e.stops)D.addColorStop(L.offset,wg(L.rgb_color,L.opacity*i,u));return D}function DO(a,e,i,u,h=!1){if(e.stops.length===1){const ie=e.stops[0];return wg(ie.rgb_color,ie.opacity*i,u)}const p=Sg(e.transform),{fx:g,fy:w,fr:E,cx:P,cy:O,r:D}=e;let L=new DOMPoint(g,w),U=new DOMPoint(P,O),$=E,X=D;if(h){L=p.transformPoint(L),U=p.transformPoint(U);const ie=(p.a+p.d)/2;$=E*ie,X=e.r*ie}const J=a.createRadialGradient(L.x,L.y,$,U.x,U.y,X);for(const ie of e.stops)J.addColorStop(ie.offset,wg(ie.rgb_color,ie.opacity*i,u));return J}function kO(a,e,i,u){const h=u.transform?Sg(u.transform).preMultiplySelf(e):e,p=hy(a.canvas.width,a.canvas.height),g=p.getContext("2d");for(const E of u.children)if(E.group)kO(g,h,i,E.group);else if(E.path){const P=E.path,O=new Path2D;O.addPath(BO(P),h),g.fill(O,MO(P))}const w=u.clip_path_idx!=null?i.clip_paths[u.clip_path_idx]:null;w&&LO(g,h,i,w),a.globalCompositeOperation="source-over",a.drawImage(p,0,0)}function LO(a,e,i,u){const h=hy(a.canvas.width,a.canvas.height);kO(h.getContext("2d"),e,i,u),a.globalCompositeOperation="destination-in",a.drawImage(h,0,0)}function zO(a,e,i,u,h){if(u.children.length===0)return;const p=u.mask_idx!=null?i.masks[u.mask_idx]:null;p&&zO(a,e,i,p,h);const g=a.canvas.width,w=a.canvas.height,E=hy(g,w),P=E.getContext("2d"),O=u.width,D=u.height,L=u.left,U=u.top,$=new Path2D,X=new Path2D;X.rect(L,U,O,D),$.addPath(X,e),P.clip($);for(const de of u.children)IO(P,e,i,de,h);const J=P.getImageData(0,0,g,w),ie=J.data;if(u.mask_type===EO.MASK_TYPE_LUMINANCE)for(let de=0;de<ie.length;de+=4)ie[de+3]=ie[de+3]/255*(.2126*ie[de]+.7152*ie[de+1]+.0722*ie[de+2]);P.putImageData(J,0,0),a.globalCompositeOperation="destination-in",a.drawImage(E,0,0)}function Sg(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function FO(a,e){const i=a.step;let u=a.diffs[0]*i,h=a.diffs[1]*i;e.moveTo(u,h);for(let p=0,g=2;p<a.commands.length;p++)switch(a.commands[p]){case uy.PATH_COMMAND_MOVE:u+=a.diffs[g++]*i,h+=a.diffs[g++]*i,e.moveTo(u,h);break;case uy.PATH_COMMAND_LINE:u+=a.diffs[g++]*i,h+=a.diffs[g++]*i,e.lineTo(u,h);break;case uy.PATH_COMMAND_QUAD:{const w=u+a.diffs[g++]*i,E=h+a.diffs[g++]*i;u=w+a.diffs[g++]*i,h=E+a.diffs[g++]*i,e.quadraticCurveTo(w,E,u,h);break}case uy.PATH_COMMAND_CUBIC:{const w=u+a.diffs[g++]*i,E=h+a.diffs[g++]*i,P=w+a.diffs[g++]*i,O=E+a.diffs[g++]*i;u=P+a.diffs[g++]*i,h=O+a.diffs[g++]*i,e.bezierCurveTo(w,E,P,O,u,h);break}case uy.PATH_COMMAND_CLOSE:e.closePath()}return e}function BO(a){return FO(a,new Path2D)}class Px{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}ir(Px,"LRUCache");class nw{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new ya(e,e.data)}getFromCache(e,i,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new Px(150)),this.cacheMap.get(u).get(Du(e.toString(),i))}setInCache(e,i,u,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new Px(150));const p=this.cacheDependenciesMap.get(h),g=Du(e.id.toString(),u);p.get(g)||p.set(g,new Set);const w=this.cacheMap.get(h),E=e.toString();p.get(g).add(E),w.put(Du(e.toString(),u),i)}removeImagesFromCacheByIds(e,i,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const h=this.cacheMap.get(u),p=this.cacheDependenciesMap.get(u);for(const g of e){const w=Du(g.toString(),i);if(p.has(w)){for(const E of p.get(w))h.delete(E);p.delete(w)}}}rasterize(e,i,u,h,p=$6){const g=this.getFromCache(e,u,h);if(g)return g.clone();const w=p(i.icon,e.options),E=nw._getImage(w);return this.setInCache(e,E,u,h),E.clone()}}class NO{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const u=this.toIdx(e,i);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function jO(a,e,i,u){let h=0,p=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(u[g])<1e-15){if(i[g]<a[g]||i[g]>e[g])return null}else{const w=1/u[g];let E=(a[g]-i[g])*w,P=(e[g]-i[g])*w;if(E>P){const O=E;E=P,P=O}if(E>h&&(h=E),P<p&&(p=P),h>p)return null}return h}function UO(a,e,i,u,h,p,g,w,E,P,O){const D=u-a,L=h-e,U=p-i,$=g-a,X=w-e,J=E-i,ie=O[1]*J-O[2]*X,de=O[2]*$-O[0]*J,he=O[0]*X-O[1]*$,ge=D*ie+L*de+U*he;if(Math.abs(ge)<1e-15)return null;const Fe=1/ge,Me=P[0]-a,Oe=P[1]-e,je=P[2]-i,Ue=(Me*ie+Oe*de+je*he)*Fe;if(Ue<0||Ue>1)return null;const ut=Oe*U-je*L,Ze=je*D-Me*U,_t=Me*L-Oe*D,qt=(O[0]*ut+O[1]*Ze+O[2]*_t)*Fe;return qt<0||Ue+qt>1?null:($*ut+X*Ze+J*_t)*Fe}function VO(a,e,i){return(a-e)/(i-e)}function $O(a,e,i,u,h,p,g,w,E){const P=1<<i,O=p-u,D=g-h,L=(a+1)/P*O+u,U=(e+0)/P*D+h,$=(e+1)/P*D+h;w[0]=(a+0)/P*O+u,w[1]=U,E[0]=L,E[1]=$}class qO{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=(function(p){const g=Math.ceil(Math.log2(p.dim/8)),w=[];let E=Math.ceil(Math.pow(2,g));const P=1/E,O=(U,$,X,J,ie)=>{const de=J?1:0,he=(U+1)*X-de,ge=$*X,Fe=($+1)*X-de;ie[0]=U*X,ie[1]=ge,ie[2]=he,ie[3]=Fe};let D=new NO(E);const L=[];for(let U=0;U<E*E;U++){O(U%E,Math.floor(U/E),P,!1,L);const $=xp(L[0],L[1],p),X=xp(L[2],L[1],p),J=xp(L[2],L[3],p),ie=xp(L[0],L[3],p);D.minimums.push(Math.min($,X,J,ie)),D.maximums.push(Math.max($,X,J,ie)),D.leaves.push(1)}for(w.push(D),E/=2;E>=1;E/=2){const U=w[w.length-1];D=new NO(E);for(let $=0;$<E*E;$++){O($%E,Math.floor($/E),2,!0,L);const X=U.getElevation(L[0],L[1]),J=U.getElevation(L[2],L[1]),ie=U.getElevation(L[2],L[3]),de=U.getElevation(L[0],L[3]),he=U.isLeaf(L[0],L[1]),ge=U.isLeaf(L[2],L[1]),Fe=U.isLeaf(L[2],L[3]),Me=U.isLeaf(L[0],L[3]),Oe=Math.min(X.min,J.min,ie.min,de.min),je=Math.max(X.max,J.max,ie.max,de.max),Ue=he&&ge&&Fe&&Me;D.maximums.push(je),D.minimums.push(Oe),D.leaves.push(je-Oe<=5&&Ue?1:0)}w.push(D)}return w})(this.dem),u=i.length-1,h=i[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,u,0)}raycastRoot(e,i,u,h,p,g,w=1){return jO([e,i,-100],[u,h,this.maximums[0]*w],p,g)}raycast(e,i,u,h,p,g,w=1){if(!this.nodeCount)return null;const E=this.raycastRoot(e,i,u,h,p,g,w);if(E==null)return null;const P=[],O=[],D=[],L=[],U=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;U.length>0;){const{idx:$,t:X,nodex:J,nodey:ie,depth:de}=U.pop();if(this.leaves[$]){$O(J,ie,de,e,i,u,h,D,L);const ge=1<<de,Fe=(J+0)/ge,Me=(J+1)/ge,Oe=(ie+0)/ge,je=(ie+1)/ge,Ue=xp(Fe,Oe,this.dem)*w,ut=xp(Me,Oe,this.dem)*w,Ze=xp(Me,je,this.dem)*w,_t=xp(Fe,je,this.dem)*w,qt=UO(D[0],D[1],Ue,L[0],D[1],ut,L[0],L[1],Ze,p,g),Et=UO(L[0],L[1],Ze,D[0],L[1],_t,D[0],D[1],Ue,p,g),Lt=Math.min(qt!==null?qt:Number.MAX_VALUE,Et!==null?Et:Number.MAX_VALUE);if(Lt!==Number.MAX_VALUE)return Lt;{const Ut=mt([],p,g,X);if(GO(Ue,ut,_t,Ze,VO(Ut[0],D[0],L[0]),VO(Ut[1],D[1],L[1]))>=Ut[2])return X}continue}let he=0;for(let ge=0;ge<this._siblingOffset.length;ge++){$O((J<<1)+this._siblingOffset[ge][0],(ie<<1)+this._siblingOffset[ge][1],de+1,e,i,u,h,D,L),D[2]=-100,L[2]=this.maximums[this.childOffsets[$]+ge]*w;const Fe=jO(D,L,p,g);if(Fe!=null){const Me=Fe;P[ge]=Me;let Oe=!1;for(let je=0;je<he&&!Oe;je++)Me>=P[O[je]]&&(O.splice(je,0,ge),Oe=!0);Oe||(O[he]=ge),he++}}for(let ge=0;ge<he;ge++){const Fe=O[ge];U.push({idx:this.childOffsets[$]+Fe,t:P[Fe],nodex:(J<<1)+this._siblingOffset[Fe][0],nodey:(ie<<1)+this._siblingOffset[Fe][1],depth:de+1})}}return null}_addNode(e,i,u){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,u,h,p){if(e[h].isLeaf(i,u)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const g=h-1,w=e[g];let E=0,P=0;for(let O=0;O<this._siblingOffset.length;O++){const D=2*i+this._siblingOffset[O][0],L=2*u+this._siblingOffset[O][1],U=w.getElevation(D,L),$=w.isLeaf(D,L),X=this._addNode(U.min,U.max,$);$&&(E|=1<<O),P||(P=X)}for(let O=0;O<this._siblingOffset.length;O++)E&1<<O||this._construct(e,2*i+this._siblingOffset[O][0],2*u+this._siblingOffset[O][1],g,P+O)}}function GO(a,e,i,u,h,p){return Sr(Sr(a,i,p),Sr(e,u,p),h)}function xp(a,e,i){const u=i.dim,h=we(a*u-.5,0,u-1),p=we(e*u-.5,0,u-1),g=Math.floor(h),w=Math.floor(p),E=Math.min(g+1,u-1),P=Math.min(w+1,u-1);return GO(i.get(g,w),i.get(E,w),i.get(g,P),i.get(E,P),h-g,p-w)}const q6={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function G6(a,e,i){return(256*a*256+256*e+i)/10-1e4}function H6(a,e,i){return 256*a+e+i/256-32768}class Ix{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,u,h=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void fn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const p=this.dim=i.height-2,g=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let E=0;E<p;E++)g[this._idx(-1,E)]=g[this._idx(0,E)],g[this._idx(p,E)]=g[this._idx(p-1,E)],g[this._idx(E,-1)]=g[this._idx(E,0)],g[this._idx(E,p)]=g[this._idx(E,p-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(p,-1)]=g[this._idx(p-1,0)],g[this._idx(-1,p)]=g[this._idx(0,p-1)],g[this._idx(p,p)]=g[this._idx(p-1,p-1)]}const w=u==="terrarium"?H6:G6;for(let E=0;E<g.length;++E){const P=4*E;this.floatView[E]=w(this.pixels[P],this.pixels[P+1],this.pixels[P+2])}this._timestamp=ps.now()}_buildQuadTree(){this._tree=new qO(this)}get(e,i,u=!1){u&&(e=we(e,-1,this.dim),i=we(i,-1,this.dim));const h=this._idx(e,i);return this.floatView[h]}set(e,i,u){const h=this._idx(e,i),p=this.floatView[h];return this.floatView[h]=u,u-p}static getUnpackVector(e){return q6[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const u=[0,0,0,0],h=Ix.getUnpackVector(i);let p=Math.floor((e+h[3])/h[2]);return u[2]=p%256,p=Math.floor(p/256),u[1]=p%256,p=Math.floor(p/256),u[0]=p,u}getPixels(){return new jI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,u){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,p=i*this.dim+this.dim,g=u*this.dim,w=u*this.dim+this.dim;switch(i){case-1:h=p-1;break;case 1:p=h+1}switch(u){case-1:g=w-1;break;case 1:w=g+1}const E=-i*this.dim,P=-u*this.dim;for(let O=g;O<w;O++)for(let D=h;D<p;D++){const L=4*this._idx(D,O),U=4*this._idx(D+E,O+P);this.pixels[L+0]=e.pixels[U+0],this.pixels[L+1]=e.pixels[U+1],this.pixels[L+2]=e.pixels[U+2],this.pixels[L+3]=e.pixels[U+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function W6(a,e,i){a===1?e.headerLength=i.readFixed32():a===2?e.x=i.readVarint():a===3?e.y=i.readVarint():a===4?e.z=i.readVarint():a===5&&e.layers.push((function(u,h){return u.readFields(J6,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)})(i,i.readVarint()+i.pos))}function Z6(a,e,i){a===1?(e.delta_filter=(function(u,h){return u.readFields(X6,{blockSize:0},h)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):a===2?(i.readVarint(),e.filter="zigzag_filter"):a===3?(i.readVarint(),e.filter="bitshuffle_filter"):a===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function X6(a,e,i){a===1&&(e.blockSize=i.readVarint())}function K6(a,e,i){a===1?(i.readVarint(),e.codec="gzip_data"):a===2?(i.readVarint(),e.codec="jpeg_image"):a===3?(i.readVarint(),e.codec="webp_image"):a===4&&(i.readVarint(),e.codec="png_image")}function Y6(a,e,i){let u=0,h=0;a===1?e.firstByte=i.readFixed64():a===2?e.lastByte=i.readFixed64():a===3?e.filters.push((function(p,g){return p.readFields(Z6,{},g)})(i,i.readVarint()+i.pos)):a===4?e.codec=(function(p,g){return p.readFields(K6,{},g)})(i,i.readVarint()+i.pos):a===5?h=i.readFloat():a===6?u=i.readFloat():a===7?e.bands.push(i.readString()):a===8?e.offset=i.readDouble():a===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=h),e.scale===0&&(e.scale=u)}function J6(a,e,i){a===1?e.version=i.readVarint():a===2?e.name=i.readString():a===3?e.units=i.readString():a===4?e.tileSize=i.readVarint():a===5?e.buffer=i.readVarint():a===6?e.pixelFormat=i.readVarint():a===7&&e.dataIndex.push((function(u,h){return u.readFields(Y6,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)})(i,i.readVarint()+i.pos))}function Q6(a,e,i){if(a===2)(function(u,h,p){u.readFields(e8,p,h)})(i,i.readVarint()+i.pos,e);else if(a===3)throw new Error("Not implemented")}function e8(a,e,i){if(a===1){let u=0;const h=i.readVarint()+i.pos;for(;i.pos<h;)e[u++]=i.readVarint()}}function t8(a,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let u=2;u>=1;u--){const h=u===1?1:0,p=u===2?1:0;for(let g=0;g<e[0];g++){const w=e[1]*g;for(let E=h;E<e[1];E++){const P=e[2]*(E+w);for(let O=p;O<e[2];O++){const D=e[3]*(O+P);for(let L=0;L<e[3];L++){const U=D+L;a[U]+=a[U-i]}}}}i*=e[u]}return a}function r8(a){for(let e=0,i=a.length;e<i;e++)a[e]=a[e]>>>1^-(1&a[e]);return a}function n8(a,e){switch(e){case"uint32":return a;case"uint16":for(let i=0;i<a.length;i+=2){const u=a[i],h=a[i+1];a[i]=(240&u)>>4|(61440&u)>>8|(240&h)<<4|61440&h,a[i+1]=15&u|(3840&u)>>4|(15&h)<<8|(3840&h)<<4}return a;case"uint8":for(let i=0;i<a.length;i+=4){const u=a[i],h=a[i+1],p=a[i+2],g=a[i+3];a[i+0]=(192&u)>>6|(192&h)>>4|(192&p)>>2|192&g,a[i+1]=(48&u)>>4|(48&h)>>2|48&p|(48&g)<<2,a[i+2]=(12&u)>>2|12&h|(12&p)<<2|(12&g)<<4,a[i+3]=3&u|(3&h)<<2|(3&p)<<4|(3&g)<<6}return a;default:throw new Error(`Invalid pixel format, "${e}"`)}}ir(Ix,"DEMData"),ir(qO,"DemMinMaxQuadTree",{omit:["dem"]});var Yl=Uint8Array,fy=Uint16Array,i8=Int32Array,HO=new Yl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),WO=new Yl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o8=new Yl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ZO=function(a,e){for(var i=new fy(31),u=0;u<31;++u)i[u]=e+=1<<a[u-1];var h=new i8(i[30]);for(u=1;u<30;++u)for(var p=i[u];p<i[u+1];++p)h[p]=p-i[u]<<5|u;return{b:i,r:h}},XO=ZO(HO,2),KO=XO.b,a8=XO.r;KO[28]=258,a8[258]=28;for(var s8=ZO(WO,0).b,YO=new fy(32768),Po=0;Po<32768;++Po){var Tg=(43690&Po)>>1|(21845&Po)<<1;YO[Po]=((65280&(Tg=(61680&(Tg=(52428&Tg)>>2|(13107&Tg)<<2))>>4|(3855&Tg)<<4))>>8|(255&Tg)<<8)>>1}var dy=function(a,e,i){for(var u=a.length,h=0,p=new fy(e);h<u;++h)a[h]&&++p[a[h]-1];var g,w=new fy(e);for(h=1;h<e;++h)w[h]=w[h-1]+p[h-1]<<1;g=new fy(1<<e);var E=15-e;for(h=0;h<u;++h)if(a[h])for(var P=h<<4|a[h],O=e-a[h],D=w[a[h]-1]++<<O,L=D|(1<<O)-1;D<=L;++D)g[YO[D]>>E]=P;return g},py=new Yl(288);for(Po=0;Po<144;++Po)py[Po]=8;for(Po=144;Po<256;++Po)py[Po]=9;for(Po=256;Po<280;++Po)py[Po]=7;for(Po=280;Po<288;++Po)py[Po]=8;var JO=new Yl(32);for(Po=0;Po<32;++Po)JO[Po]=5;var l8=dy(py,9),c8=dy(JO,5),iw=function(a){for(var e=a[0],i=1;i<a.length;++i)a[i]>e&&(e=a[i]);return e},Vu=function(a,e,i){var u=e/8|0;return(a[u]|a[u+1]<<8)>>(7&e)&i},ow=function(a,e){var i=e/8|0;return(a[i]|a[i+1]<<8|a[i+2]<<16)>>(7&e)},u8=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],$u=function(a,e,i){var u=new Error(e||u8[a]);if(u.code=a,Error.captureStackTrace&&Error.captureStackTrace(u,$u),!i)throw u;return u},h8=new Yl(0),f8=typeof TextDecoder<"u"&&new TextDecoder;try{f8.decode(h8,{stream:!0})}catch{}const d8={gzip_data:"gzip"};class Vc extends Error{constructor(e){super(e),this.name="MRTError"}}const p8={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},QO={uint32:1,uint16:2,uint8:4},m8={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let aw;class Cx{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Vc(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),u=new DataView(e);if(i[0]!==13)throw new Vc("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),u=this.getHeaderLength(e);if(i.length<u)throw new Vc(`Expected header with length >= ${u} but got buffer of length ${i.length}`);const h=new aw(i.subarray(0,u)).readFields(W6,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Vc(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const p of h.layers)this.layers[p.name]=new eR(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],u=this.getLayer(e.layerName);for(let h of e.blockIndices){const p=u.dataIndex[h],g=p.firstByte-e.firstByte,w=p.lastByte-e.firstByte;if(u._blocksInProgress.has(h))continue;const E={layerName:u.name,firstByte:g,lastByte:w,pixelFormat:u.pixelFormat,blockIndex:h,blockShape:[p.bands.length].concat(u.bandShape),buffer:u.buffer,codec:p.codec.codec,filters:p.filters.map((P=>P.filter))};u._blocksInProgress.add(h),i.push(E)}return new tR(i,(()=>{i.forEach((h=>u._blocksInProgress.delete(h.blockIndex)))}),((h,p)=>{if(i.forEach((g=>u._blocksInProgress.delete(g.blockIndex))),h)throw h;p.forEach((g=>{this.getLayer(g.layerName).processDecodedData(g)}))}))}}class eR{constructor({version:e,name:i,units:u,tileSize:h,pixelFormat:p,buffer:g,dataIndex:w},E){if(this.version=e,this.version!==1)throw new Vc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=u,this.tileSize=h,this.buffer=g,this.pixelFormat=p8[p],this.dataIndex=w,this.bandShape=[h+2*g,h+2*g,QO[this.pixelFormat]],this._decodedBlocks=new Px(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return QO[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[u,h]of this.dataIndex.entries()){for(const[p,g]of h.bands.entries())if(g===e)return{bandIndex:i+p,blockIndex:u,blockBandIndex:p};i+=h.bands.length}break;case"number":for(const[u,h]of this.dataIndex.entries()){if(e>=i&&e<i+h.bands.length)return{bandIndex:e,blockIndex:u,blockBandIndex:e-i};i+=h.bands.length}break;default:throw new Vc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,u=-1/0;const h=[],p=new Set;for(const g of e){const{blockIndex:w}=this.getBlockForBand(g);if(w<0)throw new Vc(`Invalid band: ${JSON.stringify(g)}`);const E=this.dataIndex[w];h.includes(w)||h.push(w),p.add(w),i=Math.min(i,E.firstByte),u=Math.max(u,E.lastByte)}if(p.size>this.cacheSize)throw new Vc(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:u,blockIndices:h}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:u}=this.getBlockForBand(e);if(i<0)throw new Vc(`Band not found: ${JSON.stringify(e)}`);const h=this._decodedBlocks.get(i.toString());if(!h)throw new Vc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[i],g=this.bandShape.reduce(((P,O)=>P*O),1),w=u*g,E=h.subarray(w,w+g);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}Cx.setPbf=function(a){aw=a};class tR{constructor(e,i,u){this.tasks=e,this._onCancel=i,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}Cx.performDecoding=function(a,e){const i=new Uint8Array(a);return Promise.all(e.tasks.map((u=>{const{layerName:h,firstByte:p,lastByte:g,pixelFormat:w,blockShape:E,blockIndex:P,filters:O,codec:D}=u,L=i.subarray(p,g+1),U=new Uint32Array(E[0]*E[1]*E[2]);let $;if(D!=="gzip_data")throw new Vc(`Unhandled codec: ${D}`);return $=(function(X,J){if(!globalThis.DecompressionStream&&J==="gzip_data")return Promise.resolve(((ge=(function(Oe){Oe[0]==31&&Oe[1]==139&&Oe[2]==8||$u(6,"invalid gzip data");var je=Oe[3],Ue=10;4&je&&(Ue+=2+(Oe[10]|Oe[11]<<8));for(var ut=(je>>3&1)+(je>>4&1);ut>0;ut-=!Oe[Ue++]);return Ue+(2&je)})(he=X))+8>he.length&&$u(6,"invalid gzip data"),(function(Oe,je,Ue,ut){var Ze=Oe.length;if(!Ze||je.f&&!je.l)return Ue||new Yl(0);var _t=!Ue,qt=_t||je.i!=2,Et=je.i;_t&&(Ue=new Yl(3*Ze));var Lt,Ut,lt=function(Di){var pi=Ue.length;if(Di>pi){var li=new Yl(Math.max(2*pi,Di));li.set(Ue),Ue=li}},zt=je.f||0,Qe=je.p||0,ct=je.b||0,Gt=je.l,Ft=je.d,gr=je.m,lr=je.n,Ot=8*Ze;do{if(!Gt){zt=Vu(Oe,Qe,1);var Nt=Vu(Oe,Qe+1,3);if(Qe+=3,!Nt){var fr=Oe[(ve=4+((Qe+7)/8|0))-4]|Oe[ve-3]<<8,tr=ve+fr;if(tr>Ze){Et&&$u(0);break}qt&&lt(ct+fr),Ue.set(Oe.subarray(ve,tr),ct),je.b=ct+=fr,je.p=Qe=8*tr,je.f=zt;continue}if(Nt==1)Gt=l8,Ft=c8,gr=9,lr=5;else if(Nt==2){var Xt=Vu(Oe,Qe,31)+257,nr=Vu(Oe,Qe+10,15)+4,Cr=Xt+Vu(Oe,Qe+5,31)+1;Qe+=14;for(var Fr=new Yl(Cr),Zr=new Yl(19),qr=0;qr<nr;++qr)Zr[o8[qr]]=Vu(Oe,Qe+3*qr,7);Qe+=3*nr;var yn=iw(Zr),nn=(1<<yn)-1,di=dy(Zr,yn);for(qr=0;qr<Cr;){var ve,xe=di[Vu(Oe,Qe,nn)];if(Qe+=15&xe,(ve=xe>>4)<16)Fr[qr++]=ve;else{var at=0,Ht=0;for(ve==16?(Ht=3+Vu(Oe,Qe,3),Qe+=2,at=Fr[qr-1]):ve==17?(Ht=3+Vu(Oe,Qe,7),Qe+=3):ve==18&&(Ht=11+Vu(Oe,Qe,127),Qe+=7);Ht--;)Fr[qr++]=at}}var Yt=Fr.subarray(0,Xt),Kt=Fr.subarray(Xt);gr=iw(Yt),lr=iw(Kt),Gt=dy(Yt,gr),Ft=dy(Kt,lr)}else $u(1);if(Qe>Ot){Et&&$u(0);break}}qt&&lt(ct+131072);for(var hr=(1<<gr)-1,zr=(1<<lr)-1,dn=Qe;;dn=Qe){var pn=(at=Gt[ow(Oe,Qe)&hr])>>4;if((Qe+=15&at)>Ot){Et&&$u(0);break}if(at||$u(2),pn<256)Ue[ct++]=pn;else{if(pn==256){dn=Qe,Gt=null;break}var en=pn-254;pn>264&&(en=Vu(Oe,Qe,(1<<(Yr=HO[qr=pn-257]))-1)+KO[qr],Qe+=Yr);var Qn=Ft[ow(Oe,Qe)&zr],Li=Qn>>4;if(Qn||$u(3),Qe+=15&Qn,Kt=s8[Li],Li>3){var Yr=WO[Li];Kt+=ow(Oe,Qe)&(1<<Yr)-1,Qe+=Yr}if(Qe>Ot){Et&&$u(0);break}qt&&lt(ct+131072);var yi=ct+en;if(ct<Kt){var si=0-Kt,Hn=Math.min(Kt,yi);for(si+ct<0&&$u(3);ct<Hn;++ct)Ue[ct]=(void 0)[si+ct]}for(;ct<yi;++ct)Ue[ct]=Ue[ct-Kt]}}je.l=Gt,je.p=dn,je.b=ct,je.f=zt,Gt&&(zt=1,je.m=gr,je.d=Ft,je.n=lr)}while(!zt);return ct!=Ue.length&&_t?(Lt=Ue,((Ut=ct)==null||Ut>Lt.length)&&(Ut=Lt.length),new Yl(Lt.subarray(0,Ut))):Ue.subarray(0,ct)})(he.subarray(ge,-8),{i:2},new Yl(((ie=he)[(de=ie.length)-4]|ie[de-3]<<8|ie[de-2]<<16|ie[de-1]<<24)>>>0))));var ie,de,he,ge;const Fe=d8[J];if(!Fe)throw new Error(`Unhandled codec: ${J}`);const Me=new globalThis.DecompressionStream(Fe);return new Response(new Blob([X]).stream().pipeThrough(Me)).arrayBuffer().then((Oe=>new Uint8Array(Oe)))})(L,D).then((X=>((function(J,ie){J.readFields(Q6,ie)})(new aw(X),U),new m8[w](U.buffer)))),$.then((X=>{for(let J=O.length-1;J>=0;J--)switch(O[J]){case"delta_filter":t8(X,E);break;case"zigzag_filter":r8(X);break;case"bitshuffle_filter":n8(X,w);break;default:throw new Vc(`Unhandled filter "${O[J]}"`)}return{layerName:h,blockIndex:P,data:X}})).catch((X=>{throw X}))})))},ir(tR,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),ir(Cx,"MapboxRasterTile"),ir(eR,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class rR{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const u=e[i];this._stringToNumber[u]=i,this._numberToString[i]=u}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const g8=["id","tile","layer","source","sourceLayer","state"];class Eg{constructor(e,i,u,h,p){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=u,this._y=h,this.properties=e.properties,this.id=p}clone(){const e=new Eg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of g8)this[i]!==void 0&&(e[i]=this[i]);return e}}class nR{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ha(Wt,16,0),this.featureIndexArray=new Gf,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,u,h,p,g=0,w=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,p,g);const P=this.grid;for(let O=0;O<i.length;O++){const D=i[O],L=[1/0,1/0,-1/0,-1/0];for(let U=0;U<D.length;U++){const $=D[U];L[0]=Math.min(L[0],$.x),L[1]=Math.min(L[1],$.y),L[2]=Math.max(L[2],$.x),L[3]=Math.max(L[3],$.y)}w!==0&&(L[0]-=w,L[1]-=w,L[2]+=w,L[3]+=w),L[0]<Wt&&L[1]<Wt&&L[2]>=0&&L[3]>=0&&P.insert(E,L[0],L[1],L[2],L[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new cr(new nx(this.rawTileData)).layers,this.sourceLayerCoder=new rR(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:u,transform:h,tileTransform:p,pixelPosMatrix:g,availableImages:w,worldview:E}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const P=u.bufferedTilespaceBounds,O=this.grid.query(P.min.x,P.min.y,P.max.x,P.max.y,(($,X,J,ie)=>Mi(u.bufferedTilespaceGeometry,$,X,J,ie)));O.sort(_8);let D=null;h.elevation&&O.length>0&&(D=bg.create(h.elevation,this.tileID));const L={};let U;for(let $=0;$<O.length;$++){const X=O[$];if(X===U)continue;U=X;const J=this.featureIndexArray.get(X);let ie=null;this.is3DTile?this.loadMatchingModelFeature(L,J,e,u,h,E):this.loadMatchingFeature(L,J,e,w,E,((de,he,ge,Fe=0)=>(ie||(ie=ze(de,this.tileID.canonical,p)),he.queryIntersectsFeature(u,de,ge,ie,this.z,h,g,D,Fe))))}return L}loadMatchingFeature(e,i,u,h,p,g){const{featureIndex:w,bucketIndex:E,sourceLayerIndex:P,layoutVertexArrayOffset:O}=i,D=this.bucketLayerIDs[E],L=u.layers,U=Object.keys(L);if(U.length&&!hn(U,D))return;const $=u.sourceCache,X=this.sourceLayerCoder.decode(P),J=this.vtLayers[X].feature(w),ie=this.getId(J,X);for(let de=0;de<D.length;de++){const he=D[de];if(!L[he])continue;const{styleLayer:ge,targets:Fe}=L[he];let Me={};ie!==void 0&&(Me=$.getFeatureState(ge.sourceLayer,ie));const Oe=!g||g(J,ge,Me,O);if(!Oe)continue;const je=new Eg(J,this.z,this.x,this.y,ie);je.tile=this.tileID.canonical,je.state=Me;let Ue=this.serializedLayersCache.get(he);Ue||(Ue=ge.serialize(),Ue.id=he,this.serializedLayersCache.set(he,Ue)),je.source=Ue.source,je.sourceLayer=Ue["source-layer"],je.layer=nt({},Ue),je.layer.paint=iR(Ue.paint,ge.paint,J,Me,h),je.layer.layout=iR(Ue.layout,ge.layout,J,Me,h);let ut=!1;for(const Ze of Fe){this.updateFeatureProperties(je,Ze);const{filter:_t}=Ze;if(_t){if(J.properties=je.properties,_t.needGeometry){const qt=ot(J,!0);if(!_t.filter(new Un(this.tileID.overscaledZ,{worldview:p}),qt,this.tileID.canonical))continue}else if(!_t.filter(new Un(this.tileID.overscaledZ,{worldview:p}),J))continue}ut=!0,Ze.targetId&&this.addFeatureVariant(je,Ze)}ut&&this.appendToResult(e,he,w,je,Oe)}}loadMatchingModelFeature(e,i,u,h,p,g){const{featureIndex:w,bucketIndex:E}=i,P=this.bucketLayerIDs[E],O=u.layers,D=Object.keys(O);if(!D.length||hn(D,P))for(let L=0;L<P.length;L++){const U=P[L],{styleLayer:$,targets:X}=O[U];if($.type!=="model")continue;const J=h.tile,ie=J.getBucket($);if(!(ie&&ie instanceof wx))continue;const de=w6(ie,w,h,p);if(!de)continue;const{z:he,x:ge,y:Fe}=J.tileID.canonical,{feature:Me,intersectionZ:Oe,position:je}=de;let Ue={};Me.id!==void 0&&(Ue=u.sourceCache.getFeatureState($.sourceLayer,Me.id));const ut=new Eg({},he,ge,Fe,Me.id);ut.tile=this.tileID.canonical,ut.state=Ue,ut.properties=Me.properties,ut.geometry={type:"Point",coordinates:[je.lng,je.lat]};let Ze=this.serializedLayersCache.get(U);Ze||(Ze=$.serialize(),Ze.id=U,this.serializedLayersCache.set(U,Ze)),ut.source=Ze.source,ut.sourceLayer=Ze["source-layer"],ut.layer=nt({},Ze);let _t=!1;for(const qt of X){this.updateFeatureProperties(ut,qt);const{filter:Et}=qt;if(Et){if(Me.properties=ut.properties,Et.needGeometry){if(!Et.filter(new Un(this.tileID.overscaledZ,{worldview:g}),Me,this.tileID.canonical))continue}else if(!Et.filter(new Un(this.tileID.overscaledZ,{worldview:g}),Me))continue}_t=!0,qt.targetId&&this.addFeatureVariant(ut,qt)}_t&&this.appendToResult(e,U,w,ut,Oe)}}updateFeatureProperties(e,i,u){if(i.properties){const h={};for(const p in i.properties){const g=i.properties[p].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,u);g!=null&&(h[p]=g)}e.properties=h}}addFeatureVariant(e,i,u){const h={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(h.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(h)}appendToResult(e,i,u,h,p){let g=e[i];g===void 0&&(g=e[i]=[]),g.push({featureIndex:u,feature:h,intersectionZ:p})}lookupSymbolFeatures(e,i,u,h,p,g){const w={};this.loadVTLayers();for(const E of e)this.loadMatchingFeature(w,{bucketIndex:i,sourceLayerIndex:u,featureIndex:E,layoutVertexArrayOffset:0},h,p,g);return w}loadFeature(e){const{featureIndex:i,sourceLayerIndex:u}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(u),p=this.vtFeatures[h];if(p[i])return p[i];const g=this.vtLayers[h].feature(i);return p[i]=g,g}hasLayer(e){for(const i of this.bucketLayerIDs)for(const u of i)if(e===u)return!0;return!1}getId(e,i){let u=e.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const p=vl(h);if(p.result!=="success"){const g=p.value.map((w=>`${w.key}: ${w.message}`)).join(", ");return void fn(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=p.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new uf),u=this.promoteIdExpression.evaluate({zoom:0},e)}else u=e.properties[h];typeof u=="boolean"&&(u=Number(u))}return u}}function iR(a,e,i,u,h){return Nr(a,((p,g)=>{const w=e instanceof js?e.get(g):null;return w&&w.evaluate?w.evaluate(i,u,void 0,h):w}))}function _8(a,e){return e-a}ir(nR,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const oR=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class sw{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,u]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=u>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=oR[15&u];if(!p)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new sw(w,g,p,e)}constructor(e,i=64,u=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=u,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=oR.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-w%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${u}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+E,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+w+E),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+E,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=e,this.coords[this._pos++]=i,u}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return lw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:g,nodeSize:w}=this,E=[0,p.length-1,0],P=[];for(;E.length;){const O=E.pop()||0,D=E.pop()||0,L=E.pop()||0;if(D-L<=w){for(let J=L;J<=D;J++){const ie=g[2*J],de=g[2*J+1];ie>=e&&ie<=u&&de>=i&&de<=h&&P.push(p[J])}continue}const U=L+D>>1,$=g[2*U],X=g[2*U+1];$>=e&&$<=u&&X>=i&&X<=h&&P.push(p[U]),(O===0?e<=$:i<=X)&&(E.push(L),E.push(U-1),E.push(1-O)),(O===0?u>=$:h>=X)&&(E.push(U+1),E.push(D),E.push(1-O))}return P}within(e,i,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:g}=this,w=[0,h.length-1,0],E=[],P=u*u;for(;w.length;){const O=w.pop()||0,D=w.pop()||0,L=w.pop()||0;if(D-L<=g){for(let J=L;J<=D;J++)sR(p[2*J],p[2*J+1],e,i)<=P&&E.push(h[J]);continue}const U=L+D>>1,$=p[2*U],X=p[2*U+1];sR($,X,e,i)<=P&&E.push(h[U]),(O===0?e-u<=$:i-u<=X)&&(w.push(L),w.push(U-1),w.push(1-O)),(O===0?e+u>=$:i+u>=X)&&(w.push(U+1),w.push(D),w.push(1-O))}return E}}function lw(a,e,i,u,h,p){if(h-u<=i)return;const g=u+h>>1;aR(a,e,g,u,h,p),lw(a,e,i,u,g-1,1-p),lw(a,e,i,g+1,h,1-p)}function aR(a,e,i,u,h,p){for(;h>u;){if(h-u>600){const P=h-u+1,O=i-u+1,D=Math.log(P),L=.5*Math.exp(2*D/3),U=.5*Math.sqrt(D*L*(P-L)/P)*(O-P/2<0?-1:1);aR(a,e,i,Math.max(u,Math.floor(i-O*L/P+U)),Math.min(h,Math.floor(i+(P-O)*L/P+U)),p)}const g=e[2*i+p];let w=u,E=h;for(my(a,e,u,i),e[2*h+p]>g&&my(a,e,u,h);w<E;){for(my(a,e,w,E),w++,E--;e[2*w+p]<g;)w++;for(;e[2*E+p]>g;)E--}e[2*u+p]===g?my(a,e,u,E):(E++,my(a,e,E,h)),E<=i&&(u=E+1),i<=E&&(h=E-1)}}function my(a,e,i,u){cw(a,i,u),cw(e,2*i,2*u),cw(e,2*i+1,2*u+1)}function cw(a,e,i){const u=a[e];a[e]=a[i],a[i]=u}function sR(a,e,i,u){const h=a-i,p=e-u;return h*h+p*p}o.$=bo,o.A=cl,o.B=Rl,o.C=Du,o.D=hg,o.E=_c,o.F=2,o.G=ty,o.H=DM,o.I=ta,o.J=Dl,o.K=class extends bx{},o.L=hl,o.M=fs,o.N=bu,o.O=Th,o.P=kt,o.Q=Yp,o.R=gs,o.S=Nd,o.T=S1,o.U=Hl,o.V=bx,o.W=Cf,o.X=vl,o.Y=gh,o.Z=Ec,o._=Fl,o.a=function(a){return No.API_CDN_URL_REGEX.test(a)},o.a$=Tt,o.a0=Pa,o.a1=Mu,o.a2=Af,o.a3=Bd,o.a4=function(a){const e=a.value;let i=[];if(!e)return i;const u=Dl(e);return u!=="string"?(i=i.concat([new bx(a.key,e,`string expected, "${u}" found`)]),i):(K1(e,!0)||(i=i.concat([new bx(a.key,e,`invalid url "${e}"`)])),i)},o.a5=Ge,o.a6=so,o.a7=Ai,o.a8=Ct,o.a9=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return ro(a.expression.evaluate(e))}interpolate(a,e,i){return{x:Sr(a.x,e.x,i),y:Sr(a.y,e.y,i),z:Sr(a.z,e.z,i),azimuthal:Sr(a.azimuthal,e.azimuthal,i),polar:Sr(a.polar,e.polar,i)}}},o.aA=Vi,o.aB=Xo,o.aC=Yo,o.aD=Y,o.aE=Be,o.aF=function(a,e){const i={};for(let u=0;u<e.length;u++){const h=e[u];h in a&&(i[h]=a[h])}return i},o.aG=V,o.aH=re,o.aI=class{constructor(a){this.entries={},this.scheduler=a}request(a,e,i,u){const h=this.entries[a]=this.entries[a]||{callbacks:[]};if(h.result){const[p,g]=h.result;return this.scheduler?this.scheduler.add((()=>{u(p,g)}),e):u(p,g),()=>{}}return h.callbacks.push(u),h.cancel||(h.cancel=i(((p,g)=>{h.result=[p,g];for(const w of h.callbacks)this.scheduler?this.scheduler.add((()=>{w(p,g)}),e):w(p,g);setTimeout((()=>delete this.entries[a]),3e3)}))),()=>{h.result||(h.callbacks=h.callbacks.filter((p=>p!==u)),h.callbacks.length||(h.cancel(),delete this.entries[a]))}}},o.aJ=function(a,e,i){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},(h=>{const p=nf(a.request,((g,w,E,P)=>{g?h(g):w&&h(null,{vectorTile:i?void 0:new cr(new nx(w)),rawData:w,cacheControl:E,expires:P})}));return()=>{p.cancel(),h()}}),e)},o.aK=function(a){_d++,_d>oi&&(a.getActor().send("enforceCacheSizeLimit",ns),_d=0)},o.aL=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},o.aM=Hi,o.aN=lO,o.aO=pO,o.aP=sO,o.aQ=function(a,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let u=0;u<a.length;u++){const h=document.createElement("source");Hm(a[u])||(i.crossOrigin="Anonymous"),h.src=a[u],i.appendChild(h)}return{cancel:()=>{}}},o.aR=X_,o.aS=function(a){return fetch(a).then((e=>e.arrayBuffer())).then((e=>NC(e,0,a)))},o.aT=WC,o.aU=class{constructor(a,e,i,u){this.id=a,this.position=e!=null?new z(e[0],e[1]):new z(0,0),this.orientation=i??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Rr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,e){if(ae(a.matrix,e,a.matrix),a.meshes)for(const i of a.meshes){const u=Rr.applyTransformFast(i.aabb,a.matrix);this.aabb.encapsulate(u)}if(a.children)for(const i of a.children)this._applyTransformations(i,a.matrix)}computeBoundsAndApplyParent(){const a=H([]);for(const e of this.nodes)this._applyTransformations(e,a)}computeModelMatrix(a,e,i,u,h,p,g=!1){GC(this.matrix,this,a.transform,this.position,e,i,u,h,p,g)}upload(a){if(!this.uploaded){for(const e of this.nodes)A1(e,a);for(const e of this.nodes)rx(e);this.uploaded=!0}}destroy(){for(const a of this.nodes)P1(a)}},o.aV=Or,o.aW=iy,o.aX=ce,o.aY=me,o.aZ=ku,o.a_=ai,o.aa=Un,o.ab=cs,o.ac=Ie,o.ad=Ar,o.ae=ft,o.af=Ne,o.ag=js,o.ah=pt,o.ai=Sr,o.aj=Wt,o.ak=vd,o.al=Cn,o.am=wn,o.an=class{constructor(a){this.specification=a}possiblyEvaluate(a,e){return(function([i,u]){const h=ro([1,i,u]);return{x:h.x,y:h.y,z:h.z}})(a.expression.evaluate(e))}interpolate(a,e,i){return{x:Sr(a.x,e.x,i),y:Sr(a.y,e.y,i),z:Sr(a.z,e.z,i)}}},o.ao=function(a,e,i=0,u=!0){const h=new kt(i,i),p=a.sub(h),g=e.add(h),w=[p,new kt(g.x,p.y),g,new kt(p.x,g.y)];return u&&w.push(p.clone()),w},o.ap=function(a,e){const i=[];for(let u=0;u<a.length;u++){const h=it(u-1,-1,a.length-1),p=it(u+1,-1,a.length-1),g=a[u],w=a[p],E=a[h].sub(g).unit(),P=w.sub(g).unit(),O=P.angleWithSep(E.x,E.y),D=E.add(P).unit().mult(-1*e/Math.sin(O/2));i.push(g.add(D))}return i},o.aq=WM,o.ar=Mi,o.as=function(a,e,i=0){return bt(((e.x-i)*a.scale-a.x)*Wt,(e.y*a.scale-a.y)*Wt,ye(e.z,e.y))},o.at=In,o.au=Tr,o.av=Sn,o.aw=iM,o.ax=function(a){let e=1/0,i=1/0,u=-1/0,h=-1/0;for(const p of a)e=Math.min(e,p.x),i=Math.min(i,p.y),u=Math.max(u,p.x),h=Math.max(h,p.y);return{min:new kt(e,i),max:new kt(u,h)}},o.ay=we,o.az=ae,o.b=function(a){return No.API_FONTS_REGEX.test(a)},o.b$=U1,o.b0=rm,o.b1=_x,o.b2=function(){hs.isLoading()||hs.isLoaded()||Lf()!=="deferred"||Vd()},o.b3=Dc,o.b4=ot,o.b5=Eg,o.b6=Dn,o.b7=M1,o.b8=l1,o.b9=ze,o.bA=function(a,e){const{x:i,y:u}=a.point,h=Mt(i,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return ae(h,h,Kr(W(e)))},o.bB=B,o.bC=ui,o.bD=function(a,e){return Math.hypot(e[0]-a[0],e[1]-a[1],e[2]-a[2])},o.bE=mt,o.bF=Br,o.bG=vr,o.bH=ey,o.bI=Xs,o.bJ=F1,o.bK=function(a,e,i,u,h){const p=5*e+2;a.float32[p+0]=i,a.float32[p+1]=u,a.float32[p+2]=h},o.bL=gx,o.bM=rs,o.bN=oc,o.bO=Al,o.bP=Go,o.bQ=it,o.bR=function(a,e,i,u){var h=new R(4);return h[0]=a,h[1]=e,h[2]=i,h[3]=u,h},o.bS=Xv,o.bT=Wn,o.bU=Jo,o.bV=iC,o.bW=mO,o.bX=lC,o.bY=h1,o.bZ=z1,o.b_=jM,o.ba=ma,o.bb=tp,o.bc=Nv,o.bd=Si,o.be=cg,o.bf=Z1,o.bg=function(a,e){const i=pt(e.zoom);if(i===0)return W(a);const u=st(a),h=Zt(u),p=Y(u.getWest())*e.worldSize,g=Y(u.getEast())*e.worldSize,w=re(u.getNorth())*e.worldSize,E=re(u.getSouth())*e.worldSize,P=[p,w,0],O=[g,w,0],D=[p,E,0],L=[g,E,0],U=Z([],e.globeMatrix);return Ar(P,P,U),Ar(O,O,U),Ar(D,D,U),Ar(L,L,U),h[0]=ne(h[0],D,i),h[1]=ne(h[1],L,i),h[2]=ne(h[2],O,i),h[3]=ne(h[3],P,i),Rr.fromPoints(h)},o.bh=$r,o.bi=Z,o.bj=mr,o.bk=ne,o.bl=Ch,o.bm=um,o.bn=Te,o.bo=fe,o.bp=Cx,o.bq=nx,o.br=nf,o.bs=function(a,e){const i=[];for(const u in a)u in e||i.push(u);return i},o.bt=Ve,o.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bv=sl,o.bw=function(a){var e=new R(16);return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15],e},o.bx=H,o.by=pe,o.bz=ee,o.c=gd,o.c$=45,o.c0=sw,o.c1=qe,o.c2=Yi,o.c3=Ba,o.c4=function(a,e,i){i*=.5;var u=e[0],h=e[1],p=e[2],g=e[3],w=Math.sin(i),E=Math.cos(i);return a[0]=u*E+h*w,a[1]=h*E-u*w,a[2]=p*E+g*w,a[3]=g*E-p*w,a},o.c5=Os,o.c6=Ei,o.c7=function(a,e){return a[0]=-e[0],a[1]=-e[1],a[2]=-e[2],a[3]=e[3],a},o.c8=Xe,o.c9=function(a,e,i,u,h){var p,g=1/Math.tan(e/2);return a[0]=g/i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=g,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,h!=null&&h!==1/0?(a[10]=(h+u)*(p=1/(u-h)),a[14]=2*h*u*p):(a[10]=-1,a[14]=-2*u),a},o.cA=_a,o.cB=Je,o.cC=function(a,e,i,u,h,p,g,w,E){if(E.name==="globe")return Je(a,e,new _a(i,u,h),!1);const P=iy({z:i,x:u,y:h},E);return new Rr([(p+P.x/P.scale)*e,e*(P.y/P.scale),g],[(p+P.x2/P.scale)*e,e*(P.y2/P.scale),w])},o.cD=function(a,e,i){return a[0]=Math.min(e[0],i[0]),a[1]=Math.min(e[1],i[1]),a[2]=Math.min(e[2],i[2]),a[3]=Math.min(e[3],i[3]),a},o.cE=function(a,e,i){return a[0]=Math.max(e[0],i[0]),a[1]=Math.max(e[1],i[1]),a[2]=Math.max(e[2],i[2]),a[3]=Math.max(e[3],i[3]),a},o.cF=function(a){const e=Math.round((a+45+360)%360/90)%4;return oe[e]},o.cG=Ee,o.cH=qo,o.cI=f,o.cJ=function(a){const e=H(new Float64Array(16));ae(e,a.pixelMatrix,a.globeMatrix);const i=[0,y,0],u=[0,x,0];return Ar(i,i,e),Ar(u,u,e),[i[0]>0&&i[0]<=a.width&&i[1]>0&&i[1]<=a.height&&!Pr(a,new z(a.center.lat,90)),u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!Pr(a,new z(a.center.lat,-90))]},o.cK=function(a,e){const{scale:i}=a.tileTransform,u=i*Wt/(a.tileSize*Math.pow(2,e.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return(function(h,p,g){var w=p[1],E=p[2],P=p[3],O=g[0],D=g[1];return h[0]=p[0]*O,h[1]=w*O,h[2]=E*D,h[3]=P*D,h})(new Float32Array(4),e.inverseAdjustmentMatrix,[u,u])},o.cL=ex,o.cM=wt,o.cN=jC,o.cO=function(a){const e=jC(a,!0);return B([],[e[0],e[1],e[4],e[5]])},o.cP=ue,o.cQ=Mn,o.cR=_e,o.cS=function(a){const{x:e,y:i}=a.point,{lng:u,lat:h}=a._center;return Mt(e,i,a.worldSize,u,h)},o.cT=Ke,o.cU=et,o.cV=Ya,o.cW=Oi,o.cX=cm,o.cY=function(a,e,i){let u=0;for(let h=0;h<2;++h)a[h]>0&&(u+=(a[h]-0)*(a[h]-0)),e[h]<0&&(u+=(0-e[h])*(0-e[h]));return u},o.cZ=function(a){return a*a*a*a*a},o.c_=Q,o.ca=function(a,e,i,u,h,p,g){var w=1/(e-i),E=1/(u-h),P=1/(p-g);return a[0]=-2*w,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*E,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*P,a[11]=0,a[12]=(e+i)*w,a[13]=(h+u)*E,a[14]=(g+p)*P,a[15]=1,a},o.cb=te,o.cc=function(a,e,i){a[4*e+0]=i[0],a[4*e+1]=i[1],a[4*e+2]=i[2],a[4*e+3]=i[3]},o.cd=Uo,o.ce=Gs,o.cf=qi,o.cg=jr,o.ch=Xl,o.ci=z,o.cj=JM,o.ck=function(){var a=new R(4);return R!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},o.cl=function(a,e,i){var u=e[0],h=e[1],p=e[2],g=e[3],w=Math.sin(i),E=Math.cos(i);return a[0]=u*E+p*w,a[1]=h*E+g*w,a[2]=u*-w+p*E,a[3]=h*-w+g*E,a},o.cm=function(a,e){return a[0]===e[0]&&a[1]===e[1]&&a[2]===e[2]&&a[3]===e[3]},o.cn=Rn,o.co=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},o.cp=rl,o.cq=sr,o.cr=Es,o.cs=3,o.ct=2,o.cu=7,o.cv=6,o.cw=or,o.cx=$e,o.cy=Ln,o.cz=UC,o.d=function(a){return No.API_TILEJSON_REGEX.test(a)},o.d$=(a,e,i,u,h,p,g,w,E,P)=>{const O=a.transform,D=O.calculatePixelsToTileUnitsMatrix(e),L=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",U=O.pitch<15?oM(.07,.7,we((14-O.zoom)/5,0,1)):.07;return{u_matrix:sM(a,e,i,u),u_pixels_to_tile_units:D,u_device_pixel_ratio:p,u_width_scale:g,u_floor_width_scale:w,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:cM(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:aM(e,a.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:U,u_tile_to_meter:Pe(e.tileID.canonical,0),u_ground_shadow_factor:P}},o.d0=Fu,o.d1=function(a,e,i){const u=Math.sqrt(a*a+e*e+i*i),h=u>0?Math.acos(i/u)*tu:0;let p=a!==0||e!==0?Math.atan2(-e,-a)*tu+90:0;return p<0&&(p+=360),[u,p,h]},o.d2=bt,o.d3=ro,o.d4=Pe,o.d5=gt,o.d6=Rr,o.d7=Rt,o.d8=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},o.d9=K1,o.dA=st,o.dB=function(a){const e=Ee-5;a=we(a,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Cn(a))),3);return Math.round(i*(d.length-1))},o.dC=function(a,e,i,u){const h=e.getNorth(),p=e.getSouth(),g=e.getWest(),w=e.getEast(),E=1<<a.z,P=w-g,O=h-p,D=P/l,L=-O/d[i],U=[0,D,0,L,0,0,h,g,0];if(a.z>0){const $=180/u;K(U,U,[$/P+1,0,0,0,$/O+1,0,-.5*$/D,.5*$/L,1])}return U[2]=E,U[5]=a.x,U[8]=a.y,U},o.dD=W,o.dE=function(a,e,i){const u=H(new Float64Array(16)),h=(e/(1<<a)-.5)*Math.PI*2;return le(u,i.globeMatrix,h),Float32Array.from(u)},o.dF=class{isDataAvailableAtPoint(a){const e=this._source();if(this.isUsingMockSource()||!e||a.y<0||a.y>1)return!1;const i=e.getSource().maxzoom,u=1<<i,h=Math.floor(a.x),p=Math.floor((a.x-h)*u),g=Math.floor(a.y*u),w=this.findDEMTileFor(new Hi(i,h,i,p,g));return!(!w||!w.dem)}getAtPointOrZero(a,e=0){return this.getAtPoint(a,e)||0}getAtPoint(a,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const u=this._source();if(!u||a.y<0||a.y>1)return e;const h=u.getSource().maxzoom,p=1<<h,g=Math.floor(a.x),w=a.x-g,E=new Hi(h,g,h,Math.floor(w*p),Math.floor(a.y*p)),P=this.findDEMTileFor(E);if(!P||!P.dem)return e;const O=P.dem,D=1<<P.tileID.canonical.z,L=(w*D-P.tileID.canonical.x)*O.dim,U=(a.y*D-P.tileID.canonical.y)*O.dim,$=Math.floor(L),X=Math.floor(U);return(i?this.exaggeration():1)*Sr(Sr(O.get($,X),O.get($,X+1),U-X),Sr(O.get($+1,X),O.get($+1,X+1),U-X),L-$)}getAtTileOffset(a,e,i){const u=1<<a.canonical.z;return this.getAtPointOrZero(new Ie(a.wrap+(a.canonical.x+e/Wt)/u,(a.canonical.y+i/Wt)/u))}getAtTileOffsetFunc(a,e,i,u){return h=>{const p=this.getAtTileOffset(a,h.x,h.y),g=u.upVector(a.canonical,h.x,h.y);return qe(g,g,p*u.upVectorScale(a.canonical,e,i).metersToTile),g}}getForTilePoints(a,e,i,u){if(this.isUsingMockSource())return!1;const h=bg.create(this,a,u);return!!h&&(e.forEach((p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],i)})),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(a);if(!e||!e.dem)return null;const i=e.dem.tree,u=e.tileID,h=1<<a.canonical.z-u.canonical.z;let p=a.canonical.x/h-u.canonical.x,g=a.canonical.y/h-u.canonical.y,w=0;for(let E=0;E<a.canonical.z-u.canonical.z&&!i.leaves[w];E++){p*=2,g*=2;const P=2*Math.floor(g)+Math.floor(p);w=i.childOffsets[w]+P,p%=1,g%=1}return{min:this.exaggeration()*i.minimums[w],max:this.exaggeration()*i.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let e=!1,i=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const h of a){const p=this.getMinMaxForTile(h.tileID);p&&(i=Math.min(i,p.min),u=Math.max(u,p.max),e=!0)}return e?{min:i,max:u}:null}},o.dG=jI,o.dH=Hf,o.dI=function(a,e){return[Math.pow(a[0],2.2)*e,Math.pow(a[1],2.2)*e,Math.pow(a[2],2.2)*e]},o.dJ=F,o.dK=function(a,e){var i=Math.sin(e),u=Math.cos(e);return a[0]=u,a[1]=i,a[2]=0,a[3]=-i,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},o.dL=un,o.dM=Lo,o.dN=no,o.dO=ea,o.dP=256,o.dQ=function(a,e){const i=[0,0,0];return Ar(i,i,$r(W(e.canonical))),Ar(i,i,a),i},o.dR=a=>({u_matrix:new Xl(a),u_texsize:new jr(a),u_pixels_to_tile_units:new fp(a),u_device_pixel_ratio:new qi(a),u_width_scale:new qi(a),u_floor_width_scale:new qi(a),u_image:new Uo(a),u_units_to_pixels:new jr(a),u_tile_units_to_pixels:new qi(a),u_alpha_discard_threshold:new qi(a),u_trim_offset:new jr(a),u_trim_fade_range:new jr(a),u_trim_color:new Fu(a),u_emissive_strength:new qi(a),u_zbias_factor:new qi(a),u_tile_to_meter:new qi(a),u_ground_shadow_factor:new Gs(a),u_pattern_transition:new qi(a)}),o.dS=a=>({u_matrix:new Xl(a),u_pixels_to_tile_units:new fp(a),u_device_pixel_ratio:new qi(a),u_width_scale:new qi(a),u_floor_width_scale:new qi(a),u_units_to_pixels:new jr(a),u_dash_image:new Uo(a),u_gradient_image:new Uo(a),u_image_height:new qi(a),u_texsize:new jr(a),u_tile_units_to_pixels:new qi(a),u_alpha_discard_threshold:new qi(a),u_trim_offset:new jr(a),u_trim_fade_range:new jr(a),u_trim_color:new Fu(a),u_emissive_strength:new qi(a),u_zbias_factor:new qi(a),u_tile_to_meter:new qi(a),u_ground_shadow_factor:new Gs(a)}),o.dT=a=>({u_camera_to_center_distance:new qi(a),u_extrude_scale:new fp(a),u_device_pixel_ratio:new qi(a),u_matrix:new Xl(a),u_inv_rot_matrix:new Xl(a),u_merc_center:new jr(a),u_tile_id:new Gs(a),u_zoom_transition:new qi(a),u_up_dir:new Gs(a),u_emissive_strength:new qi(a)}),o.dU=qs,o.dV=M$,o.dW=sa,o.dX=(a,e,i,u,h,p)=>{const g=a.transform,w=g.projection.name==="globe";let E;if(p.paint.get("circle-pitch-alignment")==="map")if(w){const O=Lo(g.zoom,e.canonical)*g._pixelsPerMercatorPixel;E=Float32Array.from([O,0,0,O])}else E=g.calculatePixelsToTileUnitsMatrix(i);else E=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const P={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(g.projection),u_matrix:a.translatePosMatrix(e.projMatrix,i,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ps.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:jn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(w){P.u_inv_rot_matrix=u,P.u_merc_center=h,P.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],P.u_zoom_transition=pt(g.zoom);const O=h[0]*Wt,D=h[1]*Wt;P.u_up_dir=g.projection.upVector(new _a(0,0,0),O,D)}return P},o.dY=lM,o.dZ=Ia,o.d_=(a,e,i,u,h,p,g,w,E,P)=>{const O=a.transform,D=O.pitch<15?oM(.07,.7,we((14-O.zoom)/5,0,1)):.07,L=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:sM(a,e,i,u),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:O.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_width_scale:p,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:aM(e,O),u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(L?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:D,u_tile_to_meter:Pe(e.tileID.canonical,0),u_ground_shadow_factor:E,u_pattern_transition:P}},o.da=function(a,e){return a.readFields(E6,{icons:[]},e)},o.db=Kv,o.dc=yg,o.dd=N1,o.de=rf,o.df=Ud,o.dg=ua,o.dh=gc,o.di=Jr,o.dj=function(a){const e=a.indexOf(kc);return e>=0?a.slice(0,e):a},o.dk=function(a){return a.indexOf(kc)>=0},o.dl=function(a){const e=a.lastIndexOf(kc);return e>=0?a.slice(e+1):""},o.dm=function(a){const e=[],i=a.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),a.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.dn=function(a,e,i,u){return a.type==="custom"?new v6(a,e):new S6[a.type](a,e,i,u)},o.dp=ln,o.dq=function(a){const e=a.indexOf(kc);return e>=0?a.slice(e+1):""},o.dr=class extends Eg{constructor(a,e){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},o.ds=Ah,o.dt=ll,o.du=function(a){return a({pluginStatus:To,pluginURL:Gl}),Ah.on("pluginStateChange",a),a},o.dv=cp,o.dw=class extends Ma{constructor(a){super(a),this.current=up}set(a,e,i){if(this.fetchUniformLocation(a,e)){for(let u=0;u<9;u++)if(i[u]!==this.current[u]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.dx=se,o.dy=function(a,e,i){const u=pt(i.zoom),h=a.style.map._antialias,p=a.terrain&&a.terrain.exaggeration()>0;return u===0&&!h&&!p},o.dz=function(a){const e=a.pixelsPerMeter,i=e/te(1,a.center.lat),u=H(new Float64Array(16));return fe(u,u,[a.point.x,a.point.y,0]),ue(u,u,[i,i,e]),Float32Array.from(u)},o.e=No,o.e$=Lf,o.e0=xr,o.e1=k_,o.e2=ye,o.e3=Nu,o.e4=Zv,o.e5=xC,o.e6=mp,o.e7=450,o.e8=7,o.e9=Re,o.eA=function(a,e,i,u,h,p,g,w,E,P,O,D,L,U,$,X){var J=new R(16);return J[0]=a,J[1]=e,J[2]=i,J[3]=u,J[4]=h,J[5]=p,J[6]=g,J[7]=w,J[8]=E,J[9]=P,J[10]=O,J[11]=D,J[12]=L,J[13]=U,J[14]=$,J[15]=X,J},o.eB=C,o.eC=tm,o.eD=Dh,o.eE=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new kt(1/0,1/0),max:new kt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,e=!1){const i=aC(new kt(0,0),new kt(Wt,Wt),a),u=[];if(e&&!c1(i,this._globalClipBounds))return u;for(const h of this._activeRegions){if(h.hiddenByOverlap||!c1(i,h))continue;const p=IV(h.min,h.max,a);u.push({min:p.min,max:p.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return u}setSources(a){this._setSources(a.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const u of e.cache.getVisibleCoordinates()){const h=e.cache.getTile(u).buckets[e.layer];h&&h.updateFootprints(u.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(a){const e=a.getFootprints();if(e.length===0)return;const i=a.getOrder(),u=a.getClipMask(),h=a.getClipScope();for(const p of e){if(!p.footprint)continue;const g=aC(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:i,clipMask:u,clipScope:h})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,i)=>e.priority-i.priority||Gv(e.min,i.min)||Gv(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(u,h){const p=(g,w)=>g+w;return u.length-h.length||u.reduce(p,"").localeCompare(h.reduce(p,""))})(e.clipScope,i.clipScope)));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let e=0;for(;!a&&e!==this._activeRegions.length;){const i=this._activeRegions[e],u=this._prevRegions[e];a=i.priority!==u.priority||!oC(i,u)||i.order!==u.order||i.clipMask!==u.clipMask||!sl(i.clipScope,u.clipScope),++e}}if(a){++this._updateTime;for(const i of this._activeRegions)i.order!==j_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const u=this._activeRegions;if(i>=u.length)return i;const h=u[i].priority;for(;i<u.length&&u[i].priority===h;)++i;return i};if(this._sourceIds.length>1){let i=0,u=e(i);for(;i!==u;){let h=i;const p=i;for(;h!==u;){const g=this._activeRegions[h];g.hiddenByOverlap=!1;for(let w=0;w<p;w++){const E=this._activeRegions[w];if(!E.hiddenByOverlap&&g.order===j_&&c1(g,E)&&(g.hiddenByOverlap=sC(g.footprint,g.tileId,E.footprint,E.tileId),g.hiddenByOverlap))break}++h}i=u,u=e(i)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=a.length-1;e>=0;e--)this._addSource(a[e]);this._computeReplacement()}},o.eF=j_,o.eG=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,e){const i=new ma,u=new ai,h=[],p=a+1+2,g=e[0]+1,w=e[0]+1+(1+e.length),E=(P,O,D)=>{let L=P===p-1?P-2:P===0?P:P-1;return L+=D?24575:0,[L,O]};for(let P=0;P<p;++P)i.emplaceBack(...E(P,0,!0));for(let P=0;P<g;++P)for(let O=0;O<p;++O)i.emplaceBack(...E(O,P,(O===0||O===p-1)&&!0));for(let P=0;P<e.length;++P){const O=e[P];for(let D=0;D<p;++D)i.emplaceBack(...E(D,O,!0))}for(let P=0;P<e.length;++P){const O=u.length,D=e[P]+1+2,L=new ai;for(let X=0;X<D-1;X++){const J=X===D-2,ie=J?p*(w-e.length+P-X):p;for(let de=0;de<p-1;de++){const he=X*p+de;X===0||J||de===0||de===p-2?(L.emplaceBack(he+1,he,he+ie),L.emplaceBack(he+ie,he+ie+1,he+1)):(u.emplaceBack(he+1,he,he+ie),u.emplaceBack(he+ie,he+ie+1,he+1))}}const U=Si.simpleSegment(0,O,i.length,u.length-O);for(let X=0;X<L.uint16.length;X+=3)u.emplaceBack(L.uint16[X],L.uint16[X+1],L.uint16[X+2]);const $=Si.simpleSegment(0,O,i.length,u.length-O);h.push({withoutSkirts:U,withSkirts:$})}return{vertices:i,indices:u,segments:h}}_createGrid(a){const e=this._fillGridMeshWithLods(l,d);this._gridSegments=e.segments,this._gridBuffer=a.createVertexBuffer(e.vertices,Nv.members),this._gridIndexBuffer=a.createIndexBuffer(e.indices,!0)}_createPoles(a){const e=new ai;for(let g=0;g<=l;g++)e.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=a.createIndexBuffer(e,!0);const i=new Bc,u=new Bc,h=new Bc,p=new Bc;this._poleSegments=[];for(let g=0,w=0;g<cm;g++){const E=360/(1<<g);i.emplaceBack(0,-Xo,0,.5,0),u.emplaceBack(0,-Xo,0,.5,1),h.emplaceBack(0,-Xo,0,.5,.5),p.emplaceBack(0,-Xo,0,.5,.5);for(let P=0;P<=l;P++){let O=P/l,D=0;const L=Sr(0,E,O),[U,$,X]=S(En,An,L,Xo);i.emplaceBack(U,$,X,O,D),u.emplaceBack(U,$,X,O,1-D);const J=Cn(L);O=.5+.5*Math.sin(J),D=.5+.5*Math.cos(J),h.emplaceBack(U,$,X,O,D),p.emplaceBack(U,$,X,O,1-D)}this._poleSegments.push(Si.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(i,lg,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,lg,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(h,lg,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(p,lg,!1)}getGridBuffers(a,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},o.eH=nC,o.eI=be,o.eJ=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eK=ke,o.eL=Ae,o.eM=function(a,e,i){return a[0]=e[0]/i[0],a[1]=e[1]/i[1],a[2]=e[2]/i[2],a},o.eN=hi,o.eO=A,o.eP=Mr,o.eQ=St,o.eR=function([a,e,i]){const u=Math.hypot(a,e,i),h=Math.atan2(a,i),p=.5*Math.PI-Math.acos(-e/u);return new z(et(h),et(p))},o.eS=po,o.eT=T1,o.eU=function(a){const e=a.navigator?a.navigator.userAgent:null;return!!(function(i){if(wi==null){const u=i.navigator?i.navigator.userAgent:null;wi=!!i.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return wi})(a)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.eV=function(a,e){ns=a,oi=e},o.eW=Pr,o.eX=jt,o.eY=function(a){const e=[0,0,0],i=H(new Float64Array(16));return ae(i,a.pixelMatrix,a.globeMatrix),Ar(e,e,i),new kt(e[0],e[1])},o.eZ=function(){const a=H_;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(g1),H_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.e_=function(){Kv().acquire(g1)},o.ea=function(a,e){if(a===e){var i=e[1],u=e[2],h=e[3],p=e[6],g=e[7],w=e[11];a[1]=e[4],a[2]=e[8],a[3]=e[12],a[4]=i,a[6]=e[9],a[7]=e[13],a[8]=u,a[9]=p,a[11]=e[14],a[12]=h,a[13]=g,a[14]=w}else a[0]=e[0],a[1]=e[4],a[2]=e[8],a[3]=e[12],a[4]=e[1],a[5]=e[5],a[6]=e[9],a[7]=e[13],a[8]=e[2],a[9]=e[6],a[10]=e[10],a[11]=e[14],a[12]=e[3],a[13]=e[7],a[14]=e[11],a[15]=e[15];return a},o.eb=y6,o.ec=mn,o.ed=rp,o.ee=256,o.ef=Kr,o.eg=ga,o.eh=le,o.ei=function(a,e){return a[0]=e[0],a[1]=e[1],a[2]=e[2],a[3]=e[4],a[4]=e[5],a[5]=e[6],a[6]=e[8],a[7]=e[9],a[8]=e[10],a},o.ej=Bc,o.ek=ep,o.el=Mc,o.em=function(a,e,i,u,h){return we((a-e)/(i-e)*(h-u)+u,u,h)},o.en=tl,o.eo=function(a,e){var i=e[0],u=e[1],h=e[2],p=e[3],g=e[4],w=e[5],E=e[6],P=e[7],O=e[8],D=O*g-w*P,L=-O*p+w*E,U=P*p-g*E,$=i*D+u*L+h*U;return $?(a[0]=D*($=1/$),a[1]=(-O*u+h*P)*$,a[2]=(w*u-h*g)*$,a[3]=L*$,a[4]=(O*i-h*E)*$,a[5]=(-w*i+h*p)*$,a[6]=U*$,a[7]=(-P*i+u*E)*$,a[8]=(g*i-u*p)*$,a):null},o.ep=2,o.eq=Gr,o.er=E1,o.es=[1,1,1],o.et=class{constructor(a,e,i,u){this.context=a,this.format=u,this.size=i,this.texture=a.gl.createTexture();const[h,p,g]=this.size,{gl:w}=a;w.bindTexture(w.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),w.texImage3D(w.TEXTURE_3D,0,this.format,h,p,g,0,b1(this.format),w1(this.format),e.data)}bind(a,e){const{context:i}=this,{gl:u}=i;u.bindTexture(u.TEXTURE_3D,this.texture),a!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,a),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,a),this.minFilter=a),e!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,e),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},o.eu=bg,o.ev=Sa,o.ew=function(a,e,i,u){var h=e[0],p=e[1],g=e[2],w=e[3];return a[0]=h+u*(i[0]-h),a[1]=p+u*(i[1]-p),a[2]=g+u*(i[2]-g),a[3]=w+u*(i[3]-w),a},o.ex=mg,o.ey=$s,o.ez=Eo,o.f=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,((e,i)=>String.fromCharCode(+("0x"+i)))))},o.f0=function(a,e,i=!1){if(To===Oo.deferred||To===Oo.loading||To===Oo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Gl=ps.resolveURL(a),To=Oo.deferred,kf=e,Qi(),i||Vd()},o.f1=function(a){fg=ps.resolveURL(a),dg||(dg=new hg(Kv(),new _c)),dg.broadcast("setMeshoptUrl",fg)},o.f2=DC,o.f3=function(a){y1=ps.resolveURL(a),dg||(dg=new hg(Kv(),new _c)),dg.broadcast("setDracoUrl",y1)},o.f4=RC,o.f5=G_,o.f6=function(a){const e=hc();if(!e)return;const i=e.delete(Pl);a&&i.then((()=>a())).catch(a)},o.f7=pm,o.f8=ir,o.f9=pp,o.fa=Uu,o.fb=rR,o.fc=nR,o.fd=tM,o.fe=Jt,o.ff="hd_road_elevation",o.fg=Ti,o.fh=Nr,o.fi=fm,o.fj=B1,o.fk=_m,o.fl=function(a,e,i,u,h,p,g,w=1,E,P,O){a.createArrays(),a.tilePixelRatio=Wt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const D=a.layers[0].layout,L=a.layers[0]._unevaluatedLayout._values,U={};U.scaleFactor=w,U.textSizeScaleRange=D.get("text-size-scale-range"),U.iconSizeScaleRange=D.get("icon-size-scale-range");const[$,X]=U.textSizeScaleRange,[J,ie]=U.iconSizeScaleRange;U.textScaleFactor=we(U.scaleFactor,$,X),U.iconScaleFactor=we(U.scaleFactor,J,ie);const de=L["text-size"],he=L["icon-size"];if(a.textSizeData.kind==="composite"){const{minZoom:Ue,maxZoom:ut}=a.textSizeData;U.compositeTextSizes=[de.possiblyEvaluate(new Un(Ue,{worldview:O}),p),de.possiblyEvaluate(new Un(ut,{worldview:O}),p)]}if(a.iconSizeData.kind==="composite"){const{minZoom:Ue,maxZoom:ut}=a.iconSizeData;U.compositeIconSizes=[he.possiblyEvaluate(new Un(Ue,{worldview:O}),p),he.possiblyEvaluate(new Un(ut,{worldview:O}),p)]}U.layoutTextSize=de.possiblyEvaluate(new Un(g+1,{worldview:O}),p),U.layoutIconSize=he.possiblyEvaluate(new Un(g+1,{worldview:O}),p),U.textMaxSize=de.possiblyEvaluate(new Un(18,{worldview:O}),p);const ge=D.get("symbol-placement"),Fe=D.get("text-rotation-alignment")==="map"&&ge!=="point",Me=D.get("text-size");let Oe=!1;const je=[];for(const Ue of a.features){const ut=D.get("text-font").evaluate(Ue,{},p).join(","),Ze=Me.evaluate(Ue,{},p)*U.textScaleFactor,_t=U.layoutTextSize.evaluate(Ue,{},p)*U.textScaleFactor,qt=U.layoutIconSize.evaluate(Ue,{},p)*U.iconScaleFactor,Et={horizontal:{},vertical:void 0},Lt=Ue.text;let Ut,lt=[0,0];if(Lt){const nr=Lt.toString(),Cr=D.get("text-letter-spacing").evaluate(Ue,{},p)*Jo,Fr=D.get("text-line-height").evaluate(Ue,{},p)*Jo,Zr=jd(nr)?Cr:0,qr=D.get("text-anchor").evaluate(Ue,{},p),yn=D.get("text-variable-anchor");if(!yn){const at=D.get("text-radial-offset").evaluate(Ue,{},p);if(at)lt=jM(qr,[at*Jo,j1]);else{const Ht=D.get("text-offset").evaluate(Ue,{},p);lt=[Ht[0]*Jo,Ht[1]*Jo]}}let nn=Fe?"center":D.get("text-justify").evaluate(Ue,{},p);const di=ge==="point",ve=di?D.get("text-max-width").evaluate(Ue,{},p)*Jo:1/0,xe=at=>{a.allowVerticalPlacement&&xl(nr)&&(Et.vertical=L1(Lt,e,i,h,ut,ve,Fr,qr,at,Zr,lt,Xs.vertical,!0,_t,Ze,E))};if(!Fe&&yn){const at=nn==="auto"?yn.map((Yt=>U1(Yt))):[nn];let Ht=!1;for(let Yt=0;Yt<at.length;Yt++){const Kt=at[Yt];if(!Et.horizontal[Kt])if(Ht)Et.horizontal[Kt]=Et.horizontal[0];else{const hr=L1(Lt,e,i,h,ut,ve,Fr,"center",Kt,Zr,lt,Xs.horizontal,!1,_t,Ze,E);hr&&(Et.horizontal[Kt]=hr,Ht=hr.positionedLines.length===1)}}xe("left")}else{if(nn==="auto"&&(nn=U1(qr)),di||D.get("text-writing-mode").indexOf("horizontal")>=0||!xl(nr)){const at=L1(Lt,e,i,h,ut,ve,Fr,qr,nn,Zr,lt,Xs.horizontal,!1,_t,Ze,E);at&&(Et.horizontal[nn]=at)}xe(di?"left":nn)}}let zt,Qe,ct,Gt,Ft,gr,lr=!1;const Ot=D.get("icon-text-fit").evaluate(Ue,{},p);if(Ue.icon&&Ue.icon.hasPrimary()){const nr=VM(Ue.icon,a.iconSizeData,L["icon-size"],p,a.zoom,Ue,E,U.iconScaleFactor,O);zt=nr.iconPrimary,ct=nr.iconSecondary;const Cr=zt.toString();if(Qe=u.get(Cr),Qe&&(Ft=D.get("icon-offset").evaluate(Ue,{},p),gr=D.get("icon-anchor").evaluate(Ue,{},p),Ut=Z$(h.get(Cr),ct?h.get(ct.toString()):void 0,Ft,gr),lr=Qe.sdf,a.sdfIcons===void 0?a.sdfIcons=Qe.sdf:a.sdfIcons!==Qe.sdf&&fn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Qe.pixelRatio!==a.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0)),ct){const Fr=ct.toString();Gt=u.get(Fr)}}Oe=Oe||!(!Ue.icon||!Ue.icon.hasSecondary());const Nt=V1(Et.horizontal)||Et.vertical;a.iconsInText||(a.iconsInText=!!Nt&&Nt.iconsInText);const fr=_t*U.textScaleFactor/Jo,{defaultShapedIcon:tr,verticallyShapedIcon:Xt}=i6(a,Ut,D,Ue,p,Et,fr,Ft,Ot);Ot!=="none"&&Ut&&(TM(Ut)||EM(Ut))&&(lx(0,Qe,zt,Ut,tr,Ot,P,u,h),lx(0,Gt,ct,Ut,tr,Ot,P,u,h),Xt&&(lx(0,Qe,zt,Ut,Xt,Ot,P,u,h),lx(0,Gt,ct,Ut,Xt,Ot,P,u,h))),Ut=tr,je.push({feature:Ue,shapedTextOrientations:Et,shapedText:Nt,shapedIcon:Ut,iconPrimary:zt,iconSecondary:ct,iconOffset:Ft,iconAnchor:gr,verticallyShapedIcon:Xt,layoutTextSize:_t,layoutIconSize:qt,textOffset:lt,isSDFIcon:lr,iconTextFit:Ot})}return{featureData:je,sizes:U,hasAnySecondaryIcon:Oe,textAlongLine:Fe,symbolPlacement:ge}},o.fm=kM,o.fn=function(a,e,i,u,h,p,g,w,E,P){const{featureData:O,hasAnySecondaryIcon:D,sizes:L,textAlongLine:U,symbolPlacement:$}=e;for(const X of O){const{shapedIcon:J,verticallyShapedIcon:ie,feature:de,shapedTextOrientations:he,shapedText:ge,layoutTextSize:Fe,textOffset:Me,isSDFIcon:Oe,iconPrimary:je,iconSecondary:Ue,iconTextFit:ut,iconOffset:Ze}=X;$M(J,P.iconPositions,je,Ue),$M(ie,P.iconPositions,je,Ue),n6(he,P.iconPositions),r6(je,Ue,P.iconPositions),(ge||J)&&o6(a,de,he,J,ie,E,L,Fe,0,Me,Oe,u,h,g,w,D,ut,Ze,U,$)}i&&a.generateCollisionDebugBuffers(p,a.collisionBoxArray,L.textScaleFactor)},o.fo=cr,o.fp=Ix,o.fq=tt,o.fr=function(a){let e=0;if(new Uint32Array(a,0,1)[0]!==LC){const i=new Uint32Array(a,0,7),[,,u,h,p,g]=i;e=i.byteLength+h+p+g+p,(u!==a.byteLength||e>=a.byteLength)&&fn("Invalid b3dm header information.")}return NC(a,e)},o.fs=function(a,e){const i=WC(a);for(const u of i){for(const h of u.meshes)o$(h);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(a$(u.lights,e)))}return i},o.ft=wx,o.fu=qn,o.fv=MC,o.fw=hs,o.fx=Oo,o.fy=function(a){ou(),Rs?.then((e=>{e.keys().then((i=>{for(let u=0;u<i.length-a;u++)e.delete(i[u]).catch((h=>fn(h.message)))})).catch((i=>fn(i.message)))})).catch((e=>fn(e.message)))},o.g=function(a,e){return ll(nt(a,{method:"GET"}),e)},o.h=nt,o.i=function(a){return No.API_STYLE_REGEX.test(a)&&!gd(a)},o.j=function(a){return a.indexOf("mapbox:")===0},o.k=sc,o.l=tf,o.m=function(a){return decodeURIComponent(atob(a).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},o.n=function(a,e){return ll(nt(a,{type:"json"}),e)},o.o=Il,o.p=function(a,e){return ll(nt(a,{method:"POST"}),e)},o.q=ps,o.r=ya,o.s=function(a){try{const e=self[a];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=Ju,o.u=function(){return(function a(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)})()},o.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},o.w=fn,o.x=function(){return _1||(_1=new pm),_1},o.y=nw,o.z=Co})),v(["./shared"],(function(o){function M(et){const oe=et?et.url.toString():void 0;return oe?performance.getEntriesByName(oe):[]}function R(et){if(typeof et=="number"||typeof et=="boolean"||typeof et=="string"||et==null)return JSON.stringify(et);if(Array.isArray(et)){let se="[";for(const be of et)se+=`${R(be)},`;return`${se}]`}let oe="{";for(const se of Object.keys(et).sort())oe+=`${se}:${R(et[se])},`;return`${oe}}`}function B(et){let oe="";for(const se of o.bu)oe+=`/${R(et[se])}`;return oe}class F{constructor(oe){this.keyCache={},this._layers={},this._layerConfigs={},oe&&this.replace(oe)}replace(oe,se){this._layerConfigs={},this._layers={},this.update(oe,[],se)}update(oe,se,be){this._options=be;for(const we of oe)this._layerConfigs[we.id]=we,(this._layers[we.id]=o.dn(we,this.scope,null,this._options)).compileFilter(be),this.keyCache[we.id]&&delete this.keyCache[we.id];for(const we of se)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const ke=(function(we,Ne){const it={};for(let nt=0;nt<we.length;nt++){const $t=we[nt];let Tt=Ne&&Ne[$t.id];Tt||($t.type==="symbol"?Tt=$t.id:(Tt=B($t),$t.type==="line"&&$t.paint&&(function Or(Nr){return typeof Nr=="string"&&Nr==="line-progress"||(Array.isArray(Nr)?Nr.some(Or):!(!Nr||typeof Nr!="object")&&Object.values(Nr).some(Or))})($t.paint["line-width"])&&(Tt+=`/${R($t.paint["line-width"])}`))),Ne&&(Ne[$t.id]=Tt);let xr=it[Tt];xr||(xr=it[Tt]=[]),xr.push($t)}const Ve=[];for(const nt in it)Ve.push(it[nt]);return Ve})(Object.values(this._layerConfigs),this.keyCache);for(const we of ke){const Ne=we.map((xr=>this._layers[xr.id])),it=Ne[0];if(it.visibility==="none")continue;const Ve=it.source||"";let nt=this.familiesBySource[Ve];nt||(nt=this.familiesBySource[Ve]={});const $t=it.sourceLayer||"_geojsonTileLayer";let Tt=nt[$t];Tt||(Tt=nt[$t]=[]),Tt.push(Ne)}}}const G=1*o.fa;class K{constructor(oe){const se={},be=[];for(const it in oe){const Ve=oe[it],nt=se[it]={};for(const $t in Ve.glyphs){const Tt=Ve.glyphs[+$t];if(!Tt||Tt.bitmap.width===0||Tt.bitmap.height===0)continue;const xr=Tt.metrics.localGlyph?G:1,Or={x:0,y:0,w:Tt.bitmap.width+2*xr,h:Tt.bitmap.height+2*xr};be.push(Or),nt[$t]=Or}}const{w:ke,h:we}=o.H(be),Ne=new o.f9({width:ke||1,height:we||1});for(const it in oe){const Ve=oe[it];for(const nt in Ve.glyphs){const $t=Ve.glyphs[+nt];if(!$t||$t.bitmap.width===0||$t.bitmap.height===0)continue;const Tt=se[it][nt],xr=$t.metrics.localGlyph?G:1;o.f9.copy($t.bitmap,Ne,{x:0,y:0},{x:Tt.x+xr,y:Tt.y+xr},$t.bitmap)}}this.image=Ne,this.positions=se}}o.f8(K,"GlyphAtlas");class ee{constructor(oe){this.tileID=new o.aM(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.lut=oe.lut,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.scope=oe.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=oe.showCollisionBoxes,this.collectResourceTiming=!!oe.request&&oe.request.collectResourceTiming,this.promoteId=oe.promoteId,this.isSymbolTile=oe.isSymbolTile,this.tileTransform=o.aW(oe.tileID.canonical,oe.projection),this.projection=oe.projection,this.worldview=oe.worldview,this.localizableLayerIds=oe.localizableLayerIds,this.brightness=oe.brightness,this.extraShadowCaster=!!oe.extraShadowCaster,this.tessellationStep=oe.tessellationStep,this.scaleFactor=oe.scaleFactor,this.worldview=oe.worldview}parse(oe,se,be,ke,we,Ne){this.status="parsing",this.data=oe,this.collisionBoxArray=new o.b0;const it=new o.fb(Object.keys(oe.layers).sort()),Ve=new o.fc(this.tileID,this.promoteId);Ve.bucketLayerIDs=[];const nt={},$t=new o.fd(256,256),Tt={featureIndex:Ve,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:$t,availableImages:be,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},xr=[],Or=se.familiesBySource[this.source];for(const ln in Or){const Jr=oe.layers[ln];if(!Jr)continue;let hn=!1,Yn=!1,fn=!1;for(const qn of Or[ln])qn[0].type==="symbol"?hn=!0:Yn=!0,qn[0].is3D()&&qn[0].type!=="model"&&(fn=!0);if(this.extraShadowCaster&&!fn||this.isSymbolTile===!0&&!hn||this.isSymbolTile===!1&&!Yn)continue;Jr.version===1&&o.w(`Vector tile source "${this.source}" layer "${ln}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Fi=it.encode(ln),$n=[];let ro=!1;for(let qn=0,Dn=0;qn<Jr.length;qn++){const wi=Jr.feature(qn),Ei=Ve.getId(wi,ln);if(this.localizableLayerIds&&this.localizableLayerIds.has(ln)){const _i=wi.properties?wi.properties.worldview:null;if(this.worldview&&typeof _i=="string")if(_i==="all")wi.properties.$localized=!0;else{if(!_i.split(",").includes(this.worldview))continue;wi.properties.$localized=!0,wi.properties.worldview=this.worldview}}!ro&&wi.properties&&wi.properties.hasOwnProperty(o.fe)&&(ro=!0),$n.push({feature:wi,id:Ei,index:Dn,sourceLayerIndex:Fi}),Dn++}ro&&!Tt.elevationFeatures&&oe.layers.hasOwnProperty(o.ff)&&(Tt.elevationFeatures=o.fg.parseFrom(oe.layers[o.ff],this.canonical));for(const qn of Or[ln]){const Dn=qn[0];if(this.extraShadowCaster&&(!Dn.is3D()||Dn.type==="model")||this.isSymbolTile!==void 0&&Dn.type==="symbol"!==this.isSymbolTile||Dn.minzoom&&this.zoom<Math.floor(Dn.minzoom)||Dn.maxzoom&&this.zoom>=Dn.maxzoom||Dn.visibility==="none")continue;H(qn,this.zoom,Tt.brightness,be,this.worldview);const wi=nt[Dn.id]=Dn.createBucket({index:Ve.bucketLayerIDs.length,layers:qn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:ke,worldview:this.worldview});Ve.bucketLayerIDs.push(qn.map((_i=>o.C(_i.id,_i.scope))));let Ei=wi.prepare?wi.prepare():null;Ei!=null?(Ei=Ei.then((()=>wi.populate($n,Tt,this.tileID.canonical,this.tileTransform))),xr.push(Ei)):wi.populate($n,Tt,this.tileID.canonical,this.tileTransform)}}const Nr=()=>{let ln,Jr,hn,Yn,fn,Fi;$t.trim();const $n={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ro=()=>{if(ln)return this.status="done",Ne(ln);if(this.extraShadowCaster)this.status="done",Ne(null,{buckets:Object.values(nt).filter((Dn=>!Dn.isEmpty())),featureIndex:Ve,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Tt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Jr&&hn&&Yn){const Dn=new K(Jr),wi=new Map;for(const[ao,no]of hn.entries()){const{imagePosition:ea}=o.fj(ao,no,o.fk);wi.set(ao,ea)}const Ei={};for(const ao in nt){const no=nt[ao];no instanceof o.b1&&(H(no.layers,this.zoom,Tt.brightness,be,this.worldview),Ei[ao]=o.fl(no,Jr,Dn.positions,hn,wi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,fn,this.worldview))}const _i={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(we,hn,fn,(()=>{_i.iconsPending=!1,qn(Ei,Dn,_i)})),this.rasterizeIfNeeded(we,Yn,Fi,(()=>{_i.patternsPending=!1,qn(Ei,Dn,_i)}))}},qn=(Dn,wi,Ei,_i)=>{if(Ei.iconsPending||Ei.patternsPending)return;const ao=new o.fm(hn,Yn,this.lut);for(const no in nt){const ea=nt[no];if(no in Dn)o.fn(ea,Dn[no],this.showCollisionBoxes,be,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,hn,ao);else if(ea.hasPattern&&(ea instanceof o.b7||ea instanceof o.b8||ea instanceof o.e4)){H(ea.layers,this.zoom,Tt.brightness,be,this.worldview);const Ea=Object.fromEntries(ao.patternPositions);ea.addFeatures(Tt,this.tileID.canonical,Ea,be,this.tileTransform,this.brightness)}}this.status="done",Ne(null,{buckets:Object.values(nt).filter((no=>!no.isEmpty())),featureIndex:Ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:wi.image,lineAtlas:$t,imageAtlas:ao,brightness:Tt.brightness})};if(!this.extraShadowCaster){const Dn=o.fh(Tt.glyphDependencies,(_i=>Object.keys(_i).map(Number)));Object.keys(Dn).length?we.send("getGlyphs",{uid:this.uid,stacks:Dn},((_i,ao)=>{ln||(ln=_i,Jr=ao,ro())}),void 0,!1,$n):Jr={};const wi=Array.from(Tt.iconDependencies.keys()).map((_i=>o.I.parse(_i)));wi.length?we.send("getImages",{images:wi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((_i,ao)=>{ln||(ln=_i,hn=new Map,fn=this.updateImageMapAndGetImageTaskQueue(hn,ao,Tt.iconDependencies),ro())}),void 0,!1,$n):(hn=new Map,fn=new Map);const Ei=Array.from(Tt.patternDependencies.keys()).map((_i=>o.I.parse(_i)));Ei.length?we.send("getImages",{images:Ei,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((_i,ao)=>{ln||(ln=_i,Yn=new Map,Fi=this.updateImageMapAndGetImageTaskQueue(Yn,ao,Tt.patternDependencies),ro())}),void 0,!1,$n):(Yn=new Map,Fi=new Map)}if(Tt.elevationFeatures&&Tt.elevationFeatures.length>0){const Dn=[];for(const Ei of Object.values(nt))if(Ei instanceof o.b8){const _i=Ei.getUnevaluatedPortalGraph();_i&&Dn.push(_i)}const wi=o.fi.evaluate(Dn);for(const Ei of Object.values(nt))if(Ei instanceof o.b8){const _i=oe.layers[it.decode(Ei.sourceLayerIndex)];Ei.setEvaluatedPortalGraph(wi,_i,this.tileID.canonical,Tt.availableImages,Tt.brightness)}}ro()};xr.length>0?Promise.allSettled(xr).then(Nr).catch(Ne):Nr()}rasterizeIfNeeded(oe,se,be,ke){Array.from(se.values()).some((we=>we.usvg))?this.rasterize(oe,se,be,ke):ke()}updateImageMapAndGetImageTaskQueue(oe,se,be){const ke=new Map;for(const we of se.keys()){const Ne=be.get(we)||[];for(const it of Ne){const Ve=it.toString(),nt=se.get(it.id.toString());nt.usvg?ke.has(Ve)||(ke.set(Ve,it),oe.set(Ve,Object.assign({},nt))):oe.set(Ve,nt)}}return ke}rasterize(oe,se,be,ke){this.rasterizeTask=oe.send("rasterizeImages",{scope:this.scope,tasks:be},((we,Ne)=>{if(!we)for(const[it,Ve]of Ne.entries()){const nt=Object.assign(se.get(it),{data:Ve});se.set(it,nt)}ke()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function H(et,oe,se,be,ke){const we=new o.aa(oe,{brightness:se,worldview:ke});for(const Ne of et)Ne.recalculate(we,be)}class Z extends o.E{constructor(oe,se,be,ke,we,Ne,it){super(),this.actor=oe,this.layerIndex=se,this.availableImages=be,this.availableModels=ke,this.loadVectorData=Ne||o.aJ,this.loading={},this.loaded={},this.deduped=new o.aI(oe.scheduler),this.isSpriteLoaded=we,this.scheduler=oe.scheduler,this.brightness=it}loadTile(oe,se){const be=oe.uid,ke=oe&&oe.request,we=ke&&ke.collectResourceTiming,Ne=this.loading[be]=new ee(oe);Ne.abort=this.loadVectorData(oe,((it,Ve)=>{const nt=!this.loading[be];if(delete this.loading[be],Ne.cancelRasterize(),nt||it||!Ve)return Ne.status="done",nt||(this.loaded[be]=Ne),se(it);const $t=Ve.rawData,Tt={};Ve.expires&&(Tt.expires=Ve.expires),Ve.cacheControl&&(Tt.cacheControl=Ve.cacheControl),Ne.vectorTile=Ve.vectorTile||new o.fo(new o.bq($t));const xr=()=>{Ne.parse(Ne.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((Or,Nr)=>{if(Or||!Nr)return se(Or);const ln={};if(we){const Jr=M(ke);Jr.length>0&&(ln.resourceTiming=JSON.parse(JSON.stringify(Jr)))}se(null,o.h({rawTileData:$t.slice(0)},Nr,Tt,ln))}))};this.isSpriteLoaded?xr():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(xr,{type:"parseTile",isSymbolTile:oe.isSymbolTile,zoom:oe.tileZoom}):xr()})),this.loaded=this.loaded||{},this.loaded[be]=Ne}))}reloadTile(oe,se){const be=this.loaded,ke=oe.uid;if(be&&be[ke]){const we=be[ke];we.scaleFactor=oe.scaleFactor,we.showCollisionBoxes=oe.showCollisionBoxes,we.projection=oe.projection,we.brightness=oe.brightness,we.tileTransform=o.aW(oe.tileID.canonical,oe.projection),we.extraShadowCaster=oe.extraShadowCaster,we.lut=oe.lut,we.worldview=oe.worldview;const Ne=(it,Ve)=>{const nt=we.reloadCallback;nt&&(delete we.reloadCallback,we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,nt)),se(it,Ve)};we.status==="parsing"?we.reloadCallback=Ne:we.status==="done"&&(we.vectorTile?we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ne):Ne())}else se(null,void 0)}abortTile(oe,se){const be=oe.uid,ke=this.loading[be];ke&&(ke.abort&&ke.abort(),delete this.loading[be]),se()}removeTile(oe,se){const be=this.loaded,ke=oe.uid;be&&be[ke]&&delete be[ke],se()}}class ae{loadTile(oe,se){const{uid:be,encoding:ke,rawImageData:we,padding:Ne}=oe,it=ImageBitmap&&we instanceof ImageBitmap?this.getImageData(we,Ne):we;se(null,new o.fp(be,it,ke,Ne<1))}reloadTile(oe,se){se(null,null)}abortTile(oe,se){se()}removeTile(oe,se){se()}getImageData(oe,se){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(oe.width,oe.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=oe.width,this.offscreenCanvas.height=oe.height,this.offscreenCanvasContext.drawImage(oe,0,0,oe.width,oe.height);const be=this.offscreenCanvasContext.getImageData(-se,-se,oe.width+2*se,oe.height+2*se);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),be}}o.bp.setPbf(o.bq);class fe{constructor(oe){this._mrt=new o.bp(oe.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=oe.uid,this.tileID=oe.tileID,this.source=oe.source}parse(oe,se){const be=this._mrt;this.status="parsing",this._entireBuffer=oe;try{be.parseHeader(oe),this._isHeaderLoaded=!0;const ke=[];for(const we in be.layers){const Ne=be.getLayer(we),it=Ne.getDataRange(Ne.getBandList()),Ve=be.createDecodingTask(it),nt=oe.slice(it.firstByte,it.lastByte+1),$t=o.bp.performDecoding(nt,Ve).then((Tt=>Ve.complete(null,Tt))).catch((Tt=>Ve.complete(Tt,null)));ke.push($t)}Promise.allSettled(ke).then((()=>se(null,be))).catch((we=>se(we)))}catch(ke){se(ke)}}}class ue{constructor(oe){this.actor=oe,this.loading={},this.loaded={}}loadTile(oe,se){const be=oe.uid,ke=oe.request,we=this.loading[be]=new fe(oe),{cancel:Ne}=o.br(ke,((it,Ve,nt,$t)=>{const Tt=!this.loading[be];if(delete this.loading[be],Tt||it||!Ve)return we.status="done",Tt||(this.loaded[be]=we),se(it);we.parse(Ve,((xr,Or)=>{if(xr||!Or)return se(xr);se(null,Or,nt,$t)})),this.loaded[be]=we}));we.abort=Ne}reloadTile(oe,se){se(null,void 0)}abortTile(oe,se){const be=oe.uid,ke=this.loading[be];ke&&(ke.abort&&ke.abort(),delete this.loading[be]),se()}removeTile(oe,se){const be=oe.uid;this.loaded[be]&&delete this.loaded[be],se()}decodeRasterArray(oe,se){o.bp.performDecoding(oe.buffer,oe.task).then((be=>se(null,be))).catch((be=>se(be)))}}const _e=o.fq.prototype.toGeoJSON;class le{constructor(oe){this._feature=oe,this.extent=o.aj,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(this._feature.type===1){const oe=[];for(const se of this._feature.geometry)oe.push([new o.P(se[0],se[1])]);return oe}{const oe=[];for(const se of this._feature.geometry){const be=[];for(const ke of se)be.push(new o.P(ke[0],ke[1]));oe.push(be)}return oe}}toGeoJSON(oe,se,be){return _e.call(this,oe,se,be)}}class pe{constructor(oe,se){this.name=oe,this.extent=o.aj,this.length=se.length,this._jsonFeatures=se}feature(oe){return new le(this._jsonFeatures[oe])}}class Te{constructor(oe){this.layers={},this.extent=o.aj;for(const se of Object.keys(oe))this.layers[se]=new pe(se,oe[se])}}const De=64/4096,Xe=128;class wt{constructor(){this.features=new Map}clear(){this.features.clear()}load(oe=[],se){for(const be of oe){const ke=be.id;if(ke==null)continue;let we=this.features.get(ke);we&&this.updateCache(we,se),be.geometry?(we=vt(be),this.updateCache(we,se),this.features.set(ke,we)):this.features.delete(ke),this.updateCache(we,se)}}updateCache(oe,se){for(const{canonical:be,uid:ke}of Object.values(se)){const{z:we,x:Ne,y:it}=be;$e(oe,Math.pow(2,we),Ne,it)&&delete se[ke]}}getTile(oe,se,be){const ke=Math.pow(2,oe),we=[];for(const Ne of this.features.values())$e(Ne,ke,se,be)&&we.push(gt(Ne,ke,se,be));return{features:we}}getFeatures(){return[...this.features.values()]}}function $e({minX:et,minY:oe,maxX:se,maxY:be},ke,we,Ne){return et<(we+1+De)/ke&&oe<(Ne+1+De)/ke&&se>(we-De)/ke&&be>(Ne-De)/ke}function vt(et){const{id:oe,geometry:se,properties:be}=et;if(!se)return;if(se.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:ke,coordinates:we}=se,Ne={id:oe,type:1,geometry:[],tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},it=Ne.geometry;if(ke==="Point")ft(we,it,Ne);else if(ke==="MultiPoint")for(const Ve of we)ft(Ve,it,Ne);else if(ke==="LineString")Ne.type=2,bt(we,it,Ne);else if(ke==="MultiLineString")Ne.type=2,St(we,it,Ne);else if(ke==="Polygon")Ne.type=3,St(we,it,Ne,!0);else{if(ke!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ne.type=3;for(const Ve of we)St(Ve,it,Ne,!0)}return Ne}function ft([et,oe],se,be){const ke=o.aD(et);let we=o.aH(oe);we=we<0?0:we>1?1:we,se.push(ke,we),be.minX=Math.min(be.minX,ke),be.minY=Math.min(be.minY,we),be.maxX=Math.max(be.maxX,ke),be.maxY=Math.max(be.maxY,we)}function bt(et,oe,se,be=!1,ke=!1){const we=[];for(const Ne of et)ft(Ne,we,se);oe.push(we),be&&(function(Ne,it){let Ve=0;for(let nt=0,$t=Ne.length,Tt=$t-2;nt<$t;Tt=nt,nt+=2)Ve+=(Ne[nt]-Ne[Tt])*(Ne[nt+1]+Ne[Tt+1]);if(Ve>0===it)for(let nt=0,$t=Ne.length;nt<$t/2;nt+=2){const Tt=Ne[nt],xr=Ne[nt+1];Ne[nt]=Ne[$t-2-nt],Ne[nt+1]=Ne[$t-1-nt],Ne[$t-2-nt]=Tt,Ne[$t-1-nt]=xr}})(we,ke)}function St(et,oe,se,be=!1){for(let ke=0;ke<et.length;ke++)bt(et[ke],oe,se,be,ke===0)}function gt(et,oe,se,be){const{id:ke,type:we,geometry:Ne,tags:it}=et,Ve=[];if(we===1)(function(nt,$t,Tt,xr,Or){for(let Nr=0;Nr<nt.length;Nr+=2){const ln=Math.round(o.aj*(nt[Nr+0]*$t-Tt)),Jr=Math.round(o.aj*(nt[Nr+1]*$t-xr));Or.push([ln,Jr])}})(Ne,oe,se,be,Ve);else for(const nt of Ne)Rt(nt,oe,se,be,Ve);return{id:ke,type:we,geometry:Ve,tags:it}}function Rt(et,oe,se,be,ke){const we=-Xe,Ne=o.aj+Xe;let it;for(let Ve=0;Ve<et.length-2;Ve+=2){let nt=Math.round(o.aj*(et[Ve+0]*oe-se)),$t=Math.round(o.aj*(et[Ve+1]*oe-be)),Tt=Math.round(o.aj*(et[Ve+2]*oe-se)),xr=Math.round(o.aj*(et[Ve+3]*oe-be));const Or=Tt-nt,Nr=xr-$t;nt<we&&Tt<we||(nt<we?($t+=Math.round(Nr*((we-nt)/Or)),nt=we):Tt<we&&(xr=$t+Math.round(Nr*((we-nt)/Or)),Tt=we),$t<we&&xr<we||($t<we?(nt+=Math.round(Or*((we-$t)/Nr)),$t=we):xr<we&&(Tt=nt+Math.round(Or*((we-$t)/Nr)),xr=we),nt>=Ne&&Tt>=Ne||(nt>=Ne?($t+=Math.round(Nr*((Ne-nt)/Or)),nt=Ne):Tt>=Ne&&(xr=$t+Math.round(Nr*((Ne-nt)/Or)),Tt=Ne),$t>=Ne&&xr>=Ne||($t>=Ne?(nt+=Math.round(Or*((Ne-$t)/Nr)),$t=Ne):xr>=Ne&&(Tt=nt+Math.round(Or*((Ne-$t)/Nr)),xr=Ne),it&&nt===it[it.length-1][0]&&$t===it[it.length-1][1]||(it=[[nt,$t]],ke.push(it)),it.push([Tt,xr])))))}}function Ke({name:et,features:oe},se){se.writeStringField(1,et),se.writeVarintField(5,o.aj);const be=new Map,ke=new Map,we={keys:be,values:ke,feature:null};for(const Ne of oe)we.feature=Ne,se.writeMessage(2,yt,we);for(const Ne of be.keys())se.writeStringField(3,Ne);for(const Ne of ke.keys())se.writeMessage(4,Mr,Ne)}function yt(et,oe){const se=et.feature;se.id===void 0||isNaN(+se.id)||oe.writeVarintField(1,+se.id),se.tags&&oe.writeMessage(2,Vt,et),oe.writeVarintField(3,se.type),oe.writeMessage(4,ar,se)}function Vt({keys:et,values:oe,feature:se},be){for(const ke of Object.keys(se.tags)){let we=se.tags[ke];if(we===null)continue;let Ne=et.get(ke);Ne===void 0&&(Ne=et.size,et.set(ke,Ne)),be.writeVarint(Ne);const it=typeof we;it!=="string"&&it!=="boolean"&&it!=="number"&&(we=JSON.stringify(we));let Ve=oe.get(we);Ve===void 0&&(Ve=oe.size,oe.set(we,Ve)),be.writeVarint(Ve)}}function qe(et,oe){return(oe<<3)+(7&et)}function mt(et){return et<<1^et>>31}function ar(et,oe){const{geometry:se,type:be}=et;let ke=0,we=0;if(be===1){oe.writeVarint(qe(1,se.length));for(const Ne of se){const it=Ne[0]-ke,Ve=Ne[1]-we;oe.writeVarint(mt(it)),oe.writeVarint(mt(Ve)),ke+=it,we+=Ve}}else for(const Ne of se){oe.writeVarint(qe(1,1));const it=Ne.length-(be===3?1:0);for(let Ve=0;Ve<it;Ve++){Ve===1&&oe.writeVarint(qe(2,it-1));const nt=Ne[Ve][0]-ke,$t=Ne[Ve][1]-we;oe.writeVarint(mt(nt)),oe.writeVarint(mt($t)),ke+=nt,we+=$t}be===3&&oe.writeVarint(qe(7,1))}}function Mr(et,oe){const se=typeof et;se==="string"?oe.writeStringField(1,et):se==="boolean"?oe.writeBooleanField(7,et):se==="number"&&(et%1!=0?oe.writeDoubleField(3,et):et<0?oe.writeSVarintField(6,et):oe.writeVarintField(5,et))}const Gr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:et=>et},Tr=Math.fround||(vr=new Float32Array(1),et=>(vr[0]=+et,vr[0]));var vr;const Br=3,or=5,Ar=6;class un{constructor(oe){this.options=Object.assign(Object.create(Gr),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){const{log:se,minZoom:be,maxZoom:ke}=this.options;se&&console.time("total time");const we=`prepare ${oe.length} points`;se&&console.time(we),this.points=oe;const Ne=[];for(let Ve=0;Ve<oe.length;Ve++){const nt=oe[Ve];if(!nt.geometry)continue;const[$t,Tt]=nt.geometry.coordinates,xr=Tr(Rn($t)),Or=Tr(In(Tt));Ne.push(xr,Or,1/0,Ve,-1,1),this.options.reduce&&Ne.push(0)}let it=this.trees[ke+1]=this._createTree(Ne);se&&console.timeEnd(we);for(let Ve=ke;Ve>=be;Ve--){const nt=+Date.now();it=this.trees[Ve]=this._createTree(this._cluster(it,Ve)),se&&console.log("z%d: %d clusters in %dms",Ve,it.numItems,+Date.now()-nt)}return se&&console.timeEnd("total time"),this}getClusters(oe,se){let be=((oe[0]+180)%360+360)%360-180;const ke=Math.max(-90,Math.min(90,oe[1]));let we=oe[2]===180?180:((oe[2]+180)%360+360)%360-180;const Ne=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)be=-180,we=180;else if(be>we){const Tt=this.getClusters([be,ke,180,Ne],se),xr=this.getClusters([-180,ke,we,Ne],se);return Tt.concat(xr)}const it=this.trees[this._limitZoom(se)],Ve=it.range(Rn(be),In(Ne),Rn(we),In(ke)),nt=it.data,$t=[];for(const Tt of Ve){const xr=this.stride*Tt;$t.push(nt[xr+or]>1?sr(nt,xr,this.clusterProps):this.points[nt[xr+Br]])}return $t}getChildren(oe){const se=this._getOriginId(oe),be=this._getOriginZoom(oe),ke="No cluster with the specified id.",we=this.trees[be];if(!we)throw new Error(ke);const Ne=we.data;if(se*this.stride>=Ne.length)throw new Error(ke);const it=this.options.radius/(this.options.extent*Math.pow(2,be-1)),Ve=we.within(Ne[se*this.stride],Ne[se*this.stride+1],it),nt=[];for(const $t of Ve){const Tt=$t*this.stride;Ne[Tt+4]===oe&&nt.push(Ne[Tt+or]>1?sr(Ne,Tt,this.clusterProps):this.points[Ne[Tt+Br]])}if(nt.length===0)throw new Error(ke);return nt}getLeaves(oe,se,be){const ke=[];return this._appendLeaves(ke,oe,se=se||10,be=be||0,0),ke}getTile(oe,se,be){const ke=this.trees[this._limitZoom(oe)],we=Math.pow(2,oe),{extent:Ne,radius:it}=this.options,Ve=it/Ne,nt=(be-Ve)/we,$t=(be+1+Ve)/we,Tt={features:[]};return this._addTileFeatures(ke.range((se-Ve)/we,nt,(se+1+Ve)/we,$t),ke.data,se,be,we,Tt),se===0&&this._addTileFeatures(ke.range(1-Ve/we,nt,1,$t),ke.data,we,be,we,Tt),se===we-1&&this._addTileFeatures(ke.range(0,nt,Ve/we,$t),ke.data,-1,be,we,Tt),Tt.features.length?Tt:null}getClusterExpansionZoom(oe){let se=this._getOriginZoom(oe)-1;for(;se<=this.options.maxZoom;){const be=this.getChildren(oe);if(se++,be.length!==1)break;oe=be[0].properties.cluster_id}return se}_appendLeaves(oe,se,be,ke,we){const Ne=this.getChildren(se);for(const it of Ne){const Ve=it.properties;if(Ve&&Ve.cluster?we+Ve.point_count<=ke?we+=Ve.point_count:we=this._appendLeaves(oe,Ve.cluster_id,be,ke,we):we<ke?we++:oe.push(it),oe.length===be)break}return we}_createTree(oe){const se=new o.c0(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let be=0;be<oe.length;be+=this.stride)se.add(oe[be],oe[be+1]);return se.finish(),se.data=oe,se}_addTileFeatures(oe,se,be,ke,we,Ne){for(const it of oe){const Ve=it*this.stride,nt=se[Ve+or]>1;let $t,Tt,xr;if(nt)$t=ui(se,Ve,this.clusterProps),Tt=se[Ve],xr=se[Ve+1];else{const ln=this.points[se[Ve+Br]];$t=ln.properties;const[Jr,hn]=ln.geometry.coordinates;Tt=Rn(Jr),xr=In(hn)}const Or={type:1,geometry:[[Math.round(this.options.extent*(Tt*we-be)),Math.round(this.options.extent*(xr*we-ke))]],tags:$t};let Nr;Nr=nt||this.options.generateId?se[Ve+Br]:this.points[se[Ve+Br]].id,Nr!==void 0&&(Or.id=Nr),Ne.features.push(Or)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,se){const{radius:be,extent:ke,reduce:we,minPoints:Ne}=this.options,it=be/(ke*Math.pow(2,se)),Ve=oe.data,nt=[],$t=this.stride;for(let Tt=0;Tt<Ve.length;Tt+=$t){if(Ve[Tt+2]<=se)continue;Ve[Tt+2]=se;const xr=Ve[Tt],Or=Ve[Tt+1],Nr=oe.within(Ve[Tt],Ve[Tt+1],it),ln=Ve[Tt+or];let Jr=ln;for(const hn of Nr){const Yn=hn*$t;Ve[Yn+2]>se&&(Jr+=Ve[Yn+or])}if(Jr>ln&&Jr>=Ne){let hn,Yn=xr*ln,fn=Or*ln,Fi=-1;const $n=(Tt/$t<<5)+(se+1)+this.points.length;for(const ro of Nr){const qn=ro*$t;if(Ve[qn+2]<=se)continue;Ve[qn+2]=se;const Dn=Ve[qn+or];Yn+=Ve[qn]*Dn,fn+=Ve[qn+1]*Dn,Ve[qn+4]=$n,we&&(hn||(hn=this._map(Ve,Tt,!0),Fi=this.clusterProps.length,this.clusterProps.push(hn)),we(hn,this._map(Ve,qn)))}Ve[Tt+4]=$n,nt.push(Yn/Jr,fn/Jr,1/0,$n,-1,Jr),we&&nt.push(Fi)}else{for(let hn=0;hn<$t;hn++)nt.push(Ve[Tt+hn]);if(Jr>1)for(const hn of Nr){const Yn=hn*$t;if(!(Ve[Yn+2]<=se)){Ve[Yn+2]=se;for(let fn=0;fn<$t;fn++)nt.push(Ve[Yn+fn])}}}}return nt}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,se,be){if(oe[se+or]>1){const Ne=this.clusterProps[oe[se+Ar]];return be?Object.assign({},Ne):Ne}const ke=this.points[oe[se+Br]].properties,we=this.options.map(ke);return be&&we===ke?Object.assign({},we):we}}function sr(et,oe,se){return{type:"Feature",id:et[oe+Br],properties:ui(et,oe,se),geometry:{type:"Point",coordinates:[(be=et[oe],360*(be-.5)),hi(et[oe+1])]}};var be}function ui(et,oe,se){const be=et[oe+or],ke=be>=1e4?`${Math.round(be/1e3)}k`:be>=1e3?Math.round(be/100)/10+"k":be,we=et[oe+Ar],Ne=we===-1?{}:Object.assign({},se[we]);return Object.assign(Ne,{cluster:!0,cluster_id:et[oe+Br],point_count:be,point_count_abbreviated:ke})}function Rn(et){return et/360+.5}function In(et){const oe=Math.sin(et*Math.PI/180),se=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return se<0?0:se>1?1:se}function hi(et){const oe=(180-360*et)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function Yi(et,oe,se,be){let ke=be;const we=oe+(se-oe>>1);let Ne,it=se-oe;const Ve=et[oe],nt=et[oe+1],$t=et[se],Tt=et[se+1];for(let xr=oe+3;xr<se;xr+=3){const Or=Sa(et[xr],et[xr+1],Ve,nt,$t,Tt);if(Or>ke)Ne=xr,ke=Or;else if(Or===ke){const Nr=Math.abs(xr-we);Nr<it&&(Ne=xr,it=Nr)}}ke>be&&(Ne-oe>3&&Yi(et,oe,Ne,be),et[Ne+2]=ke,se-Ne>3&&Yi(et,Ne,se,be))}function Sa(et,oe,se,be,ke,we){let Ne=ke-se,it=we-be;if(Ne!==0||it!==0){const Ve=((et-se)*Ne+(oe-be)*it)/(Ne*Ne+it*it);Ve>1?(se=ke,be=we):Ve>0&&(se+=Ne*Ve,be+=it*Ve)}return Ne=et-se,it=oe-be,Ne*Ne+it*it}function qo(et,oe,se,be){const ke={id:et??null,type:oe,geometry:se,tags:be,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")po(ke,se);else if(oe==="Polygon")po(ke,se[0]);else if(oe==="MultiLineString")for(const we of se)po(ke,we);else if(oe==="MultiPolygon")for(const we of se)po(ke,we[0]);return ke}function po(et,oe){for(let se=0;se<oe.length;se+=3)et.minX=Math.min(et.minX,oe[se]),et.minY=Math.min(et.minY,oe[se+1]),et.maxX=Math.max(et.maxX,oe[se]),et.maxY=Math.max(et.maxY,oe[se+1])}function Vi(et,oe,se,be){if(!oe.geometry)return;const ke=oe.geometry.coordinates;if(ke&&ke.length===0)return;const we=oe.geometry.type,Ne=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2);let it=[],Ve=oe.id;if(se.promoteId?Ve=oe.properties[se.promoteId]:se.generateId&&(Ve=be||0),we==="Point")Bo(ke,it);else if(we==="MultiPoint")for(const nt of ke)Bo(nt,it);else if(we==="LineString")Ba(ke,it,Ne,!1);else if(we==="MultiLineString"){if(se.lineMetrics){for(const nt of ke)it=[],Ba(nt,it,Ne,!1),et.push(qo(Ve,"LineString",it,oe.properties));return}Os(ke,it,Ne,!1)}else if(we==="Polygon")Os(ke,it,Ne,!0);else{if(we!=="MultiPolygon"){if(we==="GeometryCollection"){for(const nt of oe.geometry.geometries)Vi(et,{id:Ve,geometry:nt,properties:oe.properties},se,be);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const nt of ke){const $t=[];Os(nt,$t,Ne,!0),it.push($t)}}et.push(qo(Ve,we,it,oe.properties))}function Bo(et,oe){oe.push(tl(et[0]),ca(et[1]),0)}function Ba(et,oe,se,be){let ke,we,Ne=0;for(let Ve=0;Ve<et.length;Ve++){const nt=tl(et[Ve][0]),$t=ca(et[Ve][1]);oe.push(nt,$t,0),Ve>0&&(Ne+=be?(ke*$t-nt*we)/2:Math.sqrt(Math.pow(nt-ke,2)+Math.pow($t-we,2))),ke=nt,we=$t}const it=oe.length-3;oe[2]=1,Yi(oe,0,it,se),oe[it+2]=1,oe.size=Math.abs(Ne),oe.start=0,oe.end=oe.size}function Os(et,oe,se,be){for(let ke=0;ke<et.length;ke++){const we=[];Ba(et[ke],we,se,be),oe.push(we)}}function tl(et){return et/360+.5}function ca(et){const oe=Math.sin(et*Math.PI/180),se=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return se<0?0:se>1?1:se}function Ta(et,oe,se,be,ke,we,Ne,it){if(be/=oe,we>=(se/=oe)&&Ne<be)return et;if(Ne<se||we>=be)return null;const Ve=[];for(const nt of et){const $t=nt.geometry;let Tt=nt.type;const xr=ke===0?nt.minX:nt.minY,Or=ke===0?nt.maxX:nt.maxY;if(xr>=se&&Or<be){Ve.push(nt);continue}if(Or<se||xr>=be)continue;let Nr=[];if(Tt==="Point"||Tt==="MultiPoint")ic($t,Nr,se,be,ke);else if(Tt==="LineString")rl($t,Nr,se,be,ke,!1,it.lineMetrics);else if(Tt==="MultiLineString")xo($t,Nr,se,be,ke,!1);else if(Tt==="Polygon")xo($t,Nr,se,be,ke,!0);else if(Tt==="MultiPolygon")for(const ln of $t){const Jr=[];xo(ln,Jr,se,be,ke,!0),Jr.length&&Nr.push(Jr)}if(Nr.length){if(it.lineMetrics&&Tt==="LineString"){for(const ln of Nr)Ve.push(qo(nt.id,Tt,ln,nt.tags));continue}Tt!=="LineString"&&Tt!=="MultiLineString"||(Nr.length===1?(Tt="LineString",Nr=Nr[0]):Tt="MultiLineString"),Tt!=="Point"&&Tt!=="MultiPoint"||(Tt=Nr.length===3?"Point":"MultiPoint"),Ve.push(qo(nt.id,Tt,Nr,nt.tags))}}return Ve.length?Ve:null}function ic(et,oe,se,be,ke){for(let we=0;we<et.length;we+=3){const Ne=et[we+ke];Ne>=se&&Ne<=be&&rs(oe,et[we],et[we+1],et[we+2])}}function rl(et,oe,se,be,ke,we,Ne){let it=nl(et);const Ve=ke===0?Al:il;let nt,$t,Tt=et.start;for(let Jr=0;Jr<et.length-3;Jr+=3){const hn=et[Jr],Yn=et[Jr+1],fn=et[Jr+2],Fi=et[Jr+3],$n=et[Jr+4],ro=ke===0?hn:Yn,qn=ke===0?Fi:$n;let Dn=!1;Ne&&(nt=Math.sqrt(Math.pow(hn-Fi,2)+Math.pow(Yn-$n,2))),ro<se?qn>se&&($t=Ve(it,hn,Yn,Fi,$n,se),Ne&&(it.start=Tt+nt*$t)):ro>be?qn<be&&($t=Ve(it,hn,Yn,Fi,$n,be),Ne&&(it.start=Tt+nt*$t)):rs(it,hn,Yn,fn),qn<se&&ro>=se&&($t=Ve(it,hn,Yn,Fi,$n,se),Dn=!0),qn>be&&ro<=be&&($t=Ve(it,hn,Yn,Fi,$n,be),Dn=!0),!we&&Dn&&(Ne&&(it.end=Tt+nt*$t),oe.push(it),it=nl(et)),Ne&&(Tt+=nt)}let xr=et.length-3;const Or=et[xr],Nr=et[xr+1],ln=ke===0?Or:Nr;ln>=se&&ln<=be&&rs(it,Or,Nr,et[xr+2]),xr=it.length-3,we&&xr>=3&&(it[xr]!==it[0]||it[xr+1]!==it[1])&&rs(it,it[0],it[1],it[2]),it.length&&oe.push(it)}function nl(et){const oe=[];return oe.size=et.size,oe.start=et.start,oe.end=et.end,oe}function xo(et,oe,se,be,ke,we){for(const Ne of et)rl(Ne,oe,se,be,ke,we,!1)}function rs(et,oe,se,be){et.push(oe,se,be)}function Al(et,oe,se,be,ke,we){const Ne=(we-oe)/(be-oe);return rs(et,we,se+(ke-se)*Ne,1),Ne}function il(et,oe,se,be,ke,we){const Ne=(we-se)/(ke-se);return rs(et,oe+(be-oe)*Ne,we,1),Ne}function oc(et,oe){const se=[];for(let be=0;be<et.length;be++){const ke=et[be],we=ke.type;let Ne;if(we==="Point"||we==="MultiPoint"||we==="LineString")Ne=ol(ke.geometry,oe);else if(we==="MultiLineString"||we==="Polygon"){Ne=[];for(const it of ke.geometry)Ne.push(ol(it,oe))}else if(we==="MultiPolygon"){Ne=[];for(const it of ke.geometry){const Ve=[];for(const nt of it)Ve.push(ol(nt,oe));Ne.push(Ve)}}se.push(qo(ke.id,we,Ne,ke.tags))}return se}function ol(et,oe){const se=[];se.size=et.size,et.start!==void 0&&(se.start=et.start,se.end=et.end);for(let be=0;be<et.length;be+=3)se.push(et[be]+oe,et[be+1],et[be+2]);return se}function ac(et,oe){if(et.transformed)return et;const se=1<<et.z,be=et.x,ke=et.y;for(const we of et.features){const Ne=we.geometry,it=we.type;if(we.geometry=[],it===1)for(let Ve=0;Ve<Ne.length;Ve+=2)we.geometry.push(ii(Ne[Ve],Ne[Ve+1],oe,se,be,ke));else for(let Ve=0;Ve<Ne.length;Ve++){const nt=[];for(let $t=0;$t<Ne[Ve].length;$t+=2)nt.push(ii(Ne[Ve][$t],Ne[Ve][$t+1],oe,se,be,ke));we.geometry.push(nt)}}return et.transformed=!0,et}function ii(et,oe,se,be,ke,we){return[Math.round(se*(et*be-ke)),Math.round(se*(oe*be-we))]}function Jc(et,oe,se,be,ke){const we=oe===ke.maxZoom?0:ke.tolerance/((1<<oe)*ke.extent),Ne={features:[],numPoints:0,numSimplified:0,numFeatures:et.length,source:null,x:se,y:be,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const it of et)Qc(Ne,it,we,ke);return Ne}function Qc(et,oe,se,be){const ke=oe.geometry,we=oe.type,Ne=[];if(et.minX=Math.min(et.minX,oe.minX),et.minY=Math.min(et.minY,oe.minY),et.maxX=Math.max(et.maxX,oe.maxX),et.maxY=Math.max(et.maxY,oe.maxY),we==="Point"||we==="MultiPoint")for(let it=0;it<ke.length;it+=3)Ne.push(ke[it],ke[it+1]),et.numPoints++,et.numSimplified++;else if(we==="LineString")Go(Ne,ke,et,se,!1,!1);else if(we==="MultiLineString"||we==="Polygon")for(let it=0;it<ke.length;it++)Go(Ne,ke[it],et,se,we==="Polygon",it===0);else if(we==="MultiPolygon")for(let it=0;it<ke.length;it++){const Ve=ke[it];for(let nt=0;nt<Ve.length;nt++)Go(Ne,Ve[nt],et,se,!0,nt===0)}if(Ne.length){let it=oe.tags||null;if(we==="LineString"&&be.lineMetrics){it={};for(const nt in oe.tags)it[nt]=oe.tags[nt];it.mapbox_clip_start=ke.start/ke.size,it.mapbox_clip_end=ke.end/ke.size}const Ve={geometry:Ne,type:we==="Polygon"||we==="MultiPolygon"?3:we==="LineString"||we==="MultiLineString"?2:1,tags:it};oe.id!==null&&(Ve.id=oe.id),et.features.push(Ve)}}function Go(et,oe,se,be,ke,we){const Ne=be*be;if(be>0&&oe.size<(ke?Ne:be))return void(se.numPoints+=oe.length/3);const it=[];for(let Ve=0;Ve<oe.length;Ve+=3)(be===0||oe[Ve+2]>Ne)&&(se.numSimplified++,it.push(oe[Ve],oe[Ve+1])),se.numPoints++;ke&&(function(Ve,nt){let $t=0;for(let Tt=0,xr=Ve.length,Or=xr-2;Tt<xr;Or=Tt,Tt+=2)$t+=(Ve[Tt]-Ve[Or])*(Ve[Tt+1]+Ve[Or+1]);if($t>0===nt)for(let Tt=0,xr=Ve.length;Tt<xr/2;Tt+=2){const Or=Ve[Tt],Nr=Ve[Tt+1];Ve[Tt]=Ve[xr-2-Tt],Ve[Tt+1]=Ve[xr-1-Tt],Ve[xr-2-Tt]=Or,Ve[xr-1-Tt]=Nr}})(it,we),et.push(it)}const al={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class pd{constructor(oe,se){const be=(se=this.options=(function(we,Ne){for(const it in Ne)we[it]=Ne[it];return we})(Object.create(al),se)).debug;if(be&&console.time("preprocess data"),se.maxZoom<0||se.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(se.promoteId&&se.generateId)throw new Error("promoteId and generateId cannot be used together.");let ke=(function(we,Ne){const it=[];if(we.type==="FeatureCollection")for(let Ve=0;Ve<we.features.length;Ve++)Vi(it,we.features[Ve],Ne,Ve);else Vi(it,we.type==="Feature"?we:{geometry:we},Ne);return it})(oe,se);this.tiles={},this.tileCoords=[],be&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",se.indexMaxZoom,se.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ke=(function(we,Ne){const it=Ne.buffer/Ne.extent;let Ve=we;const nt=Ta(we,1,-1-it,it,0,-1,2,Ne),$t=Ta(we,1,1-it,2+it,0,-1,2,Ne);return(nt||$t)&&(Ve=Ta(we,1,-it,1+it,0,-1,2,Ne)||[],nt&&(Ve=oc(nt,1).concat(Ve)),$t&&(Ve=Ve.concat(oc($t,-1)))),Ve})(ke,se),ke.length&&this.splitTile(ke,0,0,0),be&&(ke.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(oe,se,be,ke,we,Ne,it){const Ve=[oe,se,be,ke],nt=this.options,$t=nt.debug;for(;Ve.length;){ke=Ve.pop(),be=Ve.pop(),se=Ve.pop(),oe=Ve.pop();const Tt=1<<se,xr=eu(se,be,ke);let Or=this.tiles[xr];if(!Or&&($t>1&&console.time("creation"),Or=this.tiles[xr]=Jc(oe,se,be,ke,nt),this.tileCoords.push({z:se,x:be,y:ke}),$t)){$t>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",se,be,ke,Or.numFeatures,Or.numPoints,Or.numSimplified),console.timeEnd("creation"));const Dn=`z${se}`;this.stats[Dn]=(this.stats[Dn]||0)+1,this.total++}if(Or.source=oe,we==null){if(se===nt.indexMaxZoom||Or.numPoints<=nt.indexMaxPoints)continue}else{if(se===nt.maxZoom||se===we)continue;if(we!=null){const Dn=we-se;if(be!==Ne>>Dn||ke!==it>>Dn)continue}}if(Or.source=null,oe.length===0)continue;$t>1&&console.time("clipping");const Nr=.5*nt.buffer/nt.extent,ln=.5-Nr,Jr=.5+Nr,hn=1+Nr;let Yn=null,fn=null,Fi=null,$n=null,ro=Ta(oe,Tt,be-Nr,be+Jr,0,Or.minX,Or.maxX,nt),qn=Ta(oe,Tt,be+ln,be+hn,0,Or.minX,Or.maxX,nt);oe=null,ro&&(Yn=Ta(ro,Tt,ke-Nr,ke+Jr,1,Or.minY,Or.maxY,nt),fn=Ta(ro,Tt,ke+ln,ke+hn,1,Or.minY,Or.maxY,nt),ro=null),qn&&(Fi=Ta(qn,Tt,ke-Nr,ke+Jr,1,Or.minY,Or.maxY,nt),$n=Ta(qn,Tt,ke+ln,ke+hn,1,Or.minY,Or.maxY,nt),qn=null),$t>1&&console.timeEnd("clipping"),Ve.push(Yn||[],se+1,2*be,2*ke),Ve.push(fn||[],se+1,2*be,2*ke+1),Ve.push(Fi||[],se+1,2*be+1,2*ke),Ve.push($n||[],se+1,2*be+1,2*ke+1)}}getTile(oe,se,be){oe=+oe,se=+se,be=+be;const ke=this.options,{extent:we,debug:Ne}=ke;if(oe<0||oe>24)return null;const it=1<<oe,Ve=eu(oe,se=se+it&it-1,be);if(this.tiles[Ve])return ac(this.tiles[Ve],we);Ne>1&&console.log("drilling down to z%d-%d-%d",oe,se,be);let nt,$t=oe,Tt=se,xr=be;for(;!nt&&$t>0;)$t--,Tt>>=1,xr>>=1,nt=this.tiles[eu($t,Tt,xr)];return nt&&nt.source?(Ne>1&&(console.log("found parent tile z%d-%d-%d",$t,Tt,xr),console.time("drilling down")),this.splitTile(nt.source,$t,Tt,xr,oe,se,be),Ne>1&&console.timeEnd("drilling down"),this.tiles[Ve]?ac(this.tiles[Ve],we):null):null}}function eu(et,oe,se){return 32*((1<<et)*se+oe)+et}function kt(et,oe){const se=et.tileID.canonical;if(!this._geoJSONIndex)return void oe(null,null);const be=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!be)return void oe(null,null);const ke=nt=>nt.tags&&"3d_elevation_id"in nt.tags&&"source"in nt.tags&&nt.tags.source==="elevation",we=be.features.filter((nt=>ke(nt)));let Ne={_geojsonTileLayer:be.features};we.length>0&&(Ne={_geojsonTileLayer:be.features.filter((nt=>!ke(nt))),hd_road_elevation:we});const it=new Te(Ne),Ve=(function(nt){const $t=new o.bq;for(const Tt of Object.keys(nt))$t.writeMessage(3,Ke,{name:Tt,features:nt[Tt]});return $t.finish()})(Ne).buffer;oe(null,{vectorTile:it,rawData:Ve})}class sl extends Z{constructor(oe,se,be,ke,we,Ne,it){super(oe,se,be,ke,we,kt,it),Ne&&(this.loadGeoJSON=Ne),this._dynamicIndex=new wt}loadData(oe,se){const be=oe&&oe.request,ke=be&&be.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(oe,((we,Ne)=>{if(we||!Ne)return se(we);if(typeof Ne!="object")return se(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));{try{if(oe.filter){const Ve=o.X(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ve.result==="error")throw new Error(Ve.value.map((nt=>`${nt.key}: ${nt.message}`)).join(", "));Ne.features=Ne.features.filter((nt=>Ve.value.evaluate({zoom:0},nt)))}oe.dynamic?(Ne.type==="Feature"&&(Ne={type:"FeatureCollection",features:[Ne]}),oe.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ne.features,this.loaded),oe.cluster&&(Ne.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=oe.cluster?new un((function({superclusterOptions:Ve,clusterProperties:nt}){if(!nt||!Ve)return Ve;const $t={},Tt={},xr={accumulated:null,zoom:0},Or={properties:null},Nr=Object.keys(nt);for(const ln of Nr){const[Jr,hn]=nt[ln],Yn=o.X(hn),fn=o.X(typeof Jr=="string"?[Jr,["accumulated"],["get",ln]]:Jr);$t[ln]=Yn.value,Tt[ln]=fn.value}return Ve.map=ln=>{Or.properties=ln;const Jr={};for(const hn of Nr)Jr[hn]=$t[hn].evaluate(xr,Or);return Jr},Ve.reduce=(ln,Jr)=>{Or.properties=Jr;for(const hn of Nr)xr.accumulated=ln[hn],ln[hn]=Tt[hn].evaluate(xr,Or)},Ve})(oe)).load(Ne.features):oe.dynamic?this._dynamicIndex:(function(Ve,nt){return new pd(Ve,nt)})(Ne,oe.geojsonVtOptions)}catch(Ve){return se(Ve)}const it={};if(ke){const Ve=M(be);Ve&&(it.resourceTiming={},it.resourceTiming[oe.source]=JSON.parse(JSON.stringify(Ve)))}se(null,it)}}))}reloadTile(oe,se){const be=this.loaded;return be&&be[oe.uid]?oe.partial?se(null,void 0):super.reloadTile(oe,se):this.loadTile(oe,se)}loadGeoJSON(oe,se){if(oe.request)o.n(oe.request,se);else{if(typeof oe.data!="string")return se(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return se(null,JSON.parse(oe.data))}catch{return se(new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(oe,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId))}catch(be){se(be)}}getClusterChildren(oe,se){try{se(null,this._geoJSONIndex.getChildren(oe.clusterId))}catch(be){se(be)}}getClusterLeaves(oe,se){try{se(null,this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset))}catch(be){se(be)}}}class md{constructor(oe,se,be){this.tileID=new o.aM(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.tileZoom=oe.tileZoom,this.uid=oe.uid,this.zoom=oe.zoom,this.canonical=oe.tileID.canonical,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=oe.projection,this.brightness=se,this.worldview=be}parse(oe,se,be,ke){this.status="parsing";const we=new o.aM(be.tileID.overscaledZ,be.tileID.wrap,be.tileID.canonical.z,be.tileID.canonical.x,be.tileID.canonical.y),Ne=[],it=se.familiesBySource[be.source],Ve=new o.fc(we,be.promoteId);Ve.bucketLayerIDs=[],Ve.is3DTile=!0,o.fr(oe).then((nt=>{if(!nt)return ke(new Error("Could not parse tile"));const $t=nt.json.extensionsUsed&&nt.json.extensionsUsed.includes("MAPBOX_mesh_features")||nt.json.asset.extras&&nt.json.asset.extras.MAPBOX_mesh_features,Tt=nt.json.extensionsUsed&&nt.json.extensionsUsed.includes("EXT_meshopt_compression"),xr=new o.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Or in it)for(const Nr of it[Or]){const ln=Nr[0];Ve.bucketLayerIDs.push(Nr.map((Yn=>o.C(Yn.id,Yn.scope)))),ln.recalculate(xr,[]);const Jr=o.fs(nt,1/o.d4(be.tileID.canonical)),hn=new o.ft(Nr,Jr,we,$t,Tt,this.brightness,Ve,this.worldview);$t||(hn.needsUpload=!0),Ne.push(hn),hn.evaluate(ln)}this.status="done",ke(null,{buckets:Ne,featureIndex:Ve,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((nt=>ke(new Error(nt.message))))}}class tu{constructor(oe,se,be,ke,we,Ne,it,Ve){this.actor=oe,this.layerIndex=se,this.availableImages=be,this.availableModels=ke,this.brightness=it,this.loading={},this.loaded={},this.worldview=Ve}loadTile(oe,se){const be=oe.uid,ke=this.loading[be]=new md(oe,this.brightness,this.worldview);o.br(oe.request,((we,Ne)=>{const it=!this.loading[be];return delete this.loading[be],it||we?(ke.status="done",it||(this.loaded[be]=ke),se(we)):Ne&&Ne.byteLength!==0?void ke.parse(Ne,this.layerIndex,oe,((Ve,nt)=>{ke.status="done",this.loaded=this.loaded||{},this.loaded[be]=ke,Ve||!nt?se(Ve):se(null,nt)})):(ke.status="done",this.loaded[be]=ke,se())}))}reloadTile(oe,se){const be=this.loaded,ke=oe.uid;if(be&&be[ke]){const we=be[ke];we.projection=oe.projection,we.brightness=oe.brightness;const Ne=(it,Ve)=>{we.reloadCallback&&(delete we.reloadCallback,this.loadTile(oe,se)),se(it,Ve)};we.status==="parsing"?we.reloadCallback=Ne:we.status==="done"&&this.loadTile(oe,se)}}abortTile(oe,se){const be=oe.uid;this.loading[be]&&delete this.loading[be],se()}removeTile(oe,se){const be=this.loaded,ke=oe.uid;be&&be[ke]&&delete be[ke],se()}}class Cn{constructor(oe){this.self=oe,this.actor=new o.fv(oe,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cj({name:"mercator"}),this.workerSourceTypes={vector:Z,geojson:sl,"raster-dem":ae,"raster-array":ue,"batched-model":tu},this.workerSources={},this.self.registerWorkerSource=(se,be)=>{if(this.workerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.workerSourceTypes[se]=be},this.self.registerRTLTextPlugin=se=>{if(o.fw.isParsed())throw new Error("RTL text plugin already registered.");o.fw.setState({pluginStatus:o.fx.parsed,pluginURL:o.fw.getPluginURL()}),o.fw.applyArabicShaping=se.applyArabicShaping,o.fw.processBidirectionalText=se.processBidirectionalText,o.fw.processStyledBidirectionalText=se.processStyledBidirectionalText;for(const be of this.rtlPluginParsingListeners)be(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(oe,se,be){delete this.layerIndexes[oe],delete this.availableImages[oe],delete this.availableModels[oe],delete this.workerSources[oe],be()}checkIfReady(oe,se,be){be()}setReferrer(oe,se){this.referrer=se}spriteLoaded(oe,se){this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={});const{scope:be,isLoaded:ke}=se;if(this.isSpriteLoaded[oe][be]=ke,this.workerSources[oe]&&this.workerSources[oe][be])for(const we in this.workerSources[oe][be]){const Ne=this.workerSources[oe][be][we];for(const it in Ne){const Ve=Ne[it];Ve instanceof Z&&(Ve.isSpriteLoaded=ke,Ve.fire(new o.A("isSpriteLoaded")))}}}setImages(oe,se,be){this.availableImages[oe]||(this.availableImages[oe]={});const{scope:ke,images:we}=se;if(this.availableImages[oe][ke]=we,this.workerSources[oe]&&this.workerSources[oe][ke]){for(const Ne in this.workerSources[oe][ke]){const it=this.workerSources[oe][ke][Ne];for(const Ve in it)it[Ve].availableImages=we}be()}else be()}setModels(oe,{scope:se,models:be},ke){if(this.availableModels[oe]||(this.availableModels[oe]={}),this.availableModels[oe][se]=be,this.workerSources[oe]&&this.workerSources[oe][se]){for(const we in this.workerSources[oe][se]){const Ne=this.workerSources[oe][se][we];for(const it in Ne)Ne[it].availableModels=be}ke()}else ke()}setProjection(oe,se){this.projections[oe]=o.cj(se)}setBrightness(oe,se,be){this.brightness=se,be()}setWorldview(oe,se,be){this.worldview=se,be()}setLayers(oe,se,be){this.getLayerIndex(oe,se.scope).replace(se.layers,se.options),be()}updateLayers(oe,se,be){this.getLayerIndex(oe,se.scope).update(se.layers,se.removedIds,se.options),be()}loadTile(oe,se,be){se.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,se.type,se.source,se.scope).loadTile(se,be)}decodeRasterArray(oe,se,be){this.getWorkerSource(oe,se.type,se.source,se.scope).decodeRasterArray(se,be)}reloadTile(oe,se,be){se.projection=this.projections[oe]||this.defaultProjection,this.getWorkerSource(oe,se.type,se.source,se.scope).reloadTile(se,be)}abortTile(oe,se,be){this.getWorkerSource(oe,se.type,se.source,se.scope).abortTile(se,be)}removeTile(oe,se,be){this.getWorkerSource(oe,se.type,se.source,se.scope).removeTile(se,be)}removeSource(oe,se,be){if(!(this.workerSources[oe]&&this.workerSources[oe][se.scope]&&this.workerSources[oe][se.scope][se.type]&&this.workerSources[oe][se.scope][se.type][se.source]))return;const ke=this.workerSources[oe][se.scope][se.type][se.source];delete this.workerSources[oe][se.scope][se.type][se.source],ke.removeSource!==void 0?ke.removeSource(se,be):be()}loadWorkerSource(oe,se,be){try{this.self.importScripts(se.url),be()}catch(ke){be(ke.toString())}}syncRTLPluginState(oe,se,be){if(o.fw.isParsed())be(null,!0);else if(o.fw.isParsing())this.rtlPluginParsingListeners.push(be);else try{o.fw.setState(se);const ke=o.fw.getPluginURL();!o.fw.isLoaded()||o.fw.isParsed()||o.fw.isParsing()||ke==null||(o.fw.setState({pluginStatus:o.fx.parsing,pluginURL:o.fw.getPluginURL()}),this.self.importScripts(ke),o.fw.isParsed()?be(null,!0):this.rtlPluginParsingListeners.push(be))}catch(ke){be(ke.toString())}}setDracoUrl(oe,se){this.dracoUrl=se}getAvailableImages(oe,se){this.availableImages[oe]||(this.availableImages[oe]={});let be=this.availableImages[oe][se];return be||(be=[]),be}getAvailableModels(oe,se){this.availableModels[oe]||(this.availableModels[oe]={});let be=this.availableModels[oe][se];return be||(be={}),be}getLayerIndex(oe,se){this.layerIndexes[oe]||(this.layerIndexes[oe]={});let be=this.layerIndexes[oe][se];return be||(be=this.layerIndexes[oe][se]=new F,be.scope=se),be}getWorkerSource(oe,se,be,ke){const we=this.workerSources;return we[oe]||(we[oe]={}),we[oe][ke]||(we[oe][ke]={}),we[oe][ke][se]||(we[oe][ke][se]={}),this.isSpriteLoaded[oe]||(this.isSpriteLoaded[oe]={}),we[oe][ke][se][be]||(we[oe][ke][se][be]=new this.workerSourceTypes[se]({send:(Ne,it,Ve,nt,$t,Tt)=>this.actor.send(Ne,it,Ve,oe,$t,Tt),scheduler:this.actor.scheduler},this.getLayerIndex(oe,ke),this.getAvailableImages(oe,ke),this.getAvailableModels(oe,ke),this.isSpriteLoaded[oe][ke],void 0,this.brightness,this.worldview)),we[oe][ke][se][be]}rasterizeImagesWorker(oe,se,be){const ke=new Map;for(const[we,{image:Ne,imageVariant:it}]of se.tasks.entries()){const Ve=this.imageRasterizer.rasterize(it,Ne,se.scope,oe);ke.set(we,Ve)}be(void 0,ke)}removeRasterizedImages(oe,se,be){this.imageRasterizer.removeImagesFromCacheByIds(se.imageIds,se.scope,oe),be()}enforceCacheSizeLimit(oe,se){o.fy(se)}getWorkerPerformanceMetrics(oe,se,be){be(void 0,void 0)}}return o.fu(self)&&(self.worker=new Cn(self)),Cn})),v(["./shared"],(function(o){var M="3.14.0";const R={create:"create",load:"load",fullLoad:"fullLoad"},B={mark(f){performance.mark(f)},measure(f,n,l){performance.measure(f,n,l)}};function F(f){const n=f.name.split("?")[0];return o.a(n)&&n.includes("mapbox-gl.js")?"javascript":o.a(n)&&n.includes("mapbox-gl.css")?"css":o.b(n)?"fontRange":o.c(n)?"sprite":o.i(n)?"style":o.d(n)?"tilejson":"other"}var G,K={},ee=(function(){if(G)return K;function f(d){return!n(d)}function n(d){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,S,A=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(A);try{S=new Worker(C),x=!0}catch{x=!1}return S&&S.terminate(),URL.revokeObjectURL(C),x})()?(function(){var x=document.createElement("canvas");x.width=x.height=1;var S=x.getContext("2d");if(!S)return!1;var A=S.getImageData(0,0,1,1);return A&&A.width===x.width})()?(l[y=d&&d.failIfMajorPerformanceCaveat]===void 0&&(l[y]=(function(x){var S,A=(function(C){var k=document.createElement("canvas"),z=Object.create(f.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=C,k.getContext("webgl2",z)})(x);if(!A)return!1;try{S=A.createShader(A.VERTEX_SHADER)}catch{return!1}return!(!S||A.isContextLost())&&(A.shaderSource(S,"void main() {}"),A.compileShader(S),A.getShaderParameter(S,A.COMPILE_STATUS)===!0)})(y)),l[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}G=1,K.supported=f,K.notSupportedReason=n;var l={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},K})();function H(f,n,l){const d=document.createElement(f);return n!=null&&(d.className=n),l&&l.appendChild(d),d}function Z(f,n,l){const d=document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(n))d.setAttributeNS(null,y,String(n[y]));return l&&l.appendChild(d),d}const ae=typeof document<"u"?document.documentElement&&document.documentElement.style:null,fe=ae&&ae.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ue;function _e(){ae&&fe&&(ue=ae[fe],ae[fe]="none")}function le(){ae&&fe&&(ae[fe]=ue)}function pe(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",pe,!0)}function Te(){window.addEventListener("click",pe,!0),window.setTimeout((()=>{window.removeEventListener("click",pe,!0)}),0)}function De(f,n){const l=f.getBoundingClientRect();return $e(f,l,n)}function Xe(f,n){const l=f.getBoundingClientRect(),d=[];for(let y=0;y<n.length;y++)d.push($e(f,l,n[y]));return d}function wt(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function $e(f,n,l){const d=f.offsetWidth===n.width?1:f.offsetWidth/n.width;return new o.P((l.clientX-n.left)*d,(l.clientY-n.top)*d)}const vt="01",ft="NO_ACCESS_TOKEN";class bt{constructor(n,l,d){this._transformRequestFn=n,this._customAccessToken=l,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const n=(function(){let l="";for(let d=0;d<10;d++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",vt,l].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=n.token,this._skuTokenExpiresAt=n.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(n,l){return this._transformRequestFn&&this._transformRequestFn(n,l)||{url:n}}normalizeStyleURL(n,l){if(!o.j(n))return n;const d=gt(n);return d.params.push(`sdk=js-${M}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||l)}normalizeGlyphsURL(n,l){if(!o.j(n))return n;const d=gt(n);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||l)}normalizeModelURL(n,l){if(!o.j(n))return n;const d=gt(n);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||l)}normalizeSourceURL(n,l,d,y){if(!o.j(n))return n;const x=gt(n);return x.path=`/v4/${x.authority}.json`,x.params.push("secure"),d&&x.params.push(`language=${d}`),y&&x.params.push(`worldview=${y}`),this._makeAPIURL(x,this._customAccessToken||l)}normalizeIconsetURL(n,l){const d=gt(n);return o.j(n)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||l)):Rt(d)}normalizeSpriteURL(n,l,d,y){const x=gt(n);return o.j(n)?(x.path=`/styles/v1${x.path}/sprite${l}${d}`,this._makeAPIURL(x,this._customAccessToken||y)):(x.path+=`${l}${d}`,Rt(x))}normalizeTileURL(n,l,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),n&&!o.j(n))return n;const y=gt(n);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||d&&y.authority!=="raster"&&d===512?"@2x":""}${o.l.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${o.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${o.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${o.e.TILE_URL_VERSION}${y.path}`);const x=this._customAccessToken||(function(S){for(const A of S){const C=A.match(/^access_token=(.*)$/);if(C)return C[1]}return null})(y.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,x)}canonicalizeTileURL(n,l){const d=gt(n);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return n;let y="mapbox://";d.path.match(/^\/raster\/v1\//)?y+=`raster/${d.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${d.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${d.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let x=d.params;return l&&(x=x.filter((S=>!S.match(/^access_token=/)))),x.length&&(y+=`?${x.join("&")}`),y}canonicalizeTileset(n,l){const d=!!l&&o.j(l),y=[];for(const x of n.tiles||[])o.k(x)?y.push(this.canonicalizeTileURL(x,d)):y.push(x);return y}_makeAPIURL(n,l){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=gt(o.e.API_URL);if(n.protocol=y.protocol,n.authority=y.authority,n.protocol==="http"){const x=n.params.indexOf("secure");x>=0&&n.params.splice(x,1)}if(y.path!=="/"&&(n.path=`${y.path}${n.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return Rt(n);if(l=l||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return n.params=n.params.filter((x=>x.indexOf("access_token")===-1)),n.params.push(`access_token=${l||""}`),Rt(n)}}const St=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function gt(f){const n=f.match(St);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Rt(f){const n=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${n}`}const Ke="mapbox.eventData";function yt(f){if(!f)return null;const n=f.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(o.m(n[1]))}catch{return null}}class Vt{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const l=yt(o.e.ACCESS_TOKEN);let d="";return d=l&&l.u?o.f(l.u):o.e.ACCESS_TOKEN||"",n?`${Ke}.${n}:${d}`:`${Ke}:${d}`}fetchEventData(){const n=o.s("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid");if(n)try{const y=localStorage.getItem(l);y&&(this.eventData=JSON.parse(y));const x=localStorage.getItem(d);x&&(this.anonId=x)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const n=o.s("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid"),y=this.anonId;if(n&&y)try{localStorage.setItem(d,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,l,d,y){if(!o.e.EVENTS_URL)return;const x=gt(o.e.EVENTS_URL);x.params.push(`access_token=${y||o.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(n).toISOString()},A=l?o.h(S,l):S,C={url:Rt(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([A])};this.pendingRequest=o.p(C,(k=>{this.pendingRequest=null,d(k),this.saveEventData(),this.processRequests(y)}))}queueRequest(n,l){this.queue.push(n),this.processRequests(l)}}const qe=new class extends Vt{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,n){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some((l=>o.j(l)||o.k(l)))&&this.queueRequest(Date.now(),n)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=yt(o.e.ACCESS_TOKEN),l=n?n.u:o.e.ACCESS_TOKEN;let d=l!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),d=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),S=new Date(y),A=(y-this.eventData.lastSuccess)/864e5;d=d||A>=1||A<-1||x.getDate()!==S.getDate()}else d=!0;d?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:vt,"enabled.telemetry":!1,userId:this.anonId},(x=>{x||(this.eventData.lastSuccess=y,this.eventData.tokenU=l)}),f):this.processRequests()}},mt=qe.postTurnstileEvent.bind(qe),ar=new class extends Vt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,n,l,d){this.skuToken=n,this.errorCb=d,o.e.EVENTS_URL&&(l||o.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},l):this.errorCb(new Error(ft)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:l}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:vt,skuToken:this.skuToken,userId:this.anonId},(d=>{d?this.errorCb(d):n&&(this.success[n]=!0)}),f))}remove(){this.errorCb=null}},Mr=ar.postMapLoadEvent.bind(ar),Gr=new class extends Vt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let n=this.mapInstanceIdMap.get(f);return n||(n=o.u(),this.mapInstanceIdMap.set(f,n)),n}getEventId(f){const n=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,n+1),n}postStyleLoadEvent(f,n){const{map:l,style:d,importedStyles:y}=n;if(!o.e.EVENTS_URL||!f&&!o.e.ACCESS_TOKEN)return;const x=this.getMapInstanceId(l),S={mapInstanceId:x,eventId:this.getEventId(x),style:d};y.length&&(S.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:S},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:l}=this.queue.shift();this.postEvent(n,l,(()=>{}),f)}},Tr=Gr.postStyleLoadEvent.bind(Gr),vr=new class extends Vt{constructor(){super("gljs.performance")}postPerformanceEvent(f,n){o.e.EVENTS_URL&&(f||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:l}=this.queue.shift(),d=(function(y){const x=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),A=(function(q){const Q={};if(q){for(const Y in q)if(Y!=="other")for(const re of q[Y]){const te=`${Y}ResolveRangeMin`,ce=`${Y}ResolveRangeMax`,me=`${Y}RequestCount`,ye=`${Y}RequestCachedCount`;Q[te]=Math.min(Q[te]||1/0,re.startTime),Q[ce]=Math.max(Q[ce]||-1/0,re.responseEnd);const Ee=Ce=>{Q[Ce]===void 0&&(Q[Ce]=0),++Q[Ce]};re.transferSize!==void 0&&re.transferSize===0&&Ee(ye),Ee(me)}}return Q})((function(q,Q){const Y={};if(q)for(const re of q){const te=Q(re);Y[te]===void 0&&(Y[te]=[]),Y[te].push(re)}return Y})(x,F)),C=window.devicePixelRatio,k=navigator.connection||navigator.mozConnection||navigator.webkitConnection,z=k?k.effectiveType:void 0,V={counters:[],metadata:[],attributes:[]},j=(q,Q,Y)=>{Y!=null&&q.push({name:Q,value:Y.toString()})};for(const q in A)j(V.counters,q,A[q]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(j(V.counters,"interactionRangeMin",y.interactionRange[0]),j(V.counters,"interactionRangeMax",y.interactionRange[1])),S)for(const q of Object.keys(R)){const Q=R[q],Y=S.find((re=>re.name===Q));Y&&j(V.counters,Q,Y.startTime)}return j(V.counters,"visibilityHidden",y.visibilityHidden),j(V.attributes,"style",(function(q){if(q)for(const Q of q){const Y=Q.name.split("?")[0];if(o.i(Y)){const re=Y.split("/").slice(-2);if(re.length===2)return`mapbox://styles/${re[0]}/${re[1]}`}}})(x)),j(V.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),j(V.attributes,"fogEnabled",y.fogEnabled?"true":"false"),j(V.attributes,"projection",y.projection),j(V.attributes,"zoom",y.zoom),j(V.metadata,"devicePixelRatio",C),j(V.metadata,"connectionEffectiveType",z),j(V.metadata,"navigatorUserAgent",navigator.userAgent),j(V.metadata,"screenWidth",window.screen.width),j(V.metadata,"screenHeight",window.screen.height),j(V.metadata,"windowWidth",window.innerWidth),j(V.metadata,"windowHeight",window.innerHeight),j(V.metadata,"mapWidth",y.width/C),j(V.metadata,"mapHeight",y.height/C),j(V.metadata,"webglRenderer",y.renderer),j(V.metadata,"webglVendor",y.vendor),j(V.metadata,"sdkVersion",M),j(V.metadata,"sdkIdentifier","mapbox-gl-js"),V})(l);for(const y of d.metadata);for(const y of d.counters);for(const y of d.attributes);this.postEvent(n,d,(()=>{}),f)}},Br=vr.postPerformanceEvent.bind(vr),or=new class extends Vt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,n,l,d){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const y=gt(o.e.API_URL+o.e.SESSION_PATH);y.params.push(`sku=${n||""}`),y.params.push(`access_token=${d||o.e.ACCESS_TOKEN||""}`);const x={url:Rt(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(x,(S=>{this.pendingRequest=null,l(S),this.saveEventData(),this.processRequests(d)}))}getSessionAPI(f,n,l,d){this.skuToken=n,this.errorCb=d,o.e.SESSION_PATH&&o.e.API_URL&&(l||o.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},l):this.errorCb(new Error(ft)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:l}=this.queue.shift();n&&this.success[n]||this.getSession(l,this.skuToken,(d=>{d?this.errorCb(d):n&&(this.success[n]=!0)}),f)}remove(){this.errorCb=null}},Ar=or.getSessionAPI.bind(or),un=new Set;function sr(f,n){n?un.add(f):un.delete(f)}class ui{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,l){this._updatedSourceCaches[n]=l,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){const l=n.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(n.id),this.setDirty()}removeLayer(n){const l=n.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][n.id]=n,this._updatedLayers[l].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){const n={};for(const l in this._updatedLayers)n[l]=n[l]||{},n[l].updatedIds=Array.from(this._updatedLayers[l].values());for(const l in this._removedLayers)n[l]=n[l]||{},n[l].removedIds=Object.keys(this._removedLayers[l]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(n){return this._updatedImages[n]?Array.from(this._updatedImages[n].values()):[]}updateImage(n,l){this._updatedImages[l]=this._updatedImages[l]||new Set,this._updatedImages[l].add(o.I.toString(n)),this.setDirty()}resetUpdatedImages(n){this._updatedImages[n]&&this._updatedImages[n].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Rn(f){const{userImage:n}=f;return!!(n&&n.render&&n.render())&&(f.data.replace(new Uint8Array(n.data.buffer)),!0)}class In extends o.E{constructor(n){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=n,n!=="raster"&&o.t()&&(this.imageRasterizerDispatcher=new o.D(o.x(),this,"Image Rasterizer Worker",1))}addScope(n){this.loaded.set(n,!1),this.imageProviders.set(n,new Map),this.images.set(n,new Map),this.updatedImages.set(n,new Set),this.callbackDispatchedThisFrame.set(n,new Set),this.patterns.set(n,new Map),this.atlasImage.set(n,new o.r({width:1,height:1}))}removeScope(n){this.loaded.delete(n),this.imageProviders.delete(n),this.images.delete(n),this.updatedImages.delete(n),this.callbackDispatchedThisFrame.delete(n),this.patterns.delete(n),this.atlasImage.delete(n);const l=this.atlasTexture.get(n);l&&(l.destroy(),this.atlasTexture.delete(n))}addImageProvider(n,l){this.imageProviders.has(l)||this.imageProviders.set(l,new Map),this.imageProviders.get(l).set(n.id,n)}removeImageProvider(n,l){this.imageProviders.has(l)&&this.imageProviders.get(l).delete(n)}getPendingImageProviders(){const n=[];for(const l of this.imageProviders.values())for(const d of l.values())d.hasPendingRequests()&&n.push(d);return n}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.y),this._imageRasterizer}isLoaded(){for(const n of this.loaded.keys())if(!this.loaded.get(n))return!1;return!0}setLoaded(n,l){if(this.loaded.get(l)!==n&&(this.loaded.set(l,n),n)){for(const{ids:d,callback:y}of this.requestors)this._notify(d,l,y);this.requestors=[]}}hasImage(n,l){return!!this.getImage(n,l)}getImage(n,l){return this.images.get(l).get(n.toString())}addImage(n,l,d){this._validate(n,d)&&this.images.get(l).set(n.toString(),d)}_validate(n,l){let d=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.z(new Error(`Image "${n.name}" has invalid "stretchX" value`))),d=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.z(new Error(`Image "${n.name}" has invalid "stretchY" value`))),d=!1),this._validateContent(l.content,l)||(this.fire(new o.z(new Error(`Image "${n.name}" has invalid "content" value`))),d=!1),d}_validateStretch(n,l){if(!n)return!0;let d=0;for(const y of n){if(y[0]<d||y[1]<y[0]||l<y[1])return!1;d=y[1]}return!0}_validateContent(n,l){return n?n.length!==4||!l.usvg&&(n[0]<0||l.data.width<n[0]||n[1]<0||l.data.height<n[1]||n[2]<0||l.data.width<n[2]||n[3]<0||l.data.height<n[3])?!1:!(n[2]<n[0]||n[3]<n[1]):!0}updateImage(n,l,d){const y=this.images.get(l).get(n.toString());d.version=y.version+1,this.images.get(l).set(n.toString(),d),this.updatedImages.get(l).add(n),this.removeFromImageRasterizerCache(n,l)}clearUpdatedImages(n){this.updatedImages.get(n).clear()}removeFromImageRasterizerCache(n,l){this.spriteFormat!=="raster"&&(o.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[n],scope:l}):this.imageRasterizer.removeImagesFromCacheByIds([n],l))}removeImage(n,l){const d=this.images.get(l),y=d.get(n.toString());d.delete(n.toString()),this.patterns.get(l).delete(n.toString()),this.removeFromImageRasterizerCache(n,l),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(n){return Array.from(this.images.get(n).keys()).map((l=>o.I.from(l)))}getImages(n,l,d){const y=[],x=[],S=this.imageProviders.get(l);for(const z of n){if(!z.iconsetId){y.push(z);continue}const V=S.get(z.iconsetId);V&&(this.getImage(z,l)?x.push(z):V.addPendingRequest(z))}if(y.length===0)return void this._notify(x,l,d);let A=!0;const C=!!this.loaded.get(l),k=this.images.get(l);if(!C)for(const z of y)k.has(z.toString())||(A=!1);C||A?this._notify(y,l,d):this.requestors.push({ids:y,scope:l,callback:d})}rasterizeImages(n,l){const d=new Map,{tasks:y,scope:x}=n;for(const[S,A]of y.entries()){const C=this.getImage(A.id,x);C&&d.set(S,{image:C,imageVariant:A})}this._rasterizeImages(x,d,l)}_rasterizeImages(n,l,d){if(o.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:l,scope:n},d);else{const y=new Map;for(const[x,{image:S,imageVariant:A}]of l.entries())y.set(x,this.imageRasterizer.rasterize(A,S,n,0));d(void 0,y)}}getUpdatedImages(n){return this.updatedImages.get(n)||new Set}_notify(n,l,d){const y=this.images.get(l),x=new Map;for(const S of n){if(!y.get(S.toString())){if(S.iconsetId)continue;this.fire(new o.A("styleimagemissing",{id:S.name}))}const A=y.get(S.toString());if(!A){o.w(`Image "${S.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const C={data:A.usvg?null:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,usvg:A.usvg,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:!!(A.userImage&&A.userImage.render)};A.usvg&&Object.assign(C,{width:A.icon.usvg_tree.width,height:A.icon.usvg_tree.height}),x.set(o.I.toString(S),C)}d(null,x)}getPixelSize(n){const{width:l,height:d}=this.atlasImage.get(n);return{width:l,height:d}}getPattern(n,l,d){const y=n.toString(),x=this.patterns.get(l),S=x.get(y),A=this.getImage(n,l);if(!A)return null;if(S){if(S.position.version===A.version)return S.position;S.position.version=A.version}else{if(A.usvg&&!A.data){const C=this.getPatternInFlightId(y,l);if(this.patternsInFlight.has(C))return null;this.patternsInFlight.add(C);const k=new o.B(n).scaleSelf(o.q.devicePixelRatio),z=new Map([[k.toString(),{image:A,imageVariant:k}]]);return this._rasterizeImages(l,z,((V,j)=>this.storePatternImage(k,l,A,d,j))),null}this.storePattern(n,l,A)}return this._updatePatternAtlas(l,d),x.get(y).position}getPatternInFlightId(n,l){return o.C(n,l)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(n,l,d,y,x){const S=n.toString(),A=x?x.get(S):void 0;A&&(d.data=A,this.storePattern(n.id,l,d),this._updatePatternAtlas(l,y),this.patternsInFlight.delete(this.getPatternInFlightId(n.id.toString(),l)))}storePattern(n,l,d){const y={w:d.data.width+2*o.F,h:d.data.height+2*o.F,x:0,y:0},x=new o.G(y,d,o.F);this.patterns.get(l).set(n.toString(),{bin:y,position:x})}destroyAtlasTextures(){for(const n of this.atlasTexture.values())n&&n.destroy();this.atlasTexture.clear()}bind(n,l){const d=n.gl;let y=this.atlasTexture.get(l);y?this.dirty&&(y.update(this.atlasImage.get(l)),this.dirty=!1):(y=new o.T(n,this.atlasImage.get(l),d.RGBA8),this.atlasTexture.set(l,y)),y.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(n,l){const d=this.patterns.get(n),y=Array.from(d.values()).map((({bin:k})=>k)),{w:x,h:S}=o.H(y),A=this.atlasImage.get(n);A.resize({width:x||1,height:S||1});const C=this.images.get(n);for(const[k,{bin:z,position:V}]of d.entries()){let j=V.padding;const q=z.x+j,Q=z.y+j,Y=C.get(k).data,re=Y.width,te=Y.height;j=j>1?j-1:j,o.r.copy(Y,A,{x:0,y:0},{x:q,y:Q},{width:re,height:te},l),o.r.copy(Y,A,{x:0,y:te-j},{x:q,y:Q-j},{width:re,height:j},l),o.r.copy(Y,A,{x:0,y:0},{x:q,y:Q+te},{width:re,height:j},l),o.r.copy(Y,A,{x:re-j,y:0},{x:q-j,y:Q},{width:j,height:te},l),o.r.copy(Y,A,{x:0,y:0},{x:q+re,y:Q},{width:j,height:te},l),o.r.copy(Y,A,{x:re-j,y:te-j},{x:q-j,y:Q-j},{width:j,height:j},l),o.r.copy(Y,A,{x:0,y:te-j},{x:q+re,y:Q-j},{width:j,height:j},l),o.r.copy(Y,A,{x:0,y:0},{x:q+re,y:Q+te},{width:j,height:j},l),o.r.copy(Y,A,{x:re-j,y:0},{x:q-j,y:Q+te},{width:j,height:j},l)}this.dirty=!0}beginFrame(){for(const n of this.images.keys())this.callbackDispatchedThisFrame.set(n,new Set)}dispatchRenderCallbacks(n,l){const d=this.images.get(l);for(const y of n){if(this.callbackDispatchedThisFrame.get(l).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(l).add(y.toString());const x=d.get(y.toString());Rn(x)&&this.updateImage(y,l,x)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function hi(f){const n=f.key,l=f.value,d=f.valueSpec||{},y=f.objectElementValidators||{},x=f.style,S=f.styleSpec;let A=[];const C=o.J(l);if(C!=="object")return[new o.V(n,l,`object expected, ${C} found`)];for(const k in l){const z=k.split(".")[0];let V;y[z]?V=y[z]:d[z]?V=ii:y["*"]?V=y["*"]:d["*"]&&(V=ii),V?A=A.concat(V({key:(n&&`${n}.`)+k,value:l[k],valueSpec:d[z]||d["*"],style:x,styleSpec:S,object:l,objectKey:k},l)):A.push(new o.K(n,l[k],`unknown property "${k}"`))}for(const k in d)y[k]||d[k].required&&d[k].default===void 0&&l[k]===void 0&&A.push(new o.V(n,l,`missing required property "${k}"`));return A}function Yi(f){const n=f.value,l=f.valueSpec,d=f.style,y=f.styleSpec,x=f.key,S=f.arrayElementValidator||ii;if(o.J(n)!=="array")return[new o.V(x,n,`array expected, ${o.J(n)} found`)];if(l.length&&n.length!==l.length)return[new o.V(x,n,`array length ${l.length} expected, length ${n.length} found`)];if(l["min-length"]&&n.length<l["min-length"])return[new o.V(x,n,`array length at least ${l["min-length"]} expected, length ${n.length} found`)];let A={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};y.$version<7&&(A.function=l.function),o.J(l.value)==="object"&&(A=l.value);let C=[];for(let k=0;k<n.length;k++)C=C.concat(S({array:n,arrayIndex:k,value:n[k],valueSpec:A,style:d,styleSpec:y,key:`${x}[${k}]`},!0));return C}function Sa(f){const n=f.key,l=f.value,d=f.valueSpec;let y=o.J(l);if(y==="number"&&l!=l&&(y="NaN"),y!=="number")return[new o.V(n,l,`number expected, ${y} found`)];if("minimum"in d){let x=d.minimum;if(o.J(d.minimum)==="array"&&(x=d.minimum[f.arrayIndex]),l<x)return[new o.V(n,l,`${l} is less than the minimum value ${x}`)]}if("maximum"in d){let x=d.maximum;if(o.J(d.maximum)==="array"&&(x=d.maximum[f.arrayIndex]),l>x)return[new o.V(n,l,`${l} is greater than the maximum value ${x}`)]}return[]}function qo(f){const n=f.valueSpec,l=o.M(f.value.type);let d,y,x,S={};const A=l!=="categorical"&&f.value.property===void 0,C=!A,k=o.J(f.value.stops)==="array"&&o.J(f.value.stops[0])==="array"&&o.J(f.value.stops[0][0])==="object",z=hi({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(q){if(l==="identity")return[new o.V(q.key,q.value,'identity function may not have a "stops" property')];let Q=[];const Y=q.value;return Q=Q.concat(Yi({key:q.key,value:Y,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:V})),o.J(Y)==="array"&&Y.length===0&&Q.push(new o.V(q.key,Y,"array must have at least one stop")),Q},default:function(q){return ii({key:q.key,value:q.value,valueSpec:n,style:q.style,styleSpec:q.styleSpec})}}});return l==="identity"&&A&&z.push(new o.V(f.key,f.value,'missing required property "property"')),l==="identity"||f.value.stops||z.push(new o.V(f.key,f.value,'missing required property "stops"')),l==="exponential"&&f.valueSpec.expression&&!o.N(f.valueSpec)&&z.push(new o.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(C&&!o.O(f.valueSpec)?z.push(new o.V(f.key,f.value,"property functions not supported")):A&&!o.Q(f.valueSpec)&&z.push(new o.V(f.key,f.value,"zoom functions not supported"))),l!=="categorical"&&!k||f.value.property!==void 0||z.push(new o.V(f.key,f.value,'"property" property is required')),z;function V(q){let Q=[];const Y=q.value,re=q.key;if(o.J(Y)!=="array")return[new o.V(re,Y,`array expected, ${o.J(Y)} found`)];if(Y.length!==2)return[new o.V(re,Y,`array length 2 expected, length ${Y.length} found`)];if(k){if(o.J(Y[0])!=="object")return[new o.V(re,Y,`object expected, ${o.J(Y[0])} found`)];if(Y[0].zoom===void 0)return[new o.V(re,Y,"object stop key must have zoom")];if(Y[0].value===void 0)return[new o.V(re,Y,"object stop key must have value")];const te=o.M(Y[0].zoom);if(typeof te!="number")return[new o.V(re,Y[0].zoom,"stop zoom values must be numbers")];if(x&&x>te)return[new o.V(re,Y[0].zoom,"stop zoom values must appear in ascending order")];te!==x&&(x=te,y=void 0,S={}),Q=Q.concat(hi({key:`${re}[0]`,value:Y[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:Sa,value:j}}))}else Q=Q.concat(j({key:`${re}[0]`,value:Y[0],style:q.style,styleSpec:q.styleSpec},Y));return o.S(o.U(Y[1]))?Q.concat([new o.V(`${re}[1]`,Y[1],"expressions are not allowed in function stops.")]):Q.concat(ii({key:`${re}[1]`,value:Y[1],valueSpec:n,style:q.style,styleSpec:q.styleSpec}))}function j(q,Q){const Y=o.J(q.value),re=o.M(q.value),te=q.value!==null?q.value:Q;if(d){if(Y!==d)return[new o.V(q.key,te,`${Y} stop domain type must match previous stop domain type ${d}`)]}else d=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean"&&typeof re!="number"&&typeof re!="string"&&typeof re!="boolean")return[new o.V(q.key,te,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&l!=="categorical"){let ce=`number expected, ${Y} found`;return o.O(n)&&l===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(q.key,te,ce)]}return l!=="categorical"||Y!=="number"||typeof re=="number"&&isFinite(re)&&Math.floor(re)===re?l!=="categorical"&&Y==="number"&&typeof re=="number"&&typeof y=="number"&&y!==void 0&&re<y?[new o.V(q.key,te,"stop domain values must appear in ascending order")]:(y=re,l==="categorical"&&re in S?[new o.V(q.key,te,"stop domain values must be unique")]:(S[re]=!0,[])):[new o.V(q.key,te,`integer expected, found ${String(re)}`)]}}function po(f){const n=(f.expressionContext==="property"?o.W:o.X)(o.U(f.value),f.valueSpec);if(n.result==="error")return n.value.map((d=>new o.V(`${f.key}${d.key}`,f.value,d.message)));const l=n.value.expression||n.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!l.outputDefined())return[new o.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!o.Y(l))return[new o.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Vi(l,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!o.Z(l,["zoom","feature-state"]))return[new o.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!o._(l))return[new o.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vi(f,n){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const y of n.valueSpec.expression.parameters)l.delete(y);if(l.size===0)return[];const d=[];return f instanceof o.$&&l.has(f.name)?[new o.V(n.key,n.value,`["${f.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(f.eachChild((y=>{d.push(...Vi(y,n))})),d)}function Bo(f){const n=f.key,l=f.value,d=f.valueSpec,y=[];return Array.isArray(d.values)?d.values.indexOf(o.M(l))===-1&&y.push(new o.V(n,l,`expected one of [${d.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(d.values).indexOf(o.M(l))===-1&&y.push(new o.V(n,l,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(l)} found`)),y}function Ba(f){return o.a1(o.U(f.value))?po(o.L({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Os(f)}function Os(f){const n=f.value,l=f.key;if(o.J(n)!=="array")return[new o.V(l,n,`array expected, ${o.J(n)} found`)];const d=f.styleSpec;let y,x=[];if(n.length<1)return[new o.V(l,n,"filter array must have at least 1 element")];switch(x=x.concat(Bo({key:`${l}[0]`,value:n[0],valueSpec:d.filter_operator,style:f.style,styleSpec:f.styleSpec})),o.M(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&o.M(n[1])==="$type"&&x.push(new o.V(l,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&x.push(new o.V(l,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(y=o.J(n[1]),y!=="string"&&x.push(new o.V(`${l}[1]`,n[1],`string expected, ${y} found`)));for(let S=2;S<n.length;S++)y=o.J(n[S]),o.M(n[1])==="$type"?x=x.concat(Bo({key:`${l}[${S}]`,value:n[S],valueSpec:d.geometry_type,style:f.style,styleSpec:f.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&x.push(new o.V(`${l}[${S}]`,n[S],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let S=1;S<n.length;S++)x=x.concat(Os({key:`${l}[${S}]`,value:n[S],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":y=o.J(n[1]),n.length!==2?x.push(new o.V(l,n,`filter array for "${n[0]}" operator must have 2 elements`)):y!=="string"&&x.push(new o.V(`${l}[1]`,n[1],`string expected, ${y} found`))}return x}function tl(f,n){const l=f.key,d=f.style,y=f.layer,x=f.styleSpec,S=f.value,A=f.objectKey,C=x[`${n}_${f.layerType}`];if(!C)return[];const k=A.match(/^(.*)-use-theme$/);if(n==="paint"&&k&&C[k[1]])return o.S(S)?[].concat(ii({key:f.key,value:S,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:x,expressionContext:"property",propertyType:n,propertyKey:A})):ii({key:l,value:S,valueSpec:{type:"string"},style:d,styleSpec:x});const z=A.match(/^(.*)-transition$/);if(n==="paint"&&z&&C[z[1]]&&C[z[1]].transition)return ii({key:l,value:S,valueSpec:x.transition,style:d,styleSpec:x});const V=f.valueSpec||C[A];if(!V)return[new o.K(l,S,`unknown property "${A}"`)];let j;if(o.J(S)==="string"&&o.O(V)&&!V.tokens&&(j=/^{([^}]+)}$/.exec(S))){const Q=`\`{ "type": "identity", "property": ${j?JSON.stringify(j[1]):'"_"'} }\``;return[new o.V(l,S,`"${A}" does not support interpolation syntax
Use an identity property function instead: ${Q}.`)]}const q=[];if(f.layerType==="symbol")A!=="text-field"||!d||d.glyphs||d.imports||q.push(new o.V(l,S,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&o.a2(o.U(S))&&o.M(S.type)==="identity"&&q.push(new o.V(l,S,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&n==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&o.O(V)&&(o.a3(V)||o.Q(V))){const Q=o.W(o.U(S),V),Y=Q.value.expression||Q.value._styleExpression.expression;Y&&!o.Z(Y,["measure-light"])&&(A==="model-emissive-strength"&&o._(Y)&&o.Y(Y)||q.push(new o.V(l,S,`${A} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(ii({key:f.key,value:S,valueSpec:V,style:d,styleSpec:x,expressionContext:"property",propertyType:n,propertyKey:A}))}function ca(f){return tl(f,"paint")}function Ta(f){return tl(f,"layout")}function ic(f){let n=[];const l=f.value,d=f.key,y=f.style,x=f.styleSpec;l.type||l.ref||n.push(new o.V(d,l,'either "type" or "ref" is required'));let S=o.M(l.type);const A=o.M(l.ref);if(l.id){const C=o.M(l.id);for(let k=0;k<f.arrayIndex;k++){const z=y.layers[k];o.M(z.id)===C&&n.push(new o.V(d,l.id,`duplicate layer id "${l.id}", previously used at line ${z.id.__line__}`))}}if("ref"in l){let C;["type","source","source-layer","filter","layout"].forEach((k=>{k in l&&n.push(new o.V(d,l[k],`"${k}" is prohibited for ref layers`))})),y.layers.forEach((k=>{o.M(k.id)===A&&(C=k)})),C?C.ref?n.push(new o.V(d,l.ref,"ref cannot reference another ref layer")):S=o.M(C.type):typeof A=="string"&&n.push(new o.V(d,l.ref,`ref layer "${A}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(l.source){const C=y.sources&&y.sources[l.source],k=C&&o.M(C.type);C?k==="vector"&&S==="raster"?n.push(new o.V(d,l.source,`layer "${l.id}" requires a raster source`)):k==="raster"&&S!=="raster"?n.push(new o.V(d,l.source,`layer "${l.id}" requires a vector source`)):k!=="vector"||l["source-layer"]?k==="raster-dem"&&S!=="hillshade"?n.push(new o.V(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="raster-array"||["raster","raster-particle"].includes(S)?S==="line"&&l.paint&&(l.paint["line-gradient"]||l.paint["line-trim-offset"])&&k==="geojson"&&!C.lineMetrics?n.push(new o.V(d,l,`layer "${l.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):S==="raster-particle"&&k!=="raster-array"&&n.push(new o.V(d,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):n.push(new o.V(d,l.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new o.V(d,l,`layer "${l.id}" must specify a "source-layer"`)):n.push(new o.V(d,l.source,`source "${l.source}" not found`))}else n.push(new o.V(d,l,'missing required property "source"'));return n=n.concat(hi({key:d,value:l,valueSpec:x.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ii({key:`${d}.type`,value:l.type,valueSpec:x.layer.type,style:f.style,styleSpec:f.styleSpec,object:l,objectKey:"type"}),filter:C=>Ba(o.L({layerType:S},C)),layout:C=>hi({layer:l,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":k=>Ta(o.L({layerType:S},k))}}),paint:C=>hi({layer:l,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":k=>ca(o.L({layerType:S,layer:l},k))}})}})),n}function rl(f){const n=f.value,l=f.key,d=o.J(n);return d!=="string"?[new o.V(l,n,`string expected, ${d} found`)]:[]}const nl={promoteId:function f({key:n,value:l}){if(o.J(l)==="string")return rl({key:n,value:l});if(Array.isArray(l)){const d=[],y=o.U(l),x=o.X(y);return x.result==="error"&&x.value.forEach((S=>{d.push(new o.V(`${n}${S.key}`,null,`${S.message}`))})),o.Z(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||d.push(new o.V(`${n}`,null,"promoteId expression should be only feature dependent")),d}{const d=[];for(const y in l)d.push(...f({key:`${n}.${y}`,value:l[y]}));return d}}};function xo(f){const n=f.value,l=f.key,d=f.styleSpec,y=f.style;if(!n.type)return[new o.V(l,n,'"type" is required')];const x=o.M(n.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(n.url||n.tiles||S.push(new o.K(l,n,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(hi({key:l,value:n,valueSpec:d[`source_${x.replace("-","_")}`],style:f.style,styleSpec:d,objectElementValidators:nl})),S;case"geojson":if(S=hi({key:l,value:n,valueSpec:d.source_geojson,style:y,styleSpec:d,objectElementValidators:nl}),n.cluster)for(const A in n.clusterProperties){const[C,k]=n.clusterProperties[A],z=typeof C=="string"?[C,["accumulated"],["get",A]]:C;S.push(...po({key:`${l}.${A}.map`,value:k,expressionContext:"cluster-map"})),S.push(...po({key:`${l}.${A}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return S;case"video":return hi({key:l,value:n,valueSpec:d.source_video,style:y,styleSpec:d});case"image":return hi({key:l,value:n,valueSpec:d.source_image,style:y,styleSpec:d});case"canvas":return[new o.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Bo({key:`${l}.type`,value:n.type,valueSpec:{values:rs(d)}})}}function rs(f){return f.source.reduce(((n,l)=>{const d=f[l];return d.type.type==="enum"&&(n=n.concat(Object.keys(d.type.values))),n}),[])}function Al(f){const n=f.value,l=f.styleSpec,d=l.light,y=f.style;let x=[];const S=o.J(n);if(n===void 0)return x;if(S!=="object")return x=x.concat([new o.V("light",n,`object expected, ${S} found`)]),x;for(const A in n){const C=A.match(/^(.*)-transition$/),k=A.match(/^(.*)-use-theme$/);x=x.concat(k&&d[k[1]]?ii({key:A,value:n[A],valueSpec:{type:"string"},style:y,styleSpec:l}):C&&d[C[1]]&&d[C[1]].transition?ii({key:A,value:n[A],valueSpec:l.transition,style:y,styleSpec:l}):d[A]?ii({key:A,value:n[A],valueSpec:d[A],style:y,styleSpec:l}):[new o.V(A,n[A],`unknown property "${A}"`)])}return x}function il(f){const n=f.value;let l=[];if(!n)return l;const d=o.J(n);if(d!=="object")return l=l.concat([new o.V("light-3d",n,`object expected, ${d} found`)]),l;const y=f.styleSpec,x=y["light-3d"],S=f.key,A=f.style,C=f.style.lights;for(const V of["type","id"])if(!(V in n))return l=l.concat([new o.V("light-3d",n,`missing property ${V} on light`)]),l;if(n.type&&C)for(let V=0;V<f.arrayIndex;V++){const j=o.M(n.type),q=C[V];o.M(q.type)===j&&l.push(new o.V(S,n.id,`duplicate light type "${n.type}", previously defined at line ${q.id.__line__}`))}const k=`properties_light_${n.type}`;if(!(k in y))return l=l.concat([new o.V("light-3d",n,`Invalid light type ${n.type}`)]),l;const z=y[k];for(const V in n)if(V==="properties"){const j=n[V],q=o.J(j);if(q!=="object")return l=l.concat([new o.V("properties",j,`object expected, ${q} found`)]),l;for(const Q in j){const Y=Q.match(/^(.*)-transition$/),re=Q.match(/^(.*)-use-theme$/);l=l.concat(re&&z[re[1]]?ii({key:V,value:j[Q],valueSpec:{type:"string"},style:A,styleSpec:y}):Y&&z[Y[1]]&&z[Y[1]].transition?ii({key:V,value:n[V],valueSpec:y.transition,style:A,styleSpec:y}):z[Q]?ii({key:Q,value:j[Q],valueSpec:z[Q],style:A,styleSpec:y}):[new o.K(f.key,j[Q],`unknown property "${Q}"`)])}}else l=l.concat(x[V]?ii({key:V,value:n[V],valueSpec:x[V],style:A,styleSpec:y}):[new o.K(V,n[V],`unknown property "${V}"`)]);return l}function oc(f){const n=f.value,l=f.key,d=f.style,y=f.styleSpec,x=y.terrain;let S=[];const A=o.J(n);if(n===void 0||A==="null")return S;if(A!=="object")return S=S.concat([new o.V("terrain",n,`object expected, ${A} found`)]),S;for(const C in n){const k=C.match(/^(.*)-transition$/),z=C.match(/^(.*)-use-theme$/);S=S.concat(z&&x[z[1]]?ii({key:C,value:n[C],valueSpec:{type:"string"},style:d,styleSpec:y}):k&&x[k[1]]&&x[k[1]].transition?ii({key:C,value:n[C],valueSpec:y.transition,style:d,styleSpec:y}):x[C]?ii({key:C,value:n[C],valueSpec:x[C],style:d,styleSpec:y}):[new o.K(C,n[C],`unknown property "${C}"`)])}if(n.source){const C=d.sources&&d.sources[n.source],k=C&&o.M(C.type);C?k!=="raster-dem"&&S.push(new o.V(l,n.source,`terrain cannot be used with a source of type ${String(k)}, it only be used with a "raster-dem" source type`)):S.push(new o.V(l,n.source,`source "${n.source}" not found`))}else S.push(new o.V(l,n,'terrain is missing required property "source"'));return S}function ol(f){const n=f.value,l=f.style,d=f.styleSpec,y=d.fog;let x=[];const S=o.J(n);if(n===void 0)return x;if(S!=="object")return x=x.concat([new o.V("fog",n,`object expected, ${S} found`)]),x;for(const A in n){const C=A.match(/^(.*)-transition$/),k=A.match(/^(.*)-use-theme$/);x=x.concat(k&&y[k[1]]?ii({key:A,value:n[A],valueSpec:{type:"string"},style:l,styleSpec:d}):C&&y[C[1]]&&y[C[1]].transition?ii({key:A,value:n[A],valueSpec:d.transition,style:l,styleSpec:d}):y[A]?ii({key:A,value:n[A],valueSpec:y[A],style:l,styleSpec:d}):[new o.K(A,n[A],`unknown property "${A}"`)])}return x}const ac={"*":()=>[],array:Yi,boolean:function(f){const n=f.value,l=f.key,d=o.J(n);return d!=="boolean"?[new o.V(l,n,`boolean expected, ${d} found`)]:[]},number:Sa,color:function(f){const n=f.key,l=f.value,d=o.J(l);return d!=="string"?[new o.V(n,l,`color expected, ${d} found`)]:o.a0.parseCSSColor(l)===null?[new o.V(n,l,`color expected, "${l}" found`)]:[]},enum:Bo,filter:Ba,function:qo,layer:ic,object:hi,source:xo,model:o.a4,light:Al,"light-3d":il,terrain:oc,fog:ol,string:rl,formatted:function(f){return rl(f).length===0?[]:po(f)},resolvedImage:function(f){return rl(f).length===0?[]:po(f)},projection:function(f){const n=f.value,l=f.styleSpec,d=l.projection,y=f.style;let x=[];const S=o.J(n);if(S==="object")for(const A in n)x=x.concat(ii({key:A,value:n[A],valueSpec:d[A],style:y,styleSpec:l}));else S!=="string"&&(x=x.concat([new o.V("projection",n,`object or string expected, ${S} found`)]));return x},import:function(f){const{value:n,styleSpec:l}=f,{data:d,...y}=n;Object.defineProperty(y,"__line__",{value:n.__line__,enumerable:!1});let x=hi(o.L({},f,{value:y,valueSpec:l.import}));return o.M(y.id)===""&&x.push(new o.V(`${f.key}.id`,y,"import id can't be an empty string")),d&&(x=x.concat(Qc(d,l,{key:`${f.key}.data`}))),x},iconset:function(f){const n=f.value,l=f.key,d=f.styleSpec,y=f.style;if(!n.type)return[new o.V(l,n,'"type" is required')];const x=o.M(n.type);let S=[];if(S=S.concat(hi({key:l,value:n,valueSpec:d[`iconset_${x}`],style:y,styleSpec:d})),x==="source"&&n.source){const A=y.sources&&y.sources[n.source],C=A&&o.M(A.type);A?C!=="raster-array"&&S.push(new o.V(l,n.source,`iconset cannot be used with a source of type ${String(C)}, it only be used with a "raster-array" source type`)):S.push(new o.V(l,n.source,`source "${n.source}" not found`))}return S}};function ii(f,n=!1){const l=f.value,d=f.valueSpec,y=f.styleSpec;if(d.expression&&o.a2(o.M(l)))return qo(f);if(d.expression&&o.S(o.U(l)))return po(f);if(d.type&&ac[d.type]){const x=ac[d.type](f);return n===!0&&x.length>0&&o.J(f.value)==="array"?po(f):x}return hi(o.L({},f,{valueSpec:d.type?y[d.type]:d}))}function Jc(f){const n=f.value,l=f.key,d=rl(f);return d.length||(n.indexOf("{fontstack}")===-1&&d.push(new o.V(l,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&d.push(new o.V(l,n,'"glyphs" url must include a "{range}" token'))),d}function Qc(f,n=o.a5,l={}){return ii({key:l.key||"",value:f,valueSpec:n.$root,styleSpec:n,style:f,objectElementValidators:{glyphs:Jc,"*":()=>[]}})}function Go(f,n=o.a5){return ke(Qc(f,n))}const al=f=>ke(xo(f)),pd=f=>ke(Al(f)),eu=f=>ke(il(f)),kt=f=>ke(oc(f)),sl=f=>ke(ol(f)),md=f=>ke((function(n){const l=n.value,d=n.style,y=n.styleSpec,x=y.snow;let S=[];const A=o.J(l);if(l===void 0)return S;if(A!=="object")return S=S.concat([new o.V("snow",l,`object expected, ${A} found`)]),S;for(const C in l){const k=C.match(/^(.*)-transition$/);S=S.concat(k&&x[k[1]]&&x[k[1]].transition?ii({key:C,value:l[C],valueSpec:y.transition,style:d,styleSpec:y}):x[C]?ii({key:C,value:l[C],valueSpec:x[C],style:d,styleSpec:y}):[new o.K(C,l[C],`unknown property "${C}"`)])}return S})(f)),tu=f=>ke((function(n){const l=n.value,d=n.style,y=n.styleSpec,x=y.rain;let S=[];const A=o.J(l);if(l===void 0)return S;if(A!=="object")return S=S.concat([new o.V("rain",l,`object expected, ${A} found`)]),S;for(const C in l){const k=C.match(/^(.*)-transition$/);S=S.concat(k&&x[k[1]]&&x[k[1]].transition?ii({key:C,value:l[C],valueSpec:y.transition,style:d,styleSpec:y}):x[C]?ii({key:C,value:l[C],valueSpec:x[C],style:d,styleSpec:y}):[new o.K(C,l[C],`unknown property "${C}"`)])}return S})(f)),Cn=f=>ke(ic(f)),et=f=>ke(Ba(f)),oe=f=>ke(ca(f)),se=f=>ke(Ta(f)),be=f=>ke(o.a4(f));function ke(f){return f.slice().sort(((n,l)=>n.line&&l.line?n.line-l.line:0))}function we(f,n){let l=!1;if(n&&n.length)for(const d of n)d instanceof o.K?o.w(d.message):(f.fire(new o.z(new Error(d.message))),l=!0);return l}let Ne;class it extends o.E{constructor(n,l="flat"){super(),this._transitionable=new o.a6(Ne||(Ne=new o.a7({anchor:new o.a8(o.a5.light.anchor),position:new o.a9(o.a5.light.position),color:new o.a8(o.a5.light.color),intensity:new o.a8(o.a5.light.intensity)}))),this.setLight(n,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,l,d={}){this._validate(pd,n,d)||(this._transitionable.setTransitionOrValue(n),this.id=l)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,d){return(!d||d.validate!==!1)&&we(this,n.call(Go,o.h({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let Ve=class extends o.E{constructor(f,n,l,d,y){super(),this.scope=l,this._transitionable=new o.a6(new o.a7({source:new o.a8(o.a5.terrain.source),exaggeration:new o.a8(o.a5.terrain.exaggeration)}),l,d),this._transitionable.setTransitionOrValue(f,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n,this.worldview=y}get(){return this._transitionable.serialize()}set(f,n){this._transitionable.setTransitionOrValue(f,n)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new o.aa(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const n=f.value.expression;if(!n)return null;let l=-1,d=-1,y=1;for(const x of n.zoomStops)y=n.evaluate(new o.aa(x,{worldview:this.worldview})),y>.01?(l=x,d=-1):d=x;return y<.01&&l>0&&d>l?[l,d]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof o.ab}};const nt=45,$t=65,Tt=.05;function xr(f,n,l,d){const y=o.af(nt,$t,l),[x,S]=Or(f,d);let A=1-Math.min(1,Math.exp((n-x)/(S-x)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*y*f.alpha}function Or(f,n){const l=.5/Math.tan(.5*n);return[f.range[0]+l,f.range[1]+l]}function Nr(f,n,l,d,y){const x=o.ad([],[n,l,d],y.mercatorFogMatrix);return xr(f,o.ae(x),y.pitch,y._fov)}function ln(f,n,l,d,y,x,S){const A=[[l,d,0],[y,d,0],[y,x,0],[l,x,0]];let C=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(const z of A){const V=o.ad([],z,n),j=o.ae(V);C=Math.min(C,j),k=Math.max(k,j)}return[xr(f,C,S.pitch,S._fov),xr(f,k,S.pitch,S._fov)]}class Jr extends o.E{constructor(n,l,d,y){super();const x=new o.a7({range:new o.a8(o.a5.fog.range),color:new o.a8(o.a5.fog.color),"color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.a8(o.a5.fog["high-color"]),"high-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.a8(o.a5.fog["space-color"]),"space-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.a8(o.a5.fog["horizon-blend"]),"star-intensity":new o.a8(o.a5.fog["star-intensity"]),"vertical-range":new o.a8(o.a5.fog["vertical-range"])});this._transitionable=new o.a6(x,d,new Map(y)),this.set(n,y),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new o.ag(x),this.scope=d}get state(){const n=this._transform,l=n.projection.name==="globe",d=o.ah(n.zoom),y=this.properties.get("range"),x=[.5,3];return{range:l?[o.ai(x[0],y[0],d),o.ai(x[1],y[1],d)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,l,d={}){if(this._validate(sl,n,d))return;const y=o.h({},n);for(const x of Object.keys(o.a5.fog))y[x]===void 0&&(y[x]=o.a5.fog[x].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.af(nt,$t,n))*l.a}getOpacityAtLatLng(n,l){return this._transform.projection.supportsFog?(function(d,y,x){const S=o.ac.fromLngLat(y),A=x.elevation?x.elevation.getAtPointOrZero(S):0;return Nr(d,S.x,S.y,A,x)})(this.state,n,l):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];const l=this._transform.calculateFogTileMatrix(n.toUnwrapped());return ln(this.state,l,0,0,o.aj,o.aj,this._transform)}getOpacityForBounds(n,l,d,y,x){return this._transform.projection.supportsFog?ln(this.state,n,l,d,y,x,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Or(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;const l=[4,5,6,7];for(const d of l){const y=n.points[d];let x;if(y[2]>=0)x=y;else{const S=n.points[d-4];x=o.ak(S,y,S[2]/(S[2]-y[2]))}if(Nr(this.state,x[0],x[1],0,this._transform)>=Tt)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,d){return(!d||d.validate!==!1)&&we(this,n.call(Go,o.h({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let hn,Yn,fn,Fi,$n=class extends o.E{constructor(f,n,l,d){super();const y=hn||(hn=new o.a7({density:new o.a8(o.a5.snow.density),intensity:new o.a8(o.a5.snow.intensity),color:new o.a8(o.a5.snow.color),opacity:new o.a8(o.a5.snow.opacity),vignette:new o.a8(o.a5.snow.vignette),"vignette-color":new o.a8(o.a5.snow["vignette-color"]),"center-thinning":new o.a8(o.a5.snow["center-thinning"]),direction:new o.a8(o.a5.snow.direction),"flake-size":new o.a8(o.a5.snow["flake-size"])}));this._transitionable=new o.a6(y,l,new Map(d)),this.set(f,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(y),this.scope=l}get state(){const f=this.properties.get("opacity"),n=this.properties.get("color"),l=this.properties.get("direction"),d=o.al(l[0]),y=-Math.max(o.al(l[1]),.01),x=[Math.cos(d)*Math.cos(y),Math.sin(d)*Math.cos(y),Math.sin(y)],S=this.properties.get("vignette"),A=this.properties.get("vignette-color");return A.a=S,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(n.r,n.g,n.b,n.a*f),direction:x,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:A}}get(){return this._transitionable.serialize()}set(f,n,l={}){if(this._validate(md,f,l))return;const d=o.h({},f);for(const y of Object.keys(o.a5.snow))d[y]===void 0&&(d[y]=o.a5.snow[y].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,n,l){return(!l||l.validate!==!1)&&we(this,f.call(Go,o.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}},ro=class extends o.E{constructor(f,n,l,d){super();const y=Yn||(Yn=new o.a7({density:new o.a8(o.a5.rain.density),intensity:new o.a8(o.a5.rain.intensity),color:new o.a8(o.a5.rain.color),opacity:new o.a8(o.a5.rain.opacity),vignette:new o.a8(o.a5.rain.vignette),"vignette-color":new o.a8(o.a5.rain["vignette-color"]),"center-thinning":new o.a8(o.a5.rain["center-thinning"]),direction:new o.a8(o.a5.rain.direction),"droplet-size":new o.a8(o.a5.rain["droplet-size"]),"distortion-strength":new o.a8(o.a5.rain["distortion-strength"])}));this._transitionable=new o.a6(y,l,new Map(d)),this.set(f,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(y),this.scope=l}get state(){const f=this.properties.get("opacity"),n=this.properties.get("color"),l=this.properties.get("direction"),d=o.al(l[0]),y=-Math.max(o.al(l[1]),.01),x=[Math.cos(d)*Math.cos(y),Math.sin(d)*Math.cos(y),Math.sin(y)],S=this.properties.get("vignette-color");return S.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(n.r,n.g,n.b,n.a*f),direction:x,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(f,n,l={}){if(this._validate(tu,f,l))return;const d=o.h({},f);for(const y of Object.keys(o.a5.rain))d[y]===void 0&&(d[y]=o.a5.rain[y].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,n)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,n,l){return(!l||l.validate!==!1)&&we(this,f.call(Go,o.h({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}};class qn extends o.E{constructor(n,l,d,y){super(),this.scope=d,this._options=n,this.properties=new o.ag(l),this._transitionable=new o.a6(l,d,new Map(y)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,l){this._options=n,this._transitionable.setTransitionOrValue(n.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Dn{constructor(n,l,d){this.screenBounds=n,this.cameraPoint=d.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=l,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(n,l){let d,y;if(n instanceof o.P||typeof n[0]=="number"){const x=o.P.convert(n);d=[x],y=l.isPointAboveHorizon(x)}else{const x=o.P.convert(n[0]),S=o.P.convert(n[1]),A=x.add(S)._div(2);d=[x,S],y=o.ao(x,S).every((C=>l.isPointAboveHorizon(C)))&&l.isPointAboveHorizon(A)}return new Dn(d,y,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return o.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const l=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],y=o.ao(l,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<d.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?y[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(y[3]=this.cameraPoint)),o.ap(y,n)}bufferedCameraGeometryGlobe(n){const l=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],y=o.ao(l,d,n),x=this.cameraPoint.clone();switch(3*((x.y>l.y)+(x.y>d.y))+((x.x>l.x)+(x.x>d.x))){case 0:y[0]=x,y[4]=x.clone();break;case 1:y.splice(1,0,x);break;case 2:y[1]=x;break;case 3:y.splice(4,0,x);break;case 5:y.splice(2,0,x);break;case 6:y[3]=x;break;case 7:y.splice(3,0,x);break;case 8:y[2]=x}return y}containsTile(n,l,d,y=0){const x=n.queryPadding/l._pixelsPerMercatorPixel+1,S=d?this._bufferedCameraMercator(x,l):this._bufferedScreenMercator(x,l);let A=n.tileID.wrap+(S.unwrapped?y:0);const C=S.polygon.map((re=>o.aq(n.tileTransform,re,A)));if(!o.ar(C,0,0,o.aj,o.aj))return;A=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const k=this.screenGeometryMercator.polygon.map((re=>o.as(n.tileTransform,re,A))),z=k.map((re=>new o.P(re[0],re[1]))),V=l.getFreeCameraOptions().position||new o.ac(0,0,0),j=o.as(n.tileTransform,V,A),q=k.map((re=>{const te=o.at(re,re,j);return o.au(te,te),new o.av(j,te)})),Q=o.aw(n,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:q,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(Y=o.ax(C),Y.min.x=o.ay(Y.min.x,0,o.aj),Y.min.y=o.ay(Y.min.y,0,o.aj),Y.max.x=o.ay(Y.max.x,0,o.aj),Y.max.y=o.ay(Y.max.y,0,o.aj),Y),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:Q};var Y}_bufferedScreenMercator(n,l){const d=_i(n);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let y;return y=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),l):{polygon:this.bufferedScreenGeometry(n).map((x=>l.pointCoordinate3D(x))),unwrapped:!0},this._screenRaycastCache[d]=y,y}}_bufferedCameraMercator(n,l){const d=_i(n);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let y;return y=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),l):{polygon:this.bufferedCameraGeometry(n).map((x=>l.pointCoordinate3D(x))),unwrapped:!0},this._cameraRaycastCache[d]=y,y}}_projectAndResample(n,l){const d=(function(x,S){const A=o.az([],S.pixelMatrix,S.globeMatrix),C=[0,-o.aB,0,1],k=[0,o.aB,0,1],z=[0,0,0,1];o.aA(C,C,A),o.aA(k,k,A),o.aA(z,z,A);const V=new o.P(C[0]/C[3],C[1]/C[3]),j=new o.P(k[0]/k[3],k[1]/k[3]),q=o.aC(x,V)&&C[3]<z[3],Q=o.aC(x,j)&&k[3]<z[3];if(!q&&!Q)return null;const Y=(function(Re,Ae,Pe){for(let Ie=1;Ie<Re.length;Ie++){const Ye=Ei(Ae.pointCoordinate3D(Re[Ie-1]).x),Be=Ei(Ae.pointCoordinate3D(Re[Ie]).x);if(Pe<0){if(Ye<Be)return{idx:Ie,t:-Ye/(Be-1-Ye)}}else if(Be<Ye)return{idx:Ie,t:(1-Ye)/(Be+1-Ye)}}return null})(x,S,q?-1:1);if(!Y)return null;const{idx:re,t:te}=Y;let ce=re>1?wi(x.slice(0,re),S):[],me=re<x.length?wi(x.slice(re),S):[];ce=ce.map((Re=>new o.P(Ei(Re.x),Re.y))),me=me.map((Re=>new o.P(Ei(Re.x),Re.y)));const ye=[...ce];ye.length===0&&ye.push(me[me.length-1]);const Ee=o.ai(ye[ye.length-1].y,(me.length===0?ce[0]:me[0]).y,te);let Ce;return Ce=q?[new o.P(0,Ee),new o.P(0,0),new o.P(1,0),new o.P(1,Ee)]:[new o.P(1,Ee),new o.P(1,1),new o.P(0,1),new o.P(0,Ee)],ye.push(...Ce),me.length===0?ye.push(ce[0]):ye.push(...me),{polygon:ye.map((Re=>new o.ac(Re.x,Re.y))),unwrapped:!1}})(n,l);if(d)return d;const y=(function(x,S){let A=!1,C=-1/0,k=0;for(let V=0;V<x.length-1;V++)x[V].x>C&&(C=x[V].x,k=V);for(let V=0;V<x.length-1;V++){const j=(k+V)%(x.length-1),q=x[j],Q=x[j+1];Math.abs(q.x-Q.x)>.5&&(q.x<Q.x?(q.x+=1,j===0&&(x[x.length-1].x+=1)):(Q.x+=1,j+1===x.length-1&&(x[0].x+=1)),A=!0)}const z=o.aD(S.center.lng);return A&&z<Math.abs(z-1)&&x.forEach((V=>{V.x-=1})),{polygon:x,unwrapped:A}})(wi(n,l).map((x=>new o.P(Ei(x.x),x.y))),l);return{polygon:y.polygon.map((x=>new o.ac(x.x,x.y))),unwrapped:y.unwrapped}}}function wi(f,n){return o.aE(f,(l=>{const d=n.pointCoordinate3D(l);l.x=d.x,l.y=d.y}),1/256)}function Ei(f){return f<0?1+f%1:f%1}function _i(f){return 100*f|0}function ao(f,n,l,d,y){const x=function(A,C){if(A)return y(A);if(C){if(f.url&&C.tiles&&f.tiles&&delete f.tiles,C.variants){if(!Array.isArray(C.variants))return y(new Error("variants must be an array"));for(const z of C.variants){if(z==null||typeof z!="object"||z.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(z.capabilities))return y(new Error("capabilities must be an array"));if(z.capabilities.length===1&&z.capabilities[0]==="meshopt"){C=o.h(C,z);break}}}const k=o.aF(o.h({},C,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);k.tiles=n.canonicalizeTileset(k,f.url),y(null,k)}},S=(function(A,C,k){if(!A)return null;if(!C&&!k)return A;k=k||A.worldview_default;const z=Object.values(A.language||{});if(z.length===0)return null;const V=Object.values(A.worldview||{});if(V.length===0)return null;const j=z.every((Q=>Q===C)),q=V.every((Q=>Q===k));return j&&q?A:C in(A.language_options||{})||k in(A.worldview_options||{})?null:A.language_options&&A.worldview_options?A:null})(f.data,l,d);return S?o.q.frame((()=>x(null,S))):f.url?o.n(n.transformRequest(n.normalizeSourceURL(f.url,null,l,d),o.R.Source),x):o.q.frame((()=>{const{data:A,...C}=f;x(null,C)}))}function no(f,n){const l=Math.pow(2,n.z),d=Math.floor(o.aD(f.getWest())*l),y=Math.floor(o.aH(f.getNorth())*l),x=Math.ceil(o.aD(f.getEast())*l),S=Math.ceil(o.aH(f.getSouth())*l);return n.x>=d&&n.x<x&&n.y>=y&&n.y<S}class ea{constructor(n,l,d){this.bounds=n?o.aG.convert(this.validateBounds(n)):null,this.minzoom=l||0,this.maxzoom=d||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}addExtraBounds(n){if(n){this.extraBounds||(this.extraBounds=[]);for(const l of n)this.extraBounds.push(o.aG.convert(this.validateBounds(l)))}}contains(n){if(n.z>this.maxzoom||n.z<this.minzoom||this.bounds&&!no(this.bounds,n))return!1;if(!this.extraBounds)return!0;for(const l of this.extraBounds)if(no(l,n))return!0;return!1}static fromTileJSON(n){if(!n.bounds&&!n.extra_bounds)return null;const l=new ea(n.bounds,n.minzoom,n.maxzoom);return l.addExtraBounds(n.extra_bounds),l}}class Ea extends o.E{constructor(n,l,d,y){if(super(),this.id=n,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.h(this,o.aF(l,["url","scheme","tileSize","promoteId"])),this._options=o.h({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new o.aI}load(n){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=ao(this._options,this.map._requestManager,l,d,((y,x)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new o.z(y));else if(x){if(o.h(this,x),this.hasWorldviews=!!x.worldview_options,x.worldview_default&&(this.worldviewDefault=x.worldview_default),x.vector_layers){this.vectorLayers=x.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const S of x.vector_layers)this.vectorLayerIds.push(S.id),x.worldview&&x.worldview[S.source]&&this.localizableLayerIds.add(S.id)}this.tileBounds=ea.fromTileJSON(x),mt(x.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}n&&n(y)}))}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=o.C(this.id,this.scope);this.load((()=>this.map.style.clearSource(n)))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}loadTile(n,l){const d=n.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(d),x=this.map._requestManager.transformRequest(y,o.R.Tile),S=this.map.style?this.map.style.getLut(this.scope):null,A=S?{image:S.image.clone()}:null,C={request:x,data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,maxZoom:this.maxzoom,lut:A,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&o.j(d)&&(C.localizableLayerIds=this.localizableLayerIds),C.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=l:n.request=n.actor.send("reloadTile",C,k.bind(this));else if(n.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",C,k.bind(this),void 0,!0);else{const z=o.aJ.call({deduped:this._deduped},C,((V,j)=>{V||!j?k.call(this,V):(C.data={cacheControl:j.cacheControl,expires:j.expires,rawData:j.rawData.slice(0)},n.actor&&n.actor.send("loadTile",C,k.bind(this),void 0,!0))}),!0);n.request={cancel:z}}function k(z,V){return delete n.request,n.aborted?l(null):z&&z.status!==404?l(z):(V&&V.resourceTiming&&(n.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&n.setExpiryData(V),n.loadVectorData(V,this.map.painter),o.aK(this.dispatcher),l(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,l){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class No extends o.E{constructor(n,l,d,y){super(),this.id=n,this.dispatcher=d,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.h({type:"raster"},l),o.h(this,o.aF(l,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const l=this.map.getWorldview();this._tileJSONRequest=ao(this._options,this.map._requestManager,null,l,((d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new o.z(d)):y&&(o.h(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map((x=>x.id))),this.tileBounds=ea.fromTileJSON(y),mt(y.tiles),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),n&&n(d)}))}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();const n=o.C(this.id,this.scope);this.load((()=>this.map.style.clearSource(n)))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(n){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,l){const d=o.q.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);n.request=o.o(this.map._requestManager.transformRequest(y,o.R.Tile),((x,S,A,C)=>(delete n.request,n.aborted?(n.state="unloaded",l(null)):x?(n.state="errored",l(x)):S?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:A,expires:C}),n.setTexture(S,this.map.painter),n.state="loaded",o.aK(this.dispatcher),void l(null)):l(null))))}abortTile(n,l){n.request&&(n.request.cancel(),delete n.request),l&&l()}unloadTile(n,l){n.texture&&n.texture instanceof o.T?(n.destroy(!0),n.texture&&n.texture instanceof o.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),l&&l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class sc extends No{constructor(n,l,d,y){super(n,l,d,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=o.h({type:"raster-array"},l)}triggerRepaint(n){const l=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);l&&l.enabled&&d&&l._clearRenderCacheForTile(d.id,n.tileID),this.map.triggerRepaint()}loadTile(n,l){const d=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(d,o.R.Tile),x={request:y,uid:n.uid,tileID:n.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};n.source=this.id,n.scope=this.scope,n.requestParams=y,n.actor||(n.actor=this.dispatcher.getActor());const S=(A,C,k,z)=>{if(delete n.request,n.aborted)return n.state="unloaded",l(null);if(A)return A.name==="AbortError"?void 0:(n.state="errored",l(A));if(this.map._refreshExpiredTiles&&C&&n.setExpiryData({cacheControl:k,expires:z}),this.partial)n.state="empty";else{if(!C)return l(null);n.state="loaded",n._isHeaderLoaded=!0,n._mrt=C}l(null)};n.request=this.partial?n.fetchHeader(void 0,S.bind(this)):n.actor.send("loadTile",x,S.bind(this),void 0,!0)}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n,l){const d=n.texturePerLayer;if(n.flushAllQueues(),d.size){n.destroy(!0);for(const y of d.values())this.map.painter.saveTileTexture(y)}else n.destroy()}prepareTile(n,l,d,y){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(l,d,y,((x,S)=>{if(x)return n.state="errored",this.fire(new o.z(x)),void this.triggerRepaint(n);S&&(n._isHeaderLoaded=!0,n.setTexturePerLayer(d,S,this.map.painter),n.state="loaded",this.triggerRepaint(n))})))}getInitialBand(n){if(!this.rasterLayers)return 0;const l=this.rasterLayers.find((({id:x})=>x===n)),d=l&&l.fields,y=d&&d.bands&&d.bands;return y?y[0]:0}getTextureDescriptor(n,l,d){if(!n)return;const y=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let x=null;l instanceof o.aN?x=l.paint.get("raster-array-band"):l instanceof o.aO&&(x=l.paint.get("raster-particle-array-band"));const S=x||this.getInitialBand(y);if(S==null)return;if(!n.textureDescriptorPerLayer.get(l.id))return void this.prepareTile(n,y,l.id,S);if(n.updateNeeded(l.id,S)&&!d)return;const A=n.textureDescriptorPerLayer.get(l.id);return Object.assign({},A,{texture:n.texturePerLayer.get(l.id)})}getImages(n,l){const d=new Map;for(const y of n)for(const x of l){const[S,A]=x.split("/"),C=y.getLayer(S);if(!C||!C.hasBand(A)||!C.hasDataForBand(A))continue;const{bytes:k,tileSize:z,buffer:V}=C.getBandView(A),j=z+2*V,q={data:new o.r({width:j,height:j},k),pixelRatio:2,sdf:!1,usvg:!1,version:0};d.set(x,q)}return d}}const gd={vector:Ea,raster:No,"raster-dem":class extends No{constructor(f,n,l,d){super(f,n,l,d),this.type="raster-dem",this.maxzoom=22,this._options=o.h({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(f,n){const l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(y,x){y&&(f.state="errored",n(y)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",n(null))}f.request=o.o(this.map._requestManager.transformRequest(l,o.R.Tile),function(y,x,S,A){if(delete f.request,f.aborted)f.state="unloaded",n(null);else if(y)f.state="errored",n(y);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:S,expires:A});const C=ImageBitmap&&x instanceof ImageBitmap&&o.t(),k=1-(x.width-o.aL(x.width))/2;k<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const z=C?x:o.q.getImageData(x,k),V={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:k};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",V,d.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const n=f.canonical,l=Math.pow(2,n.z),d=(n.x-1+l)%l,y=n.x===0?f.wrap-1:f.wrap,x=(n.x+1+l)%l,S=n.x+1===l?f.wrap+1:f.wrap,A={};return A[new o.aM(f.overscaledZ,y,n.z,d,n.y).key]={backfilled:!1},A[new o.aM(f.overscaledZ,S,n.z,x,n.y).key]={backfilled:!1},n.y>0&&(A[new o.aM(f.overscaledZ,y,n.z,d,n.y-1).key]={backfilled:!1},A[new o.aM(f.overscaledZ,f.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},A[new o.aM(f.overscaledZ,S,n.z,x,n.y-1).key]={backfilled:!1}),n.y+1<l&&(A[new o.aM(f.overscaledZ,y,n.z,d,n.y+1).key]={backfilled:!1},A[new o.aM(f.overscaledZ,f.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},A[new o.aM(f.overscaledZ,S,n.z,x,n.y+1).key]={backfilled:!1}),A}},"raster-array":sc,geojson:class extends o.E{constructor(f,n,l,d){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(d),this._data=n.data,this._options=o.h({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.minzoom!==void 0&&(this.minzoom=n.minzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const y=o.aj/this.tileSize;this.workerOptions=o.h({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*y,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*y,extent:o.aj,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.aj,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*y,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter,dynamic:n.dynamic},n.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new o.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new o.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const n=new Map;for(const l of this._data.features)n.set(l.id,l);for(const l of f.features)n.set(l.id,l);this._data.features=[...n.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterChildren(f,n){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},n),this}getClusterLeaves(f,n,l,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:n,offset:l},d),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.A("dataloading",{dataType:"source"})),this._loaded=!1;const n=o.h({append:f},this.workerOptions);n.scope=this.scope;const l=this._data;typeof l=="string"?(n.request=this.map._requestManager.transformRequest(o.q.resolveURL(l),o.R.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,n,((d,y)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new o.z(d));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(x.resourceTiming=y.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new o.A("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const f=o.C(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,n){const l=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,y=d?{image:d.image.clone()}:null,x=this._partialReload,S={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:x,worldview:this.map.getWorldview()};f.request=this.actor.send(l,S,((A,C)=>x&&!C?(f.state="loaded",n(null)):(delete f.request,f.destroy(),f.aborted?n(null):A?n(A):(f.loadVectorData(C,this.map.painter,l==="reloadTile"),n(null)))),void 0,l==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,n){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aP{constructor(f,n,l,d){super(f,n,l,d),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const n of f.urls)this.urls.push(this.map._requestManager.transformRequest(n,o.R.Source).url);o.aQ(this.urls,((n,l)=>{this._loaded=!0,n?this.fire(new o.z(n)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const n=this.video.seekable;f<n.start(0)||f>n.end(0)?this.fire(new o.z(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,n=f.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(f,this.video,n.RGBA8),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aP,model:class extends o.E{constructor(f,n,l,d){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){const f=[];for(const n in this._options.models){const l=this._options.models[n],d=o.aS(this.map._requestManager.transformRequest(l.uri,o.R.Model).url).then((y=>{if(!y)return;const x=o.aT(y),S=new o.aU(n,l.position,l.orientation,x);S.computeBoundsAndApplyParent(),this.models.push(S)})).catch((y=>{this.fire(new o.z(new Error(`Could not load model ${n} from ${l.uri}: ${y.message}`)))}));f.push(d)}Promise.allSettled(f).then((()=>{this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((n=>{this._loaded=!0,this.fire(new o.z(new Error(`Could not load models: ${n.message}`)))}))}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,n){}serialize(){return this._options}},"batched-model":class extends o.E{constructor(f,n,l,d){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=o.C(this.id,this.scope);this.load((()=>this.map.style.clearSource(f)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map.getWorldview();this._tileJSONRequest=ao(this._options,this.map._requestManager,n,l,((d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new o.z(d))):y&&(o.h(this,y),y.bounds&&(this.tileBounds=new ea(y.bounds,this.minzoom,this.maxzoom)),mt(y.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),f&&f(d)}))}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,n){const l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(l,o.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.q.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=n;else{if(f.buckets){const x=Object.values(f.buckets);for(const S of x)S.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",d,y.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",d,y.bind(this),void 0,!0);function y(x,S){return f.aborted?n(null):x&&x.status!==404?n(x):(this.map._refreshExpiredTiles&&S&&f.setExpiryData(S),f.loadModelData(S,this.map.painter),f.state="loaded",void n(null))}}serialize(){return o.h({},this._options)}},canvas:class extends o.aP{constructor(f,n,l,d){super(f,n,l,d),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some((y=>!Array.isArray(y)||y.length!==2||y.some((x=>typeof x!="number"))))||this.fire(new o.z(new o.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.z(new o.V(`sources.${f}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.z(new o.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new o.z(new o.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.z(new o.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof o.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(n,this.canvas,n.gl.RGBA8,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends o.E{constructor(f,n,l,d){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=n,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ea(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),o.h(this,o.aF(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:n,y:l,z:d}=f.canonical;return this._implementation.hasTile({x:n,y:l,z:d})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,n){const{x:l,y:d,z:y}=f.tileID.canonical,x=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:l,y:d,z:y},{signal:x.signal})).then(function(S){return delete f.request,f.aborted?(f.state="unloaded",n(null)):S===void 0?(f.state="errored",n(null)):S===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",n(null)):(function(A){return A instanceof ImageData||A instanceof HTMLCanvasElement||A instanceof ImageBitmap||A instanceof HTMLImageElement})(S)?(this.loadTileData(f,S),f.state="loaded",void n(null)):(f.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((S=>{S.name!=="AbortError"&&(f.state="errored",n(S))})),f.request.cancel=()=>x.abort()}loadTileData(f,n){f.setTexture(n,this.map.painter)}unloadTile(f,n){if(f.texture&&f.texture instanceof o.T?(f.destroy(!0),f.texture&&f.texture instanceof o.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:l,y:d,z:y}=f.tileID.canonical;this._implementation.unloadTile({x:l,y:d,z:y})}n&&n()}abortTile(f,n){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),n&&n()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z})))}_clearTiles(){const f=o.C(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}}},lc=function(f,n,l,d){const y=new gd[n.type](f,n,l,d);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return o.aV(["load","abort","unload","serialize","prepare"],y),y};function cc(f,n,l=""){return`${l}:${n.id||""}:${n.layer.id}:${(function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:y,importId:x}=d;return`featureset:${y}${x?`:import:${x}`:""}`}})(f.target)}`}function uc(f,n,l,d=""){if(f.uniqueFeatureID){const y=cc(f,n,d);if(l.has(y))return!0;l.add(y)}return!1}function ru(f,n,l,d,y=!1){const x=n.sourceCache.transform,S=n.sourceCache.tilesIn(f,n.has3DLayers,y);S.sort(Ju);const A=[];for(const C of S){const k=C.tile.queryRenderedFeatures(n,C,l,d,x,y);Object.keys(k).length&&A.push({wrappedTileID:C.tile.tileID.wrapped().key,queryResults:k})}return A.length===0?{}:(function(C){const k={},z={};for(const V of C){const j=V.queryResults,q=V.wrappedTileID,Q=z[q]=z[q]||{};for(const Y in j){const re=j[Y],te=Q[Y]=Q[Y]||{},ce=k[Y]=k[Y]||[];for(const me of re)te[me.featureIndex]||(te[me.featureIndex]=!0,ce.push(me))}}return k})(A)}function nu(f,n,l,d,y,x){const S={},A=d.queryRenderedSymbols(f),C=[];for(const k of Object.keys(A).map(Number))C.push(y[k]);C.sort(Ju);for(const k of C){const z=k.featureIndex.lookupSymbolFeatures(A[k.bucketInstanceId],k.bucketIndex,k.sourceLayerIndex,n,l,x);for(const V in z){const j=S[V]=S[V]||[],q=z[V];q.sort(((Q,Y)=>{const re=k.featureSortOrder;if(re){const te=re.indexOf(Q.featureIndex);return re.indexOf(Y.featureIndex)-te}return Y.featureIndex-Q.featureIndex}));for(const Q of q)j.push(Q)}}return S}function ef(f,n){const l=f.getRenderableIds().map((x=>f.getTileByID(x))),d=[],y={};for(let x=0;x<l.length;x++){const S=l[x],A=S.tileID.canonical.key;y[A]||(y[A]=!0,S.querySourceFeatures(d,n))}return d}function Ju(f,n){const l=f.tileID,d=n.tileID;return l.overscaledZ-d.overscaledZ||l.canonical.y-d.canonical.y||l.wrap-d.wrap||l.canonical.x-d.canonical.x}function ps(f,n){const l={};if(!n)return l;for(const d of f){const y=d.layerIds.map((x=>n.getLayer(x))).filter(Boolean);if(y.length!==0){d.layers=y,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map((x=>y.filter((S=>S.id===x))[0])));for(const x of y)l[x.fqid]=d}}return l}const Aa=32,ua=33,Pl=new Uint16Array(8184);for(let f=0;f<2046;f++){let n=f+2,l=0,d=0,y=0,x=0,S=0,A=0;for(1&n?y=x=S=Aa:l=d=A=Aa;(n>>=1)>1;){const k=l+y>>1,z=d+x>>1;1&n?(y=l,x=d,l=S,d=A):(l=y,d=x,y=S,x=A),S=k,A=z}const C=4*f;Pl[C+0]=l,Pl[C+1]=d,Pl[C+2]=y,Pl[C+3]=x}const ns=new Uint16Array(2178),oi=new Uint8Array(1089),Qu=new Uint16Array(1089);function Rs(f){return f===0?-.03125:f===32?.03125:0}const iu={type:2,extent:o.aj,loadGeometry:()=>[[new o.P(0,0),new o.P(o.aj+1,0),new o.P(o.aj+1,o.aj+1),new o.P(0,o.aj+1),new o.P(0,0)]]};class hc{constructor(n,l,d,y,x,S){this.tileID=n,this.uid=o.a$(),this.uses=0,this.tileSize=l,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=S}registerFadeDuration(n){const l=n+this.timeAdded;l<o.q.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,l,d){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=ps(n.buckets,l.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const x=this.buckets[y];if(x instanceof o.b1){if(this.hasSymbolBuckets=!0,!d)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const x=this.buckets[y];if(x instanceof o.b1&&x.hasRTLText){this.hasRTLText=!0,o.b2();break}}this.queryPadding=0;for(const y in this.buckets){const x=this.buckets[y],S=l.style.getOwnLayer(y);if(!S)continue;const A=S.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,A)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new o.b0}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(n,l,d){n&&(n.resourceTiming&&(this.resourceTiming=n.resourceTiming),this.buckets=Object.assign({},this.buckets,ps(n.buckets,l.style)),n.featureIndex&&(this.latestFeatureIndex=n.featureIndex))}getBucket(n){return this.buckets[n.fqid]}upload(n){for(const y in this.buckets){const x=this.buckets[y];x.uploadPending()&&x.upload(n)}const l=n.gl,d=this.imageAtlas;d&&!d.uploaded&&(this.imageAtlasTexture=new o.T(n,d.image,l.RGBA8,{useMipmap:!!d.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(n,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(n,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(n,l,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,d),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=l.style.getBrightness();(this._lastUpdatedBrightness||y)&&(this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(l,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}queryRenderedFeatures(n,l,d,y,x,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const A=(function(C,k){const z=o.bn([],[.5*C.width,.5*-C.height,1]);return o.bo(z,z,[1,-1,0]),o.az(z,z,C.calculateProjMatrix(k.toUnwrapped())),Float32Array.from(z)})(x,this.tileID);return this.latestFeatureIndex.query(n,{tilespaceGeometry:l,pixelPosMatrix:A,transform:y,availableImages:d,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(n,l){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const y=d.loadVTLayers(),x=l?l.sourceLayer:"",S=y._geojsonTileLayer||y[x];if(!S)return;const A=o.b3(l&&l.filter),{z:C,x:k,y:z}=this.tileID.canonical,V={z:C,x:k,y:z};for(let j=0;j<S.length;j++){const q=S.feature(j);if(A.needGeometry){const re=o.b4(q,!0);if(!A.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),re,this.tileID.canonical))continue}else if(!A.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),q))continue;const Q=d.getId(q,x),Y=new o.b5(q,C,k,z,Q);Y.tile=V,n.push(Y)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(n){const l=this.expirationTime;if(n.cacheControl){const d=o.b6(n.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const d=Date.now();let y=!1;if(this.expirationTime>d)y=!1;else if(l)if(this.expirationTime<l)y=!0;else{const x=this.expirationTime-l;x?this.expirationTime=d+Math.max(x,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(n){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&n&&this.updateBuckets(n)}updateBuckets(n,l){if(!this.latestFeatureIndex||!n.style)return;const d=this.latestFeatureIndex.loadVTLayers(),y=n.style.listImages(),x=n.style.getBrightness();for(const S in this.buckets){if(!n.style.hasLayer(S))continue;const A=this.buckets[S],C=A.layers[0],k=C.sourceLayer||"_geojsonTileLayer",z=d[k],V=n.style.getLayerSourceCache(C);let j={};V&&(j=V._state.getState(k,void 0));const q=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Q=Object.keys(j).length>0&&!l;Q&&!A.stateDependentLayers.length&&!l||A.update(j,z,y,q,Q?A.stateDependentLayers:A.layers,l,x),(A instanceof o.b7||A instanceof o.b8)&&n._terrain&&n._terrain.enabled&&V&&A.uploadPending()&&n._terrain._clearRenderCacheForTile(V.id,this.tileID);const Y=n&&n.style&&n.style.getOwnLayer(S);Y&&(this.queryPadding=Math.max(this.queryPadding,Y.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=o.q.now()+n}setTexture(n,l){const d=l.context,y=d.gl;this.texture=this.texture||l.getTileTexture(n.width),this.texture&&this.texture instanceof o.T?this.texture.update(n):(this.texture=new o.T(d,n,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(n,l){const d={};for(const y of l)d[y]=!0;this.dependencies[n]=d}hasDependency(n,l){for(const d of n){const y=this.dependencies[d];if(y){for(const x of l)if(y[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const d=o.b9(iu,this.tileID.canonical,this.tileTransform)[0],y=new o.ba,x=new o.bb;for(let S=0;S<d.length;S++){const{x:A,y:C}=d[S];y.emplaceBack(A,C),x.emplaceBack(S)}x.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(x),this._tileDebugBuffer=n.createVertexBuffer(y,o.bc.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,y.length,x.length)}_makeTileBoundsBuffers(n,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const d=o.b9(iu,this.tileID.canonical,this.tileTransform)[0];let y,x;if(this.isRaster){const S=(function(A,C){const k=o.aW(A,C),z=Math.pow(2,A.z);for(let re=0;re<ua;re++)for(let te=0;te<ua;te++){const ce=o.aX((A.x+(te+Rs(te))/Aa)/z),me=o.aY((A.y+(re+Rs(re))/Aa)/z),ye=C.project(ce,me),Ee=re*ua+te;ns[2*Ee+0]=Math.round((ye.x*k.scale-k.x)*o.aj),ns[2*Ee+1]=Math.round((ye.y*k.scale-k.y)*o.aj)}oi.fill(0),Qu.fill(0);for(let re=2045;re>=0;re--){const te=4*re,ce=Pl[te+0],me=Pl[te+1],ye=Pl[te+2],Ee=Pl[te+3],Ce=ce+ye>>1,Re=me+Ee>>1,Ae=Ce+Re-me,Pe=Re+ce-Ce,Ie=me*ua+ce,Ye=Ee*ua+ye,Be=Re*ua+Ce,dt=Math.hypot((ns[2*Ie+0]+ns[2*Ye+0])/2-ns[2*Be+0],(ns[2*Ie+1]+ns[2*Ye+1])/2-ns[2*Be+1])>=16;oi[Be]=oi[Be]||(dt?1:0),re<1022&&(oi[Be]=oi[Be]||oi[(me+Pe>>1)*ua+(ce+Ae>>1)]||oi[(Ee+Pe>>1)*ua+(ye+Ae>>1)])}const V=new o.aZ,j=new o.a_;let q=0;function Q(re,te){const ce=te*ua+re;return Qu[ce]===0&&(V.emplaceBack(ns[2*ce+0],ns[2*ce+1],re*o.aj/Aa,te*o.aj/Aa),Qu[ce]=++q),Qu[ce]-1}function Y(re,te,ce,me,ye,Ee){const Ce=re+ce>>1,Re=te+me>>1;if(Math.abs(re-ye)+Math.abs(te-Ee)>1&&oi[Re*ua+Ce])Y(ye,Ee,re,te,Ce,Re),Y(ce,me,ye,Ee,Ce,Re);else{const Ae=Q(re,te),Pe=Q(ce,me),Ie=Q(ye,Ee);j.emplaceBack(Ae,Pe,Ie)}}return Y(0,0,Aa,Aa,Aa,0),Y(Aa,Aa,0,0,0,Aa),{vertices:V,indices:j}})(this.tileID.canonical,l);y=S.vertices,x=S.indices}else{y=new o.aZ,x=new o.a_;for(const{x:A,y:C}of d)y.emplaceBack(A,C,0,0);const S=o.be(y.int16.subarray(0,4*y.length),void 0,4);for(let A=0;A<S.length;A+=3)x.emplaceBack(S[A],S[A+1],S[A+2])}this._tileBoundsBuffer=n.createVertexBuffer(y,o.bf.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(x),this._tileBoundsSegments=o.bd.simpleSegment(0,0,y.length,x.length)}_makeGlobeTileDebugBuffers(n,l){const d=l.projection;if(!d||d.name!=="globe"||l.freezeTileCoverage)return;const y=this.tileID.canonical,x=o.bg(y,l),S=o.bh(x),A=o.ah(l.zoom);let C;A>0&&(C=o.bi(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,y,l,S,C,A),this._makeGlobeTileDebugTextBuffer(n,y,l,S,C,A)}_globePoint(n,l,d,y,x,S,A){let C=o.bj(n,l,d);if(S){const k=1<<d.z,z=o.aD(y.center.lng),V=o.aH(y.center.lat),j=(d.x+.5)/k-z;let q=0;j>.5?q=-1:j<-.5&&(q=1);let Q=(n/o.aj+d.x)/k+q,Y=(l/o.aj+d.y)/k;Q=(Q-z)*y._pixelsPerMercatorPixel+z,Y=(Y-V)*y._pixelsPerMercatorPixel+V;const re=[Q*y.worldSize,Y*y.worldSize,0];o.ad(re,re,S),C=o.bk(C,re,A)}return o.ad(C,C,x)}_makeGlobeTileDebugBorderBuffer(n,l,d,y,x,S){const A=new o.ba,C=new o.bb,k=new o.bl,z=(j,q,Q,Y,re)=>{const te=(Q-j)/(re-1),ce=(Y-q)/(re-1),me=A.length;for(let ye=0;ye<re;ye++){const Ee=j+ye*te,Ce=q+ye*ce;A.emplaceBack(Ee,Ce);const Re=this._globePoint(Ee,Ce,l,d,y,x,S);k.emplaceBack(Re[0],Re[1],Re[2]),C.emplaceBack(me+ye)}},V=o.aj;z(0,0,V,0,16),z(V,0,V,V,16),z(V,V,0,V,16),z(0,V,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(C),this._tileDebugBuffer=n.createVertexBuffer(A,o.bc.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(k,o.bm.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,A.length,C.length)}_makeGlobeTileDebugTextBuffer(n,l,d,y,x,S){const A=o.aj/4,C=new o.ba,k=new o.a_,z=new o.bl,V=25;k.reserve(32),C.reserve(V),z.reserve(V);const j=(q,Q)=>V*q+Q;for(let q=0;q<V;q++){const Q=q*A;for(let Y=0;Y<V;Y++){const re=Y*A;C.emplaceBack(re,Q);const te=this._globePoint(re,Q,l,d,y,x,S);z.emplaceBack(te[0],te[1],te[2])}}for(let q=0;q<4;q++)for(let Q=0;Q<4;Q++){const Y=j(q,Q),re=j(q,Q+1),te=j(q+1,Q),ce=j(q+1,Q+1);k.emplaceBack(Y,re,te),k.emplaceBack(te,re,ce)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(k),this._tileDebugTextBuffer=n.createVertexBuffer(C,o.bc.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(z,o.bm.members),this._tileDebugTextSegments=o.bd.simpleSegment(0,0,V,32)}destroy(n=!1){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bp.setPbf(o.bq);class ou extends hc{constructor(n,l,d,y,x){super(n,l,d,y,x),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(n){return this._mrt&&this._mrt.getLayer(n)}setTexturePerLayer(n,l,d){const y=d.context,x=y.gl;let S=this.texturePerLayer.get(n)||d.getTileTexture(l.width);S&&S instanceof o.T?S.update(l,{premultiply:!1}):S=new o.T(y,l,x.RGBA8,{premultiply:!1}),this.texturePerLayer.has(n)||this.texturePerLayer.set(n,S)}flushQueues(n){const l=this._workQueuePerLayer.get(n)||[],d=this._fetchQueuePerLayer.get(n)||[];for(;l.length;)l.pop()();for(;d.length;)d.pop()()}flushAllQueues(){for(const n of this._workQueuePerLayer.keys()){const l=this._workQueuePerLayer.get(n)||[];for(;l.length;)l.pop()()}for(const n of this._fetchQueuePerLayer.keys()){const l=this._fetchQueuePerLayer.get(n)||[];for(;l.length;)l.pop()()}}fetchHeader(n=16384,l){const d=this._mrt=new o.bp(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=o.br(y,((x,S,A,C)=>{if(x)l(x);else try{const k=d.getHeaderLength(S);if(k>n)return void(this.request=this.fetchHeader(k,l));d.parseHeader(S),this._isHeaderLoaded=!0;let z=0;for(const V of Object.values(d.layers))z=Math.max(z,V.dataIndex[V.dataIndex.length-1].lastByte);S.byteLength>=z&&(this.entireBuffer=S),l(null,this.entireBuffer||S,A,C)}catch(k){l(k)}})),this.request}fetchBand(n,l,d,y){const x=this._mrt;if(!this._isHeaderLoaded||!x)return void y(new Error("Tile header is not ready"));const S=this.actor;if(!S)return void y(new Error("Can't fetch tile band without an actor"));let A;const C=(j,q)=>{if(A.complete(j,q),j)return void y(j);this.updateTextureDescriptor(n,l,d);const Q=this.textureDescriptorPerLayer.get(l);y(null,Q&&Q.img)},k=(j,q)=>{if(j)return y(j);const Q=S.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:q,task:A},C,void 0,!0),Y=this._workQueuePerLayer.get(l)||[];Y.push((()=>{Q&&Q.cancel(),A.cancel()})),this._workQueuePerLayer.has(l)||this._workQueuePerLayer.set(l,Y)},z=x.getLayer(n);if(!z)return void y(new Error(`Unknown sourceLayer "${n}"`));if(z.hasDataForBand(d)){this.updateTextureDescriptor(n,l,d);const j=this.textureDescriptorPerLayer.get(l);return void y(null,j?j.img:null)}const V=z.getDataRange([d]);if(A=x.createDecodingTask(V),!A||A.tasks.length)if(this.flushQueues(l),this.entireBuffer)k(null,this.entireBuffer.slice(V.firstByte,V.lastByte+1));else{const j=Object.assign({},this.requestParams,{headers:{Range:`bytes=${V.firstByte}-${V.lastByte}`}}),q=o.br(j,k),Q=this._fetchQueuePerLayer.get(l)||[];Q.push((()=>{q.cancel(),A.cancel()})),this._fetchQueuePerLayer.has(l)||this._fetchQueuePerLayer.set(l,Q)}else y(null)}updateNeeded(n,l){return(!this.textureDescriptorPerLayer.get(n)||this.textureDescriptorPerLayer.get(n).band!==l)&&this.state!=="errored"}updateTextureDescriptor(n,l,d){if(!this._mrt)return;const y=this._mrt.getLayer(n);if(!y||!y.hasBand(d)||!y.hasDataForBand(d))return;const{bytes:x,tileSize:S,buffer:A,offset:C,scale:k}=y.getBandView(d),z=S+2*A,V=new o.r({width:z,height:z},x),j=this.texturePerLayer.get(l);j&&j instanceof o.T&&j.update(V,{premultiply:!1}),this.textureDescriptorPerLayer.set(l,{layer:n,band:d,img:V,buffer:A,offset:C,tileSize:S,format:y.pixelFormat,mix:[k,256*k,65536*k,16777216*k]})}destroy(n=!1){if(super.destroy(n),delete this._mrt,!n)for(const l of this.texturePerLayer.values())l&&l instanceof o.T&&l.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class _d{constructor(n,l){this.max=n,this.onRemove=l,this.reset()}reset(){for(const n in this.data)for(const l of this.data[n])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(n,l,d){const y=n.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const x={value:l,timeout:void 0};if(d!==void 0&&(x.timeout=setTimeout((()=>{this.remove(n,x)}),d)),this.data[y].push(x),this.order.push(y),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const l=this.data[n].shift();return l.timeout&&clearTimeout(l.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),l.value}getByKey(n){const l=this.data[n];return l?l[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,l){if(!this.has(n))return this;const d=n.wrapped().key,y=l===void 0?0:this.data[d].indexOf(l),x=this.data[d][y];return this.data[d].splice(y,1),x.timeout&&clearTimeout(x.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(x.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(n){const l=[];for(const d in this.data)for(const y of this.data[d])n(y.value)||l.push(y);for(const d of l)this.remove(d.value.tileID,d)}}class tf{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,l,d){const y=String(l);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][y]=this.stateChanges[n][y]||{},o.h(this.stateChanges[n][y],d),this.deletedStates[n]===null){this.deletedStates[n]={};for(const x in this.state[n])x!==y&&(this.deletedStates[n][x]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][y]===null){this.deletedStates[n][y]={};for(const x in this.state[n][y])d[x]||(this.deletedStates[n][y][x]=null)}else for(const x in d)this.deletedStates[n]&&this.deletedStates[n][y]&&this.deletedStates[n][y][x]===null&&delete this.deletedStates[n][y][x]}removeFeatureState(n,l,d){if(this.deletedStates[n]===null)return;const y=String(l);if(this.deletedStates[n]=this.deletedStates[n]||{},d&&l!==void 0)this.deletedStates[n][y]!==null&&(this.deletedStates[n][y]=this.deletedStates[n][y]||{},this.deletedStates[n][y][d]=null);else if(l!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][y])for(d in this.deletedStates[n][y]={},this.stateChanges[n][y])this.deletedStates[n][y][d]=null;else this.deletedStates[n][y]=null;else this.deletedStates[n]=null}getState(n,l){const d=this.state[n]||{},y=this.stateChanges[n]||{},x=this.deletedStates[n];if(x===null)return{};if(l!==void 0){const A=String(l),C=o.h({},d[A],y[A]);if(x){const k=x[l];if(k===null)return{};for(const z in k)delete C[z]}return C}const S=o.h({},d,y);if(x)for(const A in x)delete S[A];return S}initializeTileState(n,l){n.refreshFeatureState(l)}coalesceChanges(n,l){const d={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const x={};for(const S in this.stateChanges[y])this.state[y][S]||(this.state[y][S]={}),o.h(this.state[y][S],this.stateChanges[y][S]),x[S]=this.state[y][S];d[y]=x}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const x={};if(this.deletedStates[y]===null)for(const S in this.state[y])x[S]={},this.state[y][S]={};else for(const S in this.deletedStates[y]){if(this.deletedStates[y][S]===null)this.state[y][S]={};else if(this.state[y][S])for(const A of Object.keys(this.deletedStates[y][S]))delete this.state[y][S][A];x[S]=this.state[y][S]}d[y]=d[y]||{},o.h(d[y],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const y in n)n[y].refreshFeatureState(l)}}class Ho extends o.E{constructor(n,l,d){super(),this.id=n,this._onlySymbols=d,l.on("data",(y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),l.on("error",(()=>{this._sourceErrored=!0})),this._source=l,this._tiles={},this._cache=new _d(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new tf,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles)if(!this._tiles[n].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,l){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,l)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n)}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n)}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const d=this._tiles[l];d.upload(n),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((n=>n.tileID)).sort(Na).map((n=>n.key))}getRenderableIds(n,l){const d=[];for(const y in this._tiles)this._isIdRenderable(+y,n,l)&&d.push(this._tiles[y]);return n?d.sort(((y,x)=>{const S=y.tileID,A=x.tileID,C=new o.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),k=new o.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-A.overscaledZ||k.y-C.y||k.x-C.x})).map((y=>y.tileID.key)):d.map((y=>y.tileID)).sort(Na).map((y=>y.key))}hasRenderableParent(n){const l=this.findLoadedParent(n,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(n,l,d){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(l||!this._tiles[n].holdingForFade())&&(d||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,l){const d=this._tiles[n];d&&(d.state!=="loading"&&(d.state=l),this._loadTile(d,this._tileLoaded.bind(this,d,n,l)))}_tileLoaded(n,l,d,y){if(y)if(n.state="errored",y.status!==404)this._source.fire(new o.z(y,{tile:n}));else{if(this._source.fire(new o.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:n})),!(n.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=o.q.now(),d==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(l,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new o.A("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const l=this.getRenderableIds();for(let y=0;y<l.length;y++){const x=l[y];if(n.neighboringTiles&&n.neighboringTiles[x]){const S=this.getTileByID(x);d(n,S),d(S,n)}}function d(y,x){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let S=x.tileID.canonical.x-y.tileID.canonical.x;const A=x.tileID.canonical.y-y.tileID.canonical.y,C=Math.pow(2,y.tileID.canonical.z),k=x.tileID.key;S===0&&A===0||Math.abs(A)>1||(Math.abs(S)>1&&(Math.abs(S+C)===1?S+=C:Math.abs(S-C)===1&&(S-=C)),x.dem&&y.dem&&(y.dem.backfillBorder(x.dem,S,A),y.neighboringTiles&&y.neighboringTiles[k]&&(y.neighboringTiles[k].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,l,d,y){for(const x in this._tiles){let S=this._tiles[x];if(y[x]||!S.hasData()||S.tileID.overscaledZ<=l||S.tileID.overscaledZ>d)continue;let A=S.tileID;for(;S&&S.tileID.overscaledZ>l+1;){const k=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[k.key],S&&S.hasData()&&(A=k)}let C=A;for(;C.overscaledZ>l;)if(C=C.scaledTo(C.overscaledZ-1),n[C.key]){y[A.key]=A;break}}}findLoadedParent(n,l){if(n.key in this._loadedParentTiles){const d=this._loadedParentTiles[n.key];return d&&d.tileID.overscaledZ>=l?d:null}for(let d=n.overscaledZ-1;d>=l;d--){const y=n.scaledTo(d),x=this._getLoadedTile(y);if(x)return x}}_getLoadedTile(n){const l=this._tiles[n.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,l){l=l||this._source.tileSize;const d=Math.ceil(n.width/l)+1,y=Math.ceil(n.height/l)+1,x=Math.floor(d*y*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(A)}handleWrapJump(n){const l=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,l){const d={};for(const y in this._tiles){const x=this._tiles[y];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+l),d[x.tileID.key]=x}this._tiles=d;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(n,l,d,y,x){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(n,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const S=this._source.type==="batched-model";let A,C=this._source.maxzoom;const k=this.map&&this.map.painter?this.map.painter._terrain:null;if(k&&k.sourceCache===this&&k.attenuationRange()){const j=k.attenuationRange()[0],q=Math.floor(j)-Math.log2(k.getDemUpscale());C>q&&(C=q)}if(this.used||this.usedForTerrain){if(this._source.tileID)A=n.getVisibleUnwrappedCoordinates(this._source.tileID).map((j=>new o.aM(j.canonical.z,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y)));else if(this.tileCoverLift!==0){const j=n.clone();j.tileCoverLift=this.tileCoverLift,A=j.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.minzoom<=1&&n.projection.name==="globe"&&(A.push(new o.aM(1,0,1,0,0)),A.push(new o.aM(1,0,1,1,0)),A.push(new o.aM(1,0,1,0,1)),A.push(new o.aM(1,0,1,1,1)))}else if(A=n.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.hasTile){const j=this._source.hasTile.bind(this._source);A=A.filter((q=>j(q)))}}else A=[];if(A.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ms(this._source.type)){const j=n.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),q=Math.min(j,this._source.maxzoom);if(S){const Q=n.extendTileCover(A,q);for(const Y of Q)A.push(Y)}else if(x){const Q=n.extendTileCoverToNearPlane(A,this.transform.getFrustum(q),q);for(const Y of Q)A.push(Y)}else if(this.castsShadows&&y){const Q=n.extendTileCover(A,q,y);for(const Y of Q)this._shadowCasterTiles[Y.key]=!0,A.push(Y)}}const z=this._updateRetainedTiles(A);if(ms(this._source.type)&&A.length!==0){const j={},q={},Q=Object.keys(z);for(const re of Q){const te=z[re],ce=this._tiles[re];if(!ce||ce.fadeEndTime&&ce.fadeEndTime<=o.q.now())continue;const me=this.findLoadedParent(te,Math.max(te.overscaledZ-Ho.maxOverzooming,this._source.minzoom));me&&(this._addTile(me.tileID),j[me.tileID.key]=me.tileID),q[re]=te}const Y=A[A.length-1].overscaledZ;for(const re in this._tiles){const te=this._tiles[re];if(z[re]||!te.hasData())continue;let ce=te.tileID;for(;ce.overscaledZ>Y;){ce=ce.scaledTo(ce.overscaledZ-1);const me=this._tiles[ce.key];if(me&&me.hasData()&&q[ce.key]){z[re]=te.tileID;break}}}for(const re in j)z[re]||(this._coveredTiles[re]=!0,z[re]=j[re])}for(const j in z)this._tiles[j].clearFadeHold();const V=o.bs(this._tiles,z);for(const j of V){const q=this._tiles[j];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(+j)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const l={};if(n.length===0)return l;const d={},y=n.reduce(((k,z)=>Math.min(k,z.overscaledZ)),1/0),x=n[0].overscaledZ,S=Math.max(x-Ho.maxOverzooming,this._source.minzoom),A=Math.max(x+Ho.maxUnderzooming,this._source.minzoom),C={};for(const k of n){const z=this._addTile(k);l[k.key]=k,z.hasData()||y<this._source.maxzoom&&(C[k.key]=k)}this._retainLoadedChildren(C,y,A,l);for(const k of n){let z=this._tiles[k.key];if(z.hasData())continue;if(k.canonical.z>=this._source.maxzoom){const j=k.children(this._source.maxzoom)[0],q=this.getTile(j);if(q&&q.hasData()){l[j.key]=j;continue}}else{const j=k.children(this._source.maxzoom);if(l[j[0].key]&&l[j[1].key]&&l[j[2].key]&&l[j[3].key])continue}let V=z.wasRequested();for(let j=k.overscaledZ-1;j>=S;--j){const q=k.scaledTo(j);if(d[q.key]||(d[q.key]=!0,z=this.getTile(q),!z&&V&&(z=this._addTile(q)),z&&(l[q.key]=q,V=z.wasRequested(),z.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const l=[];let d,y=this._tiles[n].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){d=this._loadedParentTiles[y.key];break}l.push(y.key);const x=y.scaledTo(y.overscaledZ-1);if(d=this._getLoadedTile(x),d)break;y=x}for(const x of l)this._loadedParentTiles[x]=d}}_addTile(n){let l=this._tiles[n.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),l;l=this._cache.getAndRemove(n),l&&(this._setTileReloadTimer(n.key,l),l.tileID=n,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,l)));const d=!!l;if(!d){const y=this.map?this.map.painter:null,x=this._source.tileSize*n.overscaleFactor();l=this._source.type==="raster-array"?new ou(n,x,this.transform.tileZoom,y,this._isRaster):new hc(n,x,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(l,this._tileLoaded.bind(this,l,n.key,l.state))}return l.uses++,this._tiles[n.key]=l,d||this._source.fire(new o.A("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(n,l){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const d=l.getExpiryTimeout();d&&(this._timers[n]=setTimeout((()=>{this._reloadTile(n,"expired"),delete this._timers[n]}),d))}_removeTile(n){const l=this._tiles[n];l&&(l.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,l,d){const y=[],x=this.transform;if(!x)return y;const S=x.projection.name==="globe",A=o.aD(x.center.lng);for(const C in this._tiles){const k=this._tiles[C];if(d&&k.clearQueryDebugViz(),k.holdingForFade())continue;let z;if(S){const V=k.tileID.canonical;if(V.z===0){const j=[Math.abs(o.ay(A,...is(V,-1))-A),Math.abs(o.ay(A,...is(V,1))-A)];z=[0,2*j.indexOf(Math.min(...j))-1]}else{const j=[Math.abs(o.ay(A,...is(V,-1))-A),Math.abs(o.ay(A,...is(V,0))-A),Math.abs(o.ay(A,...is(V,1))-A)];z=[j.indexOf(Math.min(...j))-1]}}else z=[0];for(const V of z){const j=n.containsTile(k,x,l,V);j&&y.push(j)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,l){const d=this.getRenderableIds(n,l).map((x=>this._tiles[x].tileID)),y=this.transform.projection.name==="globe";for(const x of d)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=y?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return d}sortCoordinatesByDistance(n){const l=n.slice(),d=this.transform._camera.position,y=this.transform._camera.forward(),x={};for(const S of l){const A=1/(1<<S.canonical.z);x[S.key]=((S.canonical.x+.5)*A+S.wrap-d[0])*y[0]+((S.canonical.y+.5)*A-d[1])*y[1]-d[2]*y[2]}return l.sort(((S,A)=>x[S.key]-x[A.key])),l}hasTransition(){if(this._source.hasTransition())return!0;if(ms(this._source.type))for(const n in this._tiles){const l=this._tiles[n];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(n,l,d){this._state.updateState(n=n||"_geojsonTileLayer",l,d)}removeFeatureState(n,l,d){this._state.removeFeatureState(n=n||"_geojsonTileLayer",l,d)}getFeatureState(n,l){return this._state.getState(n=n||"_geojsonTileLayer",l)}setDependencies(n,l,d){const y=this._tiles[n];y&&y.setDependencies(l,d)}reloadTilesForDependencies(n,l){for(const d in this._tiles)this._tiles[d].hasDependency(n,l)&&this._reloadTile(+d,"reloading");this._cache.filter((d=>!d.hasDependency(n,l)))}_preloadTiles(n,l){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(n,l))};return void this._source.on("data",C)}const d=new Map,y=Array.isArray(n)?n:[n],x=this.map.painter.terrain,S=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const C of y){const k=C.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const z of k)d.set(z.key,z);this.usedForTerrain&&C.updateElevation(!1)}const A=Array.from(d.values());o.bt(A,((C,k)=>{const z=new hc(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(z,(V=>{this._source.type==="raster-dem"&&z.dem&&this._backfillDEM(z),k(V,z)}))}),l)}}function Na(f,n){const l=Math.abs(2*f.wrap)-+(f.wrap<0),d=Math.abs(2*n.wrap)-+(n.wrap<0);return f.overscaledZ-n.overscaledZ||d-l||n.canonical.y-f.canonical.y||n.canonical.x-f.canonical.x}function ms(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function is(f,n){const l=1<<f.z;return[f.x/l+n,(f.x+1)/l+n]}Ho.maxOverzooming=10,Ho.maxUnderzooming=3;class eh{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const n=!1,l=!1;for(const d in this.style._mergedLayers){const y=this.style._mergedLayers[d];if(y.type==="fill-extrusion"||y.type==="building")this.layers.push({layer:y,visible:n,visibilityChanged:l});else if(y.type==="model"){const x=this.style.getLayerSource(y);x&&x.type==="batched-model"&&this.layers.push({layer:y,visible:n,visibilityChanged:l})}}}onNewFrame(n){this.layersGotHidden=!1;for(const l of this.layers){const d=l.layer;let y=!1;d.type==="fill-extrusion"?y=!d.isHidden(n)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="building"?y=!d.isHidden(n)&&d.paint.get("building-opacity")>0:d.type==="model"&&(y=!d.isHidden(n)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&l.visible,l.visible=y}}updateZOffset(n,l){this.currentBuildingBuckets=[];for(const y of this.layers){const x=y.layer,S=this.style.getLayerSourceCache(x);let A=1;x.type==="fill-extrusion"?A=y.visible?x.paint.get("fill-extrusion-vertical-scale"):0:x.type==="building"&&(A=y.visible?x.paint.get("building-vertical-scale"):0);let C=S?S.getTile(l):null;if(!C&&S)for(const k in S._tiles){const z=S._tiles[k];if(l.canonical.isChildOf(z.tileID.canonical)){C=z;break}}this.currentBuildingBuckets.push({bucket:C?C.getBucket(x):null,tileID:C?C.tileID:l,verticalScale:A})}n.hasAnyZOffset=!1;let d=!1;for(let y=0;y<n.symbolInstances.length;y++){const x=n.symbolInstances.get(y),S=x.zOffset,A=this._getHeightAtTileOffset(l,x.tileAnchorX,x.tileAnchorY);x.zOffset=A!==Number.NEGATIVE_INFINITY?A:S,d||S===x.zOffset||(d=!0),n.hasAnyZOffset||x.zOffset===0||(n.hasAnyZOffset=!0)}d&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,l,d,y){let x=l,S=d;if(n.canonical.z!==y.canonical.z){const A=y.canonical,C=1/(1<<n.canonical.z-A.z);x=(l+n.canonical.x*o.aj)*C-A.x*o.aj|0,S=(d+n.canonical.y*o.aj)*C-A.y*o.aj|0}return{tileX:x,tileY:S}}_getHeightAtTileOffset(n,l,d){let y,x;for(let S=0;S<this.layers.length;++S){const A=this.layers[S].layer;if(A.type!=="fill-extrusion"&&A.type!=="building")continue;const{bucket:C,tileID:k,verticalScale:z}=this.currentBuildingBuckets[S];if(!C)continue;const{tileX:V,tileY:j}=this._mapCoordToOverlappingTile(n,l,d,k),q=C.getHeightAtTileCoord(V,j);q&&q.height!==void 0&&(q.hidden?y=q.height:x=Math.max(q.height*z,x||0))}if(x!==void 0)return x;for(let S=0;S<this.layers.length;++S){const A=this.layers[S];if(A.layer.type!=="model"||!A.visible)continue;const{bucket:C,tileID:k}=this.currentBuildingBuckets[S];if(!C)continue;const{tileX:z,tileY:V}=this._mapCoordToOverlappingTile(n,l,d,k),j=C.getHeightAtTileCoord(z,V);if(j&&!j.hidden)return j.height===void 0&&y!==void 0?Math.min(j.maxHeight,y)*j.verticalScale:j.height?j.height*j.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function th(f,n){const l={};for(const d in f)d!=="ref"&&(l[d]=f[d]);return o.bu.forEach((d=>{d in n&&(l[d]=n[d])})),l}function gs(f){f=f.slice();const n=Object.create(null);for(let l=0;l<f.length;l++)n[f[l].id]=f[l];for(let l=0;l<f.length;l++)"ref"in f[l]&&(f[l]=th(f[l],n[f[l].ref]));return f}const bn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function rf(f,n,l){l.push({command:bn.addSource,args:[f,n[f]]})}function ll(f,n,l){n.push({command:bn.removeSource,args:[f]}),l[f]=!0}function nf(f,n,l,d){ll(f,l,d),rf(f,n,l)}function Hm(f,n,l){let d;for(d in f[l])if(f[l].hasOwnProperty(d)&&d!=="data"&&!o.bv(f[l][d],n[l][d]))return!1;for(d in n[l])if(n[l].hasOwnProperty(d)&&d!=="data"&&!o.bv(f[l][d],n[l][d]))return!1;return!0}function fc(f,n,l,d,y,x){let S;for(S in n=n||{},f=f||{})f.hasOwnProperty(S)&&(o.bv(f[S],n[S])||l.push({command:x,args:[d,S,n[S],y]}));for(S in n)n.hasOwnProperty(S)&&!f.hasOwnProperty(S)&&(o.bv(f[S],n[S])||l.push({command:x,args:[d,S,n[S],y]}))}function dc(f){return f.id}function pc(f,n){return f[n.id]=n,f}function Il(f,n,l){const d=n.createTileMatrix(f,f.worldSize,l.toUnwrapped());return o.az(new Float32Array(16),f.projMatrix,d)}function rh(f,n,l){if(n.projection.name===l.projection.name)return f.projMatrix;const d=l.clone();return d.setProjection(n.projection),Il(d,n.getProjection(),f)}function Cl(f,n,l){return n.name===l.projection.name?f.projMatrix:Il(l,n,f)}class of{constructor(n,l){this.reset(n,l)}reset(n,l){this.points=n||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=o.ay(n,0,1);let l=1,d=this._distances[l];const y=n*this.paddedLength+this.padding;for(;d<y&&l<this._distances.length;)d=this._distances[++l];const x=l-1,S=this._distances[x],A=d-S,C=A>0?(y-S)/A:0;return this.points[x].mult(1-C).add(this.points[l].mult(C))}}class nh{constructor(n,l,d){const y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(n/d),this.yCellCount=Math.ceil(l/d);for(let S=0;S<this.xCellCount*this.yCellCount;S++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=l,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,l,d,y,x){this._forEachCell(l,d,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(n,l,d,y){this._forEachCell(l-y,d-y,l+y,d+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(l),this.circles.push(d),this.circles.push(y)}_insertBoxCell(n,l,d,y,x,S){this.boxCells[x].push(S)}_insertCircleCell(n,l,d,y,x,S){this.circleCells[x].push(S)}_query(n,l,d,y,x,S){if(d<0||n>this.width||y<0||l>this.height)return!x&&[];const A=[];if(n<=0&&l<=0&&this.width<=d&&this.height<=y){if(x)return!0;for(let C=0;C<this.boxKeys.length;C++)A.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const k=this.circles[3*C],z=this.circles[3*C+1],V=this.circles[3*C+2];A.push({key:this.circleKeys[C],x1:k-V,y1:z-V,x2:k+V,y2:z+V})}return S?A.filter(S):A}return this._forEachCell(n,l,d,y,this._queryCell,A,{hitTest:x,seenUids:{box:{},circle:{}}},S),x?A.length>0:A}_queryCircle(n,l,d,y,x){const S=n-d,A=n+d,C=l-d,k=l+d;if(A<0||S>this.width||k<0||C>this.height)return!y&&[];const z=[];return this._forEachCell(S,C,A,k,this._queryCellCircle,z,{hitTest:y,circle:{x:n,y:l,radius:d},seenUids:{box:{},circle:{}}},x),y?z.length>0:z}query(n,l,d,y,x){return this._query(n,l,d,y,!1,x)}hitTest(n,l,d,y,x){return this._query(n,l,d,y,!0,x)}hitTestCircle(n,l,d,y){return this._queryCircle(n,l,d,!0,y)}_queryCell(n,l,d,y,x,S,A,C){const k=A.seenUids,z=this.boxCells[x];if(z!==null){const j=this.bboxes;for(const q of z)if(!k.box[q]){k.box[q]=!0;const Q=4*q;if(n<=j[Q+2]&&l<=j[Q+3]&&d>=j[Q+0]&&y>=j[Q+1]&&(!C||C(this.boxKeys[q]))){if(A.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[q],x1:j[Q],y1:j[Q+1],x2:j[Q+2],y2:j[Q+3]})}}}const V=this.circleCells[x];if(V!==null){const j=this.circles;for(const q of V)if(!k.circle[q]){k.circle[q]=!0;const Q=3*q;if(this._circleAndRectCollide(j[Q],j[Q+1],j[Q+2],n,l,d,y)&&(!C||C(this.circleKeys[q]))){if(A.hitTest)return S.push(!0),!0;{const Y=j[Q],re=j[Q+1],te=j[Q+2];S.push({key:this.circleKeys[q],x1:Y-te,y1:re-te,x2:Y+te,y2:re+te})}}}}}_queryCellCircle(n,l,d,y,x,S,A,C){const k=A.circle,z=A.seenUids,V=this.boxCells[x];if(V!==null){const q=this.bboxes;for(const Q of V)if(!z.box[Q]){z.box[Q]=!0;const Y=4*Q;if(this._circleAndRectCollide(k.x,k.y,k.radius,q[Y+0],q[Y+1],q[Y+2],q[Y+3])&&(!C||C(this.boxKeys[Q])))return S.push(!0),!0}}const j=this.circleCells[x];if(j!==null){const q=this.circles;for(const Q of j)if(!z.circle[Q]){z.circle[Q]=!0;const Y=3*Q;if(this._circlesCollide(q[Y],q[Y+1],q[Y+2],k.x,k.y,k.radius)&&(!C||C(this.circleKeys[Q])))return S.push(!0),!0}}}_forEachCell(n,l,d,y,x,S,A,C){const k=this._convertToXCellCoord(n),z=this._convertToYCellCoord(l),V=this._convertToXCellCoord(d),j=this._convertToYCellCoord(y);for(let q=k;q<=V;q++)for(let Q=z;Q<=j;Q++)if(x.call(this,n,l,d,y,this.xCellCount*Q+q,S,A,C))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,l,d,y,x,S){const A=y-n,C=x-l,k=d+S;return k*k>A*A+C*C}_circleAndRectCollide(n,l,d,y,x,S,A){const C=(S-y)/2,k=Math.abs(n-(y+C));if(k>C+d)return!1;const z=(A-x)/2,V=Math.abs(l-(x+z));if(V>z+d)return!1;if(k<=C||V<=z)return!0;const j=k-C,q=V-z;return j*j+q*q<=d*d}}const au={unknown:0,flipRequired:1,flipNotRequired:2},yd=Math.tan(85*Math.PI/180);function mc(f,n,l,d,y,x,S){const A=o.bz();if(l)if(x.name==="globe"){const C=o.bA(y,n);o.az(A,A,C)}else{const C=o.bB([],S);A[0]=C[0],A[1]=C[1],A[4]=C[2],A[5]=C[3],d||o.by(A,A,y.angle)}else o.az(A,y.labelPlaneMatrix,f);return A}function gc(f,n,l,d,y,x,S){const A=mc(f,n,l,d,y,x,S);return x.name==="globe"&&l||(A[2]=A[6]=A[10]=A[14]=0),A}function cl(f,n,l,d,y,x,S){if(l){if(x.name==="globe"){const A=mc(f,n,l,d,y,x,S);return o.bi(A,A),o.az(A,f,A),A}{const A=o.bw(f),C=o.bx([]);return C[0]=S[0],C[1]=S[1],C[4]=S[2],C[5]=S[3],o.az(A,A,C),d||o.by(A,A,-y.angle),A}}return y.glCoordMatrix}function Co(f,n,l,d){const y=[f,n,l,1];l?o.aA(y,y,d):Wm(y,y,d);const x=y[3];return y[0]/=x,y[1]/=x,y[2]/=x,y}function af(f,n){return Math.min(.5+f/n*.5,1.5)}function ih(f,n){const l=f[0]/f[3],d=f[1]/f[3];return l>=-n[0]&&l<=n[0]&&d>=-n[1]&&d<=n[1]}function _c(f,n,l,d,y,x,S,A,C,k){const z=l.transform,V=d?f.textSizeData:f.iconSizeData,j=o.bH(V,l.transform.zoom),q=z.projection.name==="globe",Q=[256/l.width*2+1,256/l.height*2+1],Y=d?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Y.clear();let re=null;q&&(re=d?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const te=f.lineVertexArray,ce=d?f.text.placedSymbolArray:f.icon.placedSymbolArray,me=l.transform.width/l.transform.height;let ye,Ee=!1;for(let Ce=0;Ce<ce.length;Ce++){const Re=ce.get(Ce),{numGlyphs:Ae,writingMode:Pe}=Re;if(Pe!==o.bI.vertical||Ee||ye===o.bI.horizontal||(Ee=!0),ye=Pe,(Re.hidden||Pe===o.bI.vertical)&&!Ee){ul(Ae,Y);continue}Ee=!1;const Ie=new o.P(Re.tileAnchorX,Re.tileAnchorY);let{x:Ye,y:Be,z:dt}=z.projection.projectTilePoint(Ie.x,Ie.y,k.canonical);if(C){const[cr,pr,Jt]=C(Ie);Ye+=cr,Be+=pr,dt+=Jt}const rt=[Ye,Be,dt,1];if(o.aA(rt,rt,n),!ih(rt,Q)){ul(Ae,Y);continue}const xt=rt[3],It=af(l.transform.getCameraToCenterDistance(z.projection),xt),We=o.bJ(V,j,Re),ze=S?We/It:We*It,ot=Co(Ye,Be,dt,y);if(ot[3]<=0){ul(Ae,Y);continue}let tt={};const At=o.al(f.layers[0].layout.get("text-max-angle")),Pt=Math.cos(At),Dt=S?null:C,Bt=sf(Re,ze,!1,A,n,y,x,f.glyphOffsetArray,te,Y,re,ot,Ie,tt,me,Dt,z.projection,k,S,Pt);Ee=Bt.useVertical,Dt&&Bt.needsFlipping&&(tt={}),(Bt.notEnoughRoom||Ee||Bt.needsFlipping&&sf(Re,ze,!0,A,n,y,x,f.glyphOffsetArray,te,Y,re,ot,Ie,tt,me,Dt,z.projection,k,S,Pt).notEnoughRoom)&&ul(Ae,Y)}d?(f.text.dynamicLayoutVertexBuffer.updateData(Y),re&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(re)):(f.icon.dynamicLayoutVertexBuffer.updateData(Y),re&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(re))}function ta(f,n,l,d,y,x,S,A,C,k,z,V,j,q,Q,Y,re){const{lineStartIndex:te,glyphStartIndex:ce,segment:me}=A,ye=ce+A.numGlyphs,Ee=te+A.lineLength,Ce=n.getoffsetX(ce),Re=n.getoffsetX(ye-1),Ae=su(f*Ce,l,d,y,x,S,me,te,Ee,C,k,z,V,j,!0,q,Q,Y,re);if(!Ae)return null;const Pe=su(f*Re,l,d,y,x,S,me,te,Ee,C,k,z,V,j,!0,q,Q,Y,re);return Pe?{first:Ae,last:Pe}:null}function oh(f,n,l,d){return f===o.bI.horizontal&&Math.abs(d)>Math.abs(l)?{useVertical:!0}:f===o.bI.vertical?d>0?{needsFlipping:!0}:null:n!==au.unknown&&(function(y,x){return y===0||Math.abs(x/y)>yd})(l,d)?n===au.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function sf(f,n,l,d,y,x,S,A,C,k,z,V,j,q,Q,Y,re,te,ce,me){const ye=n/24,Ee=f.lineOffsetX*ye,Ce=f.lineOffsetY*ye,{lineStartIndex:Re,glyphStartIndex:Ae,numGlyphs:Pe,segment:Ie,writingMode:Ye,flipState:Be}=f,dt=Re+f.lineLength,rt=xt=>{if(z){const[ot,tt,At]=xt.up,Pt=k.length;o.bK(z,Pt+0,ot,tt,At),o.bK(z,Pt+1,ot,tt,At),o.bK(z,Pt+2,ot,tt,At),o.bK(z,Pt+3,ot,tt,At)}const[It,We,ze]=xt.point;o.bL(k,It,We,ze,xt.angle)};if(Pe>1){const xt=ta(ye,A,Ee,Ce,l,V,j,f,C,x,q,Y,!1,re,te,ce,me);if(!xt)return{notEnoughRoom:!0};if(d&&!l){let[It,We,ze]=xt.first.point,[ot,tt,At]=xt.last.point;[It,We]=Co(It,We,ze,S),[ot,tt]=Co(ot,tt,At,S);const Pt=oh(Ye,Be,(ot-It)*Q,tt-We);if(f.flipState=Pt&&Pt.needsFlipping?au.flipRequired:au.flipNotRequired,Pt)return Pt}rt(xt.first);for(let It=Ae+1;It<Ae+Pe-1;It++){const We=su(ye*A.getoffsetX(It),Ee,Ce,l,V,j,Ie,Re,dt,C,x,q,Y,!1,!1,re,te,ce,me);if(!We)return k.length-=4*(It-Ae),{notEnoughRoom:!0};rt(We)}rt(xt.last)}else{if(d&&!l){const It=Co(j.x,j.y,0,y),We=Re+Ie+1,ze=new o.P(C.getx(We),C.gety(We)),ot=Co(ze.x,ze.y,0,y),tt=ot[3]>0?ot:wn(j,ze,It,1,y,void 0,re,te.canonical),At=oh(Ye,Be,(tt[0]-It[0])*Q,tt[1]-It[1]);if(f.flipState=At&&At.needsFlipping?au.flipRequired:au.flipNotRequired,At)return At}const xt=su(ye*A.getoffsetX(Ae),Ee,Ce,l,V,j,Ie,Re,dt,C,x,q,Y,!1,!1,re,te,ce,me);if(!xt)return{notEnoughRoom:!0};rt(xt)}return{}}function Pa(f,n,l,d,y){const{x,y:S,z:A}=d.projectTilePoint(f.x,f.y,n);if(!y)return Co(x,S,A,l);const[C,k,z]=y(f);return Co(x+C,S+k,A+z,l)}function wn(f,n,l,d,y,x,S,A){const C=Pa(f.sub(n)._unit()._add(f),A,y,S,x);return o.at(C,l,C),o.au(C,C),o.bE(C,l,C,d)}function su(f,n,l,d,y,x,S,A,C,k,z,V,j,q,Q,Y,re,te,ce){const me=d?f-n:f+n;let ye=me>0?1:-1,Ee=0;d&&(ye*=-1,Ee=Math.PI),ye<0&&(Ee+=Math.PI);let Ce=A+S+(ye>0?0:1)|0,Re=y,Ae=y,Pe=0,Ie=0;const Ye=Math.abs(me),Be=[],dt=[];let rt=x,xt=rt,It=o.bC([]);const We=()=>wn(xt,rt,Ae,Ye-Pe+1,z,j,Y,re.canonical);for(;Pe+Ie<=Ye;){if(Ce+=ye,Ce<A||Ce>=C)return null;if(Ae=Re,xt=rt,Be.push(Ae),q&&dt.push(xt),rt=new o.P(k.getx(Ce),k.gety(Ce)),Re=V[Ce],!Re){const Jt=Pa(rt,re.canonical,z,Y,j);Re=Jt[3]>0?V[Ce]=Jt:We()}Pe+=Ie;const cr=o.at([],Re,Ae),pr=o.bD(Ae,Re);if(l&&pr>0&&Ie>0&&o.bG(It,cr)/(Ie*pr)<ce)return null;Ie=pr,It=cr}Q&&j&&(V[Ce]&&(Re=We(),Ie=o.bD(Ae,Re),It=o.at([],Re,Ae)),V[Ce]=Re);const ze=(Ye-Pe)/Ie,ot=rt.sub(xt)._mult(ze)._add(xt),tt=o.bE([],Ae,It,ze);let At=[0,0,1],Pt=It[0],Dt=It[1];if(te&&(At=Y.upVector(re.canonical,ot.x,ot.y),At[0]!==0||At[1]!==0||At[2]!==1)){const cr=[At[2],0,-At[0]],pr=o.bF([],At,cr);o.au(cr,cr),o.au(pr,pr),Pt=o.bG(It,cr),Dt=o.bG(It,pr)}if(l){const cr=o.bF([],At,It);o.au(cr,cr),o.bE(tt,tt,cr,l*ye)}const Bt=Ee+Math.atan2(Dt,Pt);return Be.push(tt),q&&dt.push(ot),{point:tt,angle:Bt,path:Be,tilePath:dt,up:At}}function ul(f,n){const l=n.length,d=l+4*f;n.resize(d),n.float32.fill(-1/0,4*l,4*d)}function Wm(f,n,l){const d=n[0],y=n[1];return f[0]=l[0]*d+l[4]*y+l[12],f[1]=l[1]*d+l[5]*y+l[13],f[3]=l[3]*d+l[7]*y+l[15],f}const Sr=100;class vd{constructor(n,l,d=new nh(n.width+200,n.height+200,25),y=new nh(n.width+200,n.height+200,25)){this.transform=n,this.grid=d,this.ignoredGrid=y,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Sr,this.screenBottomBoundary=n.height+Sr,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=l}placeCollisionBox(n,l,d,y,x,S,A,C,k,z,V){let j=d.projectedAnchorX,q=d.projectedAnchorY,Q=d.projectedAnchorZ;const Y=d.tileAnchorX,re=d.tileAnchorY,te=d.elevation,ce=d.tileID,me=n.getProjection();if(te&&ce){const[dt,rt,xt]=me.upVector(ce.canonical,d.tileAnchorX,d.tileAnchorY),It=me.upVectorScale(ce.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;j+=dt*te*It,q+=rt*te*It,Q+=xt*te*It}const ye=n.projection.name==="globe",Ee=n.projection.name==="globe"?o.ah(this.transform.zoom):0;if(ce&&ye&&Ee<1&&!S){const dt=1<<ce.canonical.z,rt=o.bM(Y,re);o.bN(rt,rt,1/o.aj),o.bO(rt,rt,o.bM(ce.canonical.x,ce.canonical.y)),o.bN(rt,rt,1/dt),o.bP(rt,rt,o.bM(y[0],y[1])),rt[0]=o.bQ(rt[0],-.5,.5),o.bN(rt,rt,o.aj);const xt=o.bR(rt[0],rt[1],o.aj/(2*Math.PI),1);o.aA(xt,xt,x),j=o.ai(j,xt[0],Ee),q=o.ai(q,xt[1],Ee),Q=o.ai(Q,xt[2],Ee)}const Ce=this.projectAndGetPerspectiveRatio(z,j,q,Q,d.tileID,me.name==="globe"||!!te||this.transform.pitch>0,me),Re=k*Ce.perspectiveRatio,Ae=(d.x1*l+A.x-d.padding)*Re+Ce.point.x,Pe=(d.y1*l+A.y-d.padding)*Re+Ce.point.y,Ie=(d.x2*l+A.x+d.padding)*Re+Ce.point.x,Ye=(d.y2*l+A.y+d.padding)*Re+Ce.point.y,Be=Ce.perspectiveRatio<=.55||Ce.occluded;return!this.isInsideGrid(Ae,Pe,Ie,Ye)||!C&&this.grid.hitTest(Ae,Pe,Ie,Ye,V)||Be?{box:[],offscreen:!1,occluded:Ce.occluded}:{box:[Ae,Pe,Ie,Ye],offscreen:this.isOffscreen(Ae,Pe,Ie,Ye),occluded:!1}}placeCollisionCircles(n,l,d,y,x,S,A,C,k,z,V,j,q,Q,Y){const re=[],te=this.transform.elevation,ce=n.getProjection(),me=te?te.getAtTileOffsetFunc(Y,this.transform.center.lat,this.transform.worldSize,ce):null,ye=new o.P(d.tileAnchorX,d.tileAnchorY);let{x:Ee,y:Ce,z:Re}=ce.projectTilePoint(ye.x,ye.y,Y.canonical);if(me){const[At,Pt,Dt]=me(ye);Ee+=At,Ce+=Pt,Re+=Dt}const Ae=ce.name==="globe",Pe=this.projectAndGetPerspectiveRatio(A,Ee,Ce,Re,Y,Ae||!!te||this.transform.pitch>0,ce),{perspectiveRatio:Ie}=Pe,Ye=(V?S/Ie:S*Ie)/o.bU,Be=Co(Ee,Ce,Re,C),dt=d.lineOffsetX*Ye,rt=d.lineOffsetY*Ye,xt=o.al(n.layers[0].layout.get("text-max-angle")),It=Math.cos(xt),We=Pe.signedDistanceFromCamera>0?ta(Ye,x,dt,rt,!1,Be,ye,d,y,C,{},te&&!V?me:null,V&&!!te,ce,Y,V,It):null;let ze=!1,ot=!1,tt=!0;if(We&&!Pe.occluded){const At=.5*q*Ie+Q,Pt=new o.P(-100,-100),Dt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Bt=new of,{first:cr,last:pr}=We,Jt=cr.path.length;let dr=[];for(let Vr=Jt-1;Vr>=1;Vr--)dr.push(cr.path[Vr]);for(let Vr=1;Vr<pr.path.length;Vr++)dr.push(pr.path[Vr]);const ur=2.5*At;k&&(dr=dr.map((([Vr,Xr,vn],Ur)=>(me&&!Ae&&(vn=me(Ur<Jt-1?cr.tilePath[Jt-1-Ur]:pr.tilePath[Ur-Jt+2])[2]),Co(Vr,Xr,vn,k)))),dr.some((Vr=>Vr[3]<=0))&&(dr=[]));let Lr=[];if(dr.length>0){let Vr=1/0,Xr=-1/0,vn=1/0,Ur=-1/0;for(const Sn of dr)Vr=Math.min(Vr,Sn[0]),vn=Math.min(vn,Sn[1]),Xr=Math.max(Xr,Sn[0]),Ur=Math.max(Ur,Sn[1]);Xr>=Pt.x&&Vr<=Dt.x&&Ur>=Pt.y&&vn<=Dt.y&&(Lr=[dr.map((Sn=>new o.P(Sn[0],Sn[1])))],(Vr<Pt.x||Xr>Dt.x||vn<Pt.y||Ur>Dt.y)&&(Lr=o.bS(Lr,Pt.x,Pt.y,Dt.x,Dt.y)))}for(const Vr of Lr){Bt.reset(Vr,.25*At);let Xr=0;Xr=Bt.length<=.5*At?1:Math.ceil(Bt.paddedLength/ur)+1;for(let vn=0;vn<Xr;vn++){const Ur=vn/Math.max(Xr-1,1),Sn=Bt.lerp(Ur),Mn=Sn.x+Sr,Xn=Sn.y+Sr;re.push(Mn,Xn,At,0);const Hr=Mn-At,Tn=Xn-At,_n=Mn+At,Ln=Xn+At;if(tt=tt&&this.isOffscreen(Hr,Tn,_n,Ln),ot=ot||this.isInsideGrid(Hr,Tn,_n,Ln),!l&&this.grid.hitTestCircle(Mn,Xn,At,j)&&(ze=!0,!z))return{circles:[],offscreen:!1,collisionDetected:ze,occluded:!1}}}}return{circles:!z&&ze||!ot?[]:re,offscreen:tt,collisionDetected:ze,occluded:Pe.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let d=1/0,y=1/0,x=-1/0,S=-1/0;for(const z of n){const V=new o.P(z.x+Sr,z.y+Sr);d=Math.min(d,V.x),y=Math.min(y,V.y),x=Math.max(x,V.x),S=Math.max(S,V.y),l.push(V)}const A=this.grid.query(d,y,x,S).concat(this.ignoredGrid.query(d,y,x,S)),C={},k={};for(const z of A){const V=z.key;if(C[V.bucketInstanceId]===void 0&&(C[V.bucketInstanceId]={}),C[V.bucketInstanceId][V.featureIndex])continue;const j=[new o.P(z.x1,z.y1),new o.P(z.x2,z.y1),new o.P(z.x2,z.y2),new o.P(z.x1,z.y2)];o.bT(l,j)&&(C[V.bucketInstanceId][V.featureIndex]=!0,k[V.bucketInstanceId]===void 0&&(k[V.bucketInstanceId]=[]),k[V.bucketInstanceId].push(V.featureIndex))}return k}insertCollisionBox(n,l,d,y,x){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:y,collisionGroupID:x},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,l,d,y,x){const S=l?this.ignoredGrid:this.grid,A={bucketInstanceId:d,featureIndex:y,collisionGroupID:x};for(let C=0;C<n.length;C+=4)S.insertCircle(A,n[C],n[C+1],n[C+2])}projectAndGetPerspectiveRatio(n,l,d,y,x,S,A){const C=[l,d,y,1];let k=!1;y||this.transform.pitch>0?(o.aA(C,C,n),this.fogState&&x&&A.name!=="globe"&&(k=(function(j,q,Q,Y,re,te){const ce=te.calculateFogTileMatrix(re),me=[q,Q,Y];return o.ad(me,me,ce),xr(j,o.ae(me),te.pitch,te._fov)})(this.fogState,l,d,y,x.toUnwrapped(),this.transform)>.9)):Wm(C,C,n);const z=C[3];return{point:new o.P((C[0]/z+1)/2*this.transform.width+Sr,(-C[1]/z+1)/2*this.transform.height+Sr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/z*.5,1.5),signedDistanceFromCamera:z,occluded:S&&C[2]>z||k}}isOffscreen(n,l,d,y){return d<Sr||n>=this.screenRightBoundary||y<Sr||l>this.screenBottomBoundary}isInsideGrid(n,l,d,y){return d>=0&&n<this.gridRightBoundary&&y>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const n=o.bx([]);return o.bo(n,n,[-100,-100,0]),n}}class Ml{constructor(n,l,d,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?l:-l))):y&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class hl{constructor(n,l,d,y,x,S=!1){this.text=new Ml(n?n.text:null,l,d,x),this.icon=new Ml(n?n.icon:null,l,y,x),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ja{constructor(n,l,d,y=!1){this.text=n,this.icon=l,this.skipFade=d,this.clipped=y}}class Bp{constructor(){this.invProjMatrix=o.bz(),this.viewportMatrix=o.bz(),this.circles=[]}}class ah{constructor(n,l,d,y,x){this.bucketInstanceId=n,this.featureIndex=l,this.sourceLayerIndex=d,this.bucketIndex=y,this.tileID=x}}class yr{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const l=++this.maxGroupID;this.collisionGroups[n]={ID:l,predicate:d=>d.collisionGroupID===l}}return this.collisionGroups[n]}}function kn(f,n,l,d,y){const{horizontalAlign:x,verticalAlign:S}=o.bZ(f),A=-(x-.5)*n,C=-(S-.5)*l,k=o.b_(f,d);return new o.P(A+k[0]*y,C+k[1]*y)}function Fn(f,n,l,d,y){const x=new o.P(f,n);return l&&x._rotate(d?y:-y),x}class Ua{constructor(n,l,d,y,x,S){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new vd(this.transform,x),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new yr(d),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,l,d,y,x=1){const S=d.getBucket(l),A=d.latestFeatureIndex;if(!S||!A||l.fqid!==S.layerIds[0])return;const C=S.layers[0].layout,k=S.layers[0].paint,z=d.collisionBoxArray,V=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),j=d.tileSize/o.aj,q=d.tileID.toUnwrapped();this.transform.setProjection(S.projection);const Q=(Y=d.tileID,re=S.getProjection(),te=this.transform,re.name===this.projection?te.calculateProjMatrix(Y.toUnwrapped()):Il(te,re,Y));var Y,re,te;const ce=C.get("text-pitch-alignment")==="map",me=C.get("text-rotation-alignment")==="map";l.compileFilter(l.options);const ye=l.dynamicFilter(),Ee=l.dynamicFilterNeedsFeature(),Ce=this.transform.calculatePixelsToTileUnitsMatrix(d),Re=gc(Q,d.tileID.canonical,ce,me,this.transform,S.getProjection(),Ce);let Ae=null;const Pe=S.getProjection().createInversionMatrix(this.transform,d.tileID.canonical);if(ce){const ze=cl(Q,d.tileID.canonical,ce,me,this.transform,S.getProjection(),Ce);Ae=o.az([],this.transform.labelPlaneMatrix,ze)}let Ie=null;ye&&d.latestFeatureIndex&&(Ie={unwrappedTileID:q,dynamicFilter:ye,dynamicFilterNeedsFeature:Ee}),this.retainedQueryData[S.bucketInstanceId]=new ah(S.bucketInstanceId,A,S.sourceLayerIndex,S.index,d.tileID);const[Ye,Be]=S.layers[0].layout.get("text-size-scale-range"),dt=o.ay(x,Ye,Be),[rt,xt]=C.get("icon-size-scale-range"),It=o.ay(x,rt,xt),We={bucket:S,layout:C,paint:k,posMatrix:Q,invMatrix:Pe,mercatorCenter:[o.aD(this.transform.center.lng),o.aH(this.transform.center.lat)],textLabelPlaneMatrix:Re,labelToScreenMatrix:Ae,clippingData:Ie,scale:V,textPixelRatio:j,holdingForFade:d.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:o.bH(S.textSizeData,this.transform.zoom,dt),partiallyEvaluatedIconSize:o.bH(S.iconSizeData,this.transform.zoom,It),collisionGroup:this.collisionGroups.get(S.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(y)for(const ze of S.sortKeyRanges){const{sortKey:ot,symbolInstanceStart:tt,symbolInstanceEnd:At}=ze;n.push({sortKey:ot,symbolInstanceStart:tt,symbolInstanceEnd:At,parameters:We})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:We})}attemptAnchorPlacement(n,l,d,y,x,S,A,C,k,z,V,j,q,Q,Y,re,te,ce,me,ye,Ee){const{textOffset0:Ce,textOffset1:Re,crossTileID:Ae}=Y,Pe=[Ce,Re],Ie=kn(n,S,A,Pe,C),Ye=this.collisionIndex.placeCollisionBox(te,C,l,d,y,x,Fn(Ie.x,Ie.y,k,z,this.transform.angle),Q,V,j,q.predicate);if(me){const Be=te.getSymbolInstanceIconSize(Ee,this.transform.zoom,Y.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(te,Be,me,d,y,x,Fn(Ie.x,Ie.y,k,z,this.transform.angle),Q,V,j,q.predicate).box.length===0)return}if(Ye.box.length>0){let Be;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ae]&&this.prevPlacement.placements[Ae]&&this.prevPlacement.placements[Ae].text&&(Be=this.prevPlacement.variableOffsets[Ae].anchor),this.variableOffsets[Ae]={textOffset:Pe,width:S,height:A,anchor:n,textScale:C,prevAnchor:Be},this.markUsedJustification(te,n,Y,ce),te.allowVerticalPlacement&&(this.markUsedOrientation(te,ce,Y),this.placedOrientations[Ae]=ce),{shift:Ie,placedGlyphBoxes:Ye}}}placeLayerBucketPart(n,l,d,y,x=1){const{bucket:S,layout:A,paint:C,posMatrix:k,textLabelPlaneMatrix:z,labelToScreenMatrix:V,clippingData:j,textPixelRatio:q,mercatorCenter:Q,invMatrix:Y,holdingForFade:re,collisionBoxArray:te,partiallyEvaluatedTextSize:ce,partiallyEvaluatedIconSize:me,collisionGroup:ye,latestFeatureIndex:Ee}=n.parameters,Ce=A.get("text-optional"),Re=A.get("icon-optional"),Ae=A.get("text-allow-overlap"),Pe=A.get("icon-allow-overlap"),Ie=A.get("text-rotation-alignment")==="map",Ye=A.get("icon-rotation-alignment")==="map",Be=A.get("text-pitch-alignment")==="map",dt=C.get("symbol-z-offset"),rt=A.get("symbol-elevation-reference")==="sea",xt=A.get("symbol-placement"),[It,We]=A.get("text-size-scale-range"),[ze,ot]=A.get("icon-size-scale-range"),tt=o.ay(x,It,We),At=o.ay(x,ze,ot),Pt=A.get("text-variable-anchor"),Dt=Ie&&xt!=="point",Bt=Ye&&xt!=="point",cr=Pt&&S.hasTextData(),pr=S.hasIconTextFit()&&cr&&S.hasIconData();this.transform.setProjection(S.projection);const Jt=cr||Dt,dr=Bt||pr;let ur=Ae&&(Pe||!S.hasIconData()||Re),Lr=Pe&&(Ae||!S.hasTextData()||Ce);const Vr=!dt.isConstant();!S.collisionArrays&&te&&S.deserializeCollisionBoxes(te),d&&y&&S.updateCollisionDebugBuffers(this.transform.zoom,te,tt,At);const Xr=(Ur,Sn,Mn)=>{const{crossTileID:Xn,numVerticalGlyphVertices:Hr}=Ur;let Tn=null;if(j&&j.dynamicFilterNeedsFeature||Vr){const Mi=this.retainedQueryData[S.bucketInstanceId];Tn=Ee.loadFeature({featureIndex:Ur.featureIndex,bucketIndex:Mi.bucketIndex,sourceLayerIndex:Mi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(j&&!(0,j.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Tn,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new o.P(Ur.tileAnchorX,Ur.tileAnchorY),this.transform.calculateDistanceTileData(j.unwrappedTileID)))return this.placements[Xn]=new ja(!1,!1,!1,!0),void l.add(Xn);const _n=dt.evaluate(Tn,{});if(l.has(Xn))return;if(re)return void(this.placements[Xn]=new ja(!1,!1,!1));let Ln=!1,Rr=!1,Gn=!0,On=!1,Ti=!1,xn=null,zn={box:null,offscreen:null,occluded:null},Wn={box:null},Gi=null,ti=null,ji=null,Do=0,Ko=0,Vo=0;Mn.textFeatureIndex?Do=Mn.textFeatureIndex:Ur.useRuntimeCollisionCircles&&(Do=Ur.featureIndex),Mn.verticalTextFeatureIndex&&(Ko=Mn.verticalTextFeatureIndex);const ko=Mi=>{Mi.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const Oi=this.transform.elevation;Mi.elevation=rt?_n:_n+(Oi?Oi.getAtTileOffset(Mi.tileID,Mi.tileAnchorX,Mi.tileAnchorY):0),Mi.elevation+=Ur.zOffset},Ao=Mn.textBox;if(Ao){ko(Ao);const Mi=Jn=>{let eo=o.bI.horizontal;if(S.allowVerticalPlacement&&!Jn&&this.prevPlacement){const uo=this.prevPlacement.placedOrientations[Xn];uo&&(this.placedOrientations[Xn]=uo,eo=uo,this.markUsedOrientation(S,eo,Ur))}return eo},Oi=(Jn,eo)=>{if(S.allowVerticalPlacement&&Hr>0&&Mn.verticalTextBox){for(const uo of S.writingModes)if(uo===o.bI.vertical?(zn=eo(),Wn=zn):zn=Jn(),zn&&zn.box&&zn.box.length)break}else zn=Jn()};if(Pt){let Jn=Pt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Xn]){const Pi=this.prevPlacement.variableOffsets[Xn];Jn.indexOf(Pi.anchor)>0&&(Jn=Jn.filter((Ka=>Ka!==Pi.anchor)),Jn.unshift(Pi.anchor))}const eo=(Pi,Ka,Kl)=>{const jc=S.getSymbolInstanceTextSize(ce,Ur,this.transform.zoom,Sn),Bu=(Pi.x2-Pi.x1)*jc+2*Pi.padding,Uc=(Pi.y2-Pi.y1)*jc+2*Pi.padding,_a=Ur.hasIconTextFit&&!Pe?Ka:null;_a&&ko(_a);let Es={box:[],offscreen:!1,occluded:!1};const Hi=Ae?2*Jn.length:Jn.length;for(let Ya=0;Ya<Hi;++Ya){const Nu=this.attemptAnchorPlacement(Jn[Ya%Jn.length],Pi,Q,Y,Jt,Bu,Uc,jc,Ie,Be,q,k,ye,Ya>=Jn.length,Ur,Sn,S,Kl,_a,ce,me);if(Nu&&(Es=Nu.placedGlyphBoxes,Es&&Es.box&&Es.box.length)){Ln=!0,xn=Nu.shift;break}}return Es};Oi((()=>eo(Ao,Mn.iconBox,o.bI.horizontal)),(()=>{const Pi=Mn.verticalTextBox;return Pi&&ko(Pi),S.allowVerticalPlacement&&!(zn&&zn.box&&zn.box.length)&&Hr>0&&Pi?eo(Pi,Mn.verticalIconBox,o.bI.vertical):{box:null,offscreen:null,occluded:null}})),zn&&(Ln=zn.box,Gn=zn.offscreen,On=zn.occluded);const uo=Mi(!(!zn||!zn.box));if(!Ln&&this.prevPlacement){const Pi=this.prevPlacement.variableOffsets[Xn];Pi&&(this.variableOffsets[Xn]=Pi,this.markUsedJustification(S,Pi.anchor,Ur,uo))}}else{const Jn=(eo,uo)=>{const Pi=S.getSymbolInstanceTextSize(ce,Ur,this.transform.zoom,Sn,x),Ka=this.collisionIndex.placeCollisionBox(S,Pi,eo,Q,Y,Jt,new o.P(0,0),Ae,q,k,ye.predicate);return Ka&&Ka.box&&Ka.box.length&&(this.markUsedOrientation(S,uo,Ur),this.placedOrientations[Xn]=uo),Ka};Oi((()=>Jn(Ao,o.bI.horizontal)),(()=>{const eo=Mn.verticalTextBox;return S.allowVerticalPlacement&&Hr>0&&eo?(ko(eo),Jn(eo,o.bI.vertical)):{box:null,offscreen:null,occluded:null}})),Mi(!!(zn&&zn.box&&zn.box.length))}}if(Gi=zn,Ln=Gi&&Gi.box&&Gi.box.length>0,Gn=Gi&&Gi.offscreen,On=Gi&&Gi.occluded,Ur.useRuntimeCollisionCircles){const Mi=S.text.placedSymbolArray.get(Ur.centerJustifiedTextSymbolIndex>=0?Ur.centerJustifiedTextSymbolIndex:Ur.verticalPlacedTextSymbolIndex),Oi=o.bJ(S.textSizeData,ce,Mi),Jn=A.get("text-padding");ti=this.collisionIndex.placeCollisionCircles(S,Ae,Mi,S.lineVertexArray,S.glyphOffsetArray,Oi,k,z,V,d,Be,ye.predicate,Ur.collisionCircleDiameter*Oi/o.bU,Jn,this.retainedQueryData[S.bucketInstanceId].tileID),Ln=Ae||ti.circles.length>0&&!ti.collisionDetected,Gn=Gn&&ti.offscreen,On=ti.occluded}if(Mn.iconFeatureIndex&&(Vo=Mn.iconFeatureIndex),Mn.iconBox){const Mi=Oi=>{ko(Oi);const Jn=Ur.hasIconTextFit&&xn?Fn(xn.x,xn.y,Ie,Be,this.transform.angle):new o.P(0,0),eo=S.getSymbolInstanceIconSize(me,this.transform.zoom,Ur.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,eo,Oi,Q,Y,dr,Jn,Pe,q,k,ye.predicate)};Wn&&Wn.box&&Wn.box.length&&Mn.verticalIconBox?(ji=Mi(Mn.verticalIconBox),Rr=ji.box.length>0):(ji=Mi(Mn.iconBox),Rr=ji.box.length>0),Gn=Gn&&ji.offscreen,Ti=ji.occluded}const Oa=Ce||Ur.numHorizontalGlyphVertices===0&&Hr===0,Xa=Re||Ur.numIconVertices===0;if(Oa||Xa?Xa?Oa||(Rr=Rr&&Ln):Ln=Rr&&Ln:Rr=Ln=Rr&&Ln,Ln&&Gi&&Gi.box&&this.collisionIndex.insertCollisionBox(Gi.box,A.get("text-ignore-placement"),S.bucketInstanceId,Wn&&Wn.box&&Ko?Ko:Do,ye.ID),Rr&&ji&&this.collisionIndex.insertCollisionBox(ji.box,A.get("icon-ignore-placement"),S.bucketInstanceId,Vo,ye.ID),ti&&(Ln&&this.collisionIndex.insertCollisionCircles(ti.circles,A.get("text-ignore-placement"),S.bucketInstanceId,Do,ye.ID),d)){const Mi=S.bucketInstanceId;let Oi=this.collisionCircleArrays[Mi];Oi===void 0&&(Oi=this.collisionCircleArrays[Mi]=new Bp);for(let Jn=0;Jn<ti.circles.length;Jn+=4)Oi.circles.push(ti.circles[Jn+0]),Oi.circles.push(ti.circles[Jn+1]),Oi.circles.push(ti.circles[Jn+2]),Oi.circles.push(ti.collisionDetected?1:0)}const Yo=S.projection.name!=="globe";ur=ur&&(Yo||!On),Lr=Lr&&(Yo||!Ti),this.placements[Xn]=new ja(Ln||ur,Rr||Lr,Gn||S.justReloaded),l.add(Xn)},vn=this.retainedQueryData[S.bucketInstanceId].tileID;if(S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,vn),S.elevationType==="road"&&S.updateRoadElevation(vn.canonical),S.updateZOffset(),S.sortFeaturesByY){const Ur=S.getSortedSymbolIndexes(this.transform.angle);for(let Sn=Ur.length-1;Sn>=0;--Sn){const Mn=Ur[Sn];Xr(S.symbolInstances.get(Mn),Mn,S.collisionArrays[Mn])}S.hasAnyZOffset&&o.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const Ur=S.getSortedIndexesByZOffset();for(let Sn=0;Sn<Ur.length;++Sn){const Mn=Ur[Sn];Xr(S.symbolInstances.get(Mn),Mn,S.collisionArrays[Mn])}}else for(let Ur=n.symbolInstanceStart;Ur<n.symbolInstanceEnd;Ur++)Xr(S.symbolInstances.get(Ur),Ur,S.collisionArrays[Ur]);if(d&&S.bucketInstanceId in this.collisionCircleArrays){const Ur=this.collisionCircleArrays[S.bucketInstanceId];o.bi(Ur.invProjMatrix,k),Ur.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(n,l,d,y){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:C,crossTileID:k}=d,z=o.b$(l),V=y===o.bI.vertical?C:z==="left"?x:z==="center"?S:z==="right"?A:-1;x>=0&&(n.text.placedSymbolArray.get(x).crossTileID=V>=0&&x!==V?0:k),S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=V>=0&&S!==V?0:k),A>=0&&(n.text.placedSymbolArray.get(A).crossTileID=V>=0&&A!==V?0:k),C>=0&&(n.text.placedSymbolArray.get(C).crossTileID=V>=0&&C!==V?0:k)}markUsedOrientation(n,l,d){const y=l===o.bI.horizontal||l===o.bI.horizontalOnly?l:0,x=l===o.bI.vertical?l:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:k}=d,z=n.text.placedSymbolArray;S>=0&&(z.get(S).placedOrientation=y),A>=0&&(z.get(A).placedOrientation=y),C>=0&&(z.get(C).placedOrientation=y),k>=0&&(z.get(k).placedOrientation=x)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let d=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const y=l?l.symbolFadeChange(n):1,x=l?l.opacities:{},S=l?l.variableOffsets:{},A=l?l.placedOrientations:{};for(const C in this.placements){const k=this.placements[C],z=x[C];z?(this.opacities[C]=new hl(z,y,k.text,k.icon,null,k.clipped),d=d||k.text!==z.text.placed||k.icon!==z.icon.placed):(this.opacities[C]=new hl(null,y,k.text,k.icon,k.skipFade,k.clipped),d=d||k.text||k.icon)}for(const C in x){const k=x[C];if(!this.opacities[C]){const z=new hl(k,y,!1,!1);z.isHidden()||(this.opacities[C]=z,d=d||k.text.placed||k.icon.placed)}}for(const C in S)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=S[C]);for(const C in A)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=A[C]);d?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:n)}updateLayerOpacities(n,l,d,y){const x=new Set;for(const S of l){const A=S.getBucket(n);A&&S.latestFeatureIndex&&n.fqid===A.layerIds[0]&&(this.updateBucketOpacities(A,x,S,S.collisionBoxArray,d,y,S.tileID,n.scope),A.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(A,S.tileID),A.elevationType==="road"&&A.updateRoadElevation(S.tileID.canonical),A.updateZOffset())}}updateBucketOpacities(n,l,d,y,x,S,A,C){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const k=n.layers[0].layout,z=n.layers[0].paint,V=!!n.layers[0].dynamicFilter(),j=new hl(null,0,!1,!1,!0),q=k.get("text-allow-overlap"),Q=k.get("icon-allow-overlap"),Y=k.get("text-variable-anchor"),re=k.get("text-rotation-alignment")==="map",te=k.get("text-pitch-alignment")==="map",ce=z.get("symbol-z-offset"),me=k.get("symbol-elevation-reference")==="sea",ye=!ce.isConstant(),Ee=new hl(null,0,q&&(Q||!n.hasIconData()||k.get("icon-optional")),Q&&(q||!n.hasTextData()||k.get("text-optional")),!0);!n.collisionArrays&&y&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(y);const Ce=(Ae,Pe,Ie)=>{for(let Ye=0;Ye<Pe/4;Ye++)Ae.opacityVertexArray.emplaceBack(Ie)};let Re=0;S&&n.updateReplacement(A,S);for(let Ae=0;Ae<n.symbolInstances.length;Ae++){const Pe=n.symbolInstances.get(Ae),{numHorizontalGlyphVertices:Ie,numVerticalGlyphVertices:Ye,crossTileID:Be,numIconVertices:dt,tileAnchorX:rt,tileAnchorY:xt}=Pe;let It=null;const We=this.retainedQueryData[n.bucketInstanceId];ye&&Pe&&We&&(It=d.latestFeatureIndex.loadFeature({featureIndex:Pe.featureIndex,bucketIndex:We.bucketIndex,sourceLayerIndex:We.sourceLayerIndex,layoutVertexArrayOffset:0}));const ze=ce.evaluate(It,{}),ot=l.has(Be);let tt=this.opacities[Be];ot?tt=j:tt||(tt=Ee,this.opacities[Be]=tt),l.add(Be);const At=Ie>0||Ye>0,Pt=dt>0,Dt=this.placedOrientations[Be],Bt=Dt===o.bI.vertical,cr=Dt===o.bI.horizontal||Dt===o.bI.horizontalOnly;!At&&!Pt||tt.isHidden()||Re++;let pr=!1;if((At||Pt)&&S)for(const Jt of n.activeReplacements){if(o.bV(Jt,x,o.bW.Symbol,C)||Jt.min.x>rt||rt>Jt.max.x||Jt.min.y>xt||xt>Jt.max.y)continue;const dr=o.bX(rt,xt,A.canonical,Jt.footprintTileId.canonical);if(pr=o.bY(dr,Jt.footprint),pr)break}if(At){const Jt=pr?vc:yc(tt.text);Ce(n.text,Ie,Bt?vc:Jt),Ce(n.text,Ye,cr?vc:Jt);const dr=tt.text.isHidden(),{leftJustifiedTextSymbolIndex:ur,centerJustifiedTextSymbolIndex:Lr,rightJustifiedTextSymbolIndex:Vr,verticalPlacedTextSymbolIndex:Xr}=Pe,vn=n.text.placedSymbolArray,Ur=dr||Bt?1:0;ur>=0&&(vn.get(ur).hidden=Ur),Lr>=0&&(vn.get(Lr).hidden=Ur),Vr>=0&&(vn.get(Vr).hidden=Ur),Xr>=0&&(vn.get(Xr).hidden=dr||cr?1:0);const Sn=this.variableOffsets[Be];Sn&&this.markUsedJustification(n,Sn.anchor,Pe,Dt);const Mn=this.placedOrientations[Be];Mn&&(this.markUsedJustification(n,"left",Pe,Mn),this.markUsedOrientation(n,Mn,Pe))}if(Pt){const Jt=pr?vc:yc(tt.icon),{placedIconSymbolIndex:dr,verticalPlacedIconSymbolIndex:ur}=Pe,Lr=n.icon.placedSymbolArray,Vr=tt.icon.isHidden()?1:0;dr>=0&&(Ce(n.icon,dt,Bt?vc:Jt),Lr.get(dr).hidden=Vr),ur>=0&&(Ce(n.icon,Pe.numVerticalIconVertices,cr?vc:Jt),Lr.get(ur).hidden=Vr)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Jt=n.collisionArrays[Ae];if(Jt){let dr=new o.P(0,0),ur=!0;if(Jt.textBox||Jt.verticalTextBox){if(Y){const Vr=this.variableOffsets[Be];Vr?(dr=kn(Vr.anchor,Vr.width,Vr.height,Vr.textOffset,Vr.textScale),re&&dr._rotate(te?this.transform.angle:-this.transform.angle)):ur=!1}V&&(ur=!tt.clipped),Jt.textBox&&Ol(n.textCollisionBox.collisionVertexArray,tt.text.placed,!ur||Bt,ze,me,dr.x,dr.y),Jt.verticalTextBox&&Ol(n.textCollisionBox.collisionVertexArray,tt.text.placed,!ur||cr,ze,me,dr.x,dr.y)}const Lr=ur&&!!(!cr&&Jt.verticalIconBox);Jt.iconBox&&Ol(n.iconCollisionBox.collisionVertexArray,tt.icon.placed,Lr,ze,me,Pe.hasIconTextFit?dr.x:0,Pe.hasIconTextFit?dr.y:0),Jt.verticalIconBox&&Ol(n.iconCollisionBox.collisionVertexArray,tt.icon.placed,!Lr,ze,me,Pe.hasIconTextFit?dr.x:0,Pe.hasIconTextFit?dr.y:0)}}}if(n.fullyClipped=Re===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Ae.invProjMatrix,n.placementViewportMatrix=Ae.viewportMatrix,n.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,l){const d=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*d>n}setStale(){this.stale=!0}}function Ol(f,n,l,d,y,x,S){f.emplaceBack(n?1:0,l?1:0,x||0,S||0,d,y?1:0),f.emplaceBack(n?1:0,l?1:0,x||0,S||0,d,y?1:0),f.emplaceBack(n?1:0,l?1:0,x||0,S||0,d,y?1:0),f.emplaceBack(n?1:0,l?1:0,x||0,S||0,d,y?1:0)}const Nn=Math.pow(2,25),xd=Math.pow(2,24),sh=Math.pow(2,17),lf=Math.pow(2,16),ra=Math.pow(2,9),io=Math.pow(2,8),I_=Math.pow(2,1);function yc(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const n=f.placed?1:0,l=Math.floor(127*f.opacity);return l*Nn+n*xd+l*sh+n*lf+l*ra+n*io+l*I_+n}const vc=0;class cf{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,l,d,y,x,S){const A=this._bucketParts;for(;this._currentTileIndex<n.length;)if(l.getBucketParts(A,y,n[this._currentTileIndex],this._sortAcrossTiles,S),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort(((C,k)=>C.sortKey-k.sortKey)));this._currentPartIndex<A.length;){const C=A[this._currentPartIndex];if(l.placeLayerBucketPart(C,this._seenCrossTileIDs,d,C.symbolInstanceStart===0,S),this._currentPartIndex++,x())return!0}return!1}}class bd{constructor(n,l,d,y,x,S,A,C,k){this.placement=new Ua(n,x,S,A,C,k),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(n,l,d,y,x){const S=o.q.now(),A=()=>{const C=o.q.now()-S;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=l[n[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=k)&&(!C.maxzoom||C.maxzoom>k)){const z=C,V=z.layout.get("symbol-z-elevate"),j=z.layout.get("symbol-sort-key").constantOr(1)!==void 0,q=z.layout.get("symbol-z-order"),Q=q==="viewport-y"||q==="auto"&&!(q!=="viewport-y"&&j),Y=z.layout.get("text-allow-overlap")||z.layout.get("icon-allow-overlap")||z.layout.get("text-ignore-placement")||z.layout.get("icon-ignore-placement"),re=Q&&Y,te=this._inProgressLayer=this._inProgressLayer||new cf(z),ce=o.C(C.source,C.scope);if(te.continuePlacement(V||re?y[ce]:d[ce],this.placement,this._showCollisionBoxes,C,A,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const lh=512/o.aj/2;class wd{constructor(n,l,d){this.tileID=n,this.bucketInstanceId=d,this.index=new o.c0(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=n.canonical.x*o.aj,x=n.canonical.y*o.aj;for(let S=0;S<l.length;S++){const{key:A,crossTileID:C,tileAnchorX:k,tileAnchorY:z}=l.get(S),V=Math.floor((y+k)*lh),j=Math.floor((x+z)*lh);this.index.add(V,j),this.keys.push(A),this.crossTileIDs.push(C)}this.index.finish()}findMatches(n,l,d){const y=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),x=lh/Math.pow(2,l.canonical.z-this.tileID.canonical.z),S=l.canonical.x*o.aj,A=l.canonical.y*o.aj;for(let C=0;C<n.length;C++){const k=n.get(C);if(k.crossTileID)continue;const{key:z,tileAnchorX:V,tileAnchorY:j}=k,q=Math.floor((S+V)*x),Q=Math.floor((A+j)*x),Y=this.index.range(q-y,Q-y,q+y,Q+y).sort(((re,te)=>re-te));for(const re of Y){const te=this.crossTileIDs[re];if(this.keys[re]===z&&!d.has(te)){d.add(te),k.crossTileID=te;break}}}}}class ha{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Rl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const l=Math.round((n-this.lng)/360);if(l!==0)for(const d in this.indexes){const y=this.indexes[d],x={};for(const S in y){const A=y[S];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+l),x[A.tileID.key]=A}this.indexes[d]=x}this.lng=n}addBucket(n,l,d){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let x=0;x<l.symbolInstances.length;x++)l.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const y=this.usedCrossTileIDs[n.overscaledZ];for(const x in this.indexes){const S=this.indexes[x];if(Number(x)>n.overscaledZ)for(const A in S){const C=S[A];C.tileID.isChildOf(n)&&C.findMatches(l.symbolInstances,n,y)}else{const A=S[n.scaledTo(Number(x)).key];A&&A.findMatches(l.symbolInstances,n,y)}}for(let x=0;x<l.symbolInstances.length;x++){const S=l.symbolInstances.get(x);S.crossTileID||(S.crossTileID=d.generate(),y.add(S.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new wd(n,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(n,l){for(const d of l.crossTileIDs)this.usedCrossTileIDs[n].delete(d)}removeStaleBuckets(n){let l=!1;for(const d in this.indexes){const y=this.indexes[d];for(const x in y)n[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,y[x]),delete y[x],l=!0)}return l}}class Ia{constructor(){this.layerIndexes={},this.crossTileIDs=new ha,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,l,d,y){let x=this.layerIndexes[n.fqid];x===void 0&&(x=this.layerIndexes[n.fqid]=new Rl);let S=!1;const A={};y.name!=="globe"&&x.handleWrapJump(d);for(const C of l){const k=C.getBucket(n);k&&n.fqid===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(C.tileID,k,this.crossTileIDs)&&(S=!0),A[k.bucketInstanceId]=!0)}return x.removeStaleBuckets(A)&&(S=!0),S}pruneUnusedLayers(n){const l={};n.forEach((d=>{l[d]=!0}));for(const d in this.layerIndexes)l[d]||delete this.layerIndexes[d]}}const lu=771;class Wr{constructor(n,l,d,y){this.blendFunction=n,this.blendColor=l.toNonPremultipliedRenderColor(null),this.mask=d,this.blendEquation=y}}Wr.Replace=[1,0,1,0],Wr.disabled=new Wr(Wr.Replace,o.am.transparent,[!1,!1,!1,!1]),Wr.unblended=new Wr(Wr.Replace,o.am.transparent,[!0,!0,!0,!0]),Wr.alphaBlended=new Wr([1,lu,1,lu],o.am.transparent,[!0,!0,!0,!0]),Wr.alphaBlendedNonPremultiplied=new Wr([770,lu,770,lu],o.am.transparent,[!0,!0,!0,!0]),Wr.multiply=new Wr([774,0,774,0],o.am.transparent,[!0,!0,!0,!0]);class er{constructor(n,l,d){this.func=n,this.mask=l,this.range=d}}er.ReadOnly=!1,er.ReadWrite=!0,er.disabled=new er(519,er.ReadOnly,[0,1]);const Va=7680;class Ir{constructor(n,l,d,y,x,S){this.test=n,this.ref=l,this.mask=d,this.fail=y,this.depthFail=x,this.pass=S}}Ir.disabled=new Ir({func:519,mask:0},0,0,Va,Va,Va);const Ji=1029,ch=2305;class Er{constructor(n,l,d){this.enable=n,this.mode=l,this.frontFace=d}}function cu(f,n){const l=o.c6(f,3);o.c8(f,n),o.cc(f,3,l)}function uu(f,n){const l=o.c3([]);return o.c4(l,l,-n),o.c5(l,l,-f),l}function Dl(f,n){const l=[f[0],f[1],0],d=[n[0],n[1],0];if(o.ae(l)>=1e-15){const S=o.au([],l);o.c1(d,S,o.bG(d,S)),n[0]=d[0],n[1]=d[1]}const y=o.bF([],n,f);if(o.c2(y)<1e-15)return null;const x=Math.atan2(-y[1],y[0]);return uu(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}Er.disabled=new Er(!1,Ji,ch),Er.backCCW=new Er(!0,Ji,ch),Er.backCW=new Er(!0,Ji,2304),Er.frontCW=new Er(!0,1028,2304),Er.frontCCW=new Er(!0,1028,ch);class hu{constructor(n,l){this.position=n,this.orientation=l}get position(){return this._position}set position(n){if(n){const l=n instanceof o.ac?n:new o.ac(n[0],n[1],n[2]);this._renderWorldCopies&&(l.x=o.bQ(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(n,l){if(this.orientation=null,!this.position)return;const d=this.position,y=this._elevation?this._elevation.getAtPointOrZero(o.ac.fromLngLat(n)):0,x=o.ac.fromLngLat(n,y),S=[x.x-d.x,x.y-d.y,x.z-d.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Dl(S,l)}setPitchBearing(n,l){this.orientation=uu(o.al(n),o.al(-l))}}class _s{constructor(n,l){this._transform=o.bx([]),this.orientation=l,this.position=n}get mercatorPosition(){const n=this.position;return new o.ac(n[0],n[1],n[2])}get position(){const n=o.c6(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var l;n&&o.cc(this._transform,3,[(l=n)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||o.c3([]),n&&cu(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,l){this._orientation=uu(n,l),cu(this._transform,this._orientation)}forward(){const n=o.c6(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=o.c6(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=o.c6(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,l){const d=new Float64Array(16);return o.bi(d,this.getWorldToCamera(n,l)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,l,d){const y=this.position;o.c1(y,y,-n);const x=new Float64Array(16);return o.bn(x,[d,d,d]),o.bo(x,x,y),x[10]*=l,x}getWorldToCamera(n,l){const d=new Float64Array(16),y=new Float64Array(4),x=this.position;return o.c7(y,this._orientation),o.c1(x,x,-n),o.c8(d,y),o.bo(d,d,x),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=l,d[9]*=l,d[10]*=l,d[11]*=l,d}getCameraToClipPerspective(n,l,d,y){const x=new Float64Array(16);return o.c9(x,n,l,d,y),x}getCameraToClipOrthographic(n,l,d,y,x,S){const A=new Float64Array(16);return o.ca(A,n,l,d,y,x,S),A}getDistanceToElevation(n,l=!1){const d=n===0?0:o.cb(n,l?o.aY(this.position[1]):this.position[1]),y=this.forward();return(d-this.position[2])/y[2]}clone(){return new _s([...this.position],[...this.orientation])}}const fa={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class uf{constructor(n=0,l=0,d=0,y=0){if(isNaN(n)||n<0||isNaN(l)||l<0||isNaN(d)||d<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=l,this.left=d,this.right=y}interpolate(n,l,d){return l.top!=null&&n.top!=null&&(this.top=o.ai(n.top,l.top,d)),l.bottom!=null&&n.bottom!=null&&(this.bottom=o.ai(n.bottom,l.bottom,d)),l.left!=null&&n.left!=null&&(this.left=o.ai(n.left,l.left,d)),l.right!=null&&n.right!=null&&(this.right=o.ai(n.right,l.right,d)),this}getCenter(n,l){const d=o.ay((this.left+n-this.right)/2,0,n),y=o.ay((this.top+l-this.bottom)/2,0,l);return new o.P(d,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new uf(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const bo=15;class Sd{constructor(n,l,d,y,x,S,A){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=d??0,this._maxPitch=y??60,this.setProjection(S),this.setMaxBounds(A),this.width=0,this.height=0,this._center=new o.ci(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new uf,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new _s,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const n=new Sd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n._allowWorldUnderZoom=this._allowWorldUnderZoom,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<bo}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,l=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(n||d)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return o.aF(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=o.cj(this.projectionOptions);const d=this.getProjection(),y=!o.bv(l,d);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cj({name:"mercator"});const l=n!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.cb(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bQ(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const l=-n*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=o.ck(),o.cl(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const l=o.ay(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=o.al(n),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const l=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){const n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const n=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(n)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let y=0,x=0;for(let S=0;S<l.length;S++){const A=new o.P(l[S][0]*this.width,d+l[S][1]*(this.height-d)),C=n.pointCoordinate(A);if(!C)continue;const k=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);y+=C[3]*k,x+=k}return x===0?NaN:y/x}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*l,y=this._mercatorZfromZoom(n),x=this._mercatorZfromZoom(this._maxZoom),S=Math.max(y-d,x);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let d;d=n.z<this._camera.position[2]?[l.x,l.y,l.z]:[n.x,n.y,n.z];const y=o.ae(o.at([],this._camera.position,d));return o.ay(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let l=!1;if(n.orientation&&!o.cm(n.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(n.orientation)),n.position){const d=[n.position.x,n.position.y,n.position.z];o.cn(d,this._camera.position)||(this._setCameraPosition(d),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,l=new hu;return l.position=new o.ac(n[0],n[1],n[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(n){if(!o.co(n))return!1;o.cp(n,n);const l=o.cq([],[0,0,-1],n),d=o.cq([],[0,-1,0],n);if(d[2]<0)return!1;const y=Dl(l,d);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(n){const l=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;n[2]=o.ay(n[2],y/d,y/l),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,l,d){this._unmodified=!1,this._edgeInsets.interpolate(n,l,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const l=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(n){const l=[new o.cr(0,n)];if(this.renderWorldCopies){const d=this.pointCoordinate(new o.P(0,0)),y=this.pointCoordinate(new o.P(this.width,0)),x=this.pointCoordinate(new o.P(this.width,this.height)),S=this.pointCoordinate(new o.P(0,this.height)),A=Math.floor(Math.min(d.x,y.x,x.x,S.x)),C=Math.floor(Math.max(d.x,y.x,x.x,S.x)),k=1;for(let z=A-k;z<=C+k;z++)z!==0&&l.push(new o.cr(z,n))}return l}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(n,l,d){let y=[];const x=d!=null,S=!x;if(S&&this.zoom<l||x&&d[0]===0&&d[1]===0)return y;const A=new Set,C=(z,V,j,q,Q)=>{const Y=o.cV(V,z,j,q,Q);A.has(Y)||(y.push(new o.aM(z,V,j,q,Q)),A.add(Y))};for(let z=0;z<n.length;z++){const V=n[z];if(S&&V.canonical.z!==l)continue;const j=V.canonical,q=V.overscaledZ,Q=V.wrap,Y=1<<j.z,re=j.x+1<Y,te=j.x>0,ce=j.y+1<Y,me=j.y>0,ye=V.wrap-(te?0:1),Ee=V.wrap+(re?0:1),Ce=te?j.x-1:Y-1,Re=re?j.x+1:0;if(x)d[0]<0?(C(q,Ee,j.z,Re,j.y),d[1]<0&&ce&&(C(q,Q,j.z,j.x,j.y+1),C(q,Ee,j.z,Re,j.y+1)),d[1]>0&&me&&(C(q,Q,j.z,j.x,j.y-1),C(q,Ee,j.z,Re,j.y-1))):d[0]>0?(C(q,ye,j.z,Ce,j.y),d[1]<0&&ce&&(C(q,Q,j.z,j.x,j.y+1),C(q,ye,j.z,Ce,j.y+1)),d[1]>0&&me&&(C(q,Q,j.z,j.x,j.y-1),C(q,ye,j.z,Ce,j.y-1))):d[1]<0&&ce?C(q,Q,j.z,j.x,j.y+1):me&&C(q,Q,j.z,j.x,j.y-1);else{const Ae=V.visibleQuadrants;1&Ae&&(C(q,ye,j.z,Ce,j.y),me&&(C(q,Q,j.z,j.x,j.y-1),C(q,ye,j.z,Ce,j.y-1))),2&Ae&&(C(q,Ee,j.z,Re,j.y),me&&(C(q,Q,j.z,j.x,j.y-1),C(q,Ee,j.z,Re,j.y-1))),4&Ae&&(C(q,ye,j.z,Ce,j.y),ce&&(C(q,Q,j.z,j.x,j.y+1),C(q,ye,j.z,Ce,j.y+1))),8&Ae&&(C(q,Ee,j.z,Re,j.y),ce&&(C(q,Q,j.z,j.x,j.y+1),C(q,Ee,j.z,Re,j.y+1)))}}const k=[];for(const z of y)y.some((V=>z.isChildOf(V)))||k.push(z);if(y=k.filter((z=>!n.some((V=>!!(z.overscaledZ<l&&V.isChildOf(z))||z.equals(V)||z.isChildOf(V))))),S){const z=1<<l,V=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=[z*V.x,z*V.y],q=4,Q=q*q;y=y.filter((Y=>{const re=Y.canonical.x+.5-j[0],te=Y.canonical.y+.5-j[1];return re*re+te*te<Q}))}return y}extendTileCoverToNearPlane(n,l,d){const y=[],x=new Set;for(const ce of n)x.add(ce.key);const S=(ce,me,ye,Ee,Ce)=>{const Re=o.cV(me,ce,ye,Ee,Ce);x.has(Re)||(y.push(new o.aM(ce,me,ye,Ee,Ce)),x.add(Re))},A=n.reduce(((ce,me)=>Math.max(ce,me.overscaledZ)),d),C=1<<d,k=[new o.P(0,0),new o.P(o.aj,0),new o.P(o.aj,o.aj),new o.P(0,o.aj)],z=new o.P(0,0),V=new o.P(0,0),j=(ce,me)=>{const ye=Math.floor(ce[0]),Ee=Math.floor(ce[1]),Ce=(ce[0]-ye)*o.aj,Re=(ce[1]-Ee)*o.aj,Ae=Math.floor(me[0]),Pe=Math.floor(me[1]),Ie=(me[0]-Ae)*o.aj,Ye=(me[1]-Pe)*o.aj;for(let Be=-1;Be<=1;Be++){const dt=ye+Be;if(!(dt<0||dt>=C)){z.x=Ce-Be*o.aj,V.x=Ie-(dt-Ae)*o.aj;for(let rt=-1;rt<=1;rt++){const xt=Ee+rt;z.y=Re-rt*o.aj,V.y=Ye-(xt-Pe)*o.aj,o.cW(z,V,k)&&S(A,0,d,dt,xt)}}}},q=l.points,Q=q[o.cs],Y=q[o.ct],re=this._projectToGround(Q,q[o.cu]),te=this._projectToGround(Y,q[o.cv]);return j(Q,re),j(Y,te),y}_projectToGround(n,l){return o.cw(o.cx(),n,l,n[2]/(n[2]-l[2]))}coveringTiles(n){let l=this.coveringZoomLevel(n);const d=l,y=this.elevation&&this.elevation.exaggeration(),x=y&&!n.isTerrainDEM,S=this.projection.name==="mercator";if(n.minzoom!==void 0&&l<n.minzoom)return[];n.maxzoom!==void 0&&l>n.maxzoom&&(l=n.maxzoom);const A=this.locationCoordinate(this.center),C=this.center.lat,k=1<<l,z=[k*A.x,k*A.y,0],V=this.projection.name==="globe",j=!V,q=o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,j),Q=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=k*o.cb(1,this.center.lat),re=this._camera.position[2]/o.cb(1,this.center.lat),te=[k*Q.x,k*Q.y,re*(j?1:Y)],ce=V||y,me=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ye=this.isLODDisabled(!0)?l:0;let Ee;if(this._elevation&&n.isTerrainDEM)Ee=1e4*this._elevation.exaggeration();else if(this._elevation){const ze=this._elevation.getMinMaxForVisibleTiles();Ee=ze?ze.max:this._centerAltitude}else Ee=this._centerAltitude;const Ce=n.isTerrainDEM?-Ee:this._elevation?this._elevation.getMinElevationBelowMSL():0,Re=this.projection.isReprojectedInTileSpace?o.cz(this):1,Ae=ze=>{const tt=new o.ac(ze.x+25e-6,ze.y,ze.z),At=new o.ac(ze.x,ze.y+25e-6,ze.z),Pt=ze.toLngLat(),Dt=tt.toLngLat(),Bt=At.toLngLat(),cr=this.locationCoordinate(Pt),pr=this.locationCoordinate(Dt),Jt=this.locationCoordinate(Bt),dr=Math.hypot(pr.x-cr.x,pr.y-cr.y),ur=Math.hypot(Jt.x-cr.x,Jt.y-cr.y);return Math.sqrt(dr*ur)*Re/25e-6},Pe=ze=>{const ot=Ee,tt=Ce;return{aabb:o.cC(this,k,0,0,0,ze,tt,ot,this.projection),zoom:0,x:0,y:0,minZ:tt,maxZ:ot,wrap:ze,fullyVisible:!1}},Ie=[];let Ye=[];const Be=l,dt=n.reparseOverscaled?d:l,rt=(re-this._centerAltitude)*Y,xt=ze=>{if(!this._elevation||!ze.tileID||!S)return;const ot=this._elevation.getMinMaxForTile(ze.tileID),tt=ze.aabb;ot?(tt.min[2]=ot.min,tt.max[2]=ot.max,tt.center[2]=(tt.min[2]+tt.max[2])/2):(ze.shouldSplit=We(ze),ze.shouldSplit||(tt.min[2]=tt.max[2]=tt.center[2]=this._centerAltitude))},It=(ze,ot)=>{if(.707*ot<ze)return 1;const tt=ot/ze;return tt/(1.4144271570014144+(Math.pow(1.1,tt-1.4144271570014144+1)-1)/(1.1-1)-1)},We=ze=>{if(ze.zoom<ye)return!0;if(ze.zoom===Be)return!1;if(ze.shouldSplit!=null)return ze.shouldSplit;const ot=ze.aabb.distanceX(te),tt=ze.aabb.distanceY(te);let At=rt,Pt=1;if(V){At=ze.aabb.distanceZ(te);const ur=Math.pow(2,ze.zoom),Lr=o.aY((ze.y+1)/ur),Vr=o.aY(ze.y/ur),Xr=Math.min(Math.max(C,Lr),Vr),vn=o.c_(Xr)/o.c_(C);if(Pt=Xr===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,vn/this._mercatorScaleRatio),this.zoom<=o.cX&&ze.zoom===Be-1&&vn>=.9)return!0}else if(x&&(At=ze.aabb.distanceZ(te)*Y),this.projection.isReprojectedInTileSpace&&d<=5){const ur=Math.pow(2,ze.zoom),Lr=Ae(new o.ac((ze.x+.5)/ur,(ze.y+.5)/ur));Pt=Lr>.85?1:Lr}if(!S){const ur=Math.sqrt(ot*ot+tt*tt+At*At);let Lr=(1<<Be-ze.zoom)*me*Pt;return Lr*=It(Math.max(At,rt),ur),ur<Lr}let Dt=Number.MAX_VALUE,Bt=0;const cr=ze.aabb.getCorners(),pr=[];for(const ur of cr){o.at(pr,ur,te),V||(x?pr[2]*=Y:pr[2]=rt);const Lr=o.bG(pr,this._camera.forward());Lr<Dt&&(Dt=Lr,Bt=Math.abs(pr[2]))}let Jt=(1<<Be-ze.zoom)*me*Pt;if(Jt*=It(Math.max(Bt,rt),Dt),Dt<Jt)return!0;const dr=ze.aabb.closestPoint(z);return dr[0]===z[0]&&dr[1]===z[1]};if(this.renderWorldCopies)for(let ze=1;ze<=3;ze++)Ie.push(Pe(-ze)),Ie.push(Pe(ze));for(Ie.push(Pe(0));Ie.length>0;){const ze=Ie.pop(),ot=ze.x,tt=ze.y;let At=ze.fullyVisible;const Pt=()=>this.projection.name==="globe"&&(ze.y===0||ze.y===(1<<ze.zoom)-1);if(!At){let Dt=ce?ze.aabb.intersects(q):ze.aabb.intersectsFlat(q);if(Dt===0&&Pt()){const Bt=new o.cA(ze.zoom,ot,tt);Dt=o.cB(this,k,Bt,!0).intersects(q)}if(Dt===0)continue;At=Dt===2}if(ze.zoom!==Be&&We(ze))for(let Dt=0;Dt<4;Dt++){const Bt=(ot<<1)+Dt%2,cr=(tt<<1)+(Dt>>1),pr={aabb:S?ze.aabb.quadrant(Dt):o.cC(this,k,ze.zoom+1,Bt,cr,ze.wrap,ze.minZ,ze.maxZ,this.projection),zoom:ze.zoom+1,x:Bt,y:cr,wrap:ze.wrap,fullyVisible:At,tileID:void 0,shouldSplit:void 0,minZ:ze.minZ,maxZ:ze.maxZ};x&&!V&&(pr.tileID=new o.aM(ze.zoom+1===Be?dt:ze.zoom+1,ze.wrap,ze.zoom+1,Bt,cr),xt(pr)),Ie.push(pr)}else{const Dt=ze.zoom===Be?dt:ze.zoom;if(n.minzoom&&n.minzoom>Dt)continue;let Bt=0;if(!At){let dr=ce?ze.aabb.intersectsPrecise(q):ze.aabb.intersectsPreciseFlat(q);if(dr===0&&Pt()){const ur=new o.cA(ze.zoom,ot,tt);dr=o.cB(this,k,ur,!0).intersectsPrecise(q)}if(dr===0)continue;if(n.calculateQuadrantVisibility)if(q.containsPoint(ze.aabb.center))Bt=15;else for(let ur=0;ur<4;ur++)ze.aabb.quadrant(ur).intersects(q)!==0&&(Bt|=1<<ur)}const cr=z[0]-(.5+ot+(ze.wrap<<ze.zoom))*(1<<l-ze.zoom),pr=z[1]-.5-tt,Jt=ze.tileID?ze.tileID:new o.aM(Dt,ze.wrap,ze.zoom,ot,tt);n.calculateQuadrantVisibility&&(Jt.visibleQuadrants=Bt),Ye.push({tileID:Jt,distanceSq:cr*cr+pr*pr})}}if(this.fogCullDistSq){const ze=this.fogCullDistSq,ot=this.horizonLineFromTop();Ye=Ye.filter((tt=>{const At=[0,0,0,1],Pt=[o.aj,o.aj,0,1],Dt=this.calculateFogTileMatrix(tt.tileID.toUnwrapped());o.aA(At,At,Dt),o.aA(Pt,Pt,Dt);const Bt=o.cD([],At,Pt),cr=o.cE([],At,Pt),pr=o.cY(Bt,cr);if(pr===0)return!0;let Jt=!1;const dr=this._elevation;if(dr&&pr>ze&&ot!==0){const ur=this.calculateProjMatrix(tt.tileID.toUnwrapped());let Lr;n.isTerrainDEM||(Lr=dr.getMinMaxForTile(tt.tileID)),Lr||(Lr={min:Ce,max:Ee});const Vr=o.cF(this.rotation),Xr=[Vr[0]*o.aj,Vr[1]*o.aj,Lr.max];o.ad(Xr,Xr,ur),Jt=(1-Xr[1])*this.height*.5<ot}return pr<ze||Jt}))}return Ye.sort(((ze,ot)=>ze.distanceSq-ot.distanceSq)).map((ze=>ze.tileID))}resize(n,l){this.width=n,this.height=l,this.pixelsToGLUnits=[2/n,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const l=o.ay(n.lat,-o.cG,o.cG),d=this.projection.project(n.lng,l);return new o.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.cb(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,l){let d,y;const x=this.centerPoint;if(this.projection.name==="globe"){const A=this.worldSize;d=(l.x-x.x)/A,y=(l.y-x.y)/A}else{const A=this.pointCoordinate(l),C=this.pointCoordinate(x);d=A.x-C.x,y=A.y-C.y}const S=this.locationCoordinate(n);this.setLocation(new o.ac(S.x-d,S.y-y))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n,l){return this.projection.locationPoint(this,n,l)}locationPoint3D(n,l){return this.projection.locationPoint(this,n,l,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n,l){return this.coordinateLocation(this.pointCoordinate3D(n,l))}locationCoordinate(n,l){const d=l?o.cb(l,n.lat):void 0,y=this.projection.project(n.lng,n.lat);return new o.ac(y.x,y.y,d)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,l){const d=l??this._centerAltitude,y=[n.x,n.y,0,1],x=[n.x,n.y,1,1];o.aA(y,y,this.pixelMatrixInverse),o.aA(x,x,this.pixelMatrixInverse);const S=x[3];o.cH(y,y,1/y[3]),o.cH(x,x,1/S);const A=y[2],C=x[2];return{p0:y,p1:x,t:A===C?0:(d-A)/(C-A)}}screenPointToMercatorRay(n){const l=[n.x,n.y,0,1],d=[n.x,n.y,1,1];return o.aA(l,l,this.pixelMatrixInverse),o.aA(d,d,this.pixelMatrixInverse),o.cH(l,l,1/l[3]),o.cH(d,d,1/d[3]),l[2]=o.cb(l[2],this._center.lat)*this.worldSize,d[2]=o.cb(d[2],this._center.lat)*this.worldSize,o.cH(l,l,1/this.worldSize),o.cH(d,d,1/this.worldSize),new o.av([l[0],l[1],l[2]],o.au([],o.at([],d,l)))}rayIntersectionCoordinate(n){const{p0:l,p1:d,t:y}=n,x=o.cb(l[2],this._center.lat),S=o.cb(d[2],this._center.lat);return new o.ac(o.ai(l[0],d[0],y)/this.worldSize,o.ai(l[1],d[1],y)/this.worldSize,o.ai(x,S,y))}pointCoordinate(n,l=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,l)}pointCoordinate3D(n,l){if(!this.elevation)return this.pointCoordinate(n,l);let d=this.projection.pointCoordinate3D(this,n.x,n.y);if(d)return new o.ac(d[0],d[1],d[2]);let y=0,x=this.horizonLineFromTop();if(n.y>x)return this.pointCoordinate(n,l);const S=.02*x,A=n.clone();for(let C=0;C<10&&x-y>S;C++){A.y=o.ai(y,x,.66);const k=this.projection.pointCoordinate3D(this,A.x,A.y);k?(x=A.y,d=k):y=A.y}return d?new o.ac(d[0],d[1],d[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=o.cI)return!this.isPointAboveHorizon(n);const l=this.pointCoordinate(n);return l.y>=0&&l.y<=1}_coordinatePoint(n,l){const d=l&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,y=[n.x*this.worldSize,n.y*this.worldSize,d+n.toAltitude(),1];return o.aA(y,y,this.pixelMatrix),y[3]>0?new o.P(y[0]/y[3],y[1]/y[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:l}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,x=this.pointLocation3D(new o.P(l,n)),S=this.pointLocation3D(new o.P(y,n)),A=this.pointLocation3D(new o.P(y,d)),C=this.pointLocation3D(new o.P(l,d));let k=Math.min(x.lng,S.lng,A.lng,C.lng),z=Math.max(x.lng,S.lng,A.lng,C.lng),V=Math.min(x.lat,S.lat,A.lat,C.lat),j=Math.max(x.lat,S.lat,A.lat,C.lat);const q=Math.pow(2,-this.zoom)/16*270,Q=this.projection.name==="globe"?1:4,Y=(re,te,ce,me,ye)=>{const Ee=(re+ce)/2,Ce=(te+me)/2,Re=new o.P(Ee,Ce),{lng:Ae,lat:Pe}=this.pointLocation3D(Re),Ie=Math.max(0,k-Ae,V-Pe,Ae-z,Pe-j);k=Math.min(k,Ae),z=Math.max(z,Ae),V=Math.min(V,Pe),j=Math.max(j,Pe),(ye<Q||Ie>q)&&(Y(re,te,Ee,Ce,ye+1),Y(Ee,Ce,ce,me,ye+1))};if(Y(l,n,y,n,1),Y(y,n,y,d,1),Y(y,d,l,d,1),Y(l,d,l,n,1),this.projection.name==="globe"){const[re,te]=o.cJ(this);re?(j=90,z=180,k=-180):te&&(V=-90,z=180,k=-180)}return new o.aG(new o.ci(k,V),new o.ci(z,j))}_getBoundsRectangular(n,l){const{top:d,left:y}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,A=new o.P(y,d),C=new o.P(S,d),k=new o.P(S,x),z=new o.P(y,x);let V=this.pointCoordinate(A,n),j=this.pointCoordinate(C,n);const q=this.pointCoordinate(k,l),Q=this.pointCoordinate(z,l),Y=(re,te)=>(te.y-re.y)/(te.x-re.x);return V.y>1&&j.y>=0?V=new o.ac((1-Q.y)/Y(Q,V)+Q.x,1):V.y<0&&j.y<=1&&(V=new o.ac(-Q.y/Y(Q,V)+Q.x,0)),j.y>1&&V.y>=0?j=new o.ac((1-q.y)/Y(q,j)+q.x,1):j.y<0&&V.y<=1&&(j=new o.ac(-q.y/Y(q,j)+q.x,0)),new o.aG().extend(this.coordinateLocation(V)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(Q)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=n.visibleDemTiles.reduce(((d,y)=>{if(y.dem){const x=y.dem.tree;d.min=Math.min(d.min,x.minimums[0]),d.max=Math.max(d.max,x.maximums[0])}return d}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*n.exaggeration(),l.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-l*(1-this._horizonShift);return n?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-o.cG,this.maxLat=o.cG,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aD(this.minLng)*this.tileSize,this.worldMaxX=o.aD(this.maxLng)*this.tileSize,this.worldMinY=o.aH(this.maxLat)*this.tileSize,this.worldMaxY=o.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,l){return this.projection.createTileMatrix(this,l,n)}calculateDistanceTileData(n){const l=n.key,d=this._distanceTileDataCache;if(d[l])return d[l];const y=n.canonical,x=1/this.height,S=this.cameraWorldSize,A=S/this.zoomScale(y.z),C=(y.x+Math.pow(2,y.z)*n.wrap)*A,k=y.y*A,z=this.point;z.x*=S/this.worldSize,z.y*=S/this.worldSize;const V=this.angle,j=Math.sin(-V),q=-Math.cos(-V);return d[l]={bearing:[j,q],center:[(z.x-C)*x,(z.y-k)*x],scale:A/o.aj*x},d[l]}calculateFogTileMatrix(n){const l=n.key,d=this._fogTileMatrixCache;if(d[l])return d[l];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return o.az(y,this.worldToFogMatrix,y),d[l]=new Float32Array(y),d[l]}calculateProjMatrix(n,l=!1,d=!1){const y=n.key;let x;if(x=d?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,x[y])return x[y];const S=this.calculatePosMatrix(n,this.worldSize);let A;return A=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,o.az(S,A,S),x[y]=new Float32Array(S),x[y]}calculatePixelsToTileUnitsMatrix(n){const l=n.tileID.key,d=this._pixelsToTileUnitsCache;if(d[l])return d[l];const y=o.cK(n,this);return d[l]=y,d[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,l=o.bn([],[n,n,n]);return o.az(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const l=o.cb(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(l),y=this._camera.forward(),x=o.cb(1,this._center.lat);d[2]/=x,y[2]/=x,o.au(y,y);const S=n.raycast(d,y,n.exaggeration());if(S){const A=o.bE([],d,y,S),C=new o.ac(A[0],A[1],o.cb(A[2],o.aY(A[1]))),k=(C.z+o.ae([C.x-d[0],C.y-d[1],C.z-d[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const l=this._elevation,d=o.cb(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),x=l.getAtPointOrZero(new o.ac(...y)),S=this.pixelsPerMeter/this.worldSize*x,A=this._minimumHeightOverTerrain(),C=y[2]-S;if(C<=A)if(C<0||n){const k=this.locationCoordinate(this._center,this._centerAltitude),z=[y[0],y[1],k.z-y[2]],V=o.ae(z);z[2]-=(A-C)/this._pixelsPerMercatorPixel;const j=o.ae(z);if(j===0)return;o.c1(z,z,V/j*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],k.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const j=this.center;return j.lat=o.ay(j.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(j.lng=o.ay(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const l=this._unmodified,{x:d,y}=this.point;let x=0,S=d,A=y;const C=this.width/2,k=this.height/2,z=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(y-k<z&&(A=z+k),y+k>V&&(A=V-k),V-z<this.height&&(x=Math.max(x,this.height/(V-z)),A=(V+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,Q=this.worldSize/2-(j+q)/2;S=(d+Q+this.worldSize)%this.worldSize-Q,S-C<j&&(S=j+C),S+C>q&&(S=q-C),q-j<this.width&&(x=Math.max(x,this.width/(q-j)),S=(q+j)/2)}S===d&&A===y||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(S,A))),x&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,l=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.cb(1,this.center.lat)/o.cb(1,o.c$));const y=o.cL(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?d:1,S=this._camera.getWorldToCamera(this.worldSize,x);let A;const C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-n.x/this.width,C[9]=2*n.y/this.height,this.isOrthographic){let Pe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ie=Pe*this.aspect,Ye=-Ie,Be=-Pe;Ie-=n.x,Ye-=n.x,Pe+=n.y,Be+=n.y,A=this._camera.getCameraToClipOrthographic(Ye,Ie,Be,Pe,this._nearZ,this._farZ),((dt,rt,xt,It)=>{for(let We=0;We<16;We++)dt[We]=o.ai(rt[We],xt[We],It)})(A,A,C,o.cZ(this.pitch>=bo?1:this.pitch/bo))}else A=C;const k=o.cM([],C,S);let z=o.cM([],A,S);if(this.projection.isReprojectedInTileSpace){const Pe=this.locationCoordinate(this.center),Ie=o.bx([]);o.bo(Ie,Ie,[Pe.x*this.worldSize,Pe.y*this.worldSize,0]),o.az(Ie,Ie,o.cN(this)),o.bo(Ie,Ie,[-Pe.x*this.worldSize,-Pe.y*this.worldSize,0]),o.az(z,z,Ie),o.az(k,k,Ie),this.inverseAdjustmentMatrix=o.cO(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cP([],z,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=z,this.invProjMatrix=o.bi(new Float64Array(16),this.projMatrix),l){const Pe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Pe[8]=2*-n.x/this.width,Pe[9]=2*n.y/this.height,this.expandedFarZProjMatrix=o.cM([],Pe,S)}else this.expandedFarZProjMatrix=this.projMatrix;const V=o.bi([],A);this.frustumCorners=o.cQ.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);const j=new Float32Array(16);o.bx(j),o.cP(j,j,[1,-1,1]),o.cR(j,j,this._pitch),o.by(j,j,this.angle);const q=o.c9(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bw(q);const Q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-n.x/this.width,q[9]=2*(n.y+Q)/this.height,this.skyboxMatrix=o.az(j,q,j);const Y=this.point,re=Y.x,te=Y.y,ce=this.width%2/2,me=this.height%2/2,ye=Math.cos(this.angle),Ee=Math.sin(this.angle),Ce=re-Math.round(re)+ye*ce+Ee*me,Re=te-Math.round(te)+ye*me+Ee*ce,Ae=new Float64Array(z);if(o.bo(Ae,Ae,[Ce>.5?Ce-1:Ce,Re>.5?Re-1:Re,0]),this.alignedProjMatrix=Ae,z=o.bz(),o.cP(z,z,[this.width/2,-this.height/2,1]),o.bo(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=o.bz(),o.cP(z,z,[1,-1,1]),o.bo(z,z,[-1,-1,0]),o.cP(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=o.az(new Float64Array(16),this.labelPlaneMatrix,k),this._calcFogMatrices(),this._distanceTileDataCache={},z=o.bi(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cS(this);const Pe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.ad(Pe,Pe,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,d=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,x=[n,n,l];o.c1(x,x,y),o.c1(d,d,-1),o.cT(d,d,x);const S=o.bz();o.bo(S,S,d),o.cP(S,S,x),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,l,y)}_computeCameraPosition(n){const l=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),y=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-n/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-d[0]*x,y.y/this.worldSize-d[1]*x,n/this.worldSize*this._centerAltitude-d[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],y=n[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(x=Math.min((l-d)/y,1)),this._camera.position=o.bE([],this._camera.position,n,x),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,l=this._camera.forward(),{pitch:d,bearing:y}=this._camera.getPitchBearing(),x=o.cb(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.al(this._maxPitch)),A=Math.max((n[2]-x)/Math.cos(d),S),C=this._zoomFromMercatorZ(A);o.bE(n,n,l,A),this._pitch=o.ay(d,o.al(this.minPitch),o.al(this.maxPitch)),this.angle=o.bQ(y,-Math.PI,Math.PI),this._setZoom(o.ay(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ac(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,n)*this.tileSize))}zoomFromMercatorZAdjusted(n){let l=0,d=o.cI,y=0,x=1/0;for(;d-l>1e-6&&d>l;){const S=l+.5*(d-l),A=this.tileSize*Math.pow(2,S),C=this.getCameraToCenterDistance(this.projection,S,A),k=this.scaleZoom(C/(Math.max(0,n)*this.tileSize)),z=Math.abs(S-k);z<x&&(x=z,y=S),S<k?l=S:d=S}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,l){const d=Math.min(n.x,l.x),y=Math.max(n.x,l.x),x=Math.min(n.y,l.y),S=Math.max(n.y,l.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const A=[new o.P(d,x),new o.P(y,S),new o.P(d,S),new o.P(y,x)],C=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const z of A){const V=this.pointRayIntersection(z);if(V.t<0)return!0;const j=this.rayIntersectionCoordinate(V);if(j.x<C||j.y<0||j.x>k||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cU(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(n,l){const d=o.ae(o.at([],this._camera.position,n)),y=this._zoomFromMercatorZ(d)+l;return d-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const n=(function([l,d,y],x){const S=[l,d,y,1];o.aA(S,S,x);const A=S[3]=Math.max(S[3],1e-6);return S[0]/=A,S[1]/=A,S[2]/=A,S})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,n))}}getCameraToCenterDistance(n,l=this.zoom,d=this.worldSize){const y=o.cL(n,l,this.width,this.height,1024),x=n.pixelSpaceConversion(this.center.lat,d,y);let S=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(S=o.ai(1,S,o.cZ(this.pitch>=bo?1:this.pitch/bo))),S}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.az(n,n,this.globeMatrix),n}getFrustum(n){return o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}const $a=(f,n)=>{if(n>0&&f.terrain&&o.w("Cutoff is currently disabled on terrain"),n<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const l=f.transform,d=Math.max(Math.abs(l._zoom-(f.minCutoffZoom-1)),1),y=l.isLODDisabled(!1)?o.af(60,45,l.pitch):o.af(30,15,l.pitch),x=l._farZ-l._nearZ,S=n*l.height,A=((1-(C=y))*l.cameraToCenterDistance+C*(l._farZ+S))*d;var C;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(A-l._nearZ)/x,(A-S-l._nearZ)/x]}}},wo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class hf{constructor(n,l){this.aabb=n,this.lastCascade=l}}class Td{add(n,l){const d=this.receivers[n.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],l.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],l.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],l.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],l.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],l.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],l.max[2])):this.receivers[n.key]=new hf(l,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,l,d){const y=o.d6.fromPoints(n.points);let x=0;for(const S in this.receivers){const A=this.receivers[S];if(!A||!y.intersectsAabb(A.aabb))continue;A.aabb.min=y.closestPoint(A.aabb.min),A.aabb.max=y.closestPoint(A.aabb.max);const C=A.aabb.getCorners();for(let k=0;k<d.length;k++){let z=!0;for(const V of C){const j=[V[0]*l,V[1]*l,V[2]];if(o.ad(j,j,d[k].matrix),j[0]<-1||j[0]>1||j[1]<-1||j[1]>1){z=!1;break}}if(A.lastCascade=k,x=Math.max(x,k),z)break}}return x+1}}class C_{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Td,this._depthMode=new er(n.context.gl.LEQUAL,er.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,n.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),n.tp.registerParameter(wo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(wo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),n.tp.registerParameter(wo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),n.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,l){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;const y=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||y<=0||(this._shadowLayerCount=d.style.order.reduce(((Q,Y)=>{const re=d.style._mergedLayers[Y];return Q+(re.hasShadowPass()&&!re.isHidden(n.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const x=d.context,S=wo.shadowMapResolution,A=wo.shadowMapResolution;if(this._cascades.length===0||wo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Q=0;Q<wo.cascadeCount;++Q){const Y=d._shadowMapDebug,re=x.gl,te=x.createFramebuffer(S,A,Y,"texture"),ce=new o.T(x,{width:S,height:A,data:null},re.DEPTH_COMPONENT16);if(te.depthAttachment.set(ce.texture),Y){const me=new o.T(x,{width:S,height:A,data:null},re.RGBA8);te.colorAttachment.set(me.texture)}this._cascades.push({framebuffer:te,texture:ce,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cy,scale:0})}}this.shadowDirection=xc(l);let C=0;if(n.elevation){const Q=n.elevation,Y=[1e4,-1e4];Q.visibleDemTiles.filter((re=>re.dem)).forEach((re=>{const te=re.dem.tree;Y[0]=Math.min(Y[0],te.minimums[0]),Y[1]=Math.max(Y[1],te.maximums[0])})),Y[0]!==1e4&&(C=(Y[1]-Y[0])*Q.exaggeration())}const k=1.5*n.cameraToCenterDistance,z=3*k,V=new Float64Array(16);for(let Q=0;Q<this._cascades.length;++Q){const Y=this._cascades[Q];let re=n.height/50,te=1;wo.cascadeCount===1?te=z:Q===0?te=k:(re=k,te=z);const[ce,me]=fu(n,this.shadowDirection,re,te,wo.shadowMapResolution,C);Y.scale=n.scale,Y.matrix=ce,Y.boundingSphereRadius=me,o.bi(V,Y.matrix),Y.frustum=o.cy.fromInvProjectionMatrix(V,1,0,!0),Y.far=te}const j=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[j].far,this._cascades[j].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/wo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=wo.shadowMapResolution,this._uniformValues.u_shadowmap_0=fa.ShadowMap0,this._uniformValues.u_shadowmap_1=fa.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=d.transform.elevation;for(const Q of this._groundShadowTiles){let Y={min:0,max:0};if(q){const re=q.getMinMaxForTile(Q);re&&(Y=re)}this.addShadowReceiver(Q.toUnwrapped(),Y.min,Y.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(n){this._enabled=n}drawShadowPass(n,l){if(!this.enabled)return;const d=this.painter,y=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),y.viewport.set([0,0,wo.shadowMapResolution,wo.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){d.currentShadowCascade=x,y.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),y.clear({color:o.am.white,depth:1});for(const S of n.order){const A=n._mergedLayers[S];if(!A.hasShadowPass()||A.isHidden(d.transform.zoom))continue;const C=n.getLayerSourceCache(A),k=C?l[C.id]:void 0;(A.type==="model"||k&&k.length)&&d.renderLayer(d,C,A,k)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const n=this.painter,l=n.style,d=n.context,y=d.gl,x=l.directionalLight,S=l.ambientLight;if(!x||!S)return;const A=[],C=$a(n,n.longestCutoffRange);C.shouldRenderCutoff&&A.push("RENDER_CUTOFF"),A.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&A.push("NORMAL_OFFSET");const k=Ll(l,x,S),z=new er(y.LEQUAL,er.ReadOnly,n.depthRangeFor3D),V=new Ir({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const j of this._groundShadowTiles){const q=j.toUnwrapped(),Q=n.isTileAffectedByFog(j),Y=n.getOrCreateProgram("groundShadow",{defines:A,overrideFog:Q});this.setupShadows(q,Y),n.uploadCommonUniforms(d,Y,q,null,C);const re={u_matrix:n.transform.calculateProjMatrix(q),u_ground_shadow_factor:k};Y.draw(n,y.TRIANGLES,z,V,Wr.multiply,Er.disabled,re,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,null,n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Wr.unblended:Wr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){const l=this.painter.transform,d=l.calculatePosMatrix(n,l.worldSize);return o.az(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(n){return o.az(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,l,d){if(!this.enabled)return;const y=this.painter.transform,x=this.painter.context,S=x.gl,A=this._uniformValues,C=new Float64Array(16),k=y.calculatePosMatrix(n,y.worldSize);for(let z=0;z<this._cascades.length;z++)o.az(C,this._cascades[z].matrix,k),A[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),x.activeTexture.set(S.TEXTURE0+fa.ShadowMap0+z),this._cascades[z].texture.bindExtraParam(S.LINEAR,S.LINEAR,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE,S.GREATER);if(this.useNormalOffset=!!d,this.useNormalOffset){const z=o.d4(n.canonical),V=2/y.tileSize*o.aj/wo.shadowMapResolution,j=V*this._cascades[0].boundingSphereRadius,q=V*this._cascades[this._cascades.length-1].boundingSphereRadius,Q=(d==="vector-tile"?1:3)*(function(Y,re,te,ce,me){const ye=o.ay((Y-22)/-22,0,1);return .125*(1-ye)+4*ye})(y.zoom);A.u_shadow_normal_offset=[z,j*Q,q*Q],A.u_shadow_bias=[1e-4,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(x,A)}setupShadowsFromMatrix(n,l,d=!1){if(!this.enabled)return;const y=this.painter.context,x=y.gl,S=this._uniformValues,A=new Float64Array(16);for(let C=0;C<wo.cascadeCount;C++)o.az(A,this._cascades[C].matrix,n),S[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),y.activeTexture.set(x.TEXTURE0+fa.ShadowMap0+C),this._cascades[C].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=d,d){const C=wo.normalOffset;S.u_shadow_normal_offset=[1,C,C],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(y,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,l,d,y){if(y[2]>=0)return{};const x=(function(C,k,z){const V=z/(1<<C.canonical.z);return new o.d6([C.canonical.x*V+C.wrap*z,C.canonical.y*V+C.wrap*z,0],[(C.canonical.x+1)*V+C.wrap*z,(C.canonical.y+1)*V+C.wrap*z,k])})(n,l,d).getCorners(),S=l/-y[2];y[0]<0?(o.d5(x[0],x[0],[y[0]*S,0,0]),o.d5(x[3],x[3],[y[0]*S,0,0])):y[0]>0&&(o.d5(x[1],x[1],[y[0]*S,0,0]),o.d5(x[2],x[2],[y[0]*S,0,0])),y[1]<0?(o.d5(x[0],x[0],[0,y[1]*S,0]),o.d5(x[1],x[1],[0,y[1]*S,0])):y[1]>0&&(o.d5(x[2],x[2],[0,y[1]*S,0]),o.d5(x[3],x[3],[0,y[1]*S,0]));const A={};return A.vertices=x,A.planes=[kl(x[1],x[0],x[4]),kl(x[2],x[1],x[5]),kl(x[3],x[2],x[6]),kl(x[0],x[3],x[7])],A}addShadowReceiver(n,l,d){this._receivers.add(n,o.d6.fromTileIdAndHeight(n,l,d))}getMaxCascadeForTile(n){const l=this._receivers.get(n);return l&&l.lastCascade?l.lastCascade:0}}function kl(f,n,l){const d=o.at([],l,n),y=o.at([],f,n),x=o.bF([],d,y),S=o.ae(x);return S===0?[0,0,1,0]:(o.c1(x,x,1/S),[x[0],x[1],x[2],-o.bG(x,n)])}function xc(f){const n=f.properties.get("direction"),l=o.d1(n.x,n.y,n.z);l[2]=o.ay(l[2],0,75);const d=o.d3([l[0],l[1],l[2]]);return o.d2(d.x,d.y,d.z)}function Ll(f,n,l){const d=n.properties.get("color-use-theme")==="none",y=n.properties.get("color"),x=n.properties.get("intensity"),S=n.properties.get("direction"),A=[S.x,S.y,S.z],C=l.properties.get("color-use-theme")==="none",k=l.properties.get("color"),z=l.properties.get("intensity"),V=Math.max(o.bG([0,0,1],A),0),j=[0,0,0];o.c1(j,k.toPremultipliedRenderColor(C?null:f.getLut(n.scope)).toArray01Linear().slice(0,3),z);const q=[0,0,0];return o.c1(q,y.toPremultipliedRenderColor(d?null:f.getLut(l.scope)).toArray01Linear().slice(0,3),V*x),o.d8([j[0]>0?j[0]/(j[0]+q[0]):0,j[1]>0?j[1]/(j[1]+q[1]):0,j[2]>0?j[2]/(j[2]+q[2]):0])}function fu(f,n,l,d,y,x){const S=f.zoom,A=f.scale,C=f.worldSize,k=1/C,z=f.aspect,V=Math.sqrt(1+z*z)*Math.tan(.5*f.fovX),j=V*V,q=d-l,Q=d+l;let Y,re;j>q/Q?(Y=d,re=d*V):(Y=.5*Q*(1+j),re=.5*Math.sqrt(q*q+2*(d*d+l*l)*j+Q*Q*j*j));const te=f.projection.pixelsPerMeter(f.center.lat,C),ce=f._camera.getCameraToWorldMercator(),me=[0,0,-Y*k];o.ad(me,me,ce);let ye=re*k;const Ee=f._edgeInsets;if(!(Ee.left===0&&Ee.top===0&&Ee.right===0&&Ee.bottom===0||Ee.left===Ee.right&&Ee.top===Ee.bottom)){const At=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?te:1),Pt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,l,d);Pt[8]=2*-f.centerOffset.x/f.width,Pt[9]=2*f.centerOffset.y/f.height;const Dt=new Float64Array(16);o.cM(Dt,Pt,At);const Bt=new Float64Array(16);o.bi(Bt,Dt);const cr=o.cy.fromInvProjectionMatrix(Bt,C,S,!0);for(const pr of cr.points){const Jt=((Ce=pr)[0]/=A,Ce[1]/=A,Ce[2]=o.cb(Ce[2],f._center.lat),Ce);ye=Math.max(ye,o.c2(o.d7([],me,Jt)))}}var Ce;ye*=y/(y-1);const Re=Math.acos(n[2]),Ae=Math.atan2(-n[0],-n[1]),Pe=new _s;Pe.position=me,Pe.setPitchBearing(Re,Ae);const Ie=Pe.getWorldToCamera(C,te),Ye=ye*C,Be=Math.min(f._mercatorZfromZoom(17)*C*-2,-2*Ye),dt=Pe.getCameraToClipOrthographic(-Ye,Ye,-Ye,Ye,Be,(Ye+x*te)/n[2]),rt=new Float64Array(16);o.az(rt,dt,Ie);const xt=o.d2(Math.floor(1e6*me[0])/1e6*C,Math.floor(1e6*me[1])/1e6*C,0),It=.5*y,We=[0,0,0];o.ad(We,xt,rt),o.c1(We,We,It);const ze=[Math.floor(We[0]),Math.floor(We[1]),Math.floor(We[2])],ot=[0,0,0];o.at(ot,We,ze),o.c1(ot,ot,-1/It);const tt=new Float64Array(16);return o.bx(tt),o.bo(tt,tt,ot),o.az(rt,tt,rt),[rt,Ye]}class Np extends o.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(n,l){return o.aS(this.requestManager.transformRequest(l,o.R.Model).url).then((d=>{if(!d)return;const y=o.aT(d),x=new o.aU(n,void 0,void 0,y);return x.computeBoundsAndApplyParent(),x})).catch((d=>{if(d&&d.status===404)return null;this.fire(new o.z(new Error(`Could not load model ${n} from ${l}: ${d.message}`)))}))}load(n,l,d={forceReload:!1}){this.models[l]||(this.models[l]={});const y=Object.keys(n),x=[],S=[];for(const A of y){const C=n[A];this.hasURLBeenRequested(C)&&!d.forceReload||(this.modelByURL[C]={modelId:A,scope:l},x.push(this.loadModel(A,C)),S.push(A)),this.models[l][A]||(this.models[l][A]={model:null,numReferences:1})}this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+S.length,Promise.allSettled(x).then((A=>{for(let C=0;C<A.length;C++){const{status:k}=A[C];if(k==="rejected")continue;const{value:z}=A[C];this.models[l][S[C]]||(this.models[l][S[C]]={model:null,numReferences:1}),this.models[l][S[C]].model=z}this.numModelsLoading[l]-=S.length,this.fire(new o.A("data",{dataType:"style"}))})).catch((A=>{this.fire(new o.z(new Error(`Could not load models: ${A.message}`)))}))}isLoaded(){for(const n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,l,d={exactIdMatch:!1}){return!!(d.exactIdMatch?this.getModel(n,l):this.getModelByURL(this.modelUris[l][n]))}getModel(n,l){return this.models[l]||(this.models[l]={}),this.models[l][n]?this.models[l][n].model:void 0}getModelByURL(n){if(!n)return null;const l=this.modelByURL[n];return l?this.models[l.scope][l.modelId].model:null}hasModelBeenAdded(n,l){return this.models[l]&&this.models[l][n]!==void 0}getModelURIs(n){return this.modelUris[n]||{}}addModel(n,l,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const y=this.requestManager.normalizeModelURL(l);if((this.hasModel(n,d,{exactIdMatch:!0})||this.hasModelBeenAdded(n,d))&&this.modelUris[d][n]===y)this.models[d][n].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:x,modelId:S}=this.modelByURL[y];this.models[x][S].numReferences++}else this.modelUris[d][n]=y,this.load({[n]:this.modelUris[d][n]},d)}addModelURLs(n,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const d=this.modelUris[l];for(const y in n)d[y]=this.requestManager.normalizeModelURL(n[y])}reloadModels(n){this.load(this.modelUris[n],n,{forceReload:!0})}addModelsFromBucket(n,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const d={};for(const y of n)this.hasModel(y,l,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[l][y].numReferences++:this.modelUris[l][y]&&!this.hasURLBeenRequested(y)?d[y]=this.modelUris[l][y]:!this.hasURLBeenRequested(y)&&o.d9(y,!1)&&(this.modelUris[l][y]=this.requestManager.normalizeModelURL(y),d[y]=this.modelUris[l][y]);this.load(d,l)}hasURLBeenRequested(n){return this.modelByURL[n]!==void 0}removeModel(n,l,d=!1,y=!1){if(this.models[l]&&this.models[l][n]&&(this.models[l][n].numReferences--,this.models[l][n].numReferences===0||y)){const x=this.modelUris[l][n];d||delete this.modelUris[l][n],delete this.modelByURL[x];const S=this.models[l][n].model;if(!S)return;delete this.models[l][n],S.destroy()}}destroy(){for(const n of Object.keys(this.models))for(const l of Object.keys(this.models[n])){const d=this.models[n][l].model;delete this.models[n][l],d&&d.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,l){this.models[l]||(this.models[l]={});for(const d in this.models[l])this.models[l][d].model&&this.models[l][d].model.upload(n.context)}}const ff=new o.a7({data:new o.a8(o.a5.colorTheme.data)});class jp{constructor(n){this._scope=n,this._buildingQueryParams={target:{featuresetId:"building-outline",importId:this._scope}},this._floorQueryParams={target:{featuresetId:"floor-outline",importId:this._scope}}}execute(n){const l=this._makeBuildingsQueryArea(n),d=this._makeFloorsQueryArea(n),y=n.queryRenderedFeatures(l,this._buildingQueryParams).filter((A=>A.properties.shape_type==="building")).reduce(((A,C)=>{const k=C.properties.id;return C.properties.shape_type!=="building"||A.some((z=>z.properties.id===k))||A.push(C),A}),[]),x=n.queryRenderedFeatures(d,this._floorQueryParams).filter((A=>A.properties.shape_type==="floor")).reduce(((A,C)=>{const k=C.properties.id;return C.properties.shape_type!=="floor"||A.some((z=>z.properties.id===k))||A.push(C),A}),[]),S=[n.getCenter().lng,n.getCenter().lat];return{floors:x,building:this._findBuildingAtCenter(S,y)||(y.length>0?y[0]:null)}}_makeBuildingsQueryArea(n){const l=n.transform.width,d=n.transform.height,y=Math.min(l,d),x=y*(1/8),S=y*(1/8),A=.5*(l-x),C=.5*(d-S);return[new o.P(A,C),new o.P(A+x,C+S)]}_makeFloorsQueryArea(n){const l=n.transform.width,d=n.transform.height,y=l*(2/3),x=d*(2/3),S=.5*(l-y),A=.5*(d-x);return[new o.P(S,A),new o.P(S+y,A+x)]}_findBuildingAtCenter(n,l){for(const d of l)if(d.geometry.type==="Polygon"&&this._pointInPolygon(n,d.geometry.coordinates[0]))return d;return null}_pointInPolygon(n,l){let d=!1;for(let y=0,x=l.length-1;y<l.length;x=y++){const S=l[y][0],A=l[y][1],C=l[x][1];A>n[1]!=C>n[1]&&n[0]<(l[x][0]-S)*(n[1]-A)/(C-A)+S&&(d=!d)}return d}}class bc{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}setBuildingId(n){this._selectedBuildingId=n}setFloors(n){if(this._floors=n.filter((l=>l.properties.building_id===this._selectedBuildingId)),!this._selectedFloorId||!this._floors.map((l=>l.properties.id)).includes(this._selectedFloorId)){const l=this._floors.map((d=>({id:d.properties.id,level:d.properties.floor_level}))).reduce(((d,y)=>{const x=Math.abs(d.level-1),S=Math.abs(y.level-1);return S<x||S===x&&y.level>d.level?y:d}));this._selectedFloorId=l.id}}setFloorId(n){this._selectedFloorId=n}getSelectedFloorId(){return this._selectedFloorId}getCurrentBuildingFloors(){return this._floors}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}}const M_={"mbx-indoor-level-selected":{default:["literal",[]]}};function Zm(f){return f=f||{},Object.assign(f,M_)}class O_ extends o.E{constructor(n){super(),o.aV(["_onLoad","_onMove"],this),this._map=n,this._floorSelectionState=new bc,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=null,this._floorSelectionState=null}_onLoad(){this._map.style.forEachFragmentStyle((n=>{n.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new o.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=n.scope,this._indoorDataQuery=new jp(this._scope)))})),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<16)return void this._clearIndoorData();const n=this._indoorDataQuery.execute(this._map);n&&n.floors.length!==0?(this._floorSelectionState.getSelectedFloorId()||this._map._addIndoorControl(),this._selectFloors(n)):this._clearIndoorData()}_selectFloors(n){if(n.building)this._floorSelectionState.setBuildingId(n.building.properties.id),this._floorSelectionState.setFloors(n.floors),this._updateUI();else{const l=this._floorSelectionState.getSelectedFloorId();if(l&&n.floors.some((d=>d.properties.id===l)))return;this._clearIndoorData()}}_clearIndoorData(){this._floorSelectionState.reset(),this._map._removeIndoorControl(),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[]])}_updateUI(){const n=this._floorSelectionState.getCurrentBuildingFloors().map((d=>({id:d.properties.id,name:d.properties.name,shortName:d.properties.floor_level,levelOrder:d.properties.floor_level}))),l=this._floorSelectionState.getSelectedFloorId();l?(this._updateIndoorConfig(),this.fire(new o.A("indoorupdate",{selectedFloorId:l,floors:n}))):console.warn("IndoorManager: Selected floor is not set")}_updateIndoorConfig(){const n=this._floorSelectionState.getSelectedFloorId();n?this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[n]]):console.warn("IndoorManager: Selected floor is not set")}selectFloor(n){this._floorSelectionState.setFloorId(n),this._updateIndoorConfig()}}function ys(f){if(!f.metadata||!f.metadata.content_area)return;const n=o.q.devicePixelRatio,{left:l,top:d,width:y,height:x}=f.metadata.content_area,S=l*n,A=d*n;return[S,A,S+y*n,A+x*n]}function uh(f){if(f)return f.map((([n,l])=>[n*o.q.devicePixelRatio,l*o.q.devicePixelRatio]))}class Ed{constructor(n,l,d){this.id=n,this.scope=l,this.sourceCache=d,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(n){this.missingRequests.has(n.name)||this.pendingRequests.has(n.name)||this.pendingRequests.add(n.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const n=new Map;if(!this.sourceCache.loaded())return n;const l=this.sourceCache.getVisibleCoordinates();if(l.length===0)return n;const d=this.sourceCache.getSource();if(!(d instanceof sc))return n;const y=l.map((S=>this.sourceCache.getTile(S))),x=d.getImages(y,Array.from(this.pendingRequests));for(const[S,A]of x)n.set(o.I.from({name:S,iconsetId:this.id}),A),this.pendingRequests.delete(S);for(const S of this.pendingRequests)this.missingRequests.add(S);return this.pendingRequests.clear(),n}}const zl=(f,n)=>we(f,n&&n.filter((l=>l.identifier!=="source.canvas"))),Up=o.aF(bn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Vp=o.aF(bn,["setCenter","setZoom","setBearing","setPitch"]),hh=new Set(["background","sky","slot","custom"]),wc={version:8,layers:[],sources:{}},df={duration:300,delay:0};class na extends o.E{constructor(n,l={}){super(),this.map=n,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=o.h({},df),this._buildingIndex=new eh(this),this.crossTileSymbolIndex=new Ia,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new ui,this.dispatcher=l.dispatcher?l.dispatcher:new o.D(o.db(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new In(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new o.dc(n._requestManager,l.localFontFamily?o.dd.all:l.localIdeographFontFamily?o.dd.ideographs:o.dd.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new Np(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:l.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",o.de());const d=this;this._rtlTextPluginCallback=na.registerForPluginStateChange((y=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},((x,S)=>{if(o.df(x),S&&S.every((A=>A)))for(const A in d._sourceCaches){const C=d._sourceCaches[A],k=C.getSource().type;k!=="vector"&&k!=="geojson"||C.reload()}}))})),this.on("data",(y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const x=this.getOwnSource(y.sourceId);if(x&&x.vectorLayerIds)for(const S in this._layers){const A=this._layers[S];A.source===x.id&&this._validateLayer(A)}}))}load(n){return n?(typeof n=="string"?this.loadURL(n):this.loadJSON(n),this):this}_getGlobalId(n){if(!n)return null;if(typeof n=="string"){if(o.j(n))return n;const l=o.dg(n);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${o.dh(JSON.stringify(n))}`}_diffStyle(n,l,d){this.globalId=this._getGlobalId(n);const y=(x,S)=>{try{S(null,this.setState(x,d))}catch(A){S(A,!1)}};if(typeof n=="string"){const x=this.map._requestManager.normalizeStyleURL(n),S=this.map._requestManager.transformRequest(x,o.R.Style);o.n(S,((A,C)=>{A?this.fire(new o.z(A)):C&&y(C,l)}))}else typeof n=="object"&&y(n,l)}loadURL(n,l={}){this.fire(new o.A("dataloading",{dataType:"style"}));const d=typeof l.validate=="boolean"?l.validate:!o.j(n);this.globalId=this._getGlobalId(n),n=this.map._requestManager.normalizeStyleURL(n,l.accessToken),this.resolvedImports.add(n);const y=this.importsCache.get(n);if(y)return this._load(y,d);const x=this.map._requestManager.transformRequest(n,o.R.Style);this._request=o.n(x,((S,A)=>{if(this._request=null,S)this.fire(new o.z(S));else if(A)return this.importsCache.set(n,A),this._load(A,d)}))}loadJSON(n,l={}){this.fire(new o.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(n),this._request=o.q.frame((()=>{this._request=null,this._load(n,l.validate!==!1)}))}loadEmpty(){this.fire(new o.A("dataloading",{dataType:"style"})),this._load(wc,!1)}_loadImports(n,l,d){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const x of n){const S=this._createFragmentStyle(x),A=new Promise((z=>{S.once("style.import.load",z),S.once("error",z)})).then((()=>this.mergeAll()));if(y.push(A),this.resolvedImports.has(x.url)){S.loadEmpty();continue}const C=x.data||this.importsCache.get(x.url);C?(S.loadJSON(C,{validate:l}),this._isInternalStyle(C)&&(S.globalId=null)):x.url?S.loadURL(x.url,{validate:l}):S.loadEmpty();const k={style:S,id:x.id,config:x.config};if(d){const z=this.fragments.findIndex((({id:V})=>V===d));this.fragments=this.fragments.slice(0,z).concat(k).concat(this.fragments.slice(z))}else this.fragments.push(k)}return Promise.allSettled(y)}getImportGlobalIds(n=this,l=new Set){for(const d of n.fragments)d.style.globalId&&l.add(d.style.globalId),this.getImportGlobalIds(d.style,l);return[...l.values()]}_createFragmentStyle(n){const l=this.scope?o.C(n.id,this.scope):n.id;let d;const y=this._initialConfig&&this._initialConfig[l];(n.config||y)&&(d=o.h({},n.config,y));const x=new na(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:n["color-theme"],configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(n){return this.isRootStyle()&&(n.fragment||!!n.schema&&n.fragment!==!1)}_load(n,l){const d=n.indoor?Zm(n.schema):n.schema;if(this._isInternalStyle(n)){const S=o.h({},wc,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(S,l)}if(this.updateConfig(this._config,d),l&&zl(this,Go(n)))return;this._loaded=!0,this.stylesheet=o.di(n);const y=()=>{for(const k in n.sources)this.addSource(k,n.sources[k],{validate:!1,isInitialLoad:!0});if(n.iconsets)for(const k in n.iconsets)this.addIconset(k,n.iconsets[k]);n.sprite?this._loadIconset(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&n.glyphs&&this.glyphManager.setURL(n.glyphs);const S=gs(this.stylesheet.layers);if(this._order=S.map((k=>k.id)),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const k=this.stylesheet.lights[0];this.light=new it(k.properties,k.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new it(this.stylesheet.light)),this._layers={};for(const k of S){const z=o.dn(k,this.scope,this._styleColorTheme.lut,this.options);z.configDependencies.size!==0&&this._configDependentLayers.add(z.fqid),z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z;const V=this.getOwnLayerSourceCache(z),j=!!this.directionalLight&&this.directionalLight.shadowsEnabled();V&&z.canCastShadows()&&j&&(V.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const A=this.stylesheet.terrain;A&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(A,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.A("data",{dataType:"style"}));const C=this.isRootStyle();n.imports?this._loadImports(n.imports,l).then((()=>{this._reloadImports(),this.fire(new o.A(C?"style.load":"style.import.load"))})).catch((k=>{this.fire(new o.z(new Error("Failed to load imports",k))),this.fire(new o.A(C?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new o.A(C?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const S=this._evaluateColorThemeData(x);this._loadColorTheme(S).then((()=>{y()})).catch((A=>{o.w(`Couldn't load color theme from the stylesheet: ${A}`),y()}))}else this._styleColorTheme.lut=null,y()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,l,d,y,x,S,A,C,k,z;const V={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((j=>{if(j.stylesheet){if(j.light!=null&&(n=j.light),j.stylesheet.lights)for(const q of j.stylesheet.lights)q.type==="ambient"&&j.ambientLight!=null&&(l=j.ambientLight),q.type==="directional"&&j.directionalLight!=null&&(d=j.directionalLight);y=this._prioritizeTerrain(y,j.terrain,j.stylesheet.terrain),j.stylesheet.fog&&j.fog!=null&&(x=j.fog),j.stylesheet.snow&&j.snow!=null&&(S=j.snow),j.stylesheet.rain&&j.rain!=null&&(A=j.rain),j.stylesheet.camera!=null&&(z=j.stylesheet.camera),j.stylesheet.projection!=null&&(C=j.stylesheet.projection),j.stylesheet.transition!=null&&(k=j.stylesheet.transition),V[j.scope]=j._styleColorTheme}})),this.light=n,this.ambientLight=l,this.directionalLight=d,this.fog=x,this.snow=S,this.rain=A,this._styleColorThemeForScope=V,y===null?delete this.terrain:this.terrain=y,this.camera=z||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=o.h({},df,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){const l=d=>{for(const y of d.fragments)l(y.style);n(d)};l(this)}_prioritizeTerrain(n,l,d){const y=n&&n.drapeRenderMode===0;return d===null?l&&l.drapeRenderMode===0?l:y?n:null:l!=null&&(!n||y||l&&l.drapeRenderMode===1)?l:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((l=>{n=this._prioritizeTerrain(n,l.terrain,l.stylesheet.terrain)})),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle((l=>{l.stylesheet.projection!=null&&(n=l.stylesheet.projection)})),this.projection=n||{name:"mercator"}}mergeSources(){const n={},l={},d={};this.forEachFragmentStyle((y=>{for(const x in y._sourceCaches){const S=o.C(x,y.scope);n[S]=y._sourceCaches[x]}for(const x in y._otherSourceCaches){const S=o.C(x,y.scope);l[S]=y._otherSourceCaches[x]}for(const x in y._symbolSourceCaches){const S=o.C(x,y.scope);d[S]=y._symbolSourceCaches[x]}})),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=d}mergeLayers(){const n={},l=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((x=>{for(const S of x._order){const A=x._layers[S];if(A.type==="slot"){const C=o.dj(S);if(n[C])continue;n[C]=[]}A.slot&&n[A.slot]?n[A.slot].push(A):l.push(A)}})),this._mergedOrder=[];const y=(x=[])=>{for(const S of x)if(S.type==="slot"){const A=o.dj(S.id);n[A]&&y(n[A]),this._mergedSlots.push(A)}else{const A=o.C(S.id,S.scope);this._mergedOrder.push(A),d[A]=S,S.is3D(!!this.terrain)&&(this._has3DLayers=!0),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};y(l),this._mergedOrder.sort(((x,S)=>{const A=d[x],C=d[S];return A.hasInitialOcclusionOpacityProperties?C.is3D(!!this.terrain)?1:0:A.is3D(!!this.terrain)&&C.hasInitialOcclusionOpacityProperties?-1:0})),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=o.h({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(n){return n.data?(function(l,d,y,x){const S=o.h({},d);for(const C of Object.keys(o.a5.colorTheme))S[C]===void 0&&(S[C]=o.a5.colorTheme[C].default);const A=new o.a6(ff,l,new Map(y));return A.setTransitionOrValue(S,y),A.untransitioned().possiblyEvaluate(new o.aa(0,{worldview:void 0}))})(this.scope,n,this.options).get("data"):null}_loadColorTheme(n){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const l=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((d,y)=>{const x="data:image/png;base64,";if(!n||n.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let S=n;S.startsWith(x)||(S=x+S);const A=o.I.from("mapbox-reserved-lut"),C=new Image;C.src=S,C.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},C.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==l)return void d();this._styleColorTheme.lutLoading=!1;const{width:k,height:z,data:V}=o.q.getImageData(C);if(z>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(k!==z*z)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(A)&&this.removeImage(A),this.addImage(A,{data:new o.r({width:k,height:z},V),pixelRatio:1,sdf:!1,usvg:!1,version:0});const j=this.imageManager.getImage(A,this.scope);j?(this._styleColorTheme.lut={image:j.data,data:n},d()):y(new Error("Missing LUT image."))}}))}getLut(n){const l=this._styleColorThemeForScope[n];return l?l.lut:null}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=(function(l,d,y){let x,S,A;const C=o.q.devicePixelRatio>1?"@2x":"";let k=o.n(d.transformRequest(d.normalizeSpriteURL(l,C,".json"),o.R.SpriteJSON),((j,q)=>{k=null,A||(A=j,x=q,V())})),z=o.o(d.transformRequest(d.normalizeSpriteURL(l,C,".png"),o.R.SpriteImage),((j,q)=>{z=null,A||(A=j,S=q,V())}));function V(){if(A)y(A);else if(x&&S){const j=o.q.getImageData(S),q={};for(const Q in x){const{width:Y,height:re,x:te,y:ce,sdf:me,pixelRatio:ye,stretchX:Ee,stretchY:Ce,content:Re}=x[Q],Ae=new o.r({width:Y,height:re});o.r.copy(j,Ae,{x:te,y:ce},{x:0,y:0},{width:Y,height:re},null),q[Q]={data:Ae,pixelRatio:ye,sdf:me,stretchX:Ee,stretchY:Ce,content:Re,usvg:!1}}y(null,q)}}return{cancel(){k&&(k.cancel(),k=null),z&&(z.cancel(),z=null)}}})(n,this.map._requestManager,((l,d)=>{if(this._spriteRequest=null,l)this.fire(new o.z(l));else if(d){const y=new Map;for(const x in d)y.set(o.I.from(x),d[x]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))}))}addIconset(n,l){if(l.type==="sprite")return void this._loadSprite(l.url);const d=this.getOwnSourceCache(l.source);if(!d)return void this.fire(new o.z(new Error(`Source "${l.source}" as specified by iconset "${n}" does not exist and cannot be used as an iconset source`)));const y=d.getSource();if(y.type!=="raster-array")return void this.fire(new o.z(new Error(`Source "${l.source}" as specified by iconset "${n}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const x=new Ed(n,this.scope,d);this.imageManager.addImageProvider(x,this.scope)}removeIconset(n){this.imageManager.removeImageProvider(n,this.scope)}_loadIconset(n){if(!o.j(n)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(n);const l=this.map._spriteFormat==="auto";var d,y;this._spriteRequest=(y=(x,S)=>{if(this._spriteRequest=null,x)l?this._loadSprite(n):this.fire(new o.z(x));else if(S){const A=new Map;for(const C in S)A.set(o.I.from(C),S[C]);this.addImages(A)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))},o.br((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(n),o.R.Iconset),((x,S)=>{if(x)return void y(x);const A={},C=o.da(new o.bq(S));for(const k of C.icons){const z={version:1,pixelRatio:o.q.devicePixelRatio,content:ys(k),stretchX:k.metadata?uh(k.metadata.stretch_x_areas):void 0,stretchY:k.metadata?uh(k.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:k};A[k.name]=z}y(null,A)})))}_validateLayer(n){const l=this.getOwnSource(n.source);if(!l)return;const d=n.sourceLayer;d&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(d)===-1)&&this.fire(new o.z(new Error(`Source layer "${d}" does not exist on source "${l.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((n,l)=>{const d=this.fragments[l];return d&&d.style&&(n.data=d.style.serialize()),n}))}_serializeSources(){const n={};for(const l in this._sourceCaches){const d=this._sourceCaches[l].getSource();n[d.id]||(n[d.id]=d.serialize())}return n}_serializeLayers(n){const l=[];for(const d of n){const y=this._layers[d];y&&y.type!=="custom"&&l.push(y.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(n){return n?this.order:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&n.isDraped(this.getLayerSourceCache(n))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){const l=this.getOwnLayer(n);if(l)return l;this.fire(new o.z(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){const l=this.getOwnSource(n);if(l)return l;this.fire(new o.z(new Error(`The source '${n}' does not exist in the map's style.`)))}precompilePrograms(n,l){const d=this.map.painter;if(d)for(let y=n.minzoom||0;y<(n.maxzoom||25.5);y++){const x=n.getProgramIds();if(x)for(const S of x){const A=n.getDefaultProgramParams(S,l.zoom,this._styleColorTheme.lut);A&&(d.style=this,this.fog&&(d._fogVisible=!0,A.overrideFog=!0,d.getOrCreateProgram(S,A)),d._fogVisible=!1,A.overrideFog=!1,d.getOrCreateProgram(S,A),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(A.overrideRtt=!0,d.getOrCreateProgram(S,A)))}}}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);const l=this.calculateLightsBrightness();n.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l)),n.worldview!==this._worldview&&(this._worldview=n.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const d=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const A=this._changes.getLayerUpdatesByScope();for(const C in A){const{updatedIds:k,removedIds:z}=A[C];(k||z)&&(this._updateWorkerLayers(C,k,z),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this.snow&&this.snow.updateTransitions(n),this.rain&&this.rain.updateTransitions(n),this._changes.reset()}const x={};for(const A in this._mergedSourceCaches){const C=this._mergedSourceCaches[A];x[A]=C.used,C.used=!1,C.tileCoverLift=0}for(const A of this._mergedOrder){const C=this._mergedLayers[A];if(C.recalculate(n,this._availableImages),!C.isHidden(n.zoom)){const k=this.getLayerSourceCache(C);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(C,n)})):this.precompilePrograms(C,n))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const S=this.imageManager.getPendingImageProviders();for(const A of S)A.sourceCache.used=!0;for(const A in x){const C=this._mergedSourceCaches[A];x[A]!==C.used&&C.getSource().fire(new o.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.snow&&this.snow.recalculate(n),this.rain&&this.rain.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),d&&this.fire(new o.A("data",{dataType:"style"}))}updateImageProviders(){const n=this.imageManager.getPendingImageProviders();for(const l of n){const d=l.resolvePendingRequests(),y=this.getFragmentStyle(l.scope);y&&y.addImages(d)}}_updateTilesForChangedImages(){const n={};for(const l in this._mergedSourceCaches){const d=this._mergedSourceCaches[l].getSource().scope;n[d]=n[d]||this._changes.getUpdatedImages(d),n[d].length!==0&&this._mergedSourceCaches[l].reloadTilesForDependencies(["icons","patterns"],n[d])}for(const l in n)this._changes.resetUpdatedImages(l)}_updateWorkerLayers(n,l,d){const y=this.getFragmentStyle(n);y&&this.dispatcher.broadcast("updateLayers",{layers:l?y._serializeLayers(l):[],scope:n,removedIds:d||[],options:y.options})}setState(n,l){if(this._checkLoaded(),zl(this,Go(n)))return!1;(n=o.di(n)).layers=gs(n.layers);const d=(function(S,A){if(!S)return[{command:bn.setStyle,args:[A]}];let C=[];try{if(!o.bv(S.version,A.version))return[{command:bn.setStyle,args:[A]}];if(o.bv(S.center,A.center)||C.push({command:bn.setCenter,args:[A.center]}),o.bv(S.zoom,A.zoom)||C.push({command:bn.setZoom,args:[A.zoom]}),o.bv(S.bearing,A.bearing)||C.push({command:bn.setBearing,args:[A.bearing]}),o.bv(S.pitch,A.pitch)||C.push({command:bn.setPitch,args:[A.pitch]}),o.bv(S.sprite,A.sprite)||C.push({command:bn.setSprite,args:[A.sprite]}),o.bv(S.glyphs,A.glyphs)||C.push({command:bn.setGlyphs,args:[A.glyphs]}),o.bv(S.imports,A.imports)||(function(q=[],Q=[],Y){Q=Q||[];const re=(q=q||[]).map(dc),te=Q.map(dc),ce=q.reduce(pc,{}),me=Q.reduce(pc,{}),ye=re.slice();let Ee,Ce,Re,Ae;for(Ee=0,Ce=0;Ee<re.length;Ee++)Re=re[Ee],me.hasOwnProperty(Re)?Ce++:(Y.push({command:bn.removeImport,args:[Re]}),ye.splice(ye.indexOf(Re,Ce),1));for(Ee=0,Ce=0;Ee<te.length;Ee++)Re=te[te.length-1-Ee],ye[ye.length-1-Ee]!==Re&&(ce.hasOwnProperty(Re)?(Y.push({command:bn.removeImport,args:[Re]}),ye.splice(ye.lastIndexOf(Re,ye.length-Ce),1)):Ce++,Ae=ye[ye.length-Ee],Y.push({command:bn.addImport,args:[me[Re],Ae]}),ye.splice(ye.length-Ee,0,Re));for(const Pe of Q){const Ie=ce[Pe.id];Ie&&(delete Ie.data,o.bv(Ie,Pe)||Y.push({command:bn.updateImport,args:[Pe.id,Pe]}))}})(S.imports,A.imports,C),o.bv(S.transition,A.transition)||C.push({command:bn.setTransition,args:[A.transition]}),o.bv(S.light,A.light)||C.push({command:bn.setLight,args:[A.light]}),o.bv(S.fog,A.fog)||C.push({command:bn.setFog,args:[A.fog]}),o.bv(S.snow,A.snow)||C.push({command:bn.setSnow,args:[A.snow]}),o.bv(S.rain,A.rain)||C.push({command:bn.setRain,args:[A.rain]}),o.bv(S.projection,A.projection)||C.push({command:bn.setProjection,args:[A.projection]}),o.bv(S.lights,A.lights)||C.push({command:bn.setLights,args:[A.lights]}),o.bv(S.camera,A.camera)||C.push({command:bn.setCamera,args:[A.camera]}),o.bv(S.iconsets,A.iconsets)||(function(q,Q,Y){let re;for(re in Q=Q||{},q=q||{})q.hasOwnProperty(re)&&(Q.hasOwnProperty(re)||Y.push({command:bn.removeIconset,args:[re]}));for(re in Q){if(!Q.hasOwnProperty(re))continue;const te=Q[re];q.hasOwnProperty(re)?o.bv(q[re],te)||(Y.push({command:bn.removeIconset,args:[re]}),Y.push({command:bn.addIconset,args:[re,te]})):Y.push({command:bn.addIconset,args:[re,te]})}})(S.iconsets,A.iconsets,C),!o.bv(S["color-theme"],A["color-theme"]))return[{command:bn.setStyle,args:[A]}];const k={},z=[];(function(q,Q,Y,re){let te;for(te in Q=Q||{},q=q||{})q.hasOwnProperty(te)&&(Q.hasOwnProperty(te)||ll(te,Y,re));for(te in Q){if(!Q.hasOwnProperty(te))continue;const ce=Q[te];q.hasOwnProperty(te)?o.bv(q[te],ce)||(q[te].type==="geojson"&&ce.type==="geojson"&&Hm(q,Q,te)?Y.push({command:bn.setGeoJSONSourceData,args:[te,ce.data]}):nf(te,Q,Y,re)):rf(te,Q,Y)}})(S.sources,A.sources,z,k);const V=[];S.layers&&S.layers.forEach((q=>{q.source&&k[q.source]?C.push({command:bn.removeLayer,args:[q.id]}):V.push(q)}));let j=S.terrain;j&&k[j.source]&&(C.push({command:bn.setTerrain,args:[void 0]}),j=void 0),C=C.concat(z),o.bv(j,A.terrain)||C.push({command:bn.setTerrain,args:[A.terrain]}),(function(q,Q,Y){Q=Q||[];const re=(q=q||[]).map(dc),te=Q.map(dc),ce=q.reduce(pc,{}),me=Q.reduce(pc,{}),ye=re.slice(),Ee=Object.create(null);let Ce,Re,Ae,Pe,Ie,Ye,Be;for(Ce=0,Re=0;Ce<re.length;Ce++)Ae=re[Ce],me.hasOwnProperty(Ae)?Re++:(Y.push({command:bn.removeLayer,args:[Ae]}),ye.splice(ye.indexOf(Ae,Re),1));for(Ce=0,Re=0;Ce<te.length;Ce++)Ae=te[te.length-1-Ce],ye[ye.length-1-Ce]!==Ae&&(ce.hasOwnProperty(Ae)?(Y.push({command:bn.removeLayer,args:[Ae]}),ye.splice(ye.lastIndexOf(Ae,ye.length-Re),1)):Re++,Ye=ye[ye.length-Ce],Y.push({command:bn.addLayer,args:[me[Ae],Ye]}),ye.splice(ye.length-Ce,0,Ae),Ee[Ae]=!0);for(Ce=0;Ce<te.length;Ce++)if(Ae=te[Ce],Pe=ce[Ae],Ie=me[Ae],!Ee[Ae]&&!o.bv(Pe,Ie))if(o.bv(Pe.source,Ie.source)&&o.bv(Pe["source-layer"],Ie["source-layer"])&&o.bv(Pe.type,Ie.type)){for(Be in fc(Pe.layout,Ie.layout,Y,Ae,null,bn.setLayoutProperty),fc(Pe.paint,Ie.paint,Y,Ae,null,bn.setPaintProperty),o.bv(Pe.slot,Ie.slot)||Y.push({command:bn.setSlot,args:[Ae,Ie.slot]}),o.bv(Pe.filter,Ie.filter)||Y.push({command:bn.setFilter,args:[Ae,Ie.filter]}),o.bv(Pe.minzoom,Ie.minzoom)&&o.bv(Pe.maxzoom,Ie.maxzoom)||Y.push({command:bn.setLayerZoomRange,args:[Ae,Ie.minzoom,Ie.maxzoom]}),Pe)Pe.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&Be!=="slot"&&(Be.indexOf("paint.")===0?fc(Pe[Be],Ie[Be],Y,Ae,Be.slice(6),bn.setPaintProperty):o.bv(Pe[Be],Ie[Be])||Y.push({command:bn.setLayerProperty,args:[Ae,Be,Ie[Be]]}));for(Be in Ie)Ie.hasOwnProperty(Be)&&!Pe.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&Be!=="slot"&&(Be.indexOf("paint.")===0?fc(Pe[Be],Ie[Be],Y,Ae,Be.slice(6),bn.setPaintProperty):o.bv(Pe[Be],Ie[Be])||Y.push({command:bn.setLayerProperty,args:[Ae,Be,Ie[Be]]}))}else Y.push({command:bn.removeLayer,args:[Ae]}),Ye=ye[ye.lastIndexOf(Ae)+1],Y.push({command:bn.addLayer,args:[Ie,Ye]})})(V,A.layers,C)}catch(k){console.warn("Unable to compute style diff:",k),C=[{command:bn.setStyle,args:[A]}]}return C})(this.serialize(),n).filter((S=>!(S.command in Vp)));if(d.length===0)return!1;const y=d.filter((S=>!(S.command in Up)));if(y.length>0)throw new Error(`Unimplemented: ${y.map((S=>S.command)).join(", ")}.`);const x=[];return d.forEach((S=>{x.push(this[S.command](...S.args))})),l&&Promise.all(x).then(l).catch(l),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(n){if(n.size===0)return this;for(const[l,d]of n.entries()){if(this.getImage(l))return this.fire(new o.z(new Error(`An image with the name "${l.name}" already exists.`)));this.imageManager.addImage(l,this.scope,d),this._changes.updateImage(l,this.scope)}return this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this}addImage(n,l){return this.getImage(n)?this.fire(new o.z(new Error(`An image with the name "${n.name}" already exists.`))):(this.imageManager.addImage(n,this.scope,l),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this)}updateImage(n,l,d=!1){this.imageManager.updateImage(n,this.scope,l),d&&(this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})))}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._changes.updateImage(n,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(n){return this.modelManager.addModelURLs(n,this.scope),this._updateWorkerModels(),this.fire(new o.A("data",{dataType:"style"})),this}addModel(n,l,d={}){return this._checkLoaded(),this._validate(be,`models.${n}`,l,null,d)||(this.modelManager.addModel(n,l,this.scope),this.fire(new o.A("data",{dataType:"style"}))),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope,!1,!0),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,l,d={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(al,`sources.${n}`,l,null,d))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const y=lc(n,l,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id})));const x=S=>{const A=(S?"symbol:":"other:")+y.id,C=o.C(A,this.scope),k=this._sourceCaches[A]=new Ho(C,y,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=k,k.onAdd(this.map)};x(!1),l.type!=="vector"&&l.type!=="geojson"||x(!0),y.onAdd&&y.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();const l=this.getOwnSource(n);if(!l)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===n)return this.fire(new o.z(new Error(`Source "${n}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new o.z(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find((([x,S])=>S.type==="source"&&S.source===n));if(y)return this.fire(new o.z(new Error(`Source "${n}" cannot be removed while iconset "${y[0]}" is using it.`)))}const d=this.getOwnSourceCaches(n);for(const y of d){const x=o.dj(y.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(y.id),y.fire(new o.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,l){this._checkLoaded(),this.getOwnSource(n).setData(l),this._changes.setDirty()}getOwnSource(n){const l=this.getOwnSourceCache(n);return l&&l.getSource()}getOwnSources(){const n=[];for(const l in this._otherSourceCaches){const d=this.getOwnSourceCache(l);d&&n.push(d.getSource())}return n}areTilesLoaded(){const n=this._mergedSourceCaches;for(const l in n){const d=n[l]._tiles;for(const y in d){const x=d[y];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;const l=this._getTransitionParameters();for(const x of n){if(this._validate(eu,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const S=this.ambientLight;S.set(x),S.updateTransitions(l)}else this.ambientLight=new qn(x,fn||(fn=new o.a7({color:new o.a8(o.a5.properties_light_ambient.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const S=this.directionalLight;S.set(x),S.updateTransitions(l)}else this.directionalLight=new qn(x,Fi||(Fi=new o.a7({direction:new o.an(o.a5.properties_light_directional.direction),color:new o.a8(o.a5.properties_light_directional.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_directional.intensity),"cast-shadows":new o.a8(o.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new o.a8(o.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.a8(o.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=Object.assign(l,{worldview:this.map.getWorldview()}),y=new o.aa(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const n=this.directionalLight,l=this.ambientLight;if(!n||!l)return;const d=j=>.2126*(j[0]<=.03928?j[0]/12.92:Math.pow((j[0]+.055)/1.055,2.4))+.7152*(j[1]<=.03928?j[1]/12.92:Math.pow((j[1]+.055)/1.055,2.4))+.0722*(j[2]<=.03928?j[2]/12.92:Math.pow((j[2]+.055)/1.055,2.4)),y=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),x=n.properties.get("intensity"),S=n.properties.get("direction"),A=1-o.d1(S.x,S.y,S.z)[2]/90,C=d(y)*x*A,k=l.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),z=l.properties.get("intensity"),V=d(k)*z;return Number(((C+V)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(n==null||n===""&&this.isRootStyle())return this;if(o.dk(n)){const l=o.dl(n),d=this.fragments.find((({id:x})=>x===l));if(!d)return;const y=o.dj(n);return d.style.getFragmentStyle(y)}{const l=this.fragments.find((({id:d})=>d===n));return l?l.style:void 0}}setFeaturesetSelectors(n){if(!n)return;const l={},d=(y,x="")=>`${y}::${x}`;this._featuresetSelectors={};for(const y in n){const x=this._featuresetSelectors[y]=[];for(const S of n[y].selectors){if(S.featureNamespace){const C=this.getOwnLayer(S.layer);if(!C){o.w(`Layer is undefined for selector: ${S.layer}`);continue}const k=d(C.source,C.sourceLayer);if(k in l&&l[k]!==S.featureNamespace){o.w(`"featureNamespace ${S.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}l[k]=S.featureNamespace}let A;if(S.properties)for(const C in S.properties){const k=o.X(S.properties[C]);k.result==="success"&&(A=A||{},A[C]=k.value)}x.push({layerId:S.layer,namespace:S.featureNamespace,properties:A,uniqueFeatureID:S._uniqueFeatureID})}}}getFeaturesetDescriptors(n){const l=this.getFragmentStyle(n);if(!l||!l.stylesheet.featuresets)return[];const d=[];for(const y in l.stylesheet.featuresets)d.push({featuresetId:y,importId:l.scope?l.scope:void 0});return d}getFeaturesetLayers(n,l){const d=this.getFragmentStyle(l),y=d.stylesheet.featuresets;if(!y||!y[n])return this.fire(new o.z(new Error(`The featureset '${n}' does not exist in the map's style and cannot be queried.`))),[];const x=[];for(const S of y[n].selectors){const A=d.getOwnLayer(S.layer);A&&x.push(A)}return x}getConfigProperty(n,l){const d=this.getFragmentStyle(n);if(!d)return null;const y=o.C(l,d.scope),x=d.options.get(y),S=x?x.value||x.default:null;return S?S.serialize():null}setConfigProperty(n,l,d){const y=this.getFragmentStyle(n);if(!y)return;const x=y.stylesheet.indoor?Zm(y.stylesheet.schema):y.stylesheet.schema;if(!x||!x[l])return;const S=o.X(d);if(S.result!=="success")return void zl(this,S.value);const A=S.value.expression,C=o.C(l,y.scope),k=y.options.get(C);if(!k)return;let z;const{minValue:V,maxValue:j,stepValue:q,type:Q,values:Y}=x[l],re=o.X(x[l].default);re.result==="success"&&(z=re.value.expression),z?(this.options.set(C,Object.assign({},k,{value:A,default:z,minValue:V,maxValue:j,stepValue:q,type:Q,values:Y})),this.updateConfigDependencies(l)):this.fire(new o.z(new Error(`No schema defined for the config option "${l}" in the "${n}" fragment.`)))}getConfig(n){const l=this.getFragmentStyle(n);if(!l)return null;const d=l.stylesheet.schema;if(!d)return null;const y={};for(const x in d){const S=o.C(x,l.scope),A=l.options.get(S),C=A?A.value||A.default:null;y[x]=C?C.serialize():null}return y}setConfig(n,l){const d=this.getFragmentStyle(n);d&&(d.updateConfig(l,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(n){const l=this.getFragmentStyle(n);return l?l.stylesheet.schema:null}setSchema(n,l){const d=this.getFragmentStyle(n);d&&(d.stylesheet.schema=l,d.updateConfig(d._config,l),this.updateConfigDependencies())}updateConfig(n,l){if(this._config=n,n||l)if(l)for(const d in l){let y,x;const S=o.X(l[d].default);if(S.result==="success"&&(y=S.value.expression),n&&n[d]!==void 0){const j=o.X(n[d]);j.result==="success"&&(x=j.value.expression)}const{minValue:A,maxValue:C,stepValue:k,type:z,values:V}=l[d];if(y){const j=o.C(d,this.scope);this.options.set(j,{default:y,value:x,minValue:A,maxValue:C,stepValue:k,type:z,values:V})}else this.fire(new o.z(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new o.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(n){for(const l of this._configDependentLayers){const d=this.getLayer(l);if(d){if(n&&!d.configDependencies.has(n))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((l=>{const d=l._styleColorTheme.colorThemeOverride?l._styleColorTheme.colorThemeOverride:l._styleColorTheme.colorTheme;if(d){const y=l._evaluateColorThemeData(d);(!l._styleColorTheme.lut&&y!==""||l._styleColorTheme.lut&&y!==l._styleColorTheme.lut.data)&&l.setColorTheme(d)}})),this._changes.setDirty()}addLayer(n,l,d={}){this._checkLoaded();const y=n.id;if(this._layers[y])return void this.fire(new o.z(new Error(`Layer with id "${y}" already exists on this map`)));let x;if(n.type==="custom"){if(zl(this,o.dm(n)))return;x=o.dn(n,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof n.source=="object"&&(this.addSource(y,n.source),n=o.di(n),n=o.h(n,{source:y})),this._validate(Cn,`layers.${y}`,n,{arrayIndex:-1},d))return;x=o.dn(n,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}})}x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid);let S=this._order.length;if(l){const z=this._order.indexOf(l);if(z===-1)return void this.fire(new o.z(new Error(`Layer with id "${l}" does not exist on this map.`)));x.slot===this._layers[l].slot?S=z:o.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,y),this._layerOrderChanged=!0,this._layers[y]=x;const A=this.getOwnLayerSourceCache(x),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&x.canCastShadows()&&C&&(A.castsShadows=!0);const k=this._changes.getRemovedLayer(x);if(k&&x.source&&A&&x.type!=="custom"){this._changes.discardLayerRemoval(x);const z=o.C(x.source,x.scope);k.type!==x.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),A.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(n,l){this._checkLoaded();const d=this._checkLayer(n);if(!d||n===l)return;const y=this._order.indexOf(n);this._order.splice(y,1);let x=this._order.length;if(l){const S=this._order.indexOf(l);if(S===-1)return void this.fire(new o.z(new Error(`Layer with id "${l}" does not exist on this map.`)));d.slot===this._layers[l].slot?x=S:o.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();const l=this._checkLayer(n);if(!l)return;l.setEventedParent(null);const d=this._order.indexOf(n);this._order.splice(d,1),delete this._layers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);const y=this.getOwnLayerSourceCache(l);if(y&&y.castsShadows){let x=!1;for(const S in this._layers)if(this._layers[S].source===l.source&&this._layers[S].canCastShadows()){x=!0;break}y.castsShadows=x}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(const l in this._layers)if(this._layers[l].type===n)return!0;return!1}setLayerZoomRange(n,l,d){this._checkLoaded();const y=this._checkLayer(n);y&&(y.minzoom===l&&y.maxzoom===d||(l!=null&&(y.minzoom=l),d!=null&&(y.maxzoom=d),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(n,l){this._checkLoaded();const d=this._checkLayer(n);d&&d.slot!==l&&(d.slot=l,this._updateLayer(d))}setFilter(n,l,d={}){this._checkLoaded();const y=this._checkLayer(n);if(y&&!o.bv(y.filter,l))return l==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(et,`layers.${y.id}.filter`,l,{layerType:y.type},d)||(y.filter=o.di(l),this._updateLayer(y)))}getFilter(n){const l=this._checkLayer(n);if(l)return o.di(l.filter)}setLayoutProperty(n,l,d,y={}){this._checkLoaded();const x=this._checkLayer(n);if(x&&!o.bv(x.getLayoutProperty(l),d)){if(d!=null&&(!y||y.validate!==!1)&&zl(x,se.call(Go,{key:`layers.${n}.layout.${l}`,layerType:x.type,objectKey:l,value:d,styleSpec:o.a5,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(l,d),x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(n,l){const d=this._checkLayer(n);if(d)return d.getLayoutProperty(l)}setPaintProperty(n,l,d,y={}){this._checkLoaded();const x=this._checkLayer(n);if(!x||o.bv(x.getPaintProperty(l),d)||d!=null&&(!y||y.validate!==!1)&&zl(x,oe.call(Go,{key:`layers.${n}.paint.${l}`,layerType:x.type,objectKey:l,value:d,styleSpec:o.a5})))return;const S=x.setPaintProperty(l,d);x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),S&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(n,l){const d=this._checkLayer(n);if(d)return d.getPaintProperty(l)}setFeatureState(n,l){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:C,importId:k}=n.target,z=this.getFragmentStyle(k),V=z.getFeaturesetLayers(C);for(const{source:j,sourceLayer:q}of V)z.setFeatureState({id:n.id,source:j,sourceLayer:q},l)}else if("layerId"in n.target){const{layerId:C}=n.target,k=this.getLayer(C);this.setFeatureState({id:n.id,source:k.source,sourceLayer:k.sourceLayer},l)}return}const d=n.source,y=n.sourceLayer,x=this._checkSource(d);if(!x)return;const S=x.type;if(S==="geojson"&&y)return void this.fire(new o.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!y)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided.")));const A=this.getOwnSourceCaches(d);for(const C of A)C.setFeatureState(y,n.id,l)}removeFeatureState(n,l){if(this._checkLoaded(),"target"in n){if("featuresetId"in n.target){const{featuresetId:C,importId:k}=n.target,z=this.getFragmentStyle(k),V=z.getFeaturesetLayers(C);for(const{source:j,sourceLayer:q}of V)z.removeFeatureState({id:n.id,source:j,sourceLayer:q},l)}else if("layerId"in n.target){const{layerId:C}=n.target,k=this.getLayer(C);this.removeFeatureState({id:n.id,source:k.source,sourceLayer:k.sourceLayer},l)}return}const d=n.source,y=this._checkSource(d);if(!y)return;const x=y.type,S=x==="vector"?n.sourceLayer:void 0;if(x==="vector"&&!S)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new o.z(new Error("A feature id is required to remove its specific state property.")));const A=this.getOwnSourceCaches(d);for(const C of A)C.removeFeatureState(S,n.id,l)}getFeatureState(n){if(this._checkLoaded(),"target"in n){let x;if("featuresetId"in n.target){const{featuresetId:S,importId:A}=n.target,C=this.getFragmentStyle(A),k=C.getFeaturesetLayers(S);for(const{source:z,sourceLayer:V}of k){const j=C.getFeatureState({id:n.id,source:z,sourceLayer:V});if(j&&!x)x=j;else if(!o.bv(x,j))return void this.fire(new o.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in n.target){const{layerId:S}=n.target,A=this.getLayer(S);x=this.getFeatureState({id:n.id,source:A.source,sourceLayer:A.sourceLayer})}return x}const l=n.source,d=n.sourceLayer,y=this._checkSource(l);if(y){if(y.type!=="vector"||d)return n.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(d,n.id);this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=o.h({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return o.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const n=this.getTerrain(),l=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return o.dp({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(d=>d!==void 0))}_updateFilteredLayers(n){for(const l of Object.values(this._mergedLayers))n(l)&&this._updateLayer(l)}_updateLayer(n){this._changes.updateLayer(n);const l=this.getLayerSourceCache(n),d=o.C(n.source,n.scope),y=this._changes.getUpdatedSourceCaches();n.source&&!y[d]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),l.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const l=A=>this._mergedLayers[A].is3D(!!this.terrain),d=this.order,y={},x=[];for(let A=d.length-1;A>=0;A--){const C=d[A];if(l(C)){y[C]=A;for(const k of n){const z=k[C];if(z)for(const V of z)x.push(V)}}}x.sort(((A,C)=>C.intersectionZ-A.intersectionZ));const S=[];for(let A=d.length-1;A>=0;A--){const C=d[A];if(l(C))for(let k=x.length-1;k>=0;k--){const z=x[k].feature;if(z.layer&&y[z.layer.id]<A)break;S.push(z),x.pop()}else for(const k of n){const z=k[C];if(z)for(const V of z)S.push(V.feature)}}return S}queryRenderedFeatures(n,l,d){let y;l&&!Array.isArray(l)&&l.filter&&(this._validate(et,"queryRenderedFeatures.filter",l.filter,null,l),y=o.b3(l.filter));const x={},S=z=>{if(hh.has(z.type))return;const V=this.getOwnLayerSourceCache(z),j=x[V.id]=x[V.id]||{sourceCache:V,layers:{},has3DLayers:!1};z.is3D(!!this.terrain)&&(j.has3DLayers=!0),j.layers[z.fqid]=j.layers[z.fqid]||{styleLayer:z,targets:[]},j.layers[z.fqid].targets.push({filter:y})};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.z(new Error("parameters.layers must be an Array."))),[];for(const z of l.layers){const V=this._layers[z];if(!V)return this.fire(new o.z(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];S(V)}}else for(const z in this._layers)S(this._layers[z]);const A=this._queryRenderedFeatures(n,x,d),C=this._flattenAndSortRenderedFeatures(A),k=[];for(const z of C)o.dq(z.layer.id)===this.scope&&k.push(z);return k}queryRenderedFeatureset(n,l,d){let y;l&&!Array.isArray(l)&&l.filter&&(this._validate(et,"queryRenderedFeatures.filter",l.filter,null,l),y=o.b3(l.filter));const x="mock",S=[];if(l&&l.target)S.push(Object.assign({},l,{targetId:x,filter:y}));else{const z=this.getFeaturesetDescriptors();for(const V of z)S.push({targetId:x,filter:y,target:V});for(const{style:V}of this.fragments){const j=V.getFeaturesetDescriptors();for(const q of j)S.push({targetId:x,filter:y,target:q})}}const A=this.queryRenderedTargets(n,S,d),C=[],k=new Set;for(const z of A)for(const V of z.variants[x])uc(V,z,k)||C.push(new o.dr(z,V));return C}queryRenderedTargets(n,l,d){const y={},x=(A,C,k,z)=>{const V=y[C.id]=y[C.id]||{sourceCache:C,layers:{},has3DLayers:!1};if(V.layers[A.fqid]=V.layers[A.fqid]||{styleLayer:A,targets:[]},A.is3D(!!this.terrain)&&(V.has3DLayers=!0),!z)return k.uniqueFeatureID=!1,void V.layers[A.fqid].targets.push(k);V.layers[A.fqid].targets.push(Object.assign({},k,{namespace:z.namespace,properties:z.properties,uniqueFeatureID:z.uniqueFeatureID}))};for(const A of l)if("featuresetId"in A.target){const{featuresetId:C,importId:k}=A.target,z=this.getFragmentStyle(k);if(!z||!z._featuresetSelectors)continue;const V=z._featuresetSelectors[C];if(!V){this.fire(new o.z(new Error(`The featureset '${C}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const j of V){const q=z.getOwnLayer(j.layerId);q&&!hh.has(q.type)&&x(q,z.getOwnLayerSourceCache(q),A,j)}}else if("layerId"in A.target){const{layerId:C}=A.target,k=this.getLayer(C);if(!k||hh.has(k.type))continue;x(k,this.getLayerSourceCache(k),A)}const S=this._queryRenderedFeatures(n,y,d);return this._flattenAndSortRenderedFeatures(S)}_queryRenderedFeatures(n,l,d){const y=[],x=!!this.map._showQueryGeometry,S=Dn.createFromScreenPoints(n,d);for(const A in l){const C=ru(S,l[A],this._availableImages,d,x);Object.keys(C).length&&y.push(C)}if(this.placement)for(const A in l){if(!l[A].sourceCache._onlySymbols)continue;const C=nu(S.screenGeometry,l[A],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(C).length&&y.push(C)}return y}querySourceFeatures(n,l){const d=l&&l.filter;d&&this._validate(et,"querySourceFeatures.filter",d,null,l);let y=[];const x=this.getOwnSourceCaches(n);for(const S of x)y=y.concat(ef(S,l));return y}addSourceType(n,l,d){return na.getSourceType(n)?d(new Error(`A source type called "${n}" already exists.`)):(na.setSourceType(n,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:l.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,l,d={}){this._checkLoaded();const y=this.light.getLight();let x=!1;for(const A in n)if(!o.bv(n[A],y[A])){x=!0;break}if(!x)return;const S=this._getTransitionParameters();this.light.setLight(n,l,d),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(n,l=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),l===0&&delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=n;const y=n.source==null;if(l===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){const A="terrain-dem-src";this.addSource(A,d.source),d=o.di(d),d=o.h(d,{source:A})}const x=o.h({},d),S={};if(this.terrain&&y){x.source=this.terrain.get().source;const A=this.terrain?this.getFragmentStyle(this.terrain.scope):null;A&&(S.style=A.serialize())}if(this._validate(kt,"terrain",x,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&l!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,l),this.fire(new o.A("data",{dataType:"style"}))}else{const x=this.terrain,S=x.get();for(const A of Object.keys(o.a5.terrain))!d.hasOwnProperty(A)&&o.a5.terrain[A].default&&(d[A]=o.a5.terrain[A].default);for(const A in n)if(!o.bv(n[A],S[A])){x.set(n,this.options),this.stylesheet.terrain=n;const C=this._getTransitionParameters({duration:0});x.updateTransitions(C),this.fire(new o.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const l=this.fog=new Jr(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}_createSnow(n){const l=this.snow=new $n(n,this.map.transform,this.scope,this.options);this.stylesheet.snow=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}_createRain(n){const l=this.rain=new ro(n,this.map.transform,this.scope,this.options);this.stylesheet.rain=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const n of this.map._markers)n._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog;if(!o.bv(l.get(),n)){l.set(n,this.options),this.stylesheet.fog=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}}else this._createFog(n);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(n){if(this._checkLoaded(),!n)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const l=this.snow;if(!o.bv(l.get(),n)){l.set(n,this.options),this.stylesheet.snow=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}}else this._createSnow(n);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(n){if(this._checkLoaded(),!n)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const l=this.rain;if(!o.bv(l.get(),n)){l.set(n,this.options),this.stylesheet.rain=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}}else this._createRain(n);this._markersNeedUpdate=!0}_reloadColorTheme(){const n=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},l=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!l)return this._styleColorTheme.lut=null,void n();const d=this._evaluateColorThemeData(l);this._loadColorTheme(d).then((()=>{this.fire(new o.A("colorthemeset")),n()})).catch((y=>{o.w(`Couldn't set color theme: ${y}`)}))}setColorTheme(n){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=n,this._reloadColorTheme()}setImportColorTheme(n,l){const d=this.getFragmentStyle(n);d&&(d._styleColorTheme.colorThemeOverride=l,d._reloadColorTheme())}_getTransitionParameters(n){return{now:o.q.now(),transition:o.h(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;const n=[],l=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?n.push(d):l.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...l)}_createTerrain(n,l){const d=this.terrain=new Ve(n,l,this.scope,this.options,this.map.getWorldview());l===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}_force3DLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const l=this._layers[n];l.type==="symbol"&&this._updateLayer(l)}}_validate(n,l,d,y,x={}){if(x&&x.validate===!1)return!1;const S=o.h({},this.serialize());return zl(this,n.call(Go,o.h({key:l,style:S,value:d,styleSpec:o.a5},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.ds.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(n){const l=this.getSourceCaches(n);for(const d of l)d.clearTiles()}clearSources(){for(const n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}clearLayers(){for(const n in this._mergedLayers){const l=this._mergedLayers[n];l._clear&&l._clear()}}reloadSource(n){const l=this.getSourceCaches(n);for(const d of l)d.resume(),d.reload()}reloadSources(){for(const n of this.getSources())n.reload&&n.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((n=>{n.modelManager.reloadModels(n.scope)}))}updateSources(n){let l;this.directionalLight&&(l=xc(this.directionalLight));const d=new Set;for(const y in this._mergedLayers){const x=this._mergedLayers[y];x.hasElevation()&&!d.has(x.source)&&d.add(x.source)}for(const y in this._mergedSourceCaches){const x=this._mergedSourceCaches[y],S=d.has(x._source.id);x.update(n,void 0,void 0,l,S)}}_generateCollisionBoxes(){for(const n in this._sourceCaches){const l=this._sourceCaches[n];l.resume(),l.reload()}}_updatePlacement(n,l,d,y,x,S,A=!1){let C=!1,k=!1;const z={},V={};for(const j of this._mergedOrder){const q=this._mergedLayers[j];if(q.type!=="symbol")continue;const Q=o.C(q.source,q.scope);let Y=z[Q];if(!Y){const te=this.getLayerSourceCache(q);if(!te)continue;const ce=te.getRenderableIds(!0).map((me=>te.getTileByID(me)));V[Q]=ce.slice(),Y=z[Q]=ce.sort(((me,ye)=>ye.tileID.overscaledZ-me.tileID.overscaledZ||(me.tileID.isLessThan(ye.tileID)?-1:1)))}const re=this.crossTileSymbolIndex.addLayer(q,Y,l.center.lng,l.projection);C=C||re}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),A=A||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new o.A("neworder")),(A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),l.zoom))&&(this.pauseablePlacement=new bd(l,this._mergedOrder,A,d,y,x,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,z,V,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),k=!0),C&&this.pauseablePlacement.placement.setStale()),k||C){this._buildingIndex.onNewFrame(l.zoom);for(let j=0;j<this._mergedOrder.length;j++){const q=this._mergedLayers[this._mergedOrder[j]];if(q.type!=="symbol")continue;const Q=this.isLayerClipped(q);this.placement.updateLayerOpacities(q,z[o.C(q.source,q.scope)],j,Q?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,l){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex((({id:x})=>x===n.id))!==-1)return void this.fire(new o.z(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!l)return d.push(n),this._loadImports([n],!0);const y=d.findIndex((({id:x})=>x===l));return y===-1&&this.fire(new o.z(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,y).concat(n).concat(d.slice(y)),this._loadImports([n],!0,l)}updateImport(n,l){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(n);return y===-1?this:typeof l=="string"?(this.setImportUrl(n,l),this):(l.url&&l.url!==d[y].url&&this.setImportUrl(n,l.url),o.bv(l.config,d[y].config)||this.setImportConfig(n,l.config,l.data.schema),o.bv(l.data,d[y].data)||this.setImportData(n,l.data),this)}moveImport(n,l){this._checkLoaded();let d=this.stylesheet.imports||[];const y=this.getImportIndex(n);if(y===-1)return this;const x=this.getImportIndex(l);if(x===-1)return this;const S=d[y],A=this.fragments[y];return d=d.filter((({id:C})=>C!==n)),this.fragments=this.fragments.filter((({id:C})=>C!==n)),this.stylesheet.imports=d.slice(0,x).concat(S).concat(d.slice(x)),this.fragments=this.fragments.slice(0,x).concat(A).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(n,l){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(n);if(y===-1)return this;d[y].url=l;const x=this.fragments[y];return x.style=this._createFragmentStyle(d[y]),x.style.on("style.import.load",(()=>this.mergeAll())),x.style.loadURL(l),this}setImportData(n,l){this._checkLoaded();const d=this.getImportIndex(n),y=this.stylesheet.imports||[];return d===-1?this:l?(this.fragments[d].style.setState(l),this._reloadImports(),this):(delete y[d].data,this.setImportUrl(n,y[d].url))}setImportConfig(n,l,d){this._checkLoaded();const y=this.getImportIndex(n),x=this.stylesheet.imports||[];if(y===-1)return this;l?x[y].config=l:delete x[y].config;const S=this.fragments[y];d&&S.style.stylesheet&&(S.style.stylesheet.schema=d);const A=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=l,S.style.updateConfig(l,A),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();const l=this.stylesheet.imports||[],d=this.getImportIndex(n);d!==-1&&(l.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(n){const l=(this.stylesheet.imports||[]).findIndex((d=>d.id===n));return l===-1&&this.fire(new o.z(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),l}getLayer(n){return this._mergedLayers[n]}getSources(){const n=[];for(const l in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[l];d&&n.push(d.getSource())}return n}getSource(n,l){const d=this.getSourceCache(n,l);return d&&d.getSource()}getLayerSource(n){const l=this.getLayerSourceCache(n);return l&&l.getSource()}getSourceCache(n,l){const d=o.C(n,l);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(n){const l=o.C(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(n){if(n==null)return Object.values(this._mergedSourceCaches);const l=[];return this._mergedOtherSourceCaches[n]&&l.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&l.push(this._mergedSymbolSourceCaches[n]),l}updateSourceCaches(){const n=this._changes.getUpdatedSourceCaches();for(const l in n){const d=n[l];d==="reload"?this.reloadSource(l):d==="clear"&&this.clearSource(l)}}updateLayers(n){const l=this._changes.getUpdatedPaintProperties();for(const d of l){const y=this.getLayer(d);y&&y.updateTransitions(n)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(n){this.stylesheet.glyphs=n,this.glyphManager.setURL(n)}getImages(n,l,d){this.imageManager.getImages(l.images,l.scope,d),this._updateTilesForChangedImages();const y=S=>{if(S){const A=l.images.map((C=>o.I.toString(C)));S.setDependencies(l.tileID.key,l.type,A)}},x=o.C(l.source,l.scope);y(this._mergedOtherSourceCaches[x]),y(this._mergedSymbolSourceCaches[x]),l.images.some((S=>S.iconsetId))&&this.fire(new o.A("data",{dataType:"style"}))}rasterizeImages(n,l,d){this.imageManager.rasterizeImages(l,d)}getGlyphs(n,l,d){this.glyphManager.getGlyphs(l.stacks,d)}getResource(n,l,d){return o.dt(l,d)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){const l=[];return this._otherSourceCaches[n]&&l.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&l.push(this._symbolSourceCaches[n]),l}_isSourceCacheLoaded(n){const l=this.getOwnSourceCaches(n);return l.length===0?(this.fire(new o.z(new Error(`There is no source with ID '${n}'`))),!1):l.every((d=>d.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(n,l){if(!this._clipLayerPresent&&n.type!=="fill-extrusion"&&n.type!=="building")return!1;const d=n.type==="fill-extrusion"&&(n.sourceLayer==="building"||n.sourceLayer==="procedural_buildings"),y=n.type==="building";if(n.is3D(!!this.terrain)){if(d||y||l&&l.type==="batched-model"||n.type==="model")return!0}else if(n.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((n=>{n.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}na.getSourceType=function(f){return gd[f]},na.setSourceType=function(f,n){gd[f]=n},na.registerForPluginStateChange=o.du;var pf=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,fl=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Sc=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Ad="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",du=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Wo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,fh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Wt=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,dh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,mf=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,gf=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ph=[];as(pf,ph),as(Sc,ph),as(fl,ph);const Tc={"_prelude_fog.vertex.glsl":Wo,"_prelude_terrain.vertex.glsl":du,"_prelude_shadow.vertex.glsl":mf,"_prelude_fog.fragment.glsl":fh,"_prelude_shadow.fragment.glsl":gf,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Wt,"_prelude_raster_particle.glsl":dh},os={};gn("",du),gn(fh,Wo),gn(gf,mf),gn(Wt,""),gn(dh,"");const _f=gn(fl,Sc),Ca=pf;var pu={background:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:gn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:gn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:gn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:gn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:gn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:gn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:gn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:gn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:gn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:gn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:gn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:gn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:gn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:gn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:gn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:gn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:gn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:gn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:gn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ad),skyboxGradient:gn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ad),skyboxCapture:gn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:gn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:gn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:gn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:gn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:gn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:gn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:gn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function as(f,n){const l=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of l)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=d.split(" ");for(const x of y)n.includes(x)||n.push(x)}}function gn(f,n){const l=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let y=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);y&&(y=y.map((k=>{const z=k.split(" ");return z[z.length-1]})),y=[...new Set(y)]);const x={},S=[],A=[];if(f=f.replace(l,((k,z)=>(A.push(z),""))),(n=n.replace(l,((k,z)=>(S.push(z),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...ph];as(f,C),as(n,C);for(const k of[...S,...A])Tc[k]||console.error(`Undefined include: ${k}`),os[k]||(os[k]=[],as(Tc[k],os[k])),C=[...C,...os[k]];return{fragmentSource:f=f.replace(d,((k,z,V,j,q)=>(x[q]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${V} ${j} ${q};
#else
uniform ${V} ${j} u_${q};
#endif
`:z==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${V} ${j} ${q} = u_${q};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${V} ${j} ${q};
#endif
`:z==="initialize-attribute"?"":void 0))),vertexSource:n=n.replace(d,((k,z,V,j,q)=>{const Q=j==="float"?"vec2":j,Y=q.match(/color/)?"color":Q;return z==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${V} ${j} a_${q};
#endif
`:x[q]?z==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${V} ${Q} a_${q};
out ${V} ${j} ${q};
#else
uniform ${V} ${j} u_${q};
#endif
`:z==="initialize"?Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${V} ${j} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${Y}(a_${q}, u_${q}_t);
#else
    ${V} ${j} ${q} = u_${q};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${V} ${j} a_${q};
    out ${V} ${j} ${q};
#endif
`:z==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:z==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${V} ${Q} a_${q};
#else
uniform ${V} ${j} u_${q};
#endif
`:z==="define-instanced"?Y==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${V} ${j} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${V} ${Q} a_${q};
#else
uniform ${V} ${j} u_${q};
#endif
`:z==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${V} ${j} ${q} = a_${q};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${V} ${j} ${q} = a_${q};
#else
    ${V} ${j} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${V} ${j} ${q} = unpack_mix_${Y}(a_${q}, u_${q}_t);
#else
    ${V} ${j} ${q} = u_${q};
#endif
`})),staticAttributes:y,usedDefines:C,vertexIncludes:S,fragmentIncludes:A}}class R_{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,l,d,y,x,S,A,C){this.context=n;let k=this.boundPaintVertexBuffers.length!==y.length;for(let V=0;!k&&V<y.length;V++)this.boundPaintVertexBuffers[V]!==y[V]&&(k=!0);let z=this.boundDynamicVertexBuffers.length!==A.length;for(let V=0;!z&&V<A.length;V++)this.boundDynamicVertexBuffers[V]!==A[V]&&(z=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==d||k||z||this.boundIndexBuffer!==x||this.boundVertexOffset!==S)this.freshBind(l,d,y,x,S,A,C);else{n.bindVertexArrayOES.set(this.vao);for(const V of A)V&&(V.bind(),C&&V.instanceCount&&V.setVertexAttribDivisor(n.gl,l,C));x&&x.dynamicDraw&&x.bind()}}freshBind(n,l,d,y,x,S,A){const C=n.numAttributes,k=this.context,z=k.gl;this.vao&&this.destroy(),this.vao=k.gl.createVertexArray(),k.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=S,l.enableAttributes(z,n),l.bind(),l.setVertexAttribPointers(z,n,x);for(const V of d)V.enableAttributes(z,n),V.bind(),V.setVertexAttribPointers(z,n,x);for(const V of S)V&&(V.enableAttributes(z,n),V.bind(),V.setVertexAttribPointers(z,n,x),A&&V.instanceCount&&V.setVertexAttribDivisor(z,n,A));y&&y.bind(),k.currentNumAttributes=C}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function mu(f,n){const l=Math.pow(2,n.canonical.z),d=n.canonical.y;return[new o.ac(0,d/l).toLngLat().lat,new o.ac(0,(d+1)/l).toLngLat().lat]}function D_(f,n,l,d,y,x,S){const A=f.context,C=A.gl,k=l.hillshadeFBO;if(!k)return;f.prepareDrawTile();const z=f.isTileAffectedByFog(n),V=f.getOrCreateProgram("hillshade",{overrideFog:z});A.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get());const j=((re,te,ce,me)=>{const ye=ce.paint.get("hillshade-shadow-color"),Ee=ce.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ce=ce.paint.get("hillshade-highlight-color"),Re=ce.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Ae=ce.paint.get("hillshade-accent-color"),Pe=ce.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ie=ce.paint.get("hillshade-emissive-strength");let Ye=o.al(ce.paint.get("hillshade-illumination-direction"));if(ce.paint.get("hillshade-illumination-anchor")==="viewport")Ye-=re.transform.angle;else if(re.style&&re.style.enable3dLights()&&re.style.directionalLight){const dt=re.style.directionalLight.properties.get("direction"),rt=o.d1(dt.x,dt.y,dt.z);Ye=o.al(rt[1])}const Be=!re.options.moving;return{u_matrix:me||re.transform.calculateProjMatrix(te.tileID.toUnwrapped(),Be),u_image:0,u_latrange:mu(0,te.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),Ye],u_shadow:ye.toPremultipliedRenderColor(Ee?null:ce.lut),u_highlight:Ce.toPremultipliedRenderColor(Re?null:ce.lut),u_emissive_strength:Ie,u_accent:Ae.toPremultipliedRenderColor(Pe?null:ce.lut)}})(f,l,d,f.terrain?n.projMatrix:null);f.uploadCommonUniforms(A,V,n.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:Q,tileBoundsSegments:Y}=f.getTileBoundsBuffers(l);V.draw(f,C.TRIANGLES,y,x,S,Er.disabled,j,d.id,q,Q,Y)}function Pd(f,n,l){if(!n.needsDEMTextureUpload)return;const d=f.context,y=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||f.getTileTexture(l.stride);const x=l.getPixels();n.demTexture?n.demTexture.update(x,{premultiply:!1}):n.demTexture=new o.T(d,x,y.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function $p(f,n,l){const d=f.context,y=d.gl;if(!n.dem)return;const x=n.dem;if(d.activeTexture.set(y.TEXTURE1),Pd(f,n,x),!n.demTexture)return;n.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const S=x.dim;d.activeTexture.set(y.TEXTURE0);let A=n.hillshadeFBO;if(!A){const j=new o.T(d,{width:S,height:S,data:null},y.RGBA8);j.bind(y.LINEAR,y.CLAMP_TO_EDGE),A=n.hillshadeFBO=d.createFramebuffer(S,S,!0,"renderbuffer"),A.colorAttachment.set(j.texture)}d.bindFramebuffer.set(A.framebuffer),d.viewport.set([0,0,S,S]);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:k,tileBoundsSegments:z}=f.getMercatorTileBoundsBuffers(),V=[];f.linearFloatFilteringSupported()&&V.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:V}).draw(f,y.TRIANGLES,er.disabled,Ir.disabled,Wr.unblended,Er.disabled,((j,q)=>{const Q=q.stride,Y=o.bz();return o.ca(Y,0,o.aj,-o.aj,0,0,1),o.bo(Y,Y,[0,-o.aj,0]),{u_matrix:Y,u_image:1,u_dimension:[Q,Q],u_zoom:j.overscaledZ}})(n.tileID,x),l.id,C,k,z),n.needsHillshadePrepare=!1}class cn{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qp extends cn{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Id extends cn{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class yf extends cn{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Xm extends cn{getDefault(){return[!0,!0,!0,!0]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Cd extends cn{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class vf extends cn{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class gu extends cn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const l=this.current;(n.func!==l.func||n.ref!==l.ref||n.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class mh extends cn{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Gp extends cn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=n,this.dirty=!1}}class Hp extends cn{getDefault(){return[0,1]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Md extends cn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=n,this.dirty=!1}}class Od extends cn{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class dl extends cn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.BLEND):l.disable(l.BLEND),this.current=n,this.dirty=!1}}class Fl extends cn{getDefault(){const n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class gh extends cn{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class _h extends cn{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class Ec extends cn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=n,this.dirty=!1}}class Rd extends cn{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Wp extends cn{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let Zp=class extends cn{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class yh extends cn{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Dd extends cn{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class vh extends cn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class pl extends cn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class xf extends cn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class ml extends cn{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Ds extends cn{getDefault(){return null}set(n){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class xh extends cn{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class gl extends cn{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Ac extends cn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Km extends cn{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Xp extends cn{constructor(n,l){super(n),this.context=n,this.parent=l}getDefault(){return null}}class _u extends Xp{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class bh extends Xp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Pc extends Xp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class wh extends bh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const bf=(f,n,l)=>({u_matrix:f,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:l}),Bl=(f,n,l,d,y,x,S,A,C,k,z,V,j,q,Q,Y)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:l,u_zoom_transition:y,u_merc_center:x,u_image0:0,u_frustum_tl:S,u_frustum_tr:A,u_frustum_br:C,u_frustum_bl:k,u_globe_pos:z,u_globe_radius:V,u_viewport:j,u_grid_matrix:Y?Float32Array.from(Y):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:Q});function _l(f,n){return f!=null&&n!=null&&!(!f.hasData()||!n.hasData())&&f.demTexture!=null&&n.demTexture!=null&&f.tileID.key!==n.tileID.key}const Ii=new class{constructor(){this.operations={}}newMorphing(f,n,l,d,y){if(f in this.operations){const x=this.operations[f];x.to.tileID.key!==l.tileID.key&&(x.queued=l)}else this.operations[f]={startTime:d,phase:0,duration:y,from:n,to:l,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const n=this.operations[f];return{from:n.from,to:n.to,phase:n.phase}}update(f){for(const n in this.operations){const l=this.operations[n];for(l.phase=(f-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,f)){delete this.operations[n];break}}}_nextOp(f,n){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=n,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},$i={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ss(f,n,l){if(n===0)return 0;const d=n<1&&l===514?.25/n:1;return 6*Math.pow(1.5,22-f)*Math.max(n,1)*d}function Mo(f,n){const l=1<<f.z;return!n&&(f.x===0||f.x===l-1)||f.y===0||f.y===l-1}const ia=f=>({u_matrix:f});function So(f,n,l,d,y){if(y>0){const x=o.q.now(),S=(x-f.timeAdded)/y,A=n?(x-n.timeAdded)/y:-1,C=l.getSource(),k=d.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),z=!n||Math.abs(n.tileID.overscaledZ-k)>Math.abs(f.tileID.overscaledZ-k),V=z&&f.refreshedUponExpiration?1:o.ay(z?S:1-A,0,1);return f.refreshedUponExpiration&&S>=1&&(f.refreshedUponExpiration=!1),n?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}class Ic extends Ho{constructor(n){const l=lc("mock-dem",{type:"raster-dem",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("mock-dem",l,!1),l.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,l){n.state="loaded",l(null)}}class oa extends Ho{constructor(n){const l=lc("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},n.style.dispatcher,n.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,l,d){if(n.freezeTileCoverage)return;this.transform=n;const y=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((x,S)=>{if(x[S.key]="",!this._tiles[S.key]){const A=new hc(S,this._source.tileSize*S.overscaleFactor(),n.tileZoom,void 0,void 0,this._source.worldview);A.state="loaded",this._tiles[S.key]=A}return x}),{});for(const x in this._tiles)x in y||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(n){const l=this.proxyCachedFBO[n];if(l!==void 0){const d=Object.values(l);this.renderCachePool.push(...d),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach((n=>n.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Cc extends o.aM{constructor(n,l,d){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=l,this.projMatrix=d}}class wf extends o.dF{constructor(n,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,y,x]=(function(C){const k=new o.ba,z=new o.a_,V=131;k.reserve(17161),z.reserve(33800);const j=o.aj/128,q=o.aj+j/2,Q=q+j;for(let re=-j;re<Q;re+=j)for(let te=-j;te<Q;te+=j){const ce=te<0||te>q||re<0||re>q?24575:0,me=o.ay(Math.round(te),0,o.aj),ye=o.ay(Math.round(re),0,o.aj);k.emplaceBack(me+ce,ye)}const Y=(re,te)=>{const ce=te*V+re;z.emplaceBack(ce+1,ce,ce+V),z.emplaceBack(ce+V,ce+V+1,ce+1)};for(let re=1;re<129;re++)for(let te=1;te<129;te++)Y(te,re);return[0,129].forEach((re=>{for(let te=0;te<130;te++)Y(te,re),Y(re,te)})),[k,z,32768]})(),S=n.context;this.gridBuffer=S.createVertexBuffer(d,o.bc.members),this.gridIndexBuffer=S.createIndexBuffer(y),this.gridSegments=o.bd.simpleSegment(0,0,d.length,y.length),this.gridNoSkirtSegments=o.bd.simpleSegment(0,0,d.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new oa(l.map),this.orthoMatrix=o.bz(),o.ca(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.aj,0,o.aj,0,1);const A=S.gl;this._overlapStencilMode=new Ir({func:A.GEQUAL,mask:255},0,255,A.KEEP,A.KEEP,A.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ic(l.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(n,l,d){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);const y=n.terrain.properties,x=n.terrain.drapeRenderMode===0,S=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const A=n.terrain&&n.terrain.scope,C=y.get("source"),k=x?this._mockSourceCache:n.getSourceCache(C,A);if(!k)return void o.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=k,this._attenuationRange=n.terrain.getAttenuationRange(),this._exaggeration=S?this.calculateExaggeration(l):y.get("exaggeration"),!l.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const V=this.getScaledDemTileSize();this.sourceCache.update(l,V,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),l.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(n){if(this._attenuationRange&&n.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(n.zoom);const l=this._previousCameraAltitude,d=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=d;const y=l!=null?d-l:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const x=n.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(x);let A=x-this._previousZoom;const C=this._previousUpdateTimestamp;let k=x;this._evaluationZoom!=null&&(k=this._evaluationZoom,Math.abs(x-k)>.5&&(A=.5*(x-k+A)),A*y<0&&(k+=A)),this._evaluationZoom=k;const z=S.getExaggeration(k),V=z===S.getExaggeration(Math.max(0,k-.1));if(V&&Math.abs(z-this._exaggeration)<.01)return z;let j=Math.min(.1,.00375*(this._updateTimestamp-C));return(V||z<.1||Math.abs(A)<1e-4)&&(j=Math.min(.2,4*j)),o.ai(this._exaggeration,z,j)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((n=>n.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(o.ac.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=l.getIds().map((C=>{const k=l.getTileByID(C).tileID;return k.projMatrix=d.calculateProjMatrix(k.toUnwrapped()),k}));(function(C,k){const z=k.transform.pointCoordinate(k.transform.getCameraPoint()),V=new o.P(z.x,z.y);C.sort(((j,q)=>{if(q.overscaledZ-j.overscaledZ)return q.overscaledZ-j.overscaledZ;const Q=new o.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),Y=new o.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),re=V.mult(1<<j.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(Q)-re.distSqr(Y)}))})(y,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},y.forEach((C=>{this.proxyToSource[C.key]={}})),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const C in S){const k=S[C];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,n[C],x),k.usedForTerrain))continue;const z=n[C];k.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[l.id]=y.map((C=>new Cc(C,C.key,this.orthoMatrix))),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const A={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const k=this.terrainTileForTile[C.key];if(!k)continue;const z=k.tileID.key;z in A||(this._visibleDemTiles.push(k),A[z]=z)}}_assignTerrainTiles(n){this._initializing||n.forEach((l=>{if(this.terrainTileForTile[l.key])return;const d=this._findTileCoveringTileID(l,this.sourceCache);d&&(this.terrainTileForTile[l.key]=d)}))}_prepareDEMTextures(){const n=this.painter.context,l=n.gl;for(const d in this.terrainTileForTile){const y=this.terrainTileForTile[d],x=y.dem;!x||y.demTexture&&!y.needsDEMTextureUpload||(n.activeTexture.set(l.TEXTURE1),Pd(this.painter,y,x))}}_prepareDemTileUniforms(n,l,d,y){if(!l||l.demTexture==null)return!1;const x=n.tileID.canonical,S=Math.pow(2,l.tileID.canonical.z-x.z),A=y||"";return d[`u_dem_tl${A}`]=[x.x*S%1,x.y*S%1],d[`u_dem_scale${A}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let n=0;const l=this._visibleDemTiles.reduce(((d,y)=>{if(!y.dem)return d;const x=y.dem.tree.minimums[0];return x>0&&n++,d+x}),0);return n?l/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,l=n.gl;n.activeTexture.set(l.TEXTURE2);const d=this._getLoadedAreaMinimum(),y=new o.dG({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(y,{premultiply:!1}):x=this._emptyDEMTexture=new o.T(n,y,l.R32F,{premultiply:!1}),x}setupElevationDraw(n,l,d){const y=this.painter.context,x=y.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let A=null,C=null,k=1;if(d&&d.morphing&&this._useVertexMorphing){const q=d.morphing.srcDemTile,Q=d.morphing.dstDemTile;k=d.morphing.phase,q&&Q&&(this._prepareDemTileUniforms(n,q,S,"_prev")&&(C=q),this._prepareDemTileUniforms(n,Q,S)&&(A=Q))}const z=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST;let V=null;var j;if(this.enabled?C&&A?(V=A.demTexture,y.activeTexture.set(x.TEXTURE4),C.demTexture.bind(z(C),x.CLAMP_TO_EDGE),S.u_dem_lerp=k):(A=this.terrainTileForTile[n.tileID.key],V=this._prepareDemTileUniforms(n,A,S)?A.demTexture:this.emptyDEMTexture):V=this.emptyDEMTexture,y.activeTexture.set(x.TEXTURE2),V&&(S.u_dem_size=(j=V).size[0]===1?1:j.size[0]-2,V.bind(z(A),x.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,l,S),d&&d.useMeterToDem&&A){const q=(1<<A.tileID.canonical.z)*o.cb(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=q}if(d&&d.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),l.setTerrainUniformValues(y,S),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,n.tileID.canonical,d&&d.useDenormalizedUpVectorScale);l.setGlobeUniformValues(y,q)}}globeUniformValues(n,l,d){const y=n.projection;return{u_tile_tl_up:y.upVector(l,0,0),u_tile_tr_up:y.upVector(l,o.aj,0),u_tile_br_up:y.upVector(l,o.aj,o.aj),u_tile_bl_up:y.upVector(l,0,o.aj),u_tile_up_scale:d?o.dH(1):y.upVectorScale(l,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const l=this.painter,d=this.painter.context;n.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(y,x,S,A,C){if(y.transform.projection.name==="globe")(function(k,z,V,j,q){const Q=k.context,Y=Q.gl;let re,te;const ce=k.transform,me=o.dy(k,Q,ce),ye=(dt,rt)=>{if(te===rt)return;const xt=[$i[rt],"PROJECTION_GLOBE_VIEW"];me&&xt.push("CUSTOM_ANTIALIASING");const It=k.isTileAffectedByFog(dt);re=k.getOrCreateProgram("globeRaster",{defines:xt,overrideFog:It}),te=rt},Ee=k.colorModeForRenderPass(),Ce=new er(Y.LEQUAL,er.ReadWrite,k.depthRangeFor3D);Ii.update(q);const Re=o.dz(ce),Ae=[o.aD(ce.center.lng),o.aH(ce.center.lat)],Pe=k.globeSharedBuffers,Ie=[ce.width*o.q.devicePixelRatio,ce.height*o.q.devicePixelRatio],Ye=Float32Array.from(ce.globeMatrix),Be={useDenormalizedUpVectorScale:!0};{const dt=k.transform,rt=ss(dt.zoom,z.exaggeration(),z.sourceCache._source.tileSize);te=-1;const xt=Y.TRIANGLES;for(const It of j){const We=V.getTile(It),ze=Ir.disabled,ot=z.prevTerrainTileForTile[It.key],tt=z.terrainTileForTile[It.key];_l(ot,tt)&&Ii.newMorphing(It.key,ot,tt,q,250),Q.activeTexture.set(Y.TEXTURE0),We.texture&&We.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const At=Ii.getMorphValuesForProxy(It.key),Pt=At?1:0;At&&o.L(Be,{morphing:{srcDemTile:At.from,dstDemTile:At.to,phase:o.dx(At.phase)}});const Dt=o.dA(It.canonical),Bt=o.dB(Dt.getCenter().lat),cr=o.dC(It.canonical,Dt,Bt,dt.worldSize/dt._pixelsPerMercatorPixel),pr=o.bh(o.dD(It.canonical)),Jt=Bl(dt.expandedFarZProjMatrix,Ye,Re,pr,o.ah(dt.zoom),Ae,dt.frustumCorners.TL,dt.frustumCorners.TR,dt.frustumCorners.BR,dt.frustumCorners.BL,dt.globeCenterInViewSpace,dt.globeRadius,Ie,rt,dt._farZ,cr);if(ye(It,Pt),re&&(z.setupElevationDraw(We,re,Be),k.uploadCommonUniforms(Q,re,It.toUnwrapped()),Pe)){const[dr,ur,Lr]=Pe.getGridBuffers(Bt,rt!==0);re.draw(k,xt,Ce,ze,Ee,Er.backCCW,Jt,"globe_raster",dr,ur,Lr)}}}if(Pe&&(k.renderDefaultNorthPole||k.renderDefaultSouthPole)){const dt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];me&&dt.push("CUSTOM_ANTIALIASING"),re=k.getOrCreateProgram("globeRaster",{defines:dt});for(const rt of j){const{x:xt,y:It,z:We}=rt.canonical,ze=It===0,ot=It===(1<<We)-1,[tt,At,Pt,Dt]=Pe.getPoleBuffers(We,!1);if(Dt&&(ze||ot)){const Bt=V.getTile(rt);Q.activeTexture.set(Y.TEXTURE0),Bt.texture&&Bt.texture.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);let cr=o.dE(We,xt,ce);const pr=o.bh(o.dD(rt.canonical)),Jt=(dr,ur)=>dr.draw(k,Y.TRIANGLES,Ce,Ir.disabled,Ee,Er.disabled,Bl(ce.expandedFarZProjMatrix,cr,cr,pr,0,Ae,ce.frustumCorners.TL,ce.frustumCorners.TR,ce.frustumCorners.BR,ce.frustumCorners.BL,ce.globeCenterInViewSpace,ce.globeRadius,Ie,0,ce._farZ),"globe_pole_raster",ur,Pt,Dt);z.setupElevationDraw(Bt,re,Be),k.uploadCommonUniforms(Q,re,rt.toUnwrapped()),ze&&k.renderDefaultNorthPole&&Jt(re,tt),ot&&k.renderDefaultSouthPole&&(cr=o.cP(o.bz(),cr,[1,-1,1]),Jt(re,At))}}}})(y,x,S,A,C);else{const k=y.context,z=k.gl;let V,j;const q=y.shadowRenderer,Q=$a(y,y.longestCutoffRange),Y=Ee=>{if(j===Ee)return;const Ce=[];Ce.push($i[Ee]),Q.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF"),q&&(Ce.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&Ce.push("NORMAL_OFFSET")),V=y.getOrCreateProgram("terrainRaster",{defines:Ce}),j=Ee},re=y.colorModeForRenderPass(),te=new er(z.LEQUAL,er.ReadWrite,y.depthRangeFor3D);Ii.update(C);const ce=y.transform,me=ss(ce.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let ye=[0,0,0];if(q){const Ee=y.style.directionalLight,Ce=y.style.ambientLight;Ee&&Ce&&(ye=Ll(y.style,Ee,Ce))}{j=-1;const Ee=z.TRIANGLES,[Ce,Re]=[x.gridIndexBuffer,x.gridSegments];for(const Ae of A){const Pe=S.getTile(Ae),Ie=Ir.disabled,Ye=x.prevTerrainTileForTile[Ae.key],Be=x.terrainTileForTile[Ae.key];_l(Ye,Be)&&Ii.newMorphing(Ae.key,Ye,Be,C,250),k.activeTexture.set(z.TEXTURE0),Pe.texture&&Pe.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const dt=Ii.getMorphValuesForProxy(Ae.key),rt=dt?1:0;let xt;dt&&(xt={morphing:{srcDemTile:dt.from,dstDemTile:dt.to,phase:o.dx(dt.phase)}});const It=bf(Ae.projMatrix,Mo(Ae.canonical,ce.renderWorldCopies)?me/10:me,ye);if(Y(rt),!V)continue;x.setupElevationDraw(Pe,V,xt);const We=Ae.toUnwrapped();q&&q.setupShadows(We,V),y.uploadCommonUniforms(k,V,We,null,Q),V.draw(y,Ee,te,Ie,re,Er.backCCW,It,"terrain_raster",x.gridBuffer,Ce,Re)}}}})(l,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const l=this.painter,d=this.painter.context,y=this.proxySourceCache,x=this.proxiedCoords[y.id],S=this._drapedRenderBatches.shift(),A=l.style.order,C=[];let k=0;for(const z of x){const V=y.getTileByID(z.proxyTileKey),j=y.proxyCachedFBO[z.key]?y.proxyCachedFBO[z.key][n]:void 0,q=j!==void 0?y.renderCache[j]:this.pool[k++],Q=j!==void 0;if(V.texture=q.tex,Q&&!q.dirty){C.push(V.tileID);continue}let Y;d.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(d.clear({color:o.am.transparent,stencil:0}),q.dirty=!1);for(let re=S.start;re<=S.end;++re){const te=l.style._mergedLayers[A[re]];if(te.isHidden(l.transform.zoom))continue;const ce=l.style.getLayerSourceCache(te),me=ce?this.proxyToSource[z.key][ce.id]:[z];if(!me)continue;const ye=me;d.viewport.set([0,0,q.fb.width,q.fb.height]),Y!==(ce?ce.id:null)&&(this._setupStencil(q,me,te,ce),Y=ce?ce.id:null),l.renderLayer(l,ce,te,ye)}if(this._drapedRenderBatches.length===0)for(const re of this._pendingGroundEffectLayers){const te=l.style._mergedLayers[A[re]];if(te.isHidden(l.transform.zoom))continue;const ce=l.style.getLayerSourceCache(te),me=ce?this.proxyToSource[z.key][ce.id]:[z];if(!me)continue;const ye=me;d.viewport.set([0,0,q.fb.width,q.fb.height]),Y!==(ce?ce.id:null)&&(this._setupStencil(q,me,te,ce),Y=ce?ce.id:null),l.renderLayer(l,ce,te,ye)}this.renderedToTile?(q.dirty=!0,C.push(V.tileID)):Q||--k,k===5&&(k=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,l.width,l.height]),S.end+1}postRender(){}isLayerOrderingCorrect(n){const l=n.order.length;let d=-1,y=l;for(let x=0;x<l;++x)this._style.isLayerDraped(n._mergedLayers[n.order[x]])?d=Math.max(d,x):y=Math.min(y,x);return y>d}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter((l=>l.dem)).forEach((l=>{n=Math.min(n,l.dem.tree.minimums[0])})),n===0?n:(n-30)*this._exaggeration}raycast(n,l,d){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter((x=>x.dem)).map((x=>{const S=x.tileID,A=1<<S.overscaledZ,{x:C,y:k}=S.canonical,z=C/A,V=(C+1)/A,j=k/A,q=(k+1)/A;return{minx:z,miny:j,maxx:V,maxy:q,t:x.dem.tree.raycastRoot(z,j,V,q,n,l,d),tile:x}}));y.sort(((x,S)=>(x.t!==null?x.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE)));for(const x of y){if(x.t==null)return null;const S=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,n,l,d);if(S!=null)return S}return null}_createFBO(){const n=this.painter.context,l=n.gl,d=this.drapeBufferSize;n.activeTexture.set(l.TEXTURE0);const y=new o.T(n,{width:d[0],height:d[1],data:null},l.RGBA8);y.bind(l.LINEAR,l.CLAMP_TO_EDGE);const x=n.createFramebuffer(d[0],d[1],!0,null);return x.colorAttachment.set(y.texture),x.depthAttachment=new wh(n,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:x,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some((n=>{const l=this._style._mergedLayers[n],d=l.isHidden(this.painter.transform.zoom);return l.type==="hillshade"||l.type==="custom"?!d&&l.shouldRedrape():!d&&l.hasTransition()}))}_clearLineLayersFromRenderCache(){let n=!1;for(const d of this._style.getSources())if(d instanceof Ea){n=!0;break}if(!n)return;const l={};for(let d=0;d<this._style.order.length;++d){const y=this._style._mergedLayers[this._style.order[d]],x=this._style.getLayerSourceCache(y);if(x&&!l[x.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof o.ab){l[x.id]=!0;for(const S of this.proxyCoords){const A=this.proxyToSource[S.key][x.id];if(A)for(const C of A)this._clearRenderCacheForTile(x.id,C)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof No){n=!0;break}if(!n)return;const l={};for(let d=0;d<this._style.order.length;++d){const y=this._style._mergedLayers[this._style.order[d]],x=this._style.getLayerSourceCache(y);if(!x||l[x.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const S=y.paint.get("raster-fade-duration");for(const A of this.proxyCoords){const C=this.proxyToSource[A.key][x.id];if(C)for(const k of C){const z=So(x.getTile(k),x.findLoadedParent(k,0),x,this.painter.transform,S);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(x.id,k)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const n=this._style.order,l=n.length;if(l===0)return;const d=[];this._pendingGroundEffectLayers=[];let y,x=0,S=this._style._mergedLayers[n[x]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++x<l;)S=this._style._mergedLayers[n[x]];for(;x<l;++x){const A=this._style._mergedLayers[n[x]];A.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(A)?y===void 0&&(y=x):(A.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),y!==void 0&&(d.push({start:y,end:x-1}),y=void 0)))}if(y!==void 0&&d.push({start:y,end:x-1}),d.length!==0){const A=d[d.length-1];this._pendingGroundEffectLayers.every((C=>C>A.end))||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(n){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const S=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let A=0;A<S.length;++A){const C=Object.values(S[A]);l.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,y=this._tilesDirty;for(let S=d.length-1;S>=0;S--){const A=d[S];if(l.getTileByID(A.key),l.proxyCachedFBO[A.key]!==void 0){const C=n[A.key],k=this.proxyToSource[A.key];let z=0;for(const V in k){const j=k[V],q=C[V];if(!q||q.length!==j.length||j.some(((Q,Y)=>Q!==q[Y]||y[V]&&y[V].hasOwnProperty(Q.key)))){z=-1;break}++z}for(const V in l.proxyCachedFBO[A.key])l.renderCache[l.proxyCachedFBO[A.key][V]].dirty=z<0||z!==Object.values(C).length}}const x=[...this._drapedRenderBatches];x.sort(((S,A)=>A.end-A.start-(S.end-S.start)));for(const S of x)for(const A of d){if(l.proxyCachedFBO[A.key])continue;let C=l.renderCachePool.pop();C===void 0&&l.renderCache.length<50&&(C=l.renderCache.length,l.renderCache.push(this._createFBO())),C!==void 0&&(l.proxyCachedFBO[A.key]={},l.proxyCachedFBO[A.key][S.start]=C,l.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(n,l,d,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,S=x.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let A;if(d.isTileClipped())A=l.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);A=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+A>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=A,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):Ir.disabled}_renderTileClippingMasks(n,l){const d=this.painter,y=this.painter.context,x=y.gl;d._tileClippingMaskIDs={},y.setColorMode(Wr.disabled),y.setDepthMode(er.disabled);const S=d.getOrCreateProgram("clippingMask");for(const A of n){const C=d._tileClippingMaskIDs[A.key]=--l;S.draw(d,x.TRIANGLES,er.disabled,new Ir({func:x.ALWAYS,mask:0},C,255,x.KEEP,x.KEEP,x.REPLACE),Wr.disabled,Er.disabled,ia(A.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(n){const l=this.painter.transform;if(n.x<0||n.x>l.width||n.y<0||n.y>l.height)return null;const d=[n.x,n.y,1,1];o.aA(d,d,l.pixelMatrixInverse),o.cH(d,d,1/d[3]),d[0]/=l.worldSize,d[1]/=l.worldSize;const y=l._camera.position,x=o.cb(1,l.center.lat),S=[y[0],y[1],y[2]/x,0],A=o.d7([],d.slice(0,3),S);o.au(A,A);const C=this.raycast(S,A,this._exaggeration);return C!==null&&C?(o.bE(S,S,A,C),S[3]=S[2],S[2]*=x,S):null}_setupProxiedCoordsForOrtho(n,l,d){if(n.getSource()instanceof o.aP)return this._setupProxiedCoordsForImageSource(n,l,d);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const y=this.proxiedCoords[n.id]=[],x=this.proxyCoords;for(let C=0;C<x.length;C++){const k=x[C],z=this._findTileCoveringTileID(k,n);if(z){const V=this._createProxiedId(k,z,d[k.key]&&d[k.key][n.id]);y.push(V),this.proxyToSource[k.key][n.id]=[V]}}let S=!1;const A=new Set;for(let C=0;C<l.length;C++){const k=n.getTile(l[C]);if(!k||!k.hasData())continue;const z=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==k.tileID.canonical.z){const V=this.proxyToSource[z.tileID.key][n.id],j=this._createProxiedId(z.tileID,k,d[z.tileID.key]&&d[z.tileID.key][n.id]);V?V.splice(V.length-1,0,j):this.proxyToSource[z.tileID.key][n.id]=[j];const q=this.proxyToSource[z.tileID.key][n.id];A.has(q)||A.add(q),y.push(j),S=!0}}if(this._sourceTilesOverlap[n.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const C of A)C.sort(((k,z)=>z.overscaledZ-k.overscaledZ))}_setupProxiedCoordsForImageSource(n,l,d){if(!n.getSource().loaded())return;const y=this.proxiedCoords[n.id]=[],x=this.proxyCoords,S=n.getSource(),A=S.tileID;if(!A)return;const C=new o.P(A.x,A.y)._div(1<<A.z),k=S.coordinates.map(o.ac.fromLngLat).reduce(((V,j)=>(V.min.x=Math.min(V.min.x,j.x-C.x),V.min.y=Math.min(V.min.y,j.y-C.y),V.max.x=Math.max(V.max.x,j.x-C.x),V.max.y=Math.max(V.max.y,j.y-C.y),V)),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(V,j)=>{const q=V.wrap+V.canonical.x/(1<<V.canonical.z),Q=V.canonical.y/(1<<V.canonical.z),Y=o.aj/(1<<V.canonical.z),re=j.wrap+j.canonical.x/(1<<j.canonical.z),te=j.canonical.y/(1<<j.canonical.z);return q+Y<re+k.min.x||q>re+k.max.x||Q+Y<te+k.min.y||Q>te+k.max.y};for(let V=0;V<x.length;V++){const j=x[V];for(let q=0;q<l.length;q++){const Q=n.getTile(l[q]);if(!Q||!Q.hasData()||z(j,Q.tileID))continue;const Y=this._createProxiedId(j,Q,d[j.key]&&d[j.key][n.id]),re=this.proxyToSource[j.key][n.id];re?re.push(Y):this.proxyToSource[j.key][n.id]=[Y],y.push(Y)}}}_createProxiedId(n,l,d){let y=this.orthoMatrix;if(d){const x=d.find((S=>S.key===l.tileID.key));if(x)return x}if(l.tileID.key!==n.key){const x=n.canonical.z-l.tileID.canonical.z;let S,A,C;y=o.bz();const k=l.tileID.wrap-n.wrap<<n.overscaledZ;x>0?(S=o.aj>>x,A=S*((l.tileID.canonical.x<<x)-n.canonical.x+k),C=S*((l.tileID.canonical.y<<x)-n.canonical.y)):(S=o.aj<<-x,A=o.aj*(l.tileID.canonical.x-(n.canonical.x+k<<-x)),C=o.aj*(l.tileID.canonical.y-(n.canonical.y<<-x))),o.ca(y,0,S,0,S,0,1),o.bo(y,y,[A,C,0])}return new Cc(l.tileID,n.key,y)}_findTileCoveringTileID(n,l){let d=l.getTile(n);if(d&&d.hasData())return d;const y=this._findCoveringTileCache[l.id],x=y[n.key];if(d=x?l.getTileByID(x):null,d&&d.hasData()||x===null)return d;let S=d?d.tileID:n,A=S.overscaledZ;const C=l.getSource().minzoom,k=[];if(!x){const V=l.getSource().maxzoom;if(n.canonical.z>=V){const j=n.canonical.z-V;l.getSource().reparseOverscaled?(A=Math.max(n.canonical.z+2,l.transform.tileZoom),S=new o.aM(A,n.wrap,V,n.canonical.x>>j,n.canonical.y>>j)):j!==0&&(A=V,S=new o.aM(A,n.wrap,V,n.canonical.x>>j,n.canonical.y>>j))}S.key!==n.key&&(k.push(S.key),d=l.getTile(S))}const z=V=>{k.forEach((j=>{y[j]=V})),k.length=0};for(A-=1;A>=C&&(!d||!d.hasData());A--){d&&z(d.tileID.key);const V=S.calculateScaledKey(A);if(d=l.getTileByID(V),d&&d.hasData())break;const j=y[V];if(j===null)break;j===void 0?k.push(V):d=l.getTileByID(j)}return z(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,l){let d=this._tilesDirty[n];d||(d=this._tilesDirty[n]={}),d[l.key]=!0}}function kd(f,n,l){const d=(function(A,C,k){const z=o.bG(C,A),V=o.bG(k,[.2126,.7152,.0722]),j=(Q,Y,re)=>(1-re)*Q+re*Y,q=j(1-.3*Math.min(V,1),1,Math.min(z+1,1));return j(.92,1,Math.asin(o.ay(C[2],-1,1))/Math.PI+.5)*q})(f,[0,0,1],n),y=[0,0,0];o.c1(y,l.slice(0,3),d);const x=[0,0,0];o.c1(x,n.slice(0,3),f[2]);const S=[0,0,0];return o.d5(S,y,x),o.d8(S)}const Sh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Sf=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class vs{static cacheKey(n,l,d,y){let x=`${l}${y?y.cacheKey:""}`;for(const S of d)n.usedDefines.includes(S)&&(x+=`/${S}`);return x}constructor(n,l,d,y,x,S){const A=n.gl;this.program=A.createProgram(),this.configuration=y,this.name=l,this.fixedDefines=[...S];const C=y?y.getBinderAttributes():[],k=(d.staticAttributes||[]).concat(C);let z=y?y.defines():[];z=z.concat(S.map((re=>`#define ${re}`)));const V=`#version 300 es
`;let j=V+z.concat("precision mediump float;",Ca,_f.fragmentSource).join(`
`);for(const re of d.fragmentIncludes)j+=`
${Tc[re]}`;j+=`
${d.fragmentSource}`;let q=V+z.concat("precision highp float;",Ca,_f.vertexSource).join(`
`);for(const re of d.vertexIncludes)q+=`
${Tc[re]}`;this.forceManualRenderingForInstanceIDShaders=n.forceManualRenderingForInstanceIDShaders&&d.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(q+=`
uniform int u_instanceID;
`),q+=`
${d.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(q=q.replaceAll("gl_InstanceID","u_instanceID"));const Q=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);A.shaderSource(Q,j),A.compileShader(Q),A.attachShader(this.program,Q);const Y=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(Y,q),A.compileShader(Y),A.attachShader(this.program,Y),this.attributes={},this.numAttributes=k.length;for(let re=0;re<this.numAttributes;re++)if(k[re]){const te=k[re].startsWith("a_")?k[re]:`a_${k[re]}`;A.bindAttribLocation(this.program,re,te),this.attributes[te]=re}A.linkProgram(this.program),A.deleteShader(Y),A.deleteShader(Q),this.fixedUniforms=x(n),this.binderUniforms=y?y.getUniforms(n):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(re=>({u_instanceID:new o.cd(re)}))(n)),(S.includes("TERRAIN")||l.indexOf("symbol")!==-1||l.indexOf("circle")!==-1)&&(this.terrainUniforms=(re=>({u_dem:new o.cd(re),u_dem_prev:new o.cd(re),u_dem_tl:new o.cg(re),u_dem_scale:new o.cf(re),u_dem_tl_prev:new o.cg(re),u_dem_scale_prev:new o.cf(re),u_dem_size:new o.cf(re),u_dem_lerp:new o.cf(re),u_exaggeration:new o.cf(re),u_depth:new o.cd(re),u_depth_size_inv:new o.cg(re),u_depth_range_unpack:new o.cg(re),u_occluder_half_size:new o.cf(re),u_occlusion_depth_offset:new o.cf(re),u_meter_to_dem:new o.cf(re),u_label_plane_matrix_inv:new o.ch(re)}))(n)),S.includes("GLOBE")&&(this.globeUniforms=(re=>({u_tile_tl_up:new o.ce(re),u_tile_tr_up:new o.ce(re),u_tile_br_up:new o.ce(re),u_tile_bl_up:new o.ce(re),u_tile_up_scale:new o.cf(re)}))(n)),S.includes("FOG")&&(this.fogUniforms=(re=>({u_fog_matrix:new o.ch(re),u_fog_range:new o.cg(re),u_fog_color:new o.d0(re),u_fog_horizon_blend:new o.cf(re),u_fog_vertical_limit:new o.cg(re),u_fog_temporal_offset:new o.cf(re),u_frustum_tl:new o.ce(re),u_frustum_tr:new o.ce(re),u_frustum_br:new o.ce(re),u_frustum_bl:new o.ce(re),u_globe_pos:new o.ce(re),u_globe_radius:new o.cf(re),u_globe_transition:new o.cf(re),u_is_globe:new o.cd(re),u_viewport:new o.cg(re)}))(n)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(re=>({u_cutoff_params:new o.d0(re)}))(n)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(re=>({u_lighting_ambient_color:new o.ce(re),u_lighting_directional_dir:new o.ce(re),u_lighting_directional_color:new o.ce(re),u_ground_radiance:new o.ce(re)}))(n)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(re=>({u_light_matrix_0:new o.ch(re),u_light_matrix_1:new o.ch(re),u_fade_range:new o.cg(re),u_shadow_normal_offset:new o.ce(re),u_shadow_intensity:new o.cf(re),u_shadow_texel_size:new o.cf(re),u_shadow_map_resolution:new o.cf(re),u_shadow_direction:new o.ce(re),u_shadow_bias:new o.ce(re),u_shadowmap_0:new o.cd(re),u_shadowmap_1:new o.cd(re)}))(n))}}setTerrainUniformValues(n,l){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in l)d[y]&&d[y].set(this.program,y,l[y])}}setGlobeUniformValues(n,l){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in l)d[y]&&d[y].set(this.program,y,l[y])}}setFogUniformValues(n,l){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in l)d[y].set(this.program,y,l[y])}}setCutoffUniformValues(n,l){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in l)d[y].set(this.program,y,l[y])}}setLightsUniformValues(n,l){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in l)d[y].set(this.program,y,l[y])}}setShadowUniformValues(n,l){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;n.program.set(this.program);for(const y in l)d[y].set(this.program,y,l[y])}_drawDebugWireframe(n,l,d,y,x,S,A,C,k,z){const V=n.options.wireframe;if(V.terrain===!1&&V.layers2D===!1&&V.layers3D===!1)return;const j=n.context;if(!(!(!V.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!V.layers2D||n._terrain&&n._terrain.renderingToTexture||!Sh.includes(this.name))||!(!V.layers3D||!Sf.includes(this.name))))return;const q=j.gl,Q=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,x,j);if(!Q)return;const Y=[...this.fixedDefines];Y.push("DEBUG_WIREFRAME");const re=n.getOrCreateProgram(this.name,{config:this.configuration,defines:Y});j.program.set(re.program);const te=(ye,Ee,Ce)=>{if(Ee[ye]&&Ce[ye])for(const Re in Ee[ye])Ce[ye][Re]&&Ce[ye][Re].set(Ce.program,Re,Ee[ye][Re].current)};k&&k.setUniforms(re.program,j,re.binderUniforms,A,{zoom:C}),te("fixedUniforms",this,re),te("terrainUniforms",this,re),te("globeUniforms",this,re),te("fogUniforms",this,re),te("lightsUniforms",this,re),te("shadowUniforms",this,re),Q.bind(),j.setColorMode(new Wr([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],o.am.transparent,[!0,!0,!0,!1])),j.setDepthMode(new er(l.func===q.LESS?q.LEQUAL:l.func,er.ReadOnly,l.range)),j.setStencilMode(Ir.disabled);const ce=3*S.primitiveLength*2,me=3*S.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ye=z||1;for(let Ee=0;Ee<ye;++Ee)re.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ee),q.drawElements(q.LINES,ce,q.UNSIGNED_SHORT,me)}else z&&z>1?q.drawElementsInstanced(q.LINES,ce,q.UNSIGNED_SHORT,me,z):q.drawElements(q.LINES,ce,q.UNSIGNED_SHORT,me);x.bind(),j.program.set(this.program),j.setDepthMode(l),j.setStencilMode(d),j.setColorMode(y)}checkUniforms(n,l,d){if(this.fixedDefines.includes(l)){for(const y of Object.keys(d))if(!d[y].initialized)throw new Error(`Program '${this.name}', from draw '${n}': uniform ${y} not set but required by ${l} being defined`)}}draw(n,l,d,y,x,S,A,C,k,z,V,j,q,Q,Y,re){const te=n.context,ce=te.gl;if(this.failedToCreate)return;te.program.set(this.program),te.setDepthMode(d),te.setStencilMode(y),te.setColorMode(x),te.setCullFace(S);for(const Ee of Object.keys(this.fixedUniforms))this.fixedUniforms[Ee].set(this.program,Ee,A[Ee]);Q&&Q.setUniforms(this.program,te,this.binderUniforms,j,{zoom:q});const me={[ce.POINTS]:1,[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[l];this.checkUniforms(C,"RENDER_SHADOWS",this.shadowUniforms);const ye=re&&re>0?1:void 0;for(const Ee of V.get()){const Ce=Ee.vaos||(Ee.vaos={});if((Ce[C]||(Ce[C]=new R_)).bind(te,this,k,Q?Q.getPaintVertexBuffers():[],z,Ee.vertexOffset,Y||[],ye),this.forceManualRenderingForInstanceIDShaders){const Re=re||1;for(let Ae=0;Ae<Re;++Ae)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ae),z?ce.drawElements(l,Ee.primitiveLength*me,ce.UNSIGNED_SHORT,Ee.primitiveOffset*me*2):ce.drawArrays(l,Ee.vertexOffset,Ee.vertexLength)}else re&&re>1?ce.drawElementsInstanced(l,Ee.primitiveLength*me,ce.UNSIGNED_SHORT,Ee.primitiveOffset*me*2,re):z?ce.drawElements(l,Ee.primitiveLength*me,ce.UNSIGNED_SHORT,Ee.primitiveOffset*me*2):ce.drawArrays(l,Ee.vertexOffset,Ee.vertexLength);l===ce.TRIANGLES&&z&&this._drawDebugWireframe(n,d,y,x,z,Ee,j,q,Q,re)}}}function yu(f,n,l=0){const d=Math.pow(2,n.tileID.overscaledZ),y=n.tileSize*Math.pow(2,f.transform.tileZoom)/d,x=y*(n.tileID.canonical.x+n.tileID.wrap*d),S=y*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.aw(n,1,f.transform.tileZoom),u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S],u_pattern_transition:l}}const Nl={terrain:0,flat:1},Ld=o.bz(),Kp=(f,n,l,d,y,x,S,A,C,k,z,V,j,q,Q,Y,re,te)=>{const ce=n.style.light,me=ce.properties.get("position"),ye=[me.x,me.y,me.z],Ee=o.dJ();ce.properties.get("anchor")==="viewport"&&(o.dK(Ee,-n.transform.angle),o.dL(ye,ye,Ee));const Ce=ce.properties.get("color").toPremultipliedRenderColor(null),Re=n.transform,Ae={u_matrix:f,u_lightpos:ye,u_lightintensity:ce.properties.get("intensity"),u_lightcolor:[Ce.r,Ce.g,Ce.b],u_vertical_gradient:+l,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ld,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Nl[k],u_base_type:Nl[z],u_ao:y,u_edge_radius:x,u_width_scale:S,u_flood_light_color:Q,u_vertical_scale:Y,u_flood_light_intensity:re,u_ground_shadow_factor:te};return Re.projection.name==="globe"&&(Ae.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],Ae.u_zoom_transition=V,Ae.u_inv_rot_matrix=q,Ae.u_merc_center=j,Ae.u_up_dir=Re.projection.upVector(new o.cA(0,0,0),j[0]*o.aj,j[1]*o.aj),Ae.u_height_lift=C),Ae},jl=(f,n,l,d,y,x)=>({u_matrix:f,u_edge_radius:n,u_width_scale:l,u_vertical_scale:d,u_height_type:Nl[y],u_base_type:Nl[x]}),ks=(f,n,l,d,y,x,S,A,C,k,z,V,j,q,Q,Y,re,te)=>{const ce=Kp(f,n,l,d,y,x,S,A,k,z,V,j,q,Q,Y,re,1,[0,0,0]),me={u_height_factor:-Math.pow(2,A.overscaledZ)/C.tileSize/8};return o.h(ce,yu(n,C,te),me)},vu=(f,n,l)=>({u_matrix:f,u_emissive_strength:n,u_ground_shadow_factor:l}),Tf=(f,n,l,d,y,x=0)=>o.h(vu(f,n,y),yu(l,d,x)),zd=(f,n,l,d)=>({u_matrix:f,u_world:l,u_emissive_strength:n,u_ground_shadow_factor:d}),xs=(f,n,l,d,y,x,S=0)=>o.h(Tf(f,n,l,d,x,S),{u_world:y}),bs=(f,n)=>({u_matrix:f,u_ground_shadow_factor:n}),yl=(f,n,l,d,y)=>({u_matrix:f,u_camera_pos:[n[0],n[1],n[2]],u_depth_bias:l,u_height_scale:d,u_reset_depth:y}),Ls=(f,n)=>({u_matrix:f,u_normal_matrix:n,u_opacity:1}),zs=f=>({u_matrix:f}),Mc=f=>({u_matrix:f}),xu=(f,n,l,d,y,x,S,A)=>{const C=o.aj/x.tileSize;return{u_matrix:f,u_inv_rot_matrix:n,u_camera_to_center_distance:l.getCameraToCenterDistance(A),u_extrude_scale:[l.pixelsToGLUnits[0]/C,l.pixelsToGLUnits[1]/C],u_zoom_transition:d,u_tile_id:S,u_merc_center:y}},Ef=(f,n,l=1)=>({u_matrix:f,u_color:n,u_overlay:0,u_overlay_scale:l}),Fd=o.bz(),qa=(f,n,l,d,y,x,S)=>{const A=f.transform,C=A.projection.name==="globe",k=C?o.dM(A.zoom,n.canonical)*A._pixelsPerMercatorPixel:o.aw(l,1,x),z={u_matrix:n.projMatrix,u_extrude_scale:k,u_intensity:S,u_inv_rot_matrix:Fd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){z.u_inv_rot_matrix=d,z.u_merc_center=y,z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],z.u_zoom_transition=o.ah(A.zoom);const V=y[0]*o.aj,j=y[1]*o.aj;z.u_up_dir=A.projection.upVector(new o.cA(0,0,0),V,j)}return z};function da(f,[n,l,d,y],[x,S]){if(x===S)return[0,0,0,0];const A=255*(f-1)/(f*(S-x));return[n*A,l*A,d*A,y*A]}function Ci(f,n,[l,d]){return l===d?0:.5/f+(n-l)*(f-1)/(f*(d-l))}const ls=(f,n,l,d,y,x,S,A,C,k,z,V,j,q,Q,Y,re,te,ce,me,ye)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:l,u_merc_matrix:d,u_grid_matrix:y,u_tl_parent:x,u_scale_parent:k,u_fade_t:z.mix,u_opacity:z.opacity*V.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:V.paint.get("raster-brightness-min"),u_brightness_high:V.paint.get("raster-brightness-max"),u_saturation_factor:o.dO(V.paint.get("raster-saturation")),u_contrast_factor:o.dN(V.paint.get("raster-contrast")),u_spin_weights:Ul(V.paint.get("raster-hue-rotate")),u_perspective_transform:j,u_raster_elevation:q,u_zoom_transition:S,u_merc_center:A,u_cutoff_params:C,u_colorization_mix:da(o.dP,Y,te),u_colorization_offset:Ci(o.dP,re,te),u_color_ramp:Q,u_texture_offset:[me/(ce+2*me),ce/(ce+2*me)],u_texture_res:[ce+2*me,ce+2*me],u_emissive_strength:ye});function Ul(f){f*=Math.PI/180;const n=Math.sin(f),l=Math.cos(f);return[(2*l+1)/3,(-Math.sqrt(3)*n-l+1)/3,(Math.sqrt(3)*n-l+1)/3]}const Vl=.05,Th=(f,n,l,d,y,x,S,A,C,k,z,V)=>({u_matrix:f,u_normalize_matrix:n,u_globe_matrix:l,u_merc_matrix:d,u_grid_matrix:y,u_tl_parent:x,u_scale_parent:k,u_fade_t:z.mix,u_opacity:z.opacity,u_image0:0,u_image1:1,u_raster_elevation:V,u_zoom_transition:S,u_merc_center:A,u_cutoff_params:C}),Bd=(f,n,l,d,y,x,S,A,C,k)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_tile_offset:l,u_velocity:d,u_color_ramp:x,u_velocity_res:y,u_max_speed:S,u_uv_offset:A,u_data_scale:[255*C[0],255*C[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Vl,Vl]}),Yp=(f,n,l,d,y,x,S,A,C,k)=>({u_particle_texture:f,u_particle_texture_side_len:n,u_velocity:l,u_velocity_res:d,u_max_speed:y,u_speed_factor:x,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:A,u_data_scale:[255*C[0],255*C[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Vl,Vl]}),bu=o.bz(),Af=(f,n,l,d,y,x,S,A,C,k,z,V,j,q,Q,Y,re,te,ce,me,ye,Ee,Ce,Re)=>{const Ae=y.transform,Pe={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Ae.getCameraToCenterDistance(ce),u_rotate_symbol:+l,u_aspect_ratio:Ae.width/Ae.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:S,u_coord_matrix:A,u_is_text:+k,u_elevation_from_sea:C?1:0,u_pitch_with_map:+d,u_texsize:z,u_texsize_icon:V,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:bu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:bu,u_up_vector:[0,-1,0],u_color_adj_mat:Ee,u_icon_transition:Ce||0,u_gamma_scale:d?y.transform.getCameraToCenterDistance(ce)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Re||1,u_ground_shadow_factor:me,u_inv_matrix:o.bi(o.bz(),S),u_normal_scale:ye};return ce.name==="globe"&&(Pe.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],Pe.u_zoom_transition=Q,Pe.u_inv_rot_matrix=re,Pe.u_merc_center=Y,Pe.u_camera_forward=Ae._camera.forward(),Pe.u_ecef_origin=o.dQ(Ae.globeMatrix,q.toUnwrapped()),Pe.u_tile_matrix=Float32Array.from(Ae.globeMatrix),Pe.u_up_vector=te),Pe},wu=(f,n,l,d)=>({u_matrix:f,u_emissive_strength:n,u_opacity:l,u_color:d}),Pf=(f,n,l,d,y,x,S,A,C)=>o.h((function(k,z,V,j,q,Q){const{width:Y,height:re}=j.imageManager.getPixelSize(z),te=Math.pow(2,Q.tileID.overscaledZ),ce=Q.tileSize*Math.pow(2,j.transform.tileZoom)/te,me=ce*(Q.tileID.canonical.x+Q.tileID.wrap*te),ye=ce*Q.tileID.canonical.y;return{u_image:0,u_pattern_tl:V.tl,u_pattern_br:V.br,u_texsize:[Y,re],u_pattern_size:V.displaySize,u_pattern_units_to_pixels:q?[j.transform.width,-1*j.transform.height]:[1/o.aw(Q,1,j.transform.tileZoom),1/o.aw(Q,1,j.transform.tileZoom)],u_pixel_coord_upper:[me>>16,ye>>16],u_pixel_coord_lower:[65535&me,65535&ye]}})(0,x,S,d,A,C),{u_matrix:f,u_emissive_strength:n,u_opacity:l}),Su=new Float32Array(o.bx([])),Tu=(f,n,l,d,y,x,S,A,C,k,z,V,j,q=[0,0,0],Q)=>{const Y=y.style.light,re=Y.properties.get("position"),te=[-re.x,-re.y,re.z],ce=o.dJ();Y.properties.get("anchor")==="viewport"&&(o.dK(ce,-y.transform.angle),o.dL(te,te,ce));const me=z.alphaMode==="MASK",ye=Y.properties.get("color").toNonPremultipliedRenderColor(null),Ee=j.paint.get("model-ambient-occlusion-intensity"),Ce=j.paint.get("model-color").constantOr(o.am.white).toNonPremultipliedRenderColor(null);return Ce.a=j.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:f,u_lighting_matrix:n,u_normal_matrix:l,u_node_matrix:d||Su,u_lightpos:te,u_lightintensity:Y.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_camera_pos:q,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+me,u_alphaCutoff:z.alphaCutoff,u_baseColorFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:A.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:C,u_roughnessFactor:k,u_baseColorTexture:fa.BaseColor,u_metallicRoughnessTexture:fa.MetallicRoughness,u_normalTexture:fa.Normal,u_occlusionTexture:fa.Occlusion,u_emissionTexture:fa.Emission,u_lutTexture:fa.LUT,u_color_mix:Ce.toArray01(),u_aoIntensity:Ee,u_emissive_strength:V,u_occlusionTextureTransform:Q||[0,0,0,0]}},If=(f,n=Su,l=Su)=>({u_matrix:f,u_instance:n,u_node_matrix:l}),Jp={fillExtrusion:f=>({u_matrix:new o.ch(f),u_lightpos:new o.ce(f),u_lightintensity:new o.cf(f),u_lightcolor:new o.ce(f),u_vertical_gradient:new o.cf(f),u_opacity:new o.cf(f),u_edge_radius:new o.cf(f),u_width_scale:new o.cf(f),u_ao:new o.cg(f),u_height_type:new o.cd(f),u_base_type:new o.cd(f),u_tile_id:new o.ce(f),u_zoom_transition:new o.cf(f),u_inv_rot_matrix:new o.ch(f),u_merc_center:new o.cg(f),u_up_dir:new o.ce(f),u_height_lift:new o.cf(f),u_flood_light_color:new o.ce(f),u_vertical_scale:new o.cf(f),u_flood_light_intensity:new o.cf(f),u_ground_shadow_factor:new o.ce(f)}),fillExtrusionDepth:f=>({u_matrix:new o.ch(f),u_edge_radius:new o.cf(f),u_width_scale:new o.cf(f),u_vertical_scale:new o.cf(f),u_height_type:new o.cd(f),u_base_type:new o.cd(f)}),fillExtrusionPattern:f=>({u_matrix:new o.ch(f),u_lightpos:new o.ce(f),u_lightintensity:new o.cf(f),u_lightcolor:new o.ce(f),u_vertical_gradient:new o.cf(f),u_height_factor:new o.cf(f),u_edge_radius:new o.cf(f),u_width_scale:new o.cf(f),u_ao:new o.cg(f),u_height_type:new o.cd(f),u_base_type:new o.cd(f),u_tile_id:new o.ce(f),u_zoom_transition:new o.cf(f),u_inv_rot_matrix:new o.ch(f),u_merc_center:new o.cg(f),u_up_dir:new o.ce(f),u_height_lift:new o.cf(f),u_image:new o.cd(f),u_texsize:new o.cg(f),u_pixel_coord_upper:new o.cg(f),u_pixel_coord_lower:new o.cg(f),u_tile_units_to_pixels:new o.cf(f),u_opacity:new o.cf(f),u_pattern_transition:new o.cf(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new o.ch(f),u_opacity:new o.cf(f),u_ao_pass:new o.cf(f),u_meter_to_tile:new o.cf(f),u_ao:new o.cg(f),u_flood_light_intensity:new o.cf(f),u_flood_light_color:new o.ce(f),u_attenuation:new o.cf(f),u_edge_radius:new o.cf(f),u_fb:new o.cd(f),u_fb_size:new o.cf(f),u_dynamic_offset:new o.cf(f)}),fill:f=>({u_matrix:new o.ch(f),u_emissive_strength:new o.cf(f),u_ground_shadow_factor:new o.ce(f)}),fillPattern:f=>({u_matrix:new o.ch(f),u_emissive_strength:new o.cf(f),u_image:new o.cd(f),u_texsize:new o.cg(f),u_pixel_coord_upper:new o.cg(f),u_pixel_coord_lower:new o.cg(f),u_tile_units_to_pixels:new o.cf(f),u_ground_shadow_factor:new o.ce(f),u_pattern_transition:new o.cf(f)}),fillOutline:f=>({u_matrix:new o.ch(f),u_emissive_strength:new o.cf(f),u_world:new o.cg(f),u_ground_shadow_factor:new o.ce(f)}),fillOutlinePattern:f=>({u_matrix:new o.ch(f),u_emissive_strength:new o.cf(f),u_world:new o.cg(f),u_image:new o.cd(f),u_texsize:new o.cg(f),u_pixel_coord_upper:new o.cg(f),u_pixel_coord_lower:new o.cg(f),u_tile_units_to_pixels:new o.cf(f),u_ground_shadow_factor:new o.ce(f),u_pattern_transition:new o.cf(f)}),building:f=>({u_matrix:new o.ch(f),u_normal_matrix:new o.ch(f),u_opacity:new o.cf(f)}),buildingBloom:f=>({u_matrix:new o.ch(f)}),buildingDepth:f=>({u_matrix:new o.ch(f)}),elevatedStructuresDepth:f=>({u_matrix:new o.ch(f),u_depth_bias:new o.cf(f)}),elevatedStructures:f=>({u_matrix:new o.ch(f),u_ground_shadow_factor:new o.ce(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new o.ch(f),u_camera_pos:new o.ce(f),u_depth_bias:new o.cf(f),u_height_scale:new o.cf(f),u_reset_depth:new o.cf(f)}),circle:o.dT,collisionBox:f=>({u_matrix:new o.ch(f),u_inv_rot_matrix:new o.ch(f),u_camera_to_center_distance:new o.cf(f),u_extrude_scale:new o.cg(f),u_zoom_transition:new o.cf(f),u_merc_center:new o.cg(f),u_tile_id:new o.ce(f)}),collisionCircle:f=>({u_matrix:new o.ch(f),u_inv_matrix:new o.ch(f),u_camera_to_center_distance:new o.cf(f),u_viewport_size:new o.cg(f)}),debug:f=>({u_color:new o.dv(f),u_matrix:new o.ch(f),u_overlay:new o.cd(f),u_overlay_scale:new o.cf(f)}),clippingMask:f=>({u_matrix:new o.ch(f)}),heatmap:f=>({u_extrude_scale:new o.cf(f),u_intensity:new o.cf(f),u_matrix:new o.ch(f),u_inv_rot_matrix:new o.ch(f),u_merc_center:new o.cg(f),u_tile_id:new o.ce(f),u_zoom_transition:new o.cf(f),u_up_dir:new o.ce(f)}),heatmapTexture:f=>({u_image:new o.cd(f),u_color_ramp:new o.cd(f),u_opacity:new o.cf(f)}),hillshade:f=>({u_matrix:new o.ch(f),u_image:new o.cd(f),u_latrange:new o.cg(f),u_light:new o.cg(f),u_shadow:new o.dv(f),u_highlight:new o.dv(f),u_emissive_strength:new o.cf(f),u_accent:new o.dv(f)}),hillshadePrepare:f=>({u_matrix:new o.ch(f),u_image:new o.cd(f),u_dimension:new o.cg(f),u_zoom:new o.cf(f)}),line:o.dS,linePattern:o.dR,raster:f=>({u_matrix:new o.ch(f),u_normalize_matrix:new o.ch(f),u_globe_matrix:new o.ch(f),u_merc_matrix:new o.ch(f),u_grid_matrix:new o.dw(f),u_tl_parent:new o.cg(f),u_scale_parent:new o.cf(f),u_fade_t:new o.cf(f),u_opacity:new o.cf(f),u_image0:new o.cd(f),u_image1:new o.cd(f),u_brightness_low:new o.cf(f),u_brightness_high:new o.cf(f),u_saturation_factor:new o.cf(f),u_contrast_factor:new o.cf(f),u_spin_weights:new o.ce(f),u_perspective_transform:new o.cg(f),u_raster_elevation:new o.cf(f),u_zoom_transition:new o.cf(f),u_merc_center:new o.cg(f),u_cutoff_params:new o.d0(f),u_colorization_mix:new o.d0(f),u_colorization_offset:new o.cf(f),u_color_ramp:new o.cd(f),u_texture_offset:new o.cg(f),u_texture_res:new o.cg(f),u_emissive_strength:new o.cf(f)}),rasterParticle:f=>({u_matrix:new o.ch(f),u_normalize_matrix:new o.ch(f),u_globe_matrix:new o.ch(f),u_merc_matrix:new o.ch(f),u_grid_matrix:new o.dw(f),u_tl_parent:new o.cg(f),u_scale_parent:new o.cf(f),u_fade_t:new o.cf(f),u_opacity:new o.cf(f),u_image0:new o.cd(f),u_image1:new o.cd(f),u_raster_elevation:new o.cf(f),u_zoom_transition:new o.cf(f),u_merc_center:new o.cg(f),u_cutoff_params:new o.d0(f)}),rasterParticleTexture:f=>({u_texture:new o.cd(f),u_opacity:new o.cf(f)}),rasterParticleDraw:f=>({u_particle_texture:new o.cd(f),u_particle_texture_side_len:new o.cf(f),u_tile_offset:new o.cg(f),u_velocity:new o.cd(f),u_color_ramp:new o.cd(f),u_velocity_res:new o.cg(f),u_max_speed:new o.cf(f),u_uv_offset:new o.cg(f),u_data_scale:new o.cg(f),u_data_offset:new o.cf(f),u_particle_pos_scale:new o.cf(f),u_particle_pos_offset:new o.cg(f)}),rasterParticleUpdate:f=>({u_particle_texture:new o.cd(f),u_particle_texture_side_len:new o.cf(f),u_velocity:new o.cd(f),u_velocity_res:new o.cg(f),u_max_speed:new o.cf(f),u_speed_factor:new o.cf(f),u_reset_rate:new o.cf(f),u_rand_seed:new o.cf(f),u_uv_offset:new o.cg(f),u_data_scale:new o.cg(f),u_data_offset:new o.cf(f),u_particle_pos_scale:new o.cf(f),u_particle_pos_offset:new o.cg(f)}),symbol:f=>({u_is_size_zoom_constant:new o.cd(f),u_is_size_feature_constant:new o.cd(f),u_size_t:new o.cf(f),u_size:new o.cf(f),u_camera_to_center_distance:new o.cf(f),u_rotate_symbol:new o.cd(f),u_aspect_ratio:new o.cf(f),u_fade_change:new o.cf(f),u_matrix:new o.ch(f),u_label_plane_matrix:new o.ch(f),u_coord_matrix:new o.ch(f),u_is_text:new o.cd(f),u_elevation_from_sea:new o.cd(f),u_pitch_with_map:new o.cd(f),u_texsize:new o.cg(f),u_texsize_icon:new o.cg(f),u_texture:new o.cd(f),u_texture_icon:new o.cd(f),u_gamma_scale:new o.cf(f),u_device_pixel_ratio:new o.cf(f),u_tile_id:new o.ce(f),u_zoom_transition:new o.cf(f),u_inv_rot_matrix:new o.ch(f),u_merc_center:new o.cg(f),u_camera_forward:new o.ce(f),u_tile_matrix:new o.ch(f),u_up_vector:new o.ce(f),u_ecef_origin:new o.ce(f),u_is_halo:new o.cd(f),u_icon_transition:new o.cf(f),u_color_adj_mat:new o.ch(f),u_scale_factor:new o.cf(f),u_ground_shadow_factor:new o.ce(f),u_inv_matrix:new o.ch(f),u_normal_scale:new o.cf(f)}),background:f=>({u_matrix:new o.ch(f),u_emissive_strength:new o.cf(f),u_opacity:new o.cf(f),u_color:new o.dv(f)}),backgroundPattern:f=>({u_matrix:new o.ch(f),u_emissive_strength:new o.cf(f),u_opacity:new o.cf(f),u_image:new o.cd(f),u_pattern_tl:new o.cg(f),u_pattern_br:new o.cg(f),u_texsize:new o.cg(f),u_pattern_size:new o.cg(f),u_pixel_coord_upper:new o.cg(f),u_pixel_coord_lower:new o.cg(f),u_pattern_units_to_pixels:new o.cg(f)}),terrainRaster:f=>({u_matrix:new o.ch(f),u_image0:new o.cd(f),u_skirt_height:new o.cf(f),u_ground_shadow_factor:new o.ce(f)}),skybox:f=>({u_matrix:new o.ch(f),u_sun_direction:new o.ce(f),u_cubemap:new o.cd(f),u_opacity:new o.cf(f),u_temporal_offset:new o.cf(f)}),skyboxGradient:f=>({u_matrix:new o.ch(f),u_color_ramp:new o.cd(f),u_center_direction:new o.ce(f),u_radius:new o.cf(f),u_opacity:new o.cf(f),u_temporal_offset:new o.cf(f)}),skyboxCapture:f=>({u_matrix_3f:new o.dw(f),u_sun_direction:new o.ce(f),u_sun_intensity:new o.cf(f),u_color_tint_r:new o.d0(f),u_color_tint_m:new o.d0(f),u_luminance:new o.cf(f)}),globeRaster:f=>({u_proj_matrix:new o.ch(f),u_globe_matrix:new o.ch(f),u_normalize_matrix:new o.ch(f),u_merc_matrix:new o.ch(f),u_zoom_transition:new o.cf(f),u_merc_center:new o.cg(f),u_image0:new o.cd(f),u_grid_matrix:new o.dw(f),u_skirt_height:new o.cf(f),u_far_z_cutoff:new o.cf(f),u_frustum_tl:new o.ce(f),u_frustum_tr:new o.ce(f),u_frustum_br:new o.ce(f),u_frustum_bl:new o.ce(f),u_globe_pos:new o.ce(f),u_globe_radius:new o.cf(f),u_viewport:new o.cg(f)}),globeAtmosphere:f=>({u_frustum_tl:new o.ce(f),u_frustum_tr:new o.ce(f),u_frustum_br:new o.ce(f),u_frustum_bl:new o.ce(f),u_horizon:new o.cf(f),u_transition:new o.cf(f),u_fadeout_range:new o.cf(f),u_color:new o.d0(f),u_high_color:new o.d0(f),u_space_color:new o.d0(f),u_temporal_offset:new o.cf(f),u_horizon_angle:new o.cf(f)}),model:f=>({u_matrix:new o.ch(f),u_lighting_matrix:new o.ch(f),u_normal_matrix:new o.ch(f),u_node_matrix:new o.ch(f),u_lightpos:new o.ce(f),u_lightintensity:new o.cf(f),u_lightcolor:new o.ce(f),u_camera_pos:new o.ce(f),u_opacity:new o.cf(f),u_baseColorFactor:new o.d0(f),u_emissiveFactor:new o.d0(f),u_metallicFactor:new o.cf(f),u_roughnessFactor:new o.cf(f),u_baseTextureIsAlpha:new o.cd(f),u_alphaMask:new o.cd(f),u_alphaCutoff:new o.cf(f),u_baseColorTexture:new o.cd(f),u_metallicRoughnessTexture:new o.cd(f),u_normalTexture:new o.cd(f),u_occlusionTexture:new o.cd(f),u_emissionTexture:new o.cd(f),u_lutTexture:new o.cd(f),u_color_mix:new o.d0(f),u_aoIntensity:new o.cf(f),u_emissive_strength:new o.cf(f),u_occlusionTextureTransform:new o.d0(f)}),modelDepth:f=>({u_matrix:new o.ch(f),u_instance:new o.ch(f),u_node_matrix:new o.ch(f)}),groundShadow:f=>({u_matrix:new o.ch(f),u_ground_shadow_factor:new o.ce(f)}),stars:f=>({u_matrix:new o.ch(f),u_up:new o.ce(f),u_right:new o.ce(f),u_intensity_multiplier:new o.cf(f)}),snowParticle:f=>({u_modelview:new o.ch(f),u_projection:new o.ch(f),u_time:new o.cf(f),u_cam_pos:new o.ce(f),u_velocityConeAperture:new o.cf(f),u_velocity:new o.cf(f),u_horizontalOscillationRadius:new o.cf(f),u_horizontalOscillationRate:new o.cf(f),u_boxSize:new o.cf(f),u_billboardSize:new o.cf(f),u_simpleShapeParameters:new o.cg(f),u_screenSize:new o.cg(f),u_thinningCenterPos:new o.cg(f),u_thinningShape:new o.ce(f),u_thinningAffectedRatio:new o.cf(f),u_thinningParticleOffset:new o.cf(f),u_particleColor:new o.d0(f),u_direction:new o.ce(f)}),rainParticle:f=>({u_modelview:new o.ch(f),u_projection:new o.ch(f),u_time:new o.cf(f),u_cam_pos:new o.ce(f),u_texScreen:new o.cd(f),u_velocityConeAperture:new o.cf(f),u_velocity:new o.cf(f),u_boxSize:new o.cf(f),u_rainDropletSize:new o.cg(f),u_distortionStrength:new o.cf(f),u_rainDirection:new o.ce(f),u_color:new o.d0(f),u_screenSize:new o.cg(f),u_thinningCenterPos:new o.cg(f),u_thinningShape:new o.ce(f),u_thinningAffectedRatio:new o.cf(f),u_thinningParticleOffset:new o.cf(f),u_shapeDirectionalPower:new o.cf(f),u_shapeNormalPower:new o.cf(f),u_mode:new o.cf(f)}),vignette:f=>({u_vignetteShape:new o.ce(f),u_vignetteColor:new o.d0(f)}),occlusion:f=>({u_matrix:new o.ch(f),u_anchorPos:new o.ce(f),u_screenSizePx:new o.cg(f),u_occluderSizePx:new o.cg(f),u_color:new o.d0(f)})};class $l{constructor(n,l,d,y){this.id=$l.uniqueIdxCounter,$l.uniqueIdxCounter++,this.context=n;const x=n.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||y||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=$l.uniqueIdxCounter,$l.uniqueIdxCounter++;const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}$l.uniqueIdxCounter=0;const Oc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Nd{constructor(n,l,d,y,x,S){this.length=l.length,this.attributes=d,this.itemSize=l.bytesPerElement,this.dynamicDraw=y,this.instanceCount=S,this.context=n;const A=n.gl;this.buffer=A.createBuffer(),n.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||x||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,l){for(let d=0;d<this.attributes.length;d++){const y=l.attributes[this.attributes[d].name];y!==void 0&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,l,d){for(let y=0;y<this.attributes.length;y++){const x=this.attributes[y],S=l.attributes[x.name];S!==void 0&&n.vertexAttribPointer(S,x.components,n[Oc[x.type]],!1,this.itemSize,x.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(n,l,d){for(let y=0;y<this.attributes.length;y++){const x=l.attributes[this.attributes[y].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(x,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vl{constructor(n,l,d,y,x){this.context=n,this.width=l,this.height=d;const S=this.framebuffer=n.gl.createFramebuffer();y&&(this.colorAttachment=new _u(n,S)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new bh(n,S):new Pc(n,S))}destroy(){const n=this.context.gl;if(this.colorAttachment){const l=this.colorAttachment.get();l&&n.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const l=this.depthAttachment.get();l&&n.deleteRenderbuffer(l)}else{const l=this.depthAttachment.get();l&&n.deleteTexture(l)}n.deleteFramebuffer(this.framebuffer)}}class Eu{constructor(n,l){this.gl=n,this.clearColor=new qp(this),this.clearDepth=new Id(this),this.clearStencil=new yf(this),this.colorMask=new Xm(this),this.depthMask=new Cd(this),this.stencilMask=new vf(this),this.stencilFunc=new gu(this),this.stencilOp=new mh(this),this.stencilTest=new Gp(this),this.depthRange=new Hp(this),this.depthTest=new Md(this),this.depthFunc=new Od(this),this.blend=new dl(this),this.blendFunc=new Fl(this),this.blendColor=new gh(this),this.blendEquation=new _h(this),this.cullFace=new Ec(this),this.cullFaceSide=new Rd(this),this.frontFace=new Wp(this),this.program=new Zp(this),this.activeTexture=new yh(this),this.viewport=new Dd(this),this.bindFramebuffer=new vh(this),this.bindRenderbuffer=new pl(this),this.bindTexture=new xf(this),this.bindVertexBuffer=new ml(this),this.bindElementBuffer=new Ds(this),this.bindVertexArrayOES=new xh(this),this.pixelStoreUnpack=new gl(this),this.pixelStoreUnpackPremultiplyAlpha=new Ac(this),this.pixelStoreUnpackFlipY=new Km(this),this.options=l?Object.assign({},l):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=l&&!!l.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,l,d){return new $l(this,n,l,d)}createVertexBuffer(n,l,d,y,x){return new Nd(this,n,l,d,y,x)}createRenderbuffer(n,l,d){const y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,n,l,d),this.bindRenderbuffer.set(null),x}createFramebuffer(n,l,d,y){return new vl(this,n,l,d,y)}clear({color:n,depth:l,stencil:d,colorMask:y}){const x=this.gl;let S=0;n&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(n.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),l!==void 0&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),d!==void 0&&(S|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),x.clear(S)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){o.bv(n.blendFunction,Wr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let cs;function Cf(f,n,l,d,y,x,S){const A=f.context,C=A.gl,k=f.transform,z=[o.aD(k.center.lng),o.aH(k.center.lat)],V=l.layout.get("symbol-placement"),j=l.layout.get("text-variable-anchor"),q=l.layout.get("icon-rotation-alignment")==="map",Q=l.layout.get("text-rotation-alignment")==="map",Y=V!=="point",re=[];let te=0,ce=0;for(let Pe=0;Pe<d.length;Pe++){const Ie=d[Pe],Ye=n.getTile(Ie),Be=Ye.getBucket(l);if(!Be)continue;const dt=Be.getProjection().createInversionMatrix(k,Ie.canonical),rt=[],xt=rh(Ie,Be,k),It=!S&&q&&Y,We=S&&Q&&Y,ze=j&&Be.hasTextData(),ot=Be.hasIconTextFit()&&ze&&Be.hasIconData(),tt=It||We||S&&ze||ot,At=Be.projection.name==="globe",Pt=At?o.ah(k.zoom):0;At&&(rt.push("PROJECTION_GLOBE_VIEW"),tt&&rt.push("PROJECTED_POS_ON_VIEWPORT"));const Dt=f.getOrCreateProgram("collisionBox",{defines:rt});let Bt=xt;y[0]===0&&y[1]===0||(Bt=f.translatePosMatrix(xt,Ye,y,x));const cr=S?Be.textCollisionBox:Be.iconCollisionBox,pr=Be.collisionCircleArray;if(pr.length>0){const dr=o.bz(),ur=Bt;o.cM(dr,Be.placementInvProjMatrix,k.glCoordMatrix),o.cM(dr,dr,Be.placementViewportMatrix),re.push({circleArray:pr,circleOffset:ce,transform:ur,invTransform:dr,projection:Be.getProjection()}),te+=pr.length/4,ce=te}if(!cr)continue;f.terrain&&f.terrain.setupElevationDraw(Ye,Dt);const Jt=At?[Ie.canonical.x,Ie.canonical.y,1<<Ie.canonical.z]:[0,0,0];Dt.draw(f,C.LINES,er.disabled,Ir.disabled,f.colorModeForRenderPass(),Er.disabled,xu(Bt,dt,k,Pt,z,Ye,Jt,Be.getProjection()),l.id,cr.layoutVertexBuffer,cr.indexBuffer,cr.segments,null,k.zoom,null,[cr.collisionVertexBuffer,cr.collisionVertexBufferExt])}if(!S||!re.length)return;const me=f.getOrCreateProgram("collisionCircle"),ye=new o.dU;ye.resize(4*te),ye._trim();let Ee=0;for(const Pe of re)for(let Ie=0;Ie<Pe.circleArray.length/4;Ie++){const Ye=4*Ie,Be=Pe.circleArray[Ye+0],dt=Pe.circleArray[Ye+1],rt=Pe.circleArray[Ye+2],xt=Pe.circleArray[Ye+3];ye.emplace(Ee++,Be,dt,rt,xt,0),ye.emplace(Ee++,Be,dt,rt,xt,1),ye.emplace(Ee++,Be,dt,rt,xt,2),ye.emplace(Ee++,Be,dt,rt,xt,3)}(!cs||cs.length<2*te)&&(cs=(function(Pe){const Ie=2*Pe,Ye=new o.a_;Ye.resize(Ie),Ye._trim();for(let Be=0;Be<Ie;Be++){const dt=6*Be;Ye.uint16[dt+0]=4*Be+0,Ye.uint16[dt+1]=4*Be+1,Ye.uint16[dt+2]=4*Be+2,Ye.uint16[dt+3]=4*Be+2,Ye.uint16[dt+4]=4*Be+3,Ye.uint16[dt+5]=4*Be+0}return Ye})(te));const Ce=A.createIndexBuffer(cs,!0),Re=A.createVertexBuffer(ye,o.dV.members,!0);for(const Pe of re){const Ie={u_matrix:Pe.transform,u_inv_matrix:Pe.invTransform,u_camera_to_center_distance:(Ae=k).getCameraToCenterDistance(Pe.projection),u_viewport_size:[Ae.width,Ae.height]};me.draw(f,C.TRIANGLES,er.disabled,Ir.disabled,f.colorModeForRenderPass(),Er.disabled,Ie,l.id,Re,Ce,o.bd.simpleSegment(0,2*Pe.circleOffset,Pe.circleArray.length,Pe.circleArray.length/2),null,k.zoom)}var Ae;Re.destroy(),Ce.destroy()}const ql=o.bz();function Au(f){const n=f._camera.getWorldToCamera(f.worldSize,1),l=o.az([],n,f.globeMatrix);o.bi(l,l);const d=[0,0,0],y=[0,1,0,0];return o.aA(y,y,l),d[0]=y[0],d[1]=y[1],d[2]=y[2],o.au(d,d),d}function Mf({width:f,height:n,anchor:l,textOffset:d,textScale:y},x){const{horizontalAlign:S,verticalAlign:A}=o.bZ(l),C=-(S-.5)*f,k=-(A-.5)*n,z=o.b_(l,d);return new o.P((C/y+z[0])*x,(k/y+z[1])*x)}function Pu(f,n,l,d,y,x,S,A,C,k){const z=f.text.placedSymbolArray,V=f.text.dynamicLayoutVertexArray,j=f.icon.dynamicLayoutVertexArray,q={},Q=f.getProjection(),Y=Cl(S,Q,y),re=y.elevation,te=Q.upVectorScale(S.canonical,y.center.lat,y.worldSize).metersToTile;V.clear();for(let ce=0;ce<z.length;ce++){const me=z.get(ce),{tileAnchorX:ye,tileAnchorY:Ee,numGlyphs:Ce}=me,Re=me.hidden||!me.crossTileID||f.allowVerticalPlacement&&!me.placedOrientation?null:d[me.crossTileID];if(Re){let Ae=0,Pe=0,Ie=0;if(re){const ot=re?re.getAtTileOffset(S,ye,Ee):0,[tt,At,Pt]=Q.upVector(S.canonical,ye,Ee);Ae=ot*tt*te,Pe=ot*At*te,Ie=ot*Pt*te}let[Ye,Be,dt,rt]=Co(me.projectedAnchorX+Ae,me.projectedAnchorY+Pe,me.projectedAnchorZ+Ie,l?Y:x);const xt=af(y.getCameraToCenterDistance(Q),rt);let It=o.bJ(f.textSizeData,C,me)*xt/o.bU;l&&(It*=f.tilePixelRatio/A);const We=Mf(Re,It);l?({x:Ye,y:Be,z:dt}=Q.projectTilePoint(ye+We.x,Ee+We.y,S.canonical),[Ye,Be,dt]=Co(Ye+Ae,Be+Pe,dt+Ie,x)):(n&&We._rotate(-y.angle),Ye+=We.x,Be+=We.y,dt=0);const ze=f.allowVerticalPlacement&&me.placedOrientation===o.bI.vertical?Math.PI/2:0;for(let ot=0;ot<Ce;ot++)o.bL(V,Ye,Be,dt,ze);k&&me.associatedIconIndex>=0&&(q[me.associatedIconIndex]={x:Ye,y:Be,z:dt,angle:ze})}else ul(Ce,V)}if(k){j.clear();const ce=f.icon.placedSymbolArray;for(let me=0;me<ce.length;me++){const ye=ce.get(me),{numGlyphs:Ee}=ye,Ce=q[me];if(ye.hidden||!Ce)ul(Ee,j);else{const{x:Re,y:Ae,z:Pe,angle:Ie}=Ce;for(let Ye=0;Ye<Ee;Ye++)o.bL(j,Re,Ae,Pe,Ie)}}f.icon.dynamicLayoutVertexBuffer.updateData(j)}f.text.dynamicLayoutVertexBuffer.updateData(V)}function Ga(f,n,l,d,y,x,S={}){const A=l.paint.get("icon-translate"),C=l.paint.get("text-translate"),k=l.paint.get("icon-translate-anchor"),z=l.paint.get("text-translate-anchor"),V=l.layout.get("icon-rotation-alignment"),j=l.layout.get("text-rotation-alignment"),q=l.layout.get("icon-pitch-alignment"),Q=l.layout.get("text-pitch-alignment"),Y=l.layout.get("icon-keep-upright"),re=l.layout.get("text-keep-upright"),te=l.paint.get("icon-color-saturation"),ce=l.paint.get("icon-color-contrast"),me=l.paint.get("icon-color-brightness-min"),ye=l.paint.get("icon-color-brightness-max"),Ee=l.layout.get("symbol-elevation-reference")==="sea",Ce=f.context,Re=Ce.gl,Ae=f.transform,Pe=V==="map",Ie=j==="map",Ye=q==="map",Be=Q==="map",dt=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let rt=!1;const xt=f.depthModeForSublayer(0,er.ReadOnly),It=new er(f.context.gl.LEQUAL,er.ReadOnly,f.depthRangeFor3D),We=[o.aD(Ae.center.lng),o.aH(Ae.center.lat)],ze=l.layout.get("text-variable-anchor"),ot=Ae.projection.name==="globe",tt=[],At=[0,-1,0];for(const Pt of d){const Dt=n.getTile(Pt),Bt=Dt.getBucket(l);if(!Bt||Bt.projection.name==="mercator"&&ot||Bt.fullyClipped)continue;const cr=Bt.projection.name==="globe",pr=cr?o.ah(Ae.zoom):0,Jt=Cl(Pt,Bt.getProjection(),Ae),dr=Ae.calculatePixelsToTileUnitsMatrix(Dt),ur=ze&&Bt.hasTextData(),Lr=Bt.hasIconTextFit()&&ur&&Bt.hasIconData(),Vr=Bt.getProjection().createInversionMatrix(Ae,Pt.canonical),Xr=(1<<Dt.tileID.canonical.z)*o.aj/f.transform.worldSize,vn=Gn=>{let On=[0,0,0];if(Gn){const Ti=f.style.directionalLight,xn=f.style.ambientLight;Ti&&xn&&(On=Ll(f.style,Ti,xn))}return On},Ur=Gn=>{Ae.depthOcclusionForSymbolsAndCircles&&(l.hasInitialOcclusionOpacityProperties||f.terrain)&&(Gn.push("DEPTH_D24"),Gn.push("DEPTH_OCCLUSION"))},Sn=()=>{const Gn=Pe&&l.layout.get("symbol-placement")!=="point",On=[];Ur(On);const Ti=Gn||Lr,xn=Bt.elevationType==="road",zn=f.shadowRenderer,Wn=xn&&Ye&&!!zn&&zn.enabled,Gi=vn(Wn),ti=xn&&Ye&&!f.terrain?It:xt,ji=l.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Ye&&On.push("PITCH_WITH_MAP_TERRAIN"),cr&&(On.push("PROJECTION_GLOBE_VIEW"),Ti&&On.push("PROJECTED_POS_ON_VIEWPORT")),ji>0&&Bt.hasAnySecondaryIcon&&On.push("ICON_TRANSITION"),!Bt.icon.zOffsetVertexBuffer||xn&&f.terrain||On.push("Z_OFFSET"),te===0&&ce===0&&me===0&&ye===1||On.push("COLOR_ADJUSTMENT"),Bt.sdfIcons&&On.push("RENDER_SDF"),Wn&&On.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),xn&&Ye&&!f.terrain&&Bt.icon.orientationVertexBuffer&&On.push("ELEVATED_ROADS");const Do=Bt.icon.programConfigurations.get(l.id),Ko=f.getOrCreateProgram("symbol",{config:Do,defines:On}),Vo=Dt.imageAtlasTexture?Dt.imageAtlasTexture.size:[0,0],ko=Bt.iconSizeData,Ao=o.bH(ko,Ae.zoom),Oa=Ye||!Ae.isOrthographic,Xa=mc(Jt,Dt.tileID.canonical,Ye,Pe,Ae,Bt.getProjection(),dr),Yo=cl(Jt,Dt.tileID.canonical,Ye,Pe,Ae,Bt.getProjection(),dr),Mi=f.translatePosMatrix(Yo,Dt,A,k,!0),Oi=f.translatePosMatrix(Jt,Dt,A,k),Jn=Ti?ql:Xa,eo=Pe&&!Ye&&!Gn;let uo=At;!ot&&!Ae.mercatorFromTransition||Pe||(uo=Au(Ae));const Pi=cr?uo:At,Ka=l.getColorAdjustmentMatrix(te,ce,me,ye),Kl=Af(ko.kind,Ao,eo,Ye,f,Oi,Jn,Mi,Ee,!1,Vo,[0,0],0,Pt,pr,We,Vr,Pi,Bt.getProjection(),Gi,Xr,Ka,ji,null),jc=Dt.imageAtlasTexture?Dt.imageAtlasTexture:null,Bu=l.layout.get("icon-size").constantOr(0)!==1||Bt.iconsNeedLinear,Uc=Bt.sdfIcons||f.options.rotating||f.options.zooming||Bu||Oa?Re.LINEAR:Re.NEAREST,_a=Bt.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,Es=f.terrain&&Ye&&Gn?o.bi(o.bz(),Xa):ql;if(Gn&&Bt.icon){const Hi=Ae.elevation,Ya=Hi?Hi.getAtTileOffsetFunc(Pt,Ae.center.lat,Ae.worldSize,Bt.getProjection()):null,Nu=gc(Jt,Dt.tileID.canonical,Ye,Pe,Ae,Bt.getProjection(),dr);_c(Bt,Jt,f,!1,Nu,Yo,Ye,Y,Ya,Pt)}return{program:Ko,buffers:Bt.icon,uniformValues:Kl,atlasTexture:jc,atlasTextureIcon:null,atlasInterpolation:Uc,atlasInterpolationIcon:null,isSDF:Bt.sdfIcons,hasHalo:_a,depthMode:ti,tile:Dt,renderWithShadows:Wn,labelPlaneMatrixInv:Es}},Mn=()=>{const Gn=Ie&&l.layout.get("symbol-placement")!=="point",On=[],Ti=Gn||ze||Lr,xn=Bt.elevationType==="road",zn=f.shadowRenderer,Wn=xn&&Be&&!!zn&&zn.enabled,Gi=vn(Wn),ti=xn&&Be&&!f.terrain?It:xt;f.terrainRenderModeElevated()&&Be&&On.push("PITCH_WITH_MAP_TERRAIN"),cr&&(On.push("PROJECTION_GLOBE_VIEW"),Ti&&On.push("PROJECTED_POS_ON_VIEWPORT")),!Bt.text.zOffsetVertexBuffer||xn&&f.terrain||On.push("Z_OFFSET"),Bt.iconsInText&&On.push("RENDER_TEXT_AND_SYMBOL"),On.push("RENDER_SDF"),Wn&&On.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),xn&&Be&&!f.terrain&&Bt.text.orientationVertexBuffer&&On.push("ELEVATED_ROADS"),Ur(On);const ji=Bt.text.programConfigurations.get(l.id),Do=f.getOrCreateProgram("symbol",{config:ji,defines:On});let Ko,Vo=[0,0],ko=null;const Ao=Bt.textSizeData;Bt.iconsInText&&(Vo=Dt.imageAtlasTexture?Dt.imageAtlasTexture.size:[0,0],ko=Dt.imageAtlasTexture?Dt.imageAtlasTexture:null,Ko=Be||!Ae.isOrthographic||f.options.rotating||f.options.zooming||Ao.kind==="composite"||Ao.kind==="camera"?Re.LINEAR:Re.NEAREST);const Oa=Dt.glyphAtlasTexture?Dt.glyphAtlasTexture.size:[0,0],Xa=l.layout.get("text-size-scale-range"),Yo=o.ay(f.scaleFactor,Xa[0],Xa[1]),Mi=o.bH(Ao,Ae.zoom,Yo),Oi=mc(Jt,Dt.tileID.canonical,Be,Ie,Ae,Bt.getProjection(),dr),Jn=cl(Jt,Dt.tileID.canonical,Be,Ie,Ae,Bt.getProjection(),dr),eo=f.translatePosMatrix(Jn,Dt,C,z,!0),uo=f.translatePosMatrix(Jt,Dt,C,z),Pi=Ti?ql:Oi,Ka=Ie&&!Be&&!Gn;let Kl=At;!ot&&!Ae.mercatorFromTransition||Ie||(Kl=Au(Ae));const jc=Af(Ao.kind,Mi,Ka,Be,f,uo,Pi,eo,Ee,!0,Oa,Vo,0,Pt,pr,We,Vr,cr?Kl:At,Bt.getProjection(),Gi,Xr,null,null,Yo),Bu=Dt.glyphAtlasTexture?Dt.glyphAtlasTexture:null,Uc=Re.LINEAR,_a=l.paint.get("text-halo-width").constantOr(1)!==0,Es=f.terrain&&Be&&Gn?o.bi(o.bz(),Oi):ql;if(Gn&&Bt.text){const Hi=Ae.elevation,Ya=Hi?Hi.getAtTileOffsetFunc(Pt,Ae.center.lat,Ae.worldSize,Bt.getProjection()):null,Nu=gc(Jt,Dt.tileID.canonical,Be,Ie,Ae,Bt.getProjection(),dr);_c(Bt,Jt,f,!0,Nu,Jn,Be,re,Ya,Pt)}return{program:Do,buffers:Bt.text,uniformValues:jc,atlasTexture:Bu,atlasTextureIcon:ko,atlasInterpolation:Uc,atlasInterpolationIcon:Ko,isSDF:!0,hasHalo:_a,depthMode:ti,tile:Dt,renderWithShadows:Wn,labelPlaneMatrixInv:Es}},Xn=Bt.icon.segments.get().length,Hr=Bt.text.segments.get().length,Tn=Xn&&!S.onlyText?Sn():null,_n=Hr&&!S.onlyIcons?Mn():null,Ln=l.paint.get("icon-opacity").constantOr(1),Rr=l.paint.get("text-opacity").constantOr(1);if(dt&&Bt.canOverlap){rt=!0;const Gn=Ln&&!S.onlyText?Bt.icon.segments.get():[],On=Rr&&!S.onlyIcons?Bt.text.segments.get():[];for(const Ti of Gn)tt.push({segments:new o.bd([Ti]),sortKey:Ti.sortKey,state:Tn});for(const Ti of On)tt.push({segments:new o.bd([Ti]),sortKey:Ti.sortKey,state:_n})}else S.onlyText||tt.push({segments:Ln?Bt.icon.segments:new o.bd([]),sortKey:0,state:Tn}),S.onlyIcons||tt.push({segments:Rr?Bt.text.segments:new o.bd([]),sortKey:0,state:_n})}rt&&tt.sort(((Pt,Dt)=>Pt.sortKey-Dt.sortKey));for(const Pt of tt){const Dt=Pt.state;if(Dt)if(f.terrain?f.terrain.setupElevationDraw(Dt.tile,Dt.program,{useDepthForOcclusion:Ae.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Dt.labelPlaneMatrixInv}):f.setupDepthForOcclusion(Ae.depthOcclusionForSymbolsAndCircles,Dt.program),Ce.activeTexture.set(Re.TEXTURE0),Dt.atlasTexture&&Dt.atlasTexture.bind(Dt.atlasInterpolation,Re.CLAMP_TO_EDGE,!0),Dt.atlasTextureIcon&&(Ce.activeTexture.set(Re.TEXTURE1),Dt.atlasTextureIcon&&Dt.atlasTextureIcon.bind(Dt.atlasInterpolationIcon,Re.CLAMP_TO_EDGE,!0)),Dt.renderWithShadows&&f.shadowRenderer.setupShadows(Dt.tile.tileID.toUnwrapped(),Dt.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,Dt.program),Dt.hasHalo){const Bt=Dt.uniformValues;Bt.u_is_halo=1,Ha(Dt.buffers,Pt.segments,l,f,Dt.program,Dt.depthMode,y,x,Bt,2),Bt.u_is_halo=0}else{if(Dt.isSDF){const Bt=Dt.uniformValues;Dt.hasHalo&&(Bt.u_is_halo=1,Ha(Dt.buffers,Pt.segments,l,f,Dt.program,Dt.depthMode,y,x,Bt,1)),Bt.u_is_halo=0}Ha(Dt.buffers,Pt.segments,l,f,Dt.program,Dt.depthMode,y,x,Dt.uniformValues,1)}}}function Ha(f,n,l,d,y,x,S,A,C,k){const z=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];y.draw(d,d.context.gl.TRIANGLES,x,S,A,Er.disabled,C,l.id,f.layoutVertexBuffer,f.indexBuffer,n,l.paint,d.transform.zoom,f.programConfigurations.get(l.id),z,k)}function Iu(f,n){const l=1<<f.canonical.z,d=(n.x*l-f.canonical.x-f.wrap*l)*o.aj,y=(n.y*l-f.canonical.y)*o.aj,x=o.e2(n.z,n.y);return o.d2(d,y,x)}function ir(f,n,l,d,y){if(!l.layout||l.layout.get("fill-elevation-reference")==="none")return;const x=f.context.gl,S=new er(f.context.gl.LEQUAL,er.ReadWrite,f.depthRangeFor3D),A=new er(f.context.gl.GREATER,er.ReadWrite,f.depthRangeFor3D),C=(function(q){const Q=o.cU(q.pitch);let Y=.01;return q.isOrthographic&&(Y=o.ai(1e-4,Y,o.cZ(Q>=bo?1:Q/bo))),2*Y})(f.transform),k=f.transform.getFreeCameraOptions().position,z="elevatedStructuresDepthReconstruct",V=f.getOrCreateProgram(z,{defines:["DEPTH_RECONSTRUCTION"]}),j=f.getOrCreateProgram(z);for(const q of d){const Q=n.getTile(q),Y=Q.getBucket(l);if(!Y)continue;const re=Y.elevatedStructures;if(!re)continue;const te=Y.elevationBufferData.heightRange,ce=Iu(q.toUnwrapped(),k),me=f.translatePosMatrix(q.projMatrix,Q,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));let ye,Ee,Ce,Re;if(y==="initialize"){if(!te||te.min>=1||re.depthSegments.segments[0].primitiveLength===0)continue;ye=yl(me,ce,C,1,0),Ee=S,Ce=re.depthSegments,Re=V}else if(y==="reset"){if(!te||te.min>=0||re.maskSegments.segments[0].primitiveLength===0)continue;ye=yl(me,ce,0,0,1),Ee=A,Ce=re.maskSegments,Re=V}else if(y==="geometry"){if(re.depthSegments.segments[0].primitiveLength===0)continue;ye=yl(me,ce,C,1,0),Ee=S,Ce=re.depthSegments,Re=j}Re.draw(f,x.TRIANGLES,Ee,Ir.disabled,Wr.disabled,Er.disabled,ye,l.id,re.vertexBuffer,re.indexBuffer,Ce,l.paint,f.transform.zoom)}}function ws(f,n,l){const{painter:d,sourceCache:y,layer:x,coords:S,colorMode:A,elevationType:C,terrainEnabled:k,pass:z}=f,V=d.context.gl,j=x.paint.get("fill-pattern"),q=x.paint.get("fill-pattern-cross-fade"),Q=j.constantOr(null);let Y=C;C!=="road"||n&&!k||(Y="none");const re=Y==="road",te=f.painter.shadowRenderer,ce=re&&!!te&&te.enabled,me=new er(d.context.gl.LEQUAL,er.ReadOnly,d.depthRangeFor3D);let ye=[0,0,0];if(ce){const Re=d.style.directionalLight,Ae=d.style.ambientLight;Re&&Ae&&(ye=Ll(d.style,Re,Ae))}const Ee=j&&j.constantOr(1),Ce=(Re,Ae)=>{let Pe,Ie,Ye,Be,dt;Ae?(Pe=Ee&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ye=V.LINES):(Pe=Ee?"fillPattern":"fill",Ye=V.TRIANGLES);for(const rt of S){const xt=y.getTile(rt);if(Ee&&!xt.patternsLoaded())continue;const It=xt.getBucket(x);if(!It)continue;const We=n?It.elevationBufferData:It.bufferData;if(We.isEmpty())continue;d.prepareDrawTile();const ze=We.programConfigurations.get(x.id),ot=d.isTileAffectedByFog(rt),tt=[],At=[];re&&(tt.push("ELEVATED_ROADS"),At.push(We.elevatedLayoutVertexBuffer)),ce&&tt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ee&&(d.context.activeTexture.set(V.TEXTURE0),xt.imageAtlasTexture&&xt.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),ze.updatePaintBuffers());let Pt=!1;if(Q&&xt.imageAtlas){const Jt=xt.imageAtlas,dr=o.dZ.from(Q),ur=dr.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),Lr=dr.getSecondary(),Vr=Jt.patternPositions.get(ur),Xr=Lr?Jt.patternPositions.get(Lr.scaleSelf(o.q.devicePixelRatio).toString()):null;Pt=!!Vr&&!!Xr,Vr&&ze.setConstantPatternPositions(Vr,Xr)}q>0&&(Pt||ze.getPatternTransitionVertexBuffer("fill-pattern"))&&tt.push("FILL_PATTERN_TRANSITION");const Dt=d.getOrCreateProgram(Pe,{config:ze,overrideFog:ot,defines:tt}),Bt=d.translatePosMatrix(rt.projMatrix,xt,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));ce&&te.setupShadows(xt.tileID.toUnwrapped(),Dt,"vector-tile");const cr=x.paint.get("fill-emissive-strength");if(Ae){Be=We.lineIndexBuffer,dt=We.lineSegments;const Jt=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[V.drawingBufferWidth,V.drawingBufferHeight];Ie=Pe==="fillOutlinePattern"&&Ee?xs(Bt,cr,d,xt,Jt,ye,q):zd(Bt,cr,Jt,ye)}else Be=We.indexBuffer,dt=We.triangleSegments,Ie=Ee?Tf(Bt,cr,d,xt,ye,q):vu(Bt,cr,ye);d.uploadCommonUniforms(d.context,Dt,rt.toUnwrapped());let pr=Re;(C==="road"&&!k||C==="offset")&&(pr=me),Dt.draw(d,Ye,pr,l||d.stencilModeForClipping(rt),A,Er.disabled,Ie,x.id,We.layoutVertexBuffer,Be,dt,x.paint,d.transform.zoom,ze,At)}};d.renderPass===z&&Ce(d.depthModeForSublayer(1,d.renderPass==="opaque"?er.ReadWrite:er.ReadOnly),!1),Y==="none"&&d.renderPass==="translucent"&&x.paint.get("fill-antialias")&&Ce(d.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,er.ReadOnly),!0)}function Ss(f,n,l,d,y,x,S,A){l.resetLayerRenderingStats(f);const C=f.context,k=C.gl,z=f.transform,V=l.paint.get("fill-extrusion-pattern"),j=l.paint.get("fill-extrusion-pattern-cross-fade"),q=V.constantOr(null),Q=V.constantOr(1),Y=l.paint.get("fill-extrusion-opacity"),re=f.style.enable3dLights(),te=l.paint.get(re&&!Q?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ce=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),te],me=l.layout.get("fill-extrusion-edge-radius"),ye=me>0&&!l.paint.get("fill-extrusion-rounded-roof"),Ee=ye?0:me,Ce=z.projection.name==="globe"?o.e5():0,Re=z.projection.name==="globe",Ae=Re?o.ah(z.zoom):0,Pe=[o.aD(z.center.lng),o.aH(z.center.lat)],Ie=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ye=l.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ie?null:l.lut).toArray01().slice(0,3),Be=l.paint.get("fill-extrusion-flood-light-intensity"),dt=l.paint.get("fill-extrusion-vertical-scale"),rt=l.paint.get("fill-extrusion-line-width").constantOr(1)!==0,xt=l.paint.get("fill-extrusion-height-alignment"),It=l.paint.get("fill-extrusion-base-alignment"),We=$a(f,l.paint.get("fill-extrusion-cutoff-fade-range")),ze=[];let ot;Re&&ze.push("PROJECTION_GLOBE_VIEW"),ce[0]>0&&ze.push("FAUX_AO"),ye&&ze.push("ZERO_ROOF_RADIUS"),A&&ze.push("HAS_CENTROID"),Be>0&&ze.push("FLOOD_LIGHT"),We.shouldRenderCutoff&&ze.push("RENDER_CUTOFF"),rt&&ze.push("RENDER_WALL_MODE");const tt=f.renderPass==="shadow",At=f.shadowRenderer,Pt=tt&&!!At,Dt=tt?Er.disabled:Er.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Bt=[0,0,0];if(At){const Jt=f.style.directionalLight,dr=f.style.ambientLight;Jt&&dr&&(Bt=Ll(f.style,Jt,dr)),tt||(ze.push("RENDER_SHADOWS","DEPTH_TEXTURE"),At.useNormalOffset&&ze.push("NORMAL_OFFSET")),ot=ze.concat(["SHADOWS_SINGLE_CASCADE"])}const cr=Pt?"fillExtrusionDepth":Q?"fillExtrusionPattern":"fillExtrusion",pr=l.getLayerRenderingStats();for(const Jt of d){const dr=n.getTile(Jt),ur=dr.getBucket(l);if(!ur||ur.projection.name!==z.projection.name)continue;let Lr=!1;At&&(Lr=At.getMaxCascadeForTile(Jt.toUnwrapped())===0);const Vr=f.isTileAffectedByFog(Jt),Xr=ur.programConfigurations.get(l.id);let vn=!1;if(q&&dr.imageAtlas){const _n=dr.imageAtlas,Ln=o.dZ.from(q),Rr=Ln.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),Gn=Ln.getSecondary(),On=_n.patternPositions.get(Rr),Ti=Gn?_n.patternPositions.get(Gn.scaleSelf(o.q.devicePixelRatio).toString()):null;vn=!!On&&!!Ti,On&&Xr.setConstantPatternPositions(On,Ti)}j>0&&(vn||Xr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&ze.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Ur=f.getOrCreateProgram(cr,{config:Xr,defines:Lr?ot:ze,overrideFog:Vr});if(f.terrain&&f.terrain.setupElevationDraw(dr,Ur,{useMeterToDem:!0}),!ur.centroidVertexBuffer){const _n=Ur.attributes.a_centroid_pos;_n!==void 0&&k.vertexAttrib2f(_n,0,0)}!tt&&At&&At.setupShadows(dr.tileID.toUnwrapped(),Ur,"vector-tile"),Q&&(f.context.activeTexture.set(k.TEXTURE0),dr.imageAtlasTexture&&dr.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Xr.updatePaintBuffers());const Sn=l.paint.get("fill-extrusion-vertical-gradient"),Mn=1/ur.tileToMeter;let Xn;if(tt&&At){if(Cu(dr.tileID,ur.maxHeight,f))continue;const _n=At.calculateShadowPassMatrixFromTile(dr.tileID.toUnwrapped());Xn=jl(_n,Ee,Mn,dt,xt,It)}else{const _n=f.translatePosMatrix(Jt.expandedProjMatrix,dr,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Ln=z.projection.createInversionMatrix(z,Jt.canonical);Xn=Q?ks(_n,f,Sn,Y,ce,Ee,Mn,Jt,dr,Ce,xt,It,Ae,Pe,Ln,Ye,dt,j):Kp(_n,f,Sn,Y,ce,Ee,Mn,Jt,Ce,xt,It,Ae,Pe,Ln,Ye,dt,Be,Bt)}f.uploadCommonUniforms(C,Ur,Jt.toUnwrapped(),null,We);let Hr=ur.segments;if(z.projection.name==="mercator"&&!tt&&(Hr=ur.getVisibleSegments(dr.tileID,f.terrain,f.transform.getFrustum(0)),!Hr.get().length))continue;if(pr)if(tt)for(const _n of Hr.get())pr.numRenderedVerticesInShadowPass+=_n.primitiveLength;else for(const _n of Hr.get())pr.numRenderedVerticesInTransparentPass+=_n.primitiveLength;const Tn=[];(f.terrain||A)&&Tn.push(ur.centroidVertexBuffer),Re&&Tn.push(ur.layoutVertexExtBuffer),rt&&Tn.push(ur.wallVertexBuffer),Ur.draw(f,C.gl.TRIANGLES,y,x,S,Dt,Xn,l.id,ur.layoutVertexBuffer,ur.indexBuffer,Hr,l.paint,f.transform.zoom,Xr,Tn)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class Fs{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function pa(f,n,l,d,y,x,S,A,C,k,z,V,j,q,Q,Y,re,te,ce,me){const ye=n.context,Ee=ye.gl,Ce=n.transform,Re=n.transform.zoom,Ae=[],Pe=f.translate,Ie=f.translateAnchor,Ye=f.edgeRadius,Be=$a(n,f.cutoffFadeRange);z==="clear"?(Ae.push("CLEAR_SUBPASS"),me&&(Ae.push("CLEAR_FROM_TEXTURE"),ye.activeTexture.set(Ee.TEXTURE0),me.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE))):z==="sdf"&&Ae.push("SDF_SUBPASS"),te&&Ae.push("HAS_CENTROID"),Be.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF");const dt=(rt,xt,It,We,ze)=>{const ot=xt.programConfigurations.get(d.id),tt=n.isTileAffectedByFog(rt),At=n.getOrCreateProgram("fillExtrusionGroundEffect",{config:ot,defines:Ae,overrideFog:tt}),Pt=((Bt,cr,pr,Jt,dr,ur,Lr,Vr,Xr,vn,Ur)=>({u_matrix:cr,u_opacity:pr,u_ao_pass:Jt?1:0,u_meter_to_tile:dr,u_ao:ur,u_flood_light_intensity:Lr,u_flood_light_color:Vr,u_attenuation:Xr,u_edge_radius:vn,u_fb:0,u_fb_size:Ur,u_dynamic_offset:1}))(0,We,V,k,ze,[j,q*ze],Q,Y,re,Re>=17?0:Ye*ze,me?me.size[0]:0),Dt=[];te&&Dt.push(xt.hiddenByLandmarkVertexBuffer),n.uploadCommonUniforms(ye,At,rt.toUnwrapped(),null,Be),At.draw(n,ye.gl.TRIANGLES,x,S,A,C,Pt,d.id,xt.vertexBuffer,xt.indexBuffer,It,d.paint,Re,ot,Dt)};for(const rt of y){const xt=l.getTile(rt),It=xt.getBucket(d);if(!It||It.projection.name!==Ce.projection.name||!It.groundEffect||It.groundEffect&&!It.groundEffect.hasData())continue;const We=It.groundEffect,ze=1/It.tileToMeter;{const ot=n.translatePosMatrix(rt.projMatrix,xt,Pe,Ie),tt=We.getDefaultSegment();dt(rt,We,tt,ot,ze)}if(ce)for(let ot=0;ot<4;ot++){const tt=o.e3[ot](rt),At=l.getTile(tt);if(!At)continue;const Pt=At.getBucket(d);if(!Pt||Pt.projection.name!==Ce.projection.name||!Pt.groundEffect||Pt.groundEffect&&!Pt.groundEffect.hasData())continue;const Dt=Pt.groundEffect;let Bt,cr;ot===0?(Bt=[-o.aj,0,0],cr=1):ot===1?(Bt=[o.aj,0,0],cr=0):ot===2?(Bt=[0,-o.aj,0],cr=3):(Bt=[0,o.aj,0],cr=2);const pr=Dt.regionSegments[cr];if(!pr)continue;const Jt=new Float32Array(16);o.bo(Jt,rt.projMatrix,Bt),dt(rt,Dt,pr,n.translatePosMatrix(Jt,xt,Pe,Ie),ze)}}}function wr(f,n,l,d,y,x,S){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const A=x?x.findDEMTileFor(l):null;if(!(A&&A.dem||S))return;x&&A&&A.dem&&d.selfDEMTileTimestamp!==A.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=A.dem._timestamp);const C=te=>new o.P(Math.ceil((te+o.e7)*o.e8),0),k=te=>{const ce=n.getSource().minzoom,me=Ee=>{const Ce=n.getTileByID(Ee);if(Ce&&Ce.hasData())return Ce.getBucket(y)},ye=[0,-1,1];for(const Ee of ye){if(te.overscaledZ+Ee<ce)continue;const Ce=me(te.calculateScaledKey(te.overscaledZ+Ee));if(Ce)return Ce}},z=[0,0,0],V=(te,ce)=>(z[0]=Math.min(te.min.y,ce.min.y),z[1]=Math.max(te.max.y,ce.max.y),z[2]=o.aj-ce.min.x>te.max.x?ce.min.x-o.aj:te.max.x,z),j=(te,ce)=>(z[0]=Math.min(te.min.x,ce.min.x),z[1]=Math.max(te.max.x,ce.max.x),z[2]=o.aj-ce.min.y>te.max.y?ce.min.y-o.aj:te.max.y,z),q=[(te,ce)=>V(te,ce),(te,ce)=>V(ce,te),(te,ce)=>j(te,ce),(te,ce)=>j(ce,te)],Q=(te,ce,me,ye,Ee,Ce,Re)=>{if(!x)return 0;const Ae=[[Ce?me:te,Ce?te:me,0],[Ce?me:ce,Ce?ce:me,0]],Pe=Re<0?o.aj+Re:Re,Ie=[Ce?Pe:(te+ce)/2,Ce?(te+ce)/2:Pe,0];return me===0&&Re<0||me!==0&&Re>0?x.getForTilePoints(Ee,[Ie],!0,ye):Ae.push(Ie),x.getForTilePoints(l,Ae,!0,A),Math.max(Ae[0][2],Ae[1][2],Ie[2])/x.exaggeration()};for(let te=0;te<4;te++){const ce=d.borderFeatureIndices[te];if(ce.length===0)continue;const me=o.e3[te](l),ye=k(me);if(!(ye&&ye instanceof o.e4))continue;const Ee=x?x.findDEMTileFor(me):null;if(!(Ee&&Ee.dem||S)||(x&&Ee&&Ee.dem&&d.borderDEMTileTimestamp[te]!==Ee.dem._timestamp&&(d.borderDoneWithNeighborZ[te]=-1,d.borderDEMTileTimestamp[te]=Ee.dem._timestamp),d.borderDoneWithNeighborZ[te]===ye.canonical.z))continue;ye.centroidVertexArray.length===0&&ye.createCentroidsBuffer();const Ce=(te<2?1:5)-te,Re=ye.borderDoneWithNeighborZ[Ce]!==d.canonical.z,Ae=ye.borderFeatureIndices[Ce];let Pe=0;if(d.canonical.z!==ye.canonical.z){for(const Ie of ce)d.showCentroid(d.featuresOnBorder[Ie]);if(Re)for(const Ie of Ae)ye.showCentroid(ye.featuresOnBorder[Ie]);d.borderDoneWithNeighborZ[te]=ye.canonical.z,ye.borderDoneWithNeighborZ[Ce]=d.canonical.z}for(const Ie of ce){const Ye=d.featuresOnBorder[Ie],Be=d.centroidData[Ye.centroidDataIndex],dt=Ye.borders[te];let rt;for(;Pe<Ae.length;){rt=ye.featuresOnBorder[Ae[Pe]];const xt=rt.borders[Ce];if(xt[1]>dt[0]+3||xt[0]>dt[0]-3)break;ye.showCentroid(rt),Pe++}if(rt&&Pe<Ae.length){const xt=Pe;let It=0;for(;!(rt.borders[Ce][0]>dt[1]-3)&&(It++,++Pe!==Ae.length);)rt=ye.featuresOnBorder[Ae[Pe]];rt=ye.featuresOnBorder[Ae[xt]];let We=!1;if(It>=1){const tt=rt.borders[Ce];Math.abs(dt[0]-tt[0])<3&&Math.abs(dt[1]-tt[1])<3&&(It=1,We=!0,Pe=xt+1)}else if(It===0){d.showCentroid(Ye);continue}const ze=ye.centroidData[rt.centroidDataIndex];S&&We&&(((Y=Be).flags|(re=ze).flags)&o.e6?(Y.flags|=o.e6,re.flags|=o.e6):(Y.flags&=~o.e6,re.flags&=~o.e6));const ot=Ye.intersectsCount()>1||rt.intersectsCount()>1;if(It>1)Pe=xt,Be.centroidXY=ze.centroidXY=new o.P(0,0);else if(Ee&&Ee.dem&&!ot){const tt=q[te](Be,ze),At=te%2?o.aj-1:0,Pt=Q(tt[0],Math.min(o.aj-1,tt[1]),At,Ee,me,te<2,tt[2]);Be.centroidXY=ze.centroidXY=C(Pt)}else ot?Be.centroidXY=ze.centroidXY=new o.P(0,0):(Be.centroidXY=d.encodeBorderCentroid(Ye),ze.centroidXY=ye.encodeBorderCentroid(rt));d.writeCentroidToBuffer(Be),ye.writeCentroidToBuffer(ze)}else d.showCentroid(Ye)}d.borderDoneWithNeighborZ[te]=ye.canonical.z,ye.borderDoneWithNeighborZ[Ce]=d.canonical.z}var Y,re;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(f)}const xl=[1,0,0],jd=[0,1,0],Ym=[0,0,1];function Cu(f,n,l){const d=l.transform,y=l.shadowRenderer;if(!y)return!0;const x=f.toUnwrapped(),S=d.tileSize*y._cascades[l.currentShadowCascade].scale;let A=n;if(d.elevation){const Y=d.elevation.getMinMaxForTile(f);Y&&(A+=Y.max)}const C=[...y.shadowDirection];C[2]=-C[2];const k=y.computeSimplifiedTileShadowVolume(x,A,S,C);if(!k)return!1;const z=[xl,jd,Ym,C,[C[0],0,C[2]],[0,C[1],C[2]]],V=d.projection.name==="globe",j=d.scaleZoom(S),q=o.cy.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,j,!V),Q=y.getCurrentCascadeFrustum();return q.intersectsPrecise(k.vertices,k.planes,z)===0||Q.intersectsPrecise(k.vertices,k.planes,z)===0}function Of(f){const{painter:n,source:l,layer:d,coords:y}=f,x=f.defines,S=n.context,A=n.renderPass==="shadow",C=n.renderPass==="light-beam",k=n.shadowRenderer;let z;k&&(z=x.concat(["SHADOWS_SINGLE_CASCADE"]));const V=o.e9(n.transform.center.lat,n.transform.zoom);for(const j of y){const q=l.getTile(j),Q=q.getBucket(d);if(!Q)continue;let Y=!1;k&&(Y=k.getMaxCascadeForTile(j.toUnwrapped())===0);const re=Q.programConfigurations.get(d.id);let te,ce,me=n.translatePosMatrix(j.expandedProjMatrix,q,[0,0],"map");if(me=o.cP(o.bz(),me,[1,1,f.verticalScale]),A&&k){if(Cu(q.tileID,Q.maxHeight*V,n))continue;let ye=k.calculateShadowPassMatrixFromTile(q.tileID.toUnwrapped());ye=o.cP(o.bz(),ye,[1,1,f.verticalScale]),ce=Mc(ye),te=n.getOrCreateProgram("buildingDepth",{config:re,defines:Y?z:x,overrideFog:!1})}else if(C)te=n.getOrCreateProgram("buildingBloom",{config:re,defines:Y?z:x,overrideFog:!1}),ce=zs(me);else{const ye=n.transform.calculatePosMatrix(j.toUnwrapped(),n.transform.worldSize);o.cP(ye,ye,[1,1,f.verticalScale]);const Ee=o.bz();o.cP(Ee,ye,[1,-1,1/V]),o.bi(Ee,Ee),o.ea(Ee,Ee),ce=Ls(me,Ee),te=n.getOrCreateProgram("building",{config:re,defines:Y?z:x,overrideFog:!1}),k&&k.setupShadowsFromMatrix(ye,te,!0)}if(n.uploadCommonUniforms(S,te,j.toUnwrapped(),null,null),C){const ye=Q.bloomGeometry;te.draw(n,S.gl.TRIANGLES,f.depthMode,Ir.disabled,f.blendMode,Er.disabled,ce,d.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segmentsBucket,d.paint,n.transform.zoom,re,[ye.layoutAttenuationBuffer,ye.layoutColorBuffer])}else te.draw(n,S.gl.TRIANGLES,f.depthMode,Ir.disabled,f.blendMode,A?Er.disabled:Er.backCW,ce,d.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,d.paint,n.transform.zoom,re,[Q.layoutNormalBuffer,Q.layoutColorBuffer])}}function Eh(f){return[f[0]*o.eb,f[1]*o.eb,f[2]*o.eb,0]}function us(f,n,l,d,y,x,S,A,C){const k=d.getSource(),z=l.globeSharedBuffers;if(!z)return;let V,j,q;if(n&&(V=d.getTile(n)),k instanceof o.aP?(j=k.texture,q=o.dE(0,0,l.transform)):V&&n&&(j=V.texture,q=o.dE(n.canonical.z,n.canonical.x,l.transform)),!j||!q)return;f||(q=o.cP(o.bz(),q,[1,-1,1]));const Q=l.context,Y=Q.gl,re=y.paint.get("raster-resampling")==="nearest"?Y.NEAREST:Y.LINEAR,te=l.colorModeForDrapableLayerRenderPass(x),ce=S.defines;ce.push("GLOBE_POLES");const me=new er(Y.LEQUAL,er.ReadWrite,l.depthRangeFor3D),ye=Float32Array.from(l.transform.expandedFarZProjMatrix),Ee=Float32Array.from(o.bh(o.dD(new o.cA(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),Q.activeTexture.set(Y.TEXTURE0),j.bind(re,Y.CLAMP_TO_EDGE),Q.activeTexture.set(Y.TEXTURE1),j.bind(re,Y.CLAMP_TO_EDGE),"useMipmap"in j&&Q.extTextureFilterAnisotropic&&l.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,Q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Q.extTextureFilterAnisotropicMax);const[Ce,Re,Ae,Pe]=n?z.getPoleBuffers(n.canonical.z,!1):z.getPoleBuffers(0,!0),Ie=y.paint.get("raster-elevation");let Ye;f?(Ye=Ce,l.renderDefaultNorthPole=Ie!==0):(Ye=Re,l.renderDefaultSouthPole=Ie!==0);const Be=Eh(S.mix),dt=((xt,It,We,ze,ot,tt,At,Pt,Dt,Bt,cr,pr,Jt)=>ls(xt,It,We,new Float32Array(16),new Float32Array(9),[0,0],ze,[0,0],[0,0,0,0],1,{opacity:1,mix:0},tt,[0,0],Pt,2,Bt,cr,pr,1,0,Jt))(ye,Ee,q,o.ah(l.transform.zoom),0,y,0,Ie,0,Be,S.offset,S.range,x),rt=l.getOrCreateProgram("raster",{defines:ce});l.uploadCommonUniforms(Q,rt,null),rt.draw(l,Y.TRIANGLES,me,C,te,A,dt,y.id,Ye,Ae,Pe)}function Rf(f){const n=f._nearZ,l=f.projection.farthestPixelDistance(f),d=l-n,y=.2*f.height,x=n+y;return[n,l,(x-y-n)/d,(x-n)/d]}function Df(f,n,l,d){if(f)return n instanceof sc&&f instanceof ou?n.getTextureDescriptor(f,l,!0):{texture:f.texture,mix:Eh(d.mix),offset:d.offset,buffer:0,tileSize:1}}var Oo=o.ec([{name:"a_index",type:"Int16",components:1}]);class kf{constructor(n,l,d,y){const x={width:d[0],height:d[1],data:null},S=n.gl;this.targetColorTexture=new o.T(n,x,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(n,x,S.RGBA8,{useMipmap:!1}),this.context=n,this.updateParticleTexture(l,y),this.lastInvalidatedAt=0}updateParticleTexture(n,l){if(this.particleTextureDimension===l.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,y=l.width*l.height;this.particleTexture0=new o.T(this.context,l,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,l,d.RGBA8,{premultiply:!1,useMipmap:!1});const x=new o.ed;x.reserve(y);for(let S=0;S<y;S++)x.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(x,Oo.members,!0),this.particleSegment=o.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l.width}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function To(f,n,l){if(!f)return null;const d=n.getTextureDescriptor(f,l,!0);if(!d)return null;let{texture:y,mix:x,offset:S,tileSize:A,buffer:C,format:k}=d;if(!y||!k)return null;let z=!1;return k==="uint32"&&(z=!0,x[3]=0,x=da(o.ee,x,[0,l.paint.get("raster-particle-max-speed")]),S=Ci(o.ee,S,[0,l.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[C/(A+2*C),A/(A+2*C)],tileSize:A,scalarData:z,scale:x,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[k]]}}function Gl(f){const n=f._nearZ,l=f.projection.farthestPixelDistance(f),d=l-n,y=.2*f.height,x=n+y;return[n,l,(x-y-n)/d,(x-n)/d]}const Ud=new o.am(1,0,0,1),Qi=new o.am(0,1,0,1),Ah=new o.am(0,0,1,1),Lf=new o.am(1,0,1,1),Vd=new o.am(0,1,1,1);function hs(f,n,l,d,y,x){for(let S=0;S<l.length;S++)if(y){const k=new o.am(d.r*.8,d.g*.8,d.b*.8,1);Un(f,n,l[S],d,-1,-1,x),Un(f,n,l[S],d,-1,1,x),Un(f,n,l[S],d,1,1,x),Un(f,n,l[S],d,1,-1,x),Un(f,n,l[S],k,0,0,x)}else Un(f,n,l[S],d,0,0,x)}function Un(f,n,l,d,y,x,S){const A=f.context,C=f.transform,k=A.gl,z=C.projection.name==="globe",V=z?["PROJECTION_GLOBE_VIEW"]:[];let j=o.bw(l.projMatrix);if(z&&o.ah(C.zoom)>0){const Be=o.bg(l.canonical,C),dt=o.ef(Be);j=o.az(new Float32Array(16),C.globeMatrix,dt),o.az(j,C.projMatrix,j)}const q=o.bz();q[12]+=2*y/(o.q.devicePixelRatio*C.width),q[13]+=2*x/(o.q.devicePixelRatio*C.height),o.az(j,q,j);const Q=f.getOrCreateProgram("debug",{defines:V}),Y=n.getTileByID(l.key);f.terrain&&f.terrain.setupElevationDraw(Y,Q);const re=er.disabled,te=Ir.disabled,ce=f.colorModeForRenderPass(),me="$debug";A.activeTexture.set(k.TEXTURE0),f.emptyTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),z?Y._makeGlobeTileDebugBuffers(f.context,C):Y._makeDebugTileBoundsBuffers(f.context,C.projection);const ye=Y._tileDebugBuffer||f.debugBuffer,Ee=Y._tileDebugIndexBuffer||f.debugIndexBuffer,Ce=Y._tileDebugSegments||f.debugSegments;if(Q.draw(f,k.LINE_STRIP,re,te,ce,Er.disabled,Ef(j,d.toPremultipliedRenderColor(null)),me,ye,Ee,Ce,null,null,null,[Y._globeTileDebugBorderBuffer]),S){const Be=Y.latestRawTileData,dt=Math.floor((Be&&Be.byteLength||0)/1024);let rt=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(rt+=` => ${l.overscaledZ}`),rt+=` ${Y.state}`,rt+=` ${dt}kb`,(function(xt,It){xt.initDebugOverlayCanvas();const We=xt.debugOverlayCanvas,ze=xt.context.gl,ot=xt.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,We.width,We.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(It,5,5),ot.strokeText(It,5,5),xt.debugOverlayTexture.update(We),xt.debugOverlayTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE)})(f,rt)}const Re=n.getTile(l).tileSize,Ae=512/Math.min(Re,512)*(l.overscaledZ/C.zoom)*.5,Pe=Y._tileDebugTextBuffer||f.debugBuffer,Ie=Y._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Ye=Y._tileDebugTextSegments||f.debugSegments;Q.draw(f,k.TRIANGLES,re,te,Wr.alphaBlended,Er.disabled,Ef(j,o.am.transparent.toPremultipliedRenderColor(null),Ae),me,Pe,Ie,Ye,null,null,null,[Y._globeTileDebugTextBuffer])}function Bs(f,n,l,d){so(f,0,n+l/2,f.transform.width,l,d)}function Zi(f,n,l,d){so(f,n-l/2,0,l,f.transform.height,d)}function so(f,n,l,d,y,x){const S=f.context,A=S.gl;A.enable(A.SCISSOR_TEST),A.scissor(n*o.q.devicePixelRatio,l*o.q.devicePixelRatio,d*o.q.devicePixelRatio,y*o.q.devicePixelRatio),S.clear({color:x}),A.disable(A.SCISSOR_TEST)}const jo=o.ec([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:zf}=jo;function Ts(f,n,l,d){f.emplaceBack(n,l,d)}class Ns{constructor(n){this.vertexArray=new o.eg,this.indices=new o.a_,Ts(this.vertexArray,-1,-1,1),Ts(this.vertexArray,1,-1,1),Ts(this.vertexArray,-1,1,1),Ts(this.vertexArray,1,1,1),Ts(this.vertexArray,-1,-1,-1),Ts(this.vertexArray,1,-1,-1),Ts(this.vertexArray,-1,1,-1),Ts(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,zf),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=o.bd.simpleSegment(0,0,36,12)}}function js(f,n,l,d,y,x){const S=f.context.gl,A=n.paint.get("sky-atmosphere-color"),C=n.paint.get("sky-atmosphere-halo-color"),k=n.paint.get("sky-atmosphere-sun-intensity"),z=((V,j,q,Q,Y)=>({u_matrix_3f:V,u_sun_direction:j,u_sun_intensity:q,u_color_tint_r:[Q.r,Q.g,Q.b,Q.a],u_color_tint_m:[Y.r,Y.g,Y.b,Y.a],u_luminance:5e-5}))(o.ei(o.dJ(),d),y,k,A.toPremultipliedRenderColor(null),C.toPremultipliedRenderColor(null));S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+x,n.skyboxTexture,0),l.draw(f,S.TRIANGLES,er.disabled,Ir.disabled,Wr.unblended,Er.frontCW,z,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const Ct=o.ec([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Qt{constructor(n){const l=new o.ej;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const d=new o.a_;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(l,Ct.members),this.indexBuffer=n.createIndexBuffer(d),this.segments=o.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Rc=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ai{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ge{constructor(n){this.colorModeAlphaBlendedWriteRGB=new Wr([1,lu,1,lu],o.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Wr([1,0,1,0],o.am.transparent,[!1,!1,!1,!0]),this.params=new Ai,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(n){const l=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Qt(l);const d=this.params.sizeRange,y=this.params.intensityRange,x=(function(z){const V=o.el(30),j=[];for(let q=0;q<z;++q){const Q=2*Math.PI*V(),Y=Math.acos(1-2*V())-.5*Math.PI;j.push(o.d2(Math.cos(Y)*Math.cos(Q),Math.cos(Y)*Math.sin(Q),Math.sin(Y)))}return j})(this.params.starsCount),S=o.el(300),A=new o.ek,C=new o.a_;let k=0;for(let z=0;z<x.length;++z){const V=o.c1([],x[z],200),j=Math.max(0,1+.01*d*(1*S()-.5)),q=Math.max(0,1+.01*y*(1*S()-.5));A.emplaceBack(V[0],V[1],V[2],-1,-1,j,q),A.emplaceBack(V[0],V[1],V[2],1,-1,j,q),A.emplaceBack(V[0],V[1],V[2],1,1,j,q),A.emplaceBack(V[0],V[1],V[2],-1,1,j,q),C.emplaceBack(k+0,k+1,k+2),C.emplaceBack(k+0,k+2,k+3),k+=4}this.starsVx=l.createVertexBuffer(A,Rc.members),this.starsIdx=l.createIndexBuffer(C),this.starsSegments=o.bd.simpleSegment(0,0,A.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,l){const d=n.context,y=d.gl,x=n.transform,S=new er(y.LEQUAL,er.ReadOnly,[0,1]),A=o.ah(x.zoom),C=n.style.getLut(l.scope),k=l.properties.get("color-use-theme")==="none",z=l.properties.get("color").toNonPremultipliedRenderColor(k?null:C).toArray01(),V=l.properties.get("high-color-use-theme")==="none",j=l.properties.get("high-color").toNonPremultipliedRenderColor(V?null:C).toArray01(),q=l.properties.get("space-color-use-theme")==="none",Q=l.properties.get("space-color").toNonPremultipliedRenderColor(q?null:C).toArray01(),Y=5e-4,re=o.em(l.properties.get("horizon-blend"),0,1,Y,.25),te=o.dy(n,d,x)&&re===Y?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,ce=n.frameCounter/1e3%1,me=o.ae(x.globeCenterInViewSpace),ye=Math.sqrt(Math.pow(me,2)-Math.pow(te,2)),Ee=Math.acos(ye/me),Ce=Re=>{const Ae=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Re&&Ae.push("ALPHA_PASS");const Pe=n.getOrCreateProgram("globeAtmosphere",{defines:Ae}),Ie=((Be,dt,rt,xt,It,We,ze,ot,tt,At,Pt,Dt)=>({u_frustum_tl:Be,u_frustum_tr:dt,u_frustum_br:rt,u_frustum_bl:xt,u_horizon:It,u_transition:We,u_fadeout_range:ze,u_color:ot,u_high_color:tt,u_space_color:At,u_temporal_offset:Pt,u_horizon_angle:Dt}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,A,re,z,j,Q,ce,Ee);n.uploadCommonUniforms(d,Pe);const Ye=this.atmosphereBuffer;Ye&&Pe.draw(n,y.TRIANGLES,S,Ir.disabled,Re?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Er.backCW,Ie,Re?"atmosphere_glow_alpha":"atmosphere_glow",Ye.vertexBuffer,Ye.indexBuffer,Ye.segments)};Ce(!1),Ce(!0)}drawStars(n,l){const d=o.ay(l.properties.get("star-intensity"),0,1);if(d===0)return;const y=n.context,x=y.gl,S=n.transform,A=n.getOrCreateProgram("stars"),C=o.c3([]);o.c5(C,C,-S._pitch),o.c4(C,C,-S.angle),o.c5(C,C,o.al(S._center.lat)),o.en(C,C,-o.al(S._center.lng));const k=o.c8(new Float32Array(16),C),z=o.az([],S.starsProjMatrix,k),V=o.ei([],k),j=o.eo([],V),q=[0,1,0];o.dL(q,q,j),o.c1(q,q,this.params.sizeMultiplier);const Q=[1,0,0];o.dL(Q,Q,j),o.c1(Q,Q,this.params.sizeMultiplier);const Y=(re=q,te=Q,ce=d,{u_matrix:Float32Array.from(z),u_up:re,u_right:te,u_intensity_multiplier:ce});var re,te,ce;n.uploadCommonUniforms(y,A),this.starsVx&&this.starsIdx&&A.draw(n,x.TRIANGLES,er.disabled,Ir.disabled,this.colorModeAlphaBlendedWriteRGB,Er.disabled,Y,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class fs{constructor(){this.visibleTiles=[]}updateBorders(n,l){const d=[],y=[],x=n._getRenderableCoordinates(!1,!0);for(const C of x){const k=n.getTile(C);if(!k.hasData())continue;const z=k.getBucket(l);z&&(z.isEmpty()||(d.push(C.key),y.push({bucket:z,tileID:C.canonical})))}let S=d.length!==this.visibleTiles.length;if(!S){d.sort();for(let C=0;C<d.length;C++)if(d[C]!==this.visibleTiles[C]){S=!0;break}}if(!S)return;const A=new Set;this.visibleTiles=d,y.sort(((C,k)=>C.tileID.z-k.tileID.z||C.tileID.x-k.tileID.x||C.tileID.y-k.tileID.y));for(const C of y){const k=new Array,z=new Array,V=C.bucket;for(const j of V.featuresOnBorder)A.has(j.featureId)?z.push(j.footprintIndex):(A.add(j.featureId),k.push(j.footprintIndex));V.updateFootprintHiddenFlags(k,o.ep,!1),V.updateFootprintHiddenFlags(z,o.ep,!0)}}}function Hl(f,n){const l=[...f],d=n.cameraWorldSizeForFog/n.worldSize,y=o.bx([]);return o.cP(y,y,[d,d,1]),o.az(l,y,l),o.az(l,n.worldToFogMatrix,l),l}function Mu(f,n,l,d,y){const x=l.material,S=d.context,{baseColorTexture:A,metallicRoughnessTexture:C}=x.pbrMetallicRoughness,{normalTexture:k,occlusionTexture:z,emissionTexture:V}=x;function j(Q,Y,re){if(Q&&(f.push(Y),S.activeTexture.set(S.gl.TEXTURE0+re),Q.gfxTexture)){const{minFilter:te,magFilter:ce,wrapS:me,wrapT:ye}=Q.sampler;Q.gfxTexture.bindExtraParam(te,ce,me,ye)}}j(A,"HAS_TEXTURE_u_baseColorTexture",fa.BaseColor),j(C,"HAS_TEXTURE_u_metallicRoughnessTexture",fa.MetallicRoughness),j(k,"HAS_TEXTURE_u_normalTexture",fa.Normal),j(z,"HAS_TEXTURE_u_occlusionTexture",fa.Occlusion),j(V,"HAS_TEXTURE_u_emissionTexture",fa.Emission),y&&(y.texture||(y.texture=new o.et(d.context,y.image,[y.image.height,y.image.height,y.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+fa.LUT),y.texture&&y.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),l.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(l.texcoordBuffer)),l.colorBuffer&&(f.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(l.colorBuffer)),l.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(l.normalBuffer)),l.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(l.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||f.push("DIFFUSE_SHADED");const q=d.shadowRenderer;q&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&f.push("NORMAL_OFFSET"))}function Dc(f,n,l,d,y,x){const S=l.paint.get("model-opacity").constantOr(1),A=n.context,C=new er(n.context.gl.LEQUAL,er.ReadWrite,n.depthRangeFor3D),k=n.transform,z=f.mesh,V=z.material,j=V.pbrMetallicRoughness,q=n.style.fog;let Q;Q=n.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:o.az([],d.zScaleMatrix,f.nodeModelMatrix),o.az(Q,d.negCameraPosMatrix,Q);const Y=o.bi([],Q);o.ea(Y,Y);const re=l.paint.get("model-color-use-theme").constantOr("default")==="none",te=l.paint.get("model-emissive-strength").constantOr(0),ce=Tu(new Float32Array(f.worldViewProjection),new Float32Array(Q),new Float32Array(Y),null,n,S,j.baseColorFactor,V.emissiveFactor,j.metallicFactor,j.roughnessFactor,V,te,l),me={defines:[]},ye=[],Ee=n.shadowRenderer;Ee&&(Ee.useNormalOffset=!1),Mu(me.defines,ye,z,n,re?null:l.lut);let Ce=null;if(q){const Pe=Hl(f.nodeModelMatrix,n.transform);if(Ce=new Float32Array(Pe),k.projection.name!=="globe"){const Ie=z.aabb.min,Ye=z.aabb.max,[Be,dt]=q.getOpacityForBounds(Pe,Ie[0],Ie[1],Ye[0],Ye[1]);me.overrideFog=Be>=Tt||dt>=Tt}}const Re=$a(n,l.paint.get("model-cutoff-fade-range"));Re.shouldRenderCutoff&&me.defines.push("RENDER_CUTOFF");const Ae=n.getOrCreateProgram("model",me);n.uploadCommonUniforms(A,Ae,null,Ce,Re),n.renderPass!=="shadow"&&Ee&&Ee.setupShadowsFromMatrix(f.nodeModelMatrix,Ae),Ae.draw(n,A.gl.TRIANGLES,C,y,x,z.material.doubleSided?Er.disabled:Er.backCCW,ce,l.id,z.vertexBuffer,z.indexBuffer,z.segments,l.paint,n.transform.zoom,void 0,ye)}function $d(f,n,l,d,y,x,S){let A;A=f.projection.name==="globe"?o.er(l,f):[...l],o.az(A,A,n.matrix);const C=o.az([],d,A);if(n.meshes)for(const k of n.meshes){if(k.material.alphaMode!=="BLEND"){S.push({mesh:k,depth:0,modelIndex:y,worldViewProjection:C,nodeModelMatrix:A});continue}const z=o.ad([],k.centroid,C);!f.isOrthographic&&z[2]<=0||x.push({mesh:k,depth:z[2],modelIndex:y,worldViewProjection:C,nodeModelMatrix:A})}if(n.children)for(const k of n.children)$d(f,k,l,d,y,x,S)}function Ff(f,n,l,d){const y=l.shadowRenderer;if(!y)return;const x=y.getShadowPassDepthMode(),S=y.getShadowPassColorMode(),A=y.calculateShadowPassMatrixFromMatrix(n),C=If(A);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,x,Ir.disabled,S,Er.backCCW,C,d.id,f.vertexBuffer,f.indexBuffer,f.segments,d.paint,l.transform.zoom,void 0,void 0)}function Ou(f,n,l){const d=n.updateZoomBasedPaintProperties(),y=(function(x,S,A){let C,k,z,V=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&V>0){const j=x.terrain,q=j.findDEMTileFor(A);q&&q.dem?C=o.eu.create(j,A,q):V=0}if(V===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),V===S.validForExaggeration&&(V===0||C&&C._demTile&&C._demTile.tileID===S.validForDEMTile.id&&C._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const j in S.instancesPerModel){const q=S.instancesPerModel[j];for(let Q=0;Q<q.instancedDataArray.length;++Q){const Y=(C?V*C.getElevationAt(0|q.instancedDataArray.float32[16*Q],0|q.instancedDataArray.float32[16*Q+1],!0,!0):0)+q.instancesEvaluatedElevation[Q];q.instancedDataArray.float32[16*Q+6]=Y,k=k?Math.min(S.terrainElevationMin,Y):Y,z=z?Math.max(S.terrainElevationMax,Y):Y}}return S.terrainElevationMin=k||0,S.terrainElevationMax=z||0,S.validForExaggeration=V,S.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0})(f,n,l);(d||y)&&(n.uploaded=!1,n.upload(f.context))}const Us={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d6([0,0,0],[o.aj,o.aj,0])};function Jm(f,n){const l=1<<f.canonical.z,d=n.getFreeCameraOptions().position,y=n.elevation,x=f.canonical.x/l,S=(f.canonical.x+1)/l,A=f.canonical.y/l,C=(f.canonical.y+1)/l;let k=n._centerAltitude;if(y){const q=y.getMinMaxForTile(f);q&&q.max>k&&(k=q.max)}const z=o.ay(d.x,x,S)-d.x,V=o.ay(d.y,A,C)-d.y,j=o.cb(k,n.center.lat)-d.z;return n._zoomFromMercatorZ(Math.sqrt(z*z+V*V+j*j))}function qd(f,n,l,d,y,x,S){const A=f.context,C=f.renderPass==="shadow",k=f.shadowRenderer,z=C&&k?k.getShadowPassDepthMode():new er(A.gl.LEQUAL,er.ReadWrite,f.depthRangeFor3D),V=f.isTileAffectedByFog(x);if(l.meshes)for(const j of l.meshes){const q=["MODEL_POSITION_ON_GPU"],Q=[];let Y,re,te;d.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");const ce=$a(f,n.paint.get("model-cutoff-fade-range"));if(ce.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),C&&k)Y=f.getOrCreateProgram("modelDepth",{defines:q}),re=If(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(l.matrix)),te=k.getShadowPassColorMode();else{Mu(q,Q,j,f,n.paint.get("model-color-use-theme").constantOr("default")==="none"?null:n.lut),Y=f.getOrCreateProgram("model",{defines:q,overrideFog:V});const ye=j.material,Ee=ye.pbrMetallicRoughness,Ce=n.paint.get("model-opacity").constantOr(1),Re=n.paint.get("model-emissive-strength").constantOr(0);re=Tu(x.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),null,f,Ce,Ee.baseColorFactor,ye.emissiveFactor,Ee.metallicFactor,Ee.roughnessFactor,ye,Re,n,y),k&&(S.shadowUniformsInitialized?Y.setShadowUniformValues(A,k.getShadowUniformValues()):(k.setupShadows(x.toUnwrapped(),Y,"model-tile"),S.shadowUniformsInitialized=!0)),te=ce.shouldRenderCutoff||Ce<1||ye.alphaMode!=="OPAQUE"?Wr.alphaBlended:Wr.unblended}f.uploadCommonUniforms(A,Y,x.toUnwrapped(),null,ce);const me=j.material.doubleSided?Er.disabled:Er.backCCW;if(d.instancedDataArray.length>20)Q.push(d.instancedDataBuffer),Y.draw(f,A.gl.TRIANGLES,z,Ir.disabled,te,me,re,n.id,j.vertexBuffer,j.indexBuffer,j.segments,n.paint,f.transform.zoom,void 0,Q,d.instancedDataArray.length);else{const ye=C?"u_instance":"u_normal_matrix";for(let Ee=0;Ee<d.instancedDataArray.length;++Ee)re[ye]=new Float32Array(d.instancedDataArray.arrayBuffer,64*Ee,16),Y.draw(f,A.gl.TRIANGLES,z,Ir.disabled,te,me,re,n.id,j.vertexBuffer,j.indexBuffer,j.segments,n.paint,f.transform.zoom,void 0,Q)}}if(l.children)for(const j of l.children)qd(f,n,j,d,y,x,S)}const Bf=[1,-1,1];function Gd(f,n,l,d){if(!l.modelManager)return!0;const y=l.modelManager;if(!l.shadowRenderer)return!0;const x=l.shadowRenderer,S=n.aabb;let A=!0,C=f.maxHeight;if(C===0){let z=0;for(const V in f.instancesPerModel){const j=y.getModel(V,d);j?z=Math.max(z,Math.max(Math.max(j.aabb.max[0],j.aabb.max[1]),j.aabb.max[2])):A=!1}C=f.maxScale*z*1.41+f.maxVerticalOffset,A&&(f.maxHeight=C)}S.max[2]=C,S.min[2]+=f.terrainElevationMin,S.max[2]+=f.terrainElevationMax,o.ad(S.min,S.min,n.tileMatrix),o.ad(S.max,S.max,n.tileMatrix);const k=S.intersects(x.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=k===2),k===0}function Ph(f,n){const l=f.uniformValues.u_cutoff_params[0],d=f.uniformValues.u_cutoff_params[1],y=f.uniformValues.u_cutoff_params[2],x=f.uniformValues.u_cutoff_params[3];return d===l||x===y?1:o.ay(((n-l)/(d-l)-y)/(x-y),0,1)}function Qp(f,n,l,d){if(n.pitch<20)return 1;const y=n.getWorldToCameraMatrix();o.az(y,y,f);const x=o.bR(l.min[0],l.min[1],l.min[2],1);let S=o.aA(o.ev(),x,y),A=S,C=S;x[1]=l.max[1],S=o.aA(o.ev(),x,y),A=S[1]<A[1]?S:A,C=S[1]>C[1]?S:C,x[0]=l.max[0],S=o.aA(o.ev(),x,y),A=S[1]<A[1]?S:A,C=S[1]>C[1]?S:C,x[1]=l.min[1],S=o.aA(o.ev(),x,y),A=S[1]<A[1]?S:A,C=S[1]>C[1]?S:C;const k=o.ay(d[0],0,1),z=100*n.pixelsPerMeter*o.ay(d[1],0,1),V=o.ay(d[2],0,1),j=o.ew(o.ev(),A,C,k),q=Math.tan(.5*n.fovX),Q=-j[2]*q;if(z===0)return j[1]<-Math.abs(Q)?V:1;const Y=(-Math.abs(Q)-j[1])/z,re=(ce,me,ye)=>(1-ye)*ce+ye*me,te=o.ay(re(1,V,Y),V,1);return re(1,te,o.ay((n.pitch-20)/20,0,1))}class Ru{}class kc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,l,d){{const V=this._storage.get(l.id);if(V)return V.lastUsedFrameIdx=n,V.buf}const y=d.gl,x=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),S=new ArrayBuffer(x),A=new Int16Array(S);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const C=new o.ey;for(let V=0;V<x/2;V+=3){const j=A[V],q=A[V+1],Q=A[V+2];C.emplaceBack(j,q),C.emplaceBack(q,Q),C.emplaceBack(Q,j)}const k=d.bindVertexArrayOES.current,z=new Ru;return z.buf=new $l(d,C),z.lastUsedFrameIdx=n,this._storage.set(l.id,z),d.bindVertexArrayOES.set(k),z.buf}update(n){for(const[l,d]of this._storage)n-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(l))}destroy(){for(const[n,l]of this._storage)l.buf.destroy(),this._storage.delete(n)}}class Du{constructor(n){this.occluderSize=30,this.depthOffset=-1e-4,n.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),n.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Hd=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Qm{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Zo{constructor(n,l){this.revealStart=11,this.revealRange=2,n.registerParameter(this,[...l,"Reveal"],"revealStart",{min:0,max:17,step:.05}),n.registerParameter(this,[...l,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const eg=o.ec([{type:"Float32",name:"a_pos_2f",components:2}]);class Ih{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(n,l){const d=n.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const S=new o.ez,A=new o.a_;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(1,1),S.emplaceBack(-1,1),A.emplaceBack(0,1,2),A.emplaceBack(0,2,3),this.vignetteVx=n.context.createVertexBuffer(S,eg.members),this.vignetteIdx=n.context.createIndexBuffer(A)}const y=o.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){n.uploadCommonUniforms(n.context,d);const S={u_vignetteShape:(x={vignetteShape:[l.start,l.range,Math.pow(10,l.fadePower)],vignetteColor:[l.color.r,l.color.g,l.color.b,l.color.a*l.strength]}).vignetteShape,u_vignetteColor:x.vignetteColor};d.draw(n,n.context.gl.TRIANGLES,er.disabled,Ir.disabled,Wr.alphaBlended,Er.disabled,S,"vignette",this.vignetteVx,this.vignetteIdx,y)}var x}}class ni{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(n,l){const d=n.getFreeCameraOptions().position,y=d.toAltitude(),x=d.toLngLat(),S=o.al(x.lng),A=o.al(x.lat),C=n.pixelsPerMeter/l,k=S*o.eB,z=o.eB*Math.log(Math.tan(Math.PI/4+A/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const V=-this._offsetYPrev+z,j=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+k)*C,this._accumulatedOffsetY+=V*C,this._accumulatedElevation+=j*C,this._offsetXPrev=k,this._offsetYPrev=z,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function mn(f,n){return[-(f[0]-Math.floor(f[0]/n)*n),-(f[1]-Math.floor(f[1]/n)*n),-(f[2]-Math.floor(f[2]/n)*n)]}function Wd(f){const n=o.el(1323123451230),l=[];for(let d=0;d<f;++d){const y=2*n()-1,x=2*n()-1,S=2*n()-1;l.push(o.d2(y,x,S))}return l}function ma(f,n,l,d,y){const x=o.ay((y-l)/(d-l),0,1);return(1-x)*f+x*n}class Ch{constructor(n){this._movement=new ni,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Ih,this._ppmScaleFactor=n}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(n,l){const d=n.transform;this._movement.update(d,this._ppmScaleFactor);const y=d.starsProjMatrix,x=o.c3([]);o.c5(x,x,o.al(90)-d._pitch),o.c4(x,x,-d.angle);const S=o.c8(new Float32Array(16),x),A=o.eA(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),C=o.ea([],A),k=o.az([],C,S),z=Date.now()/1e3;return this._accumulatedTimeFromStart+=(z-this._prevTime)*l,this._prevTime=z,{projectionMatrix:y,modelviewMatrix:k}}}class ku extends Ch{constructor(n){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Zo(n.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(n){const l=n.context;if(!this.particlesVx){const d=Wd(this.particlesCount),y=new o.eC,x=new o.a_;let S=0;const A=o.el(1323123451230);for(let C=0;C<d.length;++C){const k=d[C],z=[2*A()-1,A(),A(),A()];y.emplaceBack(k[0],k[1],k[2],-1,-1,...z),y.emplaceBack(k[0],k[1],k[2],1,-1,...z),y.emplaceBack(k[0],k[1],k[2],1,1,...z),y.emplaceBack(k[0],k[1],k[2],-1,1,...z),x.emplaceBack(S+0,S+1,S+2),x.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=l.createVertexBuffer(y,Hd.members),this.particlesIdx=l.createIndexBuffer(x)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.rain)return;const l=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=n.transform.zoom;if(l.revealStart>d)return;const y=ma(0,1,l.revealStart,l.revealStart+l.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const x=structuredClone(this._params);let S=[-x.direction.x,x.direction.y,-100];o.au(S,S);const A=structuredClone(this._vignetteParams);A.strength*=y,x.overrideStyleParameters||(x.intensity=n.style.rain.state.density,x.timeFactor=n.style.rain.state.intensity,x.color=structuredClone(n.style.rain.state.color),S=structuredClone(n.style.rain.state.direction),x.screenThinning.intensity=n.style.rain.state.centerThinning,x.dropletSizeX=n.style.rain.state.dropletSize[0],x.dropletSizeYScale=n.style.rain.state.dropletSize[1]/n.style.rain.state.dropletSize[0],x.distortionStrength=100*n.style.rain.state.distortionStrength,A.strength=1,A.color=structuredClone(n.style.rain.state.vignetteColor));const C=this.updateOnRender(n,x.timeFactor),k=n.context,z=k.gl,V=n.transform;this.screenTexture&&this.screenTexture.size[0]===n.width&&this.screenTexture.size[1]===n.height||(this.screenTexture=new o.T(k,{width:n.width,height:n.height,data:null},z.RGBA8)),x.distortionStrength>0&&(k.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),z.copyTexSubImage2D(z.TEXTURE_2D,0,0,0,0,0,n.width,n.height));const j=n.getOrCreateProgram("rainParticle");n.uploadCommonUniforms(k,j),k.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const q=[x.color.r,x.color.g,x.color.b,x.color.a],Q=(Y,re)=>{const te=mn(this._movement.getPosition(),Y),ce=x.dropletSizeX,me=x.dropletSizeX*x.dropletSizeYScale,ye=n.width/2,Ee=n.height/2,Ce=ma(0,x.screenThinning.start,0,1,x.screenThinning.intensity),Re=ma(.001,x.screenThinning.range,0,1,x.screenThinning.intensity),Ae=ma(0,x.screenThinning.particleOffset,0,1,x.screenThinning.intensity),Pe=(Ie={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:x.velocityConeAperture,velocity:x.velocity,boxSize:Y,rainDropletSize:[ce,me],distortionStrength:x.distortionStrength,rainDirection:S,color:q,screenSize:[V.width,V.height],thinningCenterPos:[ye,Ee],thinningShape:[Ce,Re,Math.pow(10,x.screenThinning.fadePower)],thinningAffectedRatio:x.screenThinning.affectedRatio,thinningParticleOffset:Ae,shapeDirectionalPower:x.shapeDirPower,shapeNormalPower:x.shapeNormalPower,mode:re?0:1},{u_modelview:Float32Array.from(Ie.modelview),u_projection:Float32Array.from(Ie.projection),u_time:Ie.time,u_cam_pos:Ie.camPos,u_texScreen:0,u_velocityConeAperture:Ie.velocityConeAperture,u_velocity:Ie.velocity,u_boxSize:Ie.boxSize,u_rainDropletSize:Ie.rainDropletSize,u_distortionStrength:Ie.distortionStrength,u_rainDirection:Ie.rainDirection,u_color:Ie.color,u_screenSize:Ie.screenSize,u_thinningCenterPos:Ie.thinningCenterPos,u_thinningShape:Ie.thinningShape,u_thinningAffectedRatio:Ie.thinningAffectedRatio,u_thinningParticleOffset:Ie.thinningParticleOffset,u_shapeDirectionalPower:Ie.shapeDirectionalPower,u_shapeNormalPower:Ie.shapeNormalPower,u_mode:Ie.mode});var Ie;const Ye=Math.round(x.intensity*this.particlesCount),Be=o.bd.simpleSegment(0,0,4*Ye,2*Ye);j.draw(n,z.TRIANGLES,er.disabled,Ir.disabled,Wr.alphaBlended,Er.disabled,Pe,"rain_particles",this.particlesVx,this.particlesIdx,Be)};x.distortionStrength>0&&Q(x.boxSize,!0),Q(x.boxSize,!1),this._vignette.draw(n,A)}}const Lu=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class em extends Ch{constructor(n){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Zo(n.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(n){const l=n.context;if(!this.particlesVx){const d=Wd(this.particlesCount),y=new o.eD,x=new o.a_;let S=0;const A=o.el(1323123451230);for(let C=0;C<d.length;++C){const k=d[C],z=A(),V=A(),j=A(),q=[C/d.length,z,V,j],Q=[A(),A()];y.emplaceBack(k[0],k[1],k[2],-1,-1,...q,...Q),y.emplaceBack(k[0],k[1],k[2],1,-1,...q,...Q),y.emplaceBack(k[0],k[1],k[2],1,1,...q,...Q),y.emplaceBack(k[0],k[1],k[2],-1,1,...q,...Q),x.emplaceBack(S+0,S+1,S+2),x.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=l.createVertexBuffer(y,Lu.members),this.particlesIdx=l.createIndexBuffer(x)}}draw(n){if(!this._params.overrideStyleParameters&&!n.style.snow)return;const l=structuredClone(this._params);let d=[-l.direction.x,l.direction.y,-100];o.au(d,d);const y=structuredClone(this._vignetteParams),x=l.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},S=n.transform.zoom;if(x.revealStart>S)return;const A=ma(0,1,x.revealStart,x.revealStart+x.revealRange,S);y.strength*=A,l.overrideStyleParameters||(l.intensity=n.style.snow.state.density,l.timeFactor=n.style.snow.state.intensity,l.color=structuredClone(n.style.snow.state.color),d=structuredClone(n.style.snow.state.direction),l.screenThinning.intensity=n.style.snow.state.centerThinning,l.billboardSize=2.79*n.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(n.style.snow.state.vignetteColor));const C=this.updateOnRender(n,l.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const k=n.context,z=k.gl,V=n.transform,j=n.getOrCreateProgram("snowParticle");n.uploadCommonUniforms(k,j),((q,Q,Y)=>{const re=mn(this._movement.getPosition(),q),te=V.width/2,ce=V.height/2,me=ma(0,Y.screenThinning.start,0,1,Y.screenThinning.intensity),ye=ma(.001,Y.screenThinning.range,0,1,Y.screenThinning.intensity),Ee=ma(0,Y.screenThinning.particleOffset,0,1,Y.screenThinning.intensity),Ce=(Re={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:re,velocityConeAperture:Y.velocityConeAperture,velocity:Y.velocity,horizontalOscillationRadius:Y.horizontalOscillationRadius,horizontalOscillationRate:Y.horizontalOscillationRate,boxSize:q,billboardSize:1*Y.billboardSize,simpleShapeParameters:[Y.shapeFadeStart,Y.shapeFadePower],screenSize:[V.width,V.height],thinningCenterPos:[te,ce],thinningShape:[me,ye,Math.pow(10,Y.screenThinning.fadePower)],thinningAffectedRatio:Y.screenThinning.affectedRatio,thinningParticleOffset:Ee,color:[Y.color.r,Y.color.g,Y.color.b,Y.color.a],direction:d},{u_modelview:Float32Array.from(Re.modelview),u_projection:Float32Array.from(Re.projection),u_time:Re.time,u_cam_pos:Re.camPos,u_velocityConeAperture:Re.velocityConeAperture,u_velocity:Re.velocity,u_horizontalOscillationRadius:Re.horizontalOscillationRadius,u_horizontalOscillationRate:Re.horizontalOscillationRate,u_boxSize:Re.boxSize,u_billboardSize:Re.billboardSize,u_simpleShapeParameters:Re.simpleShapeParameters,u_screenSize:Re.screenSize,u_thinningCenterPos:Re.thinningCenterPos,u_thinningShape:Re.thinningShape,u_thinningAffectedRatio:Re.thinningAffectedRatio,u_thinningParticleOffset:Re.thinningParticleOffset,u_particleColor:Re.color,u_direction:Re.direction});var Re;const Ae=Math.round(Y.intensity*this.particlesCount),Pe=o.bd.simpleSegment(0,0,4*Ae,2*Ae);this.particlesVx&&this.particlesIdx&&j.draw(n,z.TRIANGLES,er.disabled,Ir.disabled,Wr.alphaBlended,Er.disabled,Ce,"snow_particles",this.particlesVx,this.particlesIdx,Pe)})(l.boxSize,0,l),this._vignette.draw(n,y)}}const Zd={symbol:function(f,n,l,d,y){if(f.renderPass!=="translucent")return;const x=Ir.disabled,S=f.colorModeForRenderPass(),A=l.layout.get("text-variable-anchor"),C=l.layout.get("text-size-scale-range"),k=o.ay(f.scaleFactor,C[0],C[1]);A&&(function(j,q,Q,Y,re,te,ce,me){const ye=q.transform,Ee=re==="map",Ce=te==="map";for(const Re of j){const Ae=Y.getTile(Re),Pe=Ae.getBucket(Q);if(!Pe||!Pe.text||!Pe.text.segments.get().length)continue;const Ie=o.bH(Pe.textSizeData,ye.zoom,me),Ye=Cl(Re,Pe.getProjection(),ye),Be=ye.calculatePixelsToTileUnitsMatrix(Ae),dt=mc(Ye,Ae.tileID.canonical,Ce,Ee,ye,Pe.getProjection(),Be),rt=Pe.hasIconTextFit()&&Pe.hasIconData();Ie&&Pu(Pe,Ee,Ce,ce,ye,dt,Re,Math.pow(2,ye.zoom-Ae.tileID.overscaledZ),Ie,rt)}})(d,f,l,n,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),y,k);const z=l.paint.get("icon-opacity").constantOr(1)!==0,V=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(z||V)?Ga(f,n,l,d,x,S):(z&&Ga(f,n,l,d,x,S,{onlyIcons:!0}),V&&Ga(f,n,l,d,x,S,{onlyText:!0})),n.map.showCollisionBoxes&&(Cf(f,n,l,d,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Cf(f,n,l,d,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(f,n,l,d){if(f.renderPass!=="translucent")return;const y=l.paint.get("circle-opacity"),x=l.paint.get("circle-stroke-width"),S=l.paint.get("circle-stroke-opacity"),A=l.layout.get("circle-sort-key").constantOr(1)!==void 0,C=l.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(x.constantOr(1)===0||S.constantOr(1)===0))return;const k=f.context,z=k.gl,V=f.transform,j=!(!f.terrain||!f.terrain.enabled),q=l.layout.get("circle-elevation-reference"),Q=f.depthModeForSublayer(0,er.ReadOnly),Y=new er(f.context.gl.LEQUAL,er.ReadOnly,f.depthRangeFor3D),re=q==="none"||j?Q:Y,te=Ir.disabled,ce=f.colorModeForDrapableLayerRenderPass(C),me=V.projection.name==="globe",ye=[o.aD(V.center.lng),o.aH(V.center.lat)],Ee=[];for(let Re=0;Re<d.length;Re++){const Ae=d[Re],Pe=n.getTile(Ae),Ie=Pe.getBucket(l);if(!Ie||Ie.projection.name!==V.projection.name)continue;const Ye=Ie.programConfigurations.get(l.id),Be=Ie.layoutVertexBuffer,dt=Ie.globeExtVertexBuffer,rt=Ie.indexBuffer,xt=o.dW(l),It=[dt],We=f.isTileAffectedByFog(Ae);me&&xt.push("PROJECTION_GLOBE_VIEW"),xt.push("DEPTH_D24"),f.terrain&&V.depthOcclusionForSymbolsAndCircles&&xt.push("DEPTH_OCCLUSION"),Ie.hasElevation&&!f.terrain&&(xt.push("ELEVATED_ROADS"),It.push(Ie.elevatedLayoutVertexBuffer));const ze=f.getOrCreateProgram("circle",{config:Ye,defines:xt,overrideFog:We}),ot=V.projection.createInversionMatrix(V,Ae.canonical),tt={programConfiguration:Ye,program:ze,layoutVertexBuffer:Be,dynamicBuffers:It,indexBuffer:rt,uniformValues:o.dX(f,Ae,Pe,ot,ye,l),tile:Pe};if(A){const At=Ie.segments.get();for(const Pt of At)Ee.push({segments:new o.bd([Pt]),sortKey:Pt.sortKey,state:tt})}else Ee.push({segments:Ie.segments,sortKey:0,state:tt})}A&&Ee.sort(((Re,Ae)=>Re.sortKey-Ae.sortKey));const Ce={useDepthForOcclusion:V.depthOcclusionForSymbolsAndCircles};for(const Re of Ee){const{programConfiguration:Ae,program:Pe,layoutVertexBuffer:Ie,dynamicBuffers:Ye,indexBuffer:Be,uniformValues:dt,tile:rt}=Re.state,xt=Re.segments;f.terrain&&f.terrain.setupElevationDraw(rt,Pe,Ce),f.uploadCommonUniforms(k,Pe,rt.tileID.toUnwrapped()),Pe.draw(f,z.TRIANGLES,re,te,ce,Er.disabled,dt,l.id,Ie,Be,xt,l.paint,V.zoom,Ae,Ye)}},heatmap:function(f,n,l,d){if(l.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const y=f.context,x=y.gl,S=Ir.disabled,A=new Wr([x.ONE,x.ONE,x.ONE,x.ONE],o.am.transparent,[!0,!0,!0,!0]);(function(q,Q,Y,re){const te=q.gl,ce=Q.width*re,me=Q.height*re;q.activeTexture.set(te.TEXTURE1),q.viewport.set([0,0,ce,me]);let ye=Y.heatmapFbo;if(!ye||ye&&(ye.width!==ce||ye.height!==me)){ye&&ye.destroy();const Ee=te.createTexture();te.bindTexture(te.TEXTURE_2D,Ee),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),ye=Y.heatmapFbo=q.createFramebuffer(ce,me,!0,null),(function(Ce,Re,Ae,Pe,Ie,Ye){const Be=Ce.gl;Be.texImage2D(Be.TEXTURE_2D,0,Ce.extRenderToTextureHalfFloat?Be.RGBA16F:Be.RGBA,Ie,Ye,0,Be.RGBA,Ce.extRenderToTextureHalfFloat?Be.HALF_FLOAT:Be.UNSIGNED_BYTE,null),Pe.colorAttachment.set(Ae)})(q,0,Ee,ye,ce,me)}else te.bindTexture(te.TEXTURE_2D,ye.colorAttachment.get()),q.bindFramebuffer.set(ye.framebuffer)})(y,f,l,f.transform.projection.name==="globe"?.5:.25),y.clear({color:o.am.transparent});const C=f.transform,k=C.projection.name==="globe",z=k?["PROJECTION_GLOBE_VIEW"]:[],V=k?Er.frontCCW:Er.disabled,j=[o.aD(C.center.lng),o.aH(C.center.lat)];for(let q=0;q<d.length;q++){const Q=d[q];if(n.hasRenderableParent(Q))continue;const Y=n.getTile(Q),re=Y.getBucket(l);if(!re||re.projection.name!==C.projection.name)continue;const te=f.isTileAffectedByFog(Q),ce=re.programConfigurations.get(l.id),me=f.getOrCreateProgram("heatmap",{config:ce,defines:z,overrideFog:te}),{zoom:ye}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Y,me),f.uploadCommonUniforms(y,me,Q.toUnwrapped());const Ee=C.projection.createInversionMatrix(C,Q.canonical);me.draw(f,x.TRIANGLES,er.disabled,S,A,V,qa(f,Q,Y,Ee,j,ye,l.paint.get("heatmap-intensity")),l.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,l.paint,f.transform.zoom,ce,k?[re.globeExtVertexBuffer]:null)}y.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),(function(y,x){const S=y.context,A=S.gl,C=x.heatmapFbo;if(!C)return;S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,C.colorAttachment.get()),S.activeTexture.set(A.TEXTURE1);let k=x.colorRampTexture;k||(k=x.colorRampTexture=new o.T(S,x.colorRamp,A.RGBA8)),k.bind(A.LINEAR,A.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,A.TRIANGLES,er.disabled,Ir.disabled,y.colorModeForRenderPass(),Er.disabled,((z,V,j,q)=>({u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}))(0,x),x.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,x.paint,y.transform.zoom)})(f,l))},line:function(f,n,l,d){if(f.renderPass!=="translucent")return;const y=l.paint.get("line-opacity"),x=l.paint.get("line-width");if(y.constantOr(1)===0||x.constantOr(1)===0)return;const S=l.paint.get("line-emissive-strength"),A=l.paint.get("line-occlusion-opacity"),C=l.layout.get("line-elevation-reference"),k=l.layout.get("line-width-unit")==="meters",z=C==="sea",V=!(!f.terrain||!f.terrain.enabled),j=f.context,q=j.gl;if(l.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const Q=l.layout.get("line-cross-slope"),Y=Q!==void 0,re=Q<1,te=f.colorModeForDrapableLayerRenderPass(S),ce=f.terrain&&f.terrain.renderingToTexture,me=ce?1:o.q.devicePixelRatio,ye=l.paint.get("line-dasharray"),Ee=ye.constantOr(1),Ce=l.layout.get("line-cap"),Re=ye.constantOr(null),Ae=Ce.constantOr(null),Pe=l.paint.get("line-pattern"),Ie=Pe.constantOr(1),Ye=l.paint.get("line-pattern-cross-fade"),Be=Pe.constantOr(null),dt=l.paint.get("line-opacity").constantOr(1);let rt=!Ie&&dt!==1||f.depthOcclusion&&A>0&&A<1;const xt=l.paint.get("line-gradient"),It=Ie?"linePattern":"line",We=o.dY(l);let ze;if(ce&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(rt=!1),A!==0&&f.depthOcclusion){const Pt=l.paint._values["line-opacity"];Pt&&Pt.value&&Pt.value.kind==="constant"?ze=Pt.value:o.w(`Occlusion opacity for layer ${l.id} is supported only when line-opacity isn't data-driven.`)}x.value.kind!=="constant"&&x.value.isLineProgressConstant===!1&&We.push("VARIABLE_LINE_WIDTH");const ot=(Pt,Dt,Bt,cr,pr,Jt)=>{for(const dr of Pt){const ur=n.getTile(dr);if(Ie&&!ur.patternsLoaded())continue;const Lr=ur.getBucket(l);if(!Lr||Lr.elevationType!=="none"&&!pr||Lr.elevationType==="none"&&pr)continue;f.prepareDrawTile();const Vr=[...Dt],Xr=f.shadowRenderer,vn=Lr.elevationType==="road"&&!!Xr&&Xr.enabled;let Ur=[0,0,0];if(vn){const xn=f.style.directionalLight,zn=f.style.ambientLight;xn&&zn&&(Ur=Ll(f.style,xn,zn)),Vr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Sn=Lr.programConfigurations.get(l.id);let Mn=!1;if(Be&&ur.imageAtlas){const xn=o.dZ.from(Be),zn=xn.getPrimary().scaleSelf(me).toString(),Wn=ur.imageAtlas.patternPositions.get(zn),Gi=xn.getSecondary(),ti=Gi?ur.imageAtlas.patternPositions.get(Gi.scaleSelf(me).toString()):null;Mn=!!Wn&&!!ti,Wn&&Sn.setConstantPatternPositions(Wn,ti)}Ye>0&&(Mn||Sn.getPatternTransitionVertexBuffer("line-pattern"))&&Vr.push("LINE_PATTERN_TRANSITION");const Xn=f.isTileAffectedByFog(dr),Hr=f.getOrCreateProgram(It,{config:Sn,defines:Vr,overrideFog:Xn});if(!Ie&&Re&&Ae&&ur.lineAtlas){const xn=ur.lineAtlas.getDash(Re,Ae);xn&&Sn.setConstantPatternPositions(xn)}vn&&Xr.setupShadows(ur.tileID.toUnwrapped(),Hr,"vector-tile");let[Tn,_n]=l.paint.get("line-trim-offset");(Ae==="round"||Ae==="square")&&Tn!==_n&&(Tn===0&&(Tn-=1),_n===1&&(_n+=1));const Ln=ce?dr.projMatrix:null,Rr=k?1/Lr.tileToMeter/o.aw(ur,1,f.transform.zoom):1,Gn=k?1/Lr.tileToMeter/o.aw(ur,1,Math.floor(f.transform.zoom)):1,On=Ie?o.d_(f,ur,l,Ln,me,Rr,Gn,[Tn,_n],Ur,Ye):o.d$(f,ur,l,Ln,Lr.lineClipsArray.length,me,Rr,Gn,[Tn,_n],Ur);if(xt){const xn=Lr.gradients[l.id];let zn=xn.texture;if(l.gradientVersion!==xn.version){let Wn=256;if(l.stepInterpolant){const Gi=n.getSource().maxzoom,ti=dr.canonical.z===Gi?Math.ceil(1<<f.transform.maxZoom-dr.canonical.z):1;Wn=o.ay(o.e0(Lr.maxLineLength/o.aj*1024*ti),256,j.maxTextureSize)}xn.gradient=o.e1({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Wn,image:xn.gradient||void 0,clips:Lr.lineClipsArray}),xn.texture?xn.texture.update(xn.gradient):xn.texture=new o.T(j,xn.gradient,q.RGBA8),xn.version=l.gradientVersion,zn=xn.texture}j.activeTexture.set(q.TEXTURE1),zn.bind(l.stepInterpolant?q.NEAREST:q.LINEAR,q.CLAMP_TO_EDGE)}Ee&&(j.activeTexture.set(q.TEXTURE0),ur.lineAtlasTexture&&ur.lineAtlasTexture.bind(q.LINEAR,q.REPEAT),Sn.updatePaintBuffers()),Ie&&(j.activeTexture.set(q.TEXTURE0),ur.imageAtlasTexture&&ur.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Sn.updatePaintBuffers()),pr&&!z&&f.terrain.setupElevationDraw(ur,Hr),f.uploadCommonUniforms(j,Hr,dr.toUnwrapped());const Ti=xn=>{ze!=null&&(ze.value=dt*A),Hr.draw(f,q.TRIANGLES,Bt,xn,te,Er.disabled,On,l.id,Lr.layoutVertexBuffer,Lr.indexBuffer,Lr.segments,l.paint,f.transform.zoom,Sn,[Lr.layoutVertexBuffer2,Lr.patternVertexBuffer,Lr.zOffsetVertexBuffer]),ze!=null&&(ze.value=dt)};if(rt&&!pr){const xn=f.stencilModeForClipping(dr).ref;xn===0&&ce&&j.clear({stencil:0});const zn={func:q.EQUAL,mask:255};On.u_alpha_discard_threshold=.8,Ti(new Ir(zn,xn,255,q.KEEP,q.KEEP,q.INVERT)),On.u_alpha_discard_threshold=0,Ti(new Ir(zn,xn,255,q.KEEP,q.KEEP,q.KEEP))}else On.u_alpha_discard_threshold=rt&&pr&&Jt?.8:0,Ti(pr?cr:f.stencilModeForClipping(dr))}};let tt=f.depthModeForSublayer(0,er.ReadOnly);const At=new er(f.depthOcclusion?q.GREATER:q.LEQUAL,er.ReadOnly,f.depthRangeFor3D);if(l.hasNonElevatedBuckets){const Pt=!ce&&f.terrain;A!==0&&Pt?o.w(`Occlusion opacity for layer ${l.id} is supported on terrain only if the layer has line-z-offset enabled.`):Pt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${l.id}.`):ot(d,We,tt,Ir.disabled,!1,!0)}if(l.hasElevatedBuckets){C==="hd-road-markup"?V||(tt=At,We.push("ELEVATED_ROADS")):(We.push("ELEVATED"),tt=At,Y&&We.push(re?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),z&&We.push("ELEVATION_REFERENCE_SEA"));const Pt=rt?f.stencilModeFor3D():Ir.disabled;f.forceTerrainMode=!0,ot(d,We,tt,Pt,!0,!0),rt&&ot(d,We,tt,Pt,!0,!1),f.forceTerrainMode=!1}rt&&(f.resetStencilClippingMasks(),ce&&j.clear({stencil:0})),A===0||f.depthOcclusion||ce||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,n,l,d){const y=l.paint.get("fill-color"),x=l.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const S=l.paint.get("fill-emissive-strength"),A=f.colorModeForDrapableLayerRenderPass(S),C=l.paint.get("fill-pattern"),k=f.opaquePassEnabledForLayer()&&!C.constantOr(1)&&y.constantOr(o.am.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";let z="none";l.layout.get("fill-elevation-reference")!=="none"?z="road":l.paint.get("fill-z-offset").constantOr(1)!==0&&(z="offset");const V=!(!f.terrain||!f.terrain.enabled),j={painter:f,sourceCache:n,layer:l,coords:d,colorMode:A,elevationType:z,terrainEnabled:V,pass:k};if(f.renderPass!=="shadow")if(z!=="offset"){if(ws(j,!1),z==="road"){const q=!V&&f.renderPass==="translucent";q&&ir(f,n,l,d,"geometry"),ws(j,!0,Ir.disabled),q&&(function(Q){const{painter:Y,sourceCache:re,layer:te,coords:ce,colorMode:me}=Q,ye=Y.context.gl,Ee=Q.painter.shadowRenderer,Ce=!!Ee&&Ee.enabled,Re=new er(Y.context.gl.LEQUAL,er.ReadOnly,Y.depthRangeFor3D);let Ae=[0,0,0];if(Ce){const Ie=Y.style.directionalLight,Ye=Y.style.ambientLight;Ie&&Ye&&(Ae=Ll(Y.style,Ie,Ye))}const Pe=Ie=>{for(const Ye of ce){const Be=re.getTile(Ye),dt=Be.getBucket(te);if(!dt)continue;const rt=dt.elevatedStructures;if(!rt)continue;let xt,It;if(Ie?(xt=rt.renderableBridgeSegments,It=rt.bridgeProgramConfigurations.get(te.id)):(xt=rt.renderableTunnelSegments,It=rt.tunnelProgramConfigurations.get(te.id)),!xt||xt.segments[0].primitiveLength===0)continue;It.updatePaintBuffers(),Y.prepareDrawTile();const We=Y.isTileAffectedByFog(Ye),ze=[];Ce&&ze.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ot=Y.getOrCreateProgram("elevatedStructures",{config:It,overrideFog:We,defines:ze}),tt=Y.translatePosMatrix(Ye.projMatrix,Be,te.paint.get("fill-translate"),te.paint.get("fill-translate-anchor"));Ce&&Ee.setupShadows(Be.tileID.toUnwrapped(),ot,"vector-tile");const At=bs(tt,Ae);Y.uploadCommonUniforms(Y.context,ot,Ye.toUnwrapped()),ot.draw(Y,ye.TRIANGLES,Re,Ir.disabled,me,Er.backCCW,At,te.id,rt.vertexBuffer,rt.indexBuffer,xt,te.paint,Y.transform.zoom,It,[rt.vertexBufferNormal])}};Pe(!0),Pe(!1)})(j)}}else ws(j,!1,f.stencilModeFor3D());else f.shadowRenderer&&z==="road"&&!V&&(function(q){const{painter:Q,sourceCache:Y,layer:re,coords:te}=q,ce=Q.context.gl,me=q.painter.shadowRenderer;for(const ye of te){const Ee=Y.getTile(ye),Ce=Ee.getBucket(re);if(!Ce)continue;const Re=Ce.elevatedStructures;if(!Re||!Re.shadowCasterSegments||Re.shadowCasterSegments.segments[0].primitiveLength===0)continue;Q.prepareDrawTile();const Ae=Ce.bufferData.programConfigurations.get(re.id),Pe=Q.isTileAffectedByFog(ye),Ie=Q.getOrCreateProgram("elevatedStructuresDepth",{config:Ae,overrideFog:Pe}),Ye=me.calculateShadowPassMatrixFromTile(Ee.tileID.toUnwrapped());Q.uploadCommonUniforms(Q.context,Ie,ye.toUnwrapped());const Be={u_matrix:Ye,u_depth_bias:0};Ie.draw(Q,ce.TRIANGLES,me.getShadowPassDepthMode(),Ir.disabled,me.getShadowPassColorMode(),Er.disabled,Be,re.id,Re.vertexBuffer,Re.indexBuffer,Re.shadowCasterSegments,re.paint,Q.transform.zoom,Ae)}})(j)},"fill-extrusion":function(f,n,l,d){const y=l.paint.get("fill-extrusion-opacity"),x=f.context,S=x.gl,A=f.terrain,C=A&&A.renderingToTexture;if(y===0)return;const k=f.conflationActive&&f.style.isLayerClipped(l,n.getSource()),z=f.style.order.indexOf(l.fqid);if(k&&(function(V,j,q,Q,Y){for(const re of Q){const te=j.getTile(re).getBucket(q);te&&(te.updateReplacement(re,V.replacementSource,Y),te.uploadCentroid(V.context))}})(f,n,l,d,z),A||k)for(const V of d){const j=n.getTile(V).getBucket(l);j&&wr(f.context,n,V,j,l,A,k)}if(f.renderPass==="shadow"&&f.shadowRenderer){const V=f.shadowRenderer;if(A&&y<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ab)return;const j=V.getShadowPassDepthMode(),q=V.getShadowPassColorMode();Ss(f,n,l,d,j,Ir.disabled,q,k)}else if(f.renderPass==="translucent"){const V=!l.paint.get("fill-extrusion-pattern").constantOr(1),j=l.paint.get("fill-extrusion-color").constantOr(o.am.white);if(!C&&j.a!==0){const q=new er(f.context.gl.LEQUAL,er.ReadWrite,f.depthRangeFor3D);y===1&&V?Ss(f,n,l,d,q,Ir.disabled,Wr.unblended,k):(Ss(f,n,l,d,q,Ir.disabled,Wr.disabled,k),Ss(f,n,l,d,q,f.stencilModeFor3D(),f.colorModeForRenderPass(),k),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&V&&(!A&&f.transform.projection.name!=="globe"||C)){const q=l.paint.get("fill-extrusion-opacity"),Q=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),re=l.paint.get("fill-extrusion-flood-light-intensity"),te=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ce=l.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(te?null:l.lut).toArray01().slice(0,3),me=Q>0&&Y>0,ye=re>0,Ee=(Ae,Pe,Ie)=>(1-Ie)*Ae+Ie*Pe,Ce=new Fs;Ce.translate=l.paint.get("fill-extrusion-translate"),Ce.translateAnchor=l.paint.get("fill-extrusion-translate-anchor"),Ce.edgeRadius=l.layout.get("fill-extrusion-edge-radius"),Ce.cutoffFadeRange=l.paint.get("fill-extrusion-cutoff-fade-range");const Re=Ae=>{const Pe=f.depthModeForSublayer(1,er.ReadOnly,S.LEQUAL,!0),Ie=l.paint.get(Ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ye=Ee(.1,3,Ie),Be=f._showOverdrawInspector;if(!Be){const dt=new Ir({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),rt=new Wr([S.ONE,S.ONE,S.ONE,S.ONE],o.am.transparent,[!1,!1,!1,!0],S.MIN);pa(Ce,f,n,l,d,Pe,dt,rt,Er.disabled,Ae,"sdf",q,Q,Y,re,ce,Ye,k,!1)}{const dt=Be?Ir.disabled:new Ir({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),rt=Be?f.colorModeForRenderPass():new Wr([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],o.am.transparent,[!0,!0,!0,!0]);pa(Ce,f,n,l,d,Pe,dt,rt,Er.disabled,Ae,"color",q,Q,Y,re,ce,Ye,k,!1)}};if(C){const Ae=(Pe,Ie,Ye)=>{const Be=f.depthModeForSublayer(1,er.ReadOnly,S.LEQUAL,!1),dt=l.paint.get(Pe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),rt=Ee(.1,3,dt);{const xt=new Wr([S.ONE,S.ONE,S.ONE,S.ONE],o.am.transparent,[!1,!1,!1,!0]);pa(Ce,f,n,l,d,Be,Ir.disabled,xt,Er.disabled,Pe,"clear",q,Q,Y,re,ce,rt,k,Ie)}{const xt=new Ir({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),It=new Wr([S.ONE,S.ONE,S.ONE,S.ONE],o.am.transparent,[!1,!1,!1,!0],S.MIN);pa(Ce,f,n,l,d,Be,xt,It,Er.disabled,Pe,"sdf",q,Q,Y,re,ce,rt,k,Ie)}{const xt=Pe?S.ZERO:S.ONE_MINUS_DST_ALPHA,It=new Ir({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),We=new Wr([xt,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],o.am.transparent,[!0,!0,!0,!0]);pa(Ce,f,n,l,d,Be,It,We,Er.disabled,Pe,"color",q,Q,Y,re,ce,rt,k,Ie)}{const xt=new Wr([S.ONE,S.ONE,S.ONE,Pe?S.ZERO:S.ONE],o.am.transparent,[!1,!1,!1,!0],Pe?S.FUNC_ADD:S.MAX);pa(Ce,f,n,l,d,Be,Ir.disabled,xt,Er.disabled,Pe,"clear",q,Q,Y,re,ce,rt,k,Ie,Ye)}};if(me||ye){let Pe;if(f.prepareDrawTile(),A){const Ie=A.drapeBufferSize[0],Ye=A.drapeBufferSize[1];Pe=A.framebufferCopyTexture,Pe&&(!Pe||Pe.size[0]===Ie&&Pe.size[1]===Ye)||(Pe&&Pe.destroy(),Pe=A.framebufferCopyTexture=new o.T(x,new o.r({width:Ie,height:Ye}),S.RGBA8)),Pe.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexSubImage2D(S.TEXTURE_2D,0,0,0,0,0,Ie,Ye)}me&&Ae(!0,!1,Pe),ye&&Ae(!1,!0,Pe)}}else me&&Re(!0),ye&&Re(!1),(me||ye)&&f.resetStencilClippingMasks()}}},building:function(f,n,l,d){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const y=l.paint.get("building-ambient-occlusion-ground-intensity"),x=l.paint.get("building-ambient-occlusion-ground-radius"),S=l.paint.get("building-ambient-occlusion-ground-attenuation");let A=y>0&&x>0,C=!0;const k=l.paint.get("building-vertical-scale");k<1&&(C=!1);const z=f.conflationActive&&f.style.isLayerClipped(l,n.getSource()),V=f.style.order.indexOf(l.fqid);if((function(j,q,Q,Y,re,te){for(const ce of te){const me=q.getTile(ce).getBucket(Q);me&&(re&&me.updateReplacement(ce,j.replacementSource,Y),me.uploadUpdatedIndexBuffer(j.context))}})(f,n,l,V,z,d),(function(j,q,Q,Y){for(const re of Y){const te=q.getTile(re).getBucket(Q);te&&te.needsEvaluation(j,Q)&&(te.evaluate(Q),te.uploadUpdatedColorBuffer(j.context))}})(f,n,l,d),l.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const j=f.shadowRenderer,q=[],Q=j.getShadowPassDepthMode();Of({painter:f,source:n,layer:l,coords:d,defines:q,blendMode:j.getShadowPassColorMode(),depthMode:Q,verticalScale:k})}else if(f.renderPass==="translucent"){A&&(function(Y,re,te,ce,me,ye,Ee,Ce,Re,Ae,Pe,Ie,Ye){const Be=Y.context.gl,dt=Y.depthModeForSublayer(1,er.ReadOnly,Be.LEQUAL,!0),rt=.1*(1-(xt=Pe))+3*xt;var xt;const It=Y._showOverdrawInspector,We=Ie,ze=new Fs;It||pa(ze,Y,re,te,ce,dt,new Ir({func:Be.ALWAYS,mask:255},255,255,Be.KEEP,Be.KEEP,Be.REPLACE),new Wr([Be.ONE,Be.ONE,Be.ONE,Be.ONE],o.am.transparent,[!1,!1,!1,!0],Be.MIN),Er.disabled,me,"sdf",1,Ee,Ce,0,Ae,rt,We,!1);{const ot=It?Ir.disabled:new Ir({func:Be.EQUAL,mask:255},255,255,Be.KEEP,Be.DECR,Be.DECR),tt=It?Y.colorModeForRenderPass():new Wr([Be.ONE_MINUS_DST_ALPHA,Be.DST_ALPHA,Be.ONE,Be.ONE],o.am.transparent,[!0,!0,!0,!0]);pa(ze,Y,re,te,ce,dt,ot,tt,Er.disabled,me,"color",1,Ee,Ce,0,Ae,rt,We,!1)}})(f,n,l,d,!0,0,y,x,0,[0,0,0],S,z);let j=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];C&&(j=j.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer.useNormalOffset&&(j=j.concat("NORMAL_OFFSET"));const q=new er(f.context.gl.LEQUAL,er.ReadWrite,f.depthRangeFor3D),Q=f.colorModeForRenderPass();Of({painter:f,source:n,layer:l,coords:d,defines:j,blendMode:Q,depthMode:q,verticalScale:k})}else if(f.renderPass==="light-beam"){const j=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],q=new er(f.context.gl.LEQUAL,er.ReadOnly,f.depthRangeFor3D);Of({painter:f,source:n,layer:l,coords:d,defines:j,blendMode:Wr.alphaBlended,depthMode:q,verticalScale:k})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,n,l,d){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const y=f.context,x=f.terrain&&f.terrain.renderingToTexture,[S,A]=f.renderPass!=="translucent"||x?[{},d]:f.stencilConfigForOverlap(d);for(const C of A){const k=n.getTile(C);if(k.needsHillshadePrepare&&f.renderPass==="offscreen")$p(f,k,l);else if(f.renderPass==="translucent"){const z=f.depthModeForSublayer(0,er.ReadOnly),V=l.paint.get("hillshade-emissive-strength"),j=f.colorModeForDrapableLayerRenderPass(V),q=x&&f.terrain?f.terrain.stencilModeForRTTOverlap(C):S[C.overscaledZ];D_(f,C,k,l,z,q,j)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,n,l,d,y,x){if(f.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;const S=f.transform.projection.name==="globe",A=l.paint.get("raster-elevation")!==0,C=A&&S;if(f.renderElevatedRasterBackface&&!C)return;const k=f.context,z=k.gl,V=n.getSource(),j=(function(Ce,Re,Ae,Pe){const Ie=Re.paint.get("raster-color"),Ye=Ce.type==="raster-array",Be=[],dt=Re.paint.get("raster-resampling"),rt=Re.paint.get("raster-color-mix");let xt=Re.paint.get("raster-color-range");const It=[rt[0],rt[1],rt[2],0],We=rt[3];let ze=dt==="nearest"?Pe.NEAREST:Pe.LINEAR;if(Ye&&(Be.push("RASTER_ARRAY"),Ie||Be.push("RASTER_COLOR"),dt==="linear"&&Be.push("RASTER_ARRAY_LINEAR"),ze=Pe.NEAREST,!xt&&Ce.rasterLayers)){const ot=Ce.rasterLayers.find((({id:tt})=>tt===Re.sourceLayer));ot&&ot.fields&&ot.fields.range&&(xt=ot.fields.range)}if(xt=xt||[0,1],Ie){Be.push("RASTER_COLOR"),Ae.activeTexture.set(Pe.TEXTURE2),Re.updateColorRamp(xt);let ot=Re.colorRampTexture;ot||(ot=Re.colorRampTexture=new o.T(Ae,Re.colorRamp,Pe.RGBA8)),ot.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE)}return{mix:It,range:xt,offset:We,defines:Be,resampling:ze}})(V,l,k,z);if(V instanceof o.aP&&!d.length&&!S)return;const q=l.paint.get("raster-emissive-strength"),Q=f.colorModeForDrapableLayerRenderPass(q),Y=f.terrain&&f.terrain.renderingToTexture,re=!f.options.moving,te=l.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;if(V instanceof o.aP&&!d.length&&(V.onNorthPole||V.onSouthPole)){const Ce=A?f.stencilModeFor3D():Ir.disabled;return void us(!!V.onNorthPole,null,f,n,l,q,j,Er.disabled,Ce)}if(!d.length)return;const[ce,me]=V instanceof o.aP||Y?[{},d]:f.stencilConfigForOverlap(d),ye=me[me.length-1].overscaledZ;C&&j.defines.push("PROJECTION_GLOBE_VIEW"),A&&j.defines.push("RENDER_CUTOFF");const Ee=(Ce,Re,Ae)=>{for(const Pe of Ce){const Ie=Pe.toUnwrapped(),Ye=n.getTile(Pe);if(Y&&(!Ye||!Ye.hasData()))continue;k.activeTexture.set(z.TEXTURE0);const Be=Df(Ye,V,l,j);if(!Be||!Be.texture)continue;const{texture:dt,mix:rt,offset:xt,tileSize:It,buffer:We}=Be;let ze,ot;Y?(ze=er.disabled,ot=Pe.projMatrix):A?(ze=new er(z.LEQUAL,er.ReadWrite,f.depthRangeFor3D),ot=S?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Ie,re)):(ze=f.depthModeForSublayer(Pe.overscaledZ-ye,l.paint.get("raster-opacity")===1?er.ReadWrite:er.ReadOnly,z.LESS),ot=f.transform.calculateProjMatrix(Ie,re));const tt=f.terrain&&Y?f.terrain.stencilModeForRTTOverlap(Pe):ce[Pe.overscaledZ],At=x?0:l.paint.get("raster-fade-duration");Ye.registerFadeDuration(At);const Pt=n.findLoadedParent(Pe,0),Dt=So(Ye,Pt,n,f.transform,At);let Bt,cr;f.terrain&&f.terrain.prepareDrawTile(),k.activeTexture.set(z.TEXTURE0),dt.bind(te,z.CLAMP_TO_EDGE),k.activeTexture.set(z.TEXTURE1),Pt?(Pt.texture&&Pt.texture.bind(te,z.CLAMP_TO_EDGE),Bt=Math.pow(2,Pt.tileID.overscaledZ-Ye.tileID.overscaledZ),cr=[Ye.tileID.canonical.x*Bt%1,Ye.tileID.canonical.y*Bt%1]):dt.bind(te,z.CLAMP_TO_EDGE),"useMipmap"in dt&&k.extTextureFilterAnisotropic&&f.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const pr=f.transform;let Jt;const dr=A?Rf(pr):[0,0,0,0];let ur,Lr,Vr,Xr,vn,Ur=0;if(C&&V instanceof o.aP&&V.coordinates.length>3)ur=Float32Array.from(o.bh(o.dD(new o.cA(0,0,0)))),Lr=Float32Array.from(pr.globeMatrix),Vr=Float32Array.from(o.dz(pr)),Xr=[o.aD(pr.center.lng),o.aH(pr.center.lat)],Jt=V.elevatedGlobePerspectiveTransform,vn=V.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){const Hr=o.dA(Pe.canonical);Ur=o.dB(Hr.getCenter().lat),ur=Float32Array.from(o.bh(o.dD(Pe.canonical))),Lr=Float32Array.from(pr.globeMatrix),Vr=Float32Array.from(o.dz(pr)),Xr=[o.aD(pr.center.lng),o.aH(pr.center.lat)],Jt=[0,0],vn=Float32Array.from(o.dC(Pe.canonical,Hr,Ur,pr.worldSize/pr._pixelsPerMercatorPixel))}else Jt=V instanceof o.aP?V.perspectiveTransform:[0,0],ur=new Float32Array(16),Lr=new Float32Array(9),Vr=new Float32Array(16),Xr=[0,0],vn=new Float32Array(9);const Sn=ls(ot,ur,Lr,Vr,vn,cr||[0,0],o.ah(f.transform.zoom),Xr,dr,Bt||1,Dt,l,Jt,A?l.paint.get("raster-elevation"):0,2,rt,xt,j.range,It,We,q),Mn=f.isTileAffectedByFog(Pe),Xn=f.getOrCreateProgram("raster",{defines:j.defines,overrideFog:Mn});if(f.uploadCommonUniforms(k,Xn,Ie),V instanceof o.aP){const Hr=V.elevatedGlobeVertexBuffer,Tn=V.elevatedGlobeIndexBuffer;if(Y||!S)V.boundsBuffer&&V.boundsSegments&&Xn.draw(f,z.TRIANGLES,ze,Ir.disabled,Q,Er.disabled,Sn,l.id,V.boundsBuffer,f.quadTriangleIndexBuffer,V.boundsSegments);else if(Hr&&Tn){const _n=pr.zoom<=o.cX?V.elevatedGlobeSegments:V.getSegmentsForLongitude(pr.center.lng);_n&&Xn.draw(f,z.TRIANGLES,ze,Ir.disabled,Q,Re,Sn,l.id,Hr,Tn,_n)}}else if(C){ze=new er(z.LEQUAL,er.ReadOnly,f.depthRangeFor3D);const Hr=f.globeSharedBuffers;if(Hr){const[Tn,_n,Ln]=Hr.getGridBuffers(Ur,!1);Xn.draw(f,z.TRIANGLES,ze,Ae||tt,f.colorModeForRenderPass(),Re,Sn,l.id,Tn,_n,Ln)}}else{const{tileBoundsBuffer:Hr,tileBoundsIndexBuffer:Tn,tileBoundsSegments:_n}=f.getTileBoundsBuffers(Ye);Xn.draw(f,z.TRIANGLES,ze,tt,Q,Er.disabled,Sn,l.id,Hr,Tn,_n)}}if(!(V instanceof o.aP)&&C)for(const Pe of Ce){const Ie=Pe.canonical.y===(1<<Pe.canonical.z)-1;Pe.canonical.y===0&&us(!0,Pe,f,n,l,q,j,Re,Ae||Ir.disabled),Ie&&us(!1,Pe,f,n,l,q,j,Re===Er.frontCW?Er.backCW:Er.frontCW,Ae||Ir.disabled)}};C?Ee(me,f.renderElevatedRasterBackface?Er.backCW:Er.frontCW,f.stencilModeFor3D()):Ee(me,Er.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,n,l,d,y,x){f.renderPass==="offscreen"&&(function(S,A,C,k){if(!k.length)return;const z=S.context,V=z.gl,j=A.getSource();if(!(j instanceof sc))return;const q=Math.ceil(Math.sqrt(C.paint.get("raster-particle-count")));let Q=C.particlePositionRGBAImage;if(!Q||Q.width!==q){const me=(function(ye){const Ee=ye*ye,Ce=new Uint8Array(4*Ee),Re=function(Pe){return Pe|=0,Pe=Math.imul(2747636419^Pe,2654435769),Pe=Math.imul(Pe^Pe>>>16,2654435769),((Pe=Math.imul(Pe^Pe>>>16,2654435769))>>>0)/4294967296},Ae=1/1.1;for(let Pe=0;Pe<Ee;Pe++){const Ie=Ae*(Re(2*Pe+0)+Vl),Ye=Ae*(Re(2*Pe+1)+Vl),Be=255*Ie%1,dt=255*Ye%1,rt=Be,xt=Ye-dt/255,It=dt;Ce[4*Pe+0]=255*(Ie-Be/255),Ce[4*Pe+1]=255*rt,Ce[4*Pe+2]=255*xt,Ce[4*Pe+3]=255*It}return Ce})(q);Q=C.particlePositionRGBAImage=new o.r({width:q,height:q},me)}let Y=C.particleFramebuffer;Y?Y.width!==q&&(Y.destroy(),Y=C.particleFramebuffer=z.createFramebuffer(q,q,!0,null)):Y=C.particleFramebuffer=z.createFramebuffer(q,q,!0,null);const re=[];for(const me of k){const ye=A.getTile(me);if(!(ye instanceof ou))continue;const Ee=To(ye,j,C);if(!Ee)continue;const Ce=[ye.tileSize,ye.tileSize];let Re=C.tileFramebuffer;Re||(Re=C.tileFramebuffer=z.createFramebuffer(Ce[0],Ce[1],!0,null));let Ae=ye.rasterParticleState;Ae||(Ae=ye.rasterParticleState=new kf(z,me,Ce,Q));const Pe=Ae.update(C.lastInvalidatedAt);Ae.particleTextureDimension!==q&&Ae.updateParticleTexture(me,Q);const Ie=Ae.targetColorTexture;Ae.targetColorTexture=Ae.backgroundColorTexture,Ae.backgroundColorTexture=Ie;const Ye=Ae.particleTexture0;Ae.particleTexture0=Ae.particleTexture1,Ae.particleTexture1=Ye,re.push([me,Ee,Ae,Pe])}if(re.length===0)return;const te=o.q.now(),ce=C.previousDrawTimestamp?.001*(te-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=te,C.hasColorMap()){z.activeTexture.set(V.TEXTURE0+2);let me=C.colorRampTexture;me||(me=C.colorRampTexture=new o.T(z,C.colorRamp,V.RGBA8)),me.bind(V.LINEAR,V.CLAMP_TO_EDGE)}z.bindFramebuffer.set(C.tileFramebuffer.framebuffer),(function(me,ye,Ee){const Ce=me.context,Re=Ce.gl,Ae=ye.tileFramebuffer;Ce.activeTexture.set(Re.TEXTURE0);const Pe={u_texture:0,u_opacity:1.05*(Ye=ye.paint.get("raster-particle-fade-opacity-factor"))/(Ye+.05)},Ie=me.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ye;for(const Be of Ee){const[,,dt,rt]=Be;Ae.colorAttachment.set(dt.targetColorTexture.texture),Ce.viewport.set([0,0,Ae.width,Ae.height]),Ce.clear({color:o.am.transparent}),rt&&(dt.backgroundColorTexture.bind(Re.NEAREST,Re.CLAMP_TO_EDGE),Ie.draw(me,Re.TRIANGLES,er.disabled,Ir.disabled,Wr.alphaBlended,Er.disabled,Pe,ye.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments))}})(S,C,re),(function(me,ye,Ee,Ce){const Re=me.context,Ae=Re.gl,Pe=Ee.tileFramebuffer,Ie=me.transform.projection.name==="globe",Ye=Ee.paint.get("raster-particle-max-speed");for(const Be of Ce){const[dt,rt,xt]=Be;Re.activeTexture.set(Ae.TEXTURE0+0),rt.texture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Pe.colorAttachment.set(xt.targetColorTexture.texture);const It=me.getOrCreateProgram("rasterParticleDraw",{defines:rt.defines,overrideFog:!1});Re.activeTexture.set(Ae.TEXTURE0+1);const We=rt.scalarData?[]:[0,1,2,3].map((tt=>o.e3[tt](dt)));We.push(dt);const ze=dt.canonical.x,ot=dt.canonical.y;for(const tt of We){const At=ye.getTile(Ie?tt.wrapped():tt);if(!At)continue;const Pt=At.rasterParticleState;if(!Pt)continue;const Dt=tt.canonical.x+(1<<tt.canonical.z)*(tt.wrap-dt.wrap),Bt=tt.canonical.y;Pt.particleTexture0.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);const cr=Bd(1,Pt.particleTexture0.size[0],[Dt-ze,Bt-ot],0,rt.texture.size,2,Ye,rt.textureOffset,rt.scale,rt.offset);It.draw(me,Ae.POINTS,er.disabled,Ir.disabled,Wr.alphaBlended,Er.disabled,cr,Ee.id,Pt.particleIndexBuffer,void 0,Pt.particleSegment)}}})(S,A,C,re),z.bindFramebuffer.set(C.particleFramebuffer.framebuffer),(function(me,ye,Ee,Ce){const Re=me.context,Ae=Re.gl,Pe=ye.paint.get("raster-particle-max-speed"),Ie=Ce*ye.paint.get("raster-particle-speed-factor")*.15,Ye=(function(dt){return Math.pow(dt,6)})(.01+1*ye.paint.get("raster-particle-reset-rate-factor")),Be=ye.particleFramebuffer;Re.viewport.set([0,0,Be.width,Be.height]);for(const dt of Ee){const[,rt,xt]=dt;Re.activeTexture.set(Ae.TEXTURE0+0),rt.texture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Re.activeTexture.set(Ae.TEXTURE0+1);const It=xt.particleTexture0;It.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);const We=Yp(1,It.size[0],0,rt.texture.size,Pe,Ie,Ye,rt.textureOffset,rt.scale,rt.offset);Be.colorAttachment.set(xt.particleTexture1.texture),Re.clear({color:o.am.transparent}),me.getOrCreateProgram("rasterParticleUpdate",{defines:rt.defines}).draw(me,Ae.TRIANGLES,er.disabled,Ir.disabled,Wr.unblended,Er.disabled,We,ye.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments)}})(S,C,re,ce)})(f,n,l,d),f.renderPass==="translucent"&&((function(S,A,C,k,z){const V=S.context,j=V.gl,q=A.getSource().tileSize,Q=5*(1-o.af(o.cI,o.cI+1,S.transform.zoom))*q+C.paint.get("raster-particle-elevation"),Y=!S.options.moving,re=S.transform.projection.name==="globe";if(!k.length)return;const[te,ce]=S.stencilConfigForOverlap(k),me=[];re&&me.push("PROJECTION_GLOBE_VIEW");const ye=S.stencilModeFor3D();for(const Ee of ce){const Ce=Ee.toUnwrapped(),Re=A.getTile(Ee);if(!Re.rasterParticleState)continue;const Ae=Re.rasterParticleState,Pe=100;Re.registerFadeDuration(Pe);const Ie=A.findLoadedParent(Ee,0),Ye=So(Re,Ie,A,S.transform,Pe);let Be,dt;S.terrain&&S.terrain.prepareDrawTile(),V.activeTexture.set(j.TEXTURE0),Ae.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),V.activeTexture.set(j.TEXTURE1),Ie&&Ie.rasterParticleState?(Ie.rasterParticleState.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Be=Math.pow(2,Ie.tileID.overscaledZ-Re.tileID.overscaledZ),dt=[Re.tileID.canonical.x*Be%1,Re.tileID.canonical.y*Be%1]):Ae.targetColorTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const rt=re?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Ce,Y),xt=S.transform,It=Gl(xt),We=o.dA(Ee.canonical),ze=o.dB(We.getCenter().lat);let ot,tt,At,Pt,Dt;re?(ot=Float32Array.from(o.bh(o.dD(Ee.canonical))),tt=Float32Array.from(xt.globeMatrix),At=Float32Array.from(o.dz(xt)),Pt=[o.aD(xt.center.lng),o.aH(xt.center.lat)],Dt=Float32Array.from(o.dC(Ee.canonical,We,ze,xt.worldSize/xt._pixelsPerMercatorPixel))):(ot=new Float32Array(16),tt=new Float32Array(9),At=new Float32Array(16),Pt=[0,0],Dt=new Float32Array(9));const Bt=Th(rt,ot,tt,At,Dt,dt||[0,0],o.ah(S.transform.zoom),Pt,It,Be||1,Ye,Q),cr=S.isTileAffectedByFog(Ee),pr=S.getOrCreateProgram("rasterParticle",{defines:me,overrideFog:cr});if(S.uploadCommonUniforms(V,pr,Ce),re){const Jt=new er(j.LEQUAL,er.ReadOnly,S.depthRangeFor3D),dr=0,ur=S.globeSharedBuffers;if(ur){const[Lr,Vr,Xr]=ur.getGridBuffers(ze,dr!==0);pr.draw(S,j.TRIANGLES,Jt,ye,Wr.alphaBlended,S.renderElevatedRasterBackface?Er.frontCCW:Er.backCCW,Bt,C.id,Lr,Vr,Xr)}}else{const Jt=S.depthModeForSublayer(0,er.ReadOnly),dr=te[Ee.overscaledZ],{tileBoundsBuffer:ur,tileBoundsIndexBuffer:Lr,tileBoundsSegments:Vr}=S.getTileBoundsBuffers(Re);pr.draw(S,j.TRIANGLES,Jt,dr,Wr.alphaBlended,Er.disabled,Bt,C.id,ur,Lr,Vr)}}S.resetStencilClippingMasks()})(f,n,l,d),f.style.map.triggerRepaint())},background:function(f,n,l,d){const y=l.paint.get("background-color"),x=l.paint.get("background-color-use-theme").constantOr("default")==="none",S=l.paint.get("background-opacity"),A=l.paint.get("background-emissive-strength"),C=l.paint.get("background-pitch-alignment")==="viewport";if(S===0)return;const k=f.context,z=k.gl,V=f.transform,j=V.tileSize,q=l.paint.get("background-pattern");let Q;if(q!==void 0&&(q===null||(Q=f.imageManager.getPattern(o.I.from(q.toString()),l.scope,f.style.getLut(l.scope)),!Q)))return;const Y=!q&&y.a===1&&S===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==Y)return;const re=Ir.disabled,te=f.depthModeForSublayer(0,Y==="opaque"?er.ReadWrite:er.ReadOnly),ce=f.colorModeForDrapableLayerRenderPass(A),me=q?"backgroundPattern":"background";let ye,Ee=d;if(Ee||(ye=f.getBackgroundTiles(),Ee=Object.values(ye).map((Ce=>Ce.tileID))),q&&(k.activeTexture.set(z.TEXTURE0),f.imageManager.bind(f.context,l.scope)),C){const Ce=f.getOrCreateProgram(me,{overrideFog:!1,overrideRtt:!0}),Re=new Float32Array(o.bx([])),Ae=new o.aM(0,0,0,0,0),Pe=q?Pf(Re,A,S,f,0,l.scope,Q,C,{tileID:Ae,tileSize:j}):wu(Re,A,S,y.toPremultipliedRenderColor(x?null:l.lut));Ce.draw(f,z.TRIANGLES,te,re,ce,Er.disabled,Pe,l.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const Ce of Ee){const Re=f.isTileAffectedByFog(Ce),Ae=f.getOrCreateProgram(me,{overrideFog:Re}),Pe=Ce.toUnwrapped(),Ie=d?Ce.projMatrix:f.transform.calculateProjMatrix(Pe);f.prepareDrawTile();const Ye=n?n.getTile(Ce):ye?ye[Ce.key]:new hc(Ce,j,V.zoom,f),Be=q?Pf(Ie,A,S,f,0,l.scope,Q,C,{tileID:Ce,tileSize:j}):wu(Ie,A,S,y.toPremultipliedRenderColor(x?null:l.lut));f.uploadCommonUniforms(k,Ae,Pe);const{tileBoundsBuffer:dt,tileBoundsIndexBuffer:rt,tileBoundsSegments:xt}=f.getTileBoundsBuffers(Ye);Ae.draw(f,z.TRIANGLES,te,re,ce,Er.disabled,Be,l.id,dt,rt,xt)}},sky:function(f,n,l){const d=f._atmosphere?o.ah(f.transform.zoom):1,y=l.paint.get("sky-opacity")*d;if(y===0)return;const x=f.context,S=l.paint.get("sky-type"),A=new er(x.gl.LEQUAL,er.ReadOnly,[0,1]),C=f.frameCounter/1e3%1;S==="atmosphere"?f.renderPass==="offscreen"?l.needsSkyboxCapture(f)&&((function(k,z,V,j){const q=k.context,Q=q.gl;let Y=z.skyboxFbo;if(!Y){Y=z.skyboxFbo=q.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new Ns(q),z.skyboxTexture=q.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,z.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let me=0;me<6;++me)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(Y.framebuffer),q.viewport.set([0,0,32,32]);const re=z.getCenter(k,!0),te=k.getOrCreateProgram("skyboxCapture"),ce=new Float64Array(16);o.bx(ce),o.eh(ce,ce,.5*-Math.PI),js(k,z,te,ce,re,0),o.bx(ce),o.eh(ce,ce,.5*Math.PI),js(k,z,te,ce,re,1),o.bx(ce),o.cR(ce,ce,.5*-Math.PI),js(k,z,te,ce,re,2),o.bx(ce),o.cR(ce,ce,.5*Math.PI),js(k,z,te,ce,re,3),o.bx(ce),js(k,z,te,ce,re,4),o.bx(ce),o.eh(ce,ce,Math.PI),js(k,z,te,ce,re,5),q.viewport.set([0,0,k.width,k.height])})(f,l),l.markSkyboxValid(f)):f.renderPass==="sky"&&(function(k,z,V,j,q){const Q=k.context,Y=Q.gl,re=k.transform,te=k.getOrCreateProgram("skybox");Q.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_CUBE_MAP,z.skyboxTexture);const ce=((me,ye,Ee,Ce,Re)=>({u_matrix:me,u_sun_direction:ye,u_cubemap:0,u_opacity:Ce,u_temporal_offset:Re}))(re.skyboxMatrix,z.getCenter(k,!1),0,j,q);k.uploadCommonUniforms(Q,te),te.draw(k,Y.TRIANGLES,V,Ir.disabled,k.colorModeForRenderPass(),Er.backCW,ce,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)})(f,l,A,y,C):S==="gradient"&&f.renderPass==="sky"&&(function(k,z,V,j,q){const Q=k.context,Y=Q.gl,re=k.transform,te=k.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new Ns(Q)),Q.activeTexture.set(Y.TEXTURE0);let ce=z.colorRampTexture;ce||(ce=z.colorRampTexture=new o.T(Q,z.colorRamp,Y.RGBA8)),ce.bind(Y.LINEAR,Y.CLAMP_TO_EDGE);const me=((ye,Ee,Ce,Re,Ae)=>({u_matrix:ye,u_color_ramp:0,u_center_direction:Ee,u_radius:o.al(Ce),u_opacity:Re,u_temporal_offset:Ae}))(re.skyboxMatrix,z.getCenter(k,!1),z.paint.get("sky-gradient-radius"),j,q);k.uploadCommonUniforms(Q,te),te.draw(k,Y.TRIANGLES,V,Ir.disabled,k.colorModeForRenderPass(),Er.backCW,me,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)})(f,l,A,y,C)},custom:function(f,n,l,d){const y=f.context,x=l.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&l.isDraped(n)){if(f.renderPass==="offscreen"){const S=x.prerender;if(S){if(f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const A=f.transform.pointMerc;S.call(x,y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),o.ah(f.transform.zoom),[A.x,A.y],f.transform.pixelsPerMeterRatio)}else S.call(x,y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const A=x.renderToTile;if(A){const C=d[0].canonical,k={x:C.x+d[0].wrap*(x.wrapTileId?0:1<<C.z),y:C.y,z:C.z};y.setDepthMode(er.disabled),y.setStencilMode(Ir.disabled),y.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),A.call(x,y.gl,k),y.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),y.setStencilMode(Ir.disabled);const S=x.renderingMode==="3d"?new er(f.context.gl.LEQUAL,er.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,er.ReadOnly);if(y.setDepthMode(S),f.transform.projection.name==="globe"){const A=f.transform.pointMerc;x.render(y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),o.ah(f.transform.zoom),[A.x,A.y],f.transform.pixelsPerMeterRatio)}else x.render(y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState(),y.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,n,l,d){if(f.renderPass==="opaque")return;const y=l.paint.get("model-opacity").constantOr(1);if(y===0)return;const x=l.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!x||f.terrain&&y<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof o.ab))return;const S=f.shadowRenderer,A=l.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,A||(S.enabled=!1));const C=()=>{S&&(S.useNormalOffset=!0,A||(S.enabled=!0))},k=n.getSource();if(f.renderPass==="light-beam"&&k.type!=="batched-model")return;if(k.type==="vector"||k.type==="geojson")return(function(te,ce,me,ye,Ee){const Ce=te.transform;if(Ce.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${Ce.projection.name} projection is not yet implemented`);const Re=Ce.getFreeCameraOptions().position;if(!te.modelManager)return;const Ae=te.modelManager;me.modelManager=Ae;const Pe=te.shadowRenderer;if(!me._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ie=me._unevaluatedLayout._values["model-id"],Ye=Object.assign({},me.layout.get("model-id").parameters),Be=te.style.order.indexOf(me.fqid);for(const dt of ye){const rt=ce.getTile(dt).getBucket(me);if(!rt||rt.projection.name!==Ce.projection.name)continue;const xt=rt.getModelUris();xt&&!rt.modelsRequested&&(Ae.addModelsFromBucket(xt,Ee),rt.modelsRequested=!0);const It=Jm(dt,Ce);Ye.zoom=It;const We=Ie.possiblyEvaluate(Ye);if(Ou(te,rt,dt),Us.shadowUniformsInitialized=!1,Us.useSingleShadowCascade=!!Pe&&Pe.getMaxCascadeForTile(dt.toUnwrapped())===0,te.renderPass==="shadow"&&Pe){if(te.currentShadowCascade===1&&rt.isInsideFirstShadowMapFrustum)continue;const tt=Ce.calculatePosMatrix(dt.toUnwrapped(),Ce.worldSize);if(Us.tileMatrix.set(tt),Us.shadowTileMatrix=Float32Array.from(Pe.calculateShadowPassMatrixFromMatrix(tt)),Us.aabb.min.fill(0),Us.aabb.max[0]=Us.aabb.max[1]=o.aj,Us.aabb.max[2]=0,Gd(rt,Us,te,me.scope))continue}const ze=1<<dt.canonical.z,ot=[((Re.x-dt.wrap)*ze-dt.canonical.x)*o.aj,(Re.y*ze-dt.canonical.y)*o.aj,Re.z*ze*o.aj];te.conflationActive&&Object.keys(rt.instancesPerModel).length>0&&te.style.isLayerClipped(me,ce.getSource())&&rt.updateReplacement(dt,te.replacementSource,Be,Ee)&&(rt.uploaded=!1,rt.upload(te.context));for(let tt in rt.instancesPerModel){const At=rt.instancesPerModel[tt];At.features.length>0&&(tt=We.evaluate(At.features[0].feature,{}));const Pt=Ae.getModel(tt,Ee);if(Pt||Ae.hasURLBeenRequested(tt)||rt.modelUris.includes(tt)||(rt.modelUris.push(tt),rt.modelsRequested=!1),Pt&&Pt.uploaded)for(const Dt of Pt.nodes)qd(te,me,Dt,At,ot,dt,Us)}}})(f,n,l,d,k.type==="vector"?l.scope:""),void C();if(!k.loaded())return;if(k.type==="batched-model")return(function(te,ce,me,ye){me.resetLayerRenderingStats(te);const Ee=te.context,Ce=te.transform,Re=te.style.fog,Ae=te.shadowRenderer;if(Ce.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${Ce.projection.name} projection is not yet implemented`);const Pe=te.transform.getFreeCameraOptions().position,Ie=o.c1([],[Pe.x,Pe.y,Pe.z],te.transform.worldSize),Ye=o.eq([],Ie),Be=o.bx([]),dt=o.e9(Ce.center.lat,Ce.zoom),rt=o.bn([],[1,1,1/dt]);o.bo(Be,Be,Ye);const xt=me.paint.get("model-opacity").constantOr(1),It=new er(Ee.gl.LEQUAL,er.ReadWrite,te.depthRangeFor3D),We=new er(Ee.gl.LEQUAL,er.ReadOnly,te.depthRangeFor3D),ze=new o.d6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ot=te.renderPass==="shadow",tt=ot&&Ae?Ae.getCurrentCascadeFrustum():Ce.getFrustum(Ce.scaleZoom(Ce.worldSize)),At=me.paint.get("model-front-cutoff"),Pt=At[2]<1,Dt=$a(te,me.paint.get("model-cutoff-fade-range")),Bt=me.getLayerRenderingStats();(function(cr,pr,Jt,dr){const ur=cr.terrain?cr.terrain.exaggeration():0,Lr=cr.transform.zoom;for(const Vr of dr){const Xr=pr.getTile(Vr).getBucket(Jt);Xr&&(Xr.setFilter(Jt.filter),cr.conflationActive&&Xr.updateReplacement(Vr,cr.replacementSource),Xr.evaluateTransform(cr,Jt),cr.terrain&&ur>0&&Xr.elevationUpdate(cr.terrain,ur,Vr,Jt.source),Xr.needsReEvaluation(cr,Lr,Jt)&&Xr.evaluate(Jt))}})(te,ce,me,ye),(function(){let cr,pr,Jt;Pt?(cr=ye.length-1,pr=-1,Jt=-1):(cr=0,pr=ye.length,Jt=1);const dr=new Float64Array(16),ur=o.cx(),Lr=new o.P(0,0);for(let Vr=cr;Vr!==pr;Vr+=Jt){const Xr=ye[Vr],vn=ce.getTile(Xr).getBucket(me);if(!vn||!vn.uploaded)continue;let Ur=!1;Ae&&(Ur=Ae.getMaxCascadeForTile(Xr.toUnwrapped())===0);const Sn=Ce.calculatePosMatrix(Xr.toUnwrapped(),Ce.worldSize),Mn=vn.modelTraits;!ot&&Pt&&(o.bi(dr,Sn),o.ad(ur,Ie,dr),Lr.x=ur[0],Lr.y=ur[1]);const Xn=[];vn.setFilter(me.filter);for(const Hr of vn.getNodesInfo()){if(Hr.hiddenByReplacement||!Hr.node.meshes)continue;const Tn=Hr.node;let _n=0;te.terrain&&Tn.elevation&&(_n=Tn.elevation*te.terrain.exaggeration());const Ln=(()=>{const Do=Hr.aabb;return ze.min=[...Do.min],ze.max=[...Do.max],ze.min[2]+=_n,ze.max[2]+=_n,o.ad(ze.min,ze.min,Sn),o.ad(ze.max,ze.max,Sn),ze})(),Rr=Hr.evaluatedScale;if(Rr[0]<=1&&Rr[1]<=1&&Rr[2]<=1&&Ln.intersects(tt)===0)continue;if(!ot&&Pt){const Do=.16666666666666666;Hr.cameraCollisionOpacity=Ie[0]>Ln.min[0]&&Ie[0]<Ln.max[0]&&Ie[1]>Ln.min[1]&&Ie[1]<Ln.max[1]&&Ie[2]*dt<Ln.max[2]&&Tn.footprint&&o.bY(Lr,Tn.footprint)?Math.max(Hr.cameraCollisionOpacity-Do,0):Math.min(1,Hr.cameraCollisionOpacity+Do)}const Gn=[...Sn],On=1/o.d4(Xr.canonical),Ti=Tn.anchor?Tn.anchor[0]:0,xn=Tn.anchor?Tn.anchor[1]:0;o.bo(Gn,Gn,[Ti*(Rr[0]-1)+Hr.evaluatedTranslation[0]*On,xn*(Rr[1]-1)+Hr.evaluatedTranslation[1]*On,_n+Hr.evaluatedTranslation[2]]),o.cn(Rr,o.es)||o.cP(Gn,Gn,Rr);const zn=o.az([],Gn,Tn.matrix),Wn=o.az([],Ce.expandedFarZProjMatrix,zn),Gi=o.az([],Ce.expandedFarZProjMatrix,Gn),ti=o.aA([],[Ti,xn,_n,1],Wn)[2];Tn.hidden=!1;let ji=xt;ot||(Pt&&(ji*=Hr.cameraCollisionOpacity,ji*=Qp(Gn,Ce,Hr.aabb,At)),ji*=Ph(Dt,ti)),ji!==0?Xn.push({nodeInfo:Hr,depth:ti,opacity:ji,wvpForNode:Wn,wvpForTile:Gi,nodeModelMatrix:zn,tileModelMatrix:Gn}):Tn.hidden=!0}ot||Xn.sort(((Hr,Tn)=>!Pt||Hr.opacity===1&&Tn.opacity===1?Hr.depth<Tn.depth?-1:1:Hr.opacity===1?-1:Tn.opacity===1?1:Hr.depth>Tn.depth?-1:1));for(const Hr of Xn){const Tn=Hr.nodeInfo,_n=Tn.node;let Ln=o.az([],rt,Hr.tileModelMatrix);o.az(Ln,Be,Ln);const Rr=o.bi([],Ln);o.ea(Rr,Rr),o.cP(Rr,Rr,Bf),Ln=o.az(Ln,Ln,_n.matrix);const Gn=te.renderPass==="light-beam",On=me.paint.get("model-color-use-theme").constantOr("default")==="none",Ti=Mn&o.ex.HasMapboxMeshFeatures,xn=Ti?0:Tn.evaluatedRMEA[0][2];for(let zn=0;zn<_n.meshes.length;++zn){const Wn=_n.meshes[zn],Gi=zn===_n.lightMeshIndex;let ti=Hr.wvpForNode;if(Gi){if(!Gn&&!te.terrain&&te.shadowRenderer){te.currentLayer<te.firstLightBeamLayer&&(te.firstLightBeamLayer=te.currentLayer);continue}ti=Hr.wvpForTile}else if(Gn)continue;const ji={defines:[]},Do=[];if(!ot&&Ae&&(Ae.useNormalOffset=!!Wn.normalBuffer),Mu(ji.defines,Do,Wn,te,On?null:me.lut),Ti||ji.defines.push("DIFFUSE_SHADED"),Ur&&ji.defines.push("SHADOWS_SINGLE_CASCADE"),Bt&&(ot?Bt.numRenderedVerticesInShadowPass+=Wn.vertexArray.length:Bt.numRenderedVerticesInTransparentPass+=Wn.vertexArray.length),ot){Ff(Wn,Hr.nodeModelMatrix,te,me);continue}let Ko=null;if(Re){const Yo=Hl(Hr.nodeModelMatrix,te.transform);if(Ko=new Float32Array(Yo),Ce.projection.name!=="globe"){const Mi=Wn.aabb.min,Oi=Wn.aabb.max,[Jn,eo]=Re.getOpacityForBounds(Yo,Mi[0],Mi[1],Oi[0],Oi[1]);ji.overrideFog=Jn>=Tt||eo>=Tt}}const Vo=Wn.material;let ko;Vo.occlusionTexture&&Vo.occlusionTexture.offsetScale&&(ko=Vo.occlusionTexture.offsetScale,ji.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ao=te.getOrCreateProgram("model",ji);!ot&&Ae&&Ae.setupShadowsFromMatrix(Hr.tileModelMatrix,Ao,Ae.useNormalOffset),te.uploadCommonUniforms(Ee,Ao,null,Ko);const Oa=Vo.pbrMetallicRoughness;Oa.metallicFactor=.9,Oa.roughnessFactor=.5;const Xa=Tu(new Float32Array(ti),new Float32Array(Ln),new Float32Array(Rr),new Float32Array(_n.matrix),te,Hr.opacity,Oa.baseColorFactor,Vo.emissiveFactor,Oa.metallicFactor,Oa.roughnessFactor,Vo,xn,me,[0,0,0],ko);!Gi&&(Tn.hasTranslucentParts||Hr.opacity<1)&&Ao.draw(te,Ee.gl.TRIANGLES,It,Ir.disabled,Wr.disabled,Er.backCCW,Xa,me.id,Wn.vertexBuffer,Wn.indexBuffer,Wn.segments,me.paint,te.transform.zoom,void 0,Do),Ao.draw(te,Ee.gl.TRIANGLES,Gi?We:It,Ir.disabled,Gi||Hr.opacity<1||Tn.hasTranslucentParts?Wr.alphaBlended:Wr.unblended,Er.backCCW,Xa,me.id,Wn.vertexBuffer,Wn.indexBuffer,Wn.segments,me.paint,te.transform.zoom,void 0,Do)}}}})()})(f,n,l,d),void C();if(k.type!=="model")return;const z=k.getModels(),V=[],j=f.transform.getFreeCameraOptions().position,q=o.c1([],[j.x,j.y,j.z],f.transform.worldSize);o.eq(q,q);const Q=[],Y=[];let re=0;for(const te of z){const ce=l.paint.get("model-rotation").constantOr(null),me=l.paint.get("model-scale").constantOr(null),ye=l.paint.get("model-translation").constantOr(null);te.computeModelMatrix(f,ce,me,ye,!0,!0,!1);const Ee=o.bx([]),Ce=o.e9(te.position.lat,f.transform.zoom),Re=o.bn([],[1,1,1/Ce]);o.bo(Ee,Ee,q),V.push({zScaleMatrix:Re,negCameraPosMatrix:Ee});for(const Ae of te.nodes)$d(f.transform,Ae,te.matrix,f.transform.expandedFarZProjMatrix,re,Q,Y);re++}if(Q.sort(((te,ce)=>ce.depth-te.depth)),f.renderPass!=="shadow"){if(y===1)for(const te of Y)Dc(te,f,l,V[te.modelIndex],Ir.disabled,f.colorModeForRenderPass());else{for(const te of Y)Dc(te,f,l,V[te.modelIndex],Ir.disabled,Wr.disabled);for(const te of Y)Dc(te,f,l,V[te.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const te of Q)Dc(te,f,l,V[te.modelIndex],Ir.disabled,f.colorModeForRenderPass());C()}else{for(const te of Y)Ff(te.mesh,te.nodeModelMatrix,f,l);for(const te of Q)Ff(te.mesh,te.nodeModelMatrix,f,l);C()}}},Nf={line:function(f,n,l){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(n){const d=n.getVisibleCoordinates();for(const y of d){const x=n.getTile(y).getBucket(f);if(x&&(x.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,n,l){const d=n.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,d.type==="vector"?f.scope:""));if(d.type==="batched-model"||d.type!=="model")return;const y=d.getModels();for(const x of y)x.upload(l.context)},raster:function(f,n,l){const d=n.getSource();if(!(d instanceof sc&&d.loaded()))return;const y=f.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!y)return;const x=f.paint.get("raster-array-band")||d.getInitialBand(y);if(x==null)return;const S=n.getIds().map((A=>n.getTileByID(A)));for(const A of S)A.updateNeeded(f.id,x)&&d.prepareTile(A,y,f.id,x)},"raster-particle":function(f,n,l){const d=n.getSource();if(!(d instanceof sc&&d.loaded()))return;const y=f.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!y)return;const x=f.paint.get("raster-particle-array-band")||d.getInitialBand(y);if(x==null)return;const S=n.getIds().map((A=>n.getTileByID(A)));for(const A of S)A.updateNeeded(f.id,x)&&d.prepareTile(A,y,f.id,x)}},jf={fill:ir},ga={fill:function(f,n,l,d){if(!l.layout||l.layout.get("fill-elevation-reference")==="none")return;const y=f.context.gl,x=new er(y.LEQUAL,er.ReadOnly,f.depthRangeFor3D),S=new Ir({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),A=f.transform.getFreeCameraOptions().position,C=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const k of d){const z=n.getTile(k),V=z.getBucket(l);if(!V)continue;const j=V.elevatedStructures;if(!j||j.depthSegments.segments[0].primitiveLength===0)continue;const q=Iu(k.toUnwrapped(),A),Q=f.translatePosMatrix(k.projMatrix,z,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),Y=yl(Q,q,0,1,0);C.draw(f,y.TRIANGLES,x,S,Wr.disabled,Er.disabled,Y,l.id,j.vertexBuffer,j.indexBuffer,j.depthSegments,l.paint,f.transform.zoom)}}};class Lc{constructor(n,l,d,y,x,S){this.context=new Eu(n,l),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const A=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const k of A)this._debugParams.enabledLayers[k]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),x.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const k of A)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],k);this.occlusionParams=new Du(x),this.setup(),this.numSublayers=Ho.maxUnderzooming+Ho.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new C_(this),this._wireframeDebugCache=new kc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const C=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,C,n.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=S}updateTerrain(n,l){const d=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new wf(this,n));const y=this._terrain;this.transform.elevation=d?y:null,y.update(n,this.transform,l),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(n){const l=n.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,y]=l.getFovAdjustedRange(this.transform._fov);if(d>y)return void(this.transform.fogCullDistSq=null);const x=d+.78*(y-d);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(n){n&&!this._terrain&&(this._terrain=new wf(this,this.style)),this._forceTerrainMode=n}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,l){if(this.width=n*o.q.devicePixelRatio,this.height=l*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const n=this.context,l=new o.ba;l.emplaceBack(0,0),l.emplaceBack(o.aj,0),l.emplaceBack(0,o.aj),l.emplaceBack(o.aj,o.aj),this.tileExtentBuffer=n.createVertexBuffer(l,o.bc.members),this.tileExtentSegments=o.bd.simpleSegment(0,0,4,2);const d=new o.ba;d.emplaceBack(0,0),d.emplaceBack(o.aj,0),d.emplaceBack(0,o.aj),d.emplaceBack(o.aj,o.aj),this.debugBuffer=n.createVertexBuffer(d,o.bc.members),this.debugSegments=o.bd.simpleSegment(0,0,4,5);const y=new o.ba;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(y,o.bc.members),this.viewportSegments=o.bd.simpleSegment(0,0,4,2);const x=new o.aZ;x.emplaceBack(0,0,0,0),x.emplaceBack(o.aj,0,o.aj,0),x.emplaceBack(0,o.aj,0,o.aj),x.emplaceBack(o.aj,o.aj,o.aj,o.aj),this.mercatorBoundsBuffer=n.createVertexBuffer(x,o.bf.members),this.mercatorBoundsSegments=o.bd.simpleSegment(0,0,4,2);const S=new o.a_;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(S);const A=new o.bb;for(const k of[0,1,3,2,0])A.emplaceBack(k);this.debugIndexBuffer=n.createIndexBuffer(A),this.emptyTexture=new o.T(n,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA8),this.identityMat=o.bz();const C=this.context.gl;this.stencilClearMode=new Ir({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,er.disabled,this.stencilClearMode,Wr.disabled,Er.disabled,ia(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,l,d){if(!l||this.currentStencilSource===l.id||!n.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let A=!1;for(const C of d)if(this._tileClippingMaskIDs[C.key]===void 0){A=!0;break}if(!A)return}this.currentStencilSource=l.id;const y=this.context,x=y.gl;this.nextStencilID+d.length>256&&this.clearStencil(),y.setColorMode(Wr.disabled),y.setDepthMode(er.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of d){const C=l.getTile(A),k=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:V,tileBoundsSegments:j}=this.getTileBoundsBuffers(C);S.draw(this,x.TRIANGLES,er.disabled,new Ir({func:x.ALWAYS,mask:0},k,255,x.KEEP,x.KEEP,x.REPLACE),Wr.disabled,Er.disabled,ia(A.projMatrix),"$clipping",z,V,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,l=this.context.gl;return new Ir({func:l.NOTEQUAL,mask:255},n,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const l=this.context.gl;return new Ir({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(n){const l=this.context.gl,d=n.sort(((S,A)=>A.overscaledZ-S.overscaledZ)),y=d[d.length-1].overscaledZ,x=d[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const S={};for(let A=0;A<x;A++)S[A+y]=new Ir({func:l.GEQUAL,mask:255},A+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=x,[S,d]}return[{[y]:Ir.disabled},d]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new Wr([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new o.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Wr.unblended:Wr.alphaBlended}colorModeForDrapableLayerRenderPass(n){const l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Wr([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new o.am(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,l,d,y=!1){if(this.depthOcclusion)return new er(this.context.gl.GREATER,er.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return er.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new er(d||this.context.gl.LEQUAL,l,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const n=this.context.gl,l=Math.ceil(this.width),d=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),x=n.getParameter(n.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===l&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),l!==0&&d!==0&&(this.depthFBO=new vl(this.context,l,d,!1,"texture"),this.depthTexture=new o.T(this.context,{width:l,height:d,data:null},n.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),n.bindTexture(n.TEXTURE_2D,x),this.depthFBO&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),n.blitFramebuffer(0,0,l,d,0,0,l,d,n.DEPTH_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((n,l)=>n+l/this._fpsHistory.length),0))}render(n,l){const d=o.q.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=n.map.repaint,this.style=n,this.options=l;const y=this.style._mergedLayers,x=!(!this.terrain||!this.terrain.enabled),S=()=>this.style._getOrder(x).filter((We=>{const ze=y[We];return!(ze.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ze.type]}));let A=S(),C=!1,k=!1,z=null;for(const We of A){const ze=y[We];ze.type==="circle"?C=!0:ze.type==="building"?z=ze:ze.type==="symbol"&&(ze.hasInitialOcclusionOpacityProperties?k=!0:C=!0)}let V=A.map((We=>y[We]));const j=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let q=0,Q=!1;for(const We in j){const ze=j[We];ze.used&&(ze.prepare(this.context),ze.getSource().usedInConflation&&++q)}let Y=!1;for(const We of V)We.isHidden(this.transform.zoom)||(We.type==="clip"&&(Y=!0),this.prepareLayer(We));const re={},te={},ce={},me={},ye={};for(const We in j){const ze=j[We];re[We]=ze.getVisibleCoordinates(),te[We]=re[We].slice().reverse(),ce[We]=ze.getVisibleCoordinates(!0).reverse(),me[We]=ze.getShadowCasterCoordinates(),ye[We]=ze.sortCoordinatesByDistance(re[We])}const Ee=We=>{const ze=this.style.getLayerSourceCache(We);return ze&&ze.used?ze.getSource():null};if(q||Y||this._clippingActiveLastFrame){const We=[],ze=[];let ot=0;for(const tt of V)this.isSourceForClippingOrConflation(tt,Ee(tt))&&(We.push(tt),ze.push(ot)),ot++;if(We&&(Y||We.length>1)||this._clippingActiveLastFrame){Y=!1;const tt=[];for(let At=0;At<We.length;At++){const Pt=We[At],Dt=ze[At],Bt=this.style.getLayerSourceCache(Pt);if(!Bt||!Bt.used||!Bt.getSource().usedInConflation&&Pt.type!=="clip"&&Pt.type!=="building")continue;let cr=o.eF,pr=o.bW.None;const Jt=[];let dr=!0;if(Pt.type==="building")cr=o.eH;else if(Pt.type==="clip"){cr=Dt;for(const ur of Pt.layout.get("clip-layer-types"))pr|=ur==="model"?o.bW.Model:ur==="symbol"?o.bW.Symbol:o.bW.FillExtrusion;for(const ur of Pt.layout.get("clip-layer-scope"))Jt.push(ur);Pt.isHidden(this.transform.zoom)?dr=!1:Y=!0}dr&&tt.push({layer:Pt.fqid,cache:Bt,order:cr,clipMask:pr,clipScope:Jt})}this.replacementSource.setSources(tt),Q=!0}}this._clippingActiveLastFrame=Y,Q||this.replacementSource.clear(),this.conflationActive=Q,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let We=0;We<V.length;We++){const ze=V[We],ot=ze.cutoffRange();if(this.longestCutoffRange=Math.max(ot,this.longestCutoffRange),ot>0){const tt=Ee(ze);tt&&(this.minCutoffZoom=Math.max(tt.minzoom,this.minCutoffZoom)),ze.minzoom&&(this.minCutoffZoom=Math.max(ze.minzoom,this.minCutoffZoom))}ze.is3D(x)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=We),this._lastOcclusionLayer=We)}const Ce=this.style&&this.style.fog;Ce?(this._fogVisible=Ce.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ce.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ce),this.opaquePassCutoff=0,A=S(),V=A.map((We=>y[We])));const Re=this._shadowRenderer;if(Re){Re.updateShadowParameters(this.transform,this.style.directionalLight);for(const We in j)for(const ze of re[We]){let ot={min:0,max:0};this.terrain&&(ot=this.terrain.getMinMaxForTile(ze)||ot),Re.addShadowReceiver(ze.toUnwrapped(),ot.min,ot.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eG(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ge(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ae=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Pe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ae&&!this._snow&&(this._snow=new em(this)),!Ae&&this._snow&&(this._snow.destroy(),delete this._snow),Pe&&!this._rain&&(this._rain=new ku(this)),!Pe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),z){this.buildingTileBorderManager||(this.buildingTileBorderManager=new fs);const We=this.style.getLayerSourceCache(z);this.buildingTileBorderManager.updateBorders(We,z)}if(!un.has(this.context.gl))return;this.renderPass="offscreen";for(const We of V){const ze=n.getLayerSourceCache(We);if(!We.hasOffscreenPass()||We.isHidden(this.transform.zoom))continue;const ot=ze?te[ze.id]:void 0;(We.type==="custom"||We.type==="raster"||We.type==="raster-particle"||We.isSky()||ot&&ot.length)&&this.renderLayer(this,ze,We,ot)}this.depthRangeFor3D=[0,1-(V.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,me)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ie=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ye=(()=>{if(l.showOverdrawInspector)return o.am.black;const We=this.style.fog;if(We&&this.transform.projection.supportsFog){const ze=this.style.getLut(We.scope);if(!Ie){const ot=We.properties.get("color-use-theme")==="none",tt=We.properties.get("color").toNonPremultipliedRenderColor(ot?null:ze).toArray01();return new o.am(...tt)}if(Ie){const ot=We.properties.get("space-color-use-theme")==="none",tt=We.properties.get("space-color").toNonPremultipliedRenderColor(ot?null:ze).toArray01();return new o.am(...tt)}}return o.am.transparent})();if(this.context.clear({color:Ye,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ie&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=A.length-1;this.currentLayer>=0;this.currentLayer--){const We=V[this.currentLayer],ze=n.getLayerSourceCache(We);if(We.isSky())continue;const ot=ze?(We.is3D(x)?ye:te)[ze.id]:void 0;this._renderTileClippingMasks(We,ze,ot),this.renderLayer(this,ze,We,ot)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ie&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<A.length;this.currentLayer++){const We=V[this.currentLayer],ze=n.getLayerSourceCache(We);We.isSky()&&this.renderLayer(this,ze,We,ze?te[ze.id]:void 0)}function Be(We,ze){let ot;return ze&&(ot=(We.type==="symbol"?ce:We.is3D(x)?ye:te)[ze.id]),ot}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<A.length;){const We=V[this.currentLayer];if(We.type==="raster"||We.type==="raster-particle"){const ze=n.getLayerSourceCache(We);this.renderLayer(this,ze,We,Be(We,ze))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let dt=0;Re&&(dt=Re.getShadowCastingLayerCount());let rt=!1,xt=-1;for(let We=0;We<A.length;++We){const ze=V[We];ze.isHidden(this.transform.zoom)||ze.is3D(x)&&(xt=We)}k&&xt===-1&&(C=!0);let It=!1;for(;this.currentLayer<A.length;){const We=V[this.currentLayer],ze=n.getLayerSourceCache(We);if(We.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(We)){if(We.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!It&&We.is3D(x)&&!x){const ot=this.currentLayer,tt=At=>{for(this.currentLayer=0;this.currentLayer<V.length;this.currentLayer++){const Pt=V[this.currentLayer];if(jf[Pt.type]){const Dt=this.style.getLayerSourceCache(Pt);jf[Pt.type](this,Dt,Pt,Be(Pt,Dt),At)}}};tt("initialize"),tt("reset"),this.currentLayer=ot,It=!0}if(C&&!rt&&this.terrain&&!this.transform.isOrthographic&&(rt=!0,this.blitDepth()),k&&xt!==-1&&this.currentLayer===xt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(We,ze,ze?re[ze.id]:void 0),this.renderLayer(this,ze,We,Be(We,ze)),!this.terrain&&Re&&dt>0&&We.hasShadowPass()&&--dt==0){{this.clearStencil(),this.resetStencilClippingMasks();const ot=this.currentLayer;for(this.currentLayer=0;this.currentLayer<V.length;this.currentLayer++){const tt=V[this.currentLayer];if(ga[tt.type]){const At=this.style.getLayerSourceCache(tt);ga[tt.type](this,At,tt,Be(tt,At))}}this.currentLayer=ot}if(Re.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const ot=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ot;this.currentLayer++){const tt=V[this.currentLayer];if(!tt.hasLightBeamPass())continue;const At=n.getLayerSourceCache(tt);this.renderLayer(this,At,tt,At?te[At.id]:void 0)}this.currentLayer=ot,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ot=this.currentLayer;this.depthOcclusion=!0;for(const tt of this.layersWithOcclusionOpacity){this.currentLayer=tt;const At=V[this.currentLayer],Pt=n.getLayerSourceCache(At),Dt=Pt?te[Pt.id]:void 0;this.terrain||this._renderTileClippingMasks(At,Pt,Pt?re[Pt.id]:void 0),this.renderLayer(this,Pt,At,Dt)}this.depthOcclusion=!1,this.currentLayer=ot,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let We=null;V.forEach((ze=>{const ot=n.getLayerSourceCache(ze);ot&&!ze.isHidden(this.transform.zoom)&&ot.getVisibleCoordinates().length&&(!We||We.getSource().maxzoom<ot.getSource().maxzoom)&&(We=ot)})),We&&this.options.showTileBoundaries&&hs(this,We,We.getVisibleCoordinates(),o.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&hs(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(We){const ze=We.transform.padding;Bs(We,We.transform.height-(ze.top||0),3,Ud),Bs(We,ze.bottom||0,3,Qi),Zi(We,ze.left||0,3,Ah),Zi(We,We.transform.width-(ze.right||0),3,Lf);const ot=We.transform.centerPoint;(function(tt,At,Pt,Dt){so(tt,At-1,Pt-10,2,20,Dt),so(tt,At-10,Pt-1,20,2,Dt)})(We,ot.x,We.transform.height-ot.y,Vd)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Q||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);const{unsupportedLayers:l}=this.transform.projection,d=!l||!l.includes(n.type);if(Nf[n.type]&&(d||this.terrain&&n.type==="custom")){const y=this.style.getLayerSourceCache(n);Nf[n.type](n,y,this)}this.gpuTimingEnd()}renderLayer(n,l,d,y){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||y&&y.length)&&(this.id=d.id,this.gpuTimingStart(d),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(d.type)&&(!n.terrain||d.type!=="custom")||d.type==="clip"||Zd[d.type](n,l,d,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery,d=this.context.gl;let y=this.gpuTimers[n.id];y||(y=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:d.createQuery()}),y.calls++,d.beginQuery(l.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,l=this.context.gl,d=l.createQuery();this.deferredRenderGpuTimeQueries.push(d),l.beginQuery(n.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const l={};for(const d in n){const y=n[d],x=this.context.extTimerQuery,S=x.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(y.query),l[d]=S}return l}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.gl;let d=0;for(const y of n)d+=l.getQueryParameter(y,l.QUERY_RESULT)/1e6,l.deleteQuery(y);return d}translatePosMatrix(n,l,d,y,x){if(!d[0]&&!d[1])return n;const S=x?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(S){const k=Math.sin(S),z=Math.cos(S);d=[d[0]*z-d[1]*k,d[0]*k+d[1]*z]}const A=[x?d[0]:o.aw(l,d[0],this.transform.zoom),x?d[1]:o.aw(l,d[1],this.transform.zoom),0],C=new Float32Array(16);return o.bo(C,n,A),C}saveTileTexture(n){if(n.context!==this.context)return;const l=n.size[0],d=this._tileTextures[l];d?d.push(n):this._tileTextures[l]=[n]}getTileTexture(n){const l=this._tileTextures[n];return l&&l.length>0?l.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,l,d){const y=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,x=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||x.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||y||l!==void 0&&!l||x.push("FOG","FOG_DITHERING"),y&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(n,l){this.cache=this.cache||{};const d=l&&l.defines||[],y=l&&l.config,x=this.currentGlobalDefines(n,l&&l.overrideFog,l&&l.overrideRtt).concat(d),S=vs.cacheKey(pu[n],n,x,y);return this.cache[S]||(this.cache[S]=new vs(this.context,n,pu[n],y,Jp[n],x)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,l){if(this.style.enable3dLights()){const d=this.style.directionalLight,y=this.style.ambientLight;if(d&&y){const x=((S,A,C)=>{const k=S.properties.get("direction"),z=S.properties.get("color-use-theme")==="none",V=S.properties.get("color").toNonPremultipliedRenderColor(z?null:C.getLut(S.scope)).toArray01(),j=S.properties.get("intensity"),q=A.properties.get("color-use-theme")==="none",Q=A.properties.get("color").toNonPremultipliedRenderColor(q?null:C.getLut(A.scope)).toArray01(),Y=A.properties.get("intensity"),re=[k.x,k.y,k.z],te=o.dI(Q,Y),ce=o.dI(V,j);return{u_lighting_ambient_color:te,u_lighting_directional_dir:re,u_lighting_directional_color:ce,u_ground_radiance:kd(re,ce,te)}})(d,y,this.style);l.setLightsUniformValues(n,x)}}}uploadCommonUniforms(n,l,d,y,x){if(this.uploadCommonLightUniforms(n,l),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const A=S.getOpacity(this.transform.pitch),C=((k,z,V,j,q,Q,Y,re,te,ce,me,ye)=>{const Ee=k.transform,Ce=z.properties.get("color-use-theme")==="none",Re=z.properties.get("color").toNonPremultipliedRenderColor(Ce?null:k.style.getLut(z.scope)).toArray01();Re[3]=j;const Ae=k.frameCounter/1e3%1,[Pe,Ie]=z.properties.get("vertical-range");return{u_fog_matrix:V?Ee.calculateFogTileMatrix(V):ye||k.identityMat,u_fog_range:z.getFovAdjustedRange(Ee._fov),u_fog_color:Re,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Pe,Ie),Ie],u_fog_temporal_offset:Ae,u_frustum_tl:q,u_frustum_tr:Q,u_frustum_br:Y,u_frustum_bl:re,u_globe_pos:te,u_globe_radius:ce,u_viewport:me,u_globe_transition:o.ah(Ee.zoom),u_is_globe:+(Ee.projection.name==="globe")}})(this,S,d,A,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],y);l.setFogUniformValues(n,C)}x&&l.setCutoffUniformValues(n,x.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,l=n.createTexture();return n.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,l=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const y of d)l[y.key]=n[y.key]||new hc(y,512,this.transform.tileZoom,this,void 0,this.worldview);return l}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(n,l){return!(!n.is3D(!(!this.terrain||!this.terrain.enabled))||n.type!=="clip"&&n.type!=="building"&&(n.minzoom&&n.minzoom>this.transform.zoom||(this.style._clipLayerPresent||n.sourceLayer!=="building"&&n.sourceLayer!=="procedural_buildings")&&(!l||l.type!=="batched-model")))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[n.key];return l||(this._cachedTileFogOpacities[n.key]=l=this.style.fog.getOpacityForTile(n)),l[0]>=Tt||l[1]>=Tt}setupDepthForOcclusion(n,l,d){const y=this.context,x=y.gl,S=!!d;var A;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(x.TEXTURE3),n&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((A=this.depthRangeFor3D)[1]-A[0]),-1-2*A[0]/(A[1]-A[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),y.activeTexture.set(x.TEXTURE0),S||l.setTerrainUniformValues(y,d)}}function Mh(f,n){let l=!1,d=null;const y=()=>{d=null,l&&(f(),d=setTimeout(y,n),l=!1)};return()=>(l=!0,d||y(),d)}class Xd{constructor(n){this._hashName=n&&encodeURIComponent(n),o.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Mh(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const l=Wa(n);if(this._hashName){const d=this._hashName;let y=!1;const x=location.hash.slice(1).split("&").map((S=>{const A=S.split("=")[0];return A===d?(y=!0,`${A}=${l}`):S})).filter((S=>S));return y||x.push(`${d}=${l}`),`#${x.join("&")}`}return`#${l}`}_getCurrentHash(){const n=location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map((d=>d.split("="))).forEach((d=>{d[0]===this._hashName&&(l=d)})),(l&&l[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some((d=>isNaN(Number(d))))){const d=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(l[3]||0):n.getBearing();return n.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:d,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Wa(f,n){const l=f.getCenter(),d=Math.round(100*f.getZoom())/100,y=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),S=Math.round(l.lng*x)/x,A=Math.round(l.lat*x)/x,C=f.getBearing(),k=f.getPitch();let z=n?`/${S}/${A}/${d}`:`${d}/${A}/${S}`;return(C||k)&&(z+="/"+Math.round(10*C)/10),k&&(z+=`/${Math.round(k)}`),z}const zc={linearity:.3,easing:o.eI(0,0,.3,1)},Vs=o.h({deceleration:2500,maxSpeed:1400},zc),Kd=o.h({deceleration:20,maxSpeed:1400},zc),$s=o.h({deceleration:1e3,maxSpeed:360},zc),Yd=o.h({deceleration:1e3,maxSpeed:90},zc);class Oh{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,l=o.q.now();for(;n.length>0&&l-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)l.zoom+=x.zoomDelta||0,l.bearing+=x.bearingDelta||0,l.pitch+=x.pitchDelta||0,x.panDelta&&l.pan._add(x.panDelta),x.around&&(l.around=x.around),x.pinchAround&&(l.pinchAround=x.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(l.pan.mag()){const x=Fc(l.pan.mag(),d,o.h({},Vs,n||{}));y.offset=l.pan.mult(x.amount/l.pan.mag()),y.center=this._map.transform.center,qs(y,x)}if(l.zoom){const x=Fc(l.zoom,d,Kd);y.zoom=this._map.transform.zoom+x.amount,qs(y,x)}if(l.bearing){const x=Fc(l.bearing,d,$s);y.bearing=this._map.transform.bearing+o.ay(x.amount,-179,179),qs(y,x)}if(l.pitch){const x=Fc(l.pitch,d,Yd);y.pitch=this._map.transform.pitch+x.amount,qs(y,x)}if(y.zoom||y.bearing){const x=l.pinchAround===void 0?l.around:l.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function qs(f,n){(!f.duration||f.duration<n.duration)&&(f.duration=n.duration,f.easing=n.easing)}function Fc(f,n,l){const{maxSpeed:d,linearity:y,deceleration:x}=l,S=o.ay(f*y/(n/1e3),-d,d),A=Math.abs(S)/(x*y);return{easing:l.easing,duration:1e3*A,amount:S*(A/2)}}class ai extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,d,y={}){const x=De(l.getCanvasContainer(),d),S=l.unproject(x);super(n,o.h({point:x,lngLat:S,originalEvent:d},y)),this._defaultPrevented=!1,this.target=l}}class Rh extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,d){const y=n==="touchend"?d.changedTouches:d.touches,x=Xe(l.getCanvasContainer(),y),S=x.map((C=>l.unproject(C))),A=x.reduce(((C,k,z,V)=>C.add(k.div(V.length))),new o.P(0,0));super(n,{points:x,point:A,lngLats:S,lngLat:l.unproject(A),originalEvent:d}),this._defaultPrevented=!1}}class Jd extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l){super("wheel",{originalEvent:l}),this._defaultPrevented=!1}}class Qd{constructor(n,l){this._map=n,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new Jd(this._map,n))}mousedown(n,l){return this._mousedownPos=l,this._firePreventable(new ai(n.type,this._map,n))}mouseup(n){this._map.fire(new ai(n.type,this._map,n))}preclick(n){const l=o.h({},n);l.type="preclick",this._map.fire(new ai(l.type,this._map,l))}click(n,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(n),this._map.fire(new ai(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new ai(n.type,this._map,n))}mouseover(n){this._map.fire(new ai(n.type,this._map,n))}mouseout(n){this._map.fire(new ai(n.type,this._map,n))}touchstart(n){return this._firePreventable(new Rh(n.type,this._map,n))}touchmove(n){this._map.fire(new Rh(n.type,this._map,n))}touchend(n){this._map.fire(new Rh(n.type,this._map,n))}touchcancel(n){this._map.fire(new Rh(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bc{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new ai(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ai("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new ai(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ep{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,l){this.isEnabled()&&n.shiftKey&&n.button===0&&(_e(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(n,l){if(!this._active)return;const d=l,y=this._startPos,x=this._lastPos;if(!y||!x||x.equals(d)||!this._box&&d.dist(y)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=H("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const S=Math.min(y.x,d.x),A=Math.max(y.x,d.x),C=Math.min(y.y,d.y),k=Math.max(y.y,d.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${S}px,${C}px)`,this._box.style.width=A-S+"px",this._box.style.height=k-C+"px")}))}mouseupWindow(n,l){if(!this._active)return;const d=this._startPos,y=l;if(d&&n.button===0){if(this.reset(),Te(),d.x!==y.x||d.y!==y.y)return this._map.fire(new o.A("boxzoomend",{originalEvent:n})),{cameraAnimation:x=>x.fitScreenCoordinates(d,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),le(),delete this._startPos,delete this._lastPos}_fireEvent(n,l){return this._map.fire(new o.A(n,{originalEvent:l}))}}function Dh(f,n){const l={};for(let d=0;d<f.length;d++)l[f[d].identifier]=n[d];return l}class tm{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,l,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),d.length===this.numTouches&&(this.centroid=(function(y){const x=new o.P(0,0);for(const S of y)x._add(S);return x.div(y.length)})(l),this.touches=Dh(d,l)))}touchmove(n,l,d){if(this.aborted||!this.centroid)return;const y=Dh(d,l);for(const x in this.touches){const S=y[x];(!S||S.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(n,l,d){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Eo{constructor(n){this.singleTap=new tm(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,l,d){this.singleTap.touchstart(n,l,d)}touchmove(n,l,d){this.singleTap.touchmove(n,l,d)}touchend(n,l,d){const y=this.singleTap.touchend(n,l,d);if(y){const x=n.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(y)<30;if(x&&S||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class aa{constructor(){this._zoomIn=new Eo({numTouches:1,numTaps:2}),this._zoomOut=new Eo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,l,d){this._zoomIn.touchstart(n,l,d),this._zoomOut.touchstart(n,l,d)}touchmove(n,l,d){this._zoomIn.touchmove(n,l,d),this._zoomOut.touchmove(n,l,d)}touchend(n,l,d){const y=this._zoomIn.touchend(n,l,d),x=this._zoomOut.touchend(n,l,d);return y?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(y)},{originalEvent:n})}):x?(this._active=!0,n.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(x)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const tp={0:1,2:2},Uf={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class zu{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,l){return!1}_move(n,l){return{}}mousedown(n,l){if(this._lastPoint)return;const d=wt(n);this._correctButton(n,d)&&(this._lastPoint=l,this._eventButton=d)}mousemoveWindow(n,l){const d=this._lastPoint;if(d){if(n.preventDefault(),this._eventButton!=null&&(function(y,x){const S=tp[x];return y.buttons===void 0||(y.buttons&S)!==S})(n,this._eventButton))this.reset();else if(this._moved||!(l.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(d,l)}}mouseupWindow(n){this._lastPoint&&wt(n)===this._eventButton&&(this._moved&&Te(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rp extends zu{mousedown(n,l){super.mousedown(n,l),this._lastPoint&&(this._active=!0)}_correctButton(n,l){return l===0&&!n.ctrlKey}_move(n,l){return{around:l,panDelta:l.sub(n)}}}class Vf extends zu{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?Uf[n.pitchRotateKey]:void 0}_correctButton(n,l){return this._pitchRotateKey?l===0&&n[this._pitchRotateKey]:l===0&&n.ctrlKey||l===2}_move(n,l){const d=.8*(l.x-n.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class $f extends zu{constructor(n){super(n),this._pitchRotateKey=n.pitchRotateKey?Uf[n.pitchRotateKey]:void 0}_correctButton(n,l){return this._pitchRotateKey?l===0&&n[this._pitchRotateKey]:l===0&&n.ctrlKey||l===2}_move(n,l){const d=-.5*(l.y-n.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(n){this._pitchRotateKey||n.preventDefault()}}class rm{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),o.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(n,l,d){return this._calculateTransform(n,l,d)}touchmove(n,l,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!o.eJ())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,l,d)}}touchend(n,l,d){this._calculateTransform(n,l,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,l,d){d.length>0&&(this._active=!0);const y=Dh(d,l),x=new o.P(0,0),S=new o.P(0,0);let A=0;for(const k in y){const z=y[k],V=this._touches[k];V&&(x._add(z),S._add(z.sub(V)),A++,y[k]=z)}if(this._touches=y,A<this._minTouches||!S.mag())return;const C=S.div(A);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(A),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class kh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,l,d){return{}}touchstart(n,l,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([l[0],l[1]]))}touchmove(n,l,d){const y=this._firstTwoTouches;if(!y)return;n.preventDefault();const[x,S]=y,A=Lh(d,l,x),C=Lh(d,l,S);if(!A||!C)return;const k=this._aroundCenter?null:A.add(C).div(2);return this._move([A,C],k,n)}touchend(n,l,d){if(!this._firstTwoTouches)return;const[y,x]=this._firstTwoTouches,S=Lh(d,l,y),A=Lh(d,l,x);S&&A||(this._active&&Te(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Lh(f,n,l){for(let d=0;d<f.length;d++)if(f[d].identifier===l)return n[d]}function np(f,n){return Math.log(f/n)/Math.LN2}class ip extends kh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,l){const d=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(np(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:np(this._distance,d),pinchAround:l}}}function qf(f,n){return 180*f.angleWith(n)/Math.PI}class nm extends kh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,l){const d=this._vector;if(this._vector=n[0].sub(n[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:qf(this._vector,d),pinchAround:l}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const l=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const y=qf(n,d);return Math.abs(y)<l}}function zh(f){return Math.abs(f.y)>Math.abs(f.x)}class Gf extends kh{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,zh(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,l,d){const y=this._lastPoints;if(!y)return;const x=n[0].sub(y[0]),S=n[1].sub(y[1]);return this._map._cooperativeGestures&&!o.eJ()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(x,S,d.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(x.y+S.y)/2*-.5})}gestureBeginsVertically(n,l,d){if(this._valid!==void 0)return this._valid;const y=n.mag()>=2,x=l.mag()>=2;if(!y&&!x)return;if(!y||!x)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const S=n.y>0==l.y>0;return zh(n)&&zh(l)&&S}}const tg={panStep:100,bearingStep:15,pitchStep:10};class im{constructor(){const n=tg;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let l=0,d=0,y=0,x=0,S=0;switch(n.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:n.shiftKey?d=-1:(n.preventDefault(),x=-1);break;case 39:n.shiftKey?d=1:(n.preventDefault(),x=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),S=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(d=0,y=0),{cameraAnimation:A=>{const C=A.getZoom();A.easeTo({duration:300,easeId:"keyboardHandler",easing:op,zoom:l?Math.round(C)+l*(n.shiftKey?2:1):C,bearing:A.getBearing()+d*this._bearingStep,pitch:A.getPitch()+y*this._pitchStep,offset:[-x*this._panStep,-S*this._panStep],center:A.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function op(f){return f*(2-f)}const om=4.000244140625,ap=1/450;class Wl{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ap,o.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||o.eJ()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const d=o.q.now(),y=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,l!==0&&l%om==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=l,this._timeout=window.setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),n.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=n,this._delta-=l,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=De(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>om?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&z!==0&&(z=1/z);const V=l(),j=Math.pow(2,V),q=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(q*z))),this._type==="wheel"&&(this._startZoom=V,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:l(),y=this._startZoom,x=this._easing;let S,A=!1;if(this._type==="wheel"&&y&&x){const k=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),z=x(k);S=o.ai(y,d,z),k<1?this._frameId||(this._frameId=!0):A=!0}else S=d,A=!0;this._active=!0,A&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let C=S-l();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!A,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let l=o.eK;if(this._prevEase){const d=this._prevEase,y=(o.q.now()-d.start)/d.duration,x=d.easing(y+.01)-d.easing(y),S=.27/Math.sqrt(x*x+1e-4)*.01,A=Math.sqrt(.0729-S*S);l=o.eI(S,A,.25,1)}return this._prevEase={start:o.q.now(),duration:n,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Si{constructor(n,l){this._clickZoom=n,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class am{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,l){return n.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(n.shiftKey?-1:1),around:d.unproject(l)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sm{constructor(){this._tap=new Eo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,l,d){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=l[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(n,l,d))}touchmove(n,l,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const y=l[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(n,l,d)}touchend(n,l,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(n,l,d)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sp{constructor(n,l,d){this._el=n,this._mousePan=l,this._touchPan=d}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class rg{constructor(n,l,d){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=l,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Zl{constructor(n,l,d,y){this._el=n,this._touchZoom=l,this._touchRotate=d,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ro=f=>f.zoom||f.drag||f.pitch||f.rotate;class lm extends o.A{}class lp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,l){const d=o.at([],l,n);this.radius=o.ae(d[2]<0?o.eM([],d,this.constants):[d[0],d[1],0])}projectRay(n){o.eM(n,n,this.constants),o.au(n,n),o.eN(n,n,this.constants);const l=o.c1([],n,this.radius);if(l[2]>0){const d=o.c1([],[0,0,1],o.bG(l,[0,0,1])),y=o.c1([],o.au([],[l[0],l[1],0]),this.radius),x=o.d5([],l,o.c1([],o.at([],o.d5([],y,d),l),2));l[0]=x[0],l[1]=x[1]}return l}}function Ma(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Uo{constructor(n,l){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Oh(n),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new lp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),o.aV(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,x,S]of this._listeners){const A=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(x,A,S)}}destroy(){for(const[n,l,d]of this._listeners){const y=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(l,y,d)}}_addDefaultHandlers(n){const l=this._map,d=l.getCanvasContainer();this._add("mapEvent",new Qd(l,n));const y=l.boxZoom=new ep(l,n);this._add("boxZoom",y);const x=new aa,S=new am;l.doubleClickZoom=new Si(S,x),this._add("tapZoom",x),this._add("clickZoom",S);const A=new sm;this._add("tapDragZoom",A);const C=l.touchPitch=new Gf(l);this._add("touchPitch",C);const k=new Vf(n),z=new $f(n);l.dragRotate=new rg(n,k,z),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const V=new rp(n),j=new rm(l,n);l.dragPan=new sp(d,V,j),this._add("mousePan",V),this._add("touchPan",j,["touchZoom","touchRotate"]);const q=new nm,Q=new ip;l.touchZoomRotate=new Zl(d,Q,q,A),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Bc(l));const Y=l.scrollZoom=new Wl(l,this);this._add("scrollZoom",Y,["mousePan"]);const re=l.keyboard=new im;this._add("keyboard",re);for(const te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[te]&&l[te].enable(n[te])}_add(n,l,d){this._handlers.push({handlerName:n,handler:l,allowed:d}),this._handlersById[n]=l}stop(n){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ro(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,l,d){for(const y in n)if(y!==d&&(!l||l.indexOf(y)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const l=[];for(const d of n)this._el.contains(d.target)&&l.push(d);return l}handleEvent(n,l){this._updatingCamera=!0;const d=n.type==="renderFrame",y=d?void 0:n,x={needsRenderFrame:!1},S={},A={},C=n.touches?this._getMapTouches(n.touches):void 0,k=C?Xe(this._el,C):d?void 0:De(this._el,n);for(const{handlerName:j,handler:q,allowed:Q}of this._handlers){if(!q.isEnabled())continue;let Y;this._blockedByActive(A,Q,j)?q.reset():q[l||n.type]&&(Y=q[l||n.type](n,k,C),this.mergeHandlerResult(x,S,Y,j,y),Y&&Y.needsRenderFrame&&this._triggerRenderFrame()),(Y||q.isActive())&&(A[j]=q)}const z={};for(const j in this._previousActiveHandlers)A[j]||(z[j]=y);this._previousActiveHandlers=A,(Object.keys(z).length||Ma(x))&&(this._changes.push([x,S,z]),this._triggerRenderFrame()),(Object.keys(A).length||Ma(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=x;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(n,l,d,y,x){if(!d)return;o.h(n,d);const S={handlerName:y,originalEvent:d.originalEvent||x};d.zoomDelta!==void 0&&(l.zoom=S),d.panDelta!==void 0&&(l.drag=S),d.pitchDelta!==void 0&&(l.pitch=S),d.bearingDelta!==void 0&&(l.rotate=S)}_applyChanges(){const n={},l={},d={};for(const[y,x,S]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new o.P(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(n.around=y.around),y.aroundCoord!==void 0&&(n.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),o.h(l,x),o.h(d,S);this._updateMapTransform(n,l,d),this._changes=[]}_updateMapTransform(n,l,d){const y=this._map,x=y.transform,S=ce=>[ce.x,ce.y,ce.z];if((ce=>{const me=this._eventsInProgress.drag;return me&&!this._handlersById[me.handlerName].isActive()})()&&!Ma(n)){const ce=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),ce!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&y._stop(!0),!Ma(n))return void this._fireEvents(l,d,!0);let{panDelta:A,zoomDelta:C,bearingDelta:k,pitchDelta:z,around:V,aroundCoord:j,pinchAround:q}=n;x._isCameraConstrained&&(C>0&&(C=0),x._isCameraConstrained=!1),q!==void 0&&(V=q),(C||(ce=>l[ce]&&!this._eventsInProgress[ce])("drag"))&&V&&(this._dragOrigin=S(x.pointCoordinate3D(V)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",y._stop(!0),V=V||y.transform.centerPoint,k&&(x.bearing+=k),z&&(x.pitch+=z),x._updateCameraState();const Q=[0,0,0];if(A)if(x.projection.name==="mercator"){const ce=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(V).dir),me=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(V.sub(A)).dir);Q[0]=me[0]-ce[0],Q[1]=me[1]-ce[1]}else{const ce=x.pointCoordinate(V);if(x.projection.name==="globe"){A=A.rotate(-x.angle);const me=x._pixelsPerMercatorPixel/x.worldSize;Q[0]=-A.x*o.eL(o.aY(ce.y))*me,Q[1]=-A.y*o.eL(x.center.lat)*me}else{const me=x.pointCoordinate(V.sub(A));ce&&me&&(Q[0]=me.x-ce.x,Q[1]=me.y-ce.y)}}const Y=x.zoom,re=[0,0,0];if(C){const ce=S(j||x.pointCoordinate3D(V)),me={dir:o.au([],o.at([],ce,x._camera.position))};if(me.dir[2]<0){const ye=x.zoomDeltaToMovement(ce,C);o.c1(re,me.dir,ye)}}const te=o.d5(Q,Q,re);x._translateCameraConstrained(te),C&&Math.abs(x.zoom-Y)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(l,d,!0)}_fireEvents(n,l,d){const y=Ro(this._eventsInProgress),x=Ro(n),S={};for(const z in n){const{originalEvent:V}=n[z];this._eventsInProgress[z]||(S[`${z}start`]=V),this._eventsInProgress[z]=n[z]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(const z in S)this._fireEvent(z,S[z]);x&&this._fireEvent("move",x.originalEvent);for(const z in n){const{originalEvent:V}=n[z];this._fireEvent(z,V)}const A={};let C;for(const z in this._eventsInProgress){const{handlerName:V,originalEvent:j}=this._eventsInProgress[z];this._handlersById[V].isActive()||(delete this._eventsInProgress[z],C=l[V]||j,A[`${z}end`]=C)}for(const z in A)this._fireEvent(z,A[z]);const k=Ro(this._eventsInProgress);if(d&&(y||x)&&!k){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;z?(V(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:C})):(this._map.fire(new o.A("moveend",{originalEvent:C})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,l){this._map.fire(new o.A(n,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((n=>{this._frameId=void 0,this.handleEvent(new lm("renderFrame",{timeStamp:n})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const qi="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class jr extends o.E{constructor(n,l){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,o.aV(["_renderFrameCallback"],this)}getCenter(){return new o.ci(this.transform.center.lng,this.transform.center.lat)}setCenter(n,l){return this.jumpTo({center:n},l)}panBy(n,l,d){return n=o.P.convert(n).mult(-1),this.panTo(this.transform.center,o.h({offset:n},l),d)}panTo(n,l,d){return this.easeTo(o.h({center:n},l),d)}getZoom(){return this.transform.zoom}setZoom(n,l){return this.jumpTo({zoom:n},l),this}zoomTo(n,l,d){return this.easeTo(o.h({zoom:n},l),d)}zoomIn(n,l){return this.zoomTo(this.getZoom()+1,n,l),this}zoomOut(n,l){return this.zoomTo(this.getZoom()-1,n,l),this}getBearing(){return this.transform.bearing}setBearing(n,l){return this.jumpTo({bearing:n},l),this}getPadding(){return this.transform.padding}setPadding(n,l){return this.jumpTo({padding:n},l),this}rotateTo(n,l,d){return this.easeTo(o.h({bearing:n},l),d)}resetNorth(n,l){return this.rotateTo(0,o.h({duration:1e3},n),l),this}resetNorthPitch(n,l){return this.easeTo(o.h({bearing:0,pitch:0,duration:1e3},n),l),this}snapToNorth(n,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,l):this}getPitch(){return this.transform.pitch}setPitch(n,l){return this.jumpTo({pitch:n},l),this}cameraForBounds(n,l){n=o.aG.convert(n);const d=l&&l.bearing||0,y=l&&l.pitch||0,x=n.getNorthWest(),S=n.getSouthEast();return this._cameraForBounds(this.transform,x,S,d,y,l)}_extendPadding(n){const l={top:0,right:0,bottom:0,left:0};return n==null?o.h({},l,this.transform.padding):typeof n=="number"?{top:n,bottom:n,right:n,left:n}:o.h({},l,n)}_extendCameraOptions(n){return(n=o.h({offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=this._extendPadding(n.padding),n}_minimumAABBFrustumDistance(n,l){const d=l.max[0]-l.min[0],y=l.max[1]-l.min[1];return d/y>n.aspect?d/(2*Math.tan(.5*n.fovX)*n.aspect):y/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,l,d,y,x,S){const A=n.clone(),C=this._extendCameraOptions(S);A.bearing=y,A.pitch=x;const k=o.ci.convert(l),z=o.ci.convert(d),V=.5*(k.lat+z.lat),j=.5*(k.lng+z.lng),q=o.eO(V,j),Q=o.au([],q),Y=o.au([],o.bF([],Q,[0,1,0])),re=o.bF([],Y,Q),te=[Y[0],Y[1],Y[2],0,re[0],re[1],re[2],0,Q[0],Q[1],Q[2],0,0,0,0,1],ce=[q,o.eO(k.lat,k.lng),o.eO(z.lat,k.lng),o.eO(z.lat,z.lng),o.eO(k.lat,z.lng),o.eO(V,k.lng),o.eO(V,z.lng),o.eO(k.lat,j),o.eO(z.lat,j)];let me=o.d6.fromPoints(ce.map((tt=>[o.bG(Y,tt),o.bG(re,tt),o.bG(Q,tt)])));const ye=o.ad([],me.center,te);o.eP(ye)===0&&o.eQ(ye,0,0,1),o.au(ye,ye),o.c1(ye,ye,o.aB),A.center=o.eR(ye);const Ee=A.getWorldToCameraMatrix(),Ce=o.bi(new Float64Array(16),Ee);me=o.d6.applyTransform(me,o.az([],Ee,te));const Re=this._extendAABB(me,A,C,y);if(!Re)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=Re,o.ad(ye,ye,Ee);const Ae=.5*(me.max[2]-me.min[2]),Pe=this._minimumAABBFrustumDistance(A,me),Ie=o.c1([],[0,0,1],Ae),Ye=o.d5(Ie,ye,Ie),Be=Pe+(A.pitch===0?0:o.bD(ye,Ye)),dt=A.globeCenterInViewSpace,rt=o.at([],ye,[dt[0],dt[1],dt[2]]);o.au(rt,rt),o.c1(rt,rt,Be);const xt=o.d5([],ye,rt);o.ad(xt,xt,Ce);const It=o.eB/o.aB,We=o.ae(xt),ze=o.cb(Math.max(We*It-o.eB,Number.EPSILON),0),ot=Math.min(A.zoomFromMercatorZAdjusted(ze),C.maxZoom);return ot>.5*(o.cX+o.cI)?(A.setProjection({name:"mercator"}),A.zoom=ot,this._cameraForBounds(A,l,d,y,x,S)):{center:A.center,zoom:ot,bearing:y,pitch:x}}_extendAABB(n,l,d,y){const x=.5*((d.padding.left||0)+(d.padding.right||0)),S=.5*((d.padding.top||0)+(d.padding.bottom||0)),A=S,C=x,k=x,z=S,V=l.width-(C+k),j=l.height-(A+z),q=o.at([],n.max,n.min),Q=Math.min(V/q[0],j/q[1]),Y=Math.min(l.scaleZoom(l.scale*Q),d.maxZoom);if(isNaN(Y))return null;const re=l.scale/l.zoomScale(Y),te=new o.d6([n.min[0]-C*re,n.min[1]-z*re,n.min[2]],[n.max[0]+k*re,n.max[1]+A*re,n.max[2]]),ce=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new o.P(d.offset.x,d.offset.y):o.P.convert(d.offset)).rotate(-o.al(y));return te.center[0]-=ce.x*re,te.center[1]+=ce.y*re,te}queryTerrainElevation(n,l){const d=this.transform.elevation;return d?(l=o.h({},{exaggerated:!0},l),d.getAtPoint(o.ac.fromLngLat(n),null,l.exaggerated)):null}_cameraForBounds(n,l,d,y,x,S){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,l,d,y,x,S);const A=n.clone(),C=this._extendCameraOptions(S);A.bearing=y,A.pitch=x;const k=o.ci.convert(l),z=o.ci.convert(d),V=new o.ci(k.lng,z.lat),j=new o.ci(z.lng,k.lat),q=A.project(k),Q=A.project(z),Y=this.queryTerrainElevation(k),re=this.queryTerrainElevation(z),te=this.queryTerrainElevation(V),ce=this.queryTerrainElevation(j),me=[[q.x,q.y,Math.min(Y||0,re||0,te||0,ce||0)],[Q.x,Q.y,Math.max(Y||0,re||0,te||0,ce||0)]];let ye=o.d6.fromPoints(me);const Ee=A.getWorldToCameraMatrix(),Ce=o.bi(new Float64Array(16),Ee);ye=o.d6.applyTransform(ye,Ee);const Re=this._extendAABB(ye,A,C,y);if(!Re)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ye=Re;const Ae=.5*o.at([],ye.max,ye.min)[2],Pe=this._minimumAABBFrustumDistance(A,ye),Ie=[0,0,1,0];o.aA(Ie,Ie,Ee),o.eS(Ie,Ie);const Ye=o.c1([],Ie,Pe+Ae),Be=o.d5([],ye.center,Ye);o.ad(ye.center,ye.center,Ce),o.ad(Be,Be,Ce);const dt=A.unproject(new o.P(ye.center[0],ye.center[1])),rt=o.eT(A.projection,dt),xt=Math.pow(2,rt),It=Math.min(A._zoomFromMercatorZ(Be[2]*A.pixelsPerMeter*xt/A.worldSize),C.maxZoom);return A.mercatorFromTransition&&It<.5*(o.cX+o.cI)?(A.setProjection({name:"globe"}),A.zoom=It,this._cameraForBounds(A,l,d,y,x,S)):{center:dt,zoom:It,bearing:y,pitch:x}}fitBounds(n,l,d){const y=this.cameraForBounds(n,l);return this._fitInternal(y,l,d)}fitScreenCoordinates(n,l,d,y,x){const S=o.P.convert(n),A=o.P.convert(l),C=new o.P(Math.min(S.x,A.x),Math.min(S.y,A.y)),k=new o.P(Math.max(S.x,A.x),Math.max(S.y,A.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,A))return this;const z=this.transform.pointLocation3D(C),V=this.transform.pointLocation3D(k),j=this.transform.pointLocation3D(new o.P(C.x,k.y)),q=this.transform.pointLocation3D(new o.P(k.x,C.y)),Q=[Math.min(z.lng,V.lng,j.lng,q.lng),Math.min(z.lat,V.lat,j.lat,q.lat)],Y=[Math.max(z.lng,V.lng,j.lng,q.lng),Math.max(z.lat,V.lat,j.lat,q.lat)],re=y&&y.pitch?y.pitch:this.getPitch(),te=this._cameraForBounds(this.transform,Q,Y,d,re,y);return this._fitInternal(te,y,x)}_fitInternal(n,l,d){return n?(l=o.h(n,l)).linear?this.easeTo(l,d):this.flyTo(l,d):this}jumpTo(n,l){this.stop();const d=n.preloadOnly?this.transform.clone():this.transform;let y=!1,x=!1,S=!1;"zoom"in n&&d.zoom!==+n.zoom&&(y=!0,d.zoom=+n.zoom),n.center!==void 0&&(d.center=o.ci.convert(n.center)),"bearing"in n&&d.bearing!==+n.bearing&&(x=!0,d.bearing=+n.bearing),"pitch"in n&&d.pitch!==+n.pitch&&(S=!0,d.pitch=+n.pitch);const A=typeof n.padding=="number"?this._extendPadding(n.padding):n.padding;if(n.padding!=null&&!d.isPaddingEqual(A))if(n.retainPadding===!1){const C=d.clone();C.padding=A,d.setLocationAtPoint(d.center,C.centerPoint)}else d.padding=A;return n.preloadOnly?(this._preloadTiles(d),this):(this.fire(new o.A("movestart",l)).fire(new o.A("move",l)),y&&this.fire(new o.A("zoomstart",l)).fire(new o.A("zoom",l)).fire(new o.A("zoomend",l)),x&&this.fire(new o.A("rotatestart",l)).fire(new o.A("rotate",l)).fire(new o.A("rotateend",l)),S&&this.fire(new o.A("pitchstart",l)).fire(new o.A("pitch",l)).fire(new o.A("pitchend",l)),this.fire(new o.A("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(qi),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,l){const d=this.transform;if(!d.projection.supportsFreeCamera)return o.w(qi),this;this.stop();const y=d.zoom,x=d.pitch,S=d.bearing;d.setFreeCameraOptions(n);const A=y!==d.zoom,C=x!==d.pitch,k=S!==d.bearing;return this.fire(new o.A("movestart",l)).fire(new o.A("move",l)),A&&this.fire(new o.A("zoomstart",l)).fire(new o.A("zoom",l)).fire(new o.A("zoomend",l)),k&&this.fire(new o.A("rotatestart",l)).fire(new o.A("rotate",l)).fire(new o.A("rotateend",l)),C&&this.fire(new o.A("pitchstart",l)).fire(new o.A("pitch",l)).fire(new o.A("pitchend",l)),this.fire(new o.A("moveend",l)),this}easeTo(n,l){this._stop(!1,n.easeId),((n=o.h({offset:[0,0],duration:500,easing:o.eK},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const d=this.transform,y=this.getZoom(),x=this.getBearing(),S=this.getPitch(),A=this.getPadding(),C="zoom"in n?+n.zoom:y,k="bearing"in n?this._normalizeBearing(n.bearing,x):x,z="pitch"in n?+n.pitch:S,V=this._extendPadding(n.padding),j=o.P.convert(n.offset);let q,Q,Y;if(d.projection.name==="globe"){const Ie=o.ac.fromLngLat(d.center),Ye=j.rotate(-d.angle);Ie.x+=Ye.x/d.worldSize,Ie.y+=Ye.y/d.worldSize;const Be=Ie.toLngLat(),dt=o.ci.convert(n.center||Be);this._normalizeCenter(dt),q=d.centerPoint.add(Ye),Q=new o.P(Ie.x,Ie.y).mult(d.worldSize),Y=new o.P(o.aD(dt.lng),o.aH(dt.lat)).mult(d.worldSize).sub(Q)}else{q=d.centerPoint.add(j);const Ie=d.pointLocation(q),Ye=o.ci.convert(n.center||Ie);this._normalizeCenter(Ye),Q=d.project(Ie),Y=d.project(Ye).sub(Q)}const re=d.zoomScale(C-y);let te,ce;n.around&&(te=o.ci.convert(n.around),ce=d.locationPoint(te));const me=this._zooming||C!==y,ye=this._rotating||x!==k,Ee=this._pitching||z!==S,Ce=!d.isPaddingEqual(V),Re=n.retainPadding===!1?d.clone():d,Ae=Ie=>Ye=>{if(me&&(Ie.zoom=o.ai(y,C,Ye)),ye&&(Ie.bearing=o.ai(x,k,Ye)),Ee&&(Ie.pitch=o.ai(S,z,Ye)),Ce&&(Re.interpolatePadding(A,V,Ye),q=Re.centerPoint.add(j)),te)Ie.setLocationAtPoint(te,ce);else{const Be=Ie.zoomScale(Ie.zoom-y),dt=C>y?Math.min(2,re):Math.max(.5,re),rt=Math.pow(dt,1-Ye),xt=Ie.unproject(Q.add(Y.mult(Ye*rt)).mult(Be));Ie.setLocationAtPoint(Ie.renderWorldCopies?xt.wrap():xt,q)}return n.preloadOnly||this._fireMoveEvents(l),Ie};if(n.preloadOnly){const Ie=this._emulate(Ae,n.duration,d);return this._preloadTiles(Ie),this}const Pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=me,this._rotating=ye,this._pitching=Ee,this._padding=Ce,this._easeId=n.easeId,this._prepareEase(l,n.noMoveStart,Pe),this._ease(Ae(d),(Ie=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(l,Ie)}),n),this}_prepareEase(n,l,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||d.moving||this.fire(new o.A("movestart",n)),this._zooming&&!d.zooming&&this.fire(new o.A("zoomstart",n)),this._rotating&&!d.rotating&&this.fire(new o.A("rotatestart",n)),this._pitching&&!d.pitching&&this.fire(new o.A("pitchstart",n))}_fireMoveEvents(n){this.fire(new o.A("move",n)),this._zooming&&this.fire(new o.A("zoom",n)),this._rotating&&this.fire(new o.A("rotate",n)),this._pitching&&this.fire(new o.A("pitch",n))}_afterEase(n,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,y=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new o.A("zoomend",n)),y&&this.fire(new o.A("rotateend",n)),x&&this.fire(new o.A("pitchend",n)),this.fire(new o.A("moveend",n))}flyTo(n,l){if(this._prefersReducedMotion(n)){const tt=o.aF(n,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(tt,l)}this.stop(),n=o.h({offset:[0,0],speed:1.2,curve:1.42,easing:o.eK},n);const d=this.transform,y=this.getZoom(),x=this.getBearing(),S=this.getPitch(),A=this.getPadding(),C="zoom"in n?o.ay(+n.zoom,d.minZoom,d.maxZoom):y,k="bearing"in n?this._normalizeBearing(n.bearing,x):x,z="pitch"in n?+n.pitch:S,V=this._extendPadding(n.padding),j=d.zoomScale(C-y),q=o.P.convert(n.offset);let Q=d.centerPoint.add(q);const Y=d.pointLocation(Q),re=o.ci.convert(n.center||Y);this._normalizeCenter(re);const te=d.project(Y),ce=d.project(re).sub(te);let me=n.curve;const ye=Math.max(d.width,d.height),Ee=ye/j,Ce=ce.mag();if("minZoom"in n){const tt=o.ay(Math.min(n.minZoom,y,C),d.minZoom,d.maxZoom),At=ye/d.zoomScale(tt-y);me=Math.sqrt(At/Ce*2)}const Re=me*me;function Ae(tt){const At=(Ee*Ee-ye*ye+(tt?-1:1)*Re*Re*Ce*Ce)/(2*(tt?Ee:ye)*Re*Ce);return Math.log(Math.sqrt(At*At+1)-At)}function Pe(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function Ie(tt){return(Math.exp(tt)+Math.exp(-tt))/2}const Ye=Ae(0);let Be=function(tt){return Ie(Ye)/Ie(Ye+me*tt)},dt=function(tt){return ye*((Ie(Ye)*(Pe(At=Ye+me*tt)/Ie(At))-Pe(Ye))/Re)/Ce;var At},rt=(Ae(1)-Ye)/me;if(Math.abs(Ce)<1e-6||!isFinite(rt)){if(Math.abs(ye-Ee)<1e-6)return this.easeTo(n,l);const tt=Ee<ye?-1:1;rt=Math.abs(Math.log(Ee/ye))/me,dt=function(){return 0},Be=function(At){return Math.exp(tt*me*At)}}n.duration="duration"in n?+n.duration:1e3*rt/("screenSpeed"in n?+n.screenSpeed/me:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const xt=x!==k,It=z!==S,We=!d.isPaddingEqual(V),ze=n.retainPadding===!1?d.clone():d,ot=tt=>At=>{const Pt=At*rt,Dt=1/Be(Pt);tt.zoom=At===1?C:y+tt.scaleZoom(Dt),xt&&(tt.bearing=o.ai(x,k,At)),It&&(tt.pitch=o.ai(S,z,At)),We&&(ze.interpolatePadding(A,V,At),Q=ze.centerPoint.add(q));const Bt=At===1?re:tt.unproject(te.add(ce.mult(dt(Pt))).mult(Dt));return tt.setLocationAtPoint(tt.renderWorldCopies?Bt.wrap():Bt,Q),tt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(l),tt};if(n.preloadOnly){const tt=this._emulate(ot,n.duration,d);return this._preloadTiles(tt),this}return this._zooming=!0,this._rotating=xt,this._pitching=It,this._padding=We,this._prepareEase(l,!1),this._ease(ot(d),(()=>this._afterEase(l)),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(n){}_cancelRenderFrame(n){}_stop(n,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,l)}if(!n){const d=this.handlers;d&&d.stop(!1)}return this}_ease(n,l,d){d.animate===!1||d.duration===0?(n(1),l()):(this._easeStart=o.q.now(),this._easeOptions=d,this._onEaseFrame=n,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,l){n=o.bQ(n,-180,180);const d=Math.abs(n-l);return Math.abs(n-360-l)<d&&(n-=360),Math.abs(n+360-l)<d&&(n+=360),n}_normalizeCenter(n){const l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;const d=n.lng-l.center.lng;n.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,l,d){const y=Math.ceil(15*l/1e3),x=[],S=n(d.clone());for(let A=0;A<=y;A++){const C=S(A/y);x.push(C.clone())}return x}_preloadTiles(n,l){}}class Gs{constructor(n={}){this.options=n,o.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const l=this.options&&this.options.compact,d=n._getUIString("AttributionControl.ToggleAttribution");this._map=n,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=H("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const y=H("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",d),this._innerContainer=H("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(n){const d=l.reduce(((y,x,S)=>(x.value&&(y+=`${x.key}=${x.value}${S<l.length-1?"&":""}`),y)),"?");n.href=`${o.e.FEEDBACK_URL}/${d}#${Wa(this._map,!0)}`,n.rel="noopener nofollow"}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const l=this._map.style._mergedSourceCaches;for(const y in l){const x=l[y];if(x.used){const S=x.getSource();S.attribution&&n.indexOf(S.attribution)<0&&n.push(S.attribution)}}n.sort(((y,x)=>y.length-x.length)),n=n.filter(((y,x)=>{for(let S=x+1;S<n.length;S++)if(n[S].indexOf(y)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const d=n.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,n.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Fu{constructor(){o.aV(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=H("div","mapboxgl-ctrl");const l=H("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const l in n){const d=n[l].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class cp{constructor(){o.aV(["_onIndoorUpdate"],this)}onAdd(n){return this._map=n,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",(l=>this._onIndoorUpdate({selectedFloorId:l.selectedFloorId,floors:l.floors}))),this._container}_createButton(n,l){const d=H("button",n,this._container);return d.type="button",d.addEventListener("click",l),d}_setButtonTitle(n,l){this._map&&(n.setAttribute("aria-label",l),n.innerHTML=`<strong>${l}</strong>`,n.firstElementChild&&n.firstElementChild.setAttribute("title",l))}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(n){if(!n||!n.floors)return void(this._container.style.display="none");const l=this._model;this._model=n,this._container.style.display="inline-block";const d=n.floors.sort(((y,x)=>y.levelOrder-x.levelOrder));l?(Array.from(this._container.children).forEach((y=>y.remove())),this.addCurrentFloors(d)):this.addCurrentFloors(d)}addCurrentFloors(n){for(const l of n){const d=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(l.id),Array.from(this._container.children).forEach((y=>{y.classList.remove("mapboxgl-ctrl-level-button-selected")})),d.classList.add("mapboxgl-ctrl-level-button-selected")}));this._setButtonTitle(d,l.shortName),this._model&&l.id===this._model.selectedFloorId&&(this._map._selectIndoorFloor(l.id),d.classList.add("mapboxgl-ctrl-level-button-selected")),this._container.append(d)}}}class ng{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const l=++this._id;return this._queue.push({callback:n,id:l,cancelled:!1}),l}remove(n){const l=this._currentlyRunning,d=l?this._queue.concat(l):this._queue;for(const y of d)if(y.id===n)return void(y.cancelled=!0)}run(n=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const d of l)if(!d.cancelled&&(d.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Xl{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const l=o.dx((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,l,d){this._start=this.getValue(l),this._end=n,this._startTime=l,this._endTime=l+d}}const up={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class hp extends o.A{constructor(n,l,d,y){const{point:x,lngLat:S,originalEvent:A,target:C}=n;super(n.type,{point:x,lngLat:S,originalEvent:A,target:C}),this.preventDefault=()=>{n.preventDefault()},this.id=l,this.interaction=d,this.feature=y}}class fp{constructor(n){this.map=n,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(n,l){if(this.typeById.has(n))throw new Error(`Interaction id "${n}" already exists.`);const d=l.filter;let y=l.type;d&&this.filters.set(n,o.b3(d)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const x=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(n,l)):x.size===0&&this.map.on(y,this.handleType),x.size===0&&this.interactionsByType.set(y,x),x.set(n,l),this.typeById.set(n,y)}get(n){const l=this.typeById.get(n);if(!l)return;const d=this.interactionsByType.get(l);return d?d.get(n):void 0}remove(n){const l=this.typeById.get(n);if(!l)return;this.typeById.delete(n),this.filters.delete(n);const d=this.interactionsByType.get(l);d&&(d.delete(n),l==="mouseenter"||l==="mouseleave"?(this.delegatedInteractions.delete(n),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(l,this.handleType))}queryTargets(n,l){const d=[];for(const[y,x]of l)x.target&&d.push({targetId:y,target:x.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(n,d,this.map.transform)}handleMove(n){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const l=this.queryTargets(n.point,Array.from(this.delegatedInteractions).reverse());l.length&&(n.type="mouseenter",this.handleType(n,l));const d=new Map;for(const[y,{feature:x}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||d.set(x.id,x);d.size&&(n.type="mouseleave",this.handleType(n,Array.from(d.values())))}handleOut(n){const l=Array.from(this.hoveredFeatures.values()).map((({feature:d})=>d));l.length&&(n.type="mouseleave",this.handleType(n,l)),this.hoveredFeatures.clear()}handleType(n,l){const d=n.type==="mouseenter";if(d&&!this.interactionsByType.has(n.type))return void o.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(n.type)).reverse(),x=!!l;l=l||this.queryTargets(n.point,y);let S=!1;const A=new Set;for(const C of l){for(const[k,z]of y){if(!z.target)continue;const V=C.variants?C.variants[k]:null;if(V){for(const j of V){if(uc(j,C,A,k))continue;const q=new o.dr(C,j),Q=cc(j,C,k);x&&(q.state=this.map.getFeatureState(q));const Y=d?this.prevHoveredFeatures.get(Q):null,re=new hp(n,k,z,q),te=Y?Y.stop:z.handler(re);if(d&&this.hoveredFeatures.set(Q,{feature:C,stop:te}),te!==!1){S=!0;break}}if(S)break}}if(S)break}if(!S)for(const[C,k]of y){const{handler:z,target:V}=k;if(!V&&z(new hp(n,C,k,null))!==!1)break}}}function dp(f,n){if(Array.isArray(f)&&Array.isArray(n)){const l=new Set(f),d=new Set(n);return l.size===d.size&&f.every((y=>d.has(y)))}return o.bv(f,n)}const Fh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Nc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Hs{constructor(n,l,d=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Vf({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,d&&(this.mousePitch=new $f({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),o.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(n,l){this.mouseRotate.mousedown(n,l),this.mousePitch&&this.mousePitch.mousedown(n,l),_e()}move(n,l){const d=this.map,y=this.mouseRotate.mousemoveWindow(n,l),x=y&&y.bearingDelta;if(x&&d.setBearing(d.getBearing()+x),this.mousePitch){const S=this.mousePitch.mousemoveWindow(n,l),A=S&&S.pitchDelta;A&&d.setPitch(d.getPitch()+A)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){le(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(o.h({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),De(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,De(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Xe(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Xe(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Ni(f,n,l){if(f=new o.ci(f.lng,f.lat),n){const d=new o.ci(f.lng-360,f.lat),y=new o.ci(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-l.center.lng)/360),S=l.locationPoint3D(f).distSqr(n),A=n.x<0||n.y<0||n.x>l.width||n.y>l.height;l.locationPoint3D(d).distSqr(n)<S&&(A||Math.abs(d.lng-l.center.lng)<x)?f=d:l.locationPoint3D(y).distSqr(n)<S&&(A||Math.abs(y.lng-l.center.lng)<x)&&(f=y)}for(;Math.abs(f.lng-l.center.lng)>180;){const d=l.locationPoint3D(f);if(d.x>=0&&d.y>=0&&d.x<=l.width&&d.y<=l.height)break;f.lng>l.center.lng?f.lng-=360:f.lng+=360}return f}const lo={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},co={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Za extends o.E{constructor(n,l){super(),(n instanceof HTMLElement||l)&&(n=o.h({element:n},l)),o.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:d="center",color:y="#3FB1CE",scale:x=1,draggable:S=!1,clickTolerance:A=0,rotation:C=co.rotation,rotationAlignment:k=co.rotationAlignment,pitchAlignment:z=co.pitchAlignment,occludedOpacity:V=co.occludedOpacity,altitude:j=co.altitude}=n||{};this._anchor=d,this._color=y,this._scale=x,this._draggable=S,this._clickTolerance=A,this._rotation=C,this._rotationAlignment=k,this._pitchAlignment=z,this._occludedOpacity=V,this._altitude=j,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),n&&n.element?(this._element=n.element,this._offset=o.P.convert(n&&n.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(n&&n.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(Y=>{Y.preventDefault()})),this._element.addEventListener("mousedown",(Y=>{Y.preventDefault()}));const q=this._element.classList;for(const Y in lo)q.remove(`mapboxgl-marker-anchor-${Y}`);q.add(`mapboxgl-marker-anchor-${this._anchor}`);const Q=n&&n.className?n.className.trim().split(/\s+/):[];q.add(...Q),this._popup=null}_createDefaultMarker(){const n=H("div"),l=Z("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},n);if(this._altitude===0){const d=Z("radialGradient",{id:"shadowGradient"},Z("defs",{},l));Z("stop",{offset:"10%","stop-opacity":.4},d),Z("stop",{offset:"100%","stop-opacity":.05},d),Z("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},l)}return Z("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},l),Z("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},l),Z("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},l),n}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=o.ci.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(n){return n===this._altitude||(this._defaultMarker&&(this._altitude===0&&n!==0||this._altitude!==0&&n===0)&&(this._element=this._createDefaultMarker()),this._altitude=n||co.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,n._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const l=n.code,d=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(n){const l=n.originalEvent.target,d=this._element;this._popup&&(l===d||d.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,l=this._pos;if(!n||!l)return!1;const d=n.unproject(l,this._altitude),y=n.getFreeCameraOptions();if(!y.position)return!1;const x=y.position.toLngLat();return x.distanceTo(d)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const l=this._pos;if(!l||l.x<0||l.x>n.transform.width||l.y<0||l.y>n.transform.height)return void this._clearFadeTimer();const d=n.unproject(l,this._altitude);let y;n._showingGlobe()&&o.eW(n.transform,this._lngLat)?y=0:(y=1-n._queryFogOpacity(d),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${lo[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const n=this._pos,l=this._map,d=this.getPitchAlignment();if(!l||!n||d!=="map")return"";if(!l._showingGlobe()){const C=l.getPitch();return C?`rotateX(${C}deg)`:""}const y=o.cU(o.eX(l.transform,this._lngLat)),x=n.sub(o.eY(l.transform)),S=Math.abs(x.x)+Math.abs(x.y);if(S===0)return"";const A=y/S;return`rotateX(${-x.y*A}deg) rotateY(${x.x*A}deg)`}_calculateZTransform(){const n=this._pos,l=this._map;if(!l||!n)return"";let d=0;const y=this.getRotationAlignment();if(y==="map")if(l._showingGlobe()){const x=l.project(new o.ci(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),S=l.project(new o.ci(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(x);d=o.cU(Math.atan2(S.y,S.x))-90}else d=-l.getBearing();else if(y==="horizon"){const x=o.af(4,6,l.getZoom()),S=o.eY(l.transform);S.y+=x*l.transform.height;const A=n.sub(S),C=o.cU(Math.atan2(A.y,A.x));d=(C>90?C-270:C+90)*(1-x)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Ni(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat,this._altitude),n===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),l._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(n){return this._offset=o.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){const l=this._map;if(!l)return;const d=this._pointerdownPos,y=this._positionDelta;if(d&&y){if(!this._isDragging){const x=this._clickTolerance||l._clickTolerance;if(n.point.dist(d)<x)return;this._isDragging=!0}this._pos=n.point.sub(y),this._lngLat=l.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.A("dragstart"))),this.fire(new o.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.A("dragend")),this._state="inactive"}_addDragHandler(n){const l=this._map,d=this._pos;l&&d&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(d),this._pointerdownPos=n.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const l=this._map;return l&&(n?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||co.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||co.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||co.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||co.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ig={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Ws={maxWidth:100,unit:"metric"},og={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},bl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},ag=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Xo(f=new o.P(0,0),n="bottom"){if(typeof f=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(n){case"top":return new o.P(0,f);case"top-left":return new o.P(l,l);case"top-right":return new o.P(-l,l);case"bottom":return new o.P(0,-f);case"bottom-left":return new o.P(l,-l);case"bottom-right":return new o.P(-l,-l);case"left":return new o.P(f,0);case"right":return new o.P(-f,0)}return new o.P(0,0)}return f instanceof o.P||Array.isArray(f)?o.P.convert(f):o.P.convert(f[n]||[0,0])}return{version:M,supported:ee.supported,setRTLTextPlugin:o.f0,getRTLTextPluginStatus:o.e$,Map:class extends jr{constructor(f){B.mark(R.create);const n=f;if((f=o.h({},Fh,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&o.eU(window)&&(f.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Sd(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new ng,this._domRenderTaskQueue=new ng,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.a$(),this._locale=o.h({},up,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Xl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new bt(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const l=document.getElementById(f.container);if(!l)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=l}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,o.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Qm),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Uo(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||o.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this.indoor=new O_(this),f.hash&&(this._hash=new Xd(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const l=f.bounds;l&&(this.resize(),this.fitBounds(l,o.h({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Gs({customAttribution:f.customAttribution})),this._logoControl=new Fu,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(l=>{this._update(l.dataType==="style"),this.fire(new o.A(`${l.dataType}data`,l))})),this.on("dataloading",(l=>{this.fire(new o.A(`${l.dataType}dataloading`,l))})),this._interactions=new fp(this)}_getMapId(){return this._mapId}addControl(f,n){if(n===void 0&&(n=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new o.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=f.onAdd(this);this._controls.push(f);const d=this._controlPositions[n];return n.indexOf("bottom")!==-1?d.insertBefore(l,d.firstChild):d.appendChild(l),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new o.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(f);return n>-1&&this._controls.splice(n,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new o.A("movestart",f)).fire(new o.A("move",f)),this.fire(new o.A("resize",f)),n&&this.fire(new o.A("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(o.aG.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((n=>n.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map((n=>n==="auto"?navigator.language:n)):f}setLanguage(f){const n=this._parseLanguage(f);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,n=f.projection.name;let l;n==="globe"&&f.zoom>=o.cI?(f.setMercatorFromTransition(),l=!0):n==="mercator"&&f.zoom<o.cI&&(f.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,n){return this._updateProjection(f||n||{name:"mercator"})}_updateProjection(f){let n;return n=f.name==="globe"&&this.transform.zoom>=o.cI?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,n){return this.transform.locationPoint3D(o.ci.convert(f),n)}unproject(f,n){return this.transform.pointLocation3D(o.P.convert(f),n)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,n,l){const d=y=>{let x=[];if(Array.isArray(n)){const S=n.filter((A=>this.getLayer(A)));x=S.length?this.queryRenderedFeatures(y,{layers:S}):[]}else x=this.queryRenderedFeatures(y,{target:n});return x};if(f==="mouseenter"||f==="mouseover"){let y=!1;return{listener:l,targets:n,delegates:{mousemove:S=>{const A=d(S.point);A.length?y||(y=!0,l.call(this,new ai(f,this,S.originalEvent,{features:A}))):y=!1},mouseout:()=>{y=!1}}}}if(f==="mouseleave"||f==="mouseout"){let y=!1;return{listener:l,targets:n,delegates:{mousemove:A=>{d(A.point).length?y=!0:y&&(y=!1,l.call(this,new ai(f,this,A.originalEvent)))},mouseout:A=>{y&&(y=!1,l.call(this,new ai(f,this,A.originalEvent)))}}}}{const y=x=>{const S=d(x.point);S.length&&(x.features=S,l.call(this,x),delete x.features)};return{listener:l,targets:n,delegates:{[f]:y}}}}on(f,n,l){if(typeof n=="function"||l===void 0)return super.on(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const d=this._createDelegatedListener(f,n,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(d);for(const y in d.delegates)this.on(y,d.delegates[y]);return this}once(f,n,l){if(typeof n=="function"||l===void 0)return super.once(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const d=this._createDelegatedListener(f,n,l);for(const y in d.delegates)this.once(y,d.delegates[y]);return this}off(f,n,l){if(typeof n=="function"||l===void 0)return super.off(f,n);if(typeof n=="string"&&(n=[n]),!this._areTargetsValid(n))return this;const d=this._delegatedListeners?this._delegatedListeners[f]:void 0;return d&&(y=>{for(let x=0;x<y.length;x++){const S=y[x];if(S.listener===l&&dp(S.targets,n)){for(const A in S.delegates)this.off(A,S.delegates[A]);return y.splice(x,1),this}}})(d),this}queryRenderedFeatures(f,n){if(!this.style)return[];if(f===void 0||f instanceof o.P||Array.isArray(f)||n!==void 0||(n=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!n){const x=this.style.queryRenderedFeatures(f,void 0,this.transform),S=this.style.queryRenderedFeatureset(f,void 0,this.transform);return x.concat(S)}let l=!0;if(n.target&&(l=this._isTargetValid(n.target),l&&!n.layers))return this.style.queryRenderedFeatureset(f,n,this.transform);let d=!0;if(n.layers&&Array.isArray(n.layers)){for(const x of n.layers)if(!this._isValidId(x)){d=!1;break}if(d&&!n.target)return this.style.queryRenderedFeatures(f,n,this.transform)}let y=[];return d&&(y=y.concat(this.style.queryRenderedFeatures(f,n,this.transform))),l&&(y=y.concat(this.style.queryRenderedFeatureset(f,n,this.transform))),y}querySourceFeatures(f,n){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,n)}isPointOnSurface(f){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&o.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(f))}addInteraction(f,n){return this._interactions.add(f,n),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,n){return n=o.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n),this.style&&f&&n.diff!==!1&&n.localFontFamily===this._localFontFamily&&n.localIdeographFontFamily===this._localIdeographFontFamily&&!n.config?(this.style._diffStyle(f,((l,d)=>{if(l){const y=typeof l=="string"?l:l instanceof Error?l.message:l.error;o.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(f,n)}else d&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(f,n))}_getUIString(f){const n=this._locale[f];if(n==null)throw new Error(`Missing UI string '${f}'`);return n}_updateStyle(f,n){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const l=o.h({},n);n&&n.config&&(l.initialConfig=n.config,delete l.config),this.style=new na(this,l).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new na(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new o.z(new Error("IDs can't be empty."))),!1):!o.dk(f)||(this.fire(new o.z(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const n of f)if(!this._isValidId(n))return!1;return!0}return this._isTargetValid(f)}addSource(f,n){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,n),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,n,l){this._lazyInitEmptyStyle(),this.style.addSourceType(f,n,l)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,n,{pixelRatio:l=1,sdf:d=!1,stretchX:y,stretchY:x,content:S}={}){this._lazyInitEmptyStyle();const A=o.I.from(f);if(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){const{width:C,height:k,data:z}=o.q.getImageData(n);this.style.addImage(A,{data:new o.r({width:C,height:k},z),pixelRatio:l,stretchX:y,stretchY:x,content:S,sdf:d,version:0,usvg:!1})}else if(n.width===void 0||n.height===void 0)this.fire(new o.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:k}=n,z=n;this.style.addImage(A,{data:new o.r({width:C,height:k},new Uint8Array(z.data)),pixelRatio:l,stretchX:y,stretchY:x,content:S,sdf:d,usvg:!1,version:0,userImage:z}),z.onAdd&&z.onAdd(this,f)}}updateImage(f,n){this._lazyInitEmptyStyle();const l=o.I.from(f),d=this.style.getImage(l);if(!d)return void this.fire(new o.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?o.q.getImageData(n):n,{width:x,height:S,data:A}=y;if(x===void 0||S===void 0)return void this.fire(new o.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==(d.usvg?d.icon.usvg_tree.width:d.data.width)||S!==(d.usvg?d.icon.usvg_tree.height:d.data.height))return void this.fire(new o.z(new Error(`The width and height of the updated image (${x}, ${S})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const C=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);let k=!1;d.usvg?(d.data=new o.r({width:x,height:S},new Uint8Array(A)),d.usvg=!1,d.icon=void 0,k=!0):d.data.replace(A,C),this.style.updateImage(l,d,k)}hasImage(f){return f?!!this.style&&!!this.style.getImage(o.I.from(f)):(this.fire(new o.z(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(o.I.from(f))}loadImage(f,n){o.o(this._requestManager.transformRequest(f,o.R.Image),((l,d)=>{n(l,d instanceof HTMLImageElement?o.q.getImageData(d):d)}))}listImages(){return this.style.listImages().map((f=>f.name))}addModel(f,n){this._lazyInitEmptyStyle(),this.style.addModel(f,n)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new o.z(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,n){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,n),this._update(!0)):this}getSlot(f){const n=this.getLayer(f);return n&&n.slot||null}setSlot(f,n){return this.style.setSlot(f,n),this.style.mergeLayers(),this._update(!0)}addImport(f,n){return this.style.addImport(f,n).catch((l=>this.fire(new o.z(new Error("Failed to add import",l))))),this}updateImport(f,n){return typeof n!="string"&&n.id!==f?(this.removeImport(f),this.addImport(n)):(this.style.updateImport(f,n),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,n){return this.style.moveImport(f,n),this._update(!0)}moveLayer(f,n){return this._isValidId(f)?(this.style.moveLayer(f,n),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const n=this.style.getOwnLayer(f);return n?n.type==="custom"?n.implementation:n.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,n,l){return this._isValidId(f)?(this.style.setLayerZoomRange(f,n,l),this._update(!0)):this}setFilter(f,n,l={}){return this._isValidId(f)?(this.style.setFilter(f,n,l),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,n,l,d={}){return this._isValidId(f)?(this.style.setPaintProperty(f,n,l,d),this._update(!0)):this}getPaintProperty(f,n){return this._isValidId(f)?this.style.getPaintProperty(f,n):null}setLayoutProperty(f,n,l,d={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,n,l,d),this._update(!0)):this}getLayoutProperty(f,n){return this._isValidId(f)?this.style.getLayoutProperty(f,n):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,n){return this.style.setSchema(f,n),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,n){return this.style.setConfig(f,n),this._update(!0)}getConfigProperty(f,n){return this.style.getConfigProperty(f,n)}setConfigProperty(f,n,l){return this.style.setConfigProperty(f,n,l),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const n=f[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,n){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,n),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.ci.convert(f),this.transform):0}setFeatureState(f,n){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,n),this._update())}removeFeatureState(f,n){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,n),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.indoor.selectFloor(f)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new cp),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let l,d,y,x=this._container;for(;x&&(!d||!y);){const S=window.getComputedStyle(x).transform;S&&S!=="none"&&(l=S.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(d=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(y=l[3])),x=x.parentElement}this._containerWidth=d?Math.abs(f/d):f,this._containerHeight=y?Math.abs(n/y):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=H("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=H("div","mapboxgl-canvas-container",f);this._canvas=H("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=H("div","mapboxgl-control-container",f),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((y=>{d[y]=H("div",`mapboxgl-ctrl-${y}`,l)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,n){const l=o.q.devicePixelRatio||1;this._canvas.width=l*Math.ceil(f),this._canvas.height=l*Math.ceil(n),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${n}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const n=this._markers.indexOf(f);n!==-1&&this._markers.splice(n,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const n=this._popups.indexOf(f);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const f=o.h({},ee.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",f);n?(sr(n,!0),this.painter=new Lc(n,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),o.l.testSupport(n)):this.fire(new o.z(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.A("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.A("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let n;this.fire(new o.A("renderstart")),++this._frameId;const l=this.painter.context.extTimerQuery,d=o.q.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=y.createQuery(),y.beginQuery(l.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,z=this.transform.pitch,V=o.q.now(),j=new o.aa(k,{now:V,fadeDuration:x,pitch:z,transition:this.style.transition,worldview:this._worldview});this.style.update(j)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(d),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(d);const A=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),A&&(this._placementDirty=A.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,B.mark(R.load),this.fire(new o.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const k=o.q.now()-d;y.endQuery(l.TIME_ELAPSED_EXT),setTimeout((()=>{const z=y.getQueryParameter(n,y.QUERY_RESULT)/1e6;y.deleteQuery(n),this.fire(new o.A("gpu-timing-frame",{cpuTime:k,gpuTime:z}))}),50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout((()=>{const z=this.painter.queryGpuTimers(k);this.fire(new o.A("gpu-timing-layer",{layerTimes:z}))}),50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const z=this.painter.queryGpuTimeDeferredRender(k);this.fire(new o.A("gpu-timing-deferred-render",{gpuTime:z}))}),50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(C||this._repaint)this.triggerRepaint();else{const k=this.idle();if(k&&(S=this._updateAverageElevation(d,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new o.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new o.A("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,B.mark(R.fullLoad),this._performanceMetricsCollection&&Br(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const n of this._markers)f&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!f||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(f,n=!1){const l=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(n||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const y=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=f;const S=Math.abs(y-x);if(S>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(x),l(x);this._averageElevation.easeTo(x,f,300)}else if(S>1e-4)return this._averageElevation.jumpTo(x),l(x)}return!!this._averageElevation.isEasing(f)&&l(this._averageElevation.getValue(f))}_authenticate(){Ar(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(f=>{if(f&&(f.message===ft||f.status===401)){const n=this.painter.context.gl;sr(n,!1),this._logoControl instanceof Fu&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),Mr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&Tr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const l=this.painter.context.gl,d=l.createFramebuffer();function y(x){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,x,0);const S=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,S),S}return l.bindFramebuffer(l.FRAMEBUFFER,d),this._canvasPixelComparison(y(f),n.canvasCopies.map(y),n.timeStamps)}_canvasPixelComparison(f,n,l){let d=l[1]-l[0];const y=f.length/4;for(let x=0;x<n.length;x++){const S=n[x];let A=0;for(let C=0;C<S.length;C+=4)S[C]===f[C]&&S[C+1]===f[C+1]&&S[C+2]===f[C+2]&&S[C+3]===f[C+3]&&(A+=1);d+=(l[x+2]-l[x+1])*(1-A/y)}return d}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),un.delete(this.painter.context.gl),or.remove(),ar.remove(),this._removed=!0,this.fire(new o.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=o.q.frame((n=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(n)})))}_preloadTiles(f){const n=this.style?this.style.getSourceCaches():[];return o.bt(n,((l,d)=>l._preloadTiles(f,d)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,n){o.eV(f,n)}get version(){return M}},NavigationControl:class{constructor(f={}){this.options=o.h({},Nc,f),this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this.options.showZoom&&(o.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(n=>{this._map&&this._map.zoomIn({},{originalEvent:n})})),H("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(n=>{this._map&&this._map.zoomOut({},{originalEvent:n})})),H("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(n=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:n}):l.resetNorth({},{originalEvent:n}))})),this._compassIcon=H("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const n=f.getZoom(),l=n===f.getMaxZoom(),d=n===f.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=n)}))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Hs(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,n){const l=H("button",f,this._container);return l.type="button",l.addEventListener("click",n),l}_setButtonTitle(f,n){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${n}`);f.setAttribute("aria-label",l),f.firstElementChild&&f.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends o.E{constructor(f={}){super();const n=navigator.geolocation;this.options=o.h({geolocation:n},ig,f),o.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Mh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const n=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,f(l)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((l=>n(l.state!=="denied"))).catch((()=>n())):n()}_isOutOfMapMaxBounds(f){const n=this._map.getMaxBounds(),l=f.coords;return!!n&&(l.longitude<n.getWest()||l.longitude>n.getEast()||l.latitude<n.getSouth()||l.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new o.A("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("geolocate",f)),this._finish()}}_updateCamera(f){const n=new o.ci(f.coords.longitude,f.coords.latitude),l=f.coords.accuracy,d=this._map.getBearing(),y=o.h({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(l),y,{geolocateSource:!0})}_updateMarker(f){if(f){const n=new o.ci(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,n=o.cb(1,f._center.lat)*f.worldSize,l=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(n=>n.preventDefault())),this._geolocateButton=H("button","mapboxgl-ctrl-geolocate",this._container),H("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H("div","mapboxgl-user-location"),this._dotElement.appendChild(H("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(H("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Za({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=H("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Za({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.A("trackuserlocationend")))}))}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((n=>{n==="granted"&&f()})).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Gs,ScaleControl:class{constructor(f={}){this.options=o.h({},Ws,f),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),o.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,n=this._map,l=n._containerHeight/2,d=n._containerWidth/2-f/2,y=n.unproject([d,l]),x=n.unproject([d+f,l]),S=y.distanceTo(x);if(this.options.unit==="imperial"){const A=3.2808*S;A>5280?this._setScale(f,A/5280,"mile"):this._setScale(f,A,"foot")}else this.options.unit==="nautical"?this._setScale(f,S/1852,"nautical-mile"):S>=1e3?this._setScale(f,S/1e3,"kilometer"):this._setScale(f,S,"meter")}_setScale(f,n,l){this._map._requestDomTask((()=>{const d=(function(x){const S=Math.pow(10,`${Math.floor(x)}`.length-1);let A=x/S;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:(function(C){const k=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*k)/k})(A),S*A})(n),y=d/n;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(d):`${d}&nbsp;${og[l]}`,this._container.style.width=f*y+"px"}))}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:o.w("Full screen control 'container' must be a DOM element.")),o.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=H("button","mapboxgl-ctrl-fullscreen",this._controlContainer);H("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:cp,Popup:class extends o.E{constructor(f){super(),this.options=o.h(Object.create(bl),f),this._altitude=this.options.altitude,o.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new o.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new o.A("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=o.ci.convert(f),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const n=document.createDocumentFragment(),l=document.createElement("body");let d;for(l.innerHTML=f;d=l.firstChild,d;)n.appendChild(d);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=H("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(f),this.options.closeButton){const l=this._closeButton=H("button","mapboxgl-popup-close-button",n);l.type="button",l.setAttribute("aria-label","Close popup"),l.innerHTML='<span aria-hidden="true">&#215;</span>',l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let n;return this._classList.delete(f)?n=!1:(this._classList.add(f),n=!0),this._updateClassList(),n}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const n=this._map,l=this._container,d=this._pos;if(!n||!l||!d)return"bottom";const y=l.offsetWidth,x=l.offsetHeight,S=d.x<y/2,A=d.x>n.transform.width-y/2;if(d.y+f<x)return S?"top-left":A?"top-right":"top";if(d.y>n.transform.height-x){if(S)return"bottom-left";if(A)return"bottom-right"}return S?"left":A?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),f.className=n.join(" ")}_update(f){const n=this._map,l=this._content;if(!n||!this._lngLat&&!this._trackPointer||!l)return;let d=this._container;if(d||(d=this._container=H("div","mapboxgl-popup",n.getContainer()),this._tip=H("div","mapboxgl-popup-tip",d),d.appendChild(l)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ni(this._lngLat,this._pos,n.transform)),!this._trackPointer||f){const y=this._pos=this._trackPointer&&f instanceof o.P?f:n.project(this._lngLat,this._altitude),x=Xo(this.options.offset),S=this._anchor=this._getAnchor(x.y),A=Xo(this.options.offset,S),C=y.add(A).round();n._requestDomTask((()=>{this._container&&S&&(this._container.style.transform=`${lo[S]} translate(${C.x}px,${C.y}px)`)}))}if(!this._marker&&n._showingGlobe()){const y=o.eW(n.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(ag);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Za,Style:na,LngLat:o.ci,LngLatBounds:o.aG,Point:o.P,MercatorCoordinate:o.ac,FreeCameraOptions:hu,Evented:o.E,config:o.e,prewarm:o.e_,clearPrewarmedResources:o.eZ,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(f){o.e.ACCESS_TOKEN=f},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(f){o.e.API_URL=f},get workerCount(){return o.f7.workerCount},set workerCount(f){o.f7.workerCount=f},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){o.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){o.f6(f)},get workerUrl(){return o.f5.workerUrl},set workerUrl(f){o.f5.workerUrl=f},get workerClass(){return o.f5.workerClass},set workerClass(f){o.f5.workerClass=f},get workerParams(){return o.f5.workerParams},set workerParams(f){o.f5.workerParams=f},get dracoUrl(){return o.f4()},set dracoUrl(f){o.f3(f)},get meshoptUrl(){return o.f2()},set meshoptUrl(f){o.f1(f)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}}));var T=m;return T}))})(o0)),o0.exports}var Mue=Cue();const cP=Wi(Mue);cP.accessToken="pk.eyJ1IjoiYWNtb3JhLWNsb3VkeSIsImEiOiJjbWY0bWUyNjYwNzlkMmlva2lwdG5yOXF5In0.XGV4ZIaC_lJPOIV1lN_jlw";function Oue({selectedCountries:t}){const r=Le.useRef(null),s=Le.useRef(null);return Le.useEffect(()=>{if(!r.current||s.current)return;const c=new cP.Map({container:r.current,style:"mapbox://styles/mapbox/light-v11",center:[0,20],projection:"mercator",zoom:2});return c.addControl(new cP.NavigationControl),c.on("load",()=>{c.addSource("south-america",{type:"geojson",data:"https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson"}),c.addLayer({id:"south-america-layer",type:"fill",source:"south-america",paint:{"fill-color":["case",["in",["get","ISO3166-1-Alpha-3"],["literal",t]],"#030213","transparent"],"fill-opacity":.7}})}),c.on("click","south-america-layer",m=>{const v=m.features?.[0]?.properties?.name;v&&alert(`Clicked on ${v}`)}),s.current=c,()=>c.remove()},[]),Le.useEffect(()=>{const c=s.current;c&&c.getLayer("south-america-layer")&&c.setPaintProperty("south-america-layer","fill-color",["case",["in",["get","ISO3166-1-Alpha-3"],["literal",t]],"#030213","transparent"])},[t]),He.jsx("div",{ref:r,style:{width:"100%",height:"500px",borderRadius:"12px"}})}const Rue=[{name:"Ecuador",count:22,flag:"🇪🇨",code:"ECU"},{name:"España",count:35,flag:"🇪🇸",code:"ESP"},{name:"Colombia",count:34,flag:"🇨🇴",code:"COL"}];function Due(){const[t,r]=Le.useState(["Ecuador","España","Colombia"]),[s,c]=Le.useState(null),m=v=>{r(T=>T.includes(v)?T.filter(o=>o!==v):[...T,v])};return He.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[He.jsxs(Gg,{className:"p-4",children:[He.jsx("h3",{className:"text-sm font-medium mb-4",children:"Países seleccionados"}),He.jsxs("div",{className:"flex gap-2 mb-4",children:[He.jsx(Pp,{variant:"selected",size:"sm",children:"Seleccionado"}),He.jsx(Pp,{variant:"ghost",size:"sm",children:"Inactivo"})]}),He.jsx(Oue,{selectedCountries:t})]}),He.jsxs(Gg,{className:"p-4",children:[He.jsx("h3",{className:"text-sm font-medium mb-4",children:"Países"}),He.jsx("div",{className:"space-y-3",children:Rue.map(v=>He.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors hover:bg-accent/50 ${t.includes(v.code)?"bg-accent/30":""}`,onClick:()=>m(v.code),children:[He.jsxs("div",{className:"flex items-center gap-3",children:[He.jsx("div",{className:"w-6 h-4 rounded bg-gradient-to-r from-red-500 to-yellow-500 flex items-center justify-center",children:He.jsx("span",{className:"text-xs",children:v.flag})}),He.jsx("span",{className:"font-medium",children:v.name})]}),He.jsx("span",{className:"text-muted-foreground",children:v.count})]},v.name))})]})]})}async function kue(){const s=(await(await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vTCXklDWTEuDLGjn0xBdpbXMgJhjXFusekGHXz3MAO-_rTGH0kbLi-ejDKp1reIYZBO3BhNUYiXq8nn/pub?output=csv")).text()).split(`
`),c=s[0].split(",");return s.slice(1).map(v=>{const T=v.split(",");return c.reduce((o,M,R)=>(o[M]=T[R],o),{})})}function Lue({className:t,...r}){return He.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:He.jsx("table",{"data-slot":"table",className:Ku("w-full caption-bottom text-sm",t),...r})})}function zue({className:t,...r}){return He.jsx("thead",{"data-slot":"table-header",className:Ku("[&_tr]:border-b",t),...r})}function Fue({className:t,...r}){return He.jsx("tbody",{"data-slot":"table-body",className:Ku("[&_tr:last-child]:border-0",t),...r})}function XB({className:t,...r}){return He.jsx("tr",{"data-slot":"table-row",className:Ku("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...r})}function Bue({className:t,...r}){return He.jsx("th",{"data-slot":"table-head",className:Ku("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})}function Nue({className:t,...r}){return He.jsx("td",{"data-slot":"table-cell",className:Ku("p-2 align-middle overflow-hidden whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})}function jue(){const[t,r]=Le.useState([]);return Le.useEffect(()=>{(async()=>{const c=await kue();r(c)})()},[]),He.jsxs("div",{className:"p-4",children:[He.jsx("h3",{className:"text-sm font-medium mb-4",children:"Datos crudos"}),He.jsxs(Lue,{style:{tableLayout:"fixed",width:"100%"},children:[He.jsx(zue,{children:He.jsx(XB,{children:t[0]&&Object.keys(t[0]).map(s=>He.jsx(Bue,{className:"text-left w-64 truncate",children:s},s))})}),He.jsx(Fue,{children:t.map((s,c)=>He.jsx(XB,{children:Object.entries(s).map(([m,v])=>He.jsx(Nue,{className:"text-left w-64 truncate",children:v},m))},c))})]})]})}function Uue(){const[t,r]=Le.useState("dashboard"),[s,c]=Le.useState("dashboard"),[m,v]=Le.useState("all"),[T,o]=Le.useState("all"),M=G=>{r(G)},R=G=>{c(G)},B=G=>{v(G)},F=G=>{o(G)};return He.jsxs("div",{className:"flex h-screen bg-gray-50",children:[He.jsx(jq,{activeItem:t,activeTab:s,onItemClick:M,onTabClick:R}),He.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[He.jsx(i9,{activeAuthors:m,activeTopics:T,onAuthorFilterChange:B,onTopicFilterChange:F}),He.jsx("div",{className:"flex-1 overflow-auto",children:He.jsx("div",{className:"p-6",children:s==="dashboard"?He.jsxs("div",{className:"space-y-6",children:[He.jsx(o9,{}),He.jsx(Pue,{}),He.jsx(Due,{})]}):s==="Tabla de datos"?He.jsxs("div",{className:"text-center py-12",children:[He.jsx("h2",{className:"text-xl font-semibold text-muted-foreground",children:"Tabla de datos"}),He.jsx("div",{className:"mt-6",children:He.jsx(jue,{})})]}):s==="acerca"?He.jsxs("div",{className:"text-center py-12",children:[He.jsx("h2",{className:"text-xl font-semibold text-muted-foreground",children:"Acerca de"}),He.jsx("p",{className:"mt-4 text-sm text-muted-foreground max-w-md mx-auto",children:"Esta aplicación ha sido desarrollada por el Centro de Pensamiento Medicamentos, Información y Poder (CEMIP) de la Universidad Nacional de Colombia (UNAL)."})]}):null})})]})]})}C8.createRoot(document.getElementById("root")).render(He.jsx(Uue,{}));
