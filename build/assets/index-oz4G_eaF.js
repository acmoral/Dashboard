(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))c(y);new MutationObserver(y=>{for(const w of y)if(w.type==="childList")for(const P of w.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&c(P)}).observe(document,{childList:!0,subtree:!0});function l(y){const w={};return y.integrity&&(w.integrity=y.integrity),y.referrerPolicy&&(w.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?w.credentials="include":y.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function c(y){if(y.ep)return;y.ep=!0;const w=l(y);fetch(y.href,w)}})();var jv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xi(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Jb={exports:{}},N_={},Qb={exports:{}},vi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gM;function MU(){if(gM)return vi;gM=1;var r=Symbol.for("react.element"),n=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),w=Symbol.for("react.provider"),P=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),z=Symbol.for("react.memo"),$=Symbol.for("react.lazy"),V=Symbol.iterator;function W($e){return $e===null||typeof $e!="object"?null:($e=V&&$e[V]||$e["@@iterator"],typeof $e=="function"?$e:null)}var ie={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ae=Object.assign,ee={};function ne($e,pt,fr){this.props=$e,this.context=pt,this.refs=ee,this.updater=fr||ie}ne.prototype.isReactComponent={},ne.prototype.setState=function($e,pt){if(typeof $e!="object"&&typeof $e!="function"&&$e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,$e,pt,"setState")},ne.prototype.forceUpdate=function($e){this.updater.enqueueForceUpdate(this,$e,"forceUpdate")};function de(){}de.prototype=ne.prototype;function xe($e,pt,fr){this.props=$e,this.context=pt,this.refs=ee,this.updater=fr||ie}var be=xe.prototype=new de;be.constructor=xe,ae(be,ne.prototype),be.isPureReactComponent=!0;var ke=Array.isArray,he=Object.prototype.hasOwnProperty,_e={current:null},ze={key:!0,ref:!0,__self:!0,__source:!0};function Ne($e,pt,fr){var zr,Hr={},Ir=null,Lr=null;if(pt!=null)for(zr in pt.ref!==void 0&&(Lr=pt.ref),pt.key!==void 0&&(Ir=""+pt.key),pt)he.call(pt,zr)&&!ze.hasOwnProperty(zr)&&(Hr[zr]=pt[zr]);var Ur=arguments.length-2;if(Ur===1)Hr.children=fr;else if(1<Ur){for(var or=Array(Ur),Er=0;Er<Ur;Er++)or[Er]=arguments[Er+2];Hr.children=or}if($e&&$e.defaultProps)for(zr in Ur=$e.defaultProps,Ur)Hr[zr]===void 0&&(Hr[zr]=Ur[zr]);return{$$typeof:r,type:$e,key:Ir,ref:Lr,props:Hr,_owner:_e.current}}function rt($e,pt){return{$$typeof:r,type:$e.type,key:pt,ref:$e.ref,props:$e.props,_owner:$e._owner}}function kt($e){return typeof $e=="object"&&$e!==null&&$e.$$typeof===r}function He($e){var pt={"=":"=0",":":"=2"};return"$"+$e.replace(/[=:]/g,function(fr){return pt[fr]})}var yt=/\/+/g;function gt($e,pt){return typeof $e=="object"&&$e!==null&&$e.key!=null?He(""+$e.key):pt.toString(36)}function Pt($e,pt,fr,zr,Hr){var Ir=typeof $e;(Ir==="undefined"||Ir==="boolean")&&($e=null);var Lr=!1;if($e===null)Lr=!0;else switch(Ir){case"string":case"number":Lr=!0;break;case"object":switch($e.$$typeof){case r:case n:Lr=!0}}if(Lr)return Lr=$e,Hr=Hr(Lr),$e=zr===""?"."+gt(Lr,0):zr,ke(Hr)?(fr="",$e!=null&&(fr=$e.replace(yt,"$&/")+"/"),Pt(Hr,pt,fr,"",function(Er){return Er})):Hr!=null&&(kt(Hr)&&(Hr=rt(Hr,fr+(!Hr.key||Lr&&Lr.key===Hr.key?"":(""+Hr.key).replace(yt,"$&/")+"/")+$e)),pt.push(Hr)),1;if(Lr=0,zr=zr===""?".":zr+":",ke($e))for(var Ur=0;Ur<$e.length;Ur++){Ir=$e[Ur];var or=zr+gt(Ir,Ur);Lr+=Pt(Ir,pt,fr,or,Hr)}else if(or=W($e),typeof or=="function")for($e=or.call($e),Ur=0;!(Ir=$e.next()).done;)Ir=Ir.value,or=zr+gt(Ir,Ur++),Lr+=Pt(Ir,pt,fr,or,Hr);else if(Ir==="object")throw pt=String($e),Error("Objects are not valid as a React child (found: "+(pt==="[object Object]"?"object with keys {"+Object.keys($e).join(", ")+"}":pt)+"). If you meant to render a collection of children, use an array instead.");return Lr}function xt($e,pt,fr){if($e==null)return $e;var zr=[],Hr=0;return Pt($e,zr,"","",function(Ir){return pt.call(fr,Ir,Hr++)}),zr}function Tt($e){if($e._status===-1){var pt=$e._result;pt=pt(),pt.then(function(fr){($e._status===0||$e._status===-1)&&($e._status=1,$e._result=fr)},function(fr){($e._status===0||$e._status===-1)&&($e._status=2,$e._result=fr)}),$e._status===-1&&($e._status=0,$e._result=pt)}if($e._status===1)return $e._result.default;throw $e._result}var Ht={current:null},lt={transition:null},Wt={ReactCurrentDispatcher:Ht,ReactCurrentBatchConfig:lt,ReactCurrentOwner:_e};function Zt(){throw Error("act(...) is not supported in production builds of React.")}return vi.Children={map:xt,forEach:function($e,pt,fr){xt($e,function(){pt.apply(this,arguments)},fr)},count:function($e){var pt=0;return xt($e,function(){pt++}),pt},toArray:function($e){return xt($e,function(pt){return pt})||[]},only:function($e){if(!kt($e))throw Error("React.Children.only expected to receive a single React element child.");return $e}},vi.Component=ne,vi.Fragment=l,vi.Profiler=y,vi.PureComponent=xe,vi.StrictMode=c,vi.Suspense=R,vi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Wt,vi.act=Zt,vi.cloneElement=function($e,pt,fr){if($e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+$e+".");var zr=ae({},$e.props),Hr=$e.key,Ir=$e.ref,Lr=$e._owner;if(pt!=null){if(pt.ref!==void 0&&(Ir=pt.ref,Lr=_e.current),pt.key!==void 0&&(Hr=""+pt.key),$e.type&&$e.type.defaultProps)var Ur=$e.type.defaultProps;for(or in pt)he.call(pt,or)&&!ze.hasOwnProperty(or)&&(zr[or]=pt[or]===void 0&&Ur!==void 0?Ur[or]:pt[or])}var or=arguments.length-2;if(or===1)zr.children=fr;else if(1<or){Ur=Array(or);for(var Er=0;Er<or;Er++)Ur[Er]=arguments[Er+2];zr.children=Ur}return{$$typeof:r,type:$e.type,key:Hr,ref:Ir,props:zr,_owner:Lr}},vi.createContext=function($e){return $e={$$typeof:P,_currentValue:$e,_currentValue2:$e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},$e.Provider={$$typeof:w,_context:$e},$e.Consumer=$e},vi.createElement=Ne,vi.createFactory=function($e){var pt=Ne.bind(null,$e);return pt.type=$e,pt},vi.createRef=function(){return{current:null}},vi.forwardRef=function($e){return{$$typeof:a,render:$e}},vi.isValidElement=kt,vi.lazy=function($e){return{$$typeof:$,_payload:{_status:-1,_result:$e},_init:Tt}},vi.memo=function($e,pt){return{$$typeof:z,type:$e,compare:pt===void 0?null:pt}},vi.startTransition=function($e){var pt=lt.transition;lt.transition={};try{$e()}finally{lt.transition=pt}},vi.unstable_act=Zt,vi.useCallback=function($e,pt){return Ht.current.useCallback($e,pt)},vi.useContext=function($e){return Ht.current.useContext($e)},vi.useDebugValue=function(){},vi.useDeferredValue=function($e){return Ht.current.useDeferredValue($e)},vi.useEffect=function($e,pt){return Ht.current.useEffect($e,pt)},vi.useId=function(){return Ht.current.useId()},vi.useImperativeHandle=function($e,pt,fr){return Ht.current.useImperativeHandle($e,pt,fr)},vi.useInsertionEffect=function($e,pt){return Ht.current.useInsertionEffect($e,pt)},vi.useLayoutEffect=function($e,pt){return Ht.current.useLayoutEffect($e,pt)},vi.useMemo=function($e,pt){return Ht.current.useMemo($e,pt)},vi.useReducer=function($e,pt,fr){return Ht.current.useReducer($e,pt,fr)},vi.useRef=function($e){return Ht.current.useRef($e)},vi.useState=function($e){return Ht.current.useState($e)},vi.useSyncExternalStore=function($e,pt,fr){return Ht.current.useSyncExternalStore($e,pt,fr)},vi.useTransition=function(){return Ht.current.useTransition()},vi.version="18.3.1",vi}var _M;function RA(){return _M||(_M=1,Qb.exports=MU()),Qb.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yM;function OU(){if(yM)return N_;yM=1;var r=RA(),n=Symbol.for("react.element"),l=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,y=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,w={key:!0,ref:!0,__self:!0,__source:!0};function P(a,R,z){var $,V={},W=null,ie=null;z!==void 0&&(W=""+z),R.key!==void 0&&(W=""+R.key),R.ref!==void 0&&(ie=R.ref);for($ in R)c.call(R,$)&&!w.hasOwnProperty($)&&(V[$]=R[$]);if(a&&a.defaultProps)for($ in R=a.defaultProps,R)V[$]===void 0&&(V[$]=R[$]);return{$$typeof:n,type:a,key:W,ref:ie,props:V,_owner:y.current}}return N_.Fragment=l,N_.jsx=P,N_.jsxs=P,N_}var vM;function RU(){return vM||(vM=1,Jb.exports=OU()),Jb.exports}var Bt=RU(),Uv={},e1={exports:{}},vl={},t1={exports:{}},r1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xM;function kU(){return xM||(xM=1,(function(r){function n(lt,Wt){var Zt=lt.length;lt.push(Wt);e:for(;0<Zt;){var $e=Zt-1>>>1,pt=lt[$e];if(0<y(pt,Wt))lt[$e]=Wt,lt[Zt]=pt,Zt=$e;else break e}}function l(lt){return lt.length===0?null:lt[0]}function c(lt){if(lt.length===0)return null;var Wt=lt[0],Zt=lt.pop();if(Zt!==Wt){lt[0]=Zt;e:for(var $e=0,pt=lt.length,fr=pt>>>1;$e<fr;){var zr=2*($e+1)-1,Hr=lt[zr],Ir=zr+1,Lr=lt[Ir];if(0>y(Hr,Zt))Ir<pt&&0>y(Lr,Hr)?(lt[$e]=Lr,lt[Ir]=Zt,$e=Ir):(lt[$e]=Hr,lt[zr]=Zt,$e=zr);else if(Ir<pt&&0>y(Lr,Zt))lt[$e]=Lr,lt[Ir]=Zt,$e=Ir;else break e}}return Wt}function y(lt,Wt){var Zt=lt.sortIndex-Wt.sortIndex;return Zt!==0?Zt:lt.id-Wt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var w=performance;r.unstable_now=function(){return w.now()}}else{var P=Date,a=P.now();r.unstable_now=function(){return P.now()-a}}var R=[],z=[],$=1,V=null,W=3,ie=!1,ae=!1,ee=!1,ne=typeof setTimeout=="function"?setTimeout:null,de=typeof clearTimeout=="function"?clearTimeout:null,xe=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function be(lt){for(var Wt=l(z);Wt!==null;){if(Wt.callback===null)c(z);else if(Wt.startTime<=lt)c(z),Wt.sortIndex=Wt.expirationTime,n(R,Wt);else break;Wt=l(z)}}function ke(lt){if(ee=!1,be(lt),!ae)if(l(R)!==null)ae=!0,Tt(he);else{var Wt=l(z);Wt!==null&&Ht(ke,Wt.startTime-lt)}}function he(lt,Wt){ae=!1,ee&&(ee=!1,de(Ne),Ne=-1),ie=!0;var Zt=W;try{for(be(Wt),V=l(R);V!==null&&(!(V.expirationTime>Wt)||lt&&!He());){var $e=V.callback;if(typeof $e=="function"){V.callback=null,W=V.priorityLevel;var pt=$e(V.expirationTime<=Wt);Wt=r.unstable_now(),typeof pt=="function"?V.callback=pt:V===l(R)&&c(R),be(Wt)}else c(R);V=l(R)}if(V!==null)var fr=!0;else{var zr=l(z);zr!==null&&Ht(ke,zr.startTime-Wt),fr=!1}return fr}finally{V=null,W=Zt,ie=!1}}var _e=!1,ze=null,Ne=-1,rt=5,kt=-1;function He(){return!(r.unstable_now()-kt<rt)}function yt(){if(ze!==null){var lt=r.unstable_now();kt=lt;var Wt=!0;try{Wt=ze(!0,lt)}finally{Wt?gt():(_e=!1,ze=null)}}else _e=!1}var gt;if(typeof xe=="function")gt=function(){xe(yt)};else if(typeof MessageChannel<"u"){var Pt=new MessageChannel,xt=Pt.port2;Pt.port1.onmessage=yt,gt=function(){xt.postMessage(null)}}else gt=function(){ne(yt,0)};function Tt(lt){ze=lt,_e||(_e=!0,gt())}function Ht(lt,Wt){Ne=ne(function(){lt(r.unstable_now())},Wt)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(lt){lt.callback=null},r.unstable_continueExecution=function(){ae||ie||(ae=!0,Tt(he))},r.unstable_forceFrameRate=function(lt){0>lt||125<lt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):rt=0<lt?Math.floor(1e3/lt):5},r.unstable_getCurrentPriorityLevel=function(){return W},r.unstable_getFirstCallbackNode=function(){return l(R)},r.unstable_next=function(lt){switch(W){case 1:case 2:case 3:var Wt=3;break;default:Wt=W}var Zt=W;W=Wt;try{return lt()}finally{W=Zt}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(lt,Wt){switch(lt){case 1:case 2:case 3:case 4:case 5:break;default:lt=3}var Zt=W;W=lt;try{return Wt()}finally{W=Zt}},r.unstable_scheduleCallback=function(lt,Wt,Zt){var $e=r.unstable_now();switch(typeof Zt=="object"&&Zt!==null?(Zt=Zt.delay,Zt=typeof Zt=="number"&&0<Zt?$e+Zt:$e):Zt=$e,lt){case 1:var pt=-1;break;case 2:pt=250;break;case 5:pt=1073741823;break;case 4:pt=1e4;break;default:pt=5e3}return pt=Zt+pt,lt={id:$++,callback:Wt,priorityLevel:lt,startTime:Zt,expirationTime:pt,sortIndex:-1},Zt>$e?(lt.sortIndex=Zt,n(z,lt),l(R)===null&&lt===l(z)&&(ee?(de(Ne),Ne=-1):ee=!0,Ht(ke,Zt-$e))):(lt.sortIndex=pt,n(R,lt),ae||ie||(ae=!0,Tt(he))),lt},r.unstable_shouldYield=He,r.unstable_wrapCallback=function(lt){var Wt=W;return function(){var Zt=W;W=Wt;try{return lt.apply(this,arguments)}finally{W=Zt}}}})(r1)),r1}var bM;function DU(){return bM||(bM=1,t1.exports=kU()),t1.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wM;function zU(){if(wM)return vl;wM=1;var r=RA(),n=DU();function l(g){for(var x="https://reactjs.org/docs/error-decoder.html?invariant="+g,I=1;I<arguments.length;I++)x+="&args[]="+encodeURIComponent(arguments[I]);return"Minified React error #"+g+"; visit "+x+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var c=new Set,y={};function w(g,x){P(g,x),P(g+"Capture",x)}function P(g,x){for(y[g]=x,g=0;g<x.length;g++)c.add(x[g])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),R=Object.prototype.hasOwnProperty,z=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,$={},V={};function W(g){return R.call(V,g)?!0:R.call($,g)?!1:z.test(g)?V[g]=!0:($[g]=!0,!1)}function ie(g,x,I,F){if(I!==null&&I.type===0)return!1;switch(typeof x){case"function":case"symbol":return!0;case"boolean":return F?!1:I!==null?!I.acceptsBooleans:(g=g.toLowerCase().slice(0,5),g!=="data-"&&g!=="aria-");default:return!1}}function ae(g,x,I,F){if(x===null||typeof x>"u"||ie(g,x,I,F))return!0;if(F)return!1;if(I!==null)switch(I.type){case 3:return!x;case 4:return x===!1;case 5:return isNaN(x);case 6:return isNaN(x)||1>x}return!1}function ee(g,x,I,F,G,Q,we){this.acceptsBooleans=x===2||x===3||x===4,this.attributeName=F,this.attributeNamespace=G,this.mustUseProperty=I,this.propertyName=g,this.type=x,this.sanitizeURL=Q,this.removeEmptyString=we}var ne={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(g){ne[g]=new ee(g,0,!1,g,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(g){var x=g[0];ne[x]=new ee(x,1,!1,g[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(g){ne[g]=new ee(g,2,!1,g.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(g){ne[g]=new ee(g,2,!1,g,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(g){ne[g]=new ee(g,3,!1,g.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(g){ne[g]=new ee(g,3,!0,g,null,!1,!1)}),["capture","download"].forEach(function(g){ne[g]=new ee(g,4,!1,g,null,!1,!1)}),["cols","rows","size","span"].forEach(function(g){ne[g]=new ee(g,6,!1,g,null,!1,!1)}),["rowSpan","start"].forEach(function(g){ne[g]=new ee(g,5,!1,g.toLowerCase(),null,!1,!1)});var de=/[\-:]([a-z])/g;function xe(g){return g[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(g){var x=g.replace(de,xe);ne[x]=new ee(x,1,!1,g,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(g){var x=g.replace(de,xe);ne[x]=new ee(x,1,!1,g,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(g){var x=g.replace(de,xe);ne[x]=new ee(x,1,!1,g,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(g){ne[g]=new ee(g,1,!1,g.toLowerCase(),null,!1,!1)}),ne.xlinkHref=new ee("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(g){ne[g]=new ee(g,1,!1,g.toLowerCase(),null,!0,!0)});function be(g,x,I,F){var G=ne.hasOwnProperty(x)?ne[x]:null;(G!==null?G.type!==0:F||!(2<x.length)||x[0]!=="o"&&x[0]!=="O"||x[1]!=="n"&&x[1]!=="N")&&(ae(x,I,G,F)&&(I=null),F||G===null?W(x)&&(I===null?g.removeAttribute(x):g.setAttribute(x,""+I)):G.mustUseProperty?g[G.propertyName]=I===null?G.type===3?!1:"":I:(x=G.attributeName,F=G.attributeNamespace,I===null?g.removeAttribute(x):(G=G.type,I=G===3||G===4&&I===!0?"":""+I,F?g.setAttributeNS(F,x,I):g.setAttribute(x,I))))}var ke=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,he=Symbol.for("react.element"),_e=Symbol.for("react.portal"),ze=Symbol.for("react.fragment"),Ne=Symbol.for("react.strict_mode"),rt=Symbol.for("react.profiler"),kt=Symbol.for("react.provider"),He=Symbol.for("react.context"),yt=Symbol.for("react.forward_ref"),gt=Symbol.for("react.suspense"),Pt=Symbol.for("react.suspense_list"),xt=Symbol.for("react.memo"),Tt=Symbol.for("react.lazy"),Ht=Symbol.for("react.offscreen"),lt=Symbol.iterator;function Wt(g){return g===null||typeof g!="object"?null:(g=lt&&g[lt]||g["@@iterator"],typeof g=="function"?g:null)}var Zt=Object.assign,$e;function pt(g){if($e===void 0)try{throw Error()}catch(I){var x=I.stack.trim().match(/\n( *(at )?)/);$e=x&&x[1]||""}return`
`+$e+g}var fr=!1;function zr(g,x){if(!g||fr)return"";fr=!0;var I=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(x)if(x=function(){throw Error()},Object.defineProperty(x.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(x,[])}catch(qt){var F=qt}Reflect.construct(g,[],x)}else{try{x.call()}catch(qt){F=qt}g.call(x.prototype)}else{try{throw Error()}catch(qt){F=qt}g()}}catch(qt){if(qt&&F&&typeof qt.stack=="string"){for(var G=qt.stack.split(`
`),Q=F.stack.split(`
`),we=G.length-1,Ze=Q.length-1;1<=we&&0<=Ze&&G[we]!==Q[Ze];)Ze--;for(;1<=we&&0<=Ze;we--,Ze--)if(G[we]!==Q[Ze]){if(we!==1||Ze!==1)do if(we--,Ze--,0>Ze||G[we]!==Q[Ze]){var it=`
`+G[we].replace(" at new "," at ");return g.displayName&&it.includes("<anonymous>")&&(it=it.replace("<anonymous>",g.displayName)),it}while(1<=we&&0<=Ze);break}}}finally{fr=!1,Error.prepareStackTrace=I}return(g=g?g.displayName||g.name:"")?pt(g):""}function Hr(g){switch(g.tag){case 5:return pt(g.type);case 16:return pt("Lazy");case 13:return pt("Suspense");case 19:return pt("SuspenseList");case 0:case 2:case 15:return g=zr(g.type,!1),g;case 11:return g=zr(g.type.render,!1),g;case 1:return g=zr(g.type,!0),g;default:return""}}function Ir(g){if(g==null)return null;if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g;switch(g){case ze:return"Fragment";case _e:return"Portal";case rt:return"Profiler";case Ne:return"StrictMode";case gt:return"Suspense";case Pt:return"SuspenseList"}if(typeof g=="object")switch(g.$$typeof){case He:return(g.displayName||"Context")+".Consumer";case kt:return(g._context.displayName||"Context")+".Provider";case yt:var x=g.render;return g=g.displayName,g||(g=x.displayName||x.name||"",g=g!==""?"ForwardRef("+g+")":"ForwardRef"),g;case xt:return x=g.displayName||null,x!==null?x:Ir(g.type)||"Memo";case Tt:x=g._payload,g=g._init;try{return Ir(g(x))}catch{}}return null}function Lr(g){var x=g.type;switch(g.tag){case 24:return"Cache";case 9:return(x.displayName||"Context")+".Consumer";case 10:return(x._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return g=x.render,g=g.displayName||g.name||"",x.displayName||(g!==""?"ForwardRef("+g+")":"ForwardRef");case 7:return"Fragment";case 5:return x;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ir(x);case 8:return x===Ne?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x}return null}function Ur(g){switch(typeof g){case"boolean":case"number":case"string":case"undefined":return g;case"object":return g;default:return""}}function or(g){var x=g.type;return(g=g.nodeName)&&g.toLowerCase()==="input"&&(x==="checkbox"||x==="radio")}function Er(g){var x=or(g)?"checked":"value",I=Object.getOwnPropertyDescriptor(g.constructor.prototype,x),F=""+g[x];if(!g.hasOwnProperty(x)&&typeof I<"u"&&typeof I.get=="function"&&typeof I.set=="function"){var G=I.get,Q=I.set;return Object.defineProperty(g,x,{configurable:!0,get:function(){return G.call(this)},set:function(we){F=""+we,Q.call(this,we)}}),Object.defineProperty(g,x,{enumerable:I.enumerable}),{getValue:function(){return F},setValue:function(we){F=""+we},stopTracking:function(){g._valueTracker=null,delete g[x]}}}}function pn(g){g._valueTracker||(g._valueTracker=Er(g))}function sr(g){if(!g)return!1;var x=g._valueTracker;if(!x)return!0;var I=x.getValue(),F="";return g&&(F=or(g)?g.checked?"true":"false":g.value),g=F,g!==I?(x.setValue(g),!0):!1}function Pi(g){if(g=g||(typeof document<"u"?document:void 0),typeof g>"u")return null;try{return g.activeElement||g.body}catch{return g.body}}function Rn(g,x){var I=x.checked;return Zt({},x,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:I??g._wrapperState.initialChecked})}function In(g,x){var I=x.defaultValue==null?"":x.defaultValue,F=x.checked!=null?x.checked:x.defaultChecked;I=Ur(x.value!=null?x.value:I),g._wrapperState={initialChecked:F,initialValue:I,controlled:x.type==="checkbox"||x.type==="radio"?x.checked!=null:x.value!=null}}function ci(g,x){x=x.checked,x!=null&&be(g,"checked",x,!1)}function Ki(g,x){ci(g,x);var I=Ur(x.value),F=x.type;if(I!=null)F==="number"?(I===0&&g.value===""||g.value!=I)&&(g.value=""+I):g.value!==""+I&&(g.value=""+I);else if(F==="submit"||F==="reset"){g.removeAttribute("value");return}x.hasOwnProperty("value")?$o(g,x.type,I):x.hasOwnProperty("defaultValue")&&$o(g,x.type,Ur(x.defaultValue)),x.checked==null&&x.defaultChecked!=null&&(g.defaultChecked=!!x.defaultChecked)}function wa(g,x,I){if(x.hasOwnProperty("value")||x.hasOwnProperty("defaultValue")){var F=x.type;if(!(F!=="submit"&&F!=="reset"||x.value!==void 0&&x.value!==null))return;x=""+g._wrapperState.initialValue,I||x===g.value||(g.value=x),g.defaultValue=x}I=g.name,I!==""&&(g.name=""),g.defaultChecked=!!g._wrapperState.initialChecked,I!==""&&(g.name=I)}function $o(g,x,I){(x!=="number"||Pi(g.ownerDocument)!==g)&&(I==null?g.defaultValue=""+g._wrapperState.initialValue:g.defaultValue!==""+I&&(g.defaultValue=""+I))}var fo=Array.isArray;function Ui(g,x,I,F){if(g=g.options,x){x={};for(var G=0;G<I.length;G++)x["$"+I[G]]=!0;for(I=0;I<g.length;I++)G=x.hasOwnProperty("$"+g[I].value),g[I].selected!==G&&(g[I].selected=G),G&&F&&(g[I].defaultSelected=!0)}else{for(I=""+Ur(I),x=null,G=0;G<g.length;G++){if(g[G].value===I){g[G].selected=!0,F&&(g[G].defaultSelected=!0);return}x!==null||g[G].disabled||(x=g[G])}x!==null&&(x.selected=!0)}}function Fo(g,x){if(x.dangerouslySetInnerHTML!=null)throw Error(l(91));return Zt({},x,{value:void 0,defaultValue:void 0,children:""+g._wrapperState.initialValue})}function Fa(g,x){var I=x.value;if(I==null){if(I=x.children,x=x.defaultValue,I!=null){if(x!=null)throw Error(l(92));if(fo(I)){if(1<I.length)throw Error(l(93));I=I[0]}x=I}x==null&&(x=""),I=x}g._wrapperState={initialValue:Ur(I)}}function Ms(g,x){var I=Ur(x.value),F=Ur(x.defaultValue);I!=null&&(I=""+I,I!==g.value&&(g.value=I),x.defaultValue==null&&g.defaultValue!==I&&(g.defaultValue=I)),F!=null&&(g.defaultValue=""+F)}function Js(g){var x=g.textContent;x===g._wrapperState.initialValue&&x!==""&&x!==null&&(g.value=x)}function la(g){switch(g){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Sa(g,x){return g==null||g==="http://www.w3.org/1999/xhtml"?la(x):g==="http://www.w3.org/2000/svg"&&x==="foreignObject"?"http://www.w3.org/1999/xhtml":g}var Jl,Qs=(function(g){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(x,I,F,G){MSApp.execUnsafeLocalFunction(function(){return g(x,I,F,G)})}:g})(function(g,x){if(g.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in g)g.innerHTML=x;else{for(Jl=Jl||document.createElement("div"),Jl.innerHTML="<svg>"+x.valueOf().toString()+"</svg>",x=Jl.firstChild;g.firstChild;)g.removeChild(g.firstChild);for(;x.firstChild;)g.appendChild(x.firstChild)}});function el(g,x){if(x){var I=g.firstChild;if(I&&I===g.lastChild&&I.nodeType===3){I.nodeValue=x;return}}g.textContent=x}var vo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ts=["Webkit","ms","Moz","O"];Object.keys(vo).forEach(function(g){ts.forEach(function(x){x=x+g.charAt(0).toUpperCase()+g.substring(1),vo[x]=vo[g]})});function wl(g,x,I){return x==null||typeof x=="boolean"||x===""?"":I||typeof x!="number"||x===0||vo.hasOwnProperty(g)&&vo[g]?(""+x).trim():x+"px"}function tl(g,x){g=g.style;for(var I in x)if(x.hasOwnProperty(I)){var F=I.indexOf("--")===0,G=wl(I,x[I],F);I==="float"&&(I="cssFloat"),F?g.setProperty(I,G):g[I]=G}}var Ql=Zt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function rl(g,x){if(x){if(Ql[g]&&(x.children!=null||x.dangerouslySetInnerHTML!=null))throw Error(l(137,g));if(x.dangerouslySetInnerHTML!=null){if(x.children!=null)throw Error(l(60));if(typeof x.dangerouslySetInnerHTML!="object"||!("__html"in x.dangerouslySetInnerHTML))throw Error(l(61))}if(x.style!=null&&typeof x.style!="object")throw Error(l(62))}}function eu(g,x){if(g.indexOf("-")===-1)return typeof x.is=="string";switch(g){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ii=null;function Gu(g){return g=g.target||g.srcElement||window,g.correspondingUseElement&&(g=g.correspondingUseElement),g.nodeType===3?g.parentNode:g}var Hu=null,qo=null,nl=null;function Kf(g){if(g=hh(g)){if(typeof Hu!="function")throw Error(l(280));var x=g.stateNode;x&&(x=fh(x),Hu(g.stateNode,g.type,x))}}function Wu(g){qo?nl?nl.push(g):nl=[g]:qo=g}function Ct(){if(qo){var g=qo,x=nl;if(nl=qo=null,Kf(g),x)for(g=0;g<x.length;g++)Kf(x[g])}}function il(g,x){return g(x)}function Yf(){}var Zu=!1;function Cn(g,x,I){if(Zu)return g(x,I);Zu=!0;try{return il(g,x,I)}finally{Zu=!1,(qo!==null||nl!==null)&&(Yf(),Ct())}}function Ke(g,x){var I=g.stateNode;if(I===null)return null;var F=fh(I);if(F===null)return null;I=F[x];e:switch(x){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(F=!F.disabled)||(g=g.type,F=!(g==="button"||g==="input"||g==="select"||g==="textarea")),g=!F;break e;default:g=!1}if(g)return null;if(I&&typeof I!="function")throw Error(l(231,x,typeof I));return I}var re=!1;if(a)try{var oe={};Object.defineProperty(oe,"passive",{get:function(){re=!0}}),window.addEventListener("test",oe,oe),window.removeEventListener("test",oe,oe)}catch{re=!1}function ye(g,x,I,F,G,Q,we,Ze,it){var qt=Array.prototype.slice.call(arguments,3);try{x.apply(I,qt)}catch(mr){this.onError(mr)}}var Oe=!1,ve=null,Fe=!1,et=null,Ue={onError:function(g){Oe=!0,ve=g}};function Qe(g,x,I,F,G,Q,we,Ze,it){Oe=!1,ve=null,ye.apply(Ue,arguments)}function Nt(g,x,I,F,G,Q,we,Ze,it){if(Qe.apply(this,arguments),Oe){if(Oe){var qt=ve;Oe=!1,ve=null}else throw Error(l(198));Fe||(Fe=!0,et=qt)}}function mt(g){var x=g,I=g;if(g.alternate)for(;x.return;)x=x.return;else{g=x;do x=g,(x.flags&4098)!==0&&(I=x.return),g=x.return;while(g)}return x.tag===3?I:null}function vr(g){if(g.tag===13){var x=g.memoizedState;if(x===null&&(g=g.alternate,g!==null&&(x=g.memoizedState)),x!==null)return x.dehydrated}return null}function Cr(g){if(mt(g)!==g)throw Error(l(188))}function Br(g){var x=g.alternate;if(!x){if(x=mt(g),x===null)throw Error(l(188));return x!==g?null:g}for(var I=g,F=x;;){var G=I.return;if(G===null)break;var Q=G.alternate;if(Q===null){if(F=G.return,F!==null){I=F;continue}break}if(G.child===Q.child){for(Q=G.child;Q;){if(Q===I)return Cr(G),g;if(Q===F)return Cr(G),x;Q=Q.sibling}throw Error(l(188))}if(I.return!==F.return)I=G,F=Q;else{for(var we=!1,Ze=G.child;Ze;){if(Ze===I){we=!0,I=G,F=Q;break}if(Ze===F){we=!0,F=G,I=Q;break}Ze=Ze.sibling}if(!we){for(Ze=Q.child;Ze;){if(Ze===I){we=!0,I=Q,F=G;break}if(Ze===F){we=!0,F=Q,I=G;break}Ze=Ze.sibling}if(!we)throw Error(l(189))}}if(I.alternate!==F)throw Error(l(190))}if(I.tag!==3)throw Error(l(188));return I.stateNode.current===I?g:x}function ln(g){return g=Br(g),g!==null?Jr(g):null}function Jr(g){if(g.tag===5||g.tag===6)return g;for(g=g.child;g!==null;){var x=Jr(g);if(x!==null)return x;g=g.sibling}return null}var cn=n.unstable_scheduleCallback,Yn=n.unstable_cancelCallback,hn=n.unstable_shouldYield,Li=n.unstable_requestPaint,$n=n.unstable_now,to=n.unstable_getCurrentPriorityLevel,qn=n.unstable_ImmediatePriority,kn=n.unstable_UserBlockingPriority,bi=n.unstable_NormalPriority,Ti=n.unstable_LowPriority,gi=n.unstable_IdlePriority,oo=null,ro=null;function Qo(g){if(ro&&typeof ro.onCommitFiberRoot=="function")try{ro.onCommitFiberRoot(oo,g,void 0,(g.current.flags&128)===128)}catch{}}var Ta=Math.clz32?Math.clz32:Jf,Bo=Math.log,tu=Math.LN2;function Jf(g){return g>>>=0,g===0?32:31-(Bo(g)/tu|0)|0}var ru=64,nu=4194304;function iu(g){switch(g&-g){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return g&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return g}}function Xu(g,x){var I=g.pendingLanes;if(I===0)return 0;var F=0,G=g.suspendedLanes,Q=g.pingedLanes,we=I&268435455;if(we!==0){var Ze=we&~G;Ze!==0?F=iu(Ze):(Q&=we,Q!==0&&(F=iu(Q)))}else we=I&~G,we!==0?F=iu(we):Q!==0&&(F=iu(Q));if(F===0)return 0;if(x!==0&&x!==F&&(x&G)===0&&(G=F&-F,Q=x&-x,G>=Q||G===16&&(Q&4194240)!==0))return x;if((F&4)!==0&&(F|=I&16),x=g.entangledLanes,x!==0)for(g=g.entanglements,x&=F;0<x;)I=31-Ta(x),G=1<<I,F|=g[I],x&=~G;return F}function Ku(g,x){switch(g){case 1:case 2:case 4:return x+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Nh(g,x){for(var I=g.suspendedLanes,F=g.pingedLanes,G=g.expirationTimes,Q=g.pendingLanes;0<Q;){var we=31-Ta(Q),Ze=1<<we,it=G[we];it===-1?((Ze&I)===0||(Ze&F)!==0)&&(G[we]=Ku(Ze,x)):it<=x&&(g.expiredLanes|=Ze),Q&=~Ze}}function Vc(g){return g=g.pendingLanes&-1073741825,g!==0?g:g&1073741824?1073741824:0}function ds(){var g=ru;return ru<<=1,(ru&4194240)===0&&(ru=64),g}function Ea(g){for(var x=[],I=0;31>I;I++)x.push(g);return x}function ua(g,x,I){g.pendingLanes|=x,x!==536870912&&(g.suspendedLanes=0,g.pingedLanes=0),g=g.eventTimes,x=31-Ta(x),g[x]=I}function Sl(g,x){var I=g.pendingLanes&~x;g.pendingLanes=x,g.suspendedLanes=0,g.pingedLanes=0,g.expiredLanes&=x,g.mutableReadLanes&=x,g.entangledLanes&=x,x=g.entanglements;var F=g.eventTimes;for(g=g.expirationTimes;0<I;){var G=31-Ta(I),Q=1<<G;x[G]=0,F[G]=-1,g[G]=-1,I&=~Q}}function rs(g,x){var I=g.entangledLanes|=x;for(g=g.entanglements;I;){var F=31-Ta(I),G=1<<F;G&x|g[F]&x&&(g[F]|=x),I&=~G}}var oi=0;function $c(g){return g&=-g,1<g?4<g?(g&268435455)!==0?16:536870912:4:1}var Os,Yu,ou,Ju,Qf,jh=!1,Go=[],Ba=null,ps=null,ns=null,qc=new Map,Gc=new Map,ms=[],bn="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Uh(g,x){switch(g){case"focusin":case"focusout":Ba=null;break;case"dragenter":case"dragleave":ps=null;break;case"mouseover":case"mouseout":ns=null;break;case"pointerover":case"pointerout":qc.delete(x.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gc.delete(x.pointerId)}}function ol(g,x,I,F,G,Q){return g===null||g.nativeEvent!==Q?(g={blockedOn:x,domEventName:I,eventSystemFlags:F,nativeEvent:Q,targetContainers:[G]},x!==null&&(x=hh(x),x!==null&&Yu(x)),g):(g.eventSystemFlags|=F,x=g.targetContainers,G!==null&&x.indexOf(G)===-1&&x.push(G),g)}function Vh(g,x,I,F,G){switch(x){case"focusin":return Ba=ol(Ba,g,x,I,F,G),!0;case"dragenter":return ps=ol(ps,g,x,I,F,G),!0;case"mouseover":return ns=ol(ns,g,x,I,F,G),!0;case"pointerover":var Q=G.pointerId;return qc.set(Q,ol(qc.get(Q)||null,g,x,I,F,G)),!0;case"gotpointercapture":return Q=G.pointerId,Gc.set(Q,ol(Gc.get(Q)||null,g,x,I,F,G)),!0}return!1}function wm(g){var x=cc(g.target);if(x!==null){var I=mt(x);if(I!==null){if(x=I.tag,x===13){if(x=vr(I),x!==null){g.blockedOn=x,Qf(g.priority,function(){ou(I)});return}}else if(x===3&&I.stateNode.current.memoizedState.isDehydrated){g.blockedOn=I.tag===3?I.stateNode.containerInfo:null;return}}}g.blockedOn=null}function au(g){if(g.blockedOn!==null)return!1;for(var x=g.targetContainers;0<x.length;){var I=cu(g.domEventName,g.eventSystemFlags,x[0],g.nativeEvent);if(I===null){I=g.nativeEvent;var F=new I.constructor(I.type,I);ii=F,I.target.dispatchEvent(F),ii=null}else return x=hh(I),x!==null&&Yu(x),g.blockedOn=I,!1;x.shift()}return!0}function su(g,x,I){au(g)&&I.delete(x)}function lu(){jh=!1,Ba!==null&&au(Ba)&&(Ba=null),ps!==null&&au(ps)&&(ps=null),ns!==null&&au(ns)&&(ns=null),qc.forEach(su),Gc.forEach(su)}function Tl(g,x){g.blockedOn===x&&(g.blockedOn=null,jh||(jh=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,lu)))}function Hc(g){function x(G){return Tl(G,g)}if(0<Go.length){Tl(Go[0],g);for(var I=1;I<Go.length;I++){var F=Go[I];F.blockedOn===g&&(F.blockedOn=null)}}for(Ba!==null&&Tl(Ba,g),ps!==null&&Tl(ps,g),ns!==null&&Tl(ns,g),qc.forEach(x),Gc.forEach(x),I=0;I<ms.length;I++)F=ms[I],F.blockedOn===g&&(F.blockedOn=null);for(;0<ms.length&&(I=ms[0],I.blockedOn===null);)wm(I),I.blockedOn===null&&ms.shift()}var El=ke.ReactCurrentBatchConfig,$h=!0;function Wc(g,x,I,F){var G=oi,Q=El.transition;El.transition=null;try{oi=1,ed(g,x,I,F)}finally{oi=G,El.transition=Q}}function Qu(g,x,I,F){var G=oi,Q=El.transition;El.transition=null;try{oi=4,ed(g,x,I,F)}finally{oi=G,El.transition=Q}}function ed(g,x,I,F){if($h){var G=cu(g,x,I,F);if(G===null)hd(g,x,F,uu,I),Uh(g,F);else if(Vh(G,g,x,I,F))F.stopPropagation();else if(Uh(g,F),x&4&&-1<bn.indexOf(g)){for(;G!==null;){var Q=hh(G);if(Q!==null&&Os(Q),Q=cu(g,x,I,F),Q===null&&hd(g,x,F,uu,I),Q===G)break;G=Q}G!==null&&F.stopPropagation()}else hd(g,x,F,null,I)}}var uu=null;function cu(g,x,I,F){if(uu=null,g=Gu(F),g=cc(g),g!==null)if(x=mt(g),x===null)g=null;else if(I=x.tag,I===13){if(g=vr(x),g!==null)return g;g=null}else if(I===3){if(x.stateNode.current.memoizedState.isDehydrated)return x.tag===3?x.stateNode.containerInfo:null;g=null}else x!==g&&(g=null);return uu=g,null}function al(g){switch(g){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(to()){case qn:return 1;case kn:return 4;case bi:case Ti:return 16;case gi:return 536870912;default:return 16}default:return 16}}var Io=null,qh=null,Zc=null;function hu(){if(Zc)return Zc;var g,x=qh,I=x.length,F,G="value"in Io?Io.value:Io.textContent,Q=G.length;for(g=0;g<I&&x[g]===G[g];g++);var we=I-g;for(F=1;F<=we&&x[I-F]===G[Q-F];F++);return Zc=G.slice(g,1<F?1-F:void 0)}function ea(g){var x=g.keyCode;return"charCode"in g?(g=g.charCode,g===0&&x===13&&(g=13)):g=x,g===10&&(g=13),32<=g||g===13?g:0}function Xc(){return!0}function Gh(){return!1}function Aa(g){function x(I,F,G,Q,we){this._reactName=I,this._targetInst=G,this.type=F,this.nativeEvent=Q,this.target=we,this.currentTarget=null;for(var Ze in g)g.hasOwnProperty(Ze)&&(I=g[Ze],this[Ze]=I?I(Q):Q[Ze]);return this.isDefaultPrevented=(Q.defaultPrevented!=null?Q.defaultPrevented:Q.returnValue===!1)?Xc:Gh,this.isPropagationStopped=Gh,this}return Zt(x.prototype,{preventDefault:function(){this.defaultPrevented=!0;var I=this.nativeEvent;I&&(I.preventDefault?I.preventDefault():typeof I.returnValue!="unknown"&&(I.returnValue=!1),this.isDefaultPrevented=Xc)},stopPropagation:function(){var I=this.nativeEvent;I&&(I.stopPropagation?I.stopPropagation():typeof I.cancelBubble!="unknown"&&(I.cancelBubble=!0),this.isPropagationStopped=Xc)},persist:function(){},isPersistent:Xc}),x}var wn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(g){return g.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ec=Aa(wn),sl=Zt({},wn,{view:0,detail:0}),Sm=Aa(sl),wr,td,Al,ll=Zt({},sl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fu,button:0,buttons:0,relatedTarget:function(g){return g.relatedTarget===void 0?g.fromElement===g.srcElement?g.toElement:g.fromElement:g.relatedTarget},movementX:function(g){return"movementX"in g?g.movementX:(g!==Al&&(Al&&g.type==="mousemove"?(wr=g.screenX-Al.screenX,td=g.screenY-Al.screenY):td=wr=0,Al=g),wr)},movementY:function(g){return"movementY"in g?g.movementY:td}}),Na=Aa(ll),gp=Zt({},ll,{dataTransfer:0}),Kc=Aa(gp),yr=Zt({},sl,{relatedTarget:0}),Dn=Aa(yr),Fn=Zt({},wn,{animationName:0,elapsedTime:0,pseudoElement:0}),ja=Aa(Fn),Pl=Zt({},wn,{clipboardData:function(g){return"clipboardData"in g?g.clipboardData:window.clipboardData}}),Nn=Aa(Pl),rd=Zt({},wn,{data:0}),Yc=Aa(rd),Hh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ta={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},no={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Kg(g){var x=this.nativeEvent;return x.getModifierState?x.getModifierState(g):(g=no[g])?!!x[g]:!1}function fu(){return Kg}var du=Zt({},sl,{key:function(g){if(g.key){var x=Hh[g.key]||g.key;if(x!=="Unidentified")return x}return g.type==="keypress"?(g=ea(g),g===13?"Enter":String.fromCharCode(g)):g.type==="keydown"||g.type==="keyup"?ta[g.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fu,charCode:function(g){return g.type==="keypress"?ea(g):0},keyCode:function(g){return g.type==="keydown"||g.type==="keyup"?g.keyCode:0},which:function(g){return g.type==="keypress"?ea(g):g.type==="keydown"||g.type==="keyup"?g.keyCode:0}}),Wh=Aa(du),nd=Zt({},ll,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Jc=Aa(nd),id=Zt({},sl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fu}),ca=Aa(id),Il=Zt({},wn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Pa=Aa(Il),tc=Zt({},ll,{deltaX:function(g){return"deltaX"in g?g.deltaX:"wheelDeltaX"in g?-g.wheelDeltaX:0},deltaY:function(g){return"deltaY"in g?g.deltaY:"wheelDeltaY"in g?-g.wheelDeltaY:"wheelDelta"in g?-g.wheelDelta:0},deltaZ:0,deltaMode:0}),Wr=Aa(tc),Qt=[9,13,27,32],Ua=a&&"CompositionEvent"in window,Ar=null;a&&"documentMode"in document&&(Ar=document.documentMode);var Yi=a&&"TextEvent"in window&&!Ar,Qc=a&&(!Ua||Ar&&8<Ar&&11>=Ar),Sr=" ",rc=!1;function nc(g,x){switch(g){case"keyup":return Qt.indexOf(x.keyCode)!==-1;case"keydown":return x.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Cl(g){return g=g.detail,typeof g=="object"&&"data"in g?g.data:null}var ic=!1;function gs(g,x){switch(g){case"compositionend":return Cl(x);case"keypress":return x.which!==32?null:(rc=!0,Sr);case"textInput":return g=x.data,g===Sr&&rc?null:g;default:return null}}function ha(g,x){if(ic)return g==="compositionend"||!Ua&&nc(g,x)?(g=hu(),Zc=qh=Io=null,ic=!1,g):null;switch(g){case"paste":return null;case"keypress":if(!(x.ctrlKey||x.altKey||x.metaKey)||x.ctrlKey&&x.altKey){if(x.char&&1<x.char.length)return x.char;if(x.which)return String.fromCharCode(x.which)}return null;case"compositionend":return Qc&&x.locale!=="ko"?null:x.data;default:return null}}var Zh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xo(g){var x=g&&g.nodeName&&g.nodeName.toLowerCase();return x==="input"?!!Zh[g.type]:x==="textarea"}function od(g,x,I,F){Wu(F),x=uc(x,"onChange"),0<x.length&&(I=new ec("onChange","change",null,I,F),g.push({event:I,listeners:x}))}var Va=null,bo=null;function Xh(g){bp(g,0)}function ad(g){var x=bu(g);if(sr(x))return g}function Yg(g,x){if(g==="change")return x}var Ml=!1;if(a){var pu;if(a){var Ol="oninput"in document;if(!Ol){var oc=document.createElement("div");oc.setAttribute("oninput","return;"),Ol=typeof oc.oninput=="function"}pu=Ol}else pu=!1;Ml=pu&&(!document.documentMode||9<document.documentMode)}function _p(){Va&&(Va.detachEvent("onpropertychange",Kh),bo=Va=null)}function Kh(g){if(g.propertyName==="value"&&ad(bo)){var x=[];od(x,bo,g,Gu(g)),Cn(Xh,x)}}function yp(g,x,I){g==="focusin"?(_p(),Va=x,bo=I,Va.attachEvent("onpropertychange",Kh)):g==="focusout"&&_p()}function mu(g){if(g==="selectionchange"||g==="keyup"||g==="keydown")return ad(bo)}function Jg(g,x){if(g==="click")return ad(x)}function Tm(g,x){if(g==="input"||g==="change")return ad(x)}function Qg(g,x){return g===x&&(g!==0||1/g===1/x)||g!==g&&x!==x}var _s=typeof Object.is=="function"?Object.is:Qg;function eh(g,x){if(_s(g,x))return!0;if(typeof g!="object"||g===null||typeof x!="object"||x===null)return!1;var I=Object.keys(g),F=Object.keys(x);if(I.length!==F.length)return!1;for(F=0;F<I.length;F++){var G=I[F];if(!R.call(x,G)||!_s(g[G],x[G]))return!1}return!0}function sd(g){for(;g&&g.firstChild;)g=g.firstChild;return g}function Rl(g,x){var I=sd(g);g=0;for(var F;I;){if(I.nodeType===3){if(F=g+I.textContent.length,g<=x&&F>=x)return{node:I,offset:x-g};g=F}e:{for(;I;){if(I.nextSibling){I=I.nextSibling;break e}I=I.parentNode}I=void 0}I=sd(I)}}function vp(g,x){return g&&x?g===x?!0:g&&g.nodeType===3?!1:x&&x.nodeType===3?vp(g,x.parentNode):"contains"in g?g.contains(x):g.compareDocumentPosition?!!(g.compareDocumentPosition(x)&16):!1:!1}function xp(){for(var g=window,x=Pi();x instanceof g.HTMLIFrameElement;){try{var I=typeof x.contentWindow.location.href=="string"}catch{I=!1}if(I)g=x.contentWindow;else break;x=Pi(g.document)}return x}function th(g){var x=g&&g.nodeName&&g.nodeName.toLowerCase();return x&&(x==="input"&&(g.type==="text"||g.type==="search"||g.type==="tel"||g.type==="url"||g.type==="password")||x==="textarea"||g.contentEditable==="true")}function gu(g){var x=xp(),I=g.focusedElem,F=g.selectionRange;if(x!==I&&I&&I.ownerDocument&&vp(I.ownerDocument.documentElement,I)){if(F!==null&&th(I)){if(x=F.start,g=F.end,g===void 0&&(g=x),"selectionStart"in I)I.selectionStart=x,I.selectionEnd=Math.min(g,I.value.length);else if(g=(x=I.ownerDocument||document)&&x.defaultView||window,g.getSelection){g=g.getSelection();var G=I.textContent.length,Q=Math.min(F.start,G);F=F.end===void 0?Q:Math.min(F.end,G),!g.extend&&Q>F&&(G=F,F=Q,Q=G),G=Rl(I,Q);var we=Rl(I,F);G&&we&&(g.rangeCount!==1||g.anchorNode!==G.node||g.anchorOffset!==G.offset||g.focusNode!==we.node||g.focusOffset!==we.offset)&&(x=x.createRange(),x.setStart(G.node,G.offset),g.removeAllRanges(),Q>F?(g.addRange(x),g.extend(we.node,we.offset)):(x.setEnd(we.node,we.offset),g.addRange(x)))}}for(x=[],g=I;g=g.parentNode;)g.nodeType===1&&x.push({element:g,left:g.scrollLeft,top:g.scrollTop});for(typeof I.focus=="function"&&I.focus(),I=0;I<x.length;I++)g=x[I],g.element.scrollLeft=g.left,g.element.scrollTop=g.top}}var Yh=a&&"documentMode"in document&&11>=document.documentMode,ra=null,Jh=null,ul=null,_u=!1;function ld(g,x,I){var F=I.window===I?I.document:I.nodeType===9?I:I.ownerDocument;_u||ra==null||ra!==Pi(F)||(F=ra,"selectionStart"in F&&th(F)?F={start:F.selectionStart,end:F.selectionEnd}:(F=(F.ownerDocument&&F.ownerDocument.defaultView||window).getSelection(),F={anchorNode:F.anchorNode,anchorOffset:F.anchorOffset,focusNode:F.focusNode,focusOffset:F.focusOffset}),ul&&eh(ul,F)||(ul=F,F=uc(Jh,"onSelect"),0<F.length&&(x=new ec("onSelect","select",null,x,I),g.push({event:x,listeners:F}),x.target=ra)))}function ac(g,x){var I={};return I[g.toLowerCase()]=x.toLowerCase(),I["Webkit"+g]="webkit"+x,I["Moz"+g]="moz"+x,I}var Ho={animationend:ac("Animation","AnimationEnd"),animationiteration:ac("Animation","AnimationIteration"),animationstart:ac("Animation","AnimationStart"),transitionend:ac("Transition","TransitionEnd")},rh={},$t={};a&&($t=document.createElement("div").style,"AnimationEvent"in window||(delete Ho.animationend.animation,delete Ho.animationiteration.animation,delete Ho.animationstart.animation),"TransitionEvent"in window||delete Ho.transitionend.transition);function nh(g){if(rh[g])return rh[g];if(!Ho[g])return g;var x=Ho[g],I;for(I in x)if(x.hasOwnProperty(I)&&I in $t)return rh[g]=x[I];return g}var Qh=nh("animationend"),ef=nh("animationiteration"),ih=nh("animationstart"),yu=nh("transitionend"),is=new Map,tf="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ia(g,x){is.set(g,x),w(x,[g])}for(var sc=0;sc<tf.length;sc++){var os=tf[sc],gn=os.toLowerCase(),e_=os[0].toUpperCase()+os.slice(1);Ia(gn,"on"+e_)}Ia(Qh,"onAnimationEnd"),Ia(ef,"onAnimationIteration"),Ia(ih,"onAnimationStart"),Ia("dblclick","onDoubleClick"),Ia("focusin","onFocus"),Ia("focusout","onBlur"),Ia(yu,"onTransitionEnd"),P("onMouseEnter",["mouseout","mouseover"]),P("onMouseLeave",["mouseout","mouseover"]),P("onPointerEnter",["pointerout","pointerover"]),P("onPointerLeave",["pointerout","pointerover"]),w("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),w("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),w("onBeforeInput",["compositionend","keypress","textInput","paste"]),w("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),w("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),w("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),t_=new Set("cancel close invalid load scroll toggle".split(" ").concat(lc));function ud(g,x,I){var F=g.type||"unknown-event";g.currentTarget=I,Nt(F,x,void 0,g),g.currentTarget=null}function bp(g,x){x=(x&4)!==0;for(var I=0;I<g.length;I++){var F=g[I],G=F.event;F=F.listeners;e:{var Q=void 0;if(x)for(var we=F.length-1;0<=we;we--){var Ze=F[we],it=Ze.instance,qt=Ze.currentTarget;if(Ze=Ze.listener,it!==Q&&G.isPropagationStopped())break e;ud(G,Ze,qt),Q=it}else for(we=0;we<F.length;we++){if(Ze=F[we],it=Ze.instance,qt=Ze.currentTarget,Ze=Ze.listener,it!==Q&&G.isPropagationStopped())break e;ud(G,Ze,qt),Q=it}}}if(Fe)throw g=et,Fe=!1,et=null,g}function un(g,x){var I=x[xu];I===void 0&&(I=x[xu]=new Set);var F=g+"__bubble";I.has(F)||(Em(x,g,2,!1),I.add(F))}function wp(g,x,I){var F=0;x&&(F|=4),Em(I,g,F,x)}var cd="_reactListening"+Math.random().toString(36).slice(2);function rf(g){if(!g[cd]){g[cd]=!0,c.forEach(function(I){I!=="selectionchange"&&(t_.has(I)||wp(I,!1,g),wp(I,!0,g))});var x=g.nodeType===9?g:g.ownerDocument;x===null||x[cd]||(x[cd]=!0,wp("selectionchange",!1,x))}}function Em(g,x,I,F){switch(al(x)){case 1:var G=Wc;break;case 4:G=Qu;break;default:G=ed}I=G.bind(null,x,I,g),G=void 0,!re||x!=="touchstart"&&x!=="touchmove"&&x!=="wheel"||(G=!0),F?G!==void 0?g.addEventListener(x,I,{capture:!0,passive:G}):g.addEventListener(x,I,!0):G!==void 0?g.addEventListener(x,I,{passive:G}):g.addEventListener(x,I,!1)}function hd(g,x,I,F,G){var Q=F;if((x&1)===0&&(x&2)===0&&F!==null)e:for(;;){if(F===null)return;var we=F.tag;if(we===3||we===4){var Ze=F.stateNode.containerInfo;if(Ze===G||Ze.nodeType===8&&Ze.parentNode===G)break;if(we===4)for(we=F.return;we!==null;){var it=we.tag;if((it===3||it===4)&&(it=we.stateNode.containerInfo,it===G||it.nodeType===8&&it.parentNode===G))return;we=we.return}for(;Ze!==null;){if(we=cc(Ze),we===null)return;if(it=we.tag,it===5||it===6){F=Q=we;continue e}Ze=Ze.parentNode}}F=F.return}Cn(function(){var qt=Q,mr=Gu(I),xr=[];e:{var _r=is.get(g);if(_r!==void 0){var $r=ec,Kr=g;switch(g){case"keypress":if(ea(I)===0)break e;case"keydown":case"keyup":$r=Wh;break;case"focusin":Kr="focus",$r=Dn;break;case"focusout":Kr="blur",$r=Dn;break;case"beforeblur":case"afterblur":$r=Dn;break;case"click":if(I.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$r=Na;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$r=Kc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$r=ca;break;case Qh:case ef:case ih:$r=ja;break;case yu:$r=Pa;break;case"scroll":$r=Sm;break;case"wheel":$r=Wr;break;case"copy":case"cut":case"paste":$r=Nn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$r=Jc}var Qr=(x&4)!==0,Do=!Qr&&g==="scroll",Et=Qr?_r!==null?_r+"Capture":null:_r;Qr=[];for(var ht=qt,Lt;ht!==null;){Lt=ht;var Tr=Lt.stateNode;if(Lt.tag===5&&Tr!==null&&(Lt=Tr,Et!==null&&(Tr=Ke(ht,Et),Tr!=null&&Qr.push(nf(ht,Tr,Lt)))),Do)break;ht=ht.return}0<Qr.length&&(_r=new $r(_r,Kr,null,I,mr),xr.push({event:_r,listeners:Qr}))}}if((x&7)===0){e:{if(_r=g==="mouseover"||g==="pointerover",$r=g==="mouseout"||g==="pointerout",_r&&I!==ii&&(Kr=I.relatedTarget||I.fromElement)&&(cc(Kr)||Kr[dl]))break e;if(($r||_r)&&(_r=mr.window===mr?mr:(_r=mr.ownerDocument)?_r.defaultView||_r.parentWindow:window,$r?(Kr=I.relatedTarget||I.toElement,$r=qt,Kr=Kr?cc(Kr):null,Kr!==null&&(Do=mt(Kr),Kr!==Do||Kr.tag!==5&&Kr.tag!==6)&&(Kr=null)):($r=null,Kr=qt),$r!==Kr)){if(Qr=Na,Tr="onMouseLeave",Et="onMouseEnter",ht="mouse",(g==="pointerout"||g==="pointerover")&&(Qr=Jc,Tr="onPointerLeave",Et="onPointerEnter",ht="pointer"),Do=$r==null?_r:bu($r),Lt=Kr==null?_r:bu(Kr),_r=new Qr(Tr,ht+"leave",$r,I,mr),_r.target=Do,_r.relatedTarget=Lt,Tr=null,cc(mr)===qt&&(Qr=new Qr(Et,ht+"enter",Kr,I,mr),Qr.target=Lt,Qr.relatedTarget=Do,Tr=Qr),Do=Tr,$r&&Kr)t:{for(Qr=$r,Et=Kr,ht=0,Lt=Qr;Lt;Lt=oh(Lt))ht++;for(Lt=0,Tr=Et;Tr;Tr=oh(Tr))Lt++;for(;0<ht-Lt;)Qr=oh(Qr),ht--;for(;0<Lt-ht;)Et=oh(Et),Lt--;for(;ht--;){if(Qr===Et||Et!==null&&Qr===Et.alternate)break t;Qr=oh(Qr),Et=oh(Et)}Qr=null}else Qr=null;$r!==null&&Sp(xr,_r,$r,Qr,!1),Kr!==null&&Do!==null&&Sp(xr,Do,Kr,Qr,!0)}}e:{if(_r=qt?bu(qt):window,$r=_r.nodeName&&_r.nodeName.toLowerCase(),$r==="select"||$r==="input"&&_r.type==="file")var sn=Yg;else if(xo(_r))if(Ml)sn=Tm;else{sn=mu;var En=yp}else($r=_r.nodeName)&&$r.toLowerCase()==="input"&&(_r.type==="checkbox"||_r.type==="radio")&&(sn=Jg);if(sn&&(sn=sn(g,qt))){od(xr,sn,I,mr);break e}En&&En(g,_r,qt),g==="focusout"&&(En=_r._wrapperState)&&En.controlled&&_r.type==="number"&&$o(_r,"number",_r.value)}switch(En=qt?bu(qt):window,g){case"focusin":(xo(En)||En.contentEditable==="true")&&(ra=En,Jh=qt,ul=null);break;case"focusout":ul=Jh=ra=null;break;case"mousedown":_u=!0;break;case"contextmenu":case"mouseup":case"dragend":_u=!1,ld(xr,I,mr);break;case"selectionchange":if(Yh)break;case"keydown":case"keyup":ld(xr,I,mr)}var An;if(Ua)e:{switch(g){case"compositionstart":var jn="onCompositionStart";break e;case"compositionend":jn="onCompositionEnd";break e;case"compositionupdate":jn="onCompositionUpdate";break e}jn=void 0}else ic?nc(g,I)&&(jn="onCompositionEnd"):g==="keydown"&&I.keyCode===229&&(jn="onCompositionStart");jn&&(Qc&&I.locale!=="ko"&&(ic||jn!=="onCompositionStart"?jn==="onCompositionEnd"&&ic&&(An=hu()):(Io=mr,qh="value"in Io?Io.value:Io.textContent,ic=!0)),En=uc(qt,jn),0<En.length&&(jn=new Yc(jn,g,null,I,mr),xr.push({event:jn,listeners:En}),An?jn.data=An:(An=Cl(I),An!==null&&(jn.data=An)))),(An=Yi?gs(g,I):ha(g,I))&&(qt=uc(qt,"onBeforeInput"),0<qt.length&&(mr=new Yc("onBeforeInput","beforeinput",null,I,mr),xr.push({event:mr,listeners:qt}),mr.data=An))}bp(xr,x)})}function nf(g,x,I){return{instance:g,listener:x,currentTarget:I}}function uc(g,x){for(var I=x+"Capture",F=[];g!==null;){var G=g,Q=G.stateNode;G.tag===5&&Q!==null&&(G=Q,Q=Ke(g,I),Q!=null&&F.unshift(nf(g,Q,G)),Q=Ke(g,x),Q!=null&&F.push(nf(g,Q,G))),g=g.return}return F}function oh(g){if(g===null)return null;do g=g.return;while(g&&g.tag!==5);return g||null}function Sp(g,x,I,F,G){for(var Q=x._reactName,we=[];I!==null&&I!==F;){var Ze=I,it=Ze.alternate,qt=Ze.stateNode;if(it!==null&&it===F)break;Ze.tag===5&&qt!==null&&(Ze=qt,G?(it=Ke(I,Q),it!=null&&we.unshift(nf(I,it,Ze))):G||(it=Ke(I,Q),it!=null&&we.push(nf(I,it,Ze)))),I=I.return}we.length!==0&&g.push({event:x,listeners:we})}var Tp=/\r\n?/g,fd=/\u0000|\uFFFD/g;function dd(g){return(typeof g=="string"?g:""+g).replace(Tp,`
`).replace(fd,"")}function cl(g,x,I){if(x=dd(x),dd(g)!==x&&I)throw Error(l(425))}function kl(){}var ah=null,sh=null;function vu(g,x){return g==="textarea"||g==="noscript"||typeof x.children=="string"||typeof x.children=="number"||typeof x.dangerouslySetInnerHTML=="object"&&x.dangerouslySetInnerHTML!==null&&x.dangerouslySetInnerHTML.__html!=null}var pd=typeof setTimeout=="function"?setTimeout:void 0,Ep=typeof clearTimeout=="function"?clearTimeout:void 0,Ap=typeof Promise=="function"?Promise:void 0,lh=typeof queueMicrotask=="function"?queueMicrotask:typeof Ap<"u"?function(g){return Ap.resolve(null).then(g).catch(md)}:pd;function md(g){setTimeout(function(){throw g})}function uh(g,x){var I=x,F=0;do{var G=I.nextSibling;if(g.removeChild(I),G&&G.nodeType===8)if(I=G.data,I==="/$"){if(F===0){g.removeChild(G),Hc(x);return}F--}else I!=="$"&&I!=="$?"&&I!=="$!"||F++;I=G}while(I);Hc(x)}function hl(g){for(;g!=null;g=g.nextSibling){var x=g.nodeType;if(x===1||x===3)break;if(x===8){if(x=g.data,x==="$"||x==="$!"||x==="$?")break;if(x==="/$")return null}}return g}function of(g){g=g.previousSibling;for(var x=0;g;){if(g.nodeType===8){var I=g.data;if(I==="$"||I==="$!"||I==="$?"){if(x===0)return g;x--}else I==="/$"&&x++}g=g.previousSibling}return null}var fl=Math.random().toString(36).slice(2),Rs="__reactFiber$"+fl,ch="__reactProps$"+fl,dl="__reactContainer$"+fl,xu="__reactEvents$"+fl,Am="__reactListeners$"+fl,Pp="__reactHandles$"+fl;function cc(g){var x=g[Rs];if(x)return x;for(var I=g.parentNode;I;){if(x=I[dl]||I[Rs]){if(I=x.alternate,x.child!==null||I!==null&&I.child!==null)for(g=of(g);g!==null;){if(I=g[Rs])return I;g=of(g)}return x}g=I,I=g.parentNode}return null}function hh(g){return g=g[Rs]||g[dl],!g||g.tag!==5&&g.tag!==6&&g.tag!==13&&g.tag!==3?null:g}function bu(g){if(g.tag===5||g.tag===6)return g.stateNode;throw Error(l(33))}function fh(g){return g[ch]||null}var af=[],Dl=-1;function pl(g){return{current:g}}function Ii(g){0>Dl||(g.current=af[Dl],af[Dl]=null,Dl--)}function Vi(g,x){Dl++,af[Dl]=g.current,g.current=x}var as={},Co=pl(as),na=pl(!1),wo=as;function wu(g,x){var I=g.type.contextTypes;if(!I)return as;var F=g.stateNode;if(F&&F.__reactInternalMemoizedUnmaskedChildContext===x)return F.__reactInternalMemoizedMaskedChildContext;var G={},Q;for(Q in I)G[Q]=x[Q];return F&&(g=g.stateNode,g.__reactInternalMemoizedUnmaskedChildContext=x,g.__reactInternalMemoizedMaskedChildContext=G),G}function ia(g){return g=g.childContextTypes,g!=null}function Su(){Ii(na),Ii(Co)}function sf(g,x,I){if(Co.current!==as)throw Error(l(168));Vi(Co,x),Vi(na,I)}function gd(g,x,I){var F=g.stateNode;if(x=x.childContextTypes,typeof F.getChildContext!="function")return I;F=F.getChildContext();for(var G in F)if(!(G in x))throw Error(l(108,Lr(g)||"Unknown",G));return Zt({},I,F)}function dh(g){return g=(g=g.stateNode)&&g.__reactInternalMemoizedMergedChildContext||as,wo=Co.current,Vi(Co,g),Vi(na,na.current),!0}function lf(g,x,I){var F=g.stateNode;if(!F)throw Error(l(169));I?(g=gd(g,x,wo),F.__reactInternalMemoizedMergedChildContext=g,Ii(na),Ii(Co),Vi(Co,g)):Ii(na),Vi(na,I)}var ys=null,hc=!1,zl=!1;function _d(g){ys===null?ys=[g]:ys.push(g)}function Ip(g){hc=!0,_d(g)}function Ll(){if(!zl&&ys!==null){zl=!0;var g=0,x=oi;try{var I=ys;for(oi=1;g<I.length;g++){var F=I[g];do F=F(!0);while(F!==null)}ys=null,hc=!1}catch(G){throw ys!==null&&(ys=ys.slice(g+1)),cn(qn,Ll),G}finally{oi=x,zl=!1}}return null}var ks=[],fc=0,uf=null,yd=0,vs=[],xs=0,ml=null,Ds=1,zs="";function Tu(g,x){ks[fc++]=yd,ks[fc++]=uf,uf=g,yd=x}function dc(g,x,I){vs[xs++]=Ds,vs[xs++]=zs,vs[xs++]=ml,ml=g;var F=Ds;g=zs;var G=32-Ta(F)-1;F&=~(1<<G),I+=1;var Q=32-Ta(x)+G;if(30<Q){var we=G-G%5;Q=(F&(1<<we)-1).toString(32),F>>=we,G-=we,Ds=1<<32-Ta(x)+G|I<<G|F,zs=Q+g}else Ds=1<<Q|I<<G|F,zs=g}function cf(g){g.return!==null&&(Tu(g,1),dc(g,1,0))}function vd(g){for(;g===uf;)uf=ks[--fc],ks[fc]=null,yd=ks[--fc],ks[fc]=null;for(;g===ml;)ml=vs[--xs],vs[xs]=null,zs=vs[--xs],vs[xs]=null,Ds=vs[--xs],vs[xs]=null}var $a=null,fa=null,Ci=!1,ss=null;function Fl(g,x){var I=ti(5,null,null,0);I.elementType="DELETED",I.stateNode=x,I.return=g,x=g.deletions,x===null?(g.deletions=[I],g.flags|=16):x.push(I)}function Bl(g,x){switch(g.tag){case 5:var I=g.type;return x=x.nodeType!==1||I.toLowerCase()!==x.nodeName.toLowerCase()?null:x,x!==null?(g.stateNode=x,$a=g,fa=hl(x.firstChild),!0):!1;case 6:return x=g.pendingProps===""||x.nodeType!==3?null:x,x!==null?(g.stateNode=x,$a=g,fa=null,!0):!1;case 13:return x=x.nodeType!==8?null:x,x!==null?(I=ml!==null?{id:Ds,overflow:zs}:null,g.memoizedState={dehydrated:x,treeContext:I,retryLane:1073741824},I=ti(18,null,null,0),I.stateNode=x,I.return=g,g.child=I,$a=g,fa=null,!0):!1;default:return!1}}function ph(g){return(g.mode&1)!==0&&(g.flags&128)===0}function xd(g){if(Ci){var x=fa;if(x){var I=x;if(!Bl(g,x)){if(ph(g))throw Error(l(418));x=hl(I.nextSibling);var F=$a;x&&Bl(g,x)?Fl(F,I):(g.flags=g.flags&-4097|2,Ci=!1,$a=g)}}else{if(ph(g))throw Error(l(418));g.flags=g.flags&-4097|2,Ci=!1,$a=g}}}function Cp(g){for(g=g.return;g!==null&&g.tag!==5&&g.tag!==3&&g.tag!==13;)g=g.return;$a=g}function pc(g){if(g!==$a)return!1;if(!Ci)return Cp(g),Ci=!0,!1;var x;if((x=g.tag!==3)&&!(x=g.tag!==5)&&(x=g.type,x=x!=="head"&&x!=="body"&&!vu(g.type,g.memoizedProps)),x&&(x=fa)){if(ph(g))throw hf(),Error(l(418));for(;x;)Fl(g,x),x=hl(x.nextSibling)}if(Cp(g),g.tag===13){if(g=g.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(l(317));e:{for(g=g.nextSibling,x=0;g;){if(g.nodeType===8){var I=g.data;if(I==="/$"){if(x===0){fa=hl(g.nextSibling);break e}x--}else I!=="$"&&I!=="$!"&&I!=="$?"||x++}g=g.nextSibling}fa=null}}else fa=$a?hl(g.stateNode.nextSibling):null;return!0}function hf(){for(var g=fa;g;)g=hl(g.nextSibling)}function mc(){fa=$a=null,Ci=!1}function ff(g){ss===null?ss=[g]:ss.push(g)}var gc=ke.ReactCurrentBatchConfig;function _c(g,x,I){if(g=I.ref,g!==null&&typeof g!="function"&&typeof g!="object"){if(I._owner){if(I=I._owner,I){if(I.tag!==1)throw Error(l(309));var F=I.stateNode}if(!F)throw Error(l(147,g));var G=F,Q=""+g;return x!==null&&x.ref!==null&&typeof x.ref=="function"&&x.ref._stringRef===Q?x.ref:(x=function(we){var Ze=G.refs;we===null?delete Ze[Q]:Ze[Q]=we},x._stringRef=Q,x)}if(typeof g!="string")throw Error(l(284));if(!I._owner)throw Error(l(290,g))}return g}function df(g,x){throw g=Object.prototype.toString.call(x),Error(l(31,g==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":g))}function Mp(g){var x=g._init;return x(g._payload)}function Nl(g){function x(Et,ht){if(g){var Lt=Et.deletions;Lt===null?(Et.deletions=[ht],Et.flags|=16):Lt.push(ht)}}function I(Et,ht){if(!g)return null;for(;ht!==null;)x(Et,ht),ht=ht.sibling;return null}function F(Et,ht){for(Et=new Map;ht!==null;)ht.key!==null?Et.set(ht.key,ht):Et.set(ht.index,ht),ht=ht.sibling;return Et}function G(Et,ht){return Et=Xo(Et,ht),Et.index=0,Et.sibling=null,Et}function Q(Et,ht,Lt){return Et.index=Lt,g?(Lt=Et.alternate,Lt!==null?(Lt=Lt.index,Lt<ht?(Et.flags|=2,ht):Lt):(Et.flags|=2,ht)):(Et.flags|=1048576,ht)}function we(Et){return g&&Et.alternate===null&&(Et.flags|=2),Et}function Ze(Et,ht,Lt,Tr){return ht===null||ht.tag!==6?(ht=Ma(Lt,Et.mode,Tr),ht.return=Et,ht):(ht=G(ht,Lt),ht.return=Et,ht)}function it(Et,ht,Lt,Tr){var sn=Lt.type;return sn===ze?mr(Et,ht,Lt.props.children,Tr,Lt.key):ht!==null&&(ht.elementType===sn||typeof sn=="object"&&sn!==null&&sn.$$typeof===Tt&&Mp(sn)===ht.type)?(Tr=G(ht,Lt.props),Tr.ref=_c(Et,ht,Lt),Tr.return=Et,Tr):(Tr=Uo(Lt.type,Lt.key,Lt.props,null,Et.mode,Tr),Tr.ref=_c(Et,ht,Lt),Tr.return=Et,Tr)}function qt(Et,ht,Lt,Tr){return ht===null||ht.tag!==4||ht.stateNode.containerInfo!==Lt.containerInfo||ht.stateNode.implementation!==Lt.implementation?(ht=Za(Lt,Et.mode,Tr),ht.return=Et,ht):(ht=G(ht,Lt.children||[]),ht.return=Et,ht)}function mr(Et,ht,Lt,Tr,sn){return ht===null||ht.tag!==7?(ht=ko(Lt,Et.mode,Tr,sn),ht.return=Et,ht):(ht=G(ht,Lt),ht.return=Et,ht)}function xr(Et,ht,Lt){if(typeof ht=="string"&&ht!==""||typeof ht=="number")return ht=Ma(""+ht,Et.mode,Lt),ht.return=Et,ht;if(typeof ht=="object"&&ht!==null){switch(ht.$$typeof){case he:return Lt=Uo(ht.type,ht.key,ht.props,null,Et.mode,Lt),Lt.ref=_c(Et,null,ht),Lt.return=Et,Lt;case _e:return ht=Za(ht,Et.mode,Lt),ht.return=Et,ht;case Tt:var Tr=ht._init;return xr(Et,Tr(ht._payload),Lt)}if(fo(ht)||Wt(ht))return ht=ko(ht,Et.mode,Lt,null),ht.return=Et,ht;df(Et,ht)}return null}function _r(Et,ht,Lt,Tr){var sn=ht!==null?ht.key:null;if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number")return sn!==null?null:Ze(Et,ht,""+Lt,Tr);if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case he:return Lt.key===sn?it(Et,ht,Lt,Tr):null;case _e:return Lt.key===sn?qt(Et,ht,Lt,Tr):null;case Tt:return sn=Lt._init,_r(Et,ht,sn(Lt._payload),Tr)}if(fo(Lt)||Wt(Lt))return sn!==null?null:mr(Et,ht,Lt,Tr,null);df(Et,Lt)}return null}function $r(Et,ht,Lt,Tr,sn){if(typeof Tr=="string"&&Tr!==""||typeof Tr=="number")return Et=Et.get(Lt)||null,Ze(ht,Et,""+Tr,sn);if(typeof Tr=="object"&&Tr!==null){switch(Tr.$$typeof){case he:return Et=Et.get(Tr.key===null?Lt:Tr.key)||null,it(ht,Et,Tr,sn);case _e:return Et=Et.get(Tr.key===null?Lt:Tr.key)||null,qt(ht,Et,Tr,sn);case Tt:var En=Tr._init;return $r(Et,ht,Lt,En(Tr._payload),sn)}if(fo(Tr)||Wt(Tr))return Et=Et.get(Lt)||null,mr(ht,Et,Tr,sn,null);df(ht,Tr)}return null}function Kr(Et,ht,Lt,Tr){for(var sn=null,En=null,An=ht,jn=ht=0,aa=null;An!==null&&jn<Lt.length;jn++){An.index>jn?(aa=An,An=null):aa=An.sibling;var Ri=_r(Et,An,Lt[jn],Tr);if(Ri===null){An===null&&(An=aa);break}g&&An&&Ri.alternate===null&&x(Et,An),ht=Q(Ri,ht,jn),En===null?sn=Ri:En.sibling=Ri,En=Ri,An=aa}if(jn===Lt.length)return I(Et,An),Ci&&Tu(Et,jn),sn;if(An===null){for(;jn<Lt.length;jn++)An=xr(Et,Lt[jn],Tr),An!==null&&(ht=Q(An,ht,jn),En===null?sn=An:En.sibling=An,En=An);return Ci&&Tu(Et,jn),sn}for(An=F(Et,An);jn<Lt.length;jn++)aa=$r(An,Et,jn,Lt[jn],Tr),aa!==null&&(g&&aa.alternate!==null&&An.delete(aa.key===null?jn:aa.key),ht=Q(aa,ht,jn),En===null?sn=aa:En.sibling=aa,En=aa);return g&&An.forEach(function(Ih){return x(Et,Ih)}),Ci&&Tu(Et,jn),sn}function Qr(Et,ht,Lt,Tr){var sn=Wt(Lt);if(typeof sn!="function")throw Error(l(150));if(Lt=sn.call(Lt),Lt==null)throw Error(l(151));for(var En=sn=null,An=ht,jn=ht=0,aa=null,Ri=Lt.next();An!==null&&!Ri.done;jn++,Ri=Lt.next()){An.index>jn?(aa=An,An=null):aa=An.sibling;var Ih=_r(Et,An,Ri.value,Tr);if(Ih===null){An===null&&(An=aa);break}g&&An&&Ih.alternate===null&&x(Et,An),ht=Q(Ih,ht,jn),En===null?sn=Ih:En.sibling=Ih,En=Ih,An=aa}if(Ri.done)return I(Et,An),Ci&&Tu(Et,jn),sn;if(An===null){for(;!Ri.done;jn++,Ri=Lt.next())Ri=xr(Et,Ri.value,Tr),Ri!==null&&(ht=Q(Ri,ht,jn),En===null?sn=Ri:En.sibling=Ri,En=Ri);return Ci&&Tu(Et,jn),sn}for(An=F(Et,An);!Ri.done;jn++,Ri=Lt.next())Ri=$r(An,Et,jn,Ri.value,Tr),Ri!==null&&(g&&Ri.alternate!==null&&An.delete(Ri.key===null?jn:Ri.key),ht=Q(Ri,ht,jn),En===null?sn=Ri:En.sibling=Ri,En=Ri);return g&&An.forEach(function(Ky){return x(Et,Ky)}),Ci&&Tu(Et,jn),sn}function Do(Et,ht,Lt,Tr){if(typeof Lt=="object"&&Lt!==null&&Lt.type===ze&&Lt.key===null&&(Lt=Lt.props.children),typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case he:e:{for(var sn=Lt.key,En=ht;En!==null;){if(En.key===sn){if(sn=Lt.type,sn===ze){if(En.tag===7){I(Et,En.sibling),ht=G(En,Lt.props.children),ht.return=Et,Et=ht;break e}}else if(En.elementType===sn||typeof sn=="object"&&sn!==null&&sn.$$typeof===Tt&&Mp(sn)===En.type){I(Et,En.sibling),ht=G(En,Lt.props),ht.ref=_c(Et,En,Lt),ht.return=Et,Et=ht;break e}I(Et,En);break}else x(Et,En);En=En.sibling}Lt.type===ze?(ht=ko(Lt.props.children,Et.mode,Tr,Lt.key),ht.return=Et,Et=ht):(Tr=Uo(Lt.type,Lt.key,Lt.props,null,Et.mode,Tr),Tr.ref=_c(Et,ht,Lt),Tr.return=Et,Et=Tr)}return we(Et);case _e:e:{for(En=Lt.key;ht!==null;){if(ht.key===En)if(ht.tag===4&&ht.stateNode.containerInfo===Lt.containerInfo&&ht.stateNode.implementation===Lt.implementation){I(Et,ht.sibling),ht=G(ht,Lt.children||[]),ht.return=Et,Et=ht;break e}else{I(Et,ht);break}else x(Et,ht);ht=ht.sibling}ht=Za(Lt,Et.mode,Tr),ht.return=Et,Et=ht}return we(Et);case Tt:return En=Lt._init,Do(Et,ht,En(Lt._payload),Tr)}if(fo(Lt))return Kr(Et,ht,Lt,Tr);if(Wt(Lt))return Qr(Et,ht,Lt,Tr);df(Et,Lt)}return typeof Lt=="string"&&Lt!==""||typeof Lt=="number"?(Lt=""+Lt,ht!==null&&ht.tag===6?(I(Et,ht.sibling),ht=G(ht,Lt),ht.return=Et,Et=ht):(I(Et,ht),ht=Ma(Lt,Et.mode,Tr),ht.return=Et,Et=ht),we(Et)):I(Et,ht)}return Do}var Eu=Nl(!0),bd=Nl(!1),gl=pl(null),yc=null,ls=null,pf=null;function jl(){pf=ls=yc=null}function vc(g){var x=gl.current;Ii(gl),g._currentValue=x}function mf(g,x,I){for(;g!==null;){var F=g.alternate;if((g.childLanes&x)!==x?(g.childLanes|=x,F!==null&&(F.childLanes|=x)):F!==null&&(F.childLanes&x)!==x&&(F.childLanes|=x),g===I)break;g=g.return}}function xc(g,x){yc=g,pf=ls=null,g=g.dependencies,g!==null&&g.firstContext!==null&&((g.lanes&x)!==0&&(To=!0),g.firstContext=null)}function qa(g){var x=g._currentValue;if(pf!==g)if(g={context:g,memoizedValue:x,next:null},ls===null){if(yc===null)throw Error(l(308));ls=g,yc.dependencies={lanes:0,firstContext:g}}else ls=ls.next=g;return x}var Ga=null;function bc(g){Ga===null?Ga=[g]:Ga.push(g)}function nr(g,x,I,F){var G=x.interleaved;return G===null?(I.next=I,bc(x)):(I.next=G.next,G.next=I),x.interleaved=I,bs(g,F)}function bs(g,x){g.lanes|=x;var I=g.alternate;for(I!==null&&(I.lanes|=x),I=g,g=g.return;g!==null;)g.childLanes|=x,I=g.alternate,I!==null&&(I.childLanes|=x),I=g,g=g.return;return I.tag===3?I.stateNode:null}var ws=!1;function Ls(g){g.updateQueue={baseState:g.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function da(g,x){g=g.updateQueue,x.updateQueue===g&&(x.updateQueue={baseState:g.baseState,firstBaseUpdate:g.firstBaseUpdate,lastBaseUpdate:g.lastBaseUpdate,shared:g.shared,effects:g.effects})}function br(g,x){return{eventTime:g,lane:x,tag:0,payload:null,callback:null,next:null}}function _l(g,x,I){var F=g.updateQueue;if(F===null)return null;if(F=F.shared,(S&2)!==0){var G=F.pending;return G===null?x.next=x:(x.next=G.next,G.next=x),F.pending=x,bs(g,I)}return G=F.interleaved,G===null?(x.next=x,bc(F)):(x.next=G.next,G.next=x),F.interleaved=x,bs(g,I)}function wd(g,x,I){if(x=x.updateQueue,x!==null&&(x=x.shared,(I&4194240)!==0)){var F=x.lanes;F&=g.pendingLanes,I|=F,x.lanes=I,rs(g,I)}}function Pm(g,x){var I=g.updateQueue,F=g.alternate;if(F!==null&&(F=F.updateQueue,I===F)){var G=null,Q=null;if(I=I.firstBaseUpdate,I!==null){do{var we={eventTime:I.eventTime,lane:I.lane,tag:I.tag,payload:I.payload,callback:I.callback,next:null};Q===null?G=Q=we:Q=Q.next=we,I=I.next}while(I!==null);Q===null?G=Q=x:Q=Q.next=x}else G=Q=x;I={baseState:F.baseState,firstBaseUpdate:G,lastBaseUpdate:Q,shared:F.shared,effects:F.effects},g.updateQueue=I;return}g=I.lastBaseUpdate,g===null?I.firstBaseUpdate=x:g.next=x,I.lastBaseUpdate=x}function wc(g,x,I,F){var G=g.updateQueue;ws=!1;var Q=G.firstBaseUpdate,we=G.lastBaseUpdate,Ze=G.shared.pending;if(Ze!==null){G.shared.pending=null;var it=Ze,qt=it.next;it.next=null,we===null?Q=qt:we.next=qt,we=it;var mr=g.alternate;mr!==null&&(mr=mr.updateQueue,Ze=mr.lastBaseUpdate,Ze!==we&&(Ze===null?mr.firstBaseUpdate=qt:Ze.next=qt,mr.lastBaseUpdate=it))}if(Q!==null){var xr=G.baseState;we=0,mr=qt=it=null,Ze=Q;do{var _r=Ze.lane,$r=Ze.eventTime;if((F&_r)===_r){mr!==null&&(mr=mr.next={eventTime:$r,lane:0,tag:Ze.tag,payload:Ze.payload,callback:Ze.callback,next:null});e:{var Kr=g,Qr=Ze;switch(_r=x,$r=I,Qr.tag){case 1:if(Kr=Qr.payload,typeof Kr=="function"){xr=Kr.call($r,xr,_r);break e}xr=Kr;break e;case 3:Kr.flags=Kr.flags&-65537|128;case 0:if(Kr=Qr.payload,_r=typeof Kr=="function"?Kr.call($r,xr,_r):Kr,_r==null)break e;xr=Zt({},xr,_r);break e;case 2:ws=!0}}Ze.callback!==null&&Ze.lane!==0&&(g.flags|=64,_r=G.effects,_r===null?G.effects=[Ze]:_r.push(Ze))}else $r={eventTime:$r,lane:_r,tag:Ze.tag,payload:Ze.payload,callback:Ze.callback,next:null},mr===null?(qt=mr=$r,it=xr):mr=mr.next=$r,we|=_r;if(Ze=Ze.next,Ze===null){if(Ze=G.shared.pending,Ze===null)break;_r=Ze,Ze=_r.next,_r.next=null,G.lastBaseUpdate=_r,G.shared.pending=null}}while(!0);if(mr===null&&(it=xr),G.baseState=it,G.firstBaseUpdate=qt,G.lastBaseUpdate=mr,x=G.shared.interleaved,x!==null){G=x;do we|=G.lane,G=G.next;while(G!==x)}else Q===null&&(G.shared.lanes=0);K|=we,g.lanes=we,g.memoizedState=xr}}function gf(g,x,I){if(g=x.effects,x.effects=null,g!==null)for(x=0;x<g.length;x++){var F=g[x],G=F.callback;if(G!==null){if(F.callback=null,F=I,typeof G!="function")throw Error(l(191,G));G.call(F)}}}var mh={},us=pl(mh),_f=pl(mh),yf=pl(mh);function Mo(g){if(g===mh)throw Error(l(174));return g}function vf(g,x){switch(Vi(yf,x),Vi(_f,g),Vi(us,mh),g=x.nodeType,g){case 9:case 11:x=(x=x.documentElement)?x.namespaceURI:Sa(null,"");break;default:g=g===8?x.parentNode:x,x=g.namespaceURI||null,g=g.tagName,x=Sa(x,g)}Ii(us),Vi(us,x)}function So(){Ii(us),Ii(_f),Ii(yf)}function Ul(g){Mo(yf.current);var x=Mo(us.current),I=Sa(x,g.type);x!==I&&(Vi(_f,g),Vi(us,I))}function Sd(g){_f.current===g&&(Ii(us),Ii(_f))}var Ji=pl(0);function gh(g){for(var x=g;x!==null;){if(x.tag===13){var I=x.memoizedState;if(I!==null&&(I=I.dehydrated,I===null||I.data==="$?"||I.data==="$!"))return x}else if(x.tag===19&&x.memoizedProps.revealOrder!==void 0){if((x.flags&128)!==0)return x}else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===g)break;for(;x.sibling===null;){if(x.return===null||x.return===g)return null;x=x.return}x.sibling.return=x.return,x=x.sibling}return null}var xf=[];function Td(){for(var g=0;g<xf.length;g++)xf[g]._workInProgressVersionPrimary=null;xf.length=0}var cs=ke.ReactCurrentDispatcher,Un=ke.ReactCurrentBatchConfig,Fs=0,Hi=null,ao=null,No=null,bf=!1,Ss=!1,Bs=0,Ns=0;function St(){throw Error(l(321))}function Jt(g,x){if(x===null)return!1;for(var I=0;I<x.length&&I<g.length;I++)if(!_s(g[I],x[I]))return!1;return!0}function Au(g,x,I,F,G,Q){if(Fs=Q,Hi=x,x.memoizedState=null,x.updateQueue=null,x.lanes=0,cs.current=g===null||g.memoizedState===null?Cu:xh,g=I(F,G),Ss){Q=0;do{if(Ss=!1,Bs=0,25<=Q)throw Error(l(301));Q+=1,No=ao=null,x.updateQueue=null,cs.current=Od,g=I(F,G)}while(Ss)}if(cs.current=ma,x=ao!==null&&ao.next!==null,Fs=0,No=ao=Hi=null,bf=!1,x)throw Error(l(300));return g}function Ei(){var g=Bs!==0;return Bs=0,g}function Ve(){var g={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return No===null?Hi.memoizedState=No=g:No=No.next=g,No}function hs(){if(ao===null){var g=Hi.alternate;g=g!==null?g.memoizedState:null}else g=ao.next;var x=No===null?Hi.memoizedState:No.next;if(x!==null)No=x,ao=g;else{if(g===null)throw Error(l(310));ao=g,g={memoizedState:ao.memoizedState,baseState:ao.baseState,baseQueue:ao.baseQueue,queue:ao.queue,next:null},No===null?Hi.memoizedState=No=g:No=No.next=g}return No}function Vl(g,x){return typeof x=="function"?x(g):x}function Sc(g){var x=hs(),I=x.queue;if(I===null)throw Error(l(311));I.lastRenderedReducer=g;var F=ao,G=F.baseQueue,Q=I.pending;if(Q!==null){if(G!==null){var we=G.next;G.next=Q.next,Q.next=we}F.baseQueue=G=Q,I.pending=null}if(G!==null){Q=G.next,F=F.baseState;var Ze=we=null,it=null,qt=Q;do{var mr=qt.lane;if((Fs&mr)===mr)it!==null&&(it=it.next={lane:0,action:qt.action,hasEagerState:qt.hasEagerState,eagerState:qt.eagerState,next:null}),F=qt.hasEagerState?qt.eagerState:g(F,qt.action);else{var xr={lane:mr,action:qt.action,hasEagerState:qt.hasEagerState,eagerState:qt.eagerState,next:null};it===null?(Ze=it=xr,we=F):it=it.next=xr,Hi.lanes|=mr,K|=mr}qt=qt.next}while(qt!==null&&qt!==Q);it===null?we=F:it.next=Ze,_s(F,x.memoizedState)||(To=!0),x.memoizedState=F,x.baseState=we,x.baseQueue=it,I.lastRenderedState=F}if(g=I.interleaved,g!==null){G=g;do Q=G.lane,Hi.lanes|=Q,K|=Q,G=G.next;while(G!==g)}else G===null&&(I.lanes=0);return[x.memoizedState,I.dispatch]}function Pu(g){var x=hs(),I=x.queue;if(I===null)throw Error(l(311));I.lastRenderedReducer=g;var F=I.dispatch,G=I.pending,Q=x.memoizedState;if(G!==null){I.pending=null;var we=G=G.next;do Q=g(Q,we.action),we=we.next;while(we!==G);_s(Q,x.memoizedState)||(To=!0),x.memoizedState=Q,x.baseQueue===null&&(x.baseState=Q),I.lastRenderedState=Q}return[Q,F]}function Ed(){}function wf(g,x){var I=Hi,F=hs(),G=x(),Q=!_s(F.memoizedState,G);if(Q&&(F.memoizedState=G,To=!0),F=F.queue,Id(Im.bind(null,I,F,g),[g]),F.getSnapshot!==x||Q||No!==null&&No.memoizedState.tag&1){if(I.flags|=2048,_h(9,js.bind(null,I,F,G,x),void 0,null),E===null)throw Error(l(349));(Fs&30)!==0||Tc(I,x,G)}return G}function Tc(g,x,I){g.flags|=16384,g={getSnapshot:x,value:I},x=Hi.updateQueue,x===null?(x={lastEffect:null,stores:null},Hi.updateQueue=x,x.stores=[g]):(I=x.stores,I===null?x.stores=[g]:I.push(g))}function js(g,x,I,F){x.value=I,x.getSnapshot=F,Ad(x)&&Sf(g)}function Im(g,x,I){return I(function(){Ad(x)&&Sf(g)})}function Ad(g){var x=g.getSnapshot;g=g.value;try{var I=x();return!_s(g,I)}catch{return!0}}function Sf(g){var x=bs(g,1);x!==null&&Re(x,g,1,-1)}function Pd(g){var x=Ve();return typeof g=="function"&&(g=g()),x.memoizedState=x.baseState=g,g={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vl,lastRenderedState:g},x.queue=g,g=g.dispatch=Rp.bind(null,Hi,g),[x.memoizedState,g]}function _h(g,x,I,F){return g={tag:g,create:x,destroy:I,deps:F,next:null},x=Hi.updateQueue,x===null?(x={lastEffect:null,stores:null},Hi.updateQueue=x,x.lastEffect=g.next=g):(I=x.lastEffect,I===null?x.lastEffect=g.next=g:(F=I.next,I.next=g,g.next=F,x.lastEffect=g)),g}function Op(){return hs().memoizedState}function Ec(g,x,I,F){var G=Ve();Hi.flags|=g,G.memoizedState=_h(1|x,I,void 0,F===void 0?null:F)}function Iu(g,x,I,F){var G=hs();F=F===void 0?null:F;var Q=void 0;if(ao!==null){var we=ao.memoizedState;if(Q=we.destroy,F!==null&&Jt(F,we.deps)){G.memoizedState=_h(x,I,Q,F);return}}Hi.flags|=g,G.memoizedState=_h(1|x,I,Q,F)}function Ac(g,x){return Ec(8390656,8,g,x)}function Id(g,x){return Iu(2048,8,g,x)}function Cm(g,x){return Iu(4,2,g,x)}function Wo(g,x){return Iu(4,4,g,x)}function Mm(g,x){if(typeof x=="function")return g=g(),x(g),function(){x(null)};if(x!=null)return g=g(),x.current=g,function(){x.current=null}}function yh(g,x,I){return I=I!=null?I.concat([g]):null,Iu(4,4,Mm.bind(null,x,g),I)}function ni(){}function mn(g,x){var I=hs();x=x===void 0?null:x;var F=I.memoizedState;return F!==null&&x!==null&&Jt(x,F[1])?F[0]:(I.memoizedState=[g,x],g)}function Cd(g,x){var I=hs();x=x===void 0?null:x;var F=I.memoizedState;return F!==null&&x!==null&&Jt(x,F[1])?F[0]:(g=g(),I.memoizedState=[g,x],g)}function pa(g,x,I){return(Fs&21)===0?(g.baseState&&(g.baseState=!1,To=!0),g.memoizedState=I):(_s(I,x)||(I=ds(),Hi.lanes|=I,K|=I,g.baseState=!0),x)}function vh(g,x){var I=oi;oi=I!==0&&4>I?I:4,g(!0);var F=Un.transition;Un.transition={};try{g(!1),x()}finally{oi=I,Un.transition=F}}function Pc(){return hs().memoizedState}function Ic(g,x,I){var F=qe(g);if(I={lane:F,action:I,hasEagerState:!1,eagerState:null,next:null},Md(g))Tf(x,I);else if(I=nr(g,x,I,F),I!==null){var G=wt();Re(I,g,F,G),Ef(I,x,F)}}function Rp(g,x,I){var F=qe(g),G={lane:F,action:I,hasEagerState:!1,eagerState:null,next:null};if(Md(g))Tf(x,G);else{var Q=g.alternate;if(g.lanes===0&&(Q===null||Q.lanes===0)&&(Q=x.lastRenderedReducer,Q!==null))try{var we=x.lastRenderedState,Ze=Q(we,I);if(G.hasEagerState=!0,G.eagerState=Ze,_s(Ze,we)){var it=x.interleaved;it===null?(G.next=G,bc(x)):(G.next=it.next,it.next=G),x.interleaved=G;return}}catch{}finally{}I=nr(g,x,G,F),I!==null&&(G=wt(),Re(I,g,F,G),Ef(I,x,F))}}function Md(g){var x=g.alternate;return g===Hi||x!==null&&x===Hi}function Tf(g,x){Ss=bf=!0;var I=g.pending;I===null?x.next=x:(x.next=I.next,I.next=x),g.pending=x}function Ef(g,x,I){if((I&4194240)!==0){var F=x.lanes;F&=g.pendingLanes,I|=F,x.lanes=I,rs(g,I)}}var ma={readContext:qa,useCallback:St,useContext:St,useEffect:St,useImperativeHandle:St,useInsertionEffect:St,useLayoutEffect:St,useMemo:St,useReducer:St,useRef:St,useState:St,useDebugValue:St,useDeferredValue:St,useTransition:St,useMutableSource:St,useSyncExternalStore:St,useId:St,unstable_isNewReconciler:!1},Cu={readContext:qa,useCallback:function(g,x){return Ve().memoizedState=[g,x===void 0?null:x],g},useContext:qa,useEffect:Ac,useImperativeHandle:function(g,x,I){return I=I!=null?I.concat([g]):null,Ec(4194308,4,Mm.bind(null,x,g),I)},useLayoutEffect:function(g,x){return Ec(4194308,4,g,x)},useInsertionEffect:function(g,x){return Ec(4,2,g,x)},useMemo:function(g,x){var I=Ve();return x=x===void 0?null:x,g=g(),I.memoizedState=[g,x],g},useReducer:function(g,x,I){var F=Ve();return x=I!==void 0?I(x):x,F.memoizedState=F.baseState=x,g={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:x},F.queue=g,g=g.dispatch=Ic.bind(null,Hi,g),[F.memoizedState,g]},useRef:function(g){var x=Ve();return g={current:g},x.memoizedState=g},useState:Pd,useDebugValue:ni,useDeferredValue:function(g){return Ve().memoizedState=g},useTransition:function(){var g=Pd(!1),x=g[0];return g=vh.bind(null,g[1]),Ve().memoizedState=g,[x,g]},useMutableSource:function(){},useSyncExternalStore:function(g,x,I){var F=Hi,G=Ve();if(Ci){if(I===void 0)throw Error(l(407));I=I()}else{if(I=x(),E===null)throw Error(l(349));(Fs&30)!==0||Tc(F,x,I)}G.memoizedState=I;var Q={value:I,getSnapshot:x};return G.queue=Q,Ac(Im.bind(null,F,Q,g),[g]),F.flags|=2048,_h(9,js.bind(null,F,Q,I,x),void 0,null),I},useId:function(){var g=Ve(),x=E.identifierPrefix;if(Ci){var I=zs,F=Ds;I=(F&~(1<<32-Ta(F)-1)).toString(32)+I,x=":"+x+"R"+I,I=Bs++,0<I&&(x+="H"+I.toString(32)),x+=":"}else I=Ns++,x=":"+x+"r"+I.toString(32)+":";return g.memoizedState=x},unstable_isNewReconciler:!1},xh={readContext:qa,useCallback:mn,useContext:qa,useEffect:Id,useImperativeHandle:yh,useInsertionEffect:Cm,useLayoutEffect:Wo,useMemo:Cd,useReducer:Sc,useRef:Op,useState:function(){return Sc(Vl)},useDebugValue:ni,useDeferredValue:function(g){var x=hs();return pa(x,ao.memoizedState,g)},useTransition:function(){var g=Sc(Vl)[0],x=hs().memoizedState;return[g,x]},useMutableSource:Ed,useSyncExternalStore:wf,useId:Pc,unstable_isNewReconciler:!1},Od={readContext:qa,useCallback:mn,useContext:qa,useEffect:Id,useImperativeHandle:yh,useInsertionEffect:Cm,useLayoutEffect:Wo,useMemo:Cd,useReducer:Pu,useRef:Op,useState:function(){return Pu(Vl)},useDebugValue:ni,useDeferredValue:function(g){var x=hs();return ao===null?x.memoizedState=g:pa(x,ao.memoizedState,g)},useTransition:function(){var g=Pu(Vl)[0],x=hs().memoizedState;return[g,x]},useMutableSource:Ed,useSyncExternalStore:wf,useId:Pc,unstable_isNewReconciler:!1};function Ha(g,x){if(g&&g.defaultProps){x=Zt({},x),g=g.defaultProps;for(var I in g)x[I]===void 0&&(x[I]=g[I]);return x}return x}function Mu(g,x,I,F){x=g.memoizedState,I=I(F,x),I=I==null?x:Zt({},x,I),g.memoizedState=I,g.lanes===0&&(g.updateQueue.baseState=I)}var Us={isMounted:function(g){return(g=g._reactInternals)?mt(g)===g:!1},enqueueSetState:function(g,x,I){g=g._reactInternals;var F=wt(),G=qe(g),Q=br(F,G);Q.payload=x,I!=null&&(Q.callback=I),x=_l(g,Q,G),x!==null&&(Re(x,g,G,F),wd(x,g,G))},enqueueReplaceState:function(g,x,I){g=g._reactInternals;var F=wt(),G=qe(g),Q=br(F,G);Q.tag=1,Q.payload=x,I!=null&&(Q.callback=I),x=_l(g,Q,G),x!==null&&(Re(x,g,G,F),wd(x,g,G))},enqueueForceUpdate:function(g,x){g=g._reactInternals;var I=wt(),F=qe(g),G=br(I,F);G.tag=2,x!=null&&(G.callback=x),x=_l(g,G,F),x!==null&&(Re(x,g,F,I),wd(x,g,F))}};function Rd(g,x,I,F,G,Q,we){return g=g.stateNode,typeof g.shouldComponentUpdate=="function"?g.shouldComponentUpdate(F,Q,we):x.prototype&&x.prototype.isPureReactComponent?!eh(I,F)||!eh(G,Q):!0}function Vs(g,x,I){var F=!1,G=as,Q=x.contextType;return typeof Q=="object"&&Q!==null?Q=qa(Q):(G=ia(x)?wo:Co.current,F=x.contextTypes,Q=(F=F!=null)?wu(g,G):as),x=new x(I,Q),g.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=Us,g.stateNode=x,x._reactInternals=g,F&&(g=g.stateNode,g.__reactInternalMemoizedUnmaskedChildContext=G,g.__reactInternalMemoizedMaskedChildContext=Q),x}function kd(g,x,I,F){g=x.state,typeof x.componentWillReceiveProps=="function"&&x.componentWillReceiveProps(I,F),typeof x.UNSAFE_componentWillReceiveProps=="function"&&x.UNSAFE_componentWillReceiveProps(I,F),x.state!==g&&Us.enqueueReplaceState(x,x.state,null)}function bh(g,x,I,F){var G=g.stateNode;G.props=I,G.state=g.memoizedState,G.refs={},Ls(g);var Q=x.contextType;typeof Q=="object"&&Q!==null?G.context=qa(Q):(Q=ia(x)?wo:Co.current,G.context=wu(g,Q)),G.state=g.memoizedState,Q=x.getDerivedStateFromProps,typeof Q=="function"&&(Mu(g,x,Q,I),G.state=g.memoizedState),typeof x.getDerivedStateFromProps=="function"||typeof G.getSnapshotBeforeUpdate=="function"||typeof G.UNSAFE_componentWillMount!="function"&&typeof G.componentWillMount!="function"||(x=G.state,typeof G.componentWillMount=="function"&&G.componentWillMount(),typeof G.UNSAFE_componentWillMount=="function"&&G.UNSAFE_componentWillMount(),x!==G.state&&Us.enqueueReplaceState(G,G.state,null),wc(g,I,G,F),G.state=g.memoizedState),typeof G.componentDidMount=="function"&&(g.flags|=4194308)}function $s(g,x){try{var I="",F=x;do I+=Hr(F),F=F.return;while(F);var G=I}catch(Q){G=`
Error generating stack: `+Q.message+`
`+Q.stack}return{value:g,source:x,stack:G,digest:null}}function Ou(g,x,I){return{value:g,source:null,stack:I??null,digest:x??null}}function ai(g,x){try{console.error(x.value)}catch(I){setTimeout(function(){throw I})}}var wh=typeof WeakMap=="function"?WeakMap:Map;function Dd(g,x,I){I=br(-1,I),I.tag=3,I.payload={element:null};var F=x.value;return I.callback=function(){Pe||(Pe=!0,Me=F),ai(g,x)},I}function zd(g,x,I){I=br(-1,I),I.tag=3;var F=g.type.getDerivedStateFromError;if(typeof F=="function"){var G=x.value;I.payload=function(){return F(G)},I.callback=function(){ai(g,x)}}var Q=g.stateNode;return Q!==null&&typeof Q.componentDidCatch=="function"&&(I.callback=function(){ai(g,x),typeof F!="function"&&(Te===null?Te=new Set([this]):Te.add(this));var we=x.stack;this.componentDidCatch(x.value,{componentStack:we!==null?we:""})}),I}function Ru(g,x,I){var F=g.pingCache;if(F===null){F=g.pingCache=new wh;var G=new Set;F.set(x,G)}else G=F.get(x),G===void 0&&(G=new Set,F.set(x,G));G.has(I)||(G.add(I),g=Gn.bind(null,g,x,I),x.then(g,g))}function Ld(g){do{var x;if((x=g.tag===13)&&(x=g.memoizedState,x=x!==null?x.dehydrated!==null:!0),x)return g;g=g.return}while(g!==null);return null}function Sh(g,x,I,F,G){return(g.mode&1)===0?(g===x?g.flags|=65536:(g.flags|=128,I.flags|=131072,I.flags&=-52805,I.tag===1&&(I.alternate===null?I.tag=17:(x=br(-1,1),x.tag=2,_l(I,x,1))),I.lanes|=1),g):(g.flags|=65536,g.lanes=G,g)}var kp=ke.ReactCurrentOwner,To=!1;function oa(g,x,I,F){x.child=g===null?bd(x,null,I,F):Eu(x,g.child,I,F)}function Fd(g,x,I,F,G){I=I.render;var Q=x.ref;return xc(x,G),F=Au(g,x,I,F,Q,G),I=Ei(),g!==null&&!To?(x.updateQueue=g.updateQueue,x.flags&=-2053,g.lanes&=~G,$l(g,x,G)):(Ci&&I&&cf(x),x.flags|=1,oa(g,x,F,G),x.child)}function Af(g,x,I,F,G){if(g===null){var Q=I.type;return typeof Q=="function"&&!Ni(Q)&&Q.defaultProps===void 0&&I.compare===null&&I.defaultProps===void 0?(x.tag=15,x.type=Q,Cc(g,x,Q,F,G)):(g=Uo(I.type,null,F,x,x.mode,G),g.ref=x.ref,g.return=x,x.child=g)}if(Q=g.child,(g.lanes&G)===0){var we=Q.memoizedProps;if(I=I.compare,I=I!==null?I:eh,I(we,F)&&g.ref===x.ref)return $l(g,x,G)}return x.flags|=1,g=Xo(Q,F),g.ref=x.ref,g.return=x,x.child=g}function Cc(g,x,I,F,G){if(g!==null){var Q=g.memoizedProps;if(eh(Q,F)&&g.ref===x.ref)if(To=!1,x.pendingProps=F=Q,(g.lanes&G)!==0)(g.flags&131072)!==0&&(To=!0);else return x.lanes=g.lanes,$l(g,x,G)}return If(g,x,I,F,G)}function Bd(g,x,I){var F=x.pendingProps,G=F.children,Q=g!==null?g.memoizedState:null;if(F.mode==="hidden")if((x.mode&1)===0)x.memoizedState={baseLanes:0,cachePool:null,transitions:null},Vi(j,L),L|=I;else{if((I&1073741824)===0)return g=Q!==null?Q.baseLanes|I:I,x.lanes=x.childLanes=1073741824,x.memoizedState={baseLanes:g,cachePool:null,transitions:null},x.updateQueue=null,Vi(j,L),L|=g,null;x.memoizedState={baseLanes:0,cachePool:null,transitions:null},F=Q!==null?Q.baseLanes:I,Vi(j,L),L|=F}else Q!==null?(F=Q.baseLanes|I,x.memoizedState=null):F=I,Vi(j,L),L|=F;return oa(g,x,G,I),x.child}function Pf(g,x){var I=x.ref;(g===null&&I!==null||g!==null&&g.ref!==I)&&(x.flags|=512,x.flags|=2097152)}function If(g,x,I,F,G){var Q=ia(I)?wo:Co.current;return Q=wu(x,Q),xc(x,G),I=Au(g,x,I,F,Q,G),F=Ei(),g!==null&&!To?(x.updateQueue=g.updateQueue,x.flags&=-2053,g.lanes&=~G,$l(g,x,G)):(Ci&&F&&cf(x),x.flags|=1,oa(g,x,I,G),x.child)}function Dp(g,x,I,F,G){if(ia(I)){var Q=!0;dh(x)}else Q=!1;if(xc(x,G),x.stateNode===null)Vd(g,x),Vs(x,I,F),bh(x,I,F,G),F=!0;else if(g===null){var we=x.stateNode,Ze=x.memoizedProps;we.props=Ze;var it=we.context,qt=I.contextType;typeof qt=="object"&&qt!==null?qt=qa(qt):(qt=ia(I)?wo:Co.current,qt=wu(x,qt));var mr=I.getDerivedStateFromProps,xr=typeof mr=="function"||typeof we.getSnapshotBeforeUpdate=="function";xr||typeof we.UNSAFE_componentWillReceiveProps!="function"&&typeof we.componentWillReceiveProps!="function"||(Ze!==F||it!==qt)&&kd(x,we,F,qt),ws=!1;var _r=x.memoizedState;we.state=_r,wc(x,F,we,G),it=x.memoizedState,Ze!==F||_r!==it||na.current||ws?(typeof mr=="function"&&(Mu(x,I,mr,F),it=x.memoizedState),(Ze=ws||Rd(x,I,Ze,F,_r,it,qt))?(xr||typeof we.UNSAFE_componentWillMount!="function"&&typeof we.componentWillMount!="function"||(typeof we.componentWillMount=="function"&&we.componentWillMount(),typeof we.UNSAFE_componentWillMount=="function"&&we.UNSAFE_componentWillMount()),typeof we.componentDidMount=="function"&&(x.flags|=4194308)):(typeof we.componentDidMount=="function"&&(x.flags|=4194308),x.memoizedProps=F,x.memoizedState=it),we.props=F,we.state=it,we.context=qt,F=Ze):(typeof we.componentDidMount=="function"&&(x.flags|=4194308),F=!1)}else{we=x.stateNode,da(g,x),Ze=x.memoizedProps,qt=x.type===x.elementType?Ze:Ha(x.type,Ze),we.props=qt,xr=x.pendingProps,_r=we.context,it=I.contextType,typeof it=="object"&&it!==null?it=qa(it):(it=ia(I)?wo:Co.current,it=wu(x,it));var $r=I.getDerivedStateFromProps;(mr=typeof $r=="function"||typeof we.getSnapshotBeforeUpdate=="function")||typeof we.UNSAFE_componentWillReceiveProps!="function"&&typeof we.componentWillReceiveProps!="function"||(Ze!==xr||_r!==it)&&kd(x,we,F,it),ws=!1,_r=x.memoizedState,we.state=_r,wc(x,F,we,G);var Kr=x.memoizedState;Ze!==xr||_r!==Kr||na.current||ws?(typeof $r=="function"&&(Mu(x,I,$r,F),Kr=x.memoizedState),(qt=ws||Rd(x,I,qt,F,_r,Kr,it)||!1)?(mr||typeof we.UNSAFE_componentWillUpdate!="function"&&typeof we.componentWillUpdate!="function"||(typeof we.componentWillUpdate=="function"&&we.componentWillUpdate(F,Kr,it),typeof we.UNSAFE_componentWillUpdate=="function"&&we.UNSAFE_componentWillUpdate(F,Kr,it)),typeof we.componentDidUpdate=="function"&&(x.flags|=4),typeof we.getSnapshotBeforeUpdate=="function"&&(x.flags|=1024)):(typeof we.componentDidUpdate!="function"||Ze===g.memoizedProps&&_r===g.memoizedState||(x.flags|=4),typeof we.getSnapshotBeforeUpdate!="function"||Ze===g.memoizedProps&&_r===g.memoizedState||(x.flags|=1024),x.memoizedProps=F,x.memoizedState=Kr),we.props=F,we.state=Kr,we.context=it,F=qt):(typeof we.componentDidUpdate!="function"||Ze===g.memoizedProps&&_r===g.memoizedState||(x.flags|=4),typeof we.getSnapshotBeforeUpdate!="function"||Ze===g.memoizedProps&&_r===g.memoizedState||(x.flags|=1024),F=!1)}return Th(g,x,I,F,Q,G)}function Th(g,x,I,F,G,Q){Pf(g,x);var we=(x.flags&128)!==0;if(!F&&!we)return G&&lf(x,I,!1),$l(g,x,Q);F=x.stateNode,kp.current=x;var Ze=we&&typeof I.getDerivedStateFromError!="function"?null:F.render();return x.flags|=1,g!==null&&we?(x.child=Eu(x,g.child,null,Q),x.child=Eu(x,null,Ze,Q)):oa(g,x,Ze,Q),x.memoizedState=F.state,G&&lf(x,I,!0),x.child}function Eh(g){var x=g.stateNode;x.pendingContext?sf(g,x.pendingContext,x.pendingContext!==x.context):x.context&&sf(g,x.context,!1),vf(g,x.containerInfo)}function Nd(g,x,I,F,G){return mc(),ff(G),x.flags|=256,oa(g,x,I,F),x.child}var jd={dehydrated:null,treeContext:null,retryLane:0};function Cf(g){return{baseLanes:g,cachePool:null,transitions:null}}function zp(g,x,I){var F=x.pendingProps,G=Ji.current,Q=!1,we=(x.flags&128)!==0,Ze;if((Ze=we)||(Ze=g!==null&&g.memoizedState===null?!1:(G&2)!==0),Ze?(Q=!0,x.flags&=-129):(g===null||g.memoizedState!==null)&&(G|=1),Vi(Ji,G&1),g===null)return xd(x),g=x.memoizedState,g!==null&&(g=g.dehydrated,g!==null)?((x.mode&1)===0?x.lanes=1:g.data==="$!"?x.lanes=8:x.lanes=1073741824,null):(we=F.children,g=F.fallback,Q?(F=x.mode,Q=x.child,we={mode:"hidden",children:we},(F&1)===0&&Q!==null?(Q.childLanes=0,Q.pendingProps=we):Q=Eo(we,F,0,null),g=ko(g,F,I,null),Q.return=x,g.return=x,Q.sibling=g,x.child=Q,x.child.memoizedState=Cf(I),x.memoizedState=jd,g):Ah(x,we));if(G=g.memoizedState,G!==null&&(Ze=G.dehydrated,Ze!==null))return Om(g,x,we,F,Ze,G,I);if(Q){Q=F.fallback,we=x.mode,G=g.child,Ze=G.sibling;var it={mode:"hidden",children:F.children};return(we&1)===0&&x.child!==G?(F=x.child,F.childLanes=0,F.pendingProps=it,x.deletions=null):(F=Xo(G,it),F.subtreeFlags=G.subtreeFlags&14680064),Ze!==null?Q=Xo(Ze,Q):(Q=ko(Q,we,I,null),Q.flags|=2),Q.return=x,F.return=x,F.sibling=Q,x.child=F,F=Q,Q=x.child,we=g.child.memoizedState,we=we===null?Cf(I):{baseLanes:we.baseLanes|I,cachePool:null,transitions:we.transitions},Q.memoizedState=we,Q.childLanes=g.childLanes&~I,x.memoizedState=jd,F}return Q=g.child,g=Q.sibling,F=Xo(Q,{mode:"visible",children:F.children}),(x.mode&1)===0&&(F.lanes=I),F.return=x,F.sibling=null,g!==null&&(I=x.deletions,I===null?(x.deletions=[g],x.flags|=16):I.push(g)),x.child=F,x.memoizedState=null,F}function Ah(g,x){return x=Eo({mode:"visible",children:x},g.mode,0,null),x.return=g,g.child=x}function Mf(g,x,I,F){return F!==null&&ff(F),Eu(x,g.child,null,I),g=Ah(x,x.pendingProps.children),g.flags|=2,x.memoizedState=null,g}function Om(g,x,I,F,G,Q,we){if(I)return x.flags&256?(x.flags&=-257,F=Ou(Error(l(422))),Mf(g,x,we,F)):x.memoizedState!==null?(x.child=g.child,x.flags|=128,null):(Q=F.fallback,G=x.mode,F=Eo({mode:"visible",children:F.children},G,0,null),Q=ko(Q,G,we,null),Q.flags|=2,F.return=x,Q.return=x,F.sibling=Q,x.child=F,(x.mode&1)!==0&&Eu(x,g.child,null,we),x.child.memoizedState=Cf(we),x.memoizedState=jd,Q);if((x.mode&1)===0)return Mf(g,x,we,null);if(G.data==="$!"){if(F=G.nextSibling&&G.nextSibling.dataset,F)var Ze=F.dgst;return F=Ze,Q=Error(l(419)),F=Ou(Q,F,void 0),Mf(g,x,we,F)}if(Ze=(we&g.childLanes)!==0,To||Ze){if(F=E,F!==null){switch(we&-we){case 4:G=2;break;case 16:G=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:G=32;break;case 536870912:G=268435456;break;default:G=0}G=(G&(F.suspendedLanes|we))!==0?0:G,G!==0&&G!==Q.retryLane&&(Q.retryLane=G,bs(g,G),Re(F,g,G,-1))}return Xr(),F=Ou(Error(l(421))),Mf(g,x,we,F)}return G.data==="$?"?(x.flags|=128,x.child=g.child,x=Si.bind(null,g),G._reactRetry=x,null):(g=Q.treeContext,fa=hl(G.nextSibling),$a=x,Ci=!0,ss=null,g!==null&&(vs[xs++]=Ds,vs[xs++]=zs,vs[xs++]=ml,Ds=g.id,zs=g.overflow,ml=x),x=Ah(x,F.children),x.flags|=4096,x)}function Lp(g,x,I){g.lanes|=x;var F=g.alternate;F!==null&&(F.lanes|=x),mf(g.return,x,I)}function Ud(g,x,I,F,G){var Q=g.memoizedState;Q===null?g.memoizedState={isBackwards:x,rendering:null,renderingStartTime:0,last:F,tail:I,tailMode:G}:(Q.isBackwards=x,Q.rendering=null,Q.renderingStartTime=0,Q.last=F,Q.tail=I,Q.tailMode=G)}function Fp(g,x,I){var F=x.pendingProps,G=F.revealOrder,Q=F.tail;if(oa(g,x,F.children,I),F=Ji.current,(F&2)!==0)F=F&1|2,x.flags|=128;else{if(g!==null&&(g.flags&128)!==0)e:for(g=x.child;g!==null;){if(g.tag===13)g.memoizedState!==null&&Lp(g,I,x);else if(g.tag===19)Lp(g,I,x);else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===x)break e;for(;g.sibling===null;){if(g.return===null||g.return===x)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}F&=1}if(Vi(Ji,F),(x.mode&1)===0)x.memoizedState=null;else switch(G){case"forwards":for(I=x.child,G=null;I!==null;)g=I.alternate,g!==null&&gh(g)===null&&(G=I),I=I.sibling;I=G,I===null?(G=x.child,x.child=null):(G=I.sibling,I.sibling=null),Ud(x,!1,G,I,Q);break;case"backwards":for(I=null,G=x.child,x.child=null;G!==null;){if(g=G.alternate,g!==null&&gh(g)===null){x.child=G;break}g=G.sibling,G.sibling=I,I=G,G=g}Ud(x,!0,I,null,Q);break;case"together":Ud(x,!1,null,null,void 0);break;default:x.memoizedState=null}return x.child}function Vd(g,x){(x.mode&1)===0&&g!==null&&(g.alternate=null,x.alternate=null,x.flags|=2)}function $l(g,x,I){if(g!==null&&(x.dependencies=g.dependencies),K|=x.lanes,(I&x.childLanes)===0)return null;if(g!==null&&x.child!==g.child)throw Error(l(153));if(x.child!==null){for(g=x.child,I=Xo(g,g.pendingProps),x.child=I,I.return=x;g.sibling!==null;)g=g.sibling,I=I.sibling=Xo(g,g.pendingProps),I.return=x;I.sibling=null}return x.child}function wi(g,x,I){switch(x.tag){case 3:Eh(x),mc();break;case 5:Ul(x);break;case 1:ia(x.type)&&dh(x);break;case 4:vf(x,x.stateNode.containerInfo);break;case 10:var F=x.type._context,G=x.memoizedProps.value;Vi(gl,F._currentValue),F._currentValue=G;break;case 13:if(F=x.memoizedState,F!==null)return F.dehydrated!==null?(Vi(Ji,Ji.current&1),x.flags|=128,null):(I&x.child.childLanes)!==0?zp(g,x,I):(Vi(Ji,Ji.current&1),g=$l(g,x,I),g!==null?g.sibling:null);Vi(Ji,Ji.current&1);break;case 19:if(F=(I&x.childLanes)!==0,(g.flags&128)!==0){if(F)return Fp(g,x,I);x.flags|=128}if(G=x.memoizedState,G!==null&&(G.rendering=null,G.tail=null,G.lastEffect=null),Vi(Ji,Ji.current),F)break;return null;case 22:case 23:return x.lanes=0,Bd(g,x,I)}return $l(g,x,I)}var Bp,Np,$d,Rm;Bp=function(g,x){for(var I=x.child;I!==null;){if(I.tag===5||I.tag===6)g.appendChild(I.stateNode);else if(I.tag!==4&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===x)break;for(;I.sibling===null;){if(I.return===null||I.return===x)return;I=I.return}I.sibling.return=I.return,I=I.sibling}},Np=function(){},$d=function(g,x,I,F){var G=g.memoizedProps;if(G!==F){g=x.stateNode,Mo(us.current);var Q=null;switch(I){case"input":G=Rn(g,G),F=Rn(g,F),Q=[];break;case"select":G=Zt({},G,{value:void 0}),F=Zt({},F,{value:void 0}),Q=[];break;case"textarea":G=Fo(g,G),F=Fo(g,F),Q=[];break;default:typeof G.onClick!="function"&&typeof F.onClick=="function"&&(g.onclick=kl)}rl(I,F);var we;I=null;for(qt in G)if(!F.hasOwnProperty(qt)&&G.hasOwnProperty(qt)&&G[qt]!=null)if(qt==="style"){var Ze=G[qt];for(we in Ze)Ze.hasOwnProperty(we)&&(I||(I={}),I[we]="")}else qt!=="dangerouslySetInnerHTML"&&qt!=="children"&&qt!=="suppressContentEditableWarning"&&qt!=="suppressHydrationWarning"&&qt!=="autoFocus"&&(y.hasOwnProperty(qt)?Q||(Q=[]):(Q=Q||[]).push(qt,null));for(qt in F){var it=F[qt];if(Ze=G?.[qt],F.hasOwnProperty(qt)&&it!==Ze&&(it!=null||Ze!=null))if(qt==="style")if(Ze){for(we in Ze)!Ze.hasOwnProperty(we)||it&&it.hasOwnProperty(we)||(I||(I={}),I[we]="");for(we in it)it.hasOwnProperty(we)&&Ze[we]!==it[we]&&(I||(I={}),I[we]=it[we])}else I||(Q||(Q=[]),Q.push(qt,I)),I=it;else qt==="dangerouslySetInnerHTML"?(it=it?it.__html:void 0,Ze=Ze?Ze.__html:void 0,it!=null&&Ze!==it&&(Q=Q||[]).push(qt,it)):qt==="children"?typeof it!="string"&&typeof it!="number"||(Q=Q||[]).push(qt,""+it):qt!=="suppressContentEditableWarning"&&qt!=="suppressHydrationWarning"&&(y.hasOwnProperty(qt)?(it!=null&&qt==="onScroll"&&un("scroll",g),Q||Ze===it||(Q=[])):(Q=Q||[]).push(qt,it))}I&&(Q=Q||[]).push("style",I);var qt=Q;(x.updateQueue=qt)&&(x.flags|=4)}},Rm=function(g,x,I,F){I!==F&&(x.flags|=4)};function ql(g,x){if(!Ci)switch(g.tailMode){case"hidden":x=g.tail;for(var I=null;x!==null;)x.alternate!==null&&(I=x),x=x.sibling;I===null?g.tail=null:I.sibling=null;break;case"collapsed":I=g.tail;for(var F=null;I!==null;)I.alternate!==null&&(F=I),I=I.sibling;F===null?x||g.tail===null?g.tail=null:g.tail.sibling=null:F.sibling=null}}function Oo(g){var x=g.alternate!==null&&g.alternate.child===g.child,I=0,F=0;if(x)for(var G=g.child;G!==null;)I|=G.lanes|G.childLanes,F|=G.subtreeFlags&14680064,F|=G.flags&14680064,G.return=g,G=G.sibling;else for(G=g.child;G!==null;)I|=G.lanes|G.childLanes,F|=G.subtreeFlags,F|=G.flags,G.return=g,G=G.sibling;return g.subtreeFlags|=F,g.childLanes=I,x}function jp(g,x,I){var F=x.pendingProps;switch(vd(x),x.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Oo(x),null;case 1:return ia(x.type)&&Su(),Oo(x),null;case 3:return F=x.stateNode,So(),Ii(na),Ii(Co),Td(),F.pendingContext&&(F.context=F.pendingContext,F.pendingContext=null),(g===null||g.child===null)&&(pc(x)?x.flags|=4:g===null||g.memoizedState.isDehydrated&&(x.flags&256)===0||(x.flags|=1024,ss!==null&&(bt(ss),ss=null))),Np(g,x),Oo(x),null;case 5:Sd(x);var G=Mo(yf.current);if(I=x.type,g!==null&&x.stateNode!=null)$d(g,x,I,F,G),g.ref!==x.ref&&(x.flags|=512,x.flags|=2097152);else{if(!F){if(x.stateNode===null)throw Error(l(166));return Oo(x),null}if(g=Mo(us.current),pc(x)){F=x.stateNode,I=x.type;var Q=x.memoizedProps;switch(F[Rs]=x,F[ch]=Q,g=(x.mode&1)!==0,I){case"dialog":un("cancel",F),un("close",F);break;case"iframe":case"object":case"embed":un("load",F);break;case"video":case"audio":for(G=0;G<lc.length;G++)un(lc[G],F);break;case"source":un("error",F);break;case"img":case"image":case"link":un("error",F),un("load",F);break;case"details":un("toggle",F);break;case"input":In(F,Q),un("invalid",F);break;case"select":F._wrapperState={wasMultiple:!!Q.multiple},un("invalid",F);break;case"textarea":Fa(F,Q),un("invalid",F)}rl(I,Q),G=null;for(var we in Q)if(Q.hasOwnProperty(we)){var Ze=Q[we];we==="children"?typeof Ze=="string"?F.textContent!==Ze&&(Q.suppressHydrationWarning!==!0&&cl(F.textContent,Ze,g),G=["children",Ze]):typeof Ze=="number"&&F.textContent!==""+Ze&&(Q.suppressHydrationWarning!==!0&&cl(F.textContent,Ze,g),G=["children",""+Ze]):y.hasOwnProperty(we)&&Ze!=null&&we==="onScroll"&&un("scroll",F)}switch(I){case"input":pn(F),wa(F,Q,!0);break;case"textarea":pn(F),Js(F);break;case"select":case"option":break;default:typeof Q.onClick=="function"&&(F.onclick=kl)}F=G,x.updateQueue=F,F!==null&&(x.flags|=4)}else{we=G.nodeType===9?G:G.ownerDocument,g==="http://www.w3.org/1999/xhtml"&&(g=la(I)),g==="http://www.w3.org/1999/xhtml"?I==="script"?(g=we.createElement("div"),g.innerHTML="<script><\/script>",g=g.removeChild(g.firstChild)):typeof F.is=="string"?g=we.createElement(I,{is:F.is}):(g=we.createElement(I),I==="select"&&(we=g,F.multiple?we.multiple=!0:F.size&&(we.size=F.size))):g=we.createElementNS(g,I),g[Rs]=x,g[ch]=F,Bp(g,x,!1,!1),x.stateNode=g;e:{switch(we=eu(I,F),I){case"dialog":un("cancel",g),un("close",g),G=F;break;case"iframe":case"object":case"embed":un("load",g),G=F;break;case"video":case"audio":for(G=0;G<lc.length;G++)un(lc[G],g);G=F;break;case"source":un("error",g),G=F;break;case"img":case"image":case"link":un("error",g),un("load",g),G=F;break;case"details":un("toggle",g),G=F;break;case"input":In(g,F),G=Rn(g,F),un("invalid",g);break;case"option":G=F;break;case"select":g._wrapperState={wasMultiple:!!F.multiple},G=Zt({},F,{value:void 0}),un("invalid",g);break;case"textarea":Fa(g,F),G=Fo(g,F),un("invalid",g);break;default:G=F}rl(I,G),Ze=G;for(Q in Ze)if(Ze.hasOwnProperty(Q)){var it=Ze[Q];Q==="style"?tl(g,it):Q==="dangerouslySetInnerHTML"?(it=it?it.__html:void 0,it!=null&&Qs(g,it)):Q==="children"?typeof it=="string"?(I!=="textarea"||it!=="")&&el(g,it):typeof it=="number"&&el(g,""+it):Q!=="suppressContentEditableWarning"&&Q!=="suppressHydrationWarning"&&Q!=="autoFocus"&&(y.hasOwnProperty(Q)?it!=null&&Q==="onScroll"&&un("scroll",g):it!=null&&be(g,Q,it,we))}switch(I){case"input":pn(g),wa(g,F,!1);break;case"textarea":pn(g),Js(g);break;case"option":F.value!=null&&g.setAttribute("value",""+Ur(F.value));break;case"select":g.multiple=!!F.multiple,Q=F.value,Q!=null?Ui(g,!!F.multiple,Q,!1):F.defaultValue!=null&&Ui(g,!!F.multiple,F.defaultValue,!0);break;default:typeof G.onClick=="function"&&(g.onclick=kl)}switch(I){case"button":case"input":case"select":case"textarea":F=!!F.autoFocus;break e;case"img":F=!0;break e;default:F=!1}}F&&(x.flags|=4)}x.ref!==null&&(x.flags|=512,x.flags|=2097152)}return Oo(x),null;case 6:if(g&&x.stateNode!=null)Rm(g,x,g.memoizedProps,F);else{if(typeof F!="string"&&x.stateNode===null)throw Error(l(166));if(I=Mo(yf.current),Mo(us.current),pc(x)){if(F=x.stateNode,I=x.memoizedProps,F[Rs]=x,(Q=F.nodeValue!==I)&&(g=$a,g!==null))switch(g.tag){case 3:cl(F.nodeValue,I,(g.mode&1)!==0);break;case 5:g.memoizedProps.suppressHydrationWarning!==!0&&cl(F.nodeValue,I,(g.mode&1)!==0)}Q&&(x.flags|=4)}else F=(I.nodeType===9?I:I.ownerDocument).createTextNode(F),F[Rs]=x,x.stateNode=F}return Oo(x),null;case 13:if(Ii(Ji),F=x.memoizedState,g===null||g.memoizedState!==null&&g.memoizedState.dehydrated!==null){if(Ci&&fa!==null&&(x.mode&1)!==0&&(x.flags&128)===0)hf(),mc(),x.flags|=98560,Q=!1;else if(Q=pc(x),F!==null&&F.dehydrated!==null){if(g===null){if(!Q)throw Error(l(318));if(Q=x.memoizedState,Q=Q!==null?Q.dehydrated:null,!Q)throw Error(l(317));Q[Rs]=x}else mc(),(x.flags&128)===0&&(x.memoizedState=null),x.flags|=4;Oo(x),Q=!1}else ss!==null&&(bt(ss),ss=null),Q=!0;if(!Q)return x.flags&65536?x:null}return(x.flags&128)!==0?(x.lanes=I,x):(F=F!==null,F!==(g!==null&&g.memoizedState!==null)&&F&&(x.child.flags|=8192,(x.mode&1)!==0&&(g===null||(Ji.current&1)!==0?B===0&&(B=3):Xr())),x.updateQueue!==null&&(x.flags|=4),Oo(x),null);case 4:return So(),Np(g,x),g===null&&rf(x.stateNode.containerInfo),Oo(x),null;case 10:return vc(x.type._context),Oo(x),null;case 17:return ia(x.type)&&Su(),Oo(x),null;case 19:if(Ii(Ji),Q=x.memoizedState,Q===null)return Oo(x),null;if(F=(x.flags&128)!==0,we=Q.rendering,we===null)if(F)ql(Q,!1);else{if(B!==0||g!==null&&(g.flags&128)!==0)for(g=x.child;g!==null;){if(we=gh(g),we!==null){for(x.flags|=128,ql(Q,!1),F=we.updateQueue,F!==null&&(x.updateQueue=F,x.flags|=4),x.subtreeFlags=0,F=I,I=x.child;I!==null;)Q=I,g=F,Q.flags&=14680066,we=Q.alternate,we===null?(Q.childLanes=0,Q.lanes=g,Q.child=null,Q.subtreeFlags=0,Q.memoizedProps=null,Q.memoizedState=null,Q.updateQueue=null,Q.dependencies=null,Q.stateNode=null):(Q.childLanes=we.childLanes,Q.lanes=we.lanes,Q.child=we.child,Q.subtreeFlags=0,Q.deletions=null,Q.memoizedProps=we.memoizedProps,Q.memoizedState=we.memoizedState,Q.updateQueue=we.updateQueue,Q.type=we.type,g=we.dependencies,Q.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext}),I=I.sibling;return Vi(Ji,Ji.current&1|2),x.child}g=g.sibling}Q.tail!==null&&$n()>pe&&(x.flags|=128,F=!0,ql(Q,!1),x.lanes=4194304)}else{if(!F)if(g=gh(we),g!==null){if(x.flags|=128,F=!0,I=g.updateQueue,I!==null&&(x.updateQueue=I,x.flags|=4),ql(Q,!0),Q.tail===null&&Q.tailMode==="hidden"&&!we.alternate&&!Ci)return Oo(x),null}else 2*$n()-Q.renderingStartTime>pe&&I!==1073741824&&(x.flags|=128,F=!0,ql(Q,!1),x.lanes=4194304);Q.isBackwards?(we.sibling=x.child,x.child=we):(I=Q.last,I!==null?I.sibling=we:x.child=we,Q.last=we)}return Q.tail!==null?(x=Q.tail,Q.rendering=x,Q.tail=x.sibling,Q.renderingStartTime=$n(),x.sibling=null,I=Ji.current,Vi(Ji,F?I&1|2:I&1),x):(Oo(x),null);case 22:case 23:return dr(),F=x.memoizedState!==null,g!==null&&g.memoizedState!==null!==F&&(x.flags|=8192),F&&(x.mode&1)!==0?(L&1073741824)!==0&&(Oo(x),x.subtreeFlags&6&&(x.flags|=8192)):Oo(x),null;case 24:return null;case 25:return null}throw Error(l(156,x.tag))}function qd(g,x){switch(vd(x),x.tag){case 1:return ia(x.type)&&Su(),g=x.flags,g&65536?(x.flags=g&-65537|128,x):null;case 3:return So(),Ii(na),Ii(Co),Td(),g=x.flags,(g&65536)!==0&&(g&128)===0?(x.flags=g&-65537|128,x):null;case 5:return Sd(x),null;case 13:if(Ii(Ji),g=x.memoizedState,g!==null&&g.dehydrated!==null){if(x.alternate===null)throw Error(l(340));mc()}return g=x.flags,g&65536?(x.flags=g&-65537|128,x):null;case 19:return Ii(Ji),null;case 4:return So(),null;case 10:return vc(x.type._context),null;case 22:case 23:return dr(),null;case 24:return null;default:return null}}var Ca=!1,jo=!1,$i=typeof WeakSet=="function"?WeakSet:Set,Nr=null;function qs(g,x){var I=g.ref;if(I!==null)if(typeof I=="function")try{I(null)}catch(F){Mr(g,x,F)}else I.current=null}function Mc(g,x,I){try{I()}catch(F){Mr(g,x,F)}}var Gd=!1;function km(g,x){if(ah=$h,g=xp(),th(g)){if("selectionStart"in g)var I={start:g.selectionStart,end:g.selectionEnd};else e:{I=(I=g.ownerDocument)&&I.defaultView||window;var F=I.getSelection&&I.getSelection();if(F&&F.rangeCount!==0){I=F.anchorNode;var G=F.anchorOffset,Q=F.focusNode;F=F.focusOffset;try{I.nodeType,Q.nodeType}catch{I=null;break e}var we=0,Ze=-1,it=-1,qt=0,mr=0,xr=g,_r=null;t:for(;;){for(var $r;xr!==I||G!==0&&xr.nodeType!==3||(Ze=we+G),xr!==Q||F!==0&&xr.nodeType!==3||(it=we+F),xr.nodeType===3&&(we+=xr.nodeValue.length),($r=xr.firstChild)!==null;)_r=xr,xr=$r;for(;;){if(xr===g)break t;if(_r===I&&++qt===G&&(Ze=we),_r===Q&&++mr===F&&(it=we),($r=xr.nextSibling)!==null)break;xr=_r,_r=xr.parentNode}xr=$r}I=Ze===-1||it===-1?null:{start:Ze,end:it}}else I=null}I=I||{start:0,end:0}}else I=null;for(sh={focusedElem:g,selectionRange:I},$h=!1,Nr=x;Nr!==null;)if(x=Nr,g=x.child,(x.subtreeFlags&1028)!==0&&g!==null)g.return=x,Nr=g;else for(;Nr!==null;){x=Nr;try{var Kr=x.alternate;if((x.flags&1024)!==0)switch(x.tag){case 0:case 11:case 15:break;case 1:if(Kr!==null){var Qr=Kr.memoizedProps,Do=Kr.memoizedState,Et=x.stateNode,ht=Et.getSnapshotBeforeUpdate(x.elementType===x.type?Qr:Ha(x.type,Qr),Do);Et.__reactInternalSnapshotBeforeUpdate=ht}break;case 3:var Lt=x.stateNode.containerInfo;Lt.nodeType===1?Lt.textContent="":Lt.nodeType===9&&Lt.documentElement&&Lt.removeChild(Lt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(l(163))}}catch(Tr){Mr(x,x.return,Tr)}if(g=x.sibling,g!==null){g.return=x.return,Nr=g;break}Nr=x.return}return Kr=Gd,Gd=!1,Kr}function Gl(g,x,I){var F=x.updateQueue;if(F=F!==null?F.lastEffect:null,F!==null){var G=F=F.next;do{if((G.tag&g)===g){var Q=G.destroy;G.destroy=void 0,Q!==void 0&&Mc(x,I,Q)}G=G.next}while(G!==F)}}function Hd(g,x){if(x=x.updateQueue,x=x!==null?x.lastEffect:null,x!==null){var I=x=x.next;do{if((I.tag&g)===g){var F=I.create;I.destroy=F()}I=I.next}while(I!==x)}}function Wd(g){var x=g.ref;if(x!==null){var I=g.stateNode;switch(g.tag){case 5:g=I;break;default:g=I}typeof x=="function"?x(g):x.current=g}}function Zd(g){var x=g.alternate;x!==null&&(g.alternate=null,Zd(x)),g.child=null,g.deletions=null,g.sibling=null,g.tag===5&&(x=g.stateNode,x!==null&&(delete x[Rs],delete x[ch],delete x[xu],delete x[Am],delete x[Pp])),g.stateNode=null,g.return=null,g.dependencies=null,g.memoizedProps=null,g.memoizedState=null,g.pendingProps=null,g.stateNode=null,g.updateQueue=null}function Xd(g){return g.tag===5||g.tag===3||g.tag===4}function Ph(g){e:for(;;){for(;g.sibling===null;){if(g.return===null||Xd(g.return))return null;g=g.return}for(g.sibling.return=g.return,g=g.sibling;g.tag!==5&&g.tag!==6&&g.tag!==18;){if(g.flags&2||g.child===null||g.tag===4)continue e;g.child.return=g,g=g.child}if(!(g.flags&2))return g.stateNode}}function ku(g,x,I){var F=g.tag;if(F===5||F===6)g=g.stateNode,x?I.nodeType===8?I.parentNode.insertBefore(g,x):I.insertBefore(g,x):(I.nodeType===8?(x=I.parentNode,x.insertBefore(g,I)):(x=I,x.appendChild(g)),I=I._reactRootContainer,I!=null||x.onclick!==null||(x.onclick=kl));else if(F!==4&&(g=g.child,g!==null))for(ku(g,x,I),g=g.sibling;g!==null;)ku(g,x,I),g=g.sibling}function Gs(g,x,I){var F=g.tag;if(F===5||F===6)g=g.stateNode,x?I.insertBefore(g,x):I.appendChild(g);else if(F!==4&&(g=g.child,g!==null))for(Gs(g,x,I),g=g.sibling;g!==null;)Gs(g,x,I),g=g.sibling}var Bi=null,so=!1;function lo(g,x,I){for(I=I.child;I!==null;)Wa(g,x,I),I=I.sibling}function Wa(g,x,I){if(ro&&typeof ro.onCommitFiberUnmount=="function")try{ro.onCommitFiberUnmount(oo,I)}catch{}switch(I.tag){case 5:jo||qs(I,x);case 6:var F=Bi,G=so;Bi=null,lo(g,x,I),Bi=F,so=G,Bi!==null&&(so?(g=Bi,I=I.stateNode,g.nodeType===8?g.parentNode.removeChild(I):g.removeChild(I)):Bi.removeChild(I.stateNode));break;case 18:Bi!==null&&(so?(g=Bi,I=I.stateNode,g.nodeType===8?uh(g.parentNode,I):g.nodeType===1&&uh(g,I),Hc(g)):uh(Bi,I.stateNode));break;case 4:F=Bi,G=so,Bi=I.stateNode.containerInfo,so=!0,lo(g,x,I),Bi=F,so=G;break;case 0:case 11:case 14:case 15:if(!jo&&(F=I.updateQueue,F!==null&&(F=F.lastEffect,F!==null))){G=F=F.next;do{var Q=G,we=Q.destroy;Q=Q.tag,we!==void 0&&((Q&2)!==0||(Q&4)!==0)&&Mc(I,x,we),G=G.next}while(G!==F)}lo(g,x,I);break;case 1:if(!jo&&(qs(I,x),F=I.stateNode,typeof F.componentWillUnmount=="function"))try{F.props=I.memoizedProps,F.state=I.memoizedState,F.componentWillUnmount()}catch(Ze){Mr(I,x,Ze)}lo(g,x,I);break;case 21:lo(g,x,I);break;case 22:I.mode&1?(jo=(F=jo)||I.memoizedState!==null,lo(g,x,I),jo=F):lo(g,x,I);break;default:lo(g,x,I)}}function Dm(g){var x=g.updateQueue;if(x!==null){g.updateQueue=null;var I=g.stateNode;I===null&&(I=g.stateNode=new $i),x.forEach(function(F){var G=xn.bind(null,g,F);I.has(F)||(I.add(F),F.then(G,G))})}}function Hs(g,x){var I=x.deletions;if(I!==null)for(var F=0;F<I.length;F++){var G=I[F];try{var Q=g,we=x,Ze=we;e:for(;Ze!==null;){switch(Ze.tag){case 5:Bi=Ze.stateNode,so=!1;break e;case 3:Bi=Ze.stateNode.containerInfo,so=!0;break e;case 4:Bi=Ze.stateNode.containerInfo,so=!0;break e}Ze=Ze.return}if(Bi===null)throw Error(l(160));Wa(Q,we,G),Bi=null,so=!1;var it=G.alternate;it!==null&&(it.return=null),G.return=null}catch(qt){Mr(G,x,qt)}}if(x.subtreeFlags&12854)for(x=x.child;x!==null;)zm(x,g),x=x.sibling}function zm(g,x){var I=g.alternate,F=g.flags;switch(g.tag){case 0:case 11:case 14:case 15:if(Hs(x,g),yl(g),F&4){try{Gl(3,g,g.return),Hd(3,g)}catch(Qr){Mr(g,g.return,Qr)}try{Gl(5,g,g.return)}catch(Qr){Mr(g,g.return,Qr)}}break;case 1:Hs(x,g),yl(g),F&512&&I!==null&&qs(I,I.return);break;case 5:if(Hs(x,g),yl(g),F&512&&I!==null&&qs(I,I.return),g.flags&32){var G=g.stateNode;try{el(G,"")}catch(Qr){Mr(g,g.return,Qr)}}if(F&4&&(G=g.stateNode,G!=null)){var Q=g.memoizedProps,we=I!==null?I.memoizedProps:Q,Ze=g.type,it=g.updateQueue;if(g.updateQueue=null,it!==null)try{Ze==="input"&&Q.type==="radio"&&Q.name!=null&&ci(G,Q),eu(Ze,we);var qt=eu(Ze,Q);for(we=0;we<it.length;we+=2){var mr=it[we],xr=it[we+1];mr==="style"?tl(G,xr):mr==="dangerouslySetInnerHTML"?Qs(G,xr):mr==="children"?el(G,xr):be(G,mr,xr,qt)}switch(Ze){case"input":Ki(G,Q);break;case"textarea":Ms(G,Q);break;case"select":var _r=G._wrapperState.wasMultiple;G._wrapperState.wasMultiple=!!Q.multiple;var $r=Q.value;$r!=null?Ui(G,!!Q.multiple,$r,!1):_r!==!!Q.multiple&&(Q.defaultValue!=null?Ui(G,!!Q.multiple,Q.defaultValue,!0):Ui(G,!!Q.multiple,Q.multiple?[]:"",!1))}G[ch]=Q}catch(Qr){Mr(g,g.return,Qr)}}break;case 6:if(Hs(x,g),yl(g),F&4){if(g.stateNode===null)throw Error(l(162));G=g.stateNode,Q=g.memoizedProps;try{G.nodeValue=Q}catch(Qr){Mr(g,g.return,Qr)}}break;case 3:if(Hs(x,g),yl(g),F&4&&I!==null&&I.memoizedState.isDehydrated)try{Hc(x.containerInfo)}catch(Qr){Mr(g,g.return,Qr)}break;case 4:Hs(x,g),yl(g);break;case 13:Hs(x,g),yl(g),G=g.child,G.flags&8192&&(Q=G.memoizedState!==null,G.stateNode.isHidden=Q,!Q||G.alternate!==null&&G.alternate.memoizedState!==null||(ce=$n())),F&4&&Dm(g);break;case 22:if(mr=I!==null&&I.memoizedState!==null,g.mode&1?(jo=(qt=jo)||mr,Hs(x,g),jo=qt):Hs(x,g),yl(g),F&8192){if(qt=g.memoizedState!==null,(g.stateNode.isHidden=qt)&&!mr&&(g.mode&1)!==0)for(Nr=g,mr=g.child;mr!==null;){for(xr=Nr=mr;Nr!==null;){switch(_r=Nr,$r=_r.child,_r.tag){case 0:case 11:case 14:case 15:Gl(4,_r,_r.return);break;case 1:qs(_r,_r.return);var Kr=_r.stateNode;if(typeof Kr.componentWillUnmount=="function"){F=_r,I=_r.return;try{x=F,Kr.props=x.memoizedProps,Kr.state=x.memoizedState,Kr.componentWillUnmount()}catch(Qr){Mr(F,I,Qr)}}break;case 5:qs(_r,_r.return);break;case 22:if(_r.memoizedState!==null){f(xr);continue}}$r!==null?($r.return=_r,Nr=$r):f(xr)}mr=mr.sibling}e:for(mr=null,xr=g;;){if(xr.tag===5){if(mr===null){mr=xr;try{G=xr.stateNode,qt?(Q=G.style,typeof Q.setProperty=="function"?Q.setProperty("display","none","important"):Q.display="none"):(Ze=xr.stateNode,it=xr.memoizedProps.style,we=it!=null&&it.hasOwnProperty("display")?it.display:null,Ze.style.display=wl("display",we))}catch(Qr){Mr(g,g.return,Qr)}}}else if(xr.tag===6){if(mr===null)try{xr.stateNode.nodeValue=qt?"":xr.memoizedProps}catch(Qr){Mr(g,g.return,Qr)}}else if((xr.tag!==22&&xr.tag!==23||xr.memoizedState===null||xr===g)&&xr.child!==null){xr.child.return=xr,xr=xr.child;continue}if(xr===g)break e;for(;xr.sibling===null;){if(xr.return===null||xr.return===g)break e;mr===xr&&(mr=null),xr=xr.return}mr===xr&&(mr=null),xr.sibling.return=xr.return,xr=xr.sibling}}break;case 19:Hs(x,g),yl(g),F&4&&Dm(g);break;case 21:break;default:Hs(x,g),yl(g)}}function yl(g){var x=g.flags;if(x&2){try{e:{for(var I=g.return;I!==null;){if(Xd(I)){var F=I;break e}I=I.return}throw Error(l(160))}switch(F.tag){case 5:var G=F.stateNode;F.flags&32&&(el(G,""),F.flags&=-33);var Q=Ph(g);Gs(g,Q,G);break;case 3:case 4:var we=F.stateNode.containerInfo,Ze=Ph(g);ku(g,Ze,we);break;default:throw Error(l(161))}}catch(it){Mr(g,g.return,it)}g.flags&=-3}x&4096&&(g.flags&=-4097)}function Lm(g,x,I){Nr=g,Zo(g)}function Zo(g,x,I){for(var F=(g.mode&1)!==0;Nr!==null;){var G=Nr,Q=G.child;if(G.tag===22&&F){var we=G.memoizedState!==null||Ca;if(!we){var Ze=G.alternate,it=Ze!==null&&Ze.memoizedState!==null||jo;Ze=Ca;var qt=jo;if(Ca=we,(jo=it)&&!qt)for(Nr=G;Nr!==null;)we=Nr,it=we.child,we.tag===22&&we.memoizedState!==null?t(G):it!==null?(it.return=we,Nr=it):t(G);for(;Q!==null;)Nr=Q,Zo(Q),Q=Q.sibling;Nr=G,Ca=Ze,jo=qt}Up(g)}else(G.subtreeFlags&8772)!==0&&Q!==null?(Q.return=G,Nr=Q):Up(g)}}function Up(g){for(;Nr!==null;){var x=Nr;if((x.flags&8772)!==0){var I=x.alternate;try{if((x.flags&8772)!==0)switch(x.tag){case 0:case 11:case 15:jo||Hd(5,x);break;case 1:var F=x.stateNode;if(x.flags&4&&!jo)if(I===null)F.componentDidMount();else{var G=x.elementType===x.type?I.memoizedProps:Ha(x.type,I.memoizedProps);F.componentDidUpdate(G,I.memoizedState,F.__reactInternalSnapshotBeforeUpdate)}var Q=x.updateQueue;Q!==null&&gf(x,Q,F);break;case 3:var we=x.updateQueue;if(we!==null){if(I=null,x.child!==null)switch(x.child.tag){case 5:I=x.child.stateNode;break;case 1:I=x.child.stateNode}gf(x,we,I)}break;case 5:var Ze=x.stateNode;if(I===null&&x.flags&4){I=Ze;var it=x.memoizedProps;switch(x.type){case"button":case"input":case"select":case"textarea":it.autoFocus&&I.focus();break;case"img":it.src&&(I.src=it.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(x.memoizedState===null){var qt=x.alternate;if(qt!==null){var mr=qt.memoizedState;if(mr!==null){var xr=mr.dehydrated;xr!==null&&Hc(xr)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(l(163))}jo||x.flags&512&&Wd(x)}catch(_r){Mr(x,x.return,_r)}}if(x===g){Nr=null;break}if(I=x.sibling,I!==null){I.return=x.return,Nr=I;break}Nr=x.return}}function f(g){for(;Nr!==null;){var x=Nr;if(x===g){Nr=null;break}var I=x.sibling;if(I!==null){I.return=x.return,Nr=I;break}Nr=x.return}}function t(g){for(;Nr!==null;){var x=Nr;try{switch(x.tag){case 0:case 11:case 15:var I=x.return;try{Hd(4,x)}catch(it){Mr(x,I,it)}break;case 1:var F=x.stateNode;if(typeof F.componentDidMount=="function"){var G=x.return;try{F.componentDidMount()}catch(it){Mr(x,G,it)}}var Q=x.return;try{Wd(x)}catch(it){Mr(x,Q,it)}break;case 5:var we=x.return;try{Wd(x)}catch(it){Mr(x,we,it)}}}catch(it){Mr(x,x.return,it)}if(x===g){Nr=null;break}var Ze=x.sibling;if(Ze!==null){Ze.return=x.return,Nr=Ze;break}Nr=x.return}}var s=Math.ceil,d=ke.ReactCurrentDispatcher,_=ke.ReactCurrentOwner,v=ke.ReactCurrentBatchConfig,S=0,E=null,C=null,k=0,L=0,j=pl(0),B=0,q=null,K=0,Z=0,J=0,Y=null,se=null,ce=0,pe=1/0,Se=null,Pe=!1,Me=null,Te=null,Ee=!1,Ae=null,We=0,Le=0,ut=null,Je=-1,dt=0;function wt(){return(S&6)!==0?$n():Je!==-1?Je:Je=$n()}function qe(g){return(g.mode&1)===0?1:(S&2)!==0&&k!==0?k&-k:gc.transition!==null?(dt===0&&(dt=ds()),dt):(g=oi,g!==0||(g=window.event,g=g===void 0?16:al(g.type)),g)}function Re(g,x,I,F){if(50<Le)throw Le=0,ut=null,Error(l(185));ua(g,I,F),((S&2)===0||g!==E)&&(g===E&&((S&2)===0&&(Z|=I),B===4&&Dt(g,k)),tt(g,F),I===1&&S===0&&(x.mode&1)===0&&(pe=$n()+500,hc&&Ll()))}function tt(g,x){var I=g.callbackNode;Nh(g,x);var F=Xu(g,g===E?k:0);if(F===0)I!==null&&Yn(I),g.callbackNode=null,g.callbackPriority=0;else if(x=F&-F,g.callbackPriority!==x){if(I!=null&&Yn(I),x===1)g.tag===0?Ip(lr.bind(null,g)):_d(lr.bind(null,g)),lh(function(){(S&6)===0&&Ll()}),I=null;else{switch($c(F)){case 1:I=qn;break;case 4:I=kn;break;case 16:I=bi;break;case 536870912:I=gi;break;default:I=bi}I=Wn(I,Ye.bind(null,g))}g.callbackPriority=x,g.callbackNode=I}}function Ye(g,x){if(Je=-1,dt=0,(S&6)!==0)throw Error(l(327));var I=g.callbackNode;if(_n()&&g.callbackNode!==I)return null;var F=Xu(g,g===E?k:0);if(F===0)return null;if((F&30)!==0||(F&g.expiredLanes)!==0||x)x=vn(g,F);else{x=F;var G=S;S|=2;var Q=Vr();(E!==g||k!==x)&&(Se=null,pe=$n()+500,ur(g,x));do try{Sn();break}catch(Ze){kr(g,Ze)}while(!0);jl(),d.current=Q,S=G,C!==null?x=0:(E=null,k=0,x=B)}if(x!==0){if(x===2&&(G=Vc(g),G!==0&&(F=G,x=vt(g,G))),x===1)throw I=q,ur(g,0),Dt(g,F),tt(g,$n()),I;if(x===6)Dt(g,F);else{if(G=g.current.alternate,(F&30)===0&&!It(G)&&(x=vn(g,F),x===2&&(Q=Vc(g),Q!==0&&(F=Q,x=vt(g,Q))),x===1))throw I=q,ur(g,0),Dt(g,F),tt(g,$n()),I;switch(g.finishedWork=G,g.finishedLanes=F,x){case 0:case 1:throw Error(l(345));case 2:Gr(g,se,Se);break;case 3:if(Dt(g,F),(F&130023424)===F&&(x=ce+500-$n(),10<x)){if(Xu(g,0)!==0)break;if(G=g.suspendedLanes,(G&F)!==F){wt(),g.pingedLanes|=g.suspendedLanes&G;break}g.timeoutHandle=pd(Gr.bind(null,g,se,Se),x);break}Gr(g,se,Se);break;case 4:if(Dt(g,F),(F&4194240)===F)break;for(x=g.eventTimes,G=-1;0<F;){var we=31-Ta(F);Q=1<<we,we=x[we],we>G&&(G=we),F&=~Q}if(F=G,F=$n()-F,F=(120>F?120:480>F?480:1080>F?1080:1920>F?1920:3e3>F?3e3:4320>F?4320:1960*s(F/1960))-F,10<F){g.timeoutHandle=pd(Gr.bind(null,g,se,Se),F);break}Gr(g,se,Se);break;case 5:Gr(g,se,Se);break;default:throw Error(l(329))}}}return tt(g,$n()),g.callbackNode===I?Ye.bind(null,g):null}function vt(g,x){var I=Y;return g.current.memoizedState.isDehydrated&&(ur(g,x).flags|=256),g=vn(g,x),g!==2&&(x=se,se=I,x!==null&&bt(x)),g}function bt(g){se===null?se=g:se.push.apply(se,g)}function It(g){for(var x=g;;){if(x.flags&16384){var I=x.updateQueue;if(I!==null&&(I=I.stores,I!==null))for(var F=0;F<I.length;F++){var G=I[F],Q=G.getSnapshot;G=G.value;try{if(!_s(Q(),G))return!1}catch{return!1}}}if(I=x.child,x.subtreeFlags&16384&&I!==null)I.return=x,x=I;else{if(x===g)break;for(;x.sibling===null;){if(x.return===null||x.return===g)return!0;x=x.return}x.sibling.return=x.return,x=x.sibling}}return!0}function Dt(g,x){for(x&=~J,x&=~Z,g.suspendedLanes|=x,g.pingedLanes&=~x,g=g.expirationTimes;0<x;){var I=31-Ta(x),F=1<<I;g[I]=-1,x&=~F}}function lr(g){if((S&6)!==0)throw Error(l(327));_n();var x=Xu(g,0);if((x&1)===0)return tt(g,$n()),null;var I=vn(g,x);if(g.tag!==0&&I===2){var F=Vc(g);F!==0&&(x=F,I=vt(g,F))}if(I===1)throw I=q,ur(g,0),Dt(g,x),tt(g,$n()),I;if(I===6)throw Error(l(345));return g.finishedWork=g.current.alternate,g.finishedLanes=x,Gr(g,se,Se),tt(g,$n()),null}function pr(g,x){var I=S;S|=1;try{return g(x)}finally{S=I,S===0&&(pe=$n()+500,hc&&Ll())}}function Yt(g){Ae!==null&&Ae.tag===0&&(S&6)===0&&_n();var x=S;S|=1;var I=v.transition,F=oi;try{if(v.transition=null,oi=1,g)return g()}finally{oi=F,v.transition=I,S=x,(S&6)===0&&Ll()}}function dr(){L=j.current,Ii(j)}function ur(g,x){g.finishedWork=null,g.finishedLanes=0;var I=g.timeoutHandle;if(I!==-1&&(g.timeoutHandle=-1,Ep(I)),C!==null)for(I=C.return;I!==null;){var F=I;switch(vd(F),F.tag){case 1:F=F.type.childContextTypes,F!=null&&Su();break;case 3:So(),Ii(na),Ii(Co),Td();break;case 5:Sd(F);break;case 4:So();break;case 13:Ii(Ji);break;case 19:Ii(Ji);break;case 10:vc(F.type._context);break;case 22:case 23:dr()}I=I.return}if(E=g,C=g=Xo(g.current,null),k=L=x,B=0,q=null,J=Z=K=0,se=Y=null,Ga!==null){for(x=0;x<Ga.length;x++)if(I=Ga[x],F=I.interleaved,F!==null){I.interleaved=null;var G=F.next,Q=I.pending;if(Q!==null){var we=Q.next;Q.next=G,F.next=we}I.pending=F}Ga=null}return g}function kr(g,x){do{var I=C;try{if(jl(),cs.current=ma,bf){for(var F=Hi.memoizedState;F!==null;){var G=F.queue;G!==null&&(G.pending=null),F=F.next}bf=!1}if(Fs=0,No=ao=Hi=null,Ss=!1,Bs=0,_.current=null,I===null||I.return===null){B=1,q=x,C=null;break}e:{var Q=g,we=I.return,Ze=I,it=x;if(x=k,Ze.flags|=32768,it!==null&&typeof it=="object"&&typeof it.then=="function"){var qt=it,mr=Ze,xr=mr.tag;if((mr.mode&1)===0&&(xr===0||xr===11||xr===15)){var _r=mr.alternate;_r?(mr.updateQueue=_r.updateQueue,mr.memoizedState=_r.memoizedState,mr.lanes=_r.lanes):(mr.updateQueue=null,mr.memoizedState=null)}var $r=Ld(we);if($r!==null){$r.flags&=-257,Sh($r,we,Ze,Q,x),$r.mode&1&&Ru(Q,qt,x),x=$r,it=qt;var Kr=x.updateQueue;if(Kr===null){var Qr=new Set;Qr.add(it),x.updateQueue=Qr}else Kr.add(it);break e}else{if((x&1)===0){Ru(Q,qt,x),Xr();break e}it=Error(l(426))}}else if(Ci&&Ze.mode&1){var Do=Ld(we);if(Do!==null){(Do.flags&65536)===0&&(Do.flags|=256),Sh(Do,we,Ze,Q,x),ff($s(it,Ze));break e}}Q=it=$s(it,Ze),B!==4&&(B=2),Y===null?Y=[Q]:Y.push(Q),Q=we;do{switch(Q.tag){case 3:Q.flags|=65536,x&=-x,Q.lanes|=x;var Et=Dd(Q,it,x);Pm(Q,Et);break e;case 1:Ze=it;var ht=Q.type,Lt=Q.stateNode;if((Q.flags&128)===0&&(typeof ht.getDerivedStateFromError=="function"||Lt!==null&&typeof Lt.componentDidCatch=="function"&&(Te===null||!Te.has(Lt)))){Q.flags|=65536,x&=-x,Q.lanes|=x;var Tr=zd(Q,Ze,x);Pm(Q,Tr);break e}}Q=Q.return}while(Q!==null)}Xn(I)}catch(sn){x=sn,C===I&&I!==null&&(C=I=I.return);continue}break}while(!0)}function Vr(){var g=d.current;return d.current=ma,g===null?ma:g}function Xr(){(B===0||B===3||B===2)&&(B=4),E===null||(K&268435455)===0&&(Z&268435455)===0||Dt(E,k)}function vn(g,x){var I=S;S|=2;var F=Vr();(E!==g||k!==x)&&(Se=null,ur(g,x));do try{jr();break}catch(G){kr(g,G)}while(!0);if(jl(),S=I,d.current=F,C!==null)throw Error(l(261));return E=null,k=0,B}function jr(){for(;C!==null;)Mn(C)}function Sn(){for(;C!==null&&!hn();)Mn(C)}function Mn(g){var x=Ln(g.alternate,g,L);g.memoizedProps=g.pendingProps,x===null?Xn(g):C=x,_.current=null}function Xn(g){var x=g;do{var I=x.alternate;if(g=x.return,(x.flags&32768)===0){if(I=jp(I,x,L),I!==null){C=I;return}}else{if(I=qd(I,x),I!==null){I.flags&=32767,C=I;return}if(g!==null)g.flags|=32768,g.subtreeFlags=0,g.deletions=null;else{B=6,C=null;return}}if(x=x.sibling,x!==null){C=x;return}C=x=g}while(x!==null);B===0&&(B=5)}function Gr(g,x,I){var F=oi,G=v.transition;try{v.transition=null,oi=1,Tn(g,x,I,F)}finally{v.transition=G,oi=F}return null}function Tn(g,x,I,F){do _n();while(Ae!==null);if((S&6)!==0)throw Error(l(327));I=g.finishedWork;var G=g.finishedLanes;if(I===null)return null;if(g.finishedWork=null,g.finishedLanes=0,I===g.current)throw Error(l(177));g.callbackNode=null,g.callbackPriority=0;var Q=I.lanes|I.childLanes;if(Sl(g,Q),g===E&&(C=E=null,k=0),(I.subtreeFlags&2064)===0&&(I.flags&2064)===0||Ee||(Ee=!0,Wn(bi,function(){return _n(),null})),Q=(I.flags&15990)!==0,(I.subtreeFlags&15990)!==0||Q){Q=v.transition,v.transition=null;var we=oi;oi=1;var Ze=S;S|=4,_.current=null,km(g,I),zm(I,g),gu(sh),$h=!!ah,sh=ah=null,g.current=I,Lm(I),Li(),S=Ze,oi=we,v.transition=Q}else g.current=I;if(Ee&&(Ee=!1,Ae=g,We=G),Q=g.pendingLanes,Q===0&&(Te=null),Qo(I.stateNode),tt(g,$n()),x!==null)for(F=g.onRecoverableError,I=0;I<x.length;I++)G=x[I],F(G.value,{componentStack:G.stack,digest:G.digest});if(Pe)throw Pe=!1,g=Me,Me=null,g;return(We&1)!==0&&g.tag!==0&&_n(),Q=g.pendingLanes,(Q&1)!==0?g===ut?Le++:(Le=0,ut=g):Le=0,Ll(),null}function _n(){if(Ae!==null){var g=$c(We),x=v.transition,I=oi;try{if(v.transition=null,oi=16>g?16:g,Ae===null)var F=!1;else{if(g=Ae,Ae=null,We=0,(S&6)!==0)throw Error(l(331));var G=S;for(S|=4,Nr=g.current;Nr!==null;){var Q=Nr,we=Q.child;if((Nr.flags&16)!==0){var Ze=Q.deletions;if(Ze!==null){for(var it=0;it<Ze.length;it++){var qt=Ze[it];for(Nr=qt;Nr!==null;){var mr=Nr;switch(mr.tag){case 0:case 11:case 15:Gl(8,mr,Q)}var xr=mr.child;if(xr!==null)xr.return=mr,Nr=xr;else for(;Nr!==null;){mr=Nr;var _r=mr.sibling,$r=mr.return;if(Zd(mr),mr===qt){Nr=null;break}if(_r!==null){_r.return=$r,Nr=_r;break}Nr=$r}}}var Kr=Q.alternate;if(Kr!==null){var Qr=Kr.child;if(Qr!==null){Kr.child=null;do{var Do=Qr.sibling;Qr.sibling=null,Qr=Do}while(Qr!==null)}}Nr=Q}}if((Q.subtreeFlags&2064)!==0&&we!==null)we.return=Q,Nr=we;else e:for(;Nr!==null;){if(Q=Nr,(Q.flags&2048)!==0)switch(Q.tag){case 0:case 11:case 15:Gl(9,Q,Q.return)}var Et=Q.sibling;if(Et!==null){Et.return=Q.return,Nr=Et;break e}Nr=Q.return}}var ht=g.current;for(Nr=ht;Nr!==null;){we=Nr;var Lt=we.child;if((we.subtreeFlags&2064)!==0&&Lt!==null)Lt.return=we,Nr=Lt;else e:for(we=ht;Nr!==null;){if(Ze=Nr,(Ze.flags&2048)!==0)try{switch(Ze.tag){case 0:case 11:case 15:Hd(9,Ze)}}catch(sn){Mr(Ze,Ze.return,sn)}if(Ze===we){Nr=null;break e}var Tr=Ze.sibling;if(Tr!==null){Tr.return=Ze.return,Nr=Tr;break e}Nr=Ze.return}}if(S=G,Ll(),ro&&typeof ro.onPostCommitFiberRoot=="function")try{ro.onPostCommitFiberRoot(oo,g)}catch{}F=!0}return F}finally{oi=I,v.transition=x}}return!1}function zn(g,x,I){x=$s(I,x),x=Dd(g,x,1),g=_l(g,x,1),x=wt(),g!==null&&(ua(g,1,x),tt(g,x))}function Mr(g,x,I){if(g.tag===3)zn(g,g,I);else for(;x!==null;){if(x.tag===3){zn(x,g,I);break}else if(x.tag===1){var F=x.stateNode;if(typeof x.type.getDerivedStateFromError=="function"||typeof F.componentDidCatch=="function"&&(Te===null||!Te.has(F))){g=$s(I,g),g=zd(x,g,1),x=_l(x,g,1),g=wt(),x!==null&&(ua(x,1,g),tt(x,g));break}}x=x.return}}function Gn(g,x,I){var F=g.pingCache;F!==null&&F.delete(x),x=wt(),g.pingedLanes|=g.suspendedLanes&I,E===g&&(k&I)===I&&(B===4||B===3&&(k&130023424)===k&&500>$n()-ce?ur(g,0):J|=I),tt(g,x)}function On(g,x){x===0&&((g.mode&1)===0?x=1:(x=nu,nu<<=1,(nu&130023424)===0&&(nu=4194304)));var I=wt();g=bs(g,x),g!==null&&(ua(g,x,I),tt(g,I))}function Si(g){var x=g.memoizedState,I=0;x!==null&&(I=x.retryLane),On(g,I)}function xn(g,x){var I=0;switch(g.tag){case 13:var F=g.stateNode,G=g.memoizedState;G!==null&&(I=G.retryLane);break;case 19:F=g.stateNode;break;default:throw Error(l(314))}F!==null&&F.delete(x),On(g,I)}var Ln;Ln=function(g,x,I){if(g!==null)if(g.memoizedProps!==x.pendingProps||na.current)To=!0;else{if((g.lanes&I)===0&&(x.flags&128)===0)return To=!1,wi(g,x,I);To=(g.flags&131072)!==0}else To=!1,Ci&&(x.flags&1048576)!==0&&dc(x,yd,x.index);switch(x.lanes=0,x.tag){case 2:var F=x.type;Vd(g,x),g=x.pendingProps;var G=wu(x,Co.current);xc(x,I),G=Au(null,x,F,g,G,I);var Q=Ei();return x.flags|=1,typeof G=="object"&&G!==null&&typeof G.render=="function"&&G.$$typeof===void 0?(x.tag=1,x.memoizedState=null,x.updateQueue=null,ia(F)?(Q=!0,dh(x)):Q=!1,x.memoizedState=G.state!==null&&G.state!==void 0?G.state:null,Ls(x),G.updater=Us,x.stateNode=G,G._reactInternals=x,bh(x,F,g,I),x=Th(null,x,F,!0,Q,I)):(x.tag=0,Ci&&Q&&cf(x),oa(null,x,G,I),x=x.child),x;case 16:F=x.elementType;e:{switch(Vd(g,x),g=x.pendingProps,G=F._init,F=G(F._payload),x.type=F,G=x.tag=Ro(F),g=Ha(F,g),G){case 0:x=If(null,x,F,g,I);break e;case 1:x=Dp(null,x,F,g,I);break e;case 11:x=Fd(null,x,F,g,I);break e;case 14:x=Af(null,x,F,Ha(F.type,g),I);break e}throw Error(l(306,F,""))}return x;case 0:return F=x.type,G=x.pendingProps,G=x.elementType===F?G:Ha(F,G),If(g,x,F,G,I);case 1:return F=x.type,G=x.pendingProps,G=x.elementType===F?G:Ha(F,G),Dp(g,x,F,G,I);case 3:e:{if(Eh(x),g===null)throw Error(l(387));F=x.pendingProps,Q=x.memoizedState,G=Q.element,da(g,x),wc(x,F,null,I);var we=x.memoizedState;if(F=we.element,Q.isDehydrated)if(Q={element:F,isDehydrated:!1,cache:we.cache,pendingSuspenseBoundaries:we.pendingSuspenseBoundaries,transitions:we.transitions},x.updateQueue.baseState=Q,x.memoizedState=Q,x.flags&256){G=$s(Error(l(423)),x),x=Nd(g,x,F,I,G);break e}else if(F!==G){G=$s(Error(l(424)),x),x=Nd(g,x,F,I,G);break e}else for(fa=hl(x.stateNode.containerInfo.firstChild),$a=x,Ci=!0,ss=null,I=bd(x,null,F,I),x.child=I;I;)I.flags=I.flags&-3|4096,I=I.sibling;else{if(mc(),F===G){x=$l(g,x,I);break e}oa(g,x,F,I)}x=x.child}return x;case 5:return Ul(x),g===null&&xd(x),F=x.type,G=x.pendingProps,Q=g!==null?g.memoizedProps:null,we=G.children,vu(F,G)?we=null:Q!==null&&vu(F,Q)&&(x.flags|=32),Pf(g,x),oa(g,x,we,I),x.child;case 6:return g===null&&xd(x),null;case 13:return zp(g,x,I);case 4:return vf(x,x.stateNode.containerInfo),F=x.pendingProps,g===null?x.child=Eu(x,null,F,I):oa(g,x,F,I),x.child;case 11:return F=x.type,G=x.pendingProps,G=x.elementType===F?G:Ha(F,G),Fd(g,x,F,G,I);case 7:return oa(g,x,x.pendingProps,I),x.child;case 8:return oa(g,x,x.pendingProps.children,I),x.child;case 12:return oa(g,x,x.pendingProps.children,I),x.child;case 10:e:{if(F=x.type._context,G=x.pendingProps,Q=x.memoizedProps,we=G.value,Vi(gl,F._currentValue),F._currentValue=we,Q!==null)if(_s(Q.value,we)){if(Q.children===G.children&&!na.current){x=$l(g,x,I);break e}}else for(Q=x.child,Q!==null&&(Q.return=x);Q!==null;){var Ze=Q.dependencies;if(Ze!==null){we=Q.child;for(var it=Ze.firstContext;it!==null;){if(it.context===F){if(Q.tag===1){it=br(-1,I&-I),it.tag=2;var qt=Q.updateQueue;if(qt!==null){qt=qt.shared;var mr=qt.pending;mr===null?it.next=it:(it.next=mr.next,mr.next=it),qt.pending=it}}Q.lanes|=I,it=Q.alternate,it!==null&&(it.lanes|=I),mf(Q.return,I,x),Ze.lanes|=I;break}it=it.next}}else if(Q.tag===10)we=Q.type===x.type?null:Q.child;else if(Q.tag===18){if(we=Q.return,we===null)throw Error(l(341));we.lanes|=I,Ze=we.alternate,Ze!==null&&(Ze.lanes|=I),mf(we,I,x),we=Q.sibling}else we=Q.child;if(we!==null)we.return=Q;else for(we=Q;we!==null;){if(we===x){we=null;break}if(Q=we.sibling,Q!==null){Q.return=we.return,we=Q;break}we=we.return}Q=we}oa(g,x,G.children,I),x=x.child}return x;case 9:return G=x.type,F=x.pendingProps.children,xc(x,I),G=qa(G),F=F(G),x.flags|=1,oa(g,x,F,I),x.child;case 14:return F=x.type,G=Ha(F,x.pendingProps),G=Ha(F.type,G),Af(g,x,F,G,I);case 15:return Cc(g,x,x.type,x.pendingProps,I);case 17:return F=x.type,G=x.pendingProps,G=x.elementType===F?G:Ha(F,G),Vd(g,x),x.tag=1,ia(F)?(g=!0,dh(x)):g=!1,xc(x,I),Vs(x,F,G),bh(x,F,G,I),Th(null,x,F,!0,g,I);case 19:return Fp(g,x,I);case 22:return Bd(g,x,I)}throw Error(l(156,x.tag))};function Wn(g,x){return cn(g,x)}function qi(g,x,I,F){this.tag=g,this.key=I,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=x,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=F,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ti(g,x,I,F){return new qi(g,x,I,F)}function Ni(g){return g=g.prototype,!(!g||!g.isReactComponent)}function Ro(g){if(typeof g=="function")return Ni(g)?1:0;if(g!=null){if(g=g.$$typeof,g===yt)return 11;if(g===xt)return 14}return 2}function Xo(g,x){var I=g.alternate;return I===null?(I=ti(g.tag,x,g.key,g.mode),I.elementType=g.elementType,I.type=g.type,I.stateNode=g.stateNode,I.alternate=g,g.alternate=I):(I.pendingProps=x,I.type=g.type,I.flags=0,I.subtreeFlags=0,I.deletions=null),I.flags=g.flags&14680064,I.childLanes=g.childLanes,I.lanes=g.lanes,I.child=g.child,I.memoizedProps=g.memoizedProps,I.memoizedState=g.memoizedState,I.updateQueue=g.updateQueue,x=g.dependencies,I.dependencies=x===null?null:{lanes:x.lanes,firstContext:x.firstContext},I.sibling=g.sibling,I.index=g.index,I.ref=g.ref,I}function Uo(g,x,I,F,G,Q){var we=2;if(F=g,typeof g=="function")Ni(g)&&(we=1);else if(typeof g=="string")we=5;else e:switch(g){case ze:return ko(I.children,G,Q,x);case Ne:we=8,G|=8;break;case rt:return g=ti(12,I,x,G|2),g.elementType=rt,g.lanes=Q,g;case gt:return g=ti(13,I,x,G),g.elementType=gt,g.lanes=Q,g;case Pt:return g=ti(19,I,x,G),g.elementType=Pt,g.lanes=Q,g;case Ht:return Eo(I,G,Q,x);default:if(typeof g=="object"&&g!==null)switch(g.$$typeof){case kt:we=10;break e;case He:we=9;break e;case yt:we=11;break e;case xt:we=14;break e;case Tt:we=16,F=null;break e}throw Error(l(130,g==null?g:typeof g,""))}return x=ti(we,I,x,G),x.elementType=g,x.type=F,x.lanes=Q,x}function ko(g,x,I,F){return g=ti(7,g,F,x),g.lanes=I,g}function Eo(g,x,I,F){return g=ti(22,g,F,x),g.elementType=Ht,g.lanes=I,g.stateNode={isHidden:!1},g}function Ma(g,x,I){return g=ti(6,g,null,x),g.lanes=I,g}function Za(g,x,I){return x=ti(4,g.children!==null?g.children:[],g.key,x),x.lanes=I,x.stateNode={containerInfo:g.containerInfo,pendingChildren:null,implementation:g.implementation},x}function Ko(g,x,I,F,G){this.tag=x,this.containerInfo=g,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ea(0),this.expirationTimes=Ea(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ea(0),this.identifierPrefix=F,this.onRecoverableError=G,this.mutableSourceEagerHydrationData=null}function Mi(g,x,I,F,G,Q,we,Ze,it){return g=new Ko(g,x,I,Ze,it),x===1?(x=1,Q===!0&&(x|=8)):x=0,Q=ti(3,null,null,x),g.current=Q,Q.stateNode=g,Q.memoizedState={element:F,isDehydrated:I,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ls(Q),g}function Oi(g,x,I){var F=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:_e,key:F==null?null:""+F,children:g,containerInfo:x,implementation:I}}function Jn(g){if(!g)return as;g=g._reactInternals;e:{if(mt(g)!==g||g.tag!==1)throw Error(l(170));var x=g;do{switch(x.tag){case 3:x=x.stateNode.context;break e;case 1:if(ia(x.type)){x=x.stateNode.__reactInternalMemoizedMergedChildContext;break e}}x=x.return}while(x!==null);throw Error(l(171))}if(g.tag===1){var I=g.type;if(ia(I))return gd(g,I,x)}return x}function Qi(g,x,I,F,G,Q,we,Ze,it){return g=Mi(I,F,!0,g,G,Q,we,Ze,it),g.context=Jn(null),I=g.current,F=wt(),G=qe(I),Q=br(F,G),Q.callback=x??null,_l(I,Q,G),g.current.lanes=G,ua(g,G,F),tt(g,F),g}function uo(g,x,I,F){var G=x.current,Q=wt(),we=qe(G);return I=Jn(I),x.context===null?x.context=I:x.pendingContext=I,x=br(Q,we),x.payload={element:g},F=F===void 0?null:F,F!==null&&(x.callback=F),g=_l(G,x,we),g!==null&&(Re(g,G,we,Q),wd(g,G,we)),we}function Ai(g){if(g=g.current,!g.child)return null;switch(g.child.tag){case 5:return g.child.stateNode;default:return g.child.stateNode}}function Xa(g,x){if(g=g.memoizedState,g!==null&&g.dehydrated!==null){var I=g.retryLane;g.retryLane=I!==0&&I<x?I:x}}function Hl(g,x){Xa(g,x),(g=g.alternate)&&Xa(g,x)}function Du(){return null}var Oc=typeof reportError=="function"?reportError:function(g){console.error(g)};function zu(g){this._internalRoot=g}ga.prototype.render=zu.prototype.render=function(g){var x=this._internalRoot;if(x===null)throw Error(l(409));uo(g,x,null,null)},ga.prototype.unmount=zu.prototype.unmount=function(){var g=this._internalRoot;if(g!==null){this._internalRoot=null;var x=g.containerInfo;Yt(function(){uo(null,g,null,null)}),x[dl]=null}};function ga(g){this._internalRoot=g}ga.prototype.unstable_scheduleHydration=function(g){if(g){var x=Ju();g={blockedOn:null,target:g,priority:x};for(var I=0;I<ms.length&&x!==0&&x<ms[I].priority;I++);ms.splice(I,0,g),I===0&&wm(g)}};function Ts(g){return!(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11)}function Gi(g){return!(!g||g.nodeType!==1&&g.nodeType!==9&&g.nodeType!==11&&(g.nodeType!==8||g.nodeValue!==" react-mount-point-unstable "))}function Ka(){}function Rc(g,x,I,F,G){if(G){if(typeof F=="function"){var Q=F;F=function(){var qt=Ai(we);Q.call(qt)}}var we=Qi(x,F,g,0,null,!1,!1,"",Ka);return g._reactRootContainer=we,g[dl]=we.current,rf(g.nodeType===8?g.parentNode:g),Yt(),we}for(;G=g.lastChild;)g.removeChild(G);if(typeof F=="function"){var Ze=F;F=function(){var qt=Ai(it);Ze.call(qt)}}var it=Mi(g,0,!1,null,null,!1,!1,"",Ka);return g._reactRootContainer=it,g[dl]=it.current,rf(g.nodeType===8?g.parentNode:g),Yt(function(){uo(x,it,I,F)}),it}function Fm(g,x,I,F,G){var Q=I._reactRootContainer;if(Q){var we=Q;if(typeof G=="function"){var Ze=G;G=function(){var it=Ai(we);Ze.call(it)}}uo(x,we,g,G)}else we=Rc(I,x,g,G,F);return Ai(we)}Os=function(g){switch(g.tag){case 3:var x=g.stateNode;if(x.current.memoizedState.isDehydrated){var I=iu(x.pendingLanes);I!==0&&(rs(x,I|1),tt(x,$n()),(S&6)===0&&(pe=$n()+500,Ll()))}break;case 13:Yt(function(){var F=bs(g,1);if(F!==null){var G=wt();Re(F,g,1,G)}}),Hl(g,1)}},Yu=function(g){if(g.tag===13){var x=bs(g,134217728);if(x!==null){var I=wt();Re(x,g,134217728,I)}Hl(g,134217728)}},ou=function(g){if(g.tag===13){var x=qe(g),I=bs(g,x);if(I!==null){var F=wt();Re(I,g,x,F)}Hl(g,x)}},Ju=function(){return oi},Qf=function(g,x){var I=oi;try{return oi=g,x()}finally{oi=I}},Hu=function(g,x,I){switch(x){case"input":if(Ki(g,I),x=I.name,I.type==="radio"&&x!=null){for(I=g;I.parentNode;)I=I.parentNode;for(I=I.querySelectorAll("input[name="+JSON.stringify(""+x)+'][type="radio"]'),x=0;x<I.length;x++){var F=I[x];if(F!==g&&F.form===g.form){var G=fh(F);if(!G)throw Error(l(90));sr(F),Ki(F,G)}}}break;case"textarea":Ms(g,I);break;case"select":x=I.value,x!=null&&Ui(g,!!I.multiple,x,!1)}},il=pr,Yf=Yt;var Bm={usingClientEntryPoint:!1,Events:[hh,bu,fh,Wu,Ct,pr]},Vp={findFiberByHostInstance:cc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Xy={bundleType:Vp.bundleType,version:Vp.version,rendererPackageName:Vp.rendererPackageName,rendererConfig:Vp.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ke.ReactCurrentDispatcher,findHostInstanceByFiber:function(g){return g=ln(g),g===null?null:g.stateNode},findFiberByHostInstance:Vp.findFiberByHostInstance||Du,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Of=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Of.isDisabled&&Of.supportsFiber)try{oo=Of.inject(Xy),ro=Of}catch{}}return vl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Bm,vl.createPortal=function(g,x){var I=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ts(x))throw Error(l(200));return Oi(g,x,null,I)},vl.createRoot=function(g,x){if(!Ts(g))throw Error(l(299));var I=!1,F="",G=Oc;return x!=null&&(x.unstable_strictMode===!0&&(I=!0),x.identifierPrefix!==void 0&&(F=x.identifierPrefix),x.onRecoverableError!==void 0&&(G=x.onRecoverableError)),x=Mi(g,1,!1,null,null,I,!1,F,G),g[dl]=x.current,rf(g.nodeType===8?g.parentNode:g),new zu(x)},vl.findDOMNode=function(g){if(g==null)return null;if(g.nodeType===1)return g;var x=g._reactInternals;if(x===void 0)throw typeof g.render=="function"?Error(l(188)):(g=Object.keys(g).join(","),Error(l(268,g)));return g=ln(x),g=g===null?null:g.stateNode,g},vl.flushSync=function(g){return Yt(g)},vl.hydrate=function(g,x,I){if(!Gi(x))throw Error(l(200));return Fm(null,g,x,!0,I)},vl.hydrateRoot=function(g,x,I){if(!Ts(g))throw Error(l(405));var F=I!=null&&I.hydratedSources||null,G=!1,Q="",we=Oc;if(I!=null&&(I.unstable_strictMode===!0&&(G=!0),I.identifierPrefix!==void 0&&(Q=I.identifierPrefix),I.onRecoverableError!==void 0&&(we=I.onRecoverableError)),x=Qi(x,null,g,1,I??null,G,!1,Q,we),g[dl]=x.current,rf(g),F)for(g=0;g<F.length;g++)I=F[g],G=I._getVersion,G=G(I._source),x.mutableSourceEagerHydrationData==null?x.mutableSourceEagerHydrationData=[I,G]:x.mutableSourceEagerHydrationData.push(I,G);return new ga(x)},vl.render=function(g,x,I){if(!Gi(x))throw Error(l(200));return Fm(null,g,x,!1,I)},vl.unmountComponentAtNode=function(g){if(!Gi(g))throw Error(l(40));return g._reactRootContainer?(Yt(function(){Fm(null,null,g,!1,function(){g._reactRootContainer=null,g[dl]=null})}),!0):!1},vl.unstable_batchedUpdates=pr,vl.unstable_renderSubtreeIntoContainer=function(g,x,I,F){if(!Gi(I))throw Error(l(200));if(g==null||g._reactInternals===void 0)throw Error(l(38));return Fm(g,x,I,!1,F)},vl.version="18.3.1-next-f1338f8080-20240426",vl}var SM;function LU(){if(SM)return e1.exports;SM=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(n){console.error(n)}}return r(),e1.exports=zU(),e1.exports}var TM;function FU(){if(TM)return Uv;TM=1;var r=LU();return Uv.createRoot=r.createRoot,Uv.hydrateRoot=r.hydrateRoot,Uv}var BU=FU(),ir=RA();const ct=Xi(ir);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NU=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),jU=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(n,l,c)=>c?c.toUpperCase():l.toLowerCase()),EM=r=>{const n=jU(r);return n.charAt(0).toUpperCase()+n.slice(1)},R3=(...r)=>r.filter((n,l,c)=>!!n&&n.trim()!==""&&c.indexOf(n)===l).join(" ").trim();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var UU={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VU=ir.forwardRef(({color:r="currentColor",size:n=24,strokeWidth:l=2,absoluteStrokeWidth:c,className:y="",children:w,iconNode:P,...a},R)=>ir.createElement("svg",{ref:R,...UU,width:n,height:n,stroke:r,strokeWidth:c?Number(l)*24/Number(n):l,className:R3("lucide",y),...a},[...P.map(([z,$])=>ir.createElement(z,$)),...Array.isArray(w)?w:[w]]));/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gm=(r,n)=>{const l=ir.forwardRef(({className:c,...y},w)=>ir.createElement(VU,{ref:w,iconNode:n,className:R3(`lucide-${NU(EM(r))}`,`lucide-${r}`,c),...y}));return l.displayName=EM(r),l};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $U=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],qU=gm("arrow-right",$U);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GU=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],AM=gm("calendar",GU);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HU=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],WU=gm("chevron-down",HU);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZU=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],XU=gm("ellipsis",ZU);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KU=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],YU=gm("info",KU);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JU=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],QU=gm("layout-dashboard",JU);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eV=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],tV=gm("search",eV);function k3(r){var n,l,c="";if(typeof r=="string"||typeof r=="number")c+=r;else if(typeof r=="object")if(Array.isArray(r)){var y=r.length;for(n=0;n<y;n++)r[n]&&(l=k3(r[n]))&&(c&&(c+=" "),c+=l)}else for(l in r)r[l]&&(c&&(c+=" "),c+=l);return c}function ui(){for(var r,n,l=0,c="",y=arguments.length;l<y;l++)(r=arguments[l])&&(n=k3(r))&&(c&&(c+=" "),c+=n);return c}const kA="-",rV=r=>{const n=iV(r),{conflictingClassGroups:l,conflictingClassGroupModifiers:c}=r;return{getClassGroupId:P=>{const a=P.split(kA);return a[0]===""&&a.length!==1&&a.shift(),D3(a,n)||nV(P)},getConflictingClassGroupIds:(P,a)=>{const R=l[P]||[];return a&&c[P]?[...R,...c[P]]:R}}},D3=(r,n)=>{if(r.length===0)return n.classGroupId;const l=r[0],c=n.nextPart.get(l),y=c?D3(r.slice(1),c):void 0;if(y)return y;if(n.validators.length===0)return;const w=r.join(kA);return n.validators.find(({validator:P})=>P(w))?.classGroupId},PM=/^\[(.+)\]$/,nV=r=>{if(PM.test(r)){const n=PM.exec(r)[1],l=n?.substring(0,n.indexOf(":"));if(l)return"arbitrary.."+l}},iV=r=>{const{theme:n,classGroups:l}=r,c={nextPart:new Map,validators:[]};for(const y in l)sE(l[y],c,y,n);return c},sE=(r,n,l,c)=>{r.forEach(y=>{if(typeof y=="string"){const w=y===""?n:IM(n,y);w.classGroupId=l;return}if(typeof y=="function"){if(oV(y)){sE(y(c),n,l,c);return}n.validators.push({validator:y,classGroupId:l});return}Object.entries(y).forEach(([w,P])=>{sE(P,IM(n,w),l,c)})})},IM=(r,n)=>{let l=r;return n.split(kA).forEach(c=>{l.nextPart.has(c)||l.nextPart.set(c,{nextPart:new Map,validators:[]}),l=l.nextPart.get(c)}),l},oV=r=>r.isThemeGetter,aV=r=>{if(r<1)return{get:()=>{},set:()=>{}};let n=0,l=new Map,c=new Map;const y=(w,P)=>{l.set(w,P),n++,n>r&&(n=0,c=l,l=new Map)};return{get(w){let P=l.get(w);if(P!==void 0)return P;if((P=c.get(w))!==void 0)return y(w,P),P},set(w,P){l.has(w)?l.set(w,P):y(w,P)}}},lE="!",uE=":",sV=uE.length,lV=r=>{const{prefix:n,experimentalParseClassName:l}=r;let c=y=>{const w=[];let P=0,a=0,R=0,z;for(let ae=0;ae<y.length;ae++){let ee=y[ae];if(P===0&&a===0){if(ee===uE){w.push(y.slice(R,ae)),R=ae+sV;continue}if(ee==="/"){z=ae;continue}}ee==="["?P++:ee==="]"?P--:ee==="("?a++:ee===")"&&a--}const $=w.length===0?y:y.substring(R),V=uV($),W=V!==$,ie=z&&z>R?z-R:void 0;return{modifiers:w,hasImportantModifier:W,baseClassName:V,maybePostfixModifierPosition:ie}};if(n){const y=n+uE,w=c;c=P=>P.startsWith(y)?w(P.substring(y.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:P,maybePostfixModifierPosition:void 0}}if(l){const y=c;c=w=>l({className:w,parseClassName:y})}return c},uV=r=>r.endsWith(lE)?r.substring(0,r.length-1):r.startsWith(lE)?r.substring(1):r,cV=r=>{const n=Object.fromEntries(r.orderSensitiveModifiers.map(c=>[c,!0]));return c=>{if(c.length<=1)return c;const y=[];let w=[];return c.forEach(P=>{P[0]==="["||n[P]?(y.push(...w.sort(),P),w=[]):w.push(P)}),y.push(...w.sort()),y}},hV=r=>({cache:aV(r.cacheSize),parseClassName:lV(r),sortModifiers:cV(r),...rV(r)}),fV=/\s+/,dV=(r,n)=>{const{parseClassName:l,getClassGroupId:c,getConflictingClassGroupIds:y,sortModifiers:w}=n,P=[],a=r.trim().split(fV);let R="";for(let z=a.length-1;z>=0;z-=1){const $=a[z],{isExternal:V,modifiers:W,hasImportantModifier:ie,baseClassName:ae,maybePostfixModifierPosition:ee}=l($);if(V){R=$+(R.length>0?" "+R:R);continue}let ne=!!ee,de=c(ne?ae.substring(0,ee):ae);if(!de){if(!ne){R=$+(R.length>0?" "+R:R);continue}if(de=c(ae),!de){R=$+(R.length>0?" "+R:R);continue}ne=!1}const xe=w(W).join(":"),be=ie?xe+lE:xe,ke=be+de;if(P.includes(ke))continue;P.push(ke);const he=y(de,ne);for(let _e=0;_e<he.length;++_e){const ze=he[_e];P.push(be+ze)}R=$+(R.length>0?" "+R:R)}return R};function pV(){let r=0,n,l,c="";for(;r<arguments.length;)(n=arguments[r++])&&(l=z3(n))&&(c&&(c+=" "),c+=l);return c}const z3=r=>{if(typeof r=="string")return r;let n,l="";for(let c=0;c<r.length;c++)r[c]&&(n=z3(r[c]))&&(l&&(l+=" "),l+=n);return l};function mV(r,...n){let l,c,y,w=P;function P(R){const z=n.reduce(($,V)=>V($),r());return l=hV(z),c=l.cache.get,y=l.cache.set,w=a,a(R)}function a(R){const z=c(R);if(z)return z;const $=dV(R,l);return y(R,$),$}return function(){return w(pV.apply(null,arguments))}}const Ra=r=>{const n=l=>l[r]||[];return n.isThemeGetter=!0,n},L3=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,F3=/^\((?:(\w[\w-]*):)?(.+)\)$/i,gV=/^\d+\/\d+$/,_V=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,yV=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,vV=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,xV=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,bV=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,rg=r=>gV.test(r),mi=r=>!!r&&!Number.isNaN(Number(r)),ip=r=>!!r&&Number.isInteger(Number(r)),n1=r=>r.endsWith("%")&&mi(r.slice(0,-1)),kf=r=>_V.test(r),wV=()=>!0,SV=r=>yV.test(r)&&!vV.test(r),B3=()=>!1,TV=r=>xV.test(r),EV=r=>bV.test(r),AV=r=>!on(r)&&!an(r),PV=r=>jg(r,U3,B3),on=r=>L3.test(r),Yp=r=>jg(r,V3,SV),i1=r=>jg(r,RV,mi),CM=r=>jg(r,N3,B3),IV=r=>jg(r,j3,EV),Vv=r=>jg(r,$3,TV),an=r=>F3.test(r),j_=r=>Ug(r,V3),CV=r=>Ug(r,kV),MM=r=>Ug(r,N3),MV=r=>Ug(r,U3),OV=r=>Ug(r,j3),$v=r=>Ug(r,$3,!0),jg=(r,n,l)=>{const c=L3.exec(r);return c?c[1]?n(c[1]):l(c[2]):!1},Ug=(r,n,l=!1)=>{const c=F3.exec(r);return c?c[1]?n(c[1]):l:!1},N3=r=>r==="position"||r==="percentage",j3=r=>r==="image"||r==="url",U3=r=>r==="length"||r==="size"||r==="bg-size",V3=r=>r==="length",RV=r=>r==="number",kV=r=>r==="family-name",$3=r=>r==="shadow",DV=()=>{const r=Ra("color"),n=Ra("font"),l=Ra("text"),c=Ra("font-weight"),y=Ra("tracking"),w=Ra("leading"),P=Ra("breakpoint"),a=Ra("container"),R=Ra("spacing"),z=Ra("radius"),$=Ra("shadow"),V=Ra("inset-shadow"),W=Ra("text-shadow"),ie=Ra("drop-shadow"),ae=Ra("blur"),ee=Ra("perspective"),ne=Ra("aspect"),de=Ra("ease"),xe=Ra("animate"),be=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ke=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],he=()=>[...ke(),an,on],_e=()=>["auto","hidden","clip","visible","scroll"],ze=()=>["auto","contain","none"],Ne=()=>[an,on,R],rt=()=>[rg,"full","auto",...Ne()],kt=()=>[ip,"none","subgrid",an,on],He=()=>["auto",{span:["full",ip,an,on]},ip,an,on],yt=()=>[ip,"auto",an,on],gt=()=>["auto","min","max","fr",an,on],Pt=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],xt=()=>["start","end","center","stretch","center-safe","end-safe"],Tt=()=>["auto",...Ne()],Ht=()=>[rg,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...Ne()],lt=()=>[r,an,on],Wt=()=>[...ke(),MM,CM,{position:[an,on]}],Zt=()=>["no-repeat",{repeat:["","x","y","space","round"]}],$e=()=>["auto","cover","contain",MV,PV,{size:[an,on]}],pt=()=>[n1,j_,Yp],fr=()=>["","none","full",z,an,on],zr=()=>["",mi,j_,Yp],Hr=()=>["solid","dashed","dotted","double"],Ir=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Lr=()=>[mi,n1,MM,CM],Ur=()=>["","none",ae,an,on],or=()=>["none",mi,an,on],Er=()=>["none",mi,an,on],pn=()=>[mi,an,on],sr=()=>[rg,"full",...Ne()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[kf],breakpoint:[kf],color:[wV],container:[kf],"drop-shadow":[kf],ease:["in","out","in-out"],font:[AV],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[kf],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[kf],shadow:[kf],spacing:["px",mi],text:[kf],"text-shadow":[kf],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",rg,on,an,ne]}],container:["container"],columns:[{columns:[mi,on,an,a]}],"break-after":[{"break-after":be()}],"break-before":[{"break-before":be()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:he()}],overflow:[{overflow:_e()}],"overflow-x":[{"overflow-x":_e()}],"overflow-y":[{"overflow-y":_e()}],overscroll:[{overscroll:ze()}],"overscroll-x":[{"overscroll-x":ze()}],"overscroll-y":[{"overscroll-y":ze()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:rt()}],"inset-x":[{"inset-x":rt()}],"inset-y":[{"inset-y":rt()}],start:[{start:rt()}],end:[{end:rt()}],top:[{top:rt()}],right:[{right:rt()}],bottom:[{bottom:rt()}],left:[{left:rt()}],visibility:["visible","invisible","collapse"],z:[{z:[ip,"auto",an,on]}],basis:[{basis:[rg,"full","auto",a,...Ne()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[mi,rg,"auto","initial","none",on]}],grow:[{grow:["",mi,an,on]}],shrink:[{shrink:["",mi,an,on]}],order:[{order:[ip,"first","last","none",an,on]}],"grid-cols":[{"grid-cols":kt()}],"col-start-end":[{col:He()}],"col-start":[{"col-start":yt()}],"col-end":[{"col-end":yt()}],"grid-rows":[{"grid-rows":kt()}],"row-start-end":[{row:He()}],"row-start":[{"row-start":yt()}],"row-end":[{"row-end":yt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":gt()}],"auto-rows":[{"auto-rows":gt()}],gap:[{gap:Ne()}],"gap-x":[{"gap-x":Ne()}],"gap-y":[{"gap-y":Ne()}],"justify-content":[{justify:[...Pt(),"normal"]}],"justify-items":[{"justify-items":[...xt(),"normal"]}],"justify-self":[{"justify-self":["auto",...xt()]}],"align-content":[{content:["normal",...Pt()]}],"align-items":[{items:[...xt(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...xt(),{baseline:["","last"]}]}],"place-content":[{"place-content":Pt()}],"place-items":[{"place-items":[...xt(),"baseline"]}],"place-self":[{"place-self":["auto",...xt()]}],p:[{p:Ne()}],px:[{px:Ne()}],py:[{py:Ne()}],ps:[{ps:Ne()}],pe:[{pe:Ne()}],pt:[{pt:Ne()}],pr:[{pr:Ne()}],pb:[{pb:Ne()}],pl:[{pl:Ne()}],m:[{m:Tt()}],mx:[{mx:Tt()}],my:[{my:Tt()}],ms:[{ms:Tt()}],me:[{me:Tt()}],mt:[{mt:Tt()}],mr:[{mr:Tt()}],mb:[{mb:Tt()}],ml:[{ml:Tt()}],"space-x":[{"space-x":Ne()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":Ne()}],"space-y-reverse":["space-y-reverse"],size:[{size:Ht()}],w:[{w:[a,"screen",...Ht()]}],"min-w":[{"min-w":[a,"screen","none",...Ht()]}],"max-w":[{"max-w":[a,"screen","none","prose",{screen:[P]},...Ht()]}],h:[{h:["screen","lh",...Ht()]}],"min-h":[{"min-h":["screen","lh","none",...Ht()]}],"max-h":[{"max-h":["screen","lh",...Ht()]}],"font-size":[{text:["base",l,j_,Yp]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[c,an,i1]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",n1,on]}],"font-family":[{font:[CV,on,n]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[y,an,on]}],"line-clamp":[{"line-clamp":[mi,"none",an,i1]}],leading:[{leading:[w,...Ne()]}],"list-image":[{"list-image":["none",an,on]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",an,on]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:lt()}],"text-color":[{text:lt()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Hr(),"wavy"]}],"text-decoration-thickness":[{decoration:[mi,"from-font","auto",an,Yp]}],"text-decoration-color":[{decoration:lt()}],"underline-offset":[{"underline-offset":[mi,"auto",an,on]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ne()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",an,on]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",an,on]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Wt()}],"bg-repeat":[{bg:Zt()}],"bg-size":[{bg:$e()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},ip,an,on],radial:["",an,on],conic:[ip,an,on]},OV,IV]}],"bg-color":[{bg:lt()}],"gradient-from-pos":[{from:pt()}],"gradient-via-pos":[{via:pt()}],"gradient-to-pos":[{to:pt()}],"gradient-from":[{from:lt()}],"gradient-via":[{via:lt()}],"gradient-to":[{to:lt()}],rounded:[{rounded:fr()}],"rounded-s":[{"rounded-s":fr()}],"rounded-e":[{"rounded-e":fr()}],"rounded-t":[{"rounded-t":fr()}],"rounded-r":[{"rounded-r":fr()}],"rounded-b":[{"rounded-b":fr()}],"rounded-l":[{"rounded-l":fr()}],"rounded-ss":[{"rounded-ss":fr()}],"rounded-se":[{"rounded-se":fr()}],"rounded-ee":[{"rounded-ee":fr()}],"rounded-es":[{"rounded-es":fr()}],"rounded-tl":[{"rounded-tl":fr()}],"rounded-tr":[{"rounded-tr":fr()}],"rounded-br":[{"rounded-br":fr()}],"rounded-bl":[{"rounded-bl":fr()}],"border-w":[{border:zr()}],"border-w-x":[{"border-x":zr()}],"border-w-y":[{"border-y":zr()}],"border-w-s":[{"border-s":zr()}],"border-w-e":[{"border-e":zr()}],"border-w-t":[{"border-t":zr()}],"border-w-r":[{"border-r":zr()}],"border-w-b":[{"border-b":zr()}],"border-w-l":[{"border-l":zr()}],"divide-x":[{"divide-x":zr()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":zr()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...Hr(),"hidden","none"]}],"divide-style":[{divide:[...Hr(),"hidden","none"]}],"border-color":[{border:lt()}],"border-color-x":[{"border-x":lt()}],"border-color-y":[{"border-y":lt()}],"border-color-s":[{"border-s":lt()}],"border-color-e":[{"border-e":lt()}],"border-color-t":[{"border-t":lt()}],"border-color-r":[{"border-r":lt()}],"border-color-b":[{"border-b":lt()}],"border-color-l":[{"border-l":lt()}],"divide-color":[{divide:lt()}],"outline-style":[{outline:[...Hr(),"none","hidden"]}],"outline-offset":[{"outline-offset":[mi,an,on]}],"outline-w":[{outline:["",mi,j_,Yp]}],"outline-color":[{outline:lt()}],shadow:[{shadow:["","none",$,$v,Vv]}],"shadow-color":[{shadow:lt()}],"inset-shadow":[{"inset-shadow":["none",V,$v,Vv]}],"inset-shadow-color":[{"inset-shadow":lt()}],"ring-w":[{ring:zr()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:lt()}],"ring-offset-w":[{"ring-offset":[mi,Yp]}],"ring-offset-color":[{"ring-offset":lt()}],"inset-ring-w":[{"inset-ring":zr()}],"inset-ring-color":[{"inset-ring":lt()}],"text-shadow":[{"text-shadow":["none",W,$v,Vv]}],"text-shadow-color":[{"text-shadow":lt()}],opacity:[{opacity:[mi,an,on]}],"mix-blend":[{"mix-blend":[...Ir(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":Ir()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[mi]}],"mask-image-linear-from-pos":[{"mask-linear-from":Lr()}],"mask-image-linear-to-pos":[{"mask-linear-to":Lr()}],"mask-image-linear-from-color":[{"mask-linear-from":lt()}],"mask-image-linear-to-color":[{"mask-linear-to":lt()}],"mask-image-t-from-pos":[{"mask-t-from":Lr()}],"mask-image-t-to-pos":[{"mask-t-to":Lr()}],"mask-image-t-from-color":[{"mask-t-from":lt()}],"mask-image-t-to-color":[{"mask-t-to":lt()}],"mask-image-r-from-pos":[{"mask-r-from":Lr()}],"mask-image-r-to-pos":[{"mask-r-to":Lr()}],"mask-image-r-from-color":[{"mask-r-from":lt()}],"mask-image-r-to-color":[{"mask-r-to":lt()}],"mask-image-b-from-pos":[{"mask-b-from":Lr()}],"mask-image-b-to-pos":[{"mask-b-to":Lr()}],"mask-image-b-from-color":[{"mask-b-from":lt()}],"mask-image-b-to-color":[{"mask-b-to":lt()}],"mask-image-l-from-pos":[{"mask-l-from":Lr()}],"mask-image-l-to-pos":[{"mask-l-to":Lr()}],"mask-image-l-from-color":[{"mask-l-from":lt()}],"mask-image-l-to-color":[{"mask-l-to":lt()}],"mask-image-x-from-pos":[{"mask-x-from":Lr()}],"mask-image-x-to-pos":[{"mask-x-to":Lr()}],"mask-image-x-from-color":[{"mask-x-from":lt()}],"mask-image-x-to-color":[{"mask-x-to":lt()}],"mask-image-y-from-pos":[{"mask-y-from":Lr()}],"mask-image-y-to-pos":[{"mask-y-to":Lr()}],"mask-image-y-from-color":[{"mask-y-from":lt()}],"mask-image-y-to-color":[{"mask-y-to":lt()}],"mask-image-radial":[{"mask-radial":[an,on]}],"mask-image-radial-from-pos":[{"mask-radial-from":Lr()}],"mask-image-radial-to-pos":[{"mask-radial-to":Lr()}],"mask-image-radial-from-color":[{"mask-radial-from":lt()}],"mask-image-radial-to-color":[{"mask-radial-to":lt()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":ke()}],"mask-image-conic-pos":[{"mask-conic":[mi]}],"mask-image-conic-from-pos":[{"mask-conic-from":Lr()}],"mask-image-conic-to-pos":[{"mask-conic-to":Lr()}],"mask-image-conic-from-color":[{"mask-conic-from":lt()}],"mask-image-conic-to-color":[{"mask-conic-to":lt()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Wt()}],"mask-repeat":[{mask:Zt()}],"mask-size":[{mask:$e()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",an,on]}],filter:[{filter:["","none",an,on]}],blur:[{blur:Ur()}],brightness:[{brightness:[mi,an,on]}],contrast:[{contrast:[mi,an,on]}],"drop-shadow":[{"drop-shadow":["","none",ie,$v,Vv]}],"drop-shadow-color":[{"drop-shadow":lt()}],grayscale:[{grayscale:["",mi,an,on]}],"hue-rotate":[{"hue-rotate":[mi,an,on]}],invert:[{invert:["",mi,an,on]}],saturate:[{saturate:[mi,an,on]}],sepia:[{sepia:["",mi,an,on]}],"backdrop-filter":[{"backdrop-filter":["","none",an,on]}],"backdrop-blur":[{"backdrop-blur":Ur()}],"backdrop-brightness":[{"backdrop-brightness":[mi,an,on]}],"backdrop-contrast":[{"backdrop-contrast":[mi,an,on]}],"backdrop-grayscale":[{"backdrop-grayscale":["",mi,an,on]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[mi,an,on]}],"backdrop-invert":[{"backdrop-invert":["",mi,an,on]}],"backdrop-opacity":[{"backdrop-opacity":[mi,an,on]}],"backdrop-saturate":[{"backdrop-saturate":[mi,an,on]}],"backdrop-sepia":[{"backdrop-sepia":["",mi,an,on]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":Ne()}],"border-spacing-x":[{"border-spacing-x":Ne()}],"border-spacing-y":[{"border-spacing-y":Ne()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",an,on]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[mi,"initial",an,on]}],ease:[{ease:["linear","initial",de,an,on]}],delay:[{delay:[mi,an,on]}],animate:[{animate:["none",xe,an,on]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[ee,an,on]}],"perspective-origin":[{"perspective-origin":he()}],rotate:[{rotate:or()}],"rotate-x":[{"rotate-x":or()}],"rotate-y":[{"rotate-y":or()}],"rotate-z":[{"rotate-z":or()}],scale:[{scale:Er()}],"scale-x":[{"scale-x":Er()}],"scale-y":[{"scale-y":Er()}],"scale-z":[{"scale-z":Er()}],"scale-3d":["scale-3d"],skew:[{skew:pn()}],"skew-x":[{"skew-x":pn()}],"skew-y":[{"skew-y":pn()}],transform:[{transform:[an,on,"","none","gpu","cpu"]}],"transform-origin":[{origin:he()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:sr()}],"translate-x":[{"translate-x":sr()}],"translate-y":[{"translate-y":sr()}],"translate-z":[{"translate-z":sr()}],"translate-none":["translate-none"],accent:[{accent:lt()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:lt()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",an,on]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ne()}],"scroll-mx":[{"scroll-mx":Ne()}],"scroll-my":[{"scroll-my":Ne()}],"scroll-ms":[{"scroll-ms":Ne()}],"scroll-me":[{"scroll-me":Ne()}],"scroll-mt":[{"scroll-mt":Ne()}],"scroll-mr":[{"scroll-mr":Ne()}],"scroll-mb":[{"scroll-mb":Ne()}],"scroll-ml":[{"scroll-ml":Ne()}],"scroll-p":[{"scroll-p":Ne()}],"scroll-px":[{"scroll-px":Ne()}],"scroll-py":[{"scroll-py":Ne()}],"scroll-ps":[{"scroll-ps":Ne()}],"scroll-pe":[{"scroll-pe":Ne()}],"scroll-pt":[{"scroll-pt":Ne()}],"scroll-pr":[{"scroll-pr":Ne()}],"scroll-pb":[{"scroll-pb":Ne()}],"scroll-pl":[{"scroll-pl":Ne()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",an,on]}],fill:[{fill:["none",...lt()]}],"stroke-w":[{stroke:[mi,j_,Yp,i1]}],stroke:[{stroke:["none",...lt()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},zV=mV(DV);function Hf(...r){return zV(ui(r))}function cE({className:r,type:n,...l}){return Bt.jsx("input",{type:n,"data-slot":"input",className:Hf("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",r),...l})}function OM(r,n){if(typeof r=="function")return r(n);r!=null&&(r.current=n)}function LV(...r){return n=>{let l=!1;const c=r.map(y=>{const w=OM(y,n);return!l&&typeof w=="function"&&(l=!0),w});if(l)return()=>{for(let y=0;y<c.length;y++){const w=c[y];typeof w=="function"?w():OM(r[y],null)}}}}function FV(r){const n=NV(r),l=ir.forwardRef((c,y)=>{const{children:w,...P}=c,a=ir.Children.toArray(w),R=a.find(UV);if(R){const z=R.props.children,$=a.map(V=>V===R?ir.Children.count(z)>1?ir.Children.only(null):ir.isValidElement(z)?z.props.children:null:V);return Bt.jsx(n,{...P,ref:y,children:ir.isValidElement(z)?ir.cloneElement(z,void 0,$):null})}return Bt.jsx(n,{...P,ref:y,children:w})});return l.displayName=`${r}.Slot`,l}var BV=FV("Slot");function NV(r){const n=ir.forwardRef((l,c)=>{const{children:y,...w}=l;if(ir.isValidElement(y)){const P=$V(y),a=VV(w,y.props);return y.type!==ir.Fragment&&(a.ref=c?LV(c,P):P),ir.cloneElement(y,a)}return ir.Children.count(y)>1?ir.Children.only(null):null});return n.displayName=`${r}.SlotClone`,n}var jV=Symbol("radix.slottable");function UV(r){return ir.isValidElement(r)&&typeof r.type=="function"&&"__radixId"in r.type&&r.type.__radixId===jV}function VV(r,n){const l={...n};for(const c in n){const y=r[c],w=n[c];/^on[A-Z]/.test(c)?y&&w?l[c]=(...a)=>{const R=w(...a);return y(...a),R}:y&&(l[c]=y):c==="style"?l[c]={...y,...w}:c==="className"&&(l[c]=[y,w].filter(Boolean).join(" "))}return{...r,...l}}function $V(r){let n=Object.getOwnPropertyDescriptor(r.props,"ref")?.get,l=n&&"isReactWarning"in n&&n.isReactWarning;return l?r.ref:(n=Object.getOwnPropertyDescriptor(r,"ref")?.get,l=n&&"isReactWarning"in n&&n.isReactWarning,l?r.props.ref:r.props.ref||r.ref)}const RM=r=>typeof r=="boolean"?`${r}`:r===0?"0":r,kM=ui,qV=(r,n)=>l=>{var c;if(n?.variants==null)return kM(r,l?.class,l?.className);const{variants:y,defaultVariants:w}=n,P=Object.keys(y).map(z=>{const $=l?.[z],V=w?.[z];if($===null)return null;const W=RM($)||RM(V);return y[z][W]}),a=l&&Object.entries(l).reduce((z,$)=>{let[V,W]=$;return W===void 0||(z[V]=W),z},{}),R=n==null||(c=n.compoundVariants)===null||c===void 0?void 0:c.reduce((z,$)=>{let{class:V,className:W,...ie}=$;return Object.entries(ie).every(ae=>{let[ee,ne]=ae;return Array.isArray(ne)?ne.includes({...w,...a}[ee]):{...w,...a}[ee]===ne})?[...z,V,W]:z},[]);return kM(r,P,R,l?.class,l?.className)},GV=qV("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",selected:"bg-primary text-white hover:bg-selected-primary/90 focus-visible:ring-selected-primary/20 dark:focus-visible:ring-selected-primary/40 dark:bg-selected-primary/60",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}});function up({className:r,variant:n,size:l,asChild:c=!1,...y}){const w=c?BV:"button";return Bt.jsx(w,{"data-slot":"button",className:Hf(GV({variant:n,size:l,className:r})),...y})}function HV({activeItem:r,onItemClick:n}){return Bt.jsxs("div",{className:"w-64 bg-white border-r border-border h-full flex flex-col",children:[Bt.jsx("div",{className:"p-4 border-b border-border",children:Bt.jsxs("div",{className:"flex items-center gap-2",children:[Bt.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded flex items-center justify-center",children:Bt.jsx("div",{className:"w-6 h-6 bg-gray-400 rounded"})}),Bt.jsxs("div",{children:[Bt.jsx("div",{className:"text-xs text-muted-foreground",children:"UNIVERSIDAD"}),Bt.jsx("div",{className:"text-xs font-medium",children:"NACIONAL"}),Bt.jsx("div",{className:"text-xs text-muted-foreground",children:"DE COLOMBIA"})]})]})}),Bt.jsx("div",{className:"p-4 border-b border-border",children:Bt.jsxs("div",{className:"relative",children:[Bt.jsx(tV,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),Bt.jsx(cE,{placeholder:"Buscar...",className:"pl-10 bg-input-background border-0"})]})}),Bt.jsx("nav",{className:"flex-1 p-4",children:Bt.jsxs("div",{className:"space-y-2",children:[Bt.jsxs(up,{variant:r==="dashboard"?"secondary":"ghost",className:"w-full justify-start",onClick:()=>n("dashboard"),children:[Bt.jsx(QU,{className:"w-4 h-4 mr-2"}),"Dashboard"]}),Bt.jsxs(up,{variant:r==="acerca"?"secondary":"ghost",className:"w-full justify-start",onClick:()=>n("acerca"),children:[Bt.jsx(YU,{className:"w-4 h-4 mr-2"}),"Acerca de"]}),Bt.jsxs(up,{variant:"ghost",className:"w-full justify-between",children:[Bt.jsxs("div",{className:"flex items-center",children:[Bt.jsx("div",{className:"w-4 h-4 mr-2"}),"Contactos"]}),Bt.jsx(WU,{className:"w-4 h-4"})]})]})})]})}function WV({activeTab:r,onTabChange:n}){const[l,c]=ir.useState(""),[y,w]=ir.useState("");return Bt.jsx("div",{className:"bg-white border-b border-border",children:Bt.jsxs("div",{className:"p-6",children:[Bt.jsx("h1",{className:"text-2xl font-semibold mb-6",children:"Resultados de la extracción"}),Bt.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[Bt.jsxs("div",{className:"flex items-center gap-1",children:[Bt.jsx(up,{variant:r==="resumen"?"default":"ghost",onClick:()=>n("resumen"),className:"px-4 py-2",children:"Resumen"}),Bt.jsx(up,{variant:r==="base-datos"?"default":"ghost",onClick:()=>n("base-datos"),className:"px-4 py-2",children:"Base de datos"}),Bt.jsx(up,{variant:"ghost",size:"sm",children:Bt.jsx(XU,{className:"w-4 h-4"})})]}),Bt.jsxs("div",{className:"flex items-center gap-4",children:[Bt.jsxs("div",{className:"flex items-center gap-2",children:[Bt.jsx("label",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"Fecha inicial"}),Bt.jsxs("div",{className:"relative",children:[Bt.jsx(cE,{type:"date",value:l,onChange:P=>c(P.target.value),className:"w-40 bg-input-background border-0"}),Bt.jsx(AM,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"})]})]}),Bt.jsx(qU,{className:"w-4 h-4 text-muted-foreground"}),Bt.jsxs("div",{className:"flex items-center gap-2",children:[Bt.jsx("label",{className:"text-sm text-muted-foreground whitespace-nowrap",children:"Fecha final"}),Bt.jsxs("div",{className:"relative",children:[Bt.jsx(cE,{type:"date",value:y,onChange:P=>w(P.target.value),className:"w-40 bg-input-background border-0"}),Bt.jsx(AM,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"})]})]})]})]})]})})}function mg({className:r,...n}){return Bt.jsx("div",{"data-slot":"card",className:Hf("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",r),...n})}function qv({title:r,value:n,percentage:l,showPercentageBadge:c,variant:y="default"}){return Bt.jsx(mg,{className:`p-4 hover:shadow-md transition-shadow ${y==="accent"?"bg-accent/50":""}`,children:Bt.jsxs("div",{className:"space-y-1",children:[Bt.jsx("p",{className:"text-sm text-muted-foreground",children:r}),Bt.jsxs("div",{className:"flex items-baseline gap-2",children:[Bt.jsx("span",{className:"text-2xl font-semibold",children:n}),l&&Bt.jsx("span",{className:`text-sm ${c?"bg-muted px-2 py-1 rounded-full":"text-muted-foreground"}`,children:l})]})]})})}function ZV(){return Bt.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[Bt.jsx(qv,{title:"Total de estudios",value:"296",percentage:"100%"}),Bt.jsx(qv,{title:"Autores",value:"30",percentage:"100%",showPercentageBadge:!0}),Bt.jsx(qv,{title:"Lugares de afiliación de autores",value:"32",percentage:"100%"}),Bt.jsx(qv,{title:"Otra cifra numérica",value:"8K",percentage:"+52%",variant:"accent"})]})}var o1,DM;function bl(){if(DM)return o1;DM=1;var r=Array.isArray;return o1=r,o1}var a1,zM;function q3(){if(zM)return a1;zM=1;var r=typeof jv=="object"&&jv&&jv.Object===Object&&jv;return a1=r,a1}var s1,LM;function Lh(){if(LM)return s1;LM=1;var r=q3(),n=typeof self=="object"&&self&&self.Object===Object&&self,l=r||n||Function("return this")();return s1=l,s1}var l1,FM;function jy(){if(FM)return l1;FM=1;var r=Lh(),n=r.Symbol;return l1=n,l1}var u1,BM;function XV(){if(BM)return u1;BM=1;var r=jy(),n=Object.prototype,l=n.hasOwnProperty,c=n.toString,y=r?r.toStringTag:void 0;function w(P){var a=l.call(P,y),R=P[y];try{P[y]=void 0;var z=!0}catch{}var $=c.call(P);return z&&(a?P[y]=R:delete P[y]),$}return u1=w,u1}var c1,NM;function KV(){if(NM)return c1;NM=1;var r=Object.prototype,n=r.toString;function l(c){return n.call(c)}return c1=l,c1}var h1,jM;function Wf(){if(jM)return h1;jM=1;var r=jy(),n=XV(),l=KV(),c="[object Null]",y="[object Undefined]",w=r?r.toStringTag:void 0;function P(a){return a==null?a===void 0?y:c:w&&w in Object(a)?n(a):l(a)}return h1=P,h1}var f1,UM;function Zf(){if(UM)return f1;UM=1;function r(n){return n!=null&&typeof n=="object"}return f1=r,f1}var d1,VM;function Vg(){if(VM)return d1;VM=1;var r=Wf(),n=Zf(),l="[object Symbol]";function c(y){return typeof y=="symbol"||n(y)&&r(y)==l}return d1=c,d1}var p1,$M;function DA(){if($M)return p1;$M=1;var r=bl(),n=Vg(),l=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,c=/^\w*$/;function y(w,P){if(r(w))return!1;var a=typeof w;return a=="number"||a=="symbol"||a=="boolean"||w==null||n(w)?!0:c.test(w)||!l.test(w)||P!=null&&w in Object(P)}return p1=y,p1}var m1,qM;function fp(){if(qM)return m1;qM=1;function r(n){var l=typeof n;return n!=null&&(l=="object"||l=="function")}return m1=r,m1}var g1,GM;function zA(){if(GM)return g1;GM=1;var r=Wf(),n=fp(),l="[object AsyncFunction]",c="[object Function]",y="[object GeneratorFunction]",w="[object Proxy]";function P(a){if(!n(a))return!1;var R=r(a);return R==c||R==y||R==l||R==w}return g1=P,g1}var _1,HM;function YV(){if(HM)return _1;HM=1;var r=Lh(),n=r["__core-js_shared__"];return _1=n,_1}var y1,WM;function JV(){if(WM)return y1;WM=1;var r=YV(),n=(function(){var c=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||"");return c?"Symbol(src)_1."+c:""})();function l(c){return!!n&&n in c}return y1=l,y1}var v1,ZM;function G3(){if(ZM)return v1;ZM=1;var r=Function.prototype,n=r.toString;function l(c){if(c!=null){try{return n.call(c)}catch{}try{return c+""}catch{}}return""}return v1=l,v1}var x1,XM;function QV(){if(XM)return x1;XM=1;var r=zA(),n=JV(),l=fp(),c=G3(),y=/[\\^$.*+?()[\]{}|]/g,w=/^\[object .+?Constructor\]$/,P=Function.prototype,a=Object.prototype,R=P.toString,z=a.hasOwnProperty,$=RegExp("^"+R.call(z).replace(y,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function V(W){if(!l(W)||n(W))return!1;var ie=r(W)?$:w;return ie.test(c(W))}return x1=V,x1}var b1,KM;function e6(){if(KM)return b1;KM=1;function r(n,l){return n?.[l]}return b1=r,b1}var w1,YM;function _m(){if(YM)return w1;YM=1;var r=QV(),n=e6();function l(c,y){var w=n(c,y);return r(w)?w:void 0}return w1=l,w1}var S1,JM;function nx(){if(JM)return S1;JM=1;var r=_m(),n=r(Object,"create");return S1=n,S1}var T1,QM;function t6(){if(QM)return T1;QM=1;var r=nx();function n(){this.__data__=r?r(null):{},this.size=0}return T1=n,T1}var E1,eO;function r6(){if(eO)return E1;eO=1;function r(n){var l=this.has(n)&&delete this.__data__[n];return this.size-=l?1:0,l}return E1=r,E1}var A1,tO;function n6(){if(tO)return A1;tO=1;var r=nx(),n="__lodash_hash_undefined__",l=Object.prototype,c=l.hasOwnProperty;function y(w){var P=this.__data__;if(r){var a=P[w];return a===n?void 0:a}return c.call(P,w)?P[w]:void 0}return A1=y,A1}var P1,rO;function i6(){if(rO)return P1;rO=1;var r=nx(),n=Object.prototype,l=n.hasOwnProperty;function c(y){var w=this.__data__;return r?w[y]!==void 0:l.call(w,y)}return P1=c,P1}var I1,nO;function o6(){if(nO)return I1;nO=1;var r=nx(),n="__lodash_hash_undefined__";function l(c,y){var w=this.__data__;return this.size+=this.has(c)?0:1,w[c]=r&&y===void 0?n:y,this}return I1=l,I1}var C1,iO;function a6(){if(iO)return C1;iO=1;var r=t6(),n=r6(),l=n6(),c=i6(),y=o6();function w(P){var a=-1,R=P==null?0:P.length;for(this.clear();++a<R;){var z=P[a];this.set(z[0],z[1])}}return w.prototype.clear=r,w.prototype.delete=n,w.prototype.get=l,w.prototype.has=c,w.prototype.set=y,C1=w,C1}var M1,oO;function s6(){if(oO)return M1;oO=1;function r(){this.__data__=[],this.size=0}return M1=r,M1}var O1,aO;function LA(){if(aO)return O1;aO=1;function r(n,l){return n===l||n!==n&&l!==l}return O1=r,O1}var R1,sO;function ix(){if(sO)return R1;sO=1;var r=LA();function n(l,c){for(var y=l.length;y--;)if(r(l[y][0],c))return y;return-1}return R1=n,R1}var k1,lO;function l6(){if(lO)return k1;lO=1;var r=ix(),n=Array.prototype,l=n.splice;function c(y){var w=this.__data__,P=r(w,y);if(P<0)return!1;var a=w.length-1;return P==a?w.pop():l.call(w,P,1),--this.size,!0}return k1=c,k1}var D1,uO;function u6(){if(uO)return D1;uO=1;var r=ix();function n(l){var c=this.__data__,y=r(c,l);return y<0?void 0:c[y][1]}return D1=n,D1}var z1,cO;function c6(){if(cO)return z1;cO=1;var r=ix();function n(l){return r(this.__data__,l)>-1}return z1=n,z1}var L1,hO;function h6(){if(hO)return L1;hO=1;var r=ix();function n(l,c){var y=this.__data__,w=r(y,l);return w<0?(++this.size,y.push([l,c])):y[w][1]=c,this}return L1=n,L1}var F1,fO;function ox(){if(fO)return F1;fO=1;var r=s6(),n=l6(),l=u6(),c=c6(),y=h6();function w(P){var a=-1,R=P==null?0:P.length;for(this.clear();++a<R;){var z=P[a];this.set(z[0],z[1])}}return w.prototype.clear=r,w.prototype.delete=n,w.prototype.get=l,w.prototype.has=c,w.prototype.set=y,F1=w,F1}var B1,dO;function FA(){if(dO)return B1;dO=1;var r=_m(),n=Lh(),l=r(n,"Map");return B1=l,B1}var N1,pO;function f6(){if(pO)return N1;pO=1;var r=a6(),n=ox(),l=FA();function c(){this.size=0,this.__data__={hash:new r,map:new(l||n),string:new r}}return N1=c,N1}var j1,mO;function d6(){if(mO)return j1;mO=1;function r(n){var l=typeof n;return l=="string"||l=="number"||l=="symbol"||l=="boolean"?n!=="__proto__":n===null}return j1=r,j1}var U1,gO;function ax(){if(gO)return U1;gO=1;var r=d6();function n(l,c){var y=l.__data__;return r(c)?y[typeof c=="string"?"string":"hash"]:y.map}return U1=n,U1}var V1,_O;function p6(){if(_O)return V1;_O=1;var r=ax();function n(l){var c=r(this,l).delete(l);return this.size-=c?1:0,c}return V1=n,V1}var $1,yO;function m6(){if(yO)return $1;yO=1;var r=ax();function n(l){return r(this,l).get(l)}return $1=n,$1}var q1,vO;function g6(){if(vO)return q1;vO=1;var r=ax();function n(l){return r(this,l).has(l)}return q1=n,q1}var G1,xO;function _6(){if(xO)return G1;xO=1;var r=ax();function n(l,c){var y=r(this,l),w=y.size;return y.set(l,c),this.size+=y.size==w?0:1,this}return G1=n,G1}var H1,bO;function BA(){if(bO)return H1;bO=1;var r=f6(),n=p6(),l=m6(),c=g6(),y=_6();function w(P){var a=-1,R=P==null?0:P.length;for(this.clear();++a<R;){var z=P[a];this.set(z[0],z[1])}}return w.prototype.clear=r,w.prototype.delete=n,w.prototype.get=l,w.prototype.has=c,w.prototype.set=y,H1=w,H1}var W1,wO;function H3(){if(wO)return W1;wO=1;var r=BA(),n="Expected a function";function l(c,y){if(typeof c!="function"||y!=null&&typeof y!="function")throw new TypeError(n);var w=function(){var P=arguments,a=y?y.apply(this,P):P[0],R=w.cache;if(R.has(a))return R.get(a);var z=c.apply(this,P);return w.cache=R.set(a,z)||R,z};return w.cache=new(l.Cache||r),w}return l.Cache=r,W1=l,W1}var Z1,SO;function y6(){if(SO)return Z1;SO=1;var r=H3(),n=500;function l(c){var y=r(c,function(P){return w.size===n&&w.clear(),P}),w=y.cache;return y}return Z1=l,Z1}var X1,TO;function v6(){if(TO)return X1;TO=1;var r=y6(),n=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,l=/\\(\\)?/g,c=r(function(y){var w=[];return y.charCodeAt(0)===46&&w.push(""),y.replace(n,function(P,a,R,z){w.push(R?z.replace(l,"$1"):a||P)}),w});return X1=c,X1}var K1,EO;function NA(){if(EO)return K1;EO=1;function r(n,l){for(var c=-1,y=n==null?0:n.length,w=Array(y);++c<y;)w[c]=l(n[c],c,n);return w}return K1=r,K1}var Y1,AO;function x6(){if(AO)return Y1;AO=1;var r=jy(),n=NA(),l=bl(),c=Vg(),y=r?r.prototype:void 0,w=y?y.toString:void 0;function P(a){if(typeof a=="string")return a;if(l(a))return n(a,P)+"";if(c(a))return w?w.call(a):"";var R=a+"";return R=="0"&&1/a==-1/0?"-0":R}return Y1=P,Y1}var J1,PO;function W3(){if(PO)return J1;PO=1;var r=x6();function n(l){return l==null?"":r(l)}return J1=n,J1}var Q1,IO;function Z3(){if(IO)return Q1;IO=1;var r=bl(),n=DA(),l=v6(),c=W3();function y(w,P){return r(w)?w:n(w,P)?[w]:l(c(w))}return Q1=y,Q1}var ew,CO;function sx(){if(CO)return ew;CO=1;var r=Vg();function n(l){if(typeof l=="string"||r(l))return l;var c=l+"";return c=="0"&&1/l==-1/0?"-0":c}return ew=n,ew}var tw,MO;function jA(){if(MO)return tw;MO=1;var r=Z3(),n=sx();function l(c,y){y=r(y,c);for(var w=0,P=y.length;c!=null&&w<P;)c=c[n(y[w++])];return w&&w==P?c:void 0}return tw=l,tw}var rw,OO;function X3(){if(OO)return rw;OO=1;var r=jA();function n(l,c,y){var w=l==null?void 0:r(l,c);return w===void 0?y:w}return rw=n,rw}var b6=X3();const Yl=Xi(b6);var nw,RO;function w6(){if(RO)return nw;RO=1;function r(n){return n==null}return nw=r,nw}var S6=w6();const xi=Xi(S6);var iw,kO;function T6(){if(kO)return iw;kO=1;var r=Wf(),n=bl(),l=Zf(),c="[object String]";function y(w){return typeof w=="string"||!n(w)&&l(w)&&r(w)==c}return iw=y,iw}var E6=T6();const cm=Xi(E6);var A6=zA();const Zn=Xi(A6);var P6=fp();const $g=Xi(P6);var ow={exports:{}},Wi={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var DO;function I6(){if(DO)return Wi;DO=1;var r=Symbol.for("react.element"),n=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),c=Symbol.for("react.strict_mode"),y=Symbol.for("react.profiler"),w=Symbol.for("react.provider"),P=Symbol.for("react.context"),a=Symbol.for("react.server_context"),R=Symbol.for("react.forward_ref"),z=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),V=Symbol.for("react.memo"),W=Symbol.for("react.lazy"),ie=Symbol.for("react.offscreen"),ae;ae=Symbol.for("react.module.reference");function ee(ne){if(typeof ne=="object"&&ne!==null){var de=ne.$$typeof;switch(de){case r:switch(ne=ne.type,ne){case l:case y:case c:case z:case $:return ne;default:switch(ne=ne&&ne.$$typeof,ne){case a:case P:case R:case W:case V:case w:return ne;default:return de}}case n:return de}}}return Wi.ContextConsumer=P,Wi.ContextProvider=w,Wi.Element=r,Wi.ForwardRef=R,Wi.Fragment=l,Wi.Lazy=W,Wi.Memo=V,Wi.Portal=n,Wi.Profiler=y,Wi.StrictMode=c,Wi.Suspense=z,Wi.SuspenseList=$,Wi.isAsyncMode=function(){return!1},Wi.isConcurrentMode=function(){return!1},Wi.isContextConsumer=function(ne){return ee(ne)===P},Wi.isContextProvider=function(ne){return ee(ne)===w},Wi.isElement=function(ne){return typeof ne=="object"&&ne!==null&&ne.$$typeof===r},Wi.isForwardRef=function(ne){return ee(ne)===R},Wi.isFragment=function(ne){return ee(ne)===l},Wi.isLazy=function(ne){return ee(ne)===W},Wi.isMemo=function(ne){return ee(ne)===V},Wi.isPortal=function(ne){return ee(ne)===n},Wi.isProfiler=function(ne){return ee(ne)===y},Wi.isStrictMode=function(ne){return ee(ne)===c},Wi.isSuspense=function(ne){return ee(ne)===z},Wi.isSuspenseList=function(ne){return ee(ne)===$},Wi.isValidElementType=function(ne){return typeof ne=="string"||typeof ne=="function"||ne===l||ne===y||ne===c||ne===z||ne===$||ne===ie||typeof ne=="object"&&ne!==null&&(ne.$$typeof===W||ne.$$typeof===V||ne.$$typeof===w||ne.$$typeof===P||ne.$$typeof===R||ne.$$typeof===ae||ne.getModuleId!==void 0)},Wi.typeOf=ee,Wi}var zO;function C6(){return zO||(zO=1,ow.exports=I6()),ow.exports}var M6=C6(),aw,LO;function K3(){if(LO)return aw;LO=1;var r=Wf(),n=Zf(),l="[object Number]";function c(y){return typeof y=="number"||n(y)&&r(y)==l}return aw=c,aw}var sw,FO;function O6(){if(FO)return sw;FO=1;var r=K3();function n(l){return r(l)&&l!=+l}return sw=n,sw}var R6=O6();const Uy=Xi(R6);var k6=K3();const D6=Xi(k6);var Xs=function(n){return n===0?0:n>0?1:-1},im=function(n){return cm(n)&&n.indexOf("%")===n.length-1},Rr=function(n){return D6(n)&&!Uy(n)},z6=function(n){return xi(n)},za=function(n){return Rr(n)||cm(n)},L6=0,Vy=function(n){var l=++L6;return"".concat(n||"").concat(l)},Ks=function(n,l){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,y=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!Rr(n)&&!cm(n))return c;var w;if(im(n)){var P=n.indexOf("%");w=l*parseFloat(n.slice(0,P))/100}else w=+n;return Uy(w)&&(w=c),y&&w>l&&(w=l),w},sp=function(n){if(!n)return null;var l=Object.keys(n);return l&&l.length?n[l[0]]:null},F6=function(n){if(!Array.isArray(n))return!1;for(var l=n.length,c={},y=0;y<l;y++)if(!c[n[y]])c[n[y]]=!0;else return!0;return!1},op=function(n,l){return Rr(n)&&Rr(l)?function(c){return n+c*(l-n)}:function(){return l}};function hE(r,n,l){return!r||!r.length?null:r.find(function(c){return c&&(typeof n=="function"?n(c):Yl(c,n))===l})}var B6=function(n,l){return Rr(n)&&Rr(l)?n-l:cm(n)&&cm(l)?n.localeCompare(l):n instanceof Date&&l instanceof Date?n.getTime()-l.getTime():String(n).localeCompare(String(l))};function hg(r,n){for(var l in r)if({}.hasOwnProperty.call(r,l)&&(!{}.hasOwnProperty.call(n,l)||r[l]!==n[l]))return!1;for(var c in n)if({}.hasOwnProperty.call(n,c)&&!{}.hasOwnProperty.call(r,c))return!1;return!0}function fE(r){"@babel/helpers - typeof";return fE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},fE(r)}var N6=["viewBox","children"],j6=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],BO=["points","pathLength"],lw={svg:N6,polygon:BO,polyline:BO},UA=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],l0=function(n,l){if(!n||typeof n=="function"||typeof n=="boolean")return null;var c=n;if(ir.isValidElement(n)&&(c=n.props),!$g(c))return null;var y={};return Object.keys(c).forEach(function(w){UA.includes(w)&&(y[w]=l||function(P){return c[w](c,P)})}),y},U6=function(n,l,c){return function(y){return n(l,c,y),null}},hm=function(n,l,c){if(!$g(n)||fE(n)!=="object")return null;var y=null;return Object.keys(n).forEach(function(w){var P=n[w];UA.includes(w)&&typeof P=="function"&&(y||(y={}),y[w]=U6(P,l,c))}),y},V6=["children"],$6=["children"];function NO(r,n){if(r==null)return{};var l=q6(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function q6(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}var jO={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},jf=function(n){return typeof n=="string"?n:n?n.displayName||n.name||"Component":""},UO=null,uw=null,VA=function r(n){if(n===UO&&Array.isArray(uw))return uw;var l=[];return ir.Children.forEach(n,function(c){xi(c)||(M6.isFragment(c)?l=l.concat(r(c.props.children)):l.push(c))}),uw=l,UO=n,l};function Vu(r,n){var l=[],c=[];return Array.isArray(n)?c=n.map(function(y){return jf(y)}):c=[jf(n)],VA(r).forEach(function(y){var w=Yl(y,"type.displayName")||Yl(y,"type.name");c.indexOf(w)!==-1&&l.push(y)}),l}function Xl(r,n){var l=Vu(r,n);return l&&l[0]}var VO=function(n){if(!n||!n.props)return!1;var l=n.props,c=l.width,y=l.height;return!(!Rr(c)||c<=0||!Rr(y)||y<=0)},G6=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],H6=function(n){return n&&n.type&&cm(n.type)&&G6.indexOf(n.type)>=0},W6=function(n,l,c,y){var w,P=(w=lw?.[y])!==null&&w!==void 0?w:[];return l.startsWith("data-")||!Zn(n)&&(y&&P.includes(l)||j6.includes(l))||c&&UA.includes(l)},Vn=function(n,l,c){if(!n||typeof n=="function"||typeof n=="boolean")return null;var y=n;if(ir.isValidElement(n)&&(y=n.props),!$g(y))return null;var w={};return Object.keys(y).forEach(function(P){var a;W6((a=y)===null||a===void 0?void 0:a[P],P,l,c)&&(w[P]=y[P])}),w},dE=function r(n,l){if(n===l)return!0;var c=ir.Children.count(n);if(c!==ir.Children.count(l))return!1;if(c===0)return!0;if(c===1)return $O(Array.isArray(n)?n[0]:n,Array.isArray(l)?l[0]:l);for(var y=0;y<c;y++){var w=n[y],P=l[y];if(Array.isArray(w)||Array.isArray(P)){if(!r(w,P))return!1}else if(!$O(w,P))return!1}return!0},$O=function(n,l){if(xi(n)&&xi(l))return!0;if(!xi(n)&&!xi(l)){var c=n.props||{},y=c.children,w=NO(c,V6),P=l.props||{},a=P.children,R=NO(P,$6);return y&&a?hg(w,R)&&dE(y,a):!y&&!a?hg(w,R):!1}return!1},qO=function(n,l){var c=[],y={};return VA(n).forEach(function(w,P){if(H6(w))c.push(w);else if(w){var a=jf(w.type),R=l[a]||{},z=R.handler,$=R.once;if(z&&(!$||!y[a])){var V=z(w,a,P);c.push(V),y[a]=!0}}}),c},Z6=function(n){var l=n&&n.type;return l&&jO[l]?jO[l]:null},X6=function(n,l){return VA(l).indexOf(n)},K6=["children","width","height","viewBox","className","style","title","desc"];function pE(){return pE=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},pE.apply(this,arguments)}function Y6(r,n){if(r==null)return{};var l=J6(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function J6(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}function mE(r){var n=r.children,l=r.width,c=r.height,y=r.viewBox,w=r.className,P=r.style,a=r.title,R=r.desc,z=Y6(r,K6),$=y||{width:l,height:c,x:0,y:0},V=ui("recharts-surface",w);return ct.createElement("svg",pE({},Vn(z,!0,"svg"),{className:V,width:l,height:c,style:P,viewBox:"".concat($.x," ").concat($.y," ").concat($.width," ").concat($.height)}),ct.createElement("title",null,a),ct.createElement("desc",null,R),n)}var Q6=["children","className"];function gE(){return gE=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},gE.apply(this,arguments)}function e$(r,n){if(r==null)return{};var l=t$(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function t$(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}var eo=ct.forwardRef(function(r,n){var l=r.children,c=r.className,y=e$(r,Q6),w=ui("recharts-layer",c);return ct.createElement("g",gE({className:w},Vn(y,!0),{ref:n}),l)}),jc=function(n,l){for(var c=arguments.length,y=new Array(c>2?c-2:0),w=2;w<c;w++)y[w-2]=arguments[w]},cw,GO;function r$(){if(GO)return cw;GO=1;function r(n,l,c){var y=-1,w=n.length;l<0&&(l=-l>w?0:w+l),c=c>w?w:c,c<0&&(c+=w),w=l>c?0:c-l>>>0,l>>>=0;for(var P=Array(w);++y<w;)P[y]=n[y+l];return P}return cw=r,cw}var hw,HO;function n$(){if(HO)return hw;HO=1;var r=r$();function n(l,c,y){var w=l.length;return y=y===void 0?w:y,!c&&y>=w?l:r(l,c,y)}return hw=n,hw}var fw,WO;function Y3(){if(WO)return fw;WO=1;var r="\\ud800-\\udfff",n="\\u0300-\\u036f",l="\\ufe20-\\ufe2f",c="\\u20d0-\\u20ff",y=n+l+c,w="\\ufe0e\\ufe0f",P="\\u200d",a=RegExp("["+P+r+y+w+"]");function R(z){return a.test(z)}return fw=R,fw}var dw,ZO;function i$(){if(ZO)return dw;ZO=1;function r(n){return n.split("")}return dw=r,dw}var pw,XO;function o$(){if(XO)return pw;XO=1;var r="\\ud800-\\udfff",n="\\u0300-\\u036f",l="\\ufe20-\\ufe2f",c="\\u20d0-\\u20ff",y=n+l+c,w="\\ufe0e\\ufe0f",P="["+r+"]",a="["+y+"]",R="\\ud83c[\\udffb-\\udfff]",z="(?:"+a+"|"+R+")",$="[^"+r+"]",V="(?:\\ud83c[\\udde6-\\uddff]){2}",W="[\\ud800-\\udbff][\\udc00-\\udfff]",ie="\\u200d",ae=z+"?",ee="["+w+"]?",ne="(?:"+ie+"(?:"+[$,V,W].join("|")+")"+ee+ae+")*",de=ee+ae+ne,xe="(?:"+[$+a+"?",a,V,W,P].join("|")+")",be=RegExp(R+"(?="+R+")|"+xe+de,"g");function ke(he){return he.match(be)||[]}return pw=ke,pw}var mw,KO;function a$(){if(KO)return mw;KO=1;var r=i$(),n=Y3(),l=o$();function c(y){return n(y)?l(y):r(y)}return mw=c,mw}var gw,YO;function s$(){if(YO)return gw;YO=1;var r=n$(),n=Y3(),l=a$(),c=W3();function y(w){return function(P){P=c(P);var a=n(P)?l(P):void 0,R=a?a[0]:P.charAt(0),z=a?r(a,1).join(""):P.slice(1);return R[w]()+z}}return gw=y,gw}var _w,JO;function l$(){if(JO)return _w;JO=1;var r=s$(),n=r("toUpperCase");return _w=n,_w}var u$=l$();const lx=Xi(u$);function _o(r){return function(){return r}}const J3=Math.cos,u0=Math.sin,Uc=Math.sqrt,c0=Math.PI,ux=2*c0,_E=Math.PI,yE=2*_E,tm=1e-6,c$=yE-tm;function Q3(r){this._+=r[0];for(let n=1,l=r.length;n<l;++n)this._+=arguments[n]+r[n]}function h$(r){let n=Math.floor(r);if(!(n>=0))throw new Error(`invalid digits: ${r}`);if(n>15)return Q3;const l=10**n;return function(c){this._+=c[0];for(let y=1,w=c.length;y<w;++y)this._+=Math.round(arguments[y]*l)/l+c[y]}}class f${constructor(n){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=n==null?Q3:h$(n)}moveTo(n,l){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+l}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(n,l){this._append`L${this._x1=+n},${this._y1=+l}`}quadraticCurveTo(n,l,c,y){this._append`Q${+n},${+l},${this._x1=+c},${this._y1=+y}`}bezierCurveTo(n,l,c,y,w,P){this._append`C${+n},${+l},${+c},${+y},${this._x1=+w},${this._y1=+P}`}arcTo(n,l,c,y,w){if(n=+n,l=+l,c=+c,y=+y,w=+w,w<0)throw new Error(`negative radius: ${w}`);let P=this._x1,a=this._y1,R=c-n,z=y-l,$=P-n,V=a-l,W=$*$+V*V;if(this._x1===null)this._append`M${this._x1=n},${this._y1=l}`;else if(W>tm)if(!(Math.abs(V*R-z*$)>tm)||!w)this._append`L${this._x1=n},${this._y1=l}`;else{let ie=c-P,ae=y-a,ee=R*R+z*z,ne=ie*ie+ae*ae,de=Math.sqrt(ee),xe=Math.sqrt(W),be=w*Math.tan((_E-Math.acos((ee+W-ne)/(2*de*xe)))/2),ke=be/xe,he=be/de;Math.abs(ke-1)>tm&&this._append`L${n+ke*$},${l+ke*V}`,this._append`A${w},${w},0,0,${+(V*ie>$*ae)},${this._x1=n+he*R},${this._y1=l+he*z}`}}arc(n,l,c,y,w,P){if(n=+n,l=+l,c=+c,P=!!P,c<0)throw new Error(`negative radius: ${c}`);let a=c*Math.cos(y),R=c*Math.sin(y),z=n+a,$=l+R,V=1^P,W=P?y-w:w-y;this._x1===null?this._append`M${z},${$}`:(Math.abs(this._x1-z)>tm||Math.abs(this._y1-$)>tm)&&this._append`L${z},${$}`,c&&(W<0&&(W=W%yE+yE),W>c$?this._append`A${c},${c},0,1,${V},${n-a},${l-R}A${c},${c},0,1,${V},${this._x1=z},${this._y1=$}`:W>tm&&this._append`A${c},${c},0,${+(W>=_E)},${V},${this._x1=n+c*Math.cos(w)},${this._y1=l+c*Math.sin(w)}`)}rect(n,l,c,y){this._append`M${this._x0=this._x1=+n},${this._y0=this._y1=+l}h${c=+c}v${+y}h${-c}Z`}toString(){return this._}}function $A(r){let n=3;return r.digits=function(l){if(!arguments.length)return n;if(l==null)n=null;else{const c=Math.floor(l);if(!(c>=0))throw new RangeError(`invalid digits: ${l}`);n=c}return r},()=>new f$(n)}function qA(r){return typeof r=="object"&&"length"in r?r:Array.from(r)}function eF(r){this._context=r}eF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(r,n){switch(r=+r,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 1:this._point=2;default:this._context.lineTo(r,n);break}}};function cx(r){return new eF(r)}function tF(r){return r[0]}function rF(r){return r[1]}function nF(r,n){var l=_o(!0),c=null,y=cx,w=null,P=$A(a);r=typeof r=="function"?r:r===void 0?tF:_o(r),n=typeof n=="function"?n:n===void 0?rF:_o(n);function a(R){var z,$=(R=qA(R)).length,V,W=!1,ie;for(c==null&&(w=y(ie=P())),z=0;z<=$;++z)!(z<$&&l(V=R[z],z,R))===W&&((W=!W)?w.lineStart():w.lineEnd()),W&&w.point(+r(V,z,R),+n(V,z,R));if(ie)return w=null,ie+""||null}return a.x=function(R){return arguments.length?(r=typeof R=="function"?R:_o(+R),a):r},a.y=function(R){return arguments.length?(n=typeof R=="function"?R:_o(+R),a):n},a.defined=function(R){return arguments.length?(l=typeof R=="function"?R:_o(!!R),a):l},a.curve=function(R){return arguments.length?(y=R,c!=null&&(w=y(c)),a):y},a.context=function(R){return arguments.length?(R==null?c=w=null:w=y(c=R),a):c},a}function Gv(r,n,l){var c=null,y=_o(!0),w=null,P=cx,a=null,R=$A(z);r=typeof r=="function"?r:r===void 0?tF:_o(+r),n=typeof n=="function"?n:_o(n===void 0?0:+n),l=typeof l=="function"?l:l===void 0?rF:_o(+l);function z(V){var W,ie,ae,ee=(V=qA(V)).length,ne,de=!1,xe,be=new Array(ee),ke=new Array(ee);for(w==null&&(a=P(xe=R())),W=0;W<=ee;++W){if(!(W<ee&&y(ne=V[W],W,V))===de)if(de=!de)ie=W,a.areaStart(),a.lineStart();else{for(a.lineEnd(),a.lineStart(),ae=W-1;ae>=ie;--ae)a.point(be[ae],ke[ae]);a.lineEnd(),a.areaEnd()}de&&(be[W]=+r(ne,W,V),ke[W]=+n(ne,W,V),a.point(c?+c(ne,W,V):be[W],l?+l(ne,W,V):ke[W]))}if(xe)return a=null,xe+""||null}function $(){return nF().defined(y).curve(P).context(w)}return z.x=function(V){return arguments.length?(r=typeof V=="function"?V:_o(+V),c=null,z):r},z.x0=function(V){return arguments.length?(r=typeof V=="function"?V:_o(+V),z):r},z.x1=function(V){return arguments.length?(c=V==null?null:typeof V=="function"?V:_o(+V),z):c},z.y=function(V){return arguments.length?(n=typeof V=="function"?V:_o(+V),l=null,z):n},z.y0=function(V){return arguments.length?(n=typeof V=="function"?V:_o(+V),z):n},z.y1=function(V){return arguments.length?(l=V==null?null:typeof V=="function"?V:_o(+V),z):l},z.lineX0=z.lineY0=function(){return $().x(r).y(n)},z.lineY1=function(){return $().x(r).y(l)},z.lineX1=function(){return $().x(c).y(n)},z.defined=function(V){return arguments.length?(y=typeof V=="function"?V:_o(!!V),z):y},z.curve=function(V){return arguments.length?(P=V,w!=null&&(a=P(w)),z):P},z.context=function(V){return arguments.length?(V==null?w=a=null:a=P(w=V),z):w},z}class iF{constructor(n,l){this._context=n,this._x=l}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(n,l){switch(n=+n,l=+l,this._point){case 0:{this._point=1,this._line?this._context.lineTo(n,l):this._context.moveTo(n,l);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+n)/2,this._y0,this._x0,l,n,l):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+l)/2,n,this._y0,n,l);break}}this._x0=n,this._y0=l}}function d$(r){return new iF(r,!0)}function p$(r){return new iF(r,!1)}const GA={draw(r,n){const l=Uc(n/c0);r.moveTo(l,0),r.arc(0,0,l,0,ux)}},m$={draw(r,n){const l=Uc(n/5)/2;r.moveTo(-3*l,-l),r.lineTo(-l,-l),r.lineTo(-l,-3*l),r.lineTo(l,-3*l),r.lineTo(l,-l),r.lineTo(3*l,-l),r.lineTo(3*l,l),r.lineTo(l,l),r.lineTo(l,3*l),r.lineTo(-l,3*l),r.lineTo(-l,l),r.lineTo(-3*l,l),r.closePath()}},oF=Uc(1/3),g$=oF*2,_$={draw(r,n){const l=Uc(n/g$),c=l*oF;r.moveTo(0,-l),r.lineTo(c,0),r.lineTo(0,l),r.lineTo(-c,0),r.closePath()}},y$={draw(r,n){const l=Uc(n),c=-l/2;r.rect(c,c,l,l)}},v$=.8908130915292852,aF=u0(c0/10)/u0(7*c0/10),x$=u0(ux/10)*aF,b$=-J3(ux/10)*aF,w$={draw(r,n){const l=Uc(n*v$),c=x$*l,y=b$*l;r.moveTo(0,-l),r.lineTo(c,y);for(let w=1;w<5;++w){const P=ux*w/5,a=J3(P),R=u0(P);r.lineTo(R*l,-a*l),r.lineTo(a*c-R*y,R*c+a*y)}r.closePath()}},yw=Uc(3),S$={draw(r,n){const l=-Uc(n/(yw*3));r.moveTo(0,l*2),r.lineTo(-yw*l,-l),r.lineTo(yw*l,-l),r.closePath()}},Fu=-.5,Bu=Uc(3)/2,vE=1/Uc(12),T$=(vE/2+1)*3,E$={draw(r,n){const l=Uc(n/T$),c=l/2,y=l*vE,w=c,P=l*vE+l,a=-w,R=P;r.moveTo(c,y),r.lineTo(w,P),r.lineTo(a,R),r.lineTo(Fu*c-Bu*y,Bu*c+Fu*y),r.lineTo(Fu*w-Bu*P,Bu*w+Fu*P),r.lineTo(Fu*a-Bu*R,Bu*a+Fu*R),r.lineTo(Fu*c+Bu*y,Fu*y-Bu*c),r.lineTo(Fu*w+Bu*P,Fu*P-Bu*w),r.lineTo(Fu*a+Bu*R,Fu*R-Bu*a),r.closePath()}};function A$(r,n){let l=null,c=$A(y);r=typeof r=="function"?r:_o(r||GA),n=typeof n=="function"?n:_o(n===void 0?64:+n);function y(){let w;if(l||(l=w=c()),r.apply(this,arguments).draw(l,+n.apply(this,arguments)),w)return l=null,w+""||null}return y.type=function(w){return arguments.length?(r=typeof w=="function"?w:_o(w),y):r},y.size=function(w){return arguments.length?(n=typeof w=="function"?w:_o(+w),y):n},y.context=function(w){return arguments.length?(l=w??null,y):l},y}function h0(){}function f0(r,n,l){r._context.bezierCurveTo((2*r._x0+r._x1)/3,(2*r._y0+r._y1)/3,(r._x0+2*r._x1)/3,(r._y0+2*r._y1)/3,(r._x0+4*r._x1+n)/6,(r._y0+4*r._y1+l)/6)}function sF(r){this._context=r}sF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:f0(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(r,n){switch(r=+r,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:f0(this,r,n);break}this._x0=this._x1,this._x1=r,this._y0=this._y1,this._y1=n}};function P$(r){return new sF(r)}function lF(r){this._context=r}lF.prototype={areaStart:h0,areaEnd:h0,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(r,n){switch(r=+r,n=+n,this._point){case 0:this._point=1,this._x2=r,this._y2=n;break;case 1:this._point=2,this._x3=r,this._y3=n;break;case 2:this._point=3,this._x4=r,this._y4=n,this._context.moveTo((this._x0+4*this._x1+r)/6,(this._y0+4*this._y1+n)/6);break;default:f0(this,r,n);break}this._x0=this._x1,this._x1=r,this._y0=this._y1,this._y1=n}};function I$(r){return new lF(r)}function uF(r){this._context=r}uF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(r,n){switch(r=+r,n=+n,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var l=(this._x0+4*this._x1+r)/6,c=(this._y0+4*this._y1+n)/6;this._line?this._context.lineTo(l,c):this._context.moveTo(l,c);break;case 3:this._point=4;default:f0(this,r,n);break}this._x0=this._x1,this._x1=r,this._y0=this._y1,this._y1=n}};function C$(r){return new uF(r)}function cF(r){this._context=r}cF.prototype={areaStart:h0,areaEnd:h0,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(r,n){r=+r,n=+n,this._point?this._context.lineTo(r,n):(this._point=1,this._context.moveTo(r,n))}};function M$(r){return new cF(r)}function QO(r){return r<0?-1:1}function eR(r,n,l){var c=r._x1-r._x0,y=n-r._x1,w=(r._y1-r._y0)/(c||y<0&&-0),P=(l-r._y1)/(y||c<0&&-0),a=(w*y+P*c)/(c+y);return(QO(w)+QO(P))*Math.min(Math.abs(w),Math.abs(P),.5*Math.abs(a))||0}function tR(r,n){var l=r._x1-r._x0;return l?(3*(r._y1-r._y0)/l-n)/2:n}function vw(r,n,l){var c=r._x0,y=r._y0,w=r._x1,P=r._y1,a=(w-c)/3;r._context.bezierCurveTo(c+a,y+a*n,w-a,P-a*l,w,P)}function d0(r){this._context=r}d0.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:vw(this,this._t0,tR(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(r,n){var l=NaN;if(r=+r,n=+n,!(r===this._x1&&n===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 1:this._point=2;break;case 2:this._point=3,vw(this,tR(this,l=eR(this,r,n)),l);break;default:vw(this,this._t0,l=eR(this,r,n));break}this._x0=this._x1,this._x1=r,this._y0=this._y1,this._y1=n,this._t0=l}}};function hF(r){this._context=new fF(r)}(hF.prototype=Object.create(d0.prototype)).point=function(r,n){d0.prototype.point.call(this,n,r)};function fF(r){this._context=r}fF.prototype={moveTo:function(r,n){this._context.moveTo(n,r)},closePath:function(){this._context.closePath()},lineTo:function(r,n){this._context.lineTo(n,r)},bezierCurveTo:function(r,n,l,c,y,w){this._context.bezierCurveTo(n,r,c,l,w,y)}};function O$(r){return new d0(r)}function R$(r){return new hF(r)}function dF(r){this._context=r}dF.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var r=this._x,n=this._y,l=r.length;if(l)if(this._line?this._context.lineTo(r[0],n[0]):this._context.moveTo(r[0],n[0]),l===2)this._context.lineTo(r[1],n[1]);else for(var c=rR(r),y=rR(n),w=0,P=1;P<l;++w,++P)this._context.bezierCurveTo(c[0][w],y[0][w],c[1][w],y[1][w],r[P],n[P]);(this._line||this._line!==0&&l===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(r,n){this._x.push(+r),this._y.push(+n)}};function rR(r){var n,l=r.length-1,c,y=new Array(l),w=new Array(l),P=new Array(l);for(y[0]=0,w[0]=2,P[0]=r[0]+2*r[1],n=1;n<l-1;++n)y[n]=1,w[n]=4,P[n]=4*r[n]+2*r[n+1];for(y[l-1]=2,w[l-1]=7,P[l-1]=8*r[l-1]+r[l],n=1;n<l;++n)c=y[n]/w[n-1],w[n]-=c,P[n]-=c*P[n-1];for(y[l-1]=P[l-1]/w[l-1],n=l-2;n>=0;--n)y[n]=(P[n]-y[n+1])/w[n];for(w[l-1]=(r[l]+y[l-1])/2,n=0;n<l-1;++n)w[n]=2*r[n+1]-y[n+1];return[y,w]}function k$(r){return new dF(r)}function hx(r,n){this._context=r,this._t=n}hx.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(r,n){switch(r=+r,n=+n,this._point){case 0:this._point=1,this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,n),this._context.lineTo(r,n);else{var l=this._x*(1-this._t)+r*this._t;this._context.lineTo(l,this._y),this._context.lineTo(l,n)}break}}this._x=r,this._y=n}};function D$(r){return new hx(r,.5)}function z$(r){return new hx(r,0)}function L$(r){return new hx(r,1)}function gg(r,n){if((P=r.length)>1)for(var l=1,c,y,w=r[n[0]],P,a=w.length;l<P;++l)for(y=w,w=r[n[l]],c=0;c<a;++c)w[c][1]+=w[c][0]=isNaN(y[c][1])?y[c][0]:y[c][1]}function xE(r){for(var n=r.length,l=new Array(n);--n>=0;)l[n]=n;return l}function F$(r,n){return r[n]}function B$(r){const n=[];return n.key=r,n}function N$(){var r=_o([]),n=xE,l=gg,c=F$;function y(w){var P=Array.from(r.apply(this,arguments),B$),a,R=P.length,z=-1,$;for(const V of w)for(a=0,++z;a<R;++a)(P[a][z]=[0,+c(V,P[a].key,z,w)]).data=V;for(a=0,$=qA(n(P));a<R;++a)P[$[a]].index=a;return l(P,$),P}return y.keys=function(w){return arguments.length?(r=typeof w=="function"?w:_o(Array.from(w)),y):r},y.value=function(w){return arguments.length?(c=typeof w=="function"?w:_o(+w),y):c},y.order=function(w){return arguments.length?(n=w==null?xE:typeof w=="function"?w:_o(Array.from(w)),y):n},y.offset=function(w){return arguments.length?(l=w??gg,y):l},y}function j$(r,n){if((c=r.length)>0){for(var l,c,y=0,w=r[0].length,P;y<w;++y){for(P=l=0;l<c;++l)P+=r[l][y][1]||0;if(P)for(l=0;l<c;++l)r[l][y][1]/=P}gg(r,n)}}function U$(r,n){if((y=r.length)>0){for(var l=0,c=r[n[0]],y,w=c.length;l<w;++l){for(var P=0,a=0;P<y;++P)a+=r[P][l][1]||0;c[l][1]+=c[l][0]=-a/2}gg(r,n)}}function V$(r,n){if(!(!((P=r.length)>0)||!((w=(y=r[n[0]]).length)>0))){for(var l=0,c=1,y,w,P;c<w;++c){for(var a=0,R=0,z=0;a<P;++a){for(var $=r[n[a]],V=$[c][1]||0,W=$[c-1][1]||0,ie=(V-W)/2,ae=0;ae<a;++ae){var ee=r[n[ae]],ne=ee[c][1]||0,de=ee[c-1][1]||0;ie+=ne-de}R+=V,z+=ie*V}y[c-1][1]+=y[c-1][0]=l,R&&(l-=z/R)}y[c-1][1]+=y[c-1][0]=l,gg(r,n)}}function oy(r){"@babel/helpers - typeof";return oy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},oy(r)}var $$=["type","size","sizeType"];function bE(){return bE=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},bE.apply(this,arguments)}function nR(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function iR(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?nR(Object(l),!0).forEach(function(c){q$(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):nR(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function q$(r,n,l){return n=G$(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function G$(r){var n=H$(r,"string");return oy(n)=="symbol"?n:n+""}function H$(r,n){if(oy(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(oy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function W$(r,n){if(r==null)return{};var l=Z$(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function Z$(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}var pF={symbolCircle:GA,symbolCross:m$,symbolDiamond:_$,symbolSquare:y$,symbolStar:w$,symbolTriangle:S$,symbolWye:E$},X$=Math.PI/180,K$=function(n){var l="symbol".concat(lx(n));return pF[l]||GA},Y$=function(n,l,c){if(l==="area")return n;switch(c){case"cross":return 5*n*n/9;case"diamond":return .5*n*n/Math.sqrt(3);case"square":return n*n;case"star":{var y=18*X$;return 1.25*n*n*(Math.tan(y)-Math.tan(y*2)*Math.pow(Math.tan(y),2))}case"triangle":return Math.sqrt(3)*n*n/4;case"wye":return(21-10*Math.sqrt(3))*n*n/8;default:return Math.PI*n*n/4}},J$=function(n,l){pF["symbol".concat(lx(n))]=l},HA=function(n){var l=n.type,c=l===void 0?"circle":l,y=n.size,w=y===void 0?64:y,P=n.sizeType,a=P===void 0?"area":P,R=W$(n,$$),z=iR(iR({},R),{},{type:c,size:w,sizeType:a}),$=function(){var ne=K$(c),de=A$().type(ne).size(Y$(w,a,c));return de()},V=z.className,W=z.cx,ie=z.cy,ae=Vn(z,!0);return W===+W&&ie===+ie&&w===+w?ct.createElement("path",bE({},ae,{className:ui("recharts-symbols",V),transform:"translate(".concat(W,", ").concat(ie,")"),d:$()})):null};HA.registerSymbol=J$;function _g(r){"@babel/helpers - typeof";return _g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_g(r)}function wE(){return wE=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},wE.apply(this,arguments)}function oR(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Q$(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?oR(Object(l),!0).forEach(function(c){ay(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):oR(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function e8(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function t8(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,gF(c.key),c)}}function r8(r,n,l){return n&&t8(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function n8(r,n,l){return n=p0(n),i8(r,mF()?Reflect.construct(n,l||[],p0(r).constructor):n.apply(r,l))}function i8(r,n){if(n&&(_g(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return o8(r)}function o8(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function mF(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mF=function(){return!!r})()}function p0(r){return p0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},p0(r)}function a8(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&SE(r,n)}function SE(r,n){return SE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},SE(r,n)}function ay(r,n,l){return n=gF(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function gF(r){var n=s8(r,"string");return _g(n)=="symbol"?n:n+""}function s8(r,n){if(_g(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(_g(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var Nu=32,WA=(function(r){function n(){return e8(this,n),n8(this,n,arguments)}return a8(n,r),r8(n,[{key:"renderIcon",value:function(c){var y=this.props.inactiveColor,w=Nu/2,P=Nu/6,a=Nu/3,R=c.inactive?y:c.color;if(c.type==="plainline")return ct.createElement("line",{strokeWidth:4,fill:"none",stroke:R,strokeDasharray:c.payload.strokeDasharray,x1:0,y1:w,x2:Nu,y2:w,className:"recharts-legend-icon"});if(c.type==="line")return ct.createElement("path",{strokeWidth:4,fill:"none",stroke:R,d:"M0,".concat(w,"h").concat(a,`
            A`).concat(P,",").concat(P,",0,1,1,").concat(2*a,",").concat(w,`
            H`).concat(Nu,"M").concat(2*a,",").concat(w,`
            A`).concat(P,",").concat(P,",0,1,1,").concat(a,",").concat(w),className:"recharts-legend-icon"});if(c.type==="rect")return ct.createElement("path",{stroke:"none",fill:R,d:"M0,".concat(Nu/8,"h").concat(Nu,"v").concat(Nu*3/4,"h").concat(-Nu,"z"),className:"recharts-legend-icon"});if(ct.isValidElement(c.legendIcon)){var z=Q$({},c);return delete z.legendIcon,ct.cloneElement(c.legendIcon,z)}return ct.createElement(HA,{fill:R,cx:w,cy:w,size:Nu,sizeType:"diameter",type:c.type})}},{key:"renderItems",value:function(){var c=this,y=this.props,w=y.payload,P=y.iconSize,a=y.layout,R=y.formatter,z=y.inactiveColor,$={x:0,y:0,width:Nu,height:Nu},V={display:a==="horizontal"?"inline-block":"block",marginRight:10},W={display:"inline-block",verticalAlign:"middle",marginRight:4};return w.map(function(ie,ae){var ee=ie.formatter||R,ne=ui(ay(ay({"recharts-legend-item":!0},"legend-item-".concat(ae),!0),"inactive",ie.inactive));if(ie.type==="none")return null;var de=Zn(ie.value)?null:ie.value;jc(!Zn(ie.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var xe=ie.inactive?z:ie.color;return ct.createElement("li",wE({className:ne,style:V,key:"legend-item-".concat(ae)},hm(c.props,ie,ae)),ct.createElement(mE,{width:P,height:P,viewBox:$,style:W},c.renderIcon(ie)),ct.createElement("span",{className:"recharts-legend-item-text",style:{color:xe}},ee?ee(de,ie,ae):de))})}},{key:"render",value:function(){var c=this.props,y=c.payload,w=c.layout,P=c.align;if(!y||!y.length)return null;var a={padding:0,margin:0,textAlign:w==="horizontal"?P:"left"};return ct.createElement("ul",{className:"recharts-default-legend",style:a},this.renderItems())}}])})(ir.PureComponent);ay(WA,"displayName","Legend");ay(WA,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var xw,aR;function l8(){if(aR)return xw;aR=1;var r=ox();function n(){this.__data__=new r,this.size=0}return xw=n,xw}var bw,sR;function u8(){if(sR)return bw;sR=1;function r(n){var l=this.__data__,c=l.delete(n);return this.size=l.size,c}return bw=r,bw}var ww,lR;function c8(){if(lR)return ww;lR=1;function r(n){return this.__data__.get(n)}return ww=r,ww}var Sw,uR;function h8(){if(uR)return Sw;uR=1;function r(n){return this.__data__.has(n)}return Sw=r,Sw}var Tw,cR;function f8(){if(cR)return Tw;cR=1;var r=ox(),n=FA(),l=BA(),c=200;function y(w,P){var a=this.__data__;if(a instanceof r){var R=a.__data__;if(!n||R.length<c-1)return R.push([w,P]),this.size=++a.size,this;a=this.__data__=new l(R)}return a.set(w,P),this.size=a.size,this}return Tw=y,Tw}var Ew,hR;function _F(){if(hR)return Ew;hR=1;var r=ox(),n=l8(),l=u8(),c=c8(),y=h8(),w=f8();function P(a){var R=this.__data__=new r(a);this.size=R.size}return P.prototype.clear=n,P.prototype.delete=l,P.prototype.get=c,P.prototype.has=y,P.prototype.set=w,Ew=P,Ew}var Aw,fR;function d8(){if(fR)return Aw;fR=1;var r="__lodash_hash_undefined__";function n(l){return this.__data__.set(l,r),this}return Aw=n,Aw}var Pw,dR;function p8(){if(dR)return Pw;dR=1;function r(n){return this.__data__.has(n)}return Pw=r,Pw}var Iw,pR;function yF(){if(pR)return Iw;pR=1;var r=BA(),n=d8(),l=p8();function c(y){var w=-1,P=y==null?0:y.length;for(this.__data__=new r;++w<P;)this.add(y[w])}return c.prototype.add=c.prototype.push=n,c.prototype.has=l,Iw=c,Iw}var Cw,mR;function vF(){if(mR)return Cw;mR=1;function r(n,l){for(var c=-1,y=n==null?0:n.length;++c<y;)if(l(n[c],c,n))return!0;return!1}return Cw=r,Cw}var Mw,gR;function xF(){if(gR)return Mw;gR=1;function r(n,l){return n.has(l)}return Mw=r,Mw}var Ow,_R;function bF(){if(_R)return Ow;_R=1;var r=yF(),n=vF(),l=xF(),c=1,y=2;function w(P,a,R,z,$,V){var W=R&c,ie=P.length,ae=a.length;if(ie!=ae&&!(W&&ae>ie))return!1;var ee=V.get(P),ne=V.get(a);if(ee&&ne)return ee==a&&ne==P;var de=-1,xe=!0,be=R&y?new r:void 0;for(V.set(P,a),V.set(a,P);++de<ie;){var ke=P[de],he=a[de];if(z)var _e=W?z(he,ke,de,a,P,V):z(ke,he,de,P,a,V);if(_e!==void 0){if(_e)continue;xe=!1;break}if(be){if(!n(a,function(ze,Ne){if(!l(be,Ne)&&(ke===ze||$(ke,ze,R,z,V)))return be.push(Ne)})){xe=!1;break}}else if(!(ke===he||$(ke,he,R,z,V))){xe=!1;break}}return V.delete(P),V.delete(a),xe}return Ow=w,Ow}var Rw,yR;function m8(){if(yR)return Rw;yR=1;var r=Lh(),n=r.Uint8Array;return Rw=n,Rw}var kw,vR;function g8(){if(vR)return kw;vR=1;function r(n){var l=-1,c=Array(n.size);return n.forEach(function(y,w){c[++l]=[w,y]}),c}return kw=r,kw}var Dw,xR;function ZA(){if(xR)return Dw;xR=1;function r(n){var l=-1,c=Array(n.size);return n.forEach(function(y){c[++l]=y}),c}return Dw=r,Dw}var zw,bR;function _8(){if(bR)return zw;bR=1;var r=jy(),n=m8(),l=LA(),c=bF(),y=g8(),w=ZA(),P=1,a=2,R="[object Boolean]",z="[object Date]",$="[object Error]",V="[object Map]",W="[object Number]",ie="[object RegExp]",ae="[object Set]",ee="[object String]",ne="[object Symbol]",de="[object ArrayBuffer]",xe="[object DataView]",be=r?r.prototype:void 0,ke=be?be.valueOf:void 0;function he(_e,ze,Ne,rt,kt,He,yt){switch(Ne){case xe:if(_e.byteLength!=ze.byteLength||_e.byteOffset!=ze.byteOffset)return!1;_e=_e.buffer,ze=ze.buffer;case de:return!(_e.byteLength!=ze.byteLength||!He(new n(_e),new n(ze)));case R:case z:case W:return l(+_e,+ze);case $:return _e.name==ze.name&&_e.message==ze.message;case ie:case ee:return _e==ze+"";case V:var gt=y;case ae:var Pt=rt&P;if(gt||(gt=w),_e.size!=ze.size&&!Pt)return!1;var xt=yt.get(_e);if(xt)return xt==ze;rt|=a,yt.set(_e,ze);var Tt=c(gt(_e),gt(ze),rt,kt,He,yt);return yt.delete(_e),Tt;case ne:if(ke)return ke.call(_e)==ke.call(ze)}return!1}return zw=he,zw}var Lw,wR;function wF(){if(wR)return Lw;wR=1;function r(n,l){for(var c=-1,y=l.length,w=n.length;++c<y;)n[w+c]=l[c];return n}return Lw=r,Lw}var Fw,SR;function y8(){if(SR)return Fw;SR=1;var r=wF(),n=bl();function l(c,y,w){var P=y(c);return n(c)?P:r(P,w(c))}return Fw=l,Fw}var Bw,TR;function v8(){if(TR)return Bw;TR=1;function r(n,l){for(var c=-1,y=n==null?0:n.length,w=0,P=[];++c<y;){var a=n[c];l(a,c,n)&&(P[w++]=a)}return P}return Bw=r,Bw}var Nw,ER;function x8(){if(ER)return Nw;ER=1;function r(){return[]}return Nw=r,Nw}var jw,AR;function b8(){if(AR)return jw;AR=1;var r=v8(),n=x8(),l=Object.prototype,c=l.propertyIsEnumerable,y=Object.getOwnPropertySymbols,w=y?function(P){return P==null?[]:(P=Object(P),r(y(P),function(a){return c.call(P,a)}))}:n;return jw=w,jw}var Uw,PR;function w8(){if(PR)return Uw;PR=1;function r(n,l){for(var c=-1,y=Array(n);++c<n;)y[c]=l(c);return y}return Uw=r,Uw}var Vw,IR;function S8(){if(IR)return Vw;IR=1;var r=Wf(),n=Zf(),l="[object Arguments]";function c(y){return n(y)&&r(y)==l}return Vw=c,Vw}var $w,CR;function XA(){if(CR)return $w;CR=1;var r=S8(),n=Zf(),l=Object.prototype,c=l.hasOwnProperty,y=l.propertyIsEnumerable,w=r((function(){return arguments})())?r:function(P){return n(P)&&c.call(P,"callee")&&!y.call(P,"callee")};return $w=w,$w}var K_={exports:{}},qw,MR;function T8(){if(MR)return qw;MR=1;function r(){return!1}return qw=r,qw}K_.exports;var OR;function SF(){return OR||(OR=1,(function(r,n){var l=Lh(),c=T8(),y=n&&!n.nodeType&&n,w=y&&!0&&r&&!r.nodeType&&r,P=w&&w.exports===y,a=P?l.Buffer:void 0,R=a?a.isBuffer:void 0,z=R||c;r.exports=z})(K_,K_.exports)),K_.exports}var Gw,RR;function KA(){if(RR)return Gw;RR=1;var r=9007199254740991,n=/^(?:0|[1-9]\d*)$/;function l(c,y){var w=typeof c;return y=y??r,!!y&&(w=="number"||w!="symbol"&&n.test(c))&&c>-1&&c%1==0&&c<y}return Gw=l,Gw}var Hw,kR;function YA(){if(kR)return Hw;kR=1;var r=9007199254740991;function n(l){return typeof l=="number"&&l>-1&&l%1==0&&l<=r}return Hw=n,Hw}var Ww,DR;function E8(){if(DR)return Ww;DR=1;var r=Wf(),n=YA(),l=Zf(),c="[object Arguments]",y="[object Array]",w="[object Boolean]",P="[object Date]",a="[object Error]",R="[object Function]",z="[object Map]",$="[object Number]",V="[object Object]",W="[object RegExp]",ie="[object Set]",ae="[object String]",ee="[object WeakMap]",ne="[object ArrayBuffer]",de="[object DataView]",xe="[object Float32Array]",be="[object Float64Array]",ke="[object Int8Array]",he="[object Int16Array]",_e="[object Int32Array]",ze="[object Uint8Array]",Ne="[object Uint8ClampedArray]",rt="[object Uint16Array]",kt="[object Uint32Array]",He={};He[xe]=He[be]=He[ke]=He[he]=He[_e]=He[ze]=He[Ne]=He[rt]=He[kt]=!0,He[c]=He[y]=He[ne]=He[w]=He[de]=He[P]=He[a]=He[R]=He[z]=He[$]=He[V]=He[W]=He[ie]=He[ae]=He[ee]=!1;function yt(gt){return l(gt)&&n(gt.length)&&!!He[r(gt)]}return Ww=yt,Ww}var Zw,zR;function TF(){if(zR)return Zw;zR=1;function r(n){return function(l){return n(l)}}return Zw=r,Zw}var Y_={exports:{}};Y_.exports;var LR;function A8(){return LR||(LR=1,(function(r,n){var l=q3(),c=n&&!n.nodeType&&n,y=c&&!0&&r&&!r.nodeType&&r,w=y&&y.exports===c,P=w&&l.process,a=(function(){try{var R=y&&y.require&&y.require("util").types;return R||P&&P.binding&&P.binding("util")}catch{}})();r.exports=a})(Y_,Y_.exports)),Y_.exports}var Xw,FR;function EF(){if(FR)return Xw;FR=1;var r=E8(),n=TF(),l=A8(),c=l&&l.isTypedArray,y=c?n(c):r;return Xw=y,Xw}var Kw,BR;function P8(){if(BR)return Kw;BR=1;var r=w8(),n=XA(),l=bl(),c=SF(),y=KA(),w=EF(),P=Object.prototype,a=P.hasOwnProperty;function R(z,$){var V=l(z),W=!V&&n(z),ie=!V&&!W&&c(z),ae=!V&&!W&&!ie&&w(z),ee=V||W||ie||ae,ne=ee?r(z.length,String):[],de=ne.length;for(var xe in z)($||a.call(z,xe))&&!(ee&&(xe=="length"||ie&&(xe=="offset"||xe=="parent")||ae&&(xe=="buffer"||xe=="byteLength"||xe=="byteOffset")||y(xe,de)))&&ne.push(xe);return ne}return Kw=R,Kw}var Yw,NR;function I8(){if(NR)return Yw;NR=1;var r=Object.prototype;function n(l){var c=l&&l.constructor,y=typeof c=="function"&&c.prototype||r;return l===y}return Yw=n,Yw}var Jw,jR;function AF(){if(jR)return Jw;jR=1;function r(n,l){return function(c){return n(l(c))}}return Jw=r,Jw}var Qw,UR;function C8(){if(UR)return Qw;UR=1;var r=AF(),n=r(Object.keys,Object);return Qw=n,Qw}var eS,VR;function M8(){if(VR)return eS;VR=1;var r=I8(),n=C8(),l=Object.prototype,c=l.hasOwnProperty;function y(w){if(!r(w))return n(w);var P=[];for(var a in Object(w))c.call(w,a)&&a!="constructor"&&P.push(a);return P}return eS=y,eS}var tS,$R;function $y(){if($R)return tS;$R=1;var r=zA(),n=YA();function l(c){return c!=null&&n(c.length)&&!r(c)}return tS=l,tS}var rS,qR;function fx(){if(qR)return rS;qR=1;var r=P8(),n=M8(),l=$y();function c(y){return l(y)?r(y):n(y)}return rS=c,rS}var nS,GR;function O8(){if(GR)return nS;GR=1;var r=y8(),n=b8(),l=fx();function c(y){return r(y,l,n)}return nS=c,nS}var iS,HR;function R8(){if(HR)return iS;HR=1;var r=O8(),n=1,l=Object.prototype,c=l.hasOwnProperty;function y(w,P,a,R,z,$){var V=a&n,W=r(w),ie=W.length,ae=r(P),ee=ae.length;if(ie!=ee&&!V)return!1;for(var ne=ie;ne--;){var de=W[ne];if(!(V?de in P:c.call(P,de)))return!1}var xe=$.get(w),be=$.get(P);if(xe&&be)return xe==P&&be==w;var ke=!0;$.set(w,P),$.set(P,w);for(var he=V;++ne<ie;){de=W[ne];var _e=w[de],ze=P[de];if(R)var Ne=V?R(ze,_e,de,P,w,$):R(_e,ze,de,w,P,$);if(!(Ne===void 0?_e===ze||z(_e,ze,a,R,$):Ne)){ke=!1;break}he||(he=de=="constructor")}if(ke&&!he){var rt=w.constructor,kt=P.constructor;rt!=kt&&"constructor"in w&&"constructor"in P&&!(typeof rt=="function"&&rt instanceof rt&&typeof kt=="function"&&kt instanceof kt)&&(ke=!1)}return $.delete(w),$.delete(P),ke}return iS=y,iS}var oS,WR;function k8(){if(WR)return oS;WR=1;var r=_m(),n=Lh(),l=r(n,"DataView");return oS=l,oS}var aS,ZR;function D8(){if(ZR)return aS;ZR=1;var r=_m(),n=Lh(),l=r(n,"Promise");return aS=l,aS}var sS,XR;function PF(){if(XR)return sS;XR=1;var r=_m(),n=Lh(),l=r(n,"Set");return sS=l,sS}var lS,KR;function z8(){if(KR)return lS;KR=1;var r=_m(),n=Lh(),l=r(n,"WeakMap");return lS=l,lS}var uS,YR;function L8(){if(YR)return uS;YR=1;var r=k8(),n=FA(),l=D8(),c=PF(),y=z8(),w=Wf(),P=G3(),a="[object Map]",R="[object Object]",z="[object Promise]",$="[object Set]",V="[object WeakMap]",W="[object DataView]",ie=P(r),ae=P(n),ee=P(l),ne=P(c),de=P(y),xe=w;return(r&&xe(new r(new ArrayBuffer(1)))!=W||n&&xe(new n)!=a||l&&xe(l.resolve())!=z||c&&xe(new c)!=$||y&&xe(new y)!=V)&&(xe=function(be){var ke=w(be),he=ke==R?be.constructor:void 0,_e=he?P(he):"";if(_e)switch(_e){case ie:return W;case ae:return a;case ee:return z;case ne:return $;case de:return V}return ke}),uS=xe,uS}var cS,JR;function F8(){if(JR)return cS;JR=1;var r=_F(),n=bF(),l=_8(),c=R8(),y=L8(),w=bl(),P=SF(),a=EF(),R=1,z="[object Arguments]",$="[object Array]",V="[object Object]",W=Object.prototype,ie=W.hasOwnProperty;function ae(ee,ne,de,xe,be,ke){var he=w(ee),_e=w(ne),ze=he?$:y(ee),Ne=_e?$:y(ne);ze=ze==z?V:ze,Ne=Ne==z?V:Ne;var rt=ze==V,kt=Ne==V,He=ze==Ne;if(He&&P(ee)){if(!P(ne))return!1;he=!0,rt=!1}if(He&&!rt)return ke||(ke=new r),he||a(ee)?n(ee,ne,de,xe,be,ke):l(ee,ne,ze,de,xe,be,ke);if(!(de&R)){var yt=rt&&ie.call(ee,"__wrapped__"),gt=kt&&ie.call(ne,"__wrapped__");if(yt||gt){var Pt=yt?ee.value():ee,xt=gt?ne.value():ne;return ke||(ke=new r),be(Pt,xt,de,xe,ke)}}return He?(ke||(ke=new r),c(ee,ne,de,xe,be,ke)):!1}return cS=ae,cS}var hS,QR;function JA(){if(QR)return hS;QR=1;var r=F8(),n=Zf();function l(c,y,w,P,a){return c===y?!0:c==null||y==null||!n(c)&&!n(y)?c!==c&&y!==y:r(c,y,w,P,l,a)}return hS=l,hS}var fS,ek;function B8(){if(ek)return fS;ek=1;var r=_F(),n=JA(),l=1,c=2;function y(w,P,a,R){var z=a.length,$=z,V=!R;if(w==null)return!$;for(w=Object(w);z--;){var W=a[z];if(V&&W[2]?W[1]!==w[W[0]]:!(W[0]in w))return!1}for(;++z<$;){W=a[z];var ie=W[0],ae=w[ie],ee=W[1];if(V&&W[2]){if(ae===void 0&&!(ie in w))return!1}else{var ne=new r;if(R)var de=R(ae,ee,ie,w,P,ne);if(!(de===void 0?n(ee,ae,l|c,R,ne):de))return!1}}return!0}return fS=y,fS}var dS,tk;function IF(){if(tk)return dS;tk=1;var r=fp();function n(l){return l===l&&!r(l)}return dS=n,dS}var pS,rk;function N8(){if(rk)return pS;rk=1;var r=IF(),n=fx();function l(c){for(var y=n(c),w=y.length;w--;){var P=y[w],a=c[P];y[w]=[P,a,r(a)]}return y}return pS=l,pS}var mS,nk;function CF(){if(nk)return mS;nk=1;function r(n,l){return function(c){return c==null?!1:c[n]===l&&(l!==void 0||n in Object(c))}}return mS=r,mS}var gS,ik;function j8(){if(ik)return gS;ik=1;var r=B8(),n=N8(),l=CF();function c(y){var w=n(y);return w.length==1&&w[0][2]?l(w[0][0],w[0][1]):function(P){return P===y||r(P,y,w)}}return gS=c,gS}var _S,ok;function U8(){if(ok)return _S;ok=1;function r(n,l){return n!=null&&l in Object(n)}return _S=r,_S}var yS,ak;function V8(){if(ak)return yS;ak=1;var r=Z3(),n=XA(),l=bl(),c=KA(),y=YA(),w=sx();function P(a,R,z){R=r(R,a);for(var $=-1,V=R.length,W=!1;++$<V;){var ie=w(R[$]);if(!(W=a!=null&&z(a,ie)))break;a=a[ie]}return W||++$!=V?W:(V=a==null?0:a.length,!!V&&y(V)&&c(ie,V)&&(l(a)||n(a)))}return yS=P,yS}var vS,sk;function $8(){if(sk)return vS;sk=1;var r=U8(),n=V8();function l(c,y){return c!=null&&n(c,y,r)}return vS=l,vS}var xS,lk;function q8(){if(lk)return xS;lk=1;var r=JA(),n=X3(),l=$8(),c=DA(),y=IF(),w=CF(),P=sx(),a=1,R=2;function z($,V){return c($)&&y(V)?w(P($),V):function(W){var ie=n(W,$);return ie===void 0&&ie===V?l(W,$):r(V,ie,a|R)}}return xS=z,xS}var bS,uk;function qg(){if(uk)return bS;uk=1;function r(n){return n}return bS=r,bS}var wS,ck;function G8(){if(ck)return wS;ck=1;function r(n){return function(l){return l?.[n]}}return wS=r,wS}var SS,hk;function H8(){if(hk)return SS;hk=1;var r=jA();function n(l){return function(c){return r(c,l)}}return SS=n,SS}var TS,fk;function W8(){if(fk)return TS;fk=1;var r=G8(),n=H8(),l=DA(),c=sx();function y(w){return l(w)?r(c(w)):n(w)}return TS=y,TS}var ES,dk;function Fh(){if(dk)return ES;dk=1;var r=j8(),n=q8(),l=qg(),c=bl(),y=W8();function w(P){return typeof P=="function"?P:P==null?l:typeof P=="object"?c(P)?n(P[0],P[1]):r(P):y(P)}return ES=w,ES}var AS,pk;function MF(){if(pk)return AS;pk=1;function r(n,l,c,y){for(var w=n.length,P=c+(y?1:-1);y?P--:++P<w;)if(l(n[P],P,n))return P;return-1}return AS=r,AS}var PS,mk;function Z8(){if(mk)return PS;mk=1;function r(n){return n!==n}return PS=r,PS}var IS,gk;function X8(){if(gk)return IS;gk=1;function r(n,l,c){for(var y=c-1,w=n.length;++y<w;)if(n[y]===l)return y;return-1}return IS=r,IS}var CS,_k;function K8(){if(_k)return CS;_k=1;var r=MF(),n=Z8(),l=X8();function c(y,w,P){return w===w?l(y,w,P):r(y,n,P)}return CS=c,CS}var MS,yk;function Y8(){if(yk)return MS;yk=1;var r=K8();function n(l,c){var y=l==null?0:l.length;return!!y&&r(l,c,0)>-1}return MS=n,MS}var OS,vk;function J8(){if(vk)return OS;vk=1;function r(n,l,c){for(var y=-1,w=n==null?0:n.length;++y<w;)if(c(l,n[y]))return!0;return!1}return OS=r,OS}var RS,xk;function Q8(){if(xk)return RS;xk=1;function r(){}return RS=r,RS}var kS,bk;function eq(){if(bk)return kS;bk=1;var r=PF(),n=Q8(),l=ZA(),c=1/0,y=r&&1/l(new r([,-0]))[1]==c?function(w){return new r(w)}:n;return kS=y,kS}var DS,wk;function tq(){if(wk)return DS;wk=1;var r=yF(),n=Y8(),l=J8(),c=xF(),y=eq(),w=ZA(),P=200;function a(R,z,$){var V=-1,W=n,ie=R.length,ae=!0,ee=[],ne=ee;if($)ae=!1,W=l;else if(ie>=P){var de=z?null:y(R);if(de)return w(de);ae=!1,W=c,ne=new r}else ne=z?[]:ee;e:for(;++V<ie;){var xe=R[V],be=z?z(xe):xe;if(xe=$||xe!==0?xe:0,ae&&be===be){for(var ke=ne.length;ke--;)if(ne[ke]===be)continue e;z&&ne.push(be),ee.push(xe)}else W(ne,be,$)||(ne!==ee&&ne.push(be),ee.push(xe))}return ee}return DS=a,DS}var zS,Sk;function rq(){if(Sk)return zS;Sk=1;var r=Fh(),n=tq();function l(c,y){return c&&c.length?n(c,r(y,2)):[]}return zS=l,zS}var nq=rq();const Tk=Xi(nq);function OF(r,n,l){return n===!0?Tk(r,l):Zn(n)?Tk(r,n):r}function yg(r){"@babel/helpers - typeof";return yg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},yg(r)}var iq=["ref"];function Ek(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Df(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?Ek(Object(l),!0).forEach(function(c){dx(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):Ek(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function oq(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function Ak(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,kF(c.key),c)}}function aq(r,n,l){return n&&Ak(r.prototype,n),l&&Ak(r,l),Object.defineProperty(r,"prototype",{writable:!1}),r}function sq(r,n,l){return n=m0(n),lq(r,RF()?Reflect.construct(n,l||[],m0(r).constructor):n.apply(r,l))}function lq(r,n){if(n&&(yg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return uq(r)}function uq(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function RF(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(RF=function(){return!!r})()}function m0(r){return m0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},m0(r)}function cq(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&TE(r,n)}function TE(r,n){return TE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},TE(r,n)}function dx(r,n,l){return n=kF(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function kF(r){var n=hq(r,"string");return yg(n)=="symbol"?n:n+""}function hq(r,n){if(yg(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(yg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function fq(r,n){if(r==null)return{};var l=dq(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function dq(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}function pq(r){return r.value}function mq(r,n){if(ct.isValidElement(r))return ct.cloneElement(r,n);if(typeof r=="function")return ct.createElement(r,n);n.ref;var l=fq(n,iq);return ct.createElement(WA,l)}var Pk=1,fg=(function(r){function n(){var l;oq(this,n);for(var c=arguments.length,y=new Array(c),w=0;w<c;w++)y[w]=arguments[w];return l=sq(this,n,[].concat(y)),dx(l,"lastBoundingBox",{width:-1,height:-1}),l}return cq(n,r),aq(n,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var c=this.wrapperNode.getBoundingClientRect();return c.height=this.wrapperNode.offsetHeight,c.width=this.wrapperNode.offsetWidth,c}return null}},{key:"updateBBox",value:function(){var c=this.props.onBBoxUpdate,y=this.getBBox();y?(Math.abs(y.width-this.lastBoundingBox.width)>Pk||Math.abs(y.height-this.lastBoundingBox.height)>Pk)&&(this.lastBoundingBox.width=y.width,this.lastBoundingBox.height=y.height,c&&c(y)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,c&&c(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?Df({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(c){var y=this.props,w=y.layout,P=y.align,a=y.verticalAlign,R=y.margin,z=y.chartWidth,$=y.chartHeight,V,W;if(!c||(c.left===void 0||c.left===null)&&(c.right===void 0||c.right===null))if(P==="center"&&w==="vertical"){var ie=this.getBBoxSnapshot();V={left:((z||0)-ie.width)/2}}else V=P==="right"?{right:R&&R.right||0}:{left:R&&R.left||0};if(!c||(c.top===void 0||c.top===null)&&(c.bottom===void 0||c.bottom===null))if(a==="middle"){var ae=this.getBBoxSnapshot();W={top:(($||0)-ae.height)/2}}else W=a==="bottom"?{bottom:R&&R.bottom||0}:{top:R&&R.top||0};return Df(Df({},V),W)}},{key:"render",value:function(){var c=this,y=this.props,w=y.content,P=y.width,a=y.height,R=y.wrapperStyle,z=y.payloadUniqBy,$=y.payload,V=Df(Df({position:"absolute",width:P||"auto",height:a||"auto"},this.getDefaultPosition(R)),R);return ct.createElement("div",{className:"recharts-legend-wrapper",style:V,ref:function(ie){c.wrapperNode=ie}},mq(w,Df(Df({},this.props),{},{payload:OF($,z,pq)})))}}],[{key:"getWithHeight",value:function(c,y){var w=Df(Df({},this.defaultProps),c.props),P=w.layout;return P==="vertical"&&Rr(c.props.height)?{height:c.props.height}:P==="horizontal"?{width:c.props.width||y}:null}}])})(ir.PureComponent);dx(fg,"displayName","Legend");dx(fg,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var LS,Ik;function gq(){if(Ik)return LS;Ik=1;var r=jy(),n=XA(),l=bl(),c=r?r.isConcatSpreadable:void 0;function y(w){return l(w)||n(w)||!!(c&&w&&w[c])}return LS=y,LS}var FS,Ck;function DF(){if(Ck)return FS;Ck=1;var r=wF(),n=gq();function l(c,y,w,P,a){var R=-1,z=c.length;for(w||(w=n),a||(a=[]);++R<z;){var $=c[R];y>0&&w($)?y>1?l($,y-1,w,P,a):r(a,$):P||(a[a.length]=$)}return a}return FS=l,FS}var BS,Mk;function _q(){if(Mk)return BS;Mk=1;function r(n){return function(l,c,y){for(var w=-1,P=Object(l),a=y(l),R=a.length;R--;){var z=a[n?R:++w];if(c(P[z],z,P)===!1)break}return l}}return BS=r,BS}var NS,Ok;function yq(){if(Ok)return NS;Ok=1;var r=_q(),n=r();return NS=n,NS}var jS,Rk;function zF(){if(Rk)return jS;Rk=1;var r=yq(),n=fx();function l(c,y){return c&&r(c,y,n)}return jS=l,jS}var US,kk;function vq(){if(kk)return US;kk=1;var r=$y();function n(l,c){return function(y,w){if(y==null)return y;if(!r(y))return l(y,w);for(var P=y.length,a=c?P:-1,R=Object(y);(c?a--:++a<P)&&w(R[a],a,R)!==!1;);return y}}return US=n,US}var VS,Dk;function QA(){if(Dk)return VS;Dk=1;var r=zF(),n=vq(),l=n(r);return VS=l,VS}var $S,zk;function LF(){if(zk)return $S;zk=1;var r=QA(),n=$y();function l(c,y){var w=-1,P=n(c)?Array(c.length):[];return r(c,function(a,R,z){P[++w]=y(a,R,z)}),P}return $S=l,$S}var qS,Lk;function xq(){if(Lk)return qS;Lk=1;function r(n,l){var c=n.length;for(n.sort(l);c--;)n[c]=n[c].value;return n}return qS=r,qS}var GS,Fk;function bq(){if(Fk)return GS;Fk=1;var r=Vg();function n(l,c){if(l!==c){var y=l!==void 0,w=l===null,P=l===l,a=r(l),R=c!==void 0,z=c===null,$=c===c,V=r(c);if(!z&&!V&&!a&&l>c||a&&R&&$&&!z&&!V||w&&R&&$||!y&&$||!P)return 1;if(!w&&!a&&!V&&l<c||V&&y&&P&&!w&&!a||z&&y&&P||!R&&P||!$)return-1}return 0}return GS=n,GS}var HS,Bk;function wq(){if(Bk)return HS;Bk=1;var r=bq();function n(l,c,y){for(var w=-1,P=l.criteria,a=c.criteria,R=P.length,z=y.length;++w<R;){var $=r(P[w],a[w]);if($){if(w>=z)return $;var V=y[w];return $*(V=="desc"?-1:1)}}return l.index-c.index}return HS=n,HS}var WS,Nk;function Sq(){if(Nk)return WS;Nk=1;var r=NA(),n=jA(),l=Fh(),c=LF(),y=xq(),w=TF(),P=wq(),a=qg(),R=bl();function z($,V,W){V.length?V=r(V,function(ee){return R(ee)?function(ne){return n(ne,ee.length===1?ee[0]:ee)}:ee}):V=[a];var ie=-1;V=r(V,w(l));var ae=c($,function(ee,ne,de){var xe=r(V,function(be){return be(ee)});return{criteria:xe,index:++ie,value:ee}});return y(ae,function(ee,ne){return P(ee,ne,W)})}return WS=z,WS}var ZS,jk;function Tq(){if(jk)return ZS;jk=1;function r(n,l,c){switch(c.length){case 0:return n.call(l);case 1:return n.call(l,c[0]);case 2:return n.call(l,c[0],c[1]);case 3:return n.call(l,c[0],c[1],c[2])}return n.apply(l,c)}return ZS=r,ZS}var XS,Uk;function Eq(){if(Uk)return XS;Uk=1;var r=Tq(),n=Math.max;function l(c,y,w){return y=n(y===void 0?c.length-1:y,0),function(){for(var P=arguments,a=-1,R=n(P.length-y,0),z=Array(R);++a<R;)z[a]=P[y+a];a=-1;for(var $=Array(y+1);++a<y;)$[a]=P[a];return $[y]=w(z),r(c,this,$)}}return XS=l,XS}var KS,Vk;function Aq(){if(Vk)return KS;Vk=1;function r(n){return function(){return n}}return KS=r,KS}var YS,$k;function FF(){if($k)return YS;$k=1;var r=_m(),n=(function(){try{var l=r(Object,"defineProperty");return l({},"",{}),l}catch{}})();return YS=n,YS}var JS,qk;function Pq(){if(qk)return JS;qk=1;var r=Aq(),n=FF(),l=qg(),c=n?function(y,w){return n(y,"toString",{configurable:!0,enumerable:!1,value:r(w),writable:!0})}:l;return JS=c,JS}var QS,Gk;function Iq(){if(Gk)return QS;Gk=1;var r=800,n=16,l=Date.now;function c(y){var w=0,P=0;return function(){var a=l(),R=n-(a-P);if(P=a,R>0){if(++w>=r)return arguments[0]}else w=0;return y.apply(void 0,arguments)}}return QS=c,QS}var eT,Hk;function Cq(){if(Hk)return eT;Hk=1;var r=Pq(),n=Iq(),l=n(r);return eT=l,eT}var tT,Wk;function Mq(){if(Wk)return tT;Wk=1;var r=qg(),n=Eq(),l=Cq();function c(y,w){return l(n(y,w,r),y+"")}return tT=c,tT}var rT,Zk;function px(){if(Zk)return rT;Zk=1;var r=LA(),n=$y(),l=KA(),c=fp();function y(w,P,a){if(!c(a))return!1;var R=typeof P;return(R=="number"?n(a)&&l(P,a.length):R=="string"&&P in a)?r(a[P],w):!1}return rT=y,rT}var nT,Xk;function Oq(){if(Xk)return nT;Xk=1;var r=DF(),n=Sq(),l=Mq(),c=px(),y=l(function(w,P){if(w==null)return[];var a=P.length;return a>1&&c(w,P[0],P[1])?P=[]:a>2&&c(P[0],P[1],P[2])&&(P=[P[0]]),n(w,r(P,1),[])});return nT=y,nT}var Rq=Oq();const e2=Xi(Rq);function sy(r){"@babel/helpers - typeof";return sy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},sy(r)}function EE(){return EE=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},EE.apply(this,arguments)}function kq(r,n){return Fq(r)||Lq(r,n)||zq(r,n)||Dq()}function Dq(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zq(r,n){if(r){if(typeof r=="string")return Kk(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return Kk(r,n)}}function Kk(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function Lq(r,n){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var c,y,w,P,a=[],R=!0,z=!1;try{if(w=(l=l.call(r)).next,n!==0)for(;!(R=(c=w.call(l)).done)&&(a.push(c.value),a.length!==n);R=!0);}catch($){z=!0,y=$}finally{try{if(!R&&l.return!=null&&(P=l.return(),Object(P)!==P))return}finally{if(z)throw y}}return a}}function Fq(r){if(Array.isArray(r))return r}function Yk(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function iT(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?Yk(Object(l),!0).forEach(function(c){Bq(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):Yk(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function Bq(r,n,l){return n=Nq(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function Nq(r){var n=jq(r,"string");return sy(n)=="symbol"?n:n+""}function jq(r,n){if(sy(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(sy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function Uq(r){return Array.isArray(r)&&za(r[0])&&za(r[1])?r.join(" ~ "):r}var Vq=function(n){var l=n.separator,c=l===void 0?" : ":l,y=n.contentStyle,w=y===void 0?{}:y,P=n.itemStyle,a=P===void 0?{}:P,R=n.labelStyle,z=R===void 0?{}:R,$=n.payload,V=n.formatter,W=n.itemSorter,ie=n.wrapperClassName,ae=n.labelClassName,ee=n.label,ne=n.labelFormatter,de=n.accessibilityLayer,xe=de===void 0?!1:de,be=function(){if($&&$.length){var yt={padding:0,margin:0},gt=(W?e2($,W):$).map(function(Pt,xt){if(Pt.type==="none")return null;var Tt=iT({display:"block",paddingTop:4,paddingBottom:4,color:Pt.color||"#000"},a),Ht=Pt.formatter||V||Uq,lt=Pt.value,Wt=Pt.name,Zt=lt,$e=Wt;if(Ht&&Zt!=null&&$e!=null){var pt=Ht(lt,Wt,Pt,xt,$);if(Array.isArray(pt)){var fr=kq(pt,2);Zt=fr[0],$e=fr[1]}else Zt=pt}return ct.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(xt),style:Tt},za($e)?ct.createElement("span",{className:"recharts-tooltip-item-name"},$e):null,za($e)?ct.createElement("span",{className:"recharts-tooltip-item-separator"},c):null,ct.createElement("span",{className:"recharts-tooltip-item-value"},Zt),ct.createElement("span",{className:"recharts-tooltip-item-unit"},Pt.unit||""))});return ct.createElement("ul",{className:"recharts-tooltip-item-list",style:yt},gt)}return null},ke=iT({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},w),he=iT({margin:0},z),_e=!xi(ee),ze=_e?ee:"",Ne=ui("recharts-default-tooltip",ie),rt=ui("recharts-tooltip-label",ae);_e&&ne&&$!==void 0&&$!==null&&(ze=ne(ee,$));var kt=xe?{role:"status","aria-live":"assertive"}:{};return ct.createElement("div",EE({className:Ne,style:ke},kt),ct.createElement("p",{className:rt,style:he},ct.isValidElement(ze)?ze:"".concat(ze)),be())};function ly(r){"@babel/helpers - typeof";return ly=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ly(r)}function Hv(r,n,l){return n=$q(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function $q(r){var n=qq(r,"string");return ly(n)=="symbol"?n:n+""}function qq(r,n){if(ly(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(ly(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}var U_="recharts-tooltip-wrapper",Gq={visibility:"hidden"};function Hq(r){var n=r.coordinate,l=r.translateX,c=r.translateY;return ui(U_,Hv(Hv(Hv(Hv({},"".concat(U_,"-right"),Rr(l)&&n&&Rr(n.x)&&l>=n.x),"".concat(U_,"-left"),Rr(l)&&n&&Rr(n.x)&&l<n.x),"".concat(U_,"-bottom"),Rr(c)&&n&&Rr(n.y)&&c>=n.y),"".concat(U_,"-top"),Rr(c)&&n&&Rr(n.y)&&c<n.y))}function Jk(r){var n=r.allowEscapeViewBox,l=r.coordinate,c=r.key,y=r.offsetTopLeft,w=r.position,P=r.reverseDirection,a=r.tooltipDimension,R=r.viewBox,z=r.viewBoxDimension;if(w&&Rr(w[c]))return w[c];var $=l[c]-a-y,V=l[c]+y;if(n[c])return P[c]?$:V;if(P[c]){var W=$,ie=R[c];return W<ie?Math.max(V,R[c]):Math.max($,R[c])}var ae=V+a,ee=R[c]+z;return ae>ee?Math.max($,R[c]):Math.max(V,R[c])}function Wq(r){var n=r.translateX,l=r.translateY,c=r.useTranslate3d;return{transform:c?"translate3d(".concat(n,"px, ").concat(l,"px, 0)"):"translate(".concat(n,"px, ").concat(l,"px)")}}function Zq(r){var n=r.allowEscapeViewBox,l=r.coordinate,c=r.offsetTopLeft,y=r.position,w=r.reverseDirection,P=r.tooltipBox,a=r.useTranslate3d,R=r.viewBox,z,$,V;return P.height>0&&P.width>0&&l?($=Jk({allowEscapeViewBox:n,coordinate:l,key:"x",offsetTopLeft:c,position:y,reverseDirection:w,tooltipDimension:P.width,viewBox:R,viewBoxDimension:R.width}),V=Jk({allowEscapeViewBox:n,coordinate:l,key:"y",offsetTopLeft:c,position:y,reverseDirection:w,tooltipDimension:P.height,viewBox:R,viewBoxDimension:R.height}),z=Wq({translateX:$,translateY:V,useTranslate3d:a})):z=Gq,{cssProperties:z,cssClasses:Hq({translateX:$,translateY:V,coordinate:l})}}function vg(r){"@babel/helpers - typeof";return vg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},vg(r)}function Qk(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function eD(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?Qk(Object(l),!0).forEach(function(c){PE(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):Qk(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function Xq(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function Kq(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,NF(c.key),c)}}function Yq(r,n,l){return n&&Kq(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function Jq(r,n,l){return n=g0(n),Qq(r,BF()?Reflect.construct(n,l||[],g0(r).constructor):n.apply(r,l))}function Qq(r,n){if(n&&(vg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return eG(r)}function eG(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function BF(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(BF=function(){return!!r})()}function g0(r){return g0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},g0(r)}function tG(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&AE(r,n)}function AE(r,n){return AE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},AE(r,n)}function PE(r,n,l){return n=NF(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function NF(r){var n=rG(r,"string");return vg(n)=="symbol"?n:n+""}function rG(r,n){if(vg(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(vg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var tD=1,nG=(function(r){function n(){var l;Xq(this,n);for(var c=arguments.length,y=new Array(c),w=0;w<c;w++)y[w]=arguments[w];return l=Jq(this,n,[].concat(y)),PE(l,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),PE(l,"handleKeyDown",function(P){if(P.key==="Escape"){var a,R,z,$;l.setState({dismissed:!0,dismissedAtCoordinate:{x:(a=(R=l.props.coordinate)===null||R===void 0?void 0:R.x)!==null&&a!==void 0?a:0,y:(z=($=l.props.coordinate)===null||$===void 0?void 0:$.y)!==null&&z!==void 0?z:0}})}}),l}return tG(n,r),Yq(n,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var c=this.wrapperNode.getBoundingClientRect();(Math.abs(c.width-this.state.lastBoundingBox.width)>tD||Math.abs(c.height-this.state.lastBoundingBox.height)>tD)&&this.setState({lastBoundingBox:{width:c.width,height:c.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var c,y;this.props.active&&this.updateBBox(),this.state.dismissed&&(((c=this.props.coordinate)===null||c===void 0?void 0:c.x)!==this.state.dismissedAtCoordinate.x||((y=this.props.coordinate)===null||y===void 0?void 0:y.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var c=this,y=this.props,w=y.active,P=y.allowEscapeViewBox,a=y.animationDuration,R=y.animationEasing,z=y.children,$=y.coordinate,V=y.hasPayload,W=y.isAnimationActive,ie=y.offset,ae=y.position,ee=y.reverseDirection,ne=y.useTranslate3d,de=y.viewBox,xe=y.wrapperStyle,be=Zq({allowEscapeViewBox:P,coordinate:$,offsetTopLeft:ie,position:ae,reverseDirection:ee,tooltipBox:this.state.lastBoundingBox,useTranslate3d:ne,viewBox:de}),ke=be.cssClasses,he=be.cssProperties,_e=eD(eD({transition:W&&w?"transform ".concat(a,"ms ").concat(R):void 0},he),{},{pointerEvents:"none",visibility:!this.state.dismissed&&w&&V?"visible":"hidden",position:"absolute",top:0,left:0},xe);return ct.createElement("div",{tabIndex:-1,className:ke,style:_e,ref:function(Ne){c.wrapperNode=Ne}},z)}}])})(ir.PureComponent),iG=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Gg={isSsr:iG()};function xg(r){"@babel/helpers - typeof";return xg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},xg(r)}function rD(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function nD(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?rD(Object(l),!0).forEach(function(c){t2(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):rD(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function oG(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function aG(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,UF(c.key),c)}}function sG(r,n,l){return n&&aG(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function lG(r,n,l){return n=_0(n),uG(r,jF()?Reflect.construct(n,l||[],_0(r).constructor):n.apply(r,l))}function uG(r,n){if(n&&(xg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cG(r)}function cG(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function jF(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(jF=function(){return!!r})()}function _0(r){return _0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},_0(r)}function hG(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&IE(r,n)}function IE(r,n){return IE=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},IE(r,n)}function t2(r,n,l){return n=UF(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function UF(r){var n=fG(r,"string");return xg(n)=="symbol"?n:n+""}function fG(r,n){if(xg(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(xg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function dG(r){return r.dataKey}function pG(r,n){return ct.isValidElement(r)?ct.cloneElement(r,n):typeof r=="function"?ct.createElement(r,n):ct.createElement(Vq,n)}var zf=(function(r){function n(){return oG(this,n),lG(this,n,arguments)}return hG(n,r),sG(n,[{key:"render",value:function(){var c=this,y=this.props,w=y.active,P=y.allowEscapeViewBox,a=y.animationDuration,R=y.animationEasing,z=y.content,$=y.coordinate,V=y.filterNull,W=y.isAnimationActive,ie=y.offset,ae=y.payload,ee=y.payloadUniqBy,ne=y.position,de=y.reverseDirection,xe=y.useTranslate3d,be=y.viewBox,ke=y.wrapperStyle,he=ae??[];V&&he.length&&(he=OF(ae.filter(function(ze){return ze.value!=null&&(ze.hide!==!0||c.props.includeHidden)}),ee,dG));var _e=he.length>0;return ct.createElement(nG,{allowEscapeViewBox:P,animationDuration:a,animationEasing:R,isAnimationActive:W,active:w,coordinate:$,hasPayload:_e,offset:ie,position:ne,reverseDirection:de,useTranslate3d:xe,viewBox:be,wrapperStyle:ke},pG(z,nD(nD({},this.props),{},{payload:he})))}}])})(ir.PureComponent);t2(zf,"displayName","Tooltip");t2(zf,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Gg.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var oT,iD;function mG(){if(iD)return oT;iD=1;var r=Lh(),n=function(){return r.Date.now()};return oT=n,oT}var aT,oD;function gG(){if(oD)return aT;oD=1;var r=/\s/;function n(l){for(var c=l.length;c--&&r.test(l.charAt(c)););return c}return aT=n,aT}var sT,aD;function _G(){if(aD)return sT;aD=1;var r=gG(),n=/^\s+/;function l(c){return c&&c.slice(0,r(c)+1).replace(n,"")}return sT=l,sT}var lT,sD;function VF(){if(sD)return lT;sD=1;var r=_G(),n=fp(),l=Vg(),c=NaN,y=/^[-+]0x[0-9a-f]+$/i,w=/^0b[01]+$/i,P=/^0o[0-7]+$/i,a=parseInt;function R(z){if(typeof z=="number")return z;if(l(z))return c;if(n(z)){var $=typeof z.valueOf=="function"?z.valueOf():z;z=n($)?$+"":$}if(typeof z!="string")return z===0?z:+z;z=r(z);var V=w.test(z);return V||P.test(z)?a(z.slice(2),V?2:8):y.test(z)?c:+z}return lT=R,lT}var uT,lD;function yG(){if(lD)return uT;lD=1;var r=fp(),n=mG(),l=VF(),c="Expected a function",y=Math.max,w=Math.min;function P(a,R,z){var $,V,W,ie,ae,ee,ne=0,de=!1,xe=!1,be=!0;if(typeof a!="function")throw new TypeError(c);R=l(R)||0,r(z)&&(de=!!z.leading,xe="maxWait"in z,W=xe?y(l(z.maxWait)||0,R):W,be="trailing"in z?!!z.trailing:be);function ke(gt){var Pt=$,xt=V;return $=V=void 0,ne=gt,ie=a.apply(xt,Pt),ie}function he(gt){return ne=gt,ae=setTimeout(Ne,R),de?ke(gt):ie}function _e(gt){var Pt=gt-ee,xt=gt-ne,Tt=R-Pt;return xe?w(Tt,W-xt):Tt}function ze(gt){var Pt=gt-ee,xt=gt-ne;return ee===void 0||Pt>=R||Pt<0||xe&&xt>=W}function Ne(){var gt=n();if(ze(gt))return rt(gt);ae=setTimeout(Ne,_e(gt))}function rt(gt){return ae=void 0,be&&$?ke(gt):($=V=void 0,ie)}function kt(){ae!==void 0&&clearTimeout(ae),ne=0,$=ee=V=ae=void 0}function He(){return ae===void 0?ie:rt(n())}function yt(){var gt=n(),Pt=ze(gt);if($=arguments,V=this,ee=gt,Pt){if(ae===void 0)return he(ee);if(xe)return clearTimeout(ae),ae=setTimeout(Ne,R),ke(ee)}return ae===void 0&&(ae=setTimeout(Ne,R)),ie}return yt.cancel=kt,yt.flush=He,yt}return uT=P,uT}var cT,uD;function vG(){if(uD)return cT;uD=1;var r=yG(),n=fp(),l="Expected a function";function c(y,w,P){var a=!0,R=!0;if(typeof y!="function")throw new TypeError(l);return n(P)&&(a="leading"in P?!!P.leading:a,R="trailing"in P?!!P.trailing:R),r(y,w,{leading:a,maxWait:w,trailing:R})}return cT=c,cT}var xG=vG();const $F=Xi(xG);function uy(r){"@babel/helpers - typeof";return uy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},uy(r)}function cD(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Wv(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?cD(Object(l),!0).forEach(function(c){bG(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):cD(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function bG(r,n,l){return n=wG(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function wG(r){var n=SG(r,"string");return uy(n)=="symbol"?n:n+""}function SG(r,n){if(uy(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(uy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function TG(r,n){return IG(r)||PG(r,n)||AG(r,n)||EG()}function EG(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AG(r,n){if(r){if(typeof r=="string")return hD(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return hD(r,n)}}function hD(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function PG(r,n){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var c,y,w,P,a=[],R=!0,z=!1;try{if(w=(l=l.call(r)).next,n!==0)for(;!(R=(c=w.call(l)).done)&&(a.push(c.value),a.length!==n);R=!0);}catch($){z=!0,y=$}finally{try{if(!R&&l.return!=null&&(P=l.return(),Object(P)!==P))return}finally{if(z)throw y}}return a}}function IG(r){if(Array.isArray(r))return r}var r2=ir.forwardRef(function(r,n){var l=r.aspect,c=r.initialDimension,y=c===void 0?{width:-1,height:-1}:c,w=r.width,P=w===void 0?"100%":w,a=r.height,R=a===void 0?"100%":a,z=r.minWidth,$=z===void 0?0:z,V=r.minHeight,W=r.maxHeight,ie=r.children,ae=r.debounce,ee=ae===void 0?0:ae,ne=r.id,de=r.className,xe=r.onResize,be=r.style,ke=be===void 0?{}:be,he=ir.useRef(null),_e=ir.useRef();_e.current=xe,ir.useImperativeHandle(n,function(){return Object.defineProperty(he.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),he.current},configurable:!0})});var ze=ir.useState({containerWidth:y.width,containerHeight:y.height}),Ne=TG(ze,2),rt=Ne[0],kt=Ne[1],He=ir.useCallback(function(gt,Pt){kt(function(xt){var Tt=Math.round(gt),Ht=Math.round(Pt);return xt.containerWidth===Tt&&xt.containerHeight===Ht?xt:{containerWidth:Tt,containerHeight:Ht}})},[]);ir.useEffect(function(){var gt=function(Wt){var Zt,$e=Wt[0].contentRect,pt=$e.width,fr=$e.height;He(pt,fr),(Zt=_e.current)===null||Zt===void 0||Zt.call(_e,pt,fr)};ee>0&&(gt=$F(gt,ee,{trailing:!0,leading:!1}));var Pt=new ResizeObserver(gt),xt=he.current.getBoundingClientRect(),Tt=xt.width,Ht=xt.height;return He(Tt,Ht),Pt.observe(he.current),function(){Pt.disconnect()}},[He,ee]);var yt=ir.useMemo(function(){var gt=rt.containerWidth,Pt=rt.containerHeight;if(gt<0||Pt<0)return null;jc(im(P)||im(R),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,P,R),jc(!l||l>0,"The aspect(%s) must be greater than zero.",l);var xt=im(P)?gt:P,Tt=im(R)?Pt:R;l&&l>0&&(xt?Tt=xt/l:Tt&&(xt=Tt*l),W&&Tt>W&&(Tt=W)),jc(xt>0||Tt>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,xt,Tt,P,R,$,V,l);var Ht=!Array.isArray(ie)&&jf(ie.type).endsWith("Chart");return ct.Children.map(ie,function(lt){return ct.isValidElement(lt)?ir.cloneElement(lt,Wv({width:xt,height:Tt},Ht?{style:Wv({height:"100%",width:"100%",maxHeight:Tt,maxWidth:xt},lt.props.style)}:{})):lt})},[l,ie,R,W,V,$,rt,P]);return ct.createElement("div",{id:ne?"".concat(ne):void 0,className:ui("recharts-responsive-container",de),style:Wv(Wv({},ke),{},{width:P,height:R,minWidth:$,minHeight:V,maxHeight:W}),ref:he},yt)}),qy=function(n){return null};qy.displayName="Cell";function cy(r){"@babel/helpers - typeof";return cy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},cy(r)}function fD(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function CE(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?fD(Object(l),!0).forEach(function(c){CG(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):fD(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function CG(r,n,l){return n=MG(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function MG(r){var n=OG(r,"string");return cy(n)=="symbol"?n:n+""}function OG(r,n){if(cy(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(cy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}var ng={widthCache:{},cacheCount:0},RG=2e3,kG={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},dD="recharts_measurement_span";function DG(r){var n=CE({},r);return Object.keys(n).forEach(function(l){n[l]||delete n[l]}),n}var Q_=function(n){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(n==null||Gg.isSsr)return{width:0,height:0};var c=DG(l),y=JSON.stringify({text:n,copyStyle:c});if(ng.widthCache[y])return ng.widthCache[y];try{var w=document.getElementById(dD);w||(w=document.createElement("span"),w.setAttribute("id",dD),w.setAttribute("aria-hidden","true"),document.body.appendChild(w));var P=CE(CE({},kG),c);Object.assign(w.style,P),w.textContent="".concat(n);var a=w.getBoundingClientRect(),R={width:a.width,height:a.height};return ng.widthCache[y]=R,++ng.cacheCount>RG&&(ng.cacheCount=0,ng.widthCache={}),R}catch{return{width:0,height:0}}},zG=function(n){return{top:n.top+window.scrollY-document.documentElement.clientTop,left:n.left+window.scrollX-document.documentElement.clientLeft}};function hy(r){"@babel/helpers - typeof";return hy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},hy(r)}function y0(r,n){return NG(r)||BG(r,n)||FG(r,n)||LG()}function LG(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FG(r,n){if(r){if(typeof r=="string")return pD(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return pD(r,n)}}function pD(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function BG(r,n){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var c,y,w,P,a=[],R=!0,z=!1;try{if(w=(l=l.call(r)).next,n===0){if(Object(l)!==l)return;R=!1}else for(;!(R=(c=w.call(l)).done)&&(a.push(c.value),a.length!==n);R=!0);}catch($){z=!0,y=$}finally{try{if(!R&&l.return!=null&&(P=l.return(),Object(P)!==P))return}finally{if(z)throw y}}return a}}function NG(r){if(Array.isArray(r))return r}function jG(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function mD(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,VG(c.key),c)}}function UG(r,n,l){return n&&mD(r.prototype,n),l&&mD(r,l),Object.defineProperty(r,"prototype",{writable:!1}),r}function VG(r){var n=$G(r,"string");return hy(n)=="symbol"?n:n+""}function $G(r,n){if(hy(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(hy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var gD=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,_D=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,qG=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,GG=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,qF={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},HG=Object.keys(qF),ag="NaN";function WG(r,n){return r*qF[n]}var Zv=(function(){function r(n,l){jG(this,r),this.num=n,this.unit=l,this.num=n,this.unit=l,Number.isNaN(n)&&(this.unit=""),l!==""&&!qG.test(l)&&(this.num=NaN,this.unit=""),HG.includes(l)&&(this.num=WG(n,l),this.unit="px")}return UG(r,[{key:"add",value:function(l){return this.unit!==l.unit?new r(NaN,""):new r(this.num+l.num,this.unit)}},{key:"subtract",value:function(l){return this.unit!==l.unit?new r(NaN,""):new r(this.num-l.num,this.unit)}},{key:"multiply",value:function(l){return this.unit!==""&&l.unit!==""&&this.unit!==l.unit?new r(NaN,""):new r(this.num*l.num,this.unit||l.unit)}},{key:"divide",value:function(l){return this.unit!==""&&l.unit!==""&&this.unit!==l.unit?new r(NaN,""):new r(this.num/l.num,this.unit||l.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(l){var c,y=(c=GG.exec(l))!==null&&c!==void 0?c:[],w=y0(y,3),P=w[1],a=w[2];return new r(parseFloat(P),a??"")}}])})();function GF(r){if(r.includes(ag))return ag;for(var n=r;n.includes("*")||n.includes("/");){var l,c=(l=gD.exec(n))!==null&&l!==void 0?l:[],y=y0(c,4),w=y[1],P=y[2],a=y[3],R=Zv.parse(w??""),z=Zv.parse(a??""),$=P==="*"?R.multiply(z):R.divide(z);if($.isNaN())return ag;n=n.replace(gD,$.toString())}for(;n.includes("+")||/.-\d+(?:\.\d+)?/.test(n);){var V,W=(V=_D.exec(n))!==null&&V!==void 0?V:[],ie=y0(W,4),ae=ie[1],ee=ie[2],ne=ie[3],de=Zv.parse(ae??""),xe=Zv.parse(ne??""),be=ee==="+"?de.add(xe):de.subtract(xe);if(be.isNaN())return ag;n=n.replace(_D,be.toString())}return n}var yD=/\(([^()]*)\)/;function ZG(r){for(var n=r;n.includes("(");){var l=yD.exec(n),c=y0(l,2),y=c[1];n=n.replace(yD,GF(y))}return n}function XG(r){var n=r.replace(/\s+/g,"");return n=ZG(n),n=GF(n),n}function KG(r){try{return XG(r)}catch{return ag}}function hT(r){var n=KG(r.slice(5,-1));return n===ag?"":n}var YG=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],JG=["dx","dy","angle","className","breakAll"];function ME(){return ME=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},ME.apply(this,arguments)}function vD(r,n){if(r==null)return{};var l=QG(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function QG(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}function xD(r,n){return nH(r)||rH(r,n)||tH(r,n)||eH()}function eH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tH(r,n){if(r){if(typeof r=="string")return bD(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return bD(r,n)}}function bD(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function rH(r,n){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var c,y,w,P,a=[],R=!0,z=!1;try{if(w=(l=l.call(r)).next,n===0){if(Object(l)!==l)return;R=!1}else for(;!(R=(c=w.call(l)).done)&&(a.push(c.value),a.length!==n);R=!0);}catch($){z=!0,y=$}finally{try{if(!R&&l.return!=null&&(P=l.return(),Object(P)!==P))return}finally{if(z)throw y}}return a}}function nH(r){if(Array.isArray(r))return r}var HF=/[ \f\n\r\t\v\u2028\u2029]+/,WF=function(n){var l=n.children,c=n.breakAll,y=n.style;try{var w=[];xi(l)||(c?w=l.toString().split(""):w=l.toString().split(HF));var P=w.map(function(R){return{word:R,width:Q_(R,y).width}}),a=c?0:Q_(" ",y).width;return{wordsWithComputedWidth:P,spaceWidth:a}}catch{return null}},iH=function(n,l,c,y,w){var P=n.maxLines,a=n.children,R=n.style,z=n.breakAll,$=Rr(P),V=a,W=function(){var xt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return xt.reduce(function(Tt,Ht){var lt=Ht.word,Wt=Ht.width,Zt=Tt[Tt.length-1];if(Zt&&(y==null||w||Zt.width+Wt+c<Number(y)))Zt.words.push(lt),Zt.width+=Wt+c;else{var $e={words:[lt],width:Wt};Tt.push($e)}return Tt},[])},ie=W(l),ae=function(xt){return xt.reduce(function(Tt,Ht){return Tt.width>Ht.width?Tt:Ht})};if(!$)return ie;for(var ee="…",ne=function(xt){var Tt=V.slice(0,xt),Ht=WF({breakAll:z,style:R,children:Tt+ee}).wordsWithComputedWidth,lt=W(Ht),Wt=lt.length>P||ae(lt).width>Number(y);return[Wt,lt]},de=0,xe=V.length-1,be=0,ke;de<=xe&&be<=V.length-1;){var he=Math.floor((de+xe)/2),_e=he-1,ze=ne(_e),Ne=xD(ze,2),rt=Ne[0],kt=Ne[1],He=ne(he),yt=xD(He,1),gt=yt[0];if(!rt&&!gt&&(de=he+1),rt&&gt&&(xe=he-1),!rt&&gt){ke=kt;break}be++}return ke||ie},wD=function(n){var l=xi(n)?[]:n.toString().split(HF);return[{words:l}]},oH=function(n){var l=n.width,c=n.scaleToFit,y=n.children,w=n.style,P=n.breakAll,a=n.maxLines;if((l||c)&&!Gg.isSsr){var R,z,$=WF({breakAll:P,children:y,style:w});if($){var V=$.wordsWithComputedWidth,W=$.spaceWidth;R=V,z=W}else return wD(y);return iH({breakAll:P,children:y,maxLines:a,style:w},R,z,l,c)}return wD(y)},SD="#808080",fm=function(n){var l=n.x,c=l===void 0?0:l,y=n.y,w=y===void 0?0:y,P=n.lineHeight,a=P===void 0?"1em":P,R=n.capHeight,z=R===void 0?"0.71em":R,$=n.scaleToFit,V=$===void 0?!1:$,W=n.textAnchor,ie=W===void 0?"start":W,ae=n.verticalAnchor,ee=ae===void 0?"end":ae,ne=n.fill,de=ne===void 0?SD:ne,xe=vD(n,YG),be=ir.useMemo(function(){return oH({breakAll:xe.breakAll,children:xe.children,maxLines:xe.maxLines,scaleToFit:V,style:xe.style,width:xe.width})},[xe.breakAll,xe.children,xe.maxLines,V,xe.style,xe.width]),ke=xe.dx,he=xe.dy,_e=xe.angle,ze=xe.className,Ne=xe.breakAll,rt=vD(xe,JG);if(!za(c)||!za(w))return null;var kt=c+(Rr(ke)?ke:0),He=w+(Rr(he)?he:0),yt;switch(ee){case"start":yt=hT("calc(".concat(z,")"));break;case"middle":yt=hT("calc(".concat((be.length-1)/2," * -").concat(a," + (").concat(z," / 2))"));break;default:yt=hT("calc(".concat(be.length-1," * -").concat(a,")"));break}var gt=[];if(V){var Pt=be[0].width,xt=xe.width;gt.push("scale(".concat((Rr(xt)?xt/Pt:1)/Pt,")"))}return _e&&gt.push("rotate(".concat(_e,", ").concat(kt,", ").concat(He,")")),gt.length&&(rt.transform=gt.join(" ")),ct.createElement("text",ME({},Vn(rt,!0),{x:kt,y:He,className:ui("recharts-text",ze),textAnchor:ie,fill:de.includes("url")?SD:de}),be.map(function(Tt,Ht){var lt=Tt.words.join(Ne?"":" ");return ct.createElement("tspan",{x:kt,dy:Ht===0?yt:a,key:"".concat(lt,"-").concat(Ht)},lt)}))};function cp(r,n){return r==null||n==null?NaN:r<n?-1:r>n?1:r>=n?0:NaN}function aH(r,n){return r==null||n==null?NaN:n<r?-1:n>r?1:n>=r?0:NaN}function n2(r){let n,l,c;r.length!==2?(n=cp,l=(a,R)=>cp(r(a),R),c=(a,R)=>r(a)-R):(n=r===cp||r===aH?r:sH,l=r,c=r);function y(a,R,z=0,$=a.length){if(z<$){if(n(R,R)!==0)return $;do{const V=z+$>>>1;l(a[V],R)<0?z=V+1:$=V}while(z<$)}return z}function w(a,R,z=0,$=a.length){if(z<$){if(n(R,R)!==0)return $;do{const V=z+$>>>1;l(a[V],R)<=0?z=V+1:$=V}while(z<$)}return z}function P(a,R,z=0,$=a.length){const V=y(a,R,z,$-1);return V>z&&c(a[V-1],R)>-c(a[V],R)?V-1:V}return{left:y,center:P,right:w}}function sH(){return 0}function ZF(r){return r===null?NaN:+r}function*lH(r,n){for(let l of r)l!=null&&(l=+l)>=l&&(yield l)}const uH=n2(cp),Gy=uH.right;n2(ZF).center;class TD extends Map{constructor(n,l=fH){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:l}}),n!=null)for(const[c,y]of n)this.set(c,y)}get(n){return super.get(ED(this,n))}has(n){return super.has(ED(this,n))}set(n,l){return super.set(cH(this,n),l)}delete(n){return super.delete(hH(this,n))}}function ED({_intern:r,_key:n},l){const c=n(l);return r.has(c)?r.get(c):l}function cH({_intern:r,_key:n},l){const c=n(l);return r.has(c)?r.get(c):(r.set(c,l),l)}function hH({_intern:r,_key:n},l){const c=n(l);return r.has(c)&&(l=r.get(c),r.delete(c)),l}function fH(r){return r!==null&&typeof r=="object"?r.valueOf():r}function dH(r=cp){if(r===cp)return XF;if(typeof r!="function")throw new TypeError("compare is not a function");return(n,l)=>{const c=r(n,l);return c||c===0?c:(r(l,l)===0)-(r(n,n)===0)}}function XF(r,n){return(r==null||!(r>=r))-(n==null||!(n>=n))||(r<n?-1:r>n?1:0)}const pH=Math.sqrt(50),mH=Math.sqrt(10),gH=Math.sqrt(2);function v0(r,n,l){const c=(n-r)/Math.max(0,l),y=Math.floor(Math.log10(c)),w=c/Math.pow(10,y),P=w>=pH?10:w>=mH?5:w>=gH?2:1;let a,R,z;return y<0?(z=Math.pow(10,-y)/P,a=Math.round(r*z),R=Math.round(n*z),a/z<r&&++a,R/z>n&&--R,z=-z):(z=Math.pow(10,y)*P,a=Math.round(r/z),R=Math.round(n/z),a*z<r&&++a,R*z>n&&--R),R<a&&.5<=l&&l<2?v0(r,n,l*2):[a,R,z]}function OE(r,n,l){if(n=+n,r=+r,l=+l,!(l>0))return[];if(r===n)return[r];const c=n<r,[y,w,P]=c?v0(n,r,l):v0(r,n,l);if(!(w>=y))return[];const a=w-y+1,R=new Array(a);if(c)if(P<0)for(let z=0;z<a;++z)R[z]=(w-z)/-P;else for(let z=0;z<a;++z)R[z]=(w-z)*P;else if(P<0)for(let z=0;z<a;++z)R[z]=(y+z)/-P;else for(let z=0;z<a;++z)R[z]=(y+z)*P;return R}function RE(r,n,l){return n=+n,r=+r,l=+l,v0(r,n,l)[2]}function kE(r,n,l){n=+n,r=+r,l=+l;const c=n<r,y=c?RE(n,r,l):RE(r,n,l);return(c?-1:1)*(y<0?1/-y:y)}function AD(r,n){let l;for(const c of r)c!=null&&(l<c||l===void 0&&c>=c)&&(l=c);return l}function PD(r,n){let l;for(const c of r)c!=null&&(l>c||l===void 0&&c>=c)&&(l=c);return l}function KF(r,n,l=0,c=1/0,y){if(n=Math.floor(n),l=Math.floor(Math.max(0,l)),c=Math.floor(Math.min(r.length-1,c)),!(l<=n&&n<=c))return r;for(y=y===void 0?XF:dH(y);c>l;){if(c-l>600){const R=c-l+1,z=n-l+1,$=Math.log(R),V=.5*Math.exp(2*$/3),W=.5*Math.sqrt($*V*(R-V)/R)*(z-R/2<0?-1:1),ie=Math.max(l,Math.floor(n-z*V/R+W)),ae=Math.min(c,Math.floor(n+(R-z)*V/R+W));KF(r,n,ie,ae,y)}const w=r[n];let P=l,a=c;for(V_(r,l,n),y(r[c],w)>0&&V_(r,l,c);P<a;){for(V_(r,P,a),++P,--a;y(r[P],w)<0;)++P;for(;y(r[a],w)>0;)--a}y(r[l],w)===0?V_(r,l,a):(++a,V_(r,a,c)),a<=n&&(l=a+1),n<=a&&(c=a-1)}return r}function V_(r,n,l){const c=r[n];r[n]=r[l],r[l]=c}function _H(r,n,l){if(r=Float64Array.from(lH(r)),!(!(c=r.length)||isNaN(n=+n))){if(n<=0||c<2)return PD(r);if(n>=1)return AD(r);var c,y=(c-1)*n,w=Math.floor(y),P=AD(KF(r,w).subarray(0,w+1)),a=PD(r.subarray(w+1));return P+(a-P)*(y-w)}}function yH(r,n,l=ZF){if(!(!(c=r.length)||isNaN(n=+n))){if(n<=0||c<2)return+l(r[0],0,r);if(n>=1)return+l(r[c-1],c-1,r);var c,y=(c-1)*n,w=Math.floor(y),P=+l(r[w],w,r),a=+l(r[w+1],w+1,r);return P+(a-P)*(y-w)}}function vH(r,n,l){r=+r,n=+n,l=(y=arguments.length)<2?(n=r,r=0,1):y<3?1:+l;for(var c=-1,y=Math.max(0,Math.ceil((n-r)/l))|0,w=new Array(y);++c<y;)w[c]=r+c*l;return w}function qu(r,n){switch(arguments.length){case 0:break;case 1:this.range(r);break;default:this.range(n).domain(r);break}return this}function Xf(r,n){switch(arguments.length){case 0:break;case 1:{typeof r=="function"?this.interpolator(r):this.range(r);break}default:{this.domain(r),typeof n=="function"?this.interpolator(n):this.range(n);break}}return this}const DE=Symbol("implicit");function i2(){var r=new TD,n=[],l=[],c=DE;function y(w){let P=r.get(w);if(P===void 0){if(c!==DE)return c;r.set(w,P=n.push(w)-1)}return l[P%l.length]}return y.domain=function(w){if(!arguments.length)return n.slice();n=[],r=new TD;for(const P of w)r.has(P)||r.set(P,n.push(P)-1);return y},y.range=function(w){return arguments.length?(l=Array.from(w),y):l.slice()},y.unknown=function(w){return arguments.length?(c=w,y):c},y.copy=function(){return i2(n,l).unknown(c)},qu.apply(y,arguments),y}function fy(){var r=i2().unknown(void 0),n=r.domain,l=r.range,c=0,y=1,w,P,a=!1,R=0,z=0,$=.5;delete r.unknown;function V(){var W=n().length,ie=y<c,ae=ie?y:c,ee=ie?c:y;w=(ee-ae)/Math.max(1,W-R+z*2),a&&(w=Math.floor(w)),ae+=(ee-ae-w*(W-R))*$,P=w*(1-R),a&&(ae=Math.round(ae),P=Math.round(P));var ne=vH(W).map(function(de){return ae+w*de});return l(ie?ne.reverse():ne)}return r.domain=function(W){return arguments.length?(n(W),V()):n()},r.range=function(W){return arguments.length?([c,y]=W,c=+c,y=+y,V()):[c,y]},r.rangeRound=function(W){return[c,y]=W,c=+c,y=+y,a=!0,V()},r.bandwidth=function(){return P},r.step=function(){return w},r.round=function(W){return arguments.length?(a=!!W,V()):a},r.padding=function(W){return arguments.length?(R=Math.min(1,z=+W),V()):R},r.paddingInner=function(W){return arguments.length?(R=Math.min(1,W),V()):R},r.paddingOuter=function(W){return arguments.length?(z=+W,V()):z},r.align=function(W){return arguments.length?($=Math.max(0,Math.min(1,W)),V()):$},r.copy=function(){return fy(n(),[c,y]).round(a).paddingInner(R).paddingOuter(z).align($)},qu.apply(V(),arguments)}function YF(r){var n=r.copy;return r.padding=r.paddingOuter,delete r.paddingInner,delete r.paddingOuter,r.copy=function(){return YF(n())},r}function ey(){return YF(fy.apply(null,arguments).paddingInner(1))}function o2(r,n,l){r.prototype=n.prototype=l,l.constructor=r}function JF(r,n){var l=Object.create(r.prototype);for(var c in n)l[c]=n[c];return l}function Hy(){}var dy=.7,x0=1/dy,dg="\\s*([+-]?\\d+)\\s*",py="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",kh="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",xH=/^#([0-9a-f]{3,8})$/,bH=new RegExp(`^rgb\\(${dg},${dg},${dg}\\)$`),wH=new RegExp(`^rgb\\(${kh},${kh},${kh}\\)$`),SH=new RegExp(`^rgba\\(${dg},${dg},${dg},${py}\\)$`),TH=new RegExp(`^rgba\\(${kh},${kh},${kh},${py}\\)$`),EH=new RegExp(`^hsl\\(${py},${kh},${kh}\\)$`),AH=new RegExp(`^hsla\\(${py},${kh},${kh},${py}\\)$`),ID={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};o2(Hy,my,{copy(r){return Object.assign(new this.constructor,this,r)},displayable(){return this.rgb().displayable()},hex:CD,formatHex:CD,formatHex8:PH,formatHsl:IH,formatRgb:MD,toString:MD});function CD(){return this.rgb().formatHex()}function PH(){return this.rgb().formatHex8()}function IH(){return QF(this).formatHsl()}function MD(){return this.rgb().formatRgb()}function my(r){var n,l;return r=(r+"").trim().toLowerCase(),(n=xH.exec(r))?(l=n[1].length,n=parseInt(n[1],16),l===6?OD(n):l===3?new xl(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):l===8?Xv(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):l===4?Xv(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=bH.exec(r))?new xl(n[1],n[2],n[3],1):(n=wH.exec(r))?new xl(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=SH.exec(r))?Xv(n[1],n[2],n[3],n[4]):(n=TH.exec(r))?Xv(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=EH.exec(r))?DD(n[1],n[2]/100,n[3]/100,1):(n=AH.exec(r))?DD(n[1],n[2]/100,n[3]/100,n[4]):ID.hasOwnProperty(r)?OD(ID[r]):r==="transparent"?new xl(NaN,NaN,NaN,0):null}function OD(r){return new xl(r>>16&255,r>>8&255,r&255,1)}function Xv(r,n,l,c){return c<=0&&(r=n=l=NaN),new xl(r,n,l,c)}function CH(r){return r instanceof Hy||(r=my(r)),r?(r=r.rgb(),new xl(r.r,r.g,r.b,r.opacity)):new xl}function zE(r,n,l,c){return arguments.length===1?CH(r):new xl(r,n,l,c??1)}function xl(r,n,l,c){this.r=+r,this.g=+n,this.b=+l,this.opacity=+c}o2(xl,zE,JF(Hy,{brighter(r){return r=r==null?x0:Math.pow(x0,r),new xl(this.r*r,this.g*r,this.b*r,this.opacity)},darker(r){return r=r==null?dy:Math.pow(dy,r),new xl(this.r*r,this.g*r,this.b*r,this.opacity)},rgb(){return this},clamp(){return new xl(lm(this.r),lm(this.g),lm(this.b),b0(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:RD,formatHex:RD,formatHex8:MH,formatRgb:kD,toString:kD}));function RD(){return`#${om(this.r)}${om(this.g)}${om(this.b)}`}function MH(){return`#${om(this.r)}${om(this.g)}${om(this.b)}${om((isNaN(this.opacity)?1:this.opacity)*255)}`}function kD(){const r=b0(this.opacity);return`${r===1?"rgb(":"rgba("}${lm(this.r)}, ${lm(this.g)}, ${lm(this.b)}${r===1?")":`, ${r})`}`}function b0(r){return isNaN(r)?1:Math.max(0,Math.min(1,r))}function lm(r){return Math.max(0,Math.min(255,Math.round(r)||0))}function om(r){return r=lm(r),(r<16?"0":"")+r.toString(16)}function DD(r,n,l,c){return c<=0?r=n=l=NaN:l<=0||l>=1?r=n=NaN:n<=0&&(r=NaN),new Nc(r,n,l,c)}function QF(r){if(r instanceof Nc)return new Nc(r.h,r.s,r.l,r.opacity);if(r instanceof Hy||(r=my(r)),!r)return new Nc;if(r instanceof Nc)return r;r=r.rgb();var n=r.r/255,l=r.g/255,c=r.b/255,y=Math.min(n,l,c),w=Math.max(n,l,c),P=NaN,a=w-y,R=(w+y)/2;return a?(n===w?P=(l-c)/a+(l<c)*6:l===w?P=(c-n)/a+2:P=(n-l)/a+4,a/=R<.5?w+y:2-w-y,P*=60):a=R>0&&R<1?0:P,new Nc(P,a,R,r.opacity)}function OH(r,n,l,c){return arguments.length===1?QF(r):new Nc(r,n,l,c??1)}function Nc(r,n,l,c){this.h=+r,this.s=+n,this.l=+l,this.opacity=+c}o2(Nc,OH,JF(Hy,{brighter(r){return r=r==null?x0:Math.pow(x0,r),new Nc(this.h,this.s,this.l*r,this.opacity)},darker(r){return r=r==null?dy:Math.pow(dy,r),new Nc(this.h,this.s,this.l*r,this.opacity)},rgb(){var r=this.h%360+(this.h<0)*360,n=isNaN(r)||isNaN(this.s)?0:this.s,l=this.l,c=l+(l<.5?l:1-l)*n,y=2*l-c;return new xl(fT(r>=240?r-240:r+120,y,c),fT(r,y,c),fT(r<120?r+240:r-120,y,c),this.opacity)},clamp(){return new Nc(zD(this.h),Kv(this.s),Kv(this.l),b0(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const r=b0(this.opacity);return`${r===1?"hsl(":"hsla("}${zD(this.h)}, ${Kv(this.s)*100}%, ${Kv(this.l)*100}%${r===1?")":`, ${r})`}`}}));function zD(r){return r=(r||0)%360,r<0?r+360:r}function Kv(r){return Math.max(0,Math.min(1,r||0))}function fT(r,n,l){return(r<60?n+(l-n)*r/60:r<180?l:r<240?n+(l-n)*(240-r)/60:n)*255}const a2=r=>()=>r;function RH(r,n){return function(l){return r+l*n}}function kH(r,n,l){return r=Math.pow(r,l),n=Math.pow(n,l)-r,l=1/l,function(c){return Math.pow(r+c*n,l)}}function DH(r){return(r=+r)==1?eB:function(n,l){return l-n?kH(n,l,r):a2(isNaN(n)?l:n)}}function eB(r,n){var l=n-r;return l?RH(r,l):a2(isNaN(r)?n:r)}const LD=(function r(n){var l=DH(n);function c(y,w){var P=l((y=zE(y)).r,(w=zE(w)).r),a=l(y.g,w.g),R=l(y.b,w.b),z=eB(y.opacity,w.opacity);return function($){return y.r=P($),y.g=a($),y.b=R($),y.opacity=z($),y+""}}return c.gamma=r,c})(1);function zH(r,n){n||(n=[]);var l=r?Math.min(n.length,r.length):0,c=n.slice(),y;return function(w){for(y=0;y<l;++y)c[y]=r[y]*(1-w)+n[y]*w;return c}}function LH(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function FH(r,n){var l=n?n.length:0,c=r?Math.min(l,r.length):0,y=new Array(c),w=new Array(l),P;for(P=0;P<c;++P)y[P]=Hg(r[P],n[P]);for(;P<l;++P)w[P]=n[P];return function(a){for(P=0;P<c;++P)w[P]=y[P](a);return w}}function BH(r,n){var l=new Date;return r=+r,n=+n,function(c){return l.setTime(r*(1-c)+n*c),l}}function w0(r,n){return r=+r,n=+n,function(l){return r*(1-l)+n*l}}function NH(r,n){var l={},c={},y;(r===null||typeof r!="object")&&(r={}),(n===null||typeof n!="object")&&(n={});for(y in n)y in r?l[y]=Hg(r[y],n[y]):c[y]=n[y];return function(w){for(y in l)c[y]=l[y](w);return c}}var LE=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,dT=new RegExp(LE.source,"g");function jH(r){return function(){return r}}function UH(r){return function(n){return r(n)+""}}function VH(r,n){var l=LE.lastIndex=dT.lastIndex=0,c,y,w,P=-1,a=[],R=[];for(r=r+"",n=n+"";(c=LE.exec(r))&&(y=dT.exec(n));)(w=y.index)>l&&(w=n.slice(l,w),a[P]?a[P]+=w:a[++P]=w),(c=c[0])===(y=y[0])?a[P]?a[P]+=y:a[++P]=y:(a[++P]=null,R.push({i:P,x:w0(c,y)})),l=dT.lastIndex;return l<n.length&&(w=n.slice(l),a[P]?a[P]+=w:a[++P]=w),a.length<2?R[0]?UH(R[0].x):jH(n):(n=R.length,function(z){for(var $=0,V;$<n;++$)a[(V=R[$]).i]=V.x(z);return a.join("")})}function Hg(r,n){var l=typeof n,c;return n==null||l==="boolean"?a2(n):(l==="number"?w0:l==="string"?(c=my(n))?(n=c,LD):VH:n instanceof my?LD:n instanceof Date?BH:LH(n)?zH:Array.isArray(n)?FH:typeof n.valueOf!="function"&&typeof n.toString!="function"||isNaN(n)?NH:w0)(r,n)}function s2(r,n){return r=+r,n=+n,function(l){return Math.round(r*(1-l)+n*l)}}function $H(r,n){n===void 0&&(n=r,r=Hg);for(var l=0,c=n.length-1,y=n[0],w=new Array(c<0?0:c);l<c;)w[l]=r(y,y=n[++l]);return function(P){var a=Math.max(0,Math.min(c-1,Math.floor(P*=c)));return w[a](P-a)}}function qH(r){return function(){return r}}function S0(r){return+r}var FD=[0,1];function Ys(r){return r}function FE(r,n){return(n-=r=+r)?function(l){return(l-r)/n}:qH(isNaN(n)?NaN:.5)}function GH(r,n){var l;return r>n&&(l=r,r=n,n=l),function(c){return Math.max(r,Math.min(n,c))}}function HH(r,n,l){var c=r[0],y=r[1],w=n[0],P=n[1];return y<c?(c=FE(y,c),w=l(P,w)):(c=FE(c,y),w=l(w,P)),function(a){return w(c(a))}}function WH(r,n,l){var c=Math.min(r.length,n.length)-1,y=new Array(c),w=new Array(c),P=-1;for(r[c]<r[0]&&(r=r.slice().reverse(),n=n.slice().reverse());++P<c;)y[P]=FE(r[P],r[P+1]),w[P]=l(n[P],n[P+1]);return function(a){var R=Gy(r,a,1,c)-1;return w[R](y[R](a))}}function Wy(r,n){return n.domain(r.domain()).range(r.range()).interpolate(r.interpolate()).clamp(r.clamp()).unknown(r.unknown())}function mx(){var r=FD,n=FD,l=Hg,c,y,w,P=Ys,a,R,z;function $(){var W=Math.min(r.length,n.length);return P!==Ys&&(P=GH(r[0],r[W-1])),a=W>2?WH:HH,R=z=null,V}function V(W){return W==null||isNaN(W=+W)?w:(R||(R=a(r.map(c),n,l)))(c(P(W)))}return V.invert=function(W){return P(y((z||(z=a(n,r.map(c),w0)))(W)))},V.domain=function(W){return arguments.length?(r=Array.from(W,S0),$()):r.slice()},V.range=function(W){return arguments.length?(n=Array.from(W),$()):n.slice()},V.rangeRound=function(W){return n=Array.from(W),l=s2,$()},V.clamp=function(W){return arguments.length?(P=W?!0:Ys,$()):P!==Ys},V.interpolate=function(W){return arguments.length?(l=W,$()):l},V.unknown=function(W){return arguments.length?(w=W,V):w},function(W,ie){return c=W,y=ie,$()}}function l2(){return mx()(Ys,Ys)}function ZH(r){return Math.abs(r=Math.round(r))>=1e21?r.toLocaleString("en").replace(/,/g,""):r.toString(10)}function T0(r,n){if((l=(r=n?r.toExponential(n-1):r.toExponential()).indexOf("e"))<0)return null;var l,c=r.slice(0,l);return[c.length>1?c[0]+c.slice(2):c,+r.slice(l+1)]}function bg(r){return r=T0(Math.abs(r)),r?r[1]:NaN}function XH(r,n){return function(l,c){for(var y=l.length,w=[],P=0,a=r[0],R=0;y>0&&a>0&&(R+a+1>c&&(a=Math.max(1,c-R)),w.push(l.substring(y-=a,y+a)),!((R+=a+1)>c));)a=r[P=(P+1)%r.length];return w.reverse().join(n)}}function KH(r){return function(n){return n.replace(/[0-9]/g,function(l){return r[+l]})}}var YH=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function gy(r){if(!(n=YH.exec(r)))throw new Error("invalid format: "+r);var n;return new u2({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}gy.prototype=u2.prototype;function u2(r){this.fill=r.fill===void 0?" ":r.fill+"",this.align=r.align===void 0?">":r.align+"",this.sign=r.sign===void 0?"-":r.sign+"",this.symbol=r.symbol===void 0?"":r.symbol+"",this.zero=!!r.zero,this.width=r.width===void 0?void 0:+r.width,this.comma=!!r.comma,this.precision=r.precision===void 0?void 0:+r.precision,this.trim=!!r.trim,this.type=r.type===void 0?"":r.type+""}u2.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function JH(r){e:for(var n=r.length,l=1,c=-1,y;l<n;++l)switch(r[l]){case".":c=y=l;break;case"0":c===0&&(c=l),y=l;break;default:if(!+r[l])break e;c>0&&(c=0);break}return c>0?r.slice(0,c)+r.slice(y+1):r}var tB;function QH(r,n){var l=T0(r,n);if(!l)return r+"";var c=l[0],y=l[1],w=y-(tB=Math.max(-8,Math.min(8,Math.floor(y/3)))*3)+1,P=c.length;return w===P?c:w>P?c+new Array(w-P+1).join("0"):w>0?c.slice(0,w)+"."+c.slice(w):"0."+new Array(1-w).join("0")+T0(r,Math.max(0,n+w-1))[0]}function BD(r,n){var l=T0(r,n);if(!l)return r+"";var c=l[0],y=l[1];return y<0?"0."+new Array(-y).join("0")+c:c.length>y+1?c.slice(0,y+1)+"."+c.slice(y+1):c+new Array(y-c.length+2).join("0")}const ND={"%":(r,n)=>(r*100).toFixed(n),b:r=>Math.round(r).toString(2),c:r=>r+"",d:ZH,e:(r,n)=>r.toExponential(n),f:(r,n)=>r.toFixed(n),g:(r,n)=>r.toPrecision(n),o:r=>Math.round(r).toString(8),p:(r,n)=>BD(r*100,n),r:BD,s:QH,X:r=>Math.round(r).toString(16).toUpperCase(),x:r=>Math.round(r).toString(16)};function jD(r){return r}var UD=Array.prototype.map,VD=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function eW(r){var n=r.grouping===void 0||r.thousands===void 0?jD:XH(UD.call(r.grouping,Number),r.thousands+""),l=r.currency===void 0?"":r.currency[0]+"",c=r.currency===void 0?"":r.currency[1]+"",y=r.decimal===void 0?".":r.decimal+"",w=r.numerals===void 0?jD:KH(UD.call(r.numerals,String)),P=r.percent===void 0?"%":r.percent+"",a=r.minus===void 0?"−":r.minus+"",R=r.nan===void 0?"NaN":r.nan+"";function z(V){V=gy(V);var W=V.fill,ie=V.align,ae=V.sign,ee=V.symbol,ne=V.zero,de=V.width,xe=V.comma,be=V.precision,ke=V.trim,he=V.type;he==="n"?(xe=!0,he="g"):ND[he]||(be===void 0&&(be=12),ke=!0,he="g"),(ne||W==="0"&&ie==="=")&&(ne=!0,W="0",ie="=");var _e=ee==="$"?l:ee==="#"&&/[boxX]/.test(he)?"0"+he.toLowerCase():"",ze=ee==="$"?c:/[%p]/.test(he)?P:"",Ne=ND[he],rt=/[defgprs%]/.test(he);be=be===void 0?6:/[gprs]/.test(he)?Math.max(1,Math.min(21,be)):Math.max(0,Math.min(20,be));function kt(He){var yt=_e,gt=ze,Pt,xt,Tt;if(he==="c")gt=Ne(He)+gt,He="";else{He=+He;var Ht=He<0||1/He<0;if(He=isNaN(He)?R:Ne(Math.abs(He),be),ke&&(He=JH(He)),Ht&&+He==0&&ae!=="+"&&(Ht=!1),yt=(Ht?ae==="("?ae:a:ae==="-"||ae==="("?"":ae)+yt,gt=(he==="s"?VD[8+tB/3]:"")+gt+(Ht&&ae==="("?")":""),rt){for(Pt=-1,xt=He.length;++Pt<xt;)if(Tt=He.charCodeAt(Pt),48>Tt||Tt>57){gt=(Tt===46?y+He.slice(Pt+1):He.slice(Pt))+gt,He=He.slice(0,Pt);break}}}xe&&!ne&&(He=n(He,1/0));var lt=yt.length+He.length+gt.length,Wt=lt<de?new Array(de-lt+1).join(W):"";switch(xe&&ne&&(He=n(Wt+He,Wt.length?de-gt.length:1/0),Wt=""),ie){case"<":He=yt+He+gt+Wt;break;case"=":He=yt+Wt+He+gt;break;case"^":He=Wt.slice(0,lt=Wt.length>>1)+yt+He+gt+Wt.slice(lt);break;default:He=Wt+yt+He+gt;break}return w(He)}return kt.toString=function(){return V+""},kt}function $(V,W){var ie=z((V=gy(V),V.type="f",V)),ae=Math.max(-8,Math.min(8,Math.floor(bg(W)/3)))*3,ee=Math.pow(10,-ae),ne=VD[8+ae/3];return function(de){return ie(ee*de)+ne}}return{format:z,formatPrefix:$}}var Yv,c2,rB;tW({thousands:",",grouping:[3],currency:["$",""]});function tW(r){return Yv=eW(r),c2=Yv.format,rB=Yv.formatPrefix,Yv}function rW(r){return Math.max(0,-bg(Math.abs(r)))}function nW(r,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(bg(n)/3)))*3-bg(Math.abs(r)))}function iW(r,n){return r=Math.abs(r),n=Math.abs(n)-r,Math.max(0,bg(n)-bg(r))+1}function nB(r,n,l,c){var y=kE(r,n,l),w;switch(c=gy(c??",f"),c.type){case"s":{var P=Math.max(Math.abs(r),Math.abs(n));return c.precision==null&&!isNaN(w=nW(y,P))&&(c.precision=w),rB(c,P)}case"":case"e":case"g":case"p":case"r":{c.precision==null&&!isNaN(w=iW(y,Math.max(Math.abs(r),Math.abs(n))))&&(c.precision=w-(c.type==="e"));break}case"f":case"%":{c.precision==null&&!isNaN(w=rW(y))&&(c.precision=w-(c.type==="%")*2);break}}return c2(c)}function dp(r){var n=r.domain;return r.ticks=function(l){var c=n();return OE(c[0],c[c.length-1],l??10)},r.tickFormat=function(l,c){var y=n();return nB(y[0],y[y.length-1],l??10,c)},r.nice=function(l){l==null&&(l=10);var c=n(),y=0,w=c.length-1,P=c[y],a=c[w],R,z,$=10;for(a<P&&(z=P,P=a,a=z,z=y,y=w,w=z);$-- >0;){if(z=RE(P,a,l),z===R)return c[y]=P,c[w]=a,n(c);if(z>0)P=Math.floor(P/z)*z,a=Math.ceil(a/z)*z;else if(z<0)P=Math.ceil(P*z)/z,a=Math.floor(a*z)/z;else break;R=z}return r},r}function E0(){var r=l2();return r.copy=function(){return Wy(r,E0())},qu.apply(r,arguments),dp(r)}function iB(r){var n;function l(c){return c==null||isNaN(c=+c)?n:c}return l.invert=l,l.domain=l.range=function(c){return arguments.length?(r=Array.from(c,S0),l):r.slice()},l.unknown=function(c){return arguments.length?(n=c,l):n},l.copy=function(){return iB(r).unknown(n)},r=arguments.length?Array.from(r,S0):[0,1],dp(l)}function oB(r,n){r=r.slice();var l=0,c=r.length-1,y=r[l],w=r[c],P;return w<y&&(P=l,l=c,c=P,P=y,y=w,w=P),r[l]=n.floor(y),r[c]=n.ceil(w),r}function $D(r){return Math.log(r)}function qD(r){return Math.exp(r)}function oW(r){return-Math.log(-r)}function aW(r){return-Math.exp(-r)}function sW(r){return isFinite(r)?+("1e"+r):r<0?0:r}function lW(r){return r===10?sW:r===Math.E?Math.exp:n=>Math.pow(r,n)}function uW(r){return r===Math.E?Math.log:r===10&&Math.log10||r===2&&Math.log2||(r=Math.log(r),n=>Math.log(n)/r)}function GD(r){return(n,l)=>-r(-n,l)}function h2(r){const n=r($D,qD),l=n.domain;let c=10,y,w;function P(){return y=uW(c),w=lW(c),l()[0]<0?(y=GD(y),w=GD(w),r(oW,aW)):r($D,qD),n}return n.base=function(a){return arguments.length?(c=+a,P()):c},n.domain=function(a){return arguments.length?(l(a),P()):l()},n.ticks=a=>{const R=l();let z=R[0],$=R[R.length-1];const V=$<z;V&&([z,$]=[$,z]);let W=y(z),ie=y($),ae,ee;const ne=a==null?10:+a;let de=[];if(!(c%1)&&ie-W<ne){if(W=Math.floor(W),ie=Math.ceil(ie),z>0){for(;W<=ie;++W)for(ae=1;ae<c;++ae)if(ee=W<0?ae/w(-W):ae*w(W),!(ee<z)){if(ee>$)break;de.push(ee)}}else for(;W<=ie;++W)for(ae=c-1;ae>=1;--ae)if(ee=W>0?ae/w(-W):ae*w(W),!(ee<z)){if(ee>$)break;de.push(ee)}de.length*2<ne&&(de=OE(z,$,ne))}else de=OE(W,ie,Math.min(ie-W,ne)).map(w);return V?de.reverse():de},n.tickFormat=(a,R)=>{if(a==null&&(a=10),R==null&&(R=c===10?"s":","),typeof R!="function"&&(!(c%1)&&(R=gy(R)).precision==null&&(R.trim=!0),R=c2(R)),a===1/0)return R;const z=Math.max(1,c*a/n.ticks().length);return $=>{let V=$/w(Math.round(y($)));return V*c<c-.5&&(V*=c),V<=z?R($):""}},n.nice=()=>l(oB(l(),{floor:a=>w(Math.floor(y(a))),ceil:a=>w(Math.ceil(y(a)))})),n}function aB(){const r=h2(mx()).domain([1,10]);return r.copy=()=>Wy(r,aB()).base(r.base()),qu.apply(r,arguments),r}function HD(r){return function(n){return Math.sign(n)*Math.log1p(Math.abs(n/r))}}function WD(r){return function(n){return Math.sign(n)*Math.expm1(Math.abs(n))*r}}function f2(r){var n=1,l=r(HD(n),WD(n));return l.constant=function(c){return arguments.length?r(HD(n=+c),WD(n)):n},dp(l)}function sB(){var r=f2(mx());return r.copy=function(){return Wy(r,sB()).constant(r.constant())},qu.apply(r,arguments)}function ZD(r){return function(n){return n<0?-Math.pow(-n,r):Math.pow(n,r)}}function cW(r){return r<0?-Math.sqrt(-r):Math.sqrt(r)}function hW(r){return r<0?-r*r:r*r}function d2(r){var n=r(Ys,Ys),l=1;function c(){return l===1?r(Ys,Ys):l===.5?r(cW,hW):r(ZD(l),ZD(1/l))}return n.exponent=function(y){return arguments.length?(l=+y,c()):l},dp(n)}function p2(){var r=d2(mx());return r.copy=function(){return Wy(r,p2()).exponent(r.exponent())},qu.apply(r,arguments),r}function fW(){return p2.apply(null,arguments).exponent(.5)}function XD(r){return Math.sign(r)*r*r}function dW(r){return Math.sign(r)*Math.sqrt(Math.abs(r))}function lB(){var r=l2(),n=[0,1],l=!1,c;function y(w){var P=dW(r(w));return isNaN(P)?c:l?Math.round(P):P}return y.invert=function(w){return r.invert(XD(w))},y.domain=function(w){return arguments.length?(r.domain(w),y):r.domain()},y.range=function(w){return arguments.length?(r.range((n=Array.from(w,S0)).map(XD)),y):n.slice()},y.rangeRound=function(w){return y.range(w).round(!0)},y.round=function(w){return arguments.length?(l=!!w,y):l},y.clamp=function(w){return arguments.length?(r.clamp(w),y):r.clamp()},y.unknown=function(w){return arguments.length?(c=w,y):c},y.copy=function(){return lB(r.domain(),n).round(l).clamp(r.clamp()).unknown(c)},qu.apply(y,arguments),dp(y)}function uB(){var r=[],n=[],l=[],c;function y(){var P=0,a=Math.max(1,n.length);for(l=new Array(a-1);++P<a;)l[P-1]=yH(r,P/a);return w}function w(P){return P==null||isNaN(P=+P)?c:n[Gy(l,P)]}return w.invertExtent=function(P){var a=n.indexOf(P);return a<0?[NaN,NaN]:[a>0?l[a-1]:r[0],a<l.length?l[a]:r[r.length-1]]},w.domain=function(P){if(!arguments.length)return r.slice();r=[];for(let a of P)a!=null&&!isNaN(a=+a)&&r.push(a);return r.sort(cp),y()},w.range=function(P){return arguments.length?(n=Array.from(P),y()):n.slice()},w.unknown=function(P){return arguments.length?(c=P,w):c},w.quantiles=function(){return l.slice()},w.copy=function(){return uB().domain(r).range(n).unknown(c)},qu.apply(w,arguments)}function cB(){var r=0,n=1,l=1,c=[.5],y=[0,1],w;function P(R){return R!=null&&R<=R?y[Gy(c,R,0,l)]:w}function a(){var R=-1;for(c=new Array(l);++R<l;)c[R]=((R+1)*n-(R-l)*r)/(l+1);return P}return P.domain=function(R){return arguments.length?([r,n]=R,r=+r,n=+n,a()):[r,n]},P.range=function(R){return arguments.length?(l=(y=Array.from(R)).length-1,a()):y.slice()},P.invertExtent=function(R){var z=y.indexOf(R);return z<0?[NaN,NaN]:z<1?[r,c[0]]:z>=l?[c[l-1],n]:[c[z-1],c[z]]},P.unknown=function(R){return arguments.length&&(w=R),P},P.thresholds=function(){return c.slice()},P.copy=function(){return cB().domain([r,n]).range(y).unknown(w)},qu.apply(dp(P),arguments)}function hB(){var r=[.5],n=[0,1],l,c=1;function y(w){return w!=null&&w<=w?n[Gy(r,w,0,c)]:l}return y.domain=function(w){return arguments.length?(r=Array.from(w),c=Math.min(r.length,n.length-1),y):r.slice()},y.range=function(w){return arguments.length?(n=Array.from(w),c=Math.min(r.length,n.length-1),y):n.slice()},y.invertExtent=function(w){var P=n.indexOf(w);return[r[P-1],r[P]]},y.unknown=function(w){return arguments.length?(l=w,y):l},y.copy=function(){return hB().domain(r).range(n).unknown(l)},qu.apply(y,arguments)}const pT=new Date,mT=new Date;function La(r,n,l,c){function y(w){return r(w=arguments.length===0?new Date:new Date(+w)),w}return y.floor=w=>(r(w=new Date(+w)),w),y.ceil=w=>(r(w=new Date(w-1)),n(w,1),r(w),w),y.round=w=>{const P=y(w),a=y.ceil(w);return w-P<a-w?P:a},y.offset=(w,P)=>(n(w=new Date(+w),P==null?1:Math.floor(P)),w),y.range=(w,P,a)=>{const R=[];if(w=y.ceil(w),a=a==null?1:Math.floor(a),!(w<P)||!(a>0))return R;let z;do R.push(z=new Date(+w)),n(w,a),r(w);while(z<w&&w<P);return R},y.filter=w=>La(P=>{if(P>=P)for(;r(P),!w(P);)P.setTime(P-1)},(P,a)=>{if(P>=P)if(a<0)for(;++a<=0;)for(;n(P,-1),!w(P););else for(;--a>=0;)for(;n(P,1),!w(P););}),l&&(y.count=(w,P)=>(pT.setTime(+w),mT.setTime(+P),r(pT),r(mT),Math.floor(l(pT,mT))),y.every=w=>(w=Math.floor(w),!isFinite(w)||!(w>0)?null:w>1?y.filter(c?P=>c(P)%w===0:P=>y.count(0,P)%w===0):y)),y}const A0=La(()=>{},(r,n)=>{r.setTime(+r+n)},(r,n)=>n-r);A0.every=r=>(r=Math.floor(r),!isFinite(r)||!(r>0)?null:r>1?La(n=>{n.setTime(Math.floor(n/r)*r)},(n,l)=>{n.setTime(+n+l*r)},(n,l)=>(l-n)/r):A0);A0.range;const Ff=1e3,Uu=Ff*60,Bf=Uu*60,Vf=Bf*24,m2=Vf*7,KD=Vf*30,gT=Vf*365,am=La(r=>{r.setTime(r-r.getMilliseconds())},(r,n)=>{r.setTime(+r+n*Ff)},(r,n)=>(n-r)/Ff,r=>r.getUTCSeconds());am.range;const g2=La(r=>{r.setTime(r-r.getMilliseconds()-r.getSeconds()*Ff)},(r,n)=>{r.setTime(+r+n*Uu)},(r,n)=>(n-r)/Uu,r=>r.getMinutes());g2.range;const _2=La(r=>{r.setUTCSeconds(0,0)},(r,n)=>{r.setTime(+r+n*Uu)},(r,n)=>(n-r)/Uu,r=>r.getUTCMinutes());_2.range;const y2=La(r=>{r.setTime(r-r.getMilliseconds()-r.getSeconds()*Ff-r.getMinutes()*Uu)},(r,n)=>{r.setTime(+r+n*Bf)},(r,n)=>(n-r)/Bf,r=>r.getHours());y2.range;const v2=La(r=>{r.setUTCMinutes(0,0,0)},(r,n)=>{r.setTime(+r+n*Bf)},(r,n)=>(n-r)/Bf,r=>r.getUTCHours());v2.range;const Zy=La(r=>r.setHours(0,0,0,0),(r,n)=>r.setDate(r.getDate()+n),(r,n)=>(n-r-(n.getTimezoneOffset()-r.getTimezoneOffset())*Uu)/Vf,r=>r.getDate()-1);Zy.range;const gx=La(r=>{r.setUTCHours(0,0,0,0)},(r,n)=>{r.setUTCDate(r.getUTCDate()+n)},(r,n)=>(n-r)/Vf,r=>r.getUTCDate()-1);gx.range;const fB=La(r=>{r.setUTCHours(0,0,0,0)},(r,n)=>{r.setUTCDate(r.getUTCDate()+n)},(r,n)=>(n-r)/Vf,r=>Math.floor(r/Vf));fB.range;function ym(r){return La(n=>{n.setDate(n.getDate()-(n.getDay()+7-r)%7),n.setHours(0,0,0,0)},(n,l)=>{n.setDate(n.getDate()+l*7)},(n,l)=>(l-n-(l.getTimezoneOffset()-n.getTimezoneOffset())*Uu)/m2)}const _x=ym(0),P0=ym(1),pW=ym(2),mW=ym(3),wg=ym(4),gW=ym(5),_W=ym(6);_x.range;P0.range;pW.range;mW.range;wg.range;gW.range;_W.range;function vm(r){return La(n=>{n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-r)%7),n.setUTCHours(0,0,0,0)},(n,l)=>{n.setUTCDate(n.getUTCDate()+l*7)},(n,l)=>(l-n)/m2)}const yx=vm(0),I0=vm(1),yW=vm(2),vW=vm(3),Sg=vm(4),xW=vm(5),bW=vm(6);yx.range;I0.range;yW.range;vW.range;Sg.range;xW.range;bW.range;const x2=La(r=>{r.setDate(1),r.setHours(0,0,0,0)},(r,n)=>{r.setMonth(r.getMonth()+n)},(r,n)=>n.getMonth()-r.getMonth()+(n.getFullYear()-r.getFullYear())*12,r=>r.getMonth());x2.range;const b2=La(r=>{r.setUTCDate(1),r.setUTCHours(0,0,0,0)},(r,n)=>{r.setUTCMonth(r.getUTCMonth()+n)},(r,n)=>n.getUTCMonth()-r.getUTCMonth()+(n.getUTCFullYear()-r.getUTCFullYear())*12,r=>r.getUTCMonth());b2.range;const $f=La(r=>{r.setMonth(0,1),r.setHours(0,0,0,0)},(r,n)=>{r.setFullYear(r.getFullYear()+n)},(r,n)=>n.getFullYear()-r.getFullYear(),r=>r.getFullYear());$f.every=r=>!isFinite(r=Math.floor(r))||!(r>0)?null:La(n=>{n.setFullYear(Math.floor(n.getFullYear()/r)*r),n.setMonth(0,1),n.setHours(0,0,0,0)},(n,l)=>{n.setFullYear(n.getFullYear()+l*r)});$f.range;const qf=La(r=>{r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},(r,n)=>{r.setUTCFullYear(r.getUTCFullYear()+n)},(r,n)=>n.getUTCFullYear()-r.getUTCFullYear(),r=>r.getUTCFullYear());qf.every=r=>!isFinite(r=Math.floor(r))||!(r>0)?null:La(n=>{n.setUTCFullYear(Math.floor(n.getUTCFullYear()/r)*r),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},(n,l)=>{n.setUTCFullYear(n.getUTCFullYear()+l*r)});qf.range;function dB(r,n,l,c,y,w){const P=[[am,1,Ff],[am,5,5*Ff],[am,15,15*Ff],[am,30,30*Ff],[w,1,Uu],[w,5,5*Uu],[w,15,15*Uu],[w,30,30*Uu],[y,1,Bf],[y,3,3*Bf],[y,6,6*Bf],[y,12,12*Bf],[c,1,Vf],[c,2,2*Vf],[l,1,m2],[n,1,KD],[n,3,3*KD],[r,1,gT]];function a(z,$,V){const W=$<z;W&&([z,$]=[$,z]);const ie=V&&typeof V.range=="function"?V:R(z,$,V),ae=ie?ie.range(z,+$+1):[];return W?ae.reverse():ae}function R(z,$,V){const W=Math.abs($-z)/V,ie=n2(([,,ne])=>ne).right(P,W);if(ie===P.length)return r.every(kE(z/gT,$/gT,V));if(ie===0)return A0.every(Math.max(kE(z,$,V),1));const[ae,ee]=P[W/P[ie-1][2]<P[ie][2]/W?ie-1:ie];return ae.every(ee)}return[a,R]}const[wW,SW]=dB(qf,b2,yx,fB,v2,_2),[TW,EW]=dB($f,x2,_x,Zy,y2,g2);function _T(r){if(0<=r.y&&r.y<100){var n=new Date(-1,r.m,r.d,r.H,r.M,r.S,r.L);return n.setFullYear(r.y),n}return new Date(r.y,r.m,r.d,r.H,r.M,r.S,r.L)}function yT(r){if(0<=r.y&&r.y<100){var n=new Date(Date.UTC(-1,r.m,r.d,r.H,r.M,r.S,r.L));return n.setUTCFullYear(r.y),n}return new Date(Date.UTC(r.y,r.m,r.d,r.H,r.M,r.S,r.L))}function $_(r,n,l){return{y:r,m:n,d:l,H:0,M:0,S:0,L:0}}function AW(r){var n=r.dateTime,l=r.date,c=r.time,y=r.periods,w=r.days,P=r.shortDays,a=r.months,R=r.shortMonths,z=q_(y),$=G_(y),V=q_(w),W=G_(w),ie=q_(P),ae=G_(P),ee=q_(a),ne=G_(a),de=q_(R),xe=G_(R),be={a:Ht,A:lt,b:Wt,B:Zt,c:null,d:rz,e:rz,f:XW,g:o7,G:s7,H:HW,I:WW,j:ZW,L:pB,m:KW,M:YW,p:$e,q:pt,Q:oz,s:az,S:JW,u:QW,U:e7,V:t7,w:r7,W:n7,x:null,X:null,y:i7,Y:a7,Z:l7,"%":iz},ke={a:fr,A:zr,b:Hr,B:Ir,c:null,d:nz,e:nz,f:f7,g:w7,G:T7,H:u7,I:c7,j:h7,L:gB,m:d7,M:p7,p:Lr,q:Ur,Q:oz,s:az,S:m7,u:g7,U:_7,V:y7,w:v7,W:x7,x:null,X:null,y:b7,Y:S7,Z:E7,"%":iz},he={a:kt,A:He,b:yt,B:gt,c:Pt,d:ez,e:ez,f:VW,g:QD,G:JD,H:tz,I:tz,j:BW,L:UW,m:FW,M:NW,p:rt,q:LW,Q:qW,s:GW,S:jW,u:OW,U:RW,V:kW,w:MW,W:DW,x:xt,X:Tt,y:QD,Y:JD,Z:zW,"%":$W};be.x=_e(l,be),be.X=_e(c,be),be.c=_e(n,be),ke.x=_e(l,ke),ke.X=_e(c,ke),ke.c=_e(n,ke);function _e(or,Er){return function(pn){var sr=[],Pi=-1,Rn=0,In=or.length,ci,Ki,wa;for(pn instanceof Date||(pn=new Date(+pn));++Pi<In;)or.charCodeAt(Pi)===37&&(sr.push(or.slice(Rn,Pi)),(Ki=YD[ci=or.charAt(++Pi)])!=null?ci=or.charAt(++Pi):Ki=ci==="e"?" ":"0",(wa=Er[ci])&&(ci=wa(pn,Ki)),sr.push(ci),Rn=Pi+1);return sr.push(or.slice(Rn,Pi)),sr.join("")}}function ze(or,Er){return function(pn){var sr=$_(1900,void 0,1),Pi=Ne(sr,or,pn+="",0),Rn,In;if(Pi!=pn.length)return null;if("Q"in sr)return new Date(sr.Q);if("s"in sr)return new Date(sr.s*1e3+("L"in sr?sr.L:0));if(Er&&!("Z"in sr)&&(sr.Z=0),"p"in sr&&(sr.H=sr.H%12+sr.p*12),sr.m===void 0&&(sr.m="q"in sr?sr.q:0),"V"in sr){if(sr.V<1||sr.V>53)return null;"w"in sr||(sr.w=1),"Z"in sr?(Rn=yT($_(sr.y,0,1)),In=Rn.getUTCDay(),Rn=In>4||In===0?I0.ceil(Rn):I0(Rn),Rn=gx.offset(Rn,(sr.V-1)*7),sr.y=Rn.getUTCFullYear(),sr.m=Rn.getUTCMonth(),sr.d=Rn.getUTCDate()+(sr.w+6)%7):(Rn=_T($_(sr.y,0,1)),In=Rn.getDay(),Rn=In>4||In===0?P0.ceil(Rn):P0(Rn),Rn=Zy.offset(Rn,(sr.V-1)*7),sr.y=Rn.getFullYear(),sr.m=Rn.getMonth(),sr.d=Rn.getDate()+(sr.w+6)%7)}else("W"in sr||"U"in sr)&&("w"in sr||(sr.w="u"in sr?sr.u%7:"W"in sr?1:0),In="Z"in sr?yT($_(sr.y,0,1)).getUTCDay():_T($_(sr.y,0,1)).getDay(),sr.m=0,sr.d="W"in sr?(sr.w+6)%7+sr.W*7-(In+5)%7:sr.w+sr.U*7-(In+6)%7);return"Z"in sr?(sr.H+=sr.Z/100|0,sr.M+=sr.Z%100,yT(sr)):_T(sr)}}function Ne(or,Er,pn,sr){for(var Pi=0,Rn=Er.length,In=pn.length,ci,Ki;Pi<Rn;){if(sr>=In)return-1;if(ci=Er.charCodeAt(Pi++),ci===37){if(ci=Er.charAt(Pi++),Ki=he[ci in YD?Er.charAt(Pi++):ci],!Ki||(sr=Ki(or,pn,sr))<0)return-1}else if(ci!=pn.charCodeAt(sr++))return-1}return sr}function rt(or,Er,pn){var sr=z.exec(Er.slice(pn));return sr?(or.p=$.get(sr[0].toLowerCase()),pn+sr[0].length):-1}function kt(or,Er,pn){var sr=ie.exec(Er.slice(pn));return sr?(or.w=ae.get(sr[0].toLowerCase()),pn+sr[0].length):-1}function He(or,Er,pn){var sr=V.exec(Er.slice(pn));return sr?(or.w=W.get(sr[0].toLowerCase()),pn+sr[0].length):-1}function yt(or,Er,pn){var sr=de.exec(Er.slice(pn));return sr?(or.m=xe.get(sr[0].toLowerCase()),pn+sr[0].length):-1}function gt(or,Er,pn){var sr=ee.exec(Er.slice(pn));return sr?(or.m=ne.get(sr[0].toLowerCase()),pn+sr[0].length):-1}function Pt(or,Er,pn){return Ne(or,n,Er,pn)}function xt(or,Er,pn){return Ne(or,l,Er,pn)}function Tt(or,Er,pn){return Ne(or,c,Er,pn)}function Ht(or){return P[or.getDay()]}function lt(or){return w[or.getDay()]}function Wt(or){return R[or.getMonth()]}function Zt(or){return a[or.getMonth()]}function $e(or){return y[+(or.getHours()>=12)]}function pt(or){return 1+~~(or.getMonth()/3)}function fr(or){return P[or.getUTCDay()]}function zr(or){return w[or.getUTCDay()]}function Hr(or){return R[or.getUTCMonth()]}function Ir(or){return a[or.getUTCMonth()]}function Lr(or){return y[+(or.getUTCHours()>=12)]}function Ur(or){return 1+~~(or.getUTCMonth()/3)}return{format:function(or){var Er=_e(or+="",be);return Er.toString=function(){return or},Er},parse:function(or){var Er=ze(or+="",!1);return Er.toString=function(){return or},Er},utcFormat:function(or){var Er=_e(or+="",ke);return Er.toString=function(){return or},Er},utcParse:function(or){var Er=ze(or+="",!0);return Er.toString=function(){return or},Er}}}var YD={"-":"",_:" ",0:"0"},es=/^\s*\d+/,PW=/^%/,IW=/[\\^$*+?|[\]().{}]/g;function ji(r,n,l){var c=r<0?"-":"",y=(c?-r:r)+"",w=y.length;return c+(w<l?new Array(l-w+1).join(n)+y:y)}function CW(r){return r.replace(IW,"\\$&")}function q_(r){return new RegExp("^(?:"+r.map(CW).join("|")+")","i")}function G_(r){return new Map(r.map((n,l)=>[n.toLowerCase(),l]))}function MW(r,n,l){var c=es.exec(n.slice(l,l+1));return c?(r.w=+c[0],l+c[0].length):-1}function OW(r,n,l){var c=es.exec(n.slice(l,l+1));return c?(r.u=+c[0],l+c[0].length):-1}function RW(r,n,l){var c=es.exec(n.slice(l,l+2));return c?(r.U=+c[0],l+c[0].length):-1}function kW(r,n,l){var c=es.exec(n.slice(l,l+2));return c?(r.V=+c[0],l+c[0].length):-1}function DW(r,n,l){var c=es.exec(n.slice(l,l+2));return c?(r.W=+c[0],l+c[0].length):-1}function JD(r,n,l){var c=es.exec(n.slice(l,l+4));return c?(r.y=+c[0],l+c[0].length):-1}function QD(r,n,l){var c=es.exec(n.slice(l,l+2));return c?(r.y=+c[0]+(+c[0]>68?1900:2e3),l+c[0].length):-1}function zW(r,n,l){var c=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(l,l+6));return c?(r.Z=c[1]?0:-(c[2]+(c[3]||"00")),l+c[0].length):-1}function LW(r,n,l){var c=es.exec(n.slice(l,l+1));return c?(r.q=c[0]*3-3,l+c[0].length):-1}function FW(r,n,l){var c=es.exec(n.slice(l,l+2));return c?(r.m=c[0]-1,l+c[0].length):-1}function ez(r,n,l){var c=es.exec(n.slice(l,l+2));return c?(r.d=+c[0],l+c[0].length):-1}function BW(r,n,l){var c=es.exec(n.slice(l,l+3));return c?(r.m=0,r.d=+c[0],l+c[0].length):-1}function tz(r,n,l){var c=es.exec(n.slice(l,l+2));return c?(r.H=+c[0],l+c[0].length):-1}function NW(r,n,l){var c=es.exec(n.slice(l,l+2));return c?(r.M=+c[0],l+c[0].length):-1}function jW(r,n,l){var c=es.exec(n.slice(l,l+2));return c?(r.S=+c[0],l+c[0].length):-1}function UW(r,n,l){var c=es.exec(n.slice(l,l+3));return c?(r.L=+c[0],l+c[0].length):-1}function VW(r,n,l){var c=es.exec(n.slice(l,l+6));return c?(r.L=Math.floor(c[0]/1e3),l+c[0].length):-1}function $W(r,n,l){var c=PW.exec(n.slice(l,l+1));return c?l+c[0].length:-1}function qW(r,n,l){var c=es.exec(n.slice(l));return c?(r.Q=+c[0],l+c[0].length):-1}function GW(r,n,l){var c=es.exec(n.slice(l));return c?(r.s=+c[0],l+c[0].length):-1}function rz(r,n){return ji(r.getDate(),n,2)}function HW(r,n){return ji(r.getHours(),n,2)}function WW(r,n){return ji(r.getHours()%12||12,n,2)}function ZW(r,n){return ji(1+Zy.count($f(r),r),n,3)}function pB(r,n){return ji(r.getMilliseconds(),n,3)}function XW(r,n){return pB(r,n)+"000"}function KW(r,n){return ji(r.getMonth()+1,n,2)}function YW(r,n){return ji(r.getMinutes(),n,2)}function JW(r,n){return ji(r.getSeconds(),n,2)}function QW(r){var n=r.getDay();return n===0?7:n}function e7(r,n){return ji(_x.count($f(r)-1,r),n,2)}function mB(r){var n=r.getDay();return n>=4||n===0?wg(r):wg.ceil(r)}function t7(r,n){return r=mB(r),ji(wg.count($f(r),r)+($f(r).getDay()===4),n,2)}function r7(r){return r.getDay()}function n7(r,n){return ji(P0.count($f(r)-1,r),n,2)}function i7(r,n){return ji(r.getFullYear()%100,n,2)}function o7(r,n){return r=mB(r),ji(r.getFullYear()%100,n,2)}function a7(r,n){return ji(r.getFullYear()%1e4,n,4)}function s7(r,n){var l=r.getDay();return r=l>=4||l===0?wg(r):wg.ceil(r),ji(r.getFullYear()%1e4,n,4)}function l7(r){var n=r.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+ji(n/60|0,"0",2)+ji(n%60,"0",2)}function nz(r,n){return ji(r.getUTCDate(),n,2)}function u7(r,n){return ji(r.getUTCHours(),n,2)}function c7(r,n){return ji(r.getUTCHours()%12||12,n,2)}function h7(r,n){return ji(1+gx.count(qf(r),r),n,3)}function gB(r,n){return ji(r.getUTCMilliseconds(),n,3)}function f7(r,n){return gB(r,n)+"000"}function d7(r,n){return ji(r.getUTCMonth()+1,n,2)}function p7(r,n){return ji(r.getUTCMinutes(),n,2)}function m7(r,n){return ji(r.getUTCSeconds(),n,2)}function g7(r){var n=r.getUTCDay();return n===0?7:n}function _7(r,n){return ji(yx.count(qf(r)-1,r),n,2)}function _B(r){var n=r.getUTCDay();return n>=4||n===0?Sg(r):Sg.ceil(r)}function y7(r,n){return r=_B(r),ji(Sg.count(qf(r),r)+(qf(r).getUTCDay()===4),n,2)}function v7(r){return r.getUTCDay()}function x7(r,n){return ji(I0.count(qf(r)-1,r),n,2)}function b7(r,n){return ji(r.getUTCFullYear()%100,n,2)}function w7(r,n){return r=_B(r),ji(r.getUTCFullYear()%100,n,2)}function S7(r,n){return ji(r.getUTCFullYear()%1e4,n,4)}function T7(r,n){var l=r.getUTCDay();return r=l>=4||l===0?Sg(r):Sg.ceil(r),ji(r.getUTCFullYear()%1e4,n,4)}function E7(){return"+0000"}function iz(){return"%"}function oz(r){return+r}function az(r){return Math.floor(+r/1e3)}var ig,yB,vB;A7({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function A7(r){return ig=AW(r),yB=ig.format,ig.parse,vB=ig.utcFormat,ig.utcParse,ig}function P7(r){return new Date(r)}function I7(r){return r instanceof Date?+r:+new Date(+r)}function w2(r,n,l,c,y,w,P,a,R,z){var $=l2(),V=$.invert,W=$.domain,ie=z(".%L"),ae=z(":%S"),ee=z("%I:%M"),ne=z("%I %p"),de=z("%a %d"),xe=z("%b %d"),be=z("%B"),ke=z("%Y");function he(_e){return(R(_e)<_e?ie:a(_e)<_e?ae:P(_e)<_e?ee:w(_e)<_e?ne:c(_e)<_e?y(_e)<_e?de:xe:l(_e)<_e?be:ke)(_e)}return $.invert=function(_e){return new Date(V(_e))},$.domain=function(_e){return arguments.length?W(Array.from(_e,I7)):W().map(P7)},$.ticks=function(_e){var ze=W();return r(ze[0],ze[ze.length-1],_e??10)},$.tickFormat=function(_e,ze){return ze==null?he:z(ze)},$.nice=function(_e){var ze=W();return(!_e||typeof _e.range!="function")&&(_e=n(ze[0],ze[ze.length-1],_e??10)),_e?W(oB(ze,_e)):$},$.copy=function(){return Wy($,w2(r,n,l,c,y,w,P,a,R,z))},$}function C7(){return qu.apply(w2(TW,EW,$f,x2,_x,Zy,y2,g2,am,yB).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function M7(){return qu.apply(w2(wW,SW,qf,b2,yx,gx,v2,_2,am,vB).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function vx(){var r=0,n=1,l,c,y,w,P=Ys,a=!1,R;function z(V){return V==null||isNaN(V=+V)?R:P(y===0?.5:(V=(w(V)-l)*y,a?Math.max(0,Math.min(1,V)):V))}z.domain=function(V){return arguments.length?([r,n]=V,l=w(r=+r),c=w(n=+n),y=l===c?0:1/(c-l),z):[r,n]},z.clamp=function(V){return arguments.length?(a=!!V,z):a},z.interpolator=function(V){return arguments.length?(P=V,z):P};function $(V){return function(W){var ie,ae;return arguments.length?([ie,ae]=W,P=V(ie,ae),z):[P(0),P(1)]}}return z.range=$(Hg),z.rangeRound=$(s2),z.unknown=function(V){return arguments.length?(R=V,z):R},function(V){return w=V,l=V(r),c=V(n),y=l===c?0:1/(c-l),z}}function pp(r,n){return n.domain(r.domain()).interpolator(r.interpolator()).clamp(r.clamp()).unknown(r.unknown())}function xB(){var r=dp(vx()(Ys));return r.copy=function(){return pp(r,xB())},Xf.apply(r,arguments)}function bB(){var r=h2(vx()).domain([1,10]);return r.copy=function(){return pp(r,bB()).base(r.base())},Xf.apply(r,arguments)}function wB(){var r=f2(vx());return r.copy=function(){return pp(r,wB()).constant(r.constant())},Xf.apply(r,arguments)}function S2(){var r=d2(vx());return r.copy=function(){return pp(r,S2()).exponent(r.exponent())},Xf.apply(r,arguments)}function O7(){return S2.apply(null,arguments).exponent(.5)}function SB(){var r=[],n=Ys;function l(c){if(c!=null&&!isNaN(c=+c))return n((Gy(r,c,1)-1)/(r.length-1))}return l.domain=function(c){if(!arguments.length)return r.slice();r=[];for(let y of c)y!=null&&!isNaN(y=+y)&&r.push(y);return r.sort(cp),l},l.interpolator=function(c){return arguments.length?(n=c,l):n},l.range=function(){return r.map((c,y)=>n(y/(r.length-1)))},l.quantiles=function(c){return Array.from({length:c+1},(y,w)=>_H(r,w/c))},l.copy=function(){return SB(n).domain(r)},Xf.apply(l,arguments)}function xx(){var r=0,n=.5,l=1,c=1,y,w,P,a,R,z=Ys,$,V=!1,W;function ie(ee){return isNaN(ee=+ee)?W:(ee=.5+((ee=+$(ee))-w)*(c*ee<c*w?a:R),z(V?Math.max(0,Math.min(1,ee)):ee))}ie.domain=function(ee){return arguments.length?([r,n,l]=ee,y=$(r=+r),w=$(n=+n),P=$(l=+l),a=y===w?0:.5/(w-y),R=w===P?0:.5/(P-w),c=w<y?-1:1,ie):[r,n,l]},ie.clamp=function(ee){return arguments.length?(V=!!ee,ie):V},ie.interpolator=function(ee){return arguments.length?(z=ee,ie):z};function ae(ee){return function(ne){var de,xe,be;return arguments.length?([de,xe,be]=ne,z=$H(ee,[de,xe,be]),ie):[z(0),z(.5),z(1)]}}return ie.range=ae(Hg),ie.rangeRound=ae(s2),ie.unknown=function(ee){return arguments.length?(W=ee,ie):W},function(ee){return $=ee,y=ee(r),w=ee(n),P=ee(l),a=y===w?0:.5/(w-y),R=w===P?0:.5/(P-w),c=w<y?-1:1,ie}}function TB(){var r=dp(xx()(Ys));return r.copy=function(){return pp(r,TB())},Xf.apply(r,arguments)}function EB(){var r=h2(xx()).domain([.1,1,10]);return r.copy=function(){return pp(r,EB()).base(r.base())},Xf.apply(r,arguments)}function AB(){var r=f2(xx());return r.copy=function(){return pp(r,AB()).constant(r.constant())},Xf.apply(r,arguments)}function T2(){var r=d2(xx());return r.copy=function(){return pp(r,T2()).exponent(r.exponent())},Xf.apply(r,arguments)}function R7(){return T2.apply(null,arguments).exponent(.5)}const sz=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:fy,scaleDiverging:TB,scaleDivergingLog:EB,scaleDivergingPow:T2,scaleDivergingSqrt:R7,scaleDivergingSymlog:AB,scaleIdentity:iB,scaleImplicit:DE,scaleLinear:E0,scaleLog:aB,scaleOrdinal:i2,scalePoint:ey,scalePow:p2,scaleQuantile:uB,scaleQuantize:cB,scaleRadial:lB,scaleSequential:xB,scaleSequentialLog:bB,scaleSequentialPow:S2,scaleSequentialQuantile:SB,scaleSequentialSqrt:O7,scaleSequentialSymlog:wB,scaleSqrt:fW,scaleSymlog:sB,scaleThreshold:hB,scaleTime:C7,scaleUtc:M7,tickFormat:nB},Symbol.toStringTag,{value:"Module"}));var vT,lz;function bx(){if(lz)return vT;lz=1;var r=Vg();function n(l,c,y){for(var w=-1,P=l.length;++w<P;){var a=l[w],R=c(a);if(R!=null&&(z===void 0?R===R&&!r(R):y(R,z)))var z=R,$=a}return $}return vT=n,vT}var xT,uz;function PB(){if(uz)return xT;uz=1;function r(n,l){return n>l}return xT=r,xT}var bT,cz;function k7(){if(cz)return bT;cz=1;var r=bx(),n=PB(),l=qg();function c(y){return y&&y.length?r(y,l,n):void 0}return bT=c,bT}var D7=k7();const wx=Xi(D7);var wT,hz;function IB(){if(hz)return wT;hz=1;function r(n,l){return n<l}return wT=r,wT}var ST,fz;function z7(){if(fz)return ST;fz=1;var r=bx(),n=IB(),l=qg();function c(y){return y&&y.length?r(y,l,n):void 0}return ST=c,ST}var L7=z7();const Sx=Xi(L7);var TT,dz;function F7(){if(dz)return TT;dz=1;var r=NA(),n=Fh(),l=LF(),c=bl();function y(w,P){var a=c(w)?r:l;return a(w,n(P,3))}return TT=y,TT}var ET,pz;function B7(){if(pz)return ET;pz=1;var r=DF(),n=F7();function l(c,y){return r(n(c,y),1)}return ET=l,ET}var N7=B7();const j7=Xi(N7);var AT,mz;function U7(){if(mz)return AT;mz=1;var r=JA();function n(l,c){return r(l,c)}return AT=n,AT}var V7=U7();const Tx=Xi(V7);var Wg=1e9,$7={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},A2,Lo=!0,$u="[DecimalError] ",um=$u+"Invalid argument: ",E2=$u+"Exponent out of range: ",Zg=Math.floor,rm=Math.pow,q7=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Kl,Ja=1e7,Po=7,CB=9007199254740991,C0=Zg(CB/Po),rn={};rn.absoluteValue=rn.abs=function(){var r=new this.constructor(this);return r.s&&(r.s=1),r};rn.comparedTo=rn.cmp=function(r){var n,l,c,y,w=this;if(r=new w.constructor(r),w.s!==r.s)return w.s||-r.s;if(w.e!==r.e)return w.e>r.e^w.s<0?1:-1;for(c=w.d.length,y=r.d.length,n=0,l=c<y?c:y;n<l;++n)if(w.d[n]!==r.d[n])return w.d[n]>r.d[n]^w.s<0?1:-1;return c===y?0:c>y^w.s<0?1:-1};rn.decimalPlaces=rn.dp=function(){var r=this,n=r.d.length-1,l=(n-r.e)*Po;if(n=r.d[n],n)for(;n%10==0;n/=10)l--;return l<0?0:l};rn.dividedBy=rn.div=function(r){return Uf(this,new this.constructor(r))};rn.dividedToIntegerBy=rn.idiv=function(r){var n=this,l=n.constructor;return ho(Uf(n,new l(r),0,1),l.precision)};rn.equals=rn.eq=function(r){return!this.cmp(r)};rn.exponent=function(){return ba(this)};rn.greaterThan=rn.gt=function(r){return this.cmp(r)>0};rn.greaterThanOrEqualTo=rn.gte=function(r){return this.cmp(r)>=0};rn.isInteger=rn.isint=function(){return this.e>this.d.length-2};rn.isNegative=rn.isneg=function(){return this.s<0};rn.isPositive=rn.ispos=function(){return this.s>0};rn.isZero=function(){return this.s===0};rn.lessThan=rn.lt=function(r){return this.cmp(r)<0};rn.lessThanOrEqualTo=rn.lte=function(r){return this.cmp(r)<1};rn.logarithm=rn.log=function(r){var n,l=this,c=l.constructor,y=c.precision,w=y+5;if(r===void 0)r=new c(10);else if(r=new c(r),r.s<1||r.eq(Kl))throw Error($u+"NaN");if(l.s<1)throw Error($u+(l.s?"NaN":"-Infinity"));return l.eq(Kl)?new c(0):(Lo=!1,n=Uf(_y(l,w),_y(r,w),w),Lo=!0,ho(n,y))};rn.minus=rn.sub=function(r){var n=this;return r=new n.constructor(r),n.s==r.s?RB(n,r):MB(n,(r.s=-r.s,r))};rn.modulo=rn.mod=function(r){var n,l=this,c=l.constructor,y=c.precision;if(r=new c(r),!r.s)throw Error($u+"NaN");return l.s?(Lo=!1,n=Uf(l,r,0,1).times(r),Lo=!0,l.minus(n)):ho(new c(l),y)};rn.naturalExponential=rn.exp=function(){return OB(this)};rn.naturalLogarithm=rn.ln=function(){return _y(this)};rn.negated=rn.neg=function(){var r=new this.constructor(this);return r.s=-r.s||0,r};rn.plus=rn.add=function(r){var n=this;return r=new n.constructor(r),n.s==r.s?MB(n,r):RB(n,(r.s=-r.s,r))};rn.precision=rn.sd=function(r){var n,l,c,y=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(um+r);if(n=ba(y)+1,c=y.d.length-1,l=c*Po+1,c=y.d[c],c){for(;c%10==0;c/=10)l--;for(c=y.d[0];c>=10;c/=10)l++}return r&&n>l?n:l};rn.squareRoot=rn.sqrt=function(){var r,n,l,c,y,w,P,a=this,R=a.constructor;if(a.s<1){if(!a.s)return new R(0);throw Error($u+"NaN")}for(r=ba(a),Lo=!1,y=Math.sqrt(+a),y==0||y==1/0?(n=Rh(a.d),(n.length+r)%2==0&&(n+="0"),y=Math.sqrt(n),r=Zg((r+1)/2)-(r<0||r%2),y==1/0?n="5e"+r:(n=y.toExponential(),n=n.slice(0,n.indexOf("e")+1)+r),c=new R(n)):c=new R(y.toString()),l=R.precision,y=P=l+3;;)if(w=c,c=w.plus(Uf(a,w,P+2)).times(.5),Rh(w.d).slice(0,P)===(n=Rh(c.d)).slice(0,P)){if(n=n.slice(P-3,P+1),y==P&&n=="4999"){if(ho(w,l+1,0),w.times(w).eq(a)){c=w;break}}else if(n!="9999")break;P+=4}return Lo=!0,ho(c,l)};rn.times=rn.mul=function(r){var n,l,c,y,w,P,a,R,z,$=this,V=$.constructor,W=$.d,ie=(r=new V(r)).d;if(!$.s||!r.s)return new V(0);for(r.s*=$.s,l=$.e+r.e,R=W.length,z=ie.length,R<z&&(w=W,W=ie,ie=w,P=R,R=z,z=P),w=[],P=R+z,c=P;c--;)w.push(0);for(c=z;--c>=0;){for(n=0,y=R+c;y>c;)a=w[y]+ie[c]*W[y-c-1]+n,w[y--]=a%Ja|0,n=a/Ja|0;w[y]=(w[y]+n)%Ja|0}for(;!w[--P];)w.pop();return n?++l:w.shift(),r.d=w,r.e=l,Lo?ho(r,V.precision):r};rn.toDecimalPlaces=rn.todp=function(r,n){var l=this,c=l.constructor;return l=new c(l),r===void 0?l:(zh(r,0,Wg),n===void 0?n=c.rounding:zh(n,0,8),ho(l,r+ba(l)+1,n))};rn.toExponential=function(r,n){var l,c=this,y=c.constructor;return r===void 0?l=dm(c,!0):(zh(r,0,Wg),n===void 0?n=y.rounding:zh(n,0,8),c=ho(new y(c),r+1,n),l=dm(c,!0,r+1)),l};rn.toFixed=function(r,n){var l,c,y=this,w=y.constructor;return r===void 0?dm(y):(zh(r,0,Wg),n===void 0?n=w.rounding:zh(n,0,8),c=ho(new w(y),r+ba(y)+1,n),l=dm(c.abs(),!1,r+ba(c)+1),y.isneg()&&!y.isZero()?"-"+l:l)};rn.toInteger=rn.toint=function(){var r=this,n=r.constructor;return ho(new n(r),ba(r)+1,n.rounding)};rn.toNumber=function(){return+this};rn.toPower=rn.pow=function(r){var n,l,c,y,w,P,a=this,R=a.constructor,z=12,$=+(r=new R(r));if(!r.s)return new R(Kl);if(a=new R(a),!a.s){if(r.s<1)throw Error($u+"Infinity");return a}if(a.eq(Kl))return a;if(c=R.precision,r.eq(Kl))return ho(a,c);if(n=r.e,l=r.d.length-1,P=n>=l,w=a.s,P){if((l=$<0?-$:$)<=CB){for(y=new R(Kl),n=Math.ceil(c/Po+4),Lo=!1;l%2&&(y=y.times(a),_z(y.d,n)),l=Zg(l/2),l!==0;)a=a.times(a),_z(a.d,n);return Lo=!0,r.s<0?new R(Kl).div(y):ho(y,c)}}else if(w<0)throw Error($u+"NaN");return w=w<0&&r.d[Math.max(n,l)]&1?-1:1,a.s=1,Lo=!1,y=r.times(_y(a,c+z)),Lo=!0,y=OB(y),y.s=w,y};rn.toPrecision=function(r,n){var l,c,y=this,w=y.constructor;return r===void 0?(l=ba(y),c=dm(y,l<=w.toExpNeg||l>=w.toExpPos)):(zh(r,1,Wg),n===void 0?n=w.rounding:zh(n,0,8),y=ho(new w(y),r,n),l=ba(y),c=dm(y,r<=l||l<=w.toExpNeg,r)),c};rn.toSignificantDigits=rn.tosd=function(r,n){var l=this,c=l.constructor;return r===void 0?(r=c.precision,n=c.rounding):(zh(r,1,Wg),n===void 0?n=c.rounding:zh(n,0,8)),ho(new c(l),r,n)};rn.toString=rn.valueOf=rn.val=rn.toJSON=rn[Symbol.for("nodejs.util.inspect.custom")]=function(){var r=this,n=ba(r),l=r.constructor;return dm(r,n<=l.toExpNeg||n>=l.toExpPos)};function MB(r,n){var l,c,y,w,P,a,R,z,$=r.constructor,V=$.precision;if(!r.s||!n.s)return n.s||(n=new $(r)),Lo?ho(n,V):n;if(R=r.d,z=n.d,P=r.e,y=n.e,R=R.slice(),w=P-y,w){for(w<0?(c=R,w=-w,a=z.length):(c=z,y=P,a=R.length),P=Math.ceil(V/Po),a=P>a?P+1:a+1,w>a&&(w=a,c.length=1),c.reverse();w--;)c.push(0);c.reverse()}for(a=R.length,w=z.length,a-w<0&&(w=a,c=z,z=R,R=c),l=0;w;)l=(R[--w]=R[w]+z[w]+l)/Ja|0,R[w]%=Ja;for(l&&(R.unshift(l),++y),a=R.length;R[--a]==0;)R.pop();return n.d=R,n.e=y,Lo?ho(n,V):n}function zh(r,n,l){if(r!==~~r||r<n||r>l)throw Error(um+r)}function Rh(r){var n,l,c,y=r.length-1,w="",P=r[0];if(y>0){for(w+=P,n=1;n<y;n++)c=r[n]+"",l=Po-c.length,l&&(w+=ap(l)),w+=c;P=r[n],c=P+"",l=Po-c.length,l&&(w+=ap(l))}else if(P===0)return"0";for(;P%10===0;)P/=10;return w+P}var Uf=(function(){function r(c,y){var w,P=0,a=c.length;for(c=c.slice();a--;)w=c[a]*y+P,c[a]=w%Ja|0,P=w/Ja|0;return P&&c.unshift(P),c}function n(c,y,w,P){var a,R;if(w!=P)R=w>P?1:-1;else for(a=R=0;a<w;a++)if(c[a]!=y[a]){R=c[a]>y[a]?1:-1;break}return R}function l(c,y,w){for(var P=0;w--;)c[w]-=P,P=c[w]<y[w]?1:0,c[w]=P*Ja+c[w]-y[w];for(;!c[0]&&c.length>1;)c.shift()}return function(c,y,w,P){var a,R,z,$,V,W,ie,ae,ee,ne,de,xe,be,ke,he,_e,ze,Ne,rt=c.constructor,kt=c.s==y.s?1:-1,He=c.d,yt=y.d;if(!c.s)return new rt(c);if(!y.s)throw Error($u+"Division by zero");for(R=c.e-y.e,ze=yt.length,he=He.length,ie=new rt(kt),ae=ie.d=[],z=0;yt[z]==(He[z]||0);)++z;if(yt[z]>(He[z]||0)&&--R,w==null?xe=w=rt.precision:P?xe=w+(ba(c)-ba(y))+1:xe=w,xe<0)return new rt(0);if(xe=xe/Po+2|0,z=0,ze==1)for($=0,yt=yt[0],xe++;(z<he||$)&&xe--;z++)be=$*Ja+(He[z]||0),ae[z]=be/yt|0,$=be%yt|0;else{for($=Ja/(yt[0]+1)|0,$>1&&(yt=r(yt,$),He=r(He,$),ze=yt.length,he=He.length),ke=ze,ee=He.slice(0,ze),ne=ee.length;ne<ze;)ee[ne++]=0;Ne=yt.slice(),Ne.unshift(0),_e=yt[0],yt[1]>=Ja/2&&++_e;do $=0,a=n(yt,ee,ze,ne),a<0?(de=ee[0],ze!=ne&&(de=de*Ja+(ee[1]||0)),$=de/_e|0,$>1?($>=Ja&&($=Ja-1),V=r(yt,$),W=V.length,ne=ee.length,a=n(V,ee,W,ne),a==1&&($--,l(V,ze<W?Ne:yt,W))):($==0&&(a=$=1),V=yt.slice()),W=V.length,W<ne&&V.unshift(0),l(ee,V,ne),a==-1&&(ne=ee.length,a=n(yt,ee,ze,ne),a<1&&($++,l(ee,ze<ne?Ne:yt,ne))),ne=ee.length):a===0&&($++,ee=[0]),ae[z++]=$,a&&ee[0]?ee[ne++]=He[ke]||0:(ee=[He[ke]],ne=1);while((ke++<he||ee[0]!==void 0)&&xe--)}return ae[0]||ae.shift(),ie.e=R,ho(ie,P?w+ba(ie)+1:w)}})();function OB(r,n){var l,c,y,w,P,a,R=0,z=0,$=r.constructor,V=$.precision;if(ba(r)>16)throw Error(E2+ba(r));if(!r.s)return new $(Kl);for(Lo=!1,a=V,P=new $(.03125);r.abs().gte(.1);)r=r.times(P),z+=5;for(c=Math.log(rm(2,z))/Math.LN10*2+5|0,a+=c,l=y=w=new $(Kl),$.precision=a;;){if(y=ho(y.times(r),a),l=l.times(++R),P=w.plus(Uf(y,l,a)),Rh(P.d).slice(0,a)===Rh(w.d).slice(0,a)){for(;z--;)w=ho(w.times(w),a);return $.precision=V,n==null?(Lo=!0,ho(w,V)):w}w=P}}function ba(r){for(var n=r.e*Po,l=r.d[0];l>=10;l/=10)n++;return n}function PT(r,n,l){if(n>r.LN10.sd())throw Lo=!0,l&&(r.precision=l),Error($u+"LN10 precision limit exceeded");return ho(new r(r.LN10),n)}function ap(r){for(var n="";r--;)n+="0";return n}function _y(r,n){var l,c,y,w,P,a,R,z,$,V=1,W=10,ie=r,ae=ie.d,ee=ie.constructor,ne=ee.precision;if(ie.s<1)throw Error($u+(ie.s?"NaN":"-Infinity"));if(ie.eq(Kl))return new ee(0);if(n==null?(Lo=!1,z=ne):z=n,ie.eq(10))return n==null&&(Lo=!0),PT(ee,z);if(z+=W,ee.precision=z,l=Rh(ae),c=l.charAt(0),w=ba(ie),Math.abs(w)<15e14){for(;c<7&&c!=1||c==1&&l.charAt(1)>3;)ie=ie.times(r),l=Rh(ie.d),c=l.charAt(0),V++;w=ba(ie),c>1?(ie=new ee("0."+l),w++):ie=new ee(c+"."+l.slice(1))}else return R=PT(ee,z+2,ne).times(w+""),ie=_y(new ee(c+"."+l.slice(1)),z-W).plus(R),ee.precision=ne,n==null?(Lo=!0,ho(ie,ne)):ie;for(a=P=ie=Uf(ie.minus(Kl),ie.plus(Kl),z),$=ho(ie.times(ie),z),y=3;;){if(P=ho(P.times($),z),R=a.plus(Uf(P,new ee(y),z)),Rh(R.d).slice(0,z)===Rh(a.d).slice(0,z))return a=a.times(2),w!==0&&(a=a.plus(PT(ee,z+2,ne).times(w+""))),a=Uf(a,new ee(V),z),ee.precision=ne,n==null?(Lo=!0,ho(a,ne)):a;a=R,y+=2}}function gz(r,n){var l,c,y;for((l=n.indexOf("."))>-1&&(n=n.replace(".","")),(c=n.search(/e/i))>0?(l<0&&(l=c),l+=+n.slice(c+1),n=n.substring(0,c)):l<0&&(l=n.length),c=0;n.charCodeAt(c)===48;)++c;for(y=n.length;n.charCodeAt(y-1)===48;)--y;if(n=n.slice(c,y),n){if(y-=c,l=l-c-1,r.e=Zg(l/Po),r.d=[],c=(l+1)%Po,l<0&&(c+=Po),c<y){for(c&&r.d.push(+n.slice(0,c)),y-=Po;c<y;)r.d.push(+n.slice(c,c+=Po));n=n.slice(c),c=Po-n.length}else c-=y;for(;c--;)n+="0";if(r.d.push(+n),Lo&&(r.e>C0||r.e<-C0))throw Error(E2+l)}else r.s=0,r.e=0,r.d=[0];return r}function ho(r,n,l){var c,y,w,P,a,R,z,$,V=r.d;for(P=1,w=V[0];w>=10;w/=10)P++;if(c=n-P,c<0)c+=Po,y=n,z=V[$=0];else{if($=Math.ceil((c+1)/Po),w=V.length,$>=w)return r;for(z=w=V[$],P=1;w>=10;w/=10)P++;c%=Po,y=c-Po+P}if(l!==void 0&&(w=rm(10,P-y-1),a=z/w%10|0,R=n<0||V[$+1]!==void 0||z%w,R=l<4?(a||R)&&(l==0||l==(r.s<0?3:2)):a>5||a==5&&(l==4||R||l==6&&(c>0?y>0?z/rm(10,P-y):0:V[$-1])%10&1||l==(r.s<0?8:7))),n<1||!V[0])return R?(w=ba(r),V.length=1,n=n-w-1,V[0]=rm(10,(Po-n%Po)%Po),r.e=Zg(-n/Po)||0):(V.length=1,V[0]=r.e=r.s=0),r;if(c==0?(V.length=$,w=1,$--):(V.length=$+1,w=rm(10,Po-c),V[$]=y>0?(z/rm(10,P-y)%rm(10,y)|0)*w:0),R)for(;;)if($==0){(V[0]+=w)==Ja&&(V[0]=1,++r.e);break}else{if(V[$]+=w,V[$]!=Ja)break;V[$--]=0,w=1}for(c=V.length;V[--c]===0;)V.pop();if(Lo&&(r.e>C0||r.e<-C0))throw Error(E2+ba(r));return r}function RB(r,n){var l,c,y,w,P,a,R,z,$,V,W=r.constructor,ie=W.precision;if(!r.s||!n.s)return n.s?n.s=-n.s:n=new W(r),Lo?ho(n,ie):n;if(R=r.d,V=n.d,c=n.e,z=r.e,R=R.slice(),P=z-c,P){for($=P<0,$?(l=R,P=-P,a=V.length):(l=V,c=z,a=R.length),y=Math.max(Math.ceil(ie/Po),a)+2,P>y&&(P=y,l.length=1),l.reverse(),y=P;y--;)l.push(0);l.reverse()}else{for(y=R.length,a=V.length,$=y<a,$&&(a=y),y=0;y<a;y++)if(R[y]!=V[y]){$=R[y]<V[y];break}P=0}for($&&(l=R,R=V,V=l,n.s=-n.s),a=R.length,y=V.length-a;y>0;--y)R[a++]=0;for(y=V.length;y>P;){if(R[--y]<V[y]){for(w=y;w&&R[--w]===0;)R[w]=Ja-1;--R[w],R[y]+=Ja}R[y]-=V[y]}for(;R[--a]===0;)R.pop();for(;R[0]===0;R.shift())--c;return R[0]?(n.d=R,n.e=c,Lo?ho(n,ie):n):new W(0)}function dm(r,n,l){var c,y=ba(r),w=Rh(r.d),P=w.length;return n?(l&&(c=l-P)>0?w=w.charAt(0)+"."+w.slice(1)+ap(c):P>1&&(w=w.charAt(0)+"."+w.slice(1)),w=w+(y<0?"e":"e+")+y):y<0?(w="0."+ap(-y-1)+w,l&&(c=l-P)>0&&(w+=ap(c))):y>=P?(w+=ap(y+1-P),l&&(c=l-y-1)>0&&(w=w+"."+ap(c))):((c=y+1)<P&&(w=w.slice(0,c)+"."+w.slice(c)),l&&(c=l-P)>0&&(y+1===P&&(w+="."),w+=ap(c))),r.s<0?"-"+w:w}function _z(r,n){if(r.length>n)return r.length=n,!0}function kB(r){var n,l,c;function y(w){var P=this;if(!(P instanceof y))return new y(w);if(P.constructor=y,w instanceof y){P.s=w.s,P.e=w.e,P.d=(w=w.d)?w.slice():w;return}if(typeof w=="number"){if(w*0!==0)throw Error(um+w);if(w>0)P.s=1;else if(w<0)w=-w,P.s=-1;else{P.s=0,P.e=0,P.d=[0];return}if(w===~~w&&w<1e7){P.e=0,P.d=[w];return}return gz(P,w.toString())}else if(typeof w!="string")throw Error(um+w);if(w.charCodeAt(0)===45?(w=w.slice(1),P.s=-1):P.s=1,q7.test(w))gz(P,w);else throw Error(um+w)}if(y.prototype=rn,y.ROUND_UP=0,y.ROUND_DOWN=1,y.ROUND_CEIL=2,y.ROUND_FLOOR=3,y.ROUND_HALF_UP=4,y.ROUND_HALF_DOWN=5,y.ROUND_HALF_EVEN=6,y.ROUND_HALF_CEIL=7,y.ROUND_HALF_FLOOR=8,y.clone=kB,y.config=y.set=G7,r===void 0&&(r={}),r)for(c=["precision","rounding","toExpNeg","toExpPos","LN10"],n=0;n<c.length;)r.hasOwnProperty(l=c[n++])||(r[l]=this[l]);return y.config(r),y}function G7(r){if(!r||typeof r!="object")throw Error($u+"Object expected");var n,l,c,y=["precision",1,Wg,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(n=0;n<y.length;n+=3)if((c=r[l=y[n]])!==void 0)if(Zg(c)===c&&c>=y[n+1]&&c<=y[n+2])this[l]=c;else throw Error(um+l+": "+c);if((c=r[l="LN10"])!==void 0)if(c==Math.LN10)this[l]=new this(c);else throw Error(um+l+": "+c);return this}var A2=kB($7);Kl=new A2(1);const io=A2;function H7(r){return K7(r)||X7(r)||Z7(r)||W7()}function W7(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Z7(r,n){if(r){if(typeof r=="string")return BE(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return BE(r,n)}}function X7(r){if(typeof Symbol<"u"&&Symbol.iterator in Object(r))return Array.from(r)}function K7(r){if(Array.isArray(r))return BE(r)}function BE(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}var Y7=function(n){return n},DB={},zB=function(n){return n===DB},yz=function(n){return function l(){return arguments.length===0||arguments.length===1&&zB(arguments.length<=0?void 0:arguments[0])?l:n.apply(void 0,arguments)}},J7=function r(n,l){return n===1?l:yz(function(){for(var c=arguments.length,y=new Array(c),w=0;w<c;w++)y[w]=arguments[w];var P=y.filter(function(a){return a!==DB}).length;return P>=n?l.apply(void 0,y):r(n-P,yz(function(){for(var a=arguments.length,R=new Array(a),z=0;z<a;z++)R[z]=arguments[z];var $=y.map(function(V){return zB(V)?R.shift():V});return l.apply(void 0,H7($).concat(R))}))})},Ex=function(n){return J7(n.length,n)},NE=function(n,l){for(var c=[],y=n;y<l;++y)c[y-n]=y;return c},Q7=Ex(function(r,n){return Array.isArray(n)?n.map(r):Object.keys(n).map(function(l){return n[l]}).map(r)}),e9=function(){for(var n=arguments.length,l=new Array(n),c=0;c<n;c++)l[c]=arguments[c];if(!l.length)return Y7;var y=l.reverse(),w=y[0],P=y.slice(1);return function(){return P.reduce(function(a,R){return R(a)},w.apply(void 0,arguments))}},jE=function(n){return Array.isArray(n)?n.reverse():n.split("").reverse.join("")},LB=function(n){var l=null,c=null;return function(){for(var y=arguments.length,w=new Array(y),P=0;P<y;P++)w[P]=arguments[P];return l&&w.every(function(a,R){return a===l[R]})||(l=w,c=n.apply(void 0,w)),c}};function t9(r){var n;return r===0?n=1:n=Math.floor(new io(r).abs().log(10).toNumber())+1,n}function r9(r,n,l){for(var c=new io(r),y=0,w=[];c.lt(n)&&y<1e5;)w.push(c.toNumber()),c=c.add(l),y++;return w}var n9=Ex(function(r,n,l){var c=+r,y=+n;return c+l*(y-c)}),i9=Ex(function(r,n,l){var c=n-+r;return c=c||1/0,(l-r)/c}),o9=Ex(function(r,n,l){var c=n-+r;return c=c||1/0,Math.max(0,Math.min(1,(l-r)/c))});const Ax={rangeStep:r9,getDigitCount:t9,interpolateNumber:n9,uninterpolateNumber:i9,uninterpolateTruncation:o9};function UE(r){return l9(r)||s9(r)||FB(r)||a9()}function a9(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function s9(r){if(typeof Symbol<"u"&&Symbol.iterator in Object(r))return Array.from(r)}function l9(r){if(Array.isArray(r))return VE(r)}function yy(r,n){return h9(r)||c9(r,n)||FB(r,n)||u9()}function u9(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FB(r,n){if(r){if(typeof r=="string")return VE(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return VE(r,n)}}function VE(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function c9(r,n){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(r)))){var l=[],c=!0,y=!1,w=void 0;try{for(var P=r[Symbol.iterator](),a;!(c=(a=P.next()).done)&&(l.push(a.value),!(n&&l.length===n));c=!0);}catch(R){y=!0,w=R}finally{try{!c&&P.return!=null&&P.return()}finally{if(y)throw w}}return l}}function h9(r){if(Array.isArray(r))return r}function BB(r){var n=yy(r,2),l=n[0],c=n[1],y=l,w=c;return l>c&&(y=c,w=l),[y,w]}function NB(r,n,l){if(r.lte(0))return new io(0);var c=Ax.getDigitCount(r.toNumber()),y=new io(10).pow(c),w=r.div(y),P=c!==1?.05:.1,a=new io(Math.ceil(w.div(P).toNumber())).add(l).mul(P),R=a.mul(y);return n?R:new io(Math.ceil(R))}function f9(r,n,l){var c=1,y=new io(r);if(!y.isint()&&l){var w=Math.abs(r);w<1?(c=new io(10).pow(Ax.getDigitCount(r)-1),y=new io(Math.floor(y.div(c).toNumber())).mul(c)):w>1&&(y=new io(Math.floor(r)))}else r===0?y=new io(Math.floor((n-1)/2)):l||(y=new io(Math.floor(r)));var P=Math.floor((n-1)/2),a=e9(Q7(function(R){return y.add(new io(R-P).mul(c)).toNumber()}),NE);return a(0,n)}function jB(r,n,l,c){var y=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((n-r)/(l-1)))return{step:new io(0),tickMin:new io(0),tickMax:new io(0)};var w=NB(new io(n).sub(r).div(l-1),c,y),P;r<=0&&n>=0?P=new io(0):(P=new io(r).add(n).div(2),P=P.sub(new io(P).mod(w)));var a=Math.ceil(P.sub(r).div(w).toNumber()),R=Math.ceil(new io(n).sub(P).div(w).toNumber()),z=a+R+1;return z>l?jB(r,n,l,c,y+1):(z<l&&(R=n>0?R+(l-z):R,a=n>0?a:a+(l-z)),{step:w,tickMin:P.sub(new io(a).mul(w)),tickMax:P.add(new io(R).mul(w))})}function d9(r){var n=yy(r,2),l=n[0],c=n[1],y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,P=Math.max(y,2),a=BB([l,c]),R=yy(a,2),z=R[0],$=R[1];if(z===-1/0||$===1/0){var V=$===1/0?[z].concat(UE(NE(0,y-1).map(function(){return 1/0}))):[].concat(UE(NE(0,y-1).map(function(){return-1/0})),[$]);return l>c?jE(V):V}if(z===$)return f9(z,y,w);var W=jB(z,$,P,w),ie=W.step,ae=W.tickMin,ee=W.tickMax,ne=Ax.rangeStep(ae,ee.add(new io(.1).mul(ie)),ie);return l>c?jE(ne):ne}function p9(r,n){var l=yy(r,2),c=l[0],y=l[1],w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,P=BB([c,y]),a=yy(P,2),R=a[0],z=a[1];if(R===-1/0||z===1/0)return[c,y];if(R===z)return[R];var $=Math.max(n,2),V=NB(new io(z).sub(R).div($-1),w,0),W=[].concat(UE(Ax.rangeStep(new io(R),new io(z).sub(new io(.99).mul(V)),V)),[z]);return c>y?jE(W):W}var m9=LB(d9),g9=LB(p9),_9="Invariant failed";function pm(r,n){throw new Error(_9)}var y9=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function Tg(r){"@babel/helpers - typeof";return Tg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Tg(r)}function M0(){return M0=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},M0.apply(this,arguments)}function v9(r,n){return S9(r)||w9(r,n)||b9(r,n)||x9()}function x9(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function b9(r,n){if(r){if(typeof r=="string")return vz(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return vz(r,n)}}function vz(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function w9(r,n){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var c,y,w,P,a=[],R=!0,z=!1;try{if(w=(l=l.call(r)).next,n!==0)for(;!(R=(c=w.call(l)).done)&&(a.push(c.value),a.length!==n);R=!0);}catch($){z=!0,y=$}finally{try{if(!R&&l.return!=null&&(P=l.return(),Object(P)!==P))return}finally{if(z)throw y}}return a}}function S9(r){if(Array.isArray(r))return r}function T9(r,n){if(r==null)return{};var l=E9(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function E9(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}function A9(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function P9(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,$B(c.key),c)}}function I9(r,n,l){return n&&P9(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function C9(r,n,l){return n=O0(n),M9(r,UB()?Reflect.construct(n,l||[],O0(r).constructor):n.apply(r,l))}function M9(r,n){if(n&&(Tg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return O9(r)}function O9(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function UB(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(UB=function(){return!!r})()}function O0(r){return O0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},O0(r)}function R9(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&$E(r,n)}function $E(r,n){return $E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},$E(r,n)}function VB(r,n,l){return n=$B(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function $B(r){var n=k9(r,"string");return Tg(n)=="symbol"?n:n+""}function k9(r,n){if(Tg(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Tg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var Px=(function(r){function n(){return A9(this,n),C9(this,n,arguments)}return R9(n,r),I9(n,[{key:"render",value:function(){var c=this.props,y=c.offset,w=c.layout,P=c.width,a=c.dataKey,R=c.data,z=c.dataPointFormatter,$=c.xAxis,V=c.yAxis,W=T9(c,y9),ie=Vn(W,!1);this.props.direction==="x"&&$.type!=="number"&&pm();var ae=R.map(function(ee){var ne=z(ee,a),de=ne.x,xe=ne.y,be=ne.value,ke=ne.errorVal;if(!ke)return null;var he=[],_e,ze;if(Array.isArray(ke)){var Ne=v9(ke,2);_e=Ne[0],ze=Ne[1]}else _e=ze=ke;if(w==="vertical"){var rt=$.scale,kt=xe+y,He=kt+P,yt=kt-P,gt=rt(be-_e),Pt=rt(be+ze);he.push({x1:Pt,y1:He,x2:Pt,y2:yt}),he.push({x1:gt,y1:kt,x2:Pt,y2:kt}),he.push({x1:gt,y1:He,x2:gt,y2:yt})}else if(w==="horizontal"){var xt=V.scale,Tt=de+y,Ht=Tt-P,lt=Tt+P,Wt=xt(be-_e),Zt=xt(be+ze);he.push({x1:Ht,y1:Zt,x2:lt,y2:Zt}),he.push({x1:Tt,y1:Wt,x2:Tt,y2:Zt}),he.push({x1:Ht,y1:Wt,x2:lt,y2:Wt})}return ct.createElement(eo,M0({className:"recharts-errorBar",key:"bar-".concat(he.map(function($e){return"".concat($e.x1,"-").concat($e.x2,"-").concat($e.y1,"-").concat($e.y2)}))},ie),he.map(function($e){return ct.createElement("line",M0({},$e,{key:"line-".concat($e.x1,"-").concat($e.x2,"-").concat($e.y1,"-").concat($e.y2)}))}))});return ct.createElement(eo,{className:"recharts-errorBars"},ae)}}])})(ct.Component);VB(Px,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});VB(Px,"displayName","ErrorBar");function vy(r){"@babel/helpers - typeof";return vy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},vy(r)}function xz(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Jp(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?xz(Object(l),!0).forEach(function(c){D9(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):xz(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function D9(r,n,l){return n=z9(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function z9(r){var n=L9(r,"string");return vy(n)=="symbol"?n:n+""}function L9(r,n){if(vy(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(vy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}var qB=function(n){var l=n.children,c=n.formattedGraphicalItems,y=n.legendWidth,w=n.legendContent,P=Xl(l,fg);if(!P)return null;var a=fg.defaultProps,R=a!==void 0?Jp(Jp({},a),P.props):{},z;return P.props&&P.props.payload?z=P.props&&P.props.payload:w==="children"?z=(c||[]).reduce(function($,V){var W=V.item,ie=V.props,ae=ie.sectors||ie.data||[];return $.concat(ae.map(function(ee){return{type:P.props.iconType||W.props.legendType,value:ee.name,color:ee.fill,payload:ee}}))},[]):z=(c||[]).map(function($){var V=$.item,W=V.type.defaultProps,ie=W!==void 0?Jp(Jp({},W),V.props):{},ae=ie.dataKey,ee=ie.name,ne=ie.legendType,de=ie.hide;return{inactive:de,dataKey:ae,type:R.iconType||ne||"square",color:P2(V),value:ee||ae,payload:ie}}),Jp(Jp(Jp({},R),fg.getWithHeight(P,y)),{},{payload:z,item:P})};function xy(r){"@babel/helpers - typeof";return xy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},xy(r)}function bz(r){return j9(r)||N9(r)||B9(r)||F9()}function F9(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function B9(r,n){if(r){if(typeof r=="string")return qE(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return qE(r,n)}}function N9(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function j9(r){if(Array.isArray(r))return qE(r)}function qE(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function wz(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Jo(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?wz(Object(l),!0).forEach(function(c){pg(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):wz(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function pg(r,n,l){return n=U9(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function U9(r){var n=V9(r,"string");return xy(n)=="symbol"?n:n+""}function V9(r,n){if(xy(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(xy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function Cs(r,n,l){return xi(r)||xi(n)?l:za(n)?Yl(r,n,l):Zn(n)?n(r):l}function ty(r,n,l,c){var y=j7(r,function(a){return Cs(a,n)});if(l==="number"){var w=y.filter(function(a){return Rr(a)||parseFloat(a)});return w.length?[Sx(w),wx(w)]:[1/0,-1/0]}var P=c?y.filter(function(a){return!xi(a)}):y;return P.map(function(a){return za(a)||a instanceof Date?a:""})}var $9=function(n){var l,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],y=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0,P=-1,a=(l=c?.length)!==null&&l!==void 0?l:0;if(a<=1)return 0;if(w&&w.axisType==="angleAxis"&&Math.abs(Math.abs(w.range[1]-w.range[0])-360)<=1e-6)for(var R=w.range,z=0;z<a;z++){var $=z>0?y[z-1].coordinate:y[a-1].coordinate,V=y[z].coordinate,W=z>=a-1?y[0].coordinate:y[z+1].coordinate,ie=void 0;if(Xs(V-$)!==Xs(W-V)){var ae=[];if(Xs(W-V)===Xs(R[1]-R[0])){ie=W;var ee=V+R[1]-R[0];ae[0]=Math.min(ee,(ee+$)/2),ae[1]=Math.max(ee,(ee+$)/2)}else{ie=$;var ne=W+R[1]-R[0];ae[0]=Math.min(V,(ne+V)/2),ae[1]=Math.max(V,(ne+V)/2)}var de=[Math.min(V,(ie+V)/2),Math.max(V,(ie+V)/2)];if(n>de[0]&&n<=de[1]||n>=ae[0]&&n<=ae[1]){P=y[z].index;break}}else{var xe=Math.min($,W),be=Math.max($,W);if(n>(xe+V)/2&&n<=(be+V)/2){P=y[z].index;break}}}else for(var ke=0;ke<a;ke++)if(ke===0&&n<=(c[ke].coordinate+c[ke+1].coordinate)/2||ke>0&&ke<a-1&&n>(c[ke].coordinate+c[ke-1].coordinate)/2&&n<=(c[ke].coordinate+c[ke+1].coordinate)/2||ke===a-1&&n>(c[ke].coordinate+c[ke-1].coordinate)/2){P=c[ke].index;break}return P},P2=function(n){var l,c=n,y=c.type.displayName,w=(l=n.type)!==null&&l!==void 0&&l.defaultProps?Jo(Jo({},n.type.defaultProps),n.props):n.props,P=w.stroke,a=w.fill,R;switch(y){case"Line":R=P;break;case"Area":case"Radar":R=P&&P!=="none"?P:a;break;default:R=a;break}return R},q9=function(n){var l=n.barSize,c=n.totalSize,y=n.stackGroups,w=y===void 0?{}:y;if(!w)return{};for(var P={},a=Object.keys(w),R=0,z=a.length;R<z;R++)for(var $=w[a[R]].stackGroups,V=Object.keys($),W=0,ie=V.length;W<ie;W++){var ae=$[V[W]],ee=ae.items,ne=ae.cateAxisId,de=ee.filter(function(ze){return jf(ze.type).indexOf("Bar")>=0});if(de&&de.length){var xe=de[0].type.defaultProps,be=xe!==void 0?Jo(Jo({},xe),de[0].props):de[0].props,ke=be.barSize,he=be[ne];P[he]||(P[he]=[]);var _e=xi(ke)?l:ke;P[he].push({item:de[0],stackList:de.slice(1),barSize:xi(_e)?void 0:Ks(_e,c,0)})}}return P},G9=function(n){var l=n.barGap,c=n.barCategoryGap,y=n.bandSize,w=n.sizeList,P=w===void 0?[]:w,a=n.maxBarSize,R=P.length;if(R<1)return null;var z=Ks(l,y,0,!0),$,V=[];if(P[0].barSize===+P[0].barSize){var W=!1,ie=y/R,ae=P.reduce(function(ke,he){return ke+he.barSize||0},0);ae+=(R-1)*z,ae>=y&&(ae-=(R-1)*z,z=0),ae>=y&&ie>0&&(W=!0,ie*=.9,ae=R*ie);var ee=(y-ae)/2>>0,ne={offset:ee-z,size:0};$=P.reduce(function(ke,he){var _e={item:he.item,position:{offset:ne.offset+ne.size+z,size:W?ie:he.barSize}},ze=[].concat(bz(ke),[_e]);return ne=ze[ze.length-1].position,he.stackList&&he.stackList.length&&he.stackList.forEach(function(Ne){ze.push({item:Ne,position:ne})}),ze},V)}else{var de=Ks(c,y,0,!0);y-2*de-(R-1)*z<=0&&(z=0);var xe=(y-2*de-(R-1)*z)/R;xe>1&&(xe>>=0);var be=a===+a?Math.min(xe,a):xe;$=P.reduce(function(ke,he,_e){var ze=[].concat(bz(ke),[{item:he.item,position:{offset:de+(xe+z)*_e+(xe-be)/2,size:be}}]);return he.stackList&&he.stackList.length&&he.stackList.forEach(function(Ne){ze.push({item:Ne,position:ze[ze.length-1].position})}),ze},V)}return $},H9=function(n,l,c,y){var w=c.children,P=c.width,a=c.margin,R=P-(a.left||0)-(a.right||0),z=qB({children:w,legendWidth:R});if(z){var $=y||{},V=$.width,W=$.height,ie=z.align,ae=z.verticalAlign,ee=z.layout;if((ee==="vertical"||ee==="horizontal"&&ae==="middle")&&ie!=="center"&&Rr(n[ie]))return Jo(Jo({},n),{},pg({},ie,n[ie]+(V||0)));if((ee==="horizontal"||ee==="vertical"&&ie==="center")&&ae!=="middle"&&Rr(n[ae]))return Jo(Jo({},n),{},pg({},ae,n[ae]+(W||0)))}return n},W9=function(n,l,c){return xi(l)?!0:n==="horizontal"?l==="yAxis":n==="vertical"||c==="x"?l==="xAxis":c==="y"?l==="yAxis":!0},GB=function(n,l,c,y,w){var P=l.props.children,a=Vu(P,Px).filter(function(z){return W9(y,w,z.props.direction)});if(a&&a.length){var R=a.map(function(z){return z.props.dataKey});return n.reduce(function(z,$){var V=Cs($,c);if(xi(V))return z;var W=Array.isArray(V)?[Sx(V),wx(V)]:[V,V],ie=R.reduce(function(ae,ee){var ne=Cs($,ee,0),de=W[0]-Math.abs(Array.isArray(ne)?ne[0]:ne),xe=W[1]+Math.abs(Array.isArray(ne)?ne[1]:ne);return[Math.min(de,ae[0]),Math.max(xe,ae[1])]},[1/0,-1/0]);return[Math.min(ie[0],z[0]),Math.max(ie[1],z[1])]},[1/0,-1/0])}return null},Z9=function(n,l,c,y,w){var P=l.map(function(a){return GB(n,a,c,w,y)}).filter(function(a){return!xi(a)});return P&&P.length?P.reduce(function(a,R){return[Math.min(a[0],R[0]),Math.max(a[1],R[1])]},[1/0,-1/0]):null},HB=function(n,l,c,y,w){var P=l.map(function(R){var z=R.props.dataKey;return c==="number"&&z&&GB(n,R,z,y)||ty(n,z,c,w)});if(c==="number")return P.reduce(function(R,z){return[Math.min(R[0],z[0]),Math.max(R[1],z[1])]},[1/0,-1/0]);var a={};return P.reduce(function(R,z){for(var $=0,V=z.length;$<V;$++)a[z[$]]||(a[z[$]]=!0,R.push(z[$]));return R},[])},WB=function(n,l){return n==="horizontal"&&l==="xAxis"||n==="vertical"&&l==="yAxis"||n==="centric"&&l==="angleAxis"||n==="radial"&&l==="radiusAxis"},ZB=function(n,l,c,y){if(y)return n.map(function(R){return R.coordinate});var w,P,a=n.map(function(R){return R.coordinate===l&&(w=!0),R.coordinate===c&&(P=!0),R.coordinate});return w||a.push(l),P||a.push(c),a},Nf=function(n,l,c){if(!n)return null;var y=n.scale,w=n.duplicateDomain,P=n.type,a=n.range,R=n.realScaleType==="scaleBand"?y.bandwidth()/2:2,z=(l||c)&&P==="category"&&y.bandwidth?y.bandwidth()/R:0;if(z=n.axisType==="angleAxis"&&a?.length>=2?Xs(a[0]-a[1])*2*z:z,l&&(n.ticks||n.niceTicks)){var $=(n.ticks||n.niceTicks).map(function(V){var W=w?w.indexOf(V):V;return{coordinate:y(W)+z,value:V,offset:z}});return $.filter(function(V){return!Uy(V.coordinate)})}return n.isCategorical&&n.categoricalDomain?n.categoricalDomain.map(function(V,W){return{coordinate:y(V)+z,value:V,index:W,offset:z}}):y.ticks&&!c?y.ticks(n.tickCount).map(function(V){return{coordinate:y(V)+z,value:V,offset:z}}):y.domain().map(function(V,W){return{coordinate:y(V)+z,value:w?w[V]:V,index:W,offset:z}})},IT=new WeakMap,Jv=function(n,l){if(typeof l!="function")return n;IT.has(n)||IT.set(n,new WeakMap);var c=IT.get(n);if(c.has(l))return c.get(l);var y=function(){n.apply(void 0,arguments),l.apply(void 0,arguments)};return c.set(l,y),y},XB=function(n,l,c){var y=n.scale,w=n.type,P=n.layout,a=n.axisType;if(y==="auto")return P==="radial"&&a==="radiusAxis"?{scale:fy(),realScaleType:"band"}:P==="radial"&&a==="angleAxis"?{scale:E0(),realScaleType:"linear"}:w==="category"&&l&&(l.indexOf("LineChart")>=0||l.indexOf("AreaChart")>=0||l.indexOf("ComposedChart")>=0&&!c)?{scale:ey(),realScaleType:"point"}:w==="category"?{scale:fy(),realScaleType:"band"}:{scale:E0(),realScaleType:"linear"};if(cm(y)){var R="scale".concat(lx(y));return{scale:(sz[R]||ey)(),realScaleType:sz[R]?R:"point"}}return Zn(y)?{scale:y}:{scale:ey(),realScaleType:"point"}},Sz=1e-4,KB=function(n){var l=n.domain();if(!(!l||l.length<=2)){var c=l.length,y=n.range(),w=Math.min(y[0],y[1])-Sz,P=Math.max(y[0],y[1])+Sz,a=n(l[0]),R=n(l[c-1]);(a<w||a>P||R<w||R>P)&&n.domain([l[0],l[c-1]])}},X9=function(n,l){if(!n)return null;for(var c=0,y=n.length;c<y;c++)if(n[c].item===l)return n[c].position;return null},K9=function(n,l){if(!l||l.length!==2||!Rr(l[0])||!Rr(l[1]))return n;var c=Math.min(l[0],l[1]),y=Math.max(l[0],l[1]),w=[n[0],n[1]];return(!Rr(n[0])||n[0]<c)&&(w[0]=c),(!Rr(n[1])||n[1]>y)&&(w[1]=y),w[0]>y&&(w[0]=y),w[1]<c&&(w[1]=c),w},Y9=function(n){var l=n.length;if(!(l<=0))for(var c=0,y=n[0].length;c<y;++c)for(var w=0,P=0,a=0;a<l;++a){var R=Uy(n[a][c][1])?n[a][c][0]:n[a][c][1];R>=0?(n[a][c][0]=w,n[a][c][1]=w+R,w=n[a][c][1]):(n[a][c][0]=P,n[a][c][1]=P+R,P=n[a][c][1])}},J9=function(n){var l=n.length;if(!(l<=0))for(var c=0,y=n[0].length;c<y;++c)for(var w=0,P=0;P<l;++P){var a=Uy(n[P][c][1])?n[P][c][0]:n[P][c][1];a>=0?(n[P][c][0]=w,n[P][c][1]=w+a,w=n[P][c][1]):(n[P][c][0]=0,n[P][c][1]=0)}},Q9={sign:Y9,expand:j$,none:gg,silhouette:U$,wiggle:V$,positive:J9},eZ=function(n,l,c){var y=l.map(function(a){return a.props.dataKey}),w=Q9[c],P=N$().keys(y).value(function(a,R){return+Cs(a,R,0)}).order(xE).offset(w);return P(n)},tZ=function(n,l,c,y,w,P){if(!n)return null;var a=P?l.reverse():l,R={},z=a.reduce(function(V,W){var ie,ae=(ie=W.type)!==null&&ie!==void 0&&ie.defaultProps?Jo(Jo({},W.type.defaultProps),W.props):W.props,ee=ae.stackId,ne=ae.hide;if(ne)return V;var de=ae[c],xe=V[de]||{hasStack:!1,stackGroups:{}};if(za(ee)){var be=xe.stackGroups[ee]||{numericAxisId:c,cateAxisId:y,items:[]};be.items.push(W),xe.hasStack=!0,xe.stackGroups[ee]=be}else xe.stackGroups[Vy("_stackId_")]={numericAxisId:c,cateAxisId:y,items:[W]};return Jo(Jo({},V),{},pg({},de,xe))},R),$={};return Object.keys(z).reduce(function(V,W){var ie=z[W];if(ie.hasStack){var ae={};ie.stackGroups=Object.keys(ie.stackGroups).reduce(function(ee,ne){var de=ie.stackGroups[ne];return Jo(Jo({},ee),{},pg({},ne,{numericAxisId:c,cateAxisId:y,items:de.items,stackedData:eZ(n,de.items,w)}))},ae)}return Jo(Jo({},V),{},pg({},W,ie))},$)},YB=function(n,l){var c=l.realScaleType,y=l.type,w=l.tickCount,P=l.originalDomain,a=l.allowDecimals,R=c||l.scale;if(R!=="auto"&&R!=="linear")return null;if(w&&y==="number"&&P&&(P[0]==="auto"||P[1]==="auto")){var z=n.domain();if(!z.length)return null;var $=m9(z,w,a);return n.domain([Sx($),wx($)]),{niceTicks:$}}if(w&&y==="number"){var V=n.domain(),W=g9(V,w,a);return{niceTicks:W}}return null},Tz=function(n){var l=n.axis,c=n.ticks,y=n.offset,w=n.bandSize,P=n.entry,a=n.index;if(l.type==="category")return c[a]?c[a].coordinate+y:null;var R=Cs(P,l.dataKey,l.domain[a]);return xi(R)?null:l.scale(R)-w/2+y},rZ=function(n){var l=n.numericAxis,c=l.scale.domain();if(l.type==="number"){var y=Math.min(c[0],c[1]),w=Math.max(c[0],c[1]);return y<=0&&w>=0?0:w<0?w:y}return c[0]},nZ=function(n,l){var c,y=(c=n.type)!==null&&c!==void 0&&c.defaultProps?Jo(Jo({},n.type.defaultProps),n.props):n.props,w=y.stackId;if(za(w)){var P=l[w];if(P){var a=P.items.indexOf(n);return a>=0?P.stackedData[a]:null}}return null},iZ=function(n){return n.reduce(function(l,c){return[Sx(c.concat([l[0]]).filter(Rr)),wx(c.concat([l[1]]).filter(Rr))]},[1/0,-1/0])},JB=function(n,l,c){return Object.keys(n).reduce(function(y,w){var P=n[w],a=P.stackedData,R=a.reduce(function(z,$){var V=iZ($.slice(l,c+1));return[Math.min(z[0],V[0]),Math.max(z[1],V[1])]},[1/0,-1/0]);return[Math.min(R[0],y[0]),Math.max(R[1],y[1])]},[1/0,-1/0]).map(function(y){return y===1/0||y===-1/0?0:y})},Ez=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,Az=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,GE=function(n,l,c){if(Zn(n))return n(l,c);if(!Array.isArray(n))return l;var y=[];if(Rr(n[0]))y[0]=c?n[0]:Math.min(n[0],l[0]);else if(Ez.test(n[0])){var w=+Ez.exec(n[0])[1];y[0]=l[0]-w}else Zn(n[0])?y[0]=n[0](l[0]):y[0]=l[0];if(Rr(n[1]))y[1]=c?n[1]:Math.max(n[1],l[1]);else if(Az.test(n[1])){var P=+Az.exec(n[1])[1];y[1]=l[1]+P}else Zn(n[1])?y[1]=n[1](l[1]):y[1]=l[1];return y},R0=function(n,l,c){if(n&&n.scale&&n.scale.bandwidth){var y=n.scale.bandwidth();if(!c||y>0)return y}if(n&&l&&l.length>=2){for(var w=e2(l,function(V){return V.coordinate}),P=1/0,a=1,R=w.length;a<R;a++){var z=w[a],$=w[a-1];P=Math.min((z.coordinate||0)-($.coordinate||0),P)}return P===1/0?0:P}return c?void 0:0},Pz=function(n,l,c){return!n||!n.length||Tx(n,Yl(c,"type.defaultProps.domain"))?l:n},QB=function(n,l){var c=n.type.defaultProps?Jo(Jo({},n.type.defaultProps),n.props):n.props,y=c.dataKey,w=c.name,P=c.unit,a=c.formatter,R=c.tooltipType,z=c.chartType,$=c.hide;return Jo(Jo({},Vn(n,!1)),{},{dataKey:y,unit:P,formatter:a,name:w||y,color:P2(n),value:Cs(l,y),type:R,payload:l,chartType:z,hide:$})};function by(r){"@babel/helpers - typeof";return by=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},by(r)}function Iz(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Lf(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?Iz(Object(l),!0).forEach(function(c){eN(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):Iz(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function eN(r,n,l){return n=oZ(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function oZ(r){var n=aZ(r,"string");return by(n)=="symbol"?n:n+""}function aZ(r,n){if(by(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(by(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function sZ(r,n){return hZ(r)||cZ(r,n)||uZ(r,n)||lZ()}function lZ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uZ(r,n){if(r){if(typeof r=="string")return Cz(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return Cz(r,n)}}function Cz(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function cZ(r,n){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var c,y,w,P,a=[],R=!0,z=!1;try{if(w=(l=l.call(r)).next,n!==0)for(;!(R=(c=w.call(l)).done)&&(a.push(c.value),a.length!==n);R=!0);}catch($){z=!0,y=$}finally{try{if(!R&&l.return!=null&&(P=l.return(),Object(P)!==P))return}finally{if(z)throw y}}return a}}function hZ(r){if(Array.isArray(r))return r}var k0=Math.PI/180,fZ=function(n){return n*180/Math.PI},yo=function(n,l,c,y){return{x:n+Math.cos(-k0*y)*c,y:l+Math.sin(-k0*y)*c}},tN=function(n,l){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(n-(c.left||0)-(c.right||0)),Math.abs(l-(c.top||0)-(c.bottom||0)))/2},dZ=function(n,l,c,y,w){var P=n.width,a=n.height,R=n.startAngle,z=n.endAngle,$=Ks(n.cx,P,P/2),V=Ks(n.cy,a,a/2),W=tN(P,a,c),ie=Ks(n.innerRadius,W,0),ae=Ks(n.outerRadius,W,W*.8),ee=Object.keys(l);return ee.reduce(function(ne,de){var xe=l[de],be=xe.domain,ke=xe.reversed,he;if(xi(xe.range))y==="angleAxis"?he=[R,z]:y==="radiusAxis"&&(he=[ie,ae]),ke&&(he=[he[1],he[0]]);else{he=xe.range;var _e=he,ze=sZ(_e,2);R=ze[0],z=ze[1]}var Ne=XB(xe,w),rt=Ne.realScaleType,kt=Ne.scale;kt.domain(be).range(he),KB(kt);var He=YB(kt,Lf(Lf({},xe),{},{realScaleType:rt})),yt=Lf(Lf(Lf({},xe),He),{},{range:he,radius:ae,realScaleType:rt,scale:kt,cx:$,cy:V,innerRadius:ie,outerRadius:ae,startAngle:R,endAngle:z});return Lf(Lf({},ne),{},eN({},de,yt))},{})},pZ=function(n,l){var c=n.x,y=n.y,w=l.x,P=l.y;return Math.sqrt(Math.pow(c-w,2)+Math.pow(y-P,2))},mZ=function(n,l){var c=n.x,y=n.y,w=l.cx,P=l.cy,a=pZ({x:c,y},{x:w,y:P});if(a<=0)return{radius:a};var R=(c-w)/a,z=Math.acos(R);return y>P&&(z=2*Math.PI-z),{radius:a,angle:fZ(z),angleInRadian:z}},gZ=function(n){var l=n.startAngle,c=n.endAngle,y=Math.floor(l/360),w=Math.floor(c/360),P=Math.min(y,w);return{startAngle:l-P*360,endAngle:c-P*360}},_Z=function(n,l){var c=l.startAngle,y=l.endAngle,w=Math.floor(c/360),P=Math.floor(y/360),a=Math.min(w,P);return n+a*360},Mz=function(n,l){var c=n.x,y=n.y,w=mZ({x:c,y},l),P=w.radius,a=w.angle,R=l.innerRadius,z=l.outerRadius;if(P<R||P>z)return!1;if(P===0)return!0;var $=gZ(l),V=$.startAngle,W=$.endAngle,ie=a,ae;if(V<=W){for(;ie>W;)ie-=360;for(;ie<V;)ie+=360;ae=ie>=V&&ie<=W}else{for(;ie>V;)ie-=360;for(;ie<W;)ie+=360;ae=ie>=W&&ie<=V}return ae?Lf(Lf({},l),{},{radius:P,angle:_Z(ie,l)}):null},rN=function(n){return!ir.isValidElement(n)&&!Zn(n)&&typeof n!="boolean"?n.className:""};function wy(r){"@babel/helpers - typeof";return wy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},wy(r)}var yZ=["offset"];function vZ(r){return SZ(r)||wZ(r)||bZ(r)||xZ()}function xZ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bZ(r,n){if(r){if(typeof r=="string")return HE(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return HE(r,n)}}function wZ(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function SZ(r){if(Array.isArray(r))return HE(r)}function HE(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function TZ(r,n){if(r==null)return{};var l=EZ(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function EZ(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}function Oz(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Da(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?Oz(Object(l),!0).forEach(function(c){AZ(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):Oz(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function AZ(r,n,l){return n=PZ(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function PZ(r){var n=IZ(r,"string");return wy(n)=="symbol"?n:n+""}function IZ(r,n){if(wy(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(wy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function Sy(){return Sy=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},Sy.apply(this,arguments)}var CZ=function(n){var l=n.value,c=n.formatter,y=xi(n.children)?l:n.children;return Zn(c)?c(y):y},MZ=function(n,l){var c=Xs(l-n),y=Math.min(Math.abs(l-n),360);return c*y},OZ=function(n,l,c){var y=n.position,w=n.viewBox,P=n.offset,a=n.className,R=w,z=R.cx,$=R.cy,V=R.innerRadius,W=R.outerRadius,ie=R.startAngle,ae=R.endAngle,ee=R.clockWise,ne=(V+W)/2,de=MZ(ie,ae),xe=de>=0?1:-1,be,ke;y==="insideStart"?(be=ie+xe*P,ke=ee):y==="insideEnd"?(be=ae-xe*P,ke=!ee):y==="end"&&(be=ae+xe*P,ke=ee),ke=de<=0?ke:!ke;var he=yo(z,$,ne,be),_e=yo(z,$,ne,be+(ke?1:-1)*359),ze="M".concat(he.x,",").concat(he.y,`
    A`).concat(ne,",").concat(ne,",0,1,").concat(ke?0:1,`,
    `).concat(_e.x,",").concat(_e.y),Ne=xi(n.id)?Vy("recharts-radial-line-"):n.id;return ct.createElement("text",Sy({},c,{dominantBaseline:"central",className:ui("recharts-radial-bar-label",a)}),ct.createElement("defs",null,ct.createElement("path",{id:Ne,d:ze})),ct.createElement("textPath",{xlinkHref:"#".concat(Ne)},l))},RZ=function(n){var l=n.viewBox,c=n.offset,y=n.position,w=l,P=w.cx,a=w.cy,R=w.innerRadius,z=w.outerRadius,$=w.startAngle,V=w.endAngle,W=($+V)/2;if(y==="outside"){var ie=yo(P,a,z+c,W),ae=ie.x,ee=ie.y;return{x:ae,y:ee,textAnchor:ae>=P?"start":"end",verticalAnchor:"middle"}}if(y==="center")return{x:P,y:a,textAnchor:"middle",verticalAnchor:"middle"};if(y==="centerTop")return{x:P,y:a,textAnchor:"middle",verticalAnchor:"start"};if(y==="centerBottom")return{x:P,y:a,textAnchor:"middle",verticalAnchor:"end"};var ne=(R+z)/2,de=yo(P,a,ne,W),xe=de.x,be=de.y;return{x:xe,y:be,textAnchor:"middle",verticalAnchor:"middle"}},kZ=function(n){var l=n.viewBox,c=n.parentViewBox,y=n.offset,w=n.position,P=l,a=P.x,R=P.y,z=P.width,$=P.height,V=$>=0?1:-1,W=V*y,ie=V>0?"end":"start",ae=V>0?"start":"end",ee=z>=0?1:-1,ne=ee*y,de=ee>0?"end":"start",xe=ee>0?"start":"end";if(w==="top"){var be={x:a+z/2,y:R-V*y,textAnchor:"middle",verticalAnchor:ie};return Da(Da({},be),c?{height:Math.max(R-c.y,0),width:z}:{})}if(w==="bottom"){var ke={x:a+z/2,y:R+$+W,textAnchor:"middle",verticalAnchor:ae};return Da(Da({},ke),c?{height:Math.max(c.y+c.height-(R+$),0),width:z}:{})}if(w==="left"){var he={x:a-ne,y:R+$/2,textAnchor:de,verticalAnchor:"middle"};return Da(Da({},he),c?{width:Math.max(he.x-c.x,0),height:$}:{})}if(w==="right"){var _e={x:a+z+ne,y:R+$/2,textAnchor:xe,verticalAnchor:"middle"};return Da(Da({},_e),c?{width:Math.max(c.x+c.width-_e.x,0),height:$}:{})}var ze=c?{width:z,height:$}:{};return w==="insideLeft"?Da({x:a+ne,y:R+$/2,textAnchor:xe,verticalAnchor:"middle"},ze):w==="insideRight"?Da({x:a+z-ne,y:R+$/2,textAnchor:de,verticalAnchor:"middle"},ze):w==="insideTop"?Da({x:a+z/2,y:R+W,textAnchor:"middle",verticalAnchor:ae},ze):w==="insideBottom"?Da({x:a+z/2,y:R+$-W,textAnchor:"middle",verticalAnchor:ie},ze):w==="insideTopLeft"?Da({x:a+ne,y:R+W,textAnchor:xe,verticalAnchor:ae},ze):w==="insideTopRight"?Da({x:a+z-ne,y:R+W,textAnchor:de,verticalAnchor:ae},ze):w==="insideBottomLeft"?Da({x:a+ne,y:R+$-W,textAnchor:xe,verticalAnchor:ie},ze):w==="insideBottomRight"?Da({x:a+z-ne,y:R+$-W,textAnchor:de,verticalAnchor:ie},ze):$g(w)&&(Rr(w.x)||im(w.x))&&(Rr(w.y)||im(w.y))?Da({x:a+Ks(w.x,z),y:R+Ks(w.y,$),textAnchor:"end",verticalAnchor:"end"},ze):Da({x:a+z/2,y:R+$/2,textAnchor:"middle",verticalAnchor:"middle"},ze)},DZ=function(n){return"cx"in n&&Rr(n.cx)};function Qa(r){var n=r.offset,l=n===void 0?5:n,c=TZ(r,yZ),y=Da({offset:l},c),w=y.viewBox,P=y.position,a=y.value,R=y.children,z=y.content,$=y.className,V=$===void 0?"":$,W=y.textBreakAll;if(!w||xi(a)&&xi(R)&&!ir.isValidElement(z)&&!Zn(z))return null;if(ir.isValidElement(z))return ir.cloneElement(z,y);var ie;if(Zn(z)){if(ie=ir.createElement(z,y),ir.isValidElement(ie))return ie}else ie=CZ(y);var ae=DZ(w),ee=Vn(y,!0);if(ae&&(P==="insideStart"||P==="insideEnd"||P==="end"))return OZ(y,ie,ee);var ne=ae?RZ(y):kZ(y);return ct.createElement(fm,Sy({className:ui("recharts-label",V)},ee,ne,{breakAll:W}),ie)}Qa.displayName="Label";var nN=function(n){var l=n.cx,c=n.cy,y=n.angle,w=n.startAngle,P=n.endAngle,a=n.r,R=n.radius,z=n.innerRadius,$=n.outerRadius,V=n.x,W=n.y,ie=n.top,ae=n.left,ee=n.width,ne=n.height,de=n.clockWise,xe=n.labelViewBox;if(xe)return xe;if(Rr(ee)&&Rr(ne)){if(Rr(V)&&Rr(W))return{x:V,y:W,width:ee,height:ne};if(Rr(ie)&&Rr(ae))return{x:ie,y:ae,width:ee,height:ne}}return Rr(V)&&Rr(W)?{x:V,y:W,width:0,height:0}:Rr(l)&&Rr(c)?{cx:l,cy:c,startAngle:w||y||0,endAngle:P||y||0,innerRadius:z||0,outerRadius:$||R||a||0,clockWise:de}:n.viewBox?n.viewBox:{}},zZ=function(n,l){return n?n===!0?ct.createElement(Qa,{key:"label-implicit",viewBox:l}):za(n)?ct.createElement(Qa,{key:"label-implicit",viewBox:l,value:n}):ir.isValidElement(n)?n.type===Qa?ir.cloneElement(n,{key:"label-implicit",viewBox:l}):ct.createElement(Qa,{key:"label-implicit",content:n,viewBox:l}):Zn(n)?ct.createElement(Qa,{key:"label-implicit",content:n,viewBox:l}):$g(n)?ct.createElement(Qa,Sy({viewBox:l},n,{key:"label-implicit"})):null:null},LZ=function(n,l){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!n||!n.children&&c&&!n.label)return null;var y=n.children,w=nN(n),P=Vu(y,Qa).map(function(R,z){return ir.cloneElement(R,{viewBox:l||w,key:"label-".concat(z)})});if(!c)return P;var a=zZ(n.label,l||w);return[a].concat(vZ(P))};Qa.parseViewBox=nN;Qa.renderCallByParent=LZ;var CT,Rz;function FZ(){if(Rz)return CT;Rz=1;function r(n){var l=n==null?0:n.length;return l?n[l-1]:void 0}return CT=r,CT}var BZ=FZ();const NZ=Xi(BZ);function Ty(r){"@babel/helpers - typeof";return Ty=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ty(r)}var jZ=["valueAccessor"],UZ=["data","dataKey","clockWise","id","textBreakAll"];function VZ(r){return HZ(r)||GZ(r)||qZ(r)||$Z()}function $Z(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function qZ(r,n){if(r){if(typeof r=="string")return WE(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return WE(r,n)}}function GZ(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function HZ(r){if(Array.isArray(r))return WE(r)}function WE(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function D0(){return D0=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},D0.apply(this,arguments)}function kz(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Dz(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?kz(Object(l),!0).forEach(function(c){WZ(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):kz(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function WZ(r,n,l){return n=ZZ(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function ZZ(r){var n=XZ(r,"string");return Ty(n)=="symbol"?n:n+""}function XZ(r,n){if(Ty(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Ty(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function zz(r,n){if(r==null)return{};var l=KZ(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function KZ(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}var YZ=function(n){return Array.isArray(n.value)?NZ(n.value):n.value};function hp(r){var n=r.valueAccessor,l=n===void 0?YZ:n,c=zz(r,jZ),y=c.data,w=c.dataKey,P=c.clockWise,a=c.id,R=c.textBreakAll,z=zz(c,UZ);return!y||!y.length?null:ct.createElement(eo,{className:"recharts-label-list"},y.map(function($,V){var W=xi(w)?l($,V):Cs($&&$.payload,w),ie=xi(a)?{}:{id:"".concat(a,"-").concat(V)};return ct.createElement(Qa,D0({},Vn($,!0),z,ie,{parentViewBox:$.parentViewBox,value:W,textBreakAll:R,viewBox:Qa.parseViewBox(xi(P)?$:Dz(Dz({},$),{},{clockWise:P})),key:"label-".concat(V),index:V}))}))}hp.displayName="LabelList";function JZ(r,n){return r?r===!0?ct.createElement(hp,{key:"labelList-implicit",data:n}):ct.isValidElement(r)||Zn(r)?ct.createElement(hp,{key:"labelList-implicit",data:n,content:r}):$g(r)?ct.createElement(hp,D0({data:n},r,{key:"labelList-implicit"})):null:null}function QZ(r,n){var l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!r||!r.children&&l&&!r.label)return null;var c=r.children,y=Vu(c,hp).map(function(P,a){return ir.cloneElement(P,{data:n,key:"labelList-".concat(a)})});if(!l)return y;var w=JZ(r.label,n);return[w].concat(VZ(y))}hp.renderCallByParent=QZ;function Ey(r){"@babel/helpers - typeof";return Ey=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ey(r)}function ZE(){return ZE=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},ZE.apply(this,arguments)}function Lz(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Fz(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?Lz(Object(l),!0).forEach(function(c){eX(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):Lz(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function eX(r,n,l){return n=tX(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function tX(r){var n=rX(r,"string");return Ey(n)=="symbol"?n:n+""}function rX(r,n){if(Ey(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Ey(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}var nX=function(n,l){var c=Xs(l-n),y=Math.min(Math.abs(l-n),359.999);return c*y},Qv=function(n){var l=n.cx,c=n.cy,y=n.radius,w=n.angle,P=n.sign,a=n.isExternal,R=n.cornerRadius,z=n.cornerIsExternal,$=R*(a?1:-1)+y,V=Math.asin(R/$)/k0,W=z?w:w+P*V,ie=yo(l,c,$,W),ae=yo(l,c,y,W),ee=z?w-P*V:w,ne=yo(l,c,$*Math.cos(V*k0),ee);return{center:ie,circleTangency:ae,lineTangency:ne,theta:V}},iN=function(n){var l=n.cx,c=n.cy,y=n.innerRadius,w=n.outerRadius,P=n.startAngle,a=n.endAngle,R=nX(P,a),z=P+R,$=yo(l,c,w,P),V=yo(l,c,w,z),W="M ".concat($.x,",").concat($.y,`
    A `).concat(w,",").concat(w,`,0,
    `).concat(+(Math.abs(R)>180),",").concat(+(P>z),`,
    `).concat(V.x,",").concat(V.y,`
  `);if(y>0){var ie=yo(l,c,y,P),ae=yo(l,c,y,z);W+="L ".concat(ae.x,",").concat(ae.y,`
            A `).concat(y,",").concat(y,`,0,
            `).concat(+(Math.abs(R)>180),",").concat(+(P<=z),`,
            `).concat(ie.x,",").concat(ie.y," Z")}else W+="L ".concat(l,",").concat(c," Z");return W},iX=function(n){var l=n.cx,c=n.cy,y=n.innerRadius,w=n.outerRadius,P=n.cornerRadius,a=n.forceCornerRadius,R=n.cornerIsExternal,z=n.startAngle,$=n.endAngle,V=Xs($-z),W=Qv({cx:l,cy:c,radius:w,angle:z,sign:V,cornerRadius:P,cornerIsExternal:R}),ie=W.circleTangency,ae=W.lineTangency,ee=W.theta,ne=Qv({cx:l,cy:c,radius:w,angle:$,sign:-V,cornerRadius:P,cornerIsExternal:R}),de=ne.circleTangency,xe=ne.lineTangency,be=ne.theta,ke=R?Math.abs(z-$):Math.abs(z-$)-ee-be;if(ke<0)return a?"M ".concat(ae.x,",").concat(ae.y,`
        a`).concat(P,",").concat(P,",0,0,1,").concat(P*2,`,0
        a`).concat(P,",").concat(P,",0,0,1,").concat(-P*2,`,0
      `):iN({cx:l,cy:c,innerRadius:y,outerRadius:w,startAngle:z,endAngle:$});var he="M ".concat(ae.x,",").concat(ae.y,`
    A`).concat(P,",").concat(P,",0,0,").concat(+(V<0),",").concat(ie.x,",").concat(ie.y,`
    A`).concat(w,",").concat(w,",0,").concat(+(ke>180),",").concat(+(V<0),",").concat(de.x,",").concat(de.y,`
    A`).concat(P,",").concat(P,",0,0,").concat(+(V<0),",").concat(xe.x,",").concat(xe.y,`
  `);if(y>0){var _e=Qv({cx:l,cy:c,radius:y,angle:z,sign:V,isExternal:!0,cornerRadius:P,cornerIsExternal:R}),ze=_e.circleTangency,Ne=_e.lineTangency,rt=_e.theta,kt=Qv({cx:l,cy:c,radius:y,angle:$,sign:-V,isExternal:!0,cornerRadius:P,cornerIsExternal:R}),He=kt.circleTangency,yt=kt.lineTangency,gt=kt.theta,Pt=R?Math.abs(z-$):Math.abs(z-$)-rt-gt;if(Pt<0&&P===0)return"".concat(he,"L").concat(l,",").concat(c,"Z");he+="L".concat(yt.x,",").concat(yt.y,`
      A`).concat(P,",").concat(P,",0,0,").concat(+(V<0),",").concat(He.x,",").concat(He.y,`
      A`).concat(y,",").concat(y,",0,").concat(+(Pt>180),",").concat(+(V>0),",").concat(ze.x,",").concat(ze.y,`
      A`).concat(P,",").concat(P,",0,0,").concat(+(V<0),",").concat(Ne.x,",").concat(Ne.y,"Z")}else he+="L".concat(l,",").concat(c,"Z");return he},oX={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},oN=function(n){var l=Fz(Fz({},oX),n),c=l.cx,y=l.cy,w=l.innerRadius,P=l.outerRadius,a=l.cornerRadius,R=l.forceCornerRadius,z=l.cornerIsExternal,$=l.startAngle,V=l.endAngle,W=l.className;if(P<w||$===V)return null;var ie=ui("recharts-sector",W),ae=P-w,ee=Ks(a,ae,0,!0),ne;return ee>0&&Math.abs($-V)<360?ne=iX({cx:c,cy:y,innerRadius:w,outerRadius:P,cornerRadius:Math.min(ee,ae/2),forceCornerRadius:R,cornerIsExternal:z,startAngle:$,endAngle:V}):ne=iN({cx:c,cy:y,innerRadius:w,outerRadius:P,startAngle:$,endAngle:V}),ct.createElement("path",ZE({},Vn(l,!0),{className:ie,d:ne,role:"img"}))};function Ay(r){"@babel/helpers - typeof";return Ay=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ay(r)}function XE(){return XE=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},XE.apply(this,arguments)}function Bz(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Nz(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?Bz(Object(l),!0).forEach(function(c){aX(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):Bz(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function aX(r,n,l){return n=sX(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function sX(r){var n=lX(r,"string");return Ay(n)=="symbol"?n:n+""}function lX(r,n){if(Ay(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Ay(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}var jz={curveBasisClosed:I$,curveBasisOpen:C$,curveBasis:P$,curveBumpX:d$,curveBumpY:p$,curveLinearClosed:M$,curveLinear:cx,curveMonotoneX:O$,curveMonotoneY:R$,curveNatural:k$,curveStep:D$,curveStepAfter:L$,curveStepBefore:z$},e0=function(n){return n.x===+n.x&&n.y===+n.y},H_=function(n){return n.x},W_=function(n){return n.y},uX=function(n,l){if(Zn(n))return n;var c="curve".concat(lx(n));return(c==="curveMonotone"||c==="curveBump")&&l?jz["".concat(c).concat(l==="vertical"?"Y":"X")]:jz[c]||cx},cX=function(n){var l=n.type,c=l===void 0?"linear":l,y=n.points,w=y===void 0?[]:y,P=n.baseLine,a=n.layout,R=n.connectNulls,z=R===void 0?!1:R,$=uX(c,a),V=z?w.filter(function(ee){return e0(ee)}):w,W;if(Array.isArray(P)){var ie=z?P.filter(function(ee){return e0(ee)}):P,ae=V.map(function(ee,ne){return Nz(Nz({},ee),{},{base:ie[ne]})});return a==="vertical"?W=Gv().y(W_).x1(H_).x0(function(ee){return ee.base.x}):W=Gv().x(H_).y1(W_).y0(function(ee){return ee.base.y}),W.defined(e0).curve($),W(ae)}return a==="vertical"&&Rr(P)?W=Gv().y(W_).x1(H_).x0(P):Rr(P)?W=Gv().x(H_).y1(W_).y0(P):W=nF().x(H_).y(W_),W.defined(e0).curve($),W(V)},KE=function(n){var l=n.className,c=n.points,y=n.path,w=n.pathRef;if((!c||!c.length)&&!y)return null;var P=c&&c.length?cX(n):y;return ir.createElement("path",XE({},Vn(n,!1),l0(n),{className:ui("recharts-curve",l),d:P,ref:w}))},MT={exports:{}},OT,Uz;function hX(){if(Uz)return OT;Uz=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return OT=r,OT}var RT,Vz;function fX(){if(Vz)return RT;Vz=1;var r=hX();function n(){}function l(){}return l.resetWarningCache=n,RT=function(){function c(P,a,R,z,$,V){if(V!==r){var W=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw W.name="Invariant Violation",W}}c.isRequired=c;function y(){return c}var w={array:c,bigint:c,bool:c,func:c,number:c,object:c,string:c,symbol:c,any:c,arrayOf:y,element:c,elementType:c,instanceOf:y,node:c,objectOf:y,oneOf:y,oneOfType:y,shape:y,exact:y,checkPropTypes:l,resetWarningCache:n};return w.PropTypes=w,w},RT}var $z;function dX(){return $z||($z=1,MT.exports=fX()()),MT.exports}var pX=dX();const Zi=Xi(pX);var mX=Object.getOwnPropertyNames,gX=Object.getOwnPropertySymbols,_X=Object.prototype.hasOwnProperty;function qz(r,n){return function(c,y,w){return r(c,y,w)&&n(c,y,w)}}function t0(r){return function(l,c,y){if(!l||!c||typeof l!="object"||typeof c!="object")return r(l,c,y);var w=y.cache,P=w.get(l),a=w.get(c);if(P&&a)return P===c&&a===l;w.set(l,c),w.set(c,l);var R=r(l,c,y);return w.delete(l),w.delete(c),R}}function Gz(r){return mX(r).concat(gX(r))}var yX=Object.hasOwn||(function(r,n){return _X.call(r,n)});function xm(r,n){return r===n||!r&&!n&&r!==r&&n!==n}var vX="__v",xX="__o",bX="_owner",Hz=Object.getOwnPropertyDescriptor,Wz=Object.keys;function wX(r,n,l){var c=r.length;if(n.length!==c)return!1;for(;c-- >0;)if(!l.equals(r[c],n[c],c,c,r,n,l))return!1;return!0}function SX(r,n){return xm(r.getTime(),n.getTime())}function TX(r,n){return r.name===n.name&&r.message===n.message&&r.cause===n.cause&&r.stack===n.stack}function EX(r,n){return r===n}function Zz(r,n,l){var c=r.size;if(c!==n.size)return!1;if(!c)return!0;for(var y=new Array(c),w=r.entries(),P,a,R=0;(P=w.next())&&!P.done;){for(var z=n.entries(),$=!1,V=0;(a=z.next())&&!a.done;){if(y[V]){V++;continue}var W=P.value,ie=a.value;if(l.equals(W[0],ie[0],R,V,r,n,l)&&l.equals(W[1],ie[1],W[0],ie[0],r,n,l)){$=y[V]=!0;break}V++}if(!$)return!1;R++}return!0}var AX=xm;function PX(r,n,l){var c=Wz(r),y=c.length;if(Wz(n).length!==y)return!1;for(;y-- >0;)if(!aN(r,n,l,c[y]))return!1;return!0}function Z_(r,n,l){var c=Gz(r),y=c.length;if(Gz(n).length!==y)return!1;for(var w,P,a;y-- >0;)if(w=c[y],!aN(r,n,l,w)||(P=Hz(r,w),a=Hz(n,w),(P||a)&&(!P||!a||P.configurable!==a.configurable||P.enumerable!==a.enumerable||P.writable!==a.writable)))return!1;return!0}function IX(r,n){return xm(r.valueOf(),n.valueOf())}function CX(r,n){return r.source===n.source&&r.flags===n.flags}function Xz(r,n,l){var c=r.size;if(c!==n.size)return!1;if(!c)return!0;for(var y=new Array(c),w=r.values(),P,a;(P=w.next())&&!P.done;){for(var R=n.values(),z=!1,$=0;(a=R.next())&&!a.done;){if(!y[$]&&l.equals(P.value,a.value,P.value,a.value,r,n,l)){z=y[$]=!0;break}$++}if(!z)return!1}return!0}function MX(r,n){var l=r.length;if(n.length!==l)return!1;for(;l-- >0;)if(r[l]!==n[l])return!1;return!0}function OX(r,n){return r.hostname===n.hostname&&r.pathname===n.pathname&&r.protocol===n.protocol&&r.port===n.port&&r.hash===n.hash&&r.username===n.username&&r.password===n.password}function aN(r,n,l,c){return(c===bX||c===xX||c===vX)&&(r.$$typeof||n.$$typeof)?!0:yX(n,c)&&l.equals(r[c],n[c],c,c,r,n,l)}var RX="[object Arguments]",kX="[object Boolean]",DX="[object Date]",zX="[object Error]",LX="[object Map]",FX="[object Number]",BX="[object Object]",NX="[object RegExp]",jX="[object Set]",UX="[object String]",VX="[object URL]",$X=Array.isArray,Kz=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,Yz=Object.assign,qX=Object.prototype.toString.call.bind(Object.prototype.toString);function GX(r){var n=r.areArraysEqual,l=r.areDatesEqual,c=r.areErrorsEqual,y=r.areFunctionsEqual,w=r.areMapsEqual,P=r.areNumbersEqual,a=r.areObjectsEqual,R=r.arePrimitiveWrappersEqual,z=r.areRegExpsEqual,$=r.areSetsEqual,V=r.areTypedArraysEqual,W=r.areUrlsEqual;return function(ae,ee,ne){if(ae===ee)return!0;if(ae==null||ee==null)return!1;var de=typeof ae;if(de!==typeof ee)return!1;if(de!=="object")return de==="number"?P(ae,ee,ne):de==="function"?y(ae,ee,ne):!1;var xe=ae.constructor;if(xe!==ee.constructor)return!1;if(xe===Object)return a(ae,ee,ne);if($X(ae))return n(ae,ee,ne);if(Kz!=null&&Kz(ae))return V(ae,ee,ne);if(xe===Date)return l(ae,ee,ne);if(xe===RegExp)return z(ae,ee,ne);if(xe===Map)return w(ae,ee,ne);if(xe===Set)return $(ae,ee,ne);var be=qX(ae);return be===DX?l(ae,ee,ne):be===NX?z(ae,ee,ne):be===LX?w(ae,ee,ne):be===jX?$(ae,ee,ne):be===BX?typeof ae.then!="function"&&typeof ee.then!="function"&&a(ae,ee,ne):be===VX?W(ae,ee,ne):be===zX?c(ae,ee,ne):be===RX?a(ae,ee,ne):be===kX||be===FX||be===UX?R(ae,ee,ne):!1}}function HX(r){var n=r.circular,l=r.createCustomConfig,c=r.strict,y={areArraysEqual:c?Z_:wX,areDatesEqual:SX,areErrorsEqual:TX,areFunctionsEqual:EX,areMapsEqual:c?qz(Zz,Z_):Zz,areNumbersEqual:AX,areObjectsEqual:c?Z_:PX,arePrimitiveWrappersEqual:IX,areRegExpsEqual:CX,areSetsEqual:c?qz(Xz,Z_):Xz,areTypedArraysEqual:c?Z_:MX,areUrlsEqual:OX};if(l&&(y=Yz({},y,l(y))),n){var w=t0(y.areArraysEqual),P=t0(y.areMapsEqual),a=t0(y.areObjectsEqual),R=t0(y.areSetsEqual);y=Yz({},y,{areArraysEqual:w,areMapsEqual:P,areObjectsEqual:a,areSetsEqual:R})}return y}function WX(r){return function(n,l,c,y,w,P,a){return r(n,l,a)}}function ZX(r){var n=r.circular,l=r.comparator,c=r.createState,y=r.equals,w=r.strict;if(c)return function(R,z){var $=c(),V=$.cache,W=V===void 0?n?new WeakMap:void 0:V,ie=$.meta;return l(R,z,{cache:W,equals:y,meta:ie,strict:w})};if(n)return function(R,z){return l(R,z,{cache:new WeakMap,equals:y,meta:void 0,strict:w})};var P={cache:void 0,equals:y,meta:void 0,strict:w};return function(R,z){return l(R,z,P)}}var XX=mp();mp({strict:!0});mp({circular:!0});mp({circular:!0,strict:!0});mp({createInternalComparator:function(){return xm}});mp({strict:!0,createInternalComparator:function(){return xm}});mp({circular:!0,createInternalComparator:function(){return xm}});mp({circular:!0,createInternalComparator:function(){return xm},strict:!0});function mp(r){r===void 0&&(r={});var n=r.circular,l=n===void 0?!1:n,c=r.createInternalComparator,y=r.createState,w=r.strict,P=w===void 0?!1:w,a=HX(r),R=GX(a),z=c?c(R):WX(R);return ZX({circular:l,comparator:R,createState:y,equals:z,strict:P})}function KX(r){typeof requestAnimationFrame<"u"&&requestAnimationFrame(r)}function Jz(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,l=-1,c=function y(w){l<0&&(l=w),w-l>n?(r(w),l=-1):KX(y)};requestAnimationFrame(c)}function YE(r){"@babel/helpers - typeof";return YE=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},YE(r)}function YX(r){return tK(r)||eK(r)||QX(r)||JX()}function JX(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QX(r,n){if(r){if(typeof r=="string")return Qz(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return Qz(r,n)}}function Qz(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function eK(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function tK(r){if(Array.isArray(r))return r}function rK(){var r={},n=function(){return null},l=!1,c=function y(w){if(!l){if(Array.isArray(w)){if(!w.length)return;var P=w,a=YX(P),R=a[0],z=a.slice(1);if(typeof R=="number"){Jz(y.bind(null,z),R);return}y(R),Jz(y.bind(null,z));return}YE(w)==="object"&&(r=w,n(r)),typeof w=="function"&&w()}};return{stop:function(){l=!0},start:function(w){l=!1,c(w)},subscribe:function(w){return n=w,function(){n=function(){return null}}}}}function Py(r){"@babel/helpers - typeof";return Py=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Py(r)}function eL(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function tL(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?eL(Object(l),!0).forEach(function(c){sN(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):eL(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function sN(r,n,l){return n=nK(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function nK(r){var n=iK(r,"string");return Py(n)==="symbol"?n:String(n)}function iK(r,n){if(Py(r)!=="object"||r===null)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Py(c)!=="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}var oK=function(n,l){return[Object.keys(n),Object.keys(l)].reduce(function(c,y){return c.filter(function(w){return y.includes(w)})})},aK=function(n){return n},sK=function(n){return n.replace(/([A-Z])/g,function(l){return"-".concat(l.toLowerCase())})},ry=function(n,l){return Object.keys(l).reduce(function(c,y){return tL(tL({},c),{},sN({},y,n(y,l[y])))},{})},rL=function(n,l,c){return n.map(function(y){return"".concat(sK(y)," ").concat(l,"ms ").concat(c)}).join(",")};function lK(r,n){return hK(r)||cK(r,n)||lN(r,n)||uK()}function uK(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cK(r,n){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var c,y,w,P,a=[],R=!0,z=!1;try{if(w=(l=l.call(r)).next,n!==0)for(;!(R=(c=w.call(l)).done)&&(a.push(c.value),a.length!==n);R=!0);}catch($){z=!0,y=$}finally{try{if(!R&&l.return!=null&&(P=l.return(),Object(P)!==P))return}finally{if(z)throw y}}return a}}function hK(r){if(Array.isArray(r))return r}function fK(r){return mK(r)||pK(r)||lN(r)||dK()}function dK(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lN(r,n){if(r){if(typeof r=="string")return JE(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return JE(r,n)}}function pK(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function mK(r){if(Array.isArray(r))return JE(r)}function JE(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}var z0=1e-4,uN=function(n,l){return[0,3*n,3*l-6*n,3*n-3*l+1]},cN=function(n,l){return n.map(function(c,y){return c*Math.pow(l,y)}).reduce(function(c,y){return c+y})},nL=function(n,l){return function(c){var y=uN(n,l);return cN(y,c)}},gK=function(n,l){return function(c){var y=uN(n,l),w=[].concat(fK(y.map(function(P,a){return P*a}).slice(1)),[0]);return cN(w,c)}},iL=function(){for(var n=arguments.length,l=new Array(n),c=0;c<n;c++)l[c]=arguments[c];var y=l[0],w=l[1],P=l[2],a=l[3];if(l.length===1)switch(l[0]){case"linear":y=0,w=0,P=1,a=1;break;case"ease":y=.25,w=.1,P=.25,a=1;break;case"ease-in":y=.42,w=0,P=1,a=1;break;case"ease-out":y=.42,w=0,P=.58,a=1;break;case"ease-in-out":y=0,w=0,P=.58,a=1;break;default:{var R=l[0].split("(");if(R[0]==="cubic-bezier"&&R[1].split(")")[0].split(",").length===4){var z=R[1].split(")")[0].split(",").map(function(ne){return parseFloat(ne)}),$=lK(z,4);y=$[0],w=$[1],P=$[2],a=$[3]}}}var V=nL(y,P),W=nL(w,a),ie=gK(y,P),ae=function(de){return de>1?1:de<0?0:de},ee=function(de){for(var xe=de>1?1:de,be=xe,ke=0;ke<8;++ke){var he=V(be)-xe,_e=ie(be);if(Math.abs(he-xe)<z0||_e<z0)return W(be);be=ae(be-he/_e)}return W(be)};return ee.isStepper=!1,ee},_K=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=n.stiff,c=l===void 0?100:l,y=n.damping,w=y===void 0?8:y,P=n.dt,a=P===void 0?17:P,R=function($,V,W){var ie=-($-V)*c,ae=W*w,ee=W+(ie-ae)*a/1e3,ne=W*a/1e3+$;return Math.abs(ne-V)<z0&&Math.abs(ee)<z0?[V,0]:[ne,ee]};return R.isStepper=!0,R.dt=a,R},yK=function(){for(var n=arguments.length,l=new Array(n),c=0;c<n;c++)l[c]=arguments[c];var y=l[0];if(typeof y=="string")switch(y){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return iL(y);case"spring":return _K();default:if(y.split("(")[0]==="cubic-bezier")return iL(y)}return typeof y=="function"?y:null};function Iy(r){"@babel/helpers - typeof";return Iy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Iy(r)}function oL(r){return bK(r)||xK(r)||hN(r)||vK()}function vK(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xK(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function bK(r){if(Array.isArray(r))return eA(r)}function aL(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function fs(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?aL(Object(l),!0).forEach(function(c){QE(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):aL(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function QE(r,n,l){return n=wK(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function wK(r){var n=SK(r,"string");return Iy(n)==="symbol"?n:String(n)}function SK(r,n){if(Iy(r)!=="object"||r===null)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Iy(c)!=="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function TK(r,n){return PK(r)||AK(r,n)||hN(r,n)||EK()}function EK(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function hN(r,n){if(r){if(typeof r=="string")return eA(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return eA(r,n)}}function eA(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function AK(r,n){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var c,y,w,P,a=[],R=!0,z=!1;try{if(w=(l=l.call(r)).next,n!==0)for(;!(R=(c=w.call(l)).done)&&(a.push(c.value),a.length!==n);R=!0);}catch($){z=!0,y=$}finally{try{if(!R&&l.return!=null&&(P=l.return(),Object(P)!==P))return}finally{if(z)throw y}}return a}}function PK(r){if(Array.isArray(r))return r}var L0=function(n,l,c){return n+(l-n)*c},tA=function(n){var l=n.from,c=n.to;return l!==c},IK=function r(n,l,c){var y=ry(function(w,P){if(tA(P)){var a=n(P.from,P.to,P.velocity),R=TK(a,2),z=R[0],$=R[1];return fs(fs({},P),{},{from:z,velocity:$})}return P},l);return c<1?ry(function(w,P){return tA(P)?fs(fs({},P),{},{velocity:L0(P.velocity,y[w].velocity,c),from:L0(P.from,y[w].from,c)}):P},l):r(n,y,c-1)};const CK=(function(r,n,l,c,y){var w=oK(r,n),P=w.reduce(function(ne,de){return fs(fs({},ne),{},QE({},de,[r[de],n[de]]))},{}),a=w.reduce(function(ne,de){return fs(fs({},ne),{},QE({},de,{from:r[de],velocity:0,to:n[de]}))},{}),R=-1,z,$,V=function(){return null},W=function(){return ry(function(de,xe){return xe.from},a)},ie=function(){return!Object.values(a).filter(tA).length},ae=function(de){z||(z=de);var xe=de-z,be=xe/l.dt;a=IK(l,a,be),y(fs(fs(fs({},r),n),W())),z=de,ie()||(R=requestAnimationFrame(V))},ee=function(de){$||($=de);var xe=(de-$)/c,be=ry(function(he,_e){return L0.apply(void 0,oL(_e).concat([l(xe)]))},P);if(y(fs(fs(fs({},r),n),be)),xe<1)R=requestAnimationFrame(V);else{var ke=ry(function(he,_e){return L0.apply(void 0,oL(_e).concat([l(1)]))},P);y(fs(fs(fs({},r),n),ke))}};return V=l.isStepper?ae:ee,function(){return requestAnimationFrame(V),function(){cancelAnimationFrame(R)}}});function Eg(r){"@babel/helpers - typeof";return Eg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Eg(r)}var MK=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function OK(r,n){if(r==null)return{};var l=RK(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function RK(r,n){if(r==null)return{};var l={},c=Object.keys(r),y,w;for(w=0;w<c.length;w++)y=c[w],!(n.indexOf(y)>=0)&&(l[y]=r[y]);return l}function kT(r){return LK(r)||zK(r)||DK(r)||kK()}function kK(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DK(r,n){if(r){if(typeof r=="string")return rA(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return rA(r,n)}}function zK(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function LK(r){if(Array.isArray(r))return rA(r)}function rA(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function sL(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Fc(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?sL(Object(l),!0).forEach(function(c){J_(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):sL(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function J_(r,n,l){return n=fN(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function FK(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function BK(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,fN(c.key),c)}}function NK(r,n,l){return n&&BK(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function fN(r){var n=jK(r,"string");return Eg(n)==="symbol"?n:String(n)}function jK(r,n){if(Eg(r)!=="object"||r===null)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Eg(c)!=="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function UK(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&nA(r,n)}function nA(r,n){return nA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},nA(r,n)}function VK(r){var n=$K();return function(){var c=F0(r),y;if(n){var w=F0(this).constructor;y=Reflect.construct(c,arguments,w)}else y=c.apply(this,arguments);return iA(this,y)}}function iA(r,n){if(n&&(Eg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return oA(r)}function oA(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function $K(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function F0(r){return F0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},F0(r)}var Gf=(function(r){UK(l,r);var n=VK(l);function l(c,y){var w;FK(this,l),w=n.call(this,c,y);var P=w.props,a=P.isActive,R=P.attributeName,z=P.from,$=P.to,V=P.steps,W=P.children,ie=P.duration;if(w.handleStyleChange=w.handleStyleChange.bind(oA(w)),w.changeStyle=w.changeStyle.bind(oA(w)),!a||ie<=0)return w.state={style:{}},typeof W=="function"&&(w.state={style:$}),iA(w);if(V&&V.length)w.state={style:V[0].style};else if(z){if(typeof W=="function")return w.state={style:z},iA(w);w.state={style:R?J_({},R,z):z}}else w.state={style:{}};return w}return NK(l,[{key:"componentDidMount",value:function(){var y=this.props,w=y.isActive,P=y.canBegin;this.mounted=!0,!(!w||!P)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(y){var w=this.props,P=w.isActive,a=w.canBegin,R=w.attributeName,z=w.shouldReAnimate,$=w.to,V=w.from,W=this.state.style;if(a){if(!P){var ie={style:R?J_({},R,$):$};this.state&&W&&(R&&W[R]!==$||!R&&W!==$)&&this.setState(ie);return}if(!(XX(y.to,$)&&y.canBegin&&y.isActive)){var ae=!y.canBegin||!y.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var ee=ae||z?V:y.to;if(this.state&&W){var ne={style:R?J_({},R,ee):ee};(R&&W[R]!==ee||!R&&W!==ee)&&this.setState(ne)}this.runAnimation(Fc(Fc({},this.props),{},{from:ee,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var y=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),y&&y()}},{key:"handleStyleChange",value:function(y){this.changeStyle(y)}},{key:"changeStyle",value:function(y){this.mounted&&this.setState({style:y})}},{key:"runJSAnimation",value:function(y){var w=this,P=y.from,a=y.to,R=y.duration,z=y.easing,$=y.begin,V=y.onAnimationEnd,W=y.onAnimationStart,ie=CK(P,a,yK(z),R,this.changeStyle),ae=function(){w.stopJSAnimation=ie()};this.manager.start([W,$,ae,R,V])}},{key:"runStepAnimation",value:function(y){var w=this,P=y.steps,a=y.begin,R=y.onAnimationStart,z=P[0],$=z.style,V=z.duration,W=V===void 0?0:V,ie=function(ee,ne,de){if(de===0)return ee;var xe=ne.duration,be=ne.easing,ke=be===void 0?"ease":be,he=ne.style,_e=ne.properties,ze=ne.onAnimationEnd,Ne=de>0?P[de-1]:ne,rt=_e||Object.keys(he);if(typeof ke=="function"||ke==="spring")return[].concat(kT(ee),[w.runJSAnimation.bind(w,{from:Ne.style,to:he,duration:xe,easing:ke}),xe]);var kt=rL(rt,xe,ke),He=Fc(Fc(Fc({},Ne.style),he),{},{transition:kt});return[].concat(kT(ee),[He,xe,ze]).filter(aK)};return this.manager.start([R].concat(kT(P.reduce(ie,[$,Math.max(W,a)])),[y.onAnimationEnd]))}},{key:"runAnimation",value:function(y){this.manager||(this.manager=rK());var w=y.begin,P=y.duration,a=y.attributeName,R=y.to,z=y.easing,$=y.onAnimationStart,V=y.onAnimationEnd,W=y.steps,ie=y.children,ae=this.manager;if(this.unSubscribe=ae.subscribe(this.handleStyleChange),typeof z=="function"||typeof ie=="function"||z==="spring"){this.runJSAnimation(y);return}if(W.length>1){this.runStepAnimation(y);return}var ee=a?J_({},a,R):R,ne=rL(Object.keys(ee),P,z);ae.start([$,w,Fc(Fc({},ee),{},{transition:ne}),P,V])}},{key:"render",value:function(){var y=this.props,w=y.children;y.begin;var P=y.duration;y.attributeName,y.easing;var a=y.isActive;y.steps,y.from,y.to,y.canBegin,y.onAnimationEnd,y.shouldReAnimate,y.onAnimationReStart;var R=OK(y,MK),z=ir.Children.count(w),$=this.state.style;if(typeof w=="function")return w($);if(!a||z===0||P<=0)return w;var V=function(ie){var ae=ie.props,ee=ae.style,ne=ee===void 0?{}:ee,de=ae.className,xe=ir.cloneElement(ie,Fc(Fc({},R),{},{style:Fc(Fc({},ne),$),className:de}));return xe};return z===1?V(ir.Children.only(w)):ct.createElement("div",null,ir.Children.map(w,function(W){return V(W)}))}}]),l})(ir.PureComponent);Gf.displayName="Animate";Gf.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Gf.propTypes={from:Zi.oneOfType([Zi.object,Zi.string]),to:Zi.oneOfType([Zi.object,Zi.string]),attributeName:Zi.string,duration:Zi.number,begin:Zi.number,easing:Zi.oneOfType([Zi.string,Zi.func]),steps:Zi.arrayOf(Zi.shape({duration:Zi.number.isRequired,style:Zi.object.isRequired,easing:Zi.oneOfType([Zi.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Zi.func]),properties:Zi.arrayOf("string"),onAnimationEnd:Zi.func})),children:Zi.oneOfType([Zi.node,Zi.func]),isActive:Zi.bool,canBegin:Zi.bool,onAnimationEnd:Zi.func,shouldReAnimate:Zi.bool,onAnimationStart:Zi.func,onAnimationReStart:Zi.func};function Cy(r){"@babel/helpers - typeof";return Cy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Cy(r)}function B0(){return B0=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},B0.apply(this,arguments)}function qK(r,n){return ZK(r)||WK(r,n)||HK(r,n)||GK()}function GK(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HK(r,n){if(r){if(typeof r=="string")return lL(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return lL(r,n)}}function lL(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function WK(r,n){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var c,y,w,P,a=[],R=!0,z=!1;try{if(w=(l=l.call(r)).next,n!==0)for(;!(R=(c=w.call(l)).done)&&(a.push(c.value),a.length!==n);R=!0);}catch($){z=!0,y=$}finally{try{if(!R&&l.return!=null&&(P=l.return(),Object(P)!==P))return}finally{if(z)throw y}}return a}}function ZK(r){if(Array.isArray(r))return r}function uL(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function cL(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?uL(Object(l),!0).forEach(function(c){XK(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):uL(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function XK(r,n,l){return n=KK(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function KK(r){var n=YK(r,"string");return Cy(n)=="symbol"?n:n+""}function YK(r,n){if(Cy(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Cy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}var hL=function(n,l,c,y,w){var P=Math.min(Math.abs(c)/2,Math.abs(y)/2),a=y>=0?1:-1,R=c>=0?1:-1,z=y>=0&&c>=0||y<0&&c<0?1:0,$;if(P>0&&w instanceof Array){for(var V=[0,0,0,0],W=0,ie=4;W<ie;W++)V[W]=w[W]>P?P:w[W];$="M".concat(n,",").concat(l+a*V[0]),V[0]>0&&($+="A ".concat(V[0],",").concat(V[0],",0,0,").concat(z,",").concat(n+R*V[0],",").concat(l)),$+="L ".concat(n+c-R*V[1],",").concat(l),V[1]>0&&($+="A ".concat(V[1],",").concat(V[1],",0,0,").concat(z,`,
        `).concat(n+c,",").concat(l+a*V[1])),$+="L ".concat(n+c,",").concat(l+y-a*V[2]),V[2]>0&&($+="A ".concat(V[2],",").concat(V[2],",0,0,").concat(z,`,
        `).concat(n+c-R*V[2],",").concat(l+y)),$+="L ".concat(n+R*V[3],",").concat(l+y),V[3]>0&&($+="A ".concat(V[3],",").concat(V[3],",0,0,").concat(z,`,
        `).concat(n,",").concat(l+y-a*V[3])),$+="Z"}else if(P>0&&w===+w&&w>0){var ae=Math.min(P,w);$="M ".concat(n,",").concat(l+a*ae,`
            A `).concat(ae,",").concat(ae,",0,0,").concat(z,",").concat(n+R*ae,",").concat(l,`
            L `).concat(n+c-R*ae,",").concat(l,`
            A `).concat(ae,",").concat(ae,",0,0,").concat(z,",").concat(n+c,",").concat(l+a*ae,`
            L `).concat(n+c,",").concat(l+y-a*ae,`
            A `).concat(ae,",").concat(ae,",0,0,").concat(z,",").concat(n+c-R*ae,",").concat(l+y,`
            L `).concat(n+R*ae,",").concat(l+y,`
            A `).concat(ae,",").concat(ae,",0,0,").concat(z,",").concat(n,",").concat(l+y-a*ae," Z")}else $="M ".concat(n,",").concat(l," h ").concat(c," v ").concat(y," h ").concat(-c," Z");return $},JK=function(n,l){if(!n||!l)return!1;var c=n.x,y=n.y,w=l.x,P=l.y,a=l.width,R=l.height;if(Math.abs(a)>0&&Math.abs(R)>0){var z=Math.min(w,w+a),$=Math.max(w,w+a),V=Math.min(P,P+R),W=Math.max(P,P+R);return c>=z&&c<=$&&y>=V&&y<=W}return!1},QK={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},I2=function(n){var l=cL(cL({},QK),n),c=ir.useRef(),y=ir.useState(-1),w=qK(y,2),P=w[0],a=w[1];ir.useEffect(function(){if(c.current&&c.current.getTotalLength)try{var ke=c.current.getTotalLength();ke&&a(ke)}catch{}},[]);var R=l.x,z=l.y,$=l.width,V=l.height,W=l.radius,ie=l.className,ae=l.animationEasing,ee=l.animationDuration,ne=l.animationBegin,de=l.isAnimationActive,xe=l.isUpdateAnimationActive;if(R!==+R||z!==+z||$!==+$||V!==+V||$===0||V===0)return null;var be=ui("recharts-rectangle",ie);return xe?ct.createElement(Gf,{canBegin:P>0,from:{width:$,height:V,x:R,y:z},to:{width:$,height:V,x:R,y:z},duration:ee,animationEasing:ae,isActive:xe},function(ke){var he=ke.width,_e=ke.height,ze=ke.x,Ne=ke.y;return ct.createElement(Gf,{canBegin:P>0,from:"0px ".concat(P===-1?1:P,"px"),to:"".concat(P,"px 0px"),attributeName:"strokeDasharray",begin:ne,duration:ee,isActive:de,easing:ae},ct.createElement("path",B0({},Vn(l,!0),{className:be,d:hL(ze,Ne,he,_e,W),ref:c})))}):ct.createElement("path",B0({},Vn(l,!0),{className:be,d:hL(R,z,$,V,W)}))},eY=["points","className","baseLinePoints","connectNulls"];function sg(){return sg=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},sg.apply(this,arguments)}function tY(r,n){if(r==null)return{};var l=rY(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function rY(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}function fL(r){return aY(r)||oY(r)||iY(r)||nY()}function nY(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iY(r,n){if(r){if(typeof r=="string")return aA(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return aA(r,n)}}function oY(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function aY(r){if(Array.isArray(r))return aA(r)}function aA(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}var dL=function(n){return n&&n.x===+n.x&&n.y===+n.y},sY=function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],l=[[]];return n.forEach(function(c){dL(c)?l[l.length-1].push(c):l[l.length-1].length>0&&l.push([])}),dL(n[0])&&l[l.length-1].push(n[0]),l[l.length-1].length<=0&&(l=l.slice(0,-1)),l},ny=function(n,l){var c=sY(n);l&&(c=[c.reduce(function(w,P){return[].concat(fL(w),fL(P))},[])]);var y=c.map(function(w){return w.reduce(function(P,a,R){return"".concat(P).concat(R===0?"M":"L").concat(a.x,",").concat(a.y)},"")}).join("");return c.length===1?"".concat(y,"Z"):y},lY=function(n,l,c){var y=ny(n,c);return"".concat(y.slice(-1)==="Z"?y.slice(0,-1):y,"L").concat(ny(l.reverse(),c).slice(1))},uY=function(n){var l=n.points,c=n.className,y=n.baseLinePoints,w=n.connectNulls,P=tY(n,eY);if(!l||!l.length)return null;var a=ui("recharts-polygon",c);if(y&&y.length){var R=P.stroke&&P.stroke!=="none",z=lY(l,y,w);return ct.createElement("g",{className:a},ct.createElement("path",sg({},Vn(P,!0),{fill:z.slice(-1)==="Z"?P.fill:"none",stroke:"none",d:z})),R?ct.createElement("path",sg({},Vn(P,!0),{fill:"none",d:ny(l,w)})):null,R?ct.createElement("path",sg({},Vn(P,!0),{fill:"none",d:ny(y,w)})):null)}var $=ny(l,w);return ct.createElement("path",sg({},Vn(P,!0),{fill:$.slice(-1)==="Z"?P.fill:"none",className:a,d:$}))};function sA(){return sA=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},sA.apply(this,arguments)}var C2=function(n){var l=n.cx,c=n.cy,y=n.r,w=n.className,P=ui("recharts-dot",w);return l===+l&&c===+c&&y===+y?ir.createElement("circle",sA({},Vn(n,!1),l0(n),{className:P,cx:l,cy:c,r:y})):null};function My(r){"@babel/helpers - typeof";return My=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},My(r)}var cY=["x","y","top","left","width","height","className"];function lA(){return lA=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},lA.apply(this,arguments)}function pL(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function hY(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?pL(Object(l),!0).forEach(function(c){fY(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):pL(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function fY(r,n,l){return n=dY(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function dY(r){var n=pY(r,"string");return My(n)=="symbol"?n:n+""}function pY(r,n){if(My(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(My(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function mY(r,n){if(r==null)return{};var l=gY(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function gY(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}var _Y=function(n,l,c,y,w,P){return"M".concat(n,",").concat(w,"v").concat(y,"M").concat(P,",").concat(l,"h").concat(c)},yY=function(n){var l=n.x,c=l===void 0?0:l,y=n.y,w=y===void 0?0:y,P=n.top,a=P===void 0?0:P,R=n.left,z=R===void 0?0:R,$=n.width,V=$===void 0?0:$,W=n.height,ie=W===void 0?0:W,ae=n.className,ee=mY(n,cY),ne=hY({x:c,y:w,top:a,left:z,width:V,height:ie},ee);return!Rr(c)||!Rr(w)||!Rr(V)||!Rr(ie)||!Rr(a)||!Rr(z)?null:ct.createElement("path",lA({},Vn(ne,!0),{className:ui("recharts-cross",ae),d:_Y(c,w,V,ie,a,z)}))},DT,mL;function vY(){if(mL)return DT;mL=1;var r=bx(),n=PB(),l=Fh();function c(y,w){return y&&y.length?r(y,l(w,2),n):void 0}return DT=c,DT}var xY=vY();const bY=Xi(xY);var zT,gL;function wY(){if(gL)return zT;gL=1;var r=bx(),n=Fh(),l=IB();function c(y,w){return y&&y.length?r(y,n(w,2),l):void 0}return zT=c,zT}var SY=wY();const TY=Xi(SY);var EY=["cx","cy","angle","ticks","axisLine"],AY=["ticks","tick","angle","tickFormatter","stroke"];function Ag(r){"@babel/helpers - typeof";return Ag=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ag(r)}function iy(){return iy=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},iy.apply(this,arguments)}function _L(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Qp(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?_L(Object(l),!0).forEach(function(c){Ix(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):_L(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function yL(r,n){if(r==null)return{};var l=PY(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function PY(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}function IY(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function vL(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,pN(c.key),c)}}function CY(r,n,l){return n&&vL(r.prototype,n),l&&vL(r,l),Object.defineProperty(r,"prototype",{writable:!1}),r}function MY(r,n,l){return n=N0(n),OY(r,dN()?Reflect.construct(n,l||[],N0(r).constructor):n.apply(r,l))}function OY(r,n){if(n&&(Ag(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return RY(r)}function RY(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function dN(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dN=function(){return!!r})()}function N0(r){return N0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},N0(r)}function kY(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&uA(r,n)}function uA(r,n){return uA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},uA(r,n)}function Ix(r,n,l){return n=pN(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function pN(r){var n=DY(r,"string");return Ag(n)=="symbol"?n:n+""}function DY(r,n){if(Ag(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Ag(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}var Cx=(function(r){function n(){return IY(this,n),MY(this,n,arguments)}return kY(n,r),CY(n,[{key:"getTickValueCoord",value:function(c){var y=c.coordinate,w=this.props,P=w.angle,a=w.cx,R=w.cy;return yo(a,R,y,P)}},{key:"getTickTextAnchor",value:function(){var c=this.props.orientation,y;switch(c){case"left":y="end";break;case"right":y="start";break;default:y="middle";break}return y}},{key:"getViewBox",value:function(){var c=this.props,y=c.cx,w=c.cy,P=c.angle,a=c.ticks,R=bY(a,function($){return $.coordinate||0}),z=TY(a,function($){return $.coordinate||0});return{cx:y,cy:w,startAngle:P,endAngle:P,innerRadius:z.coordinate||0,outerRadius:R.coordinate||0}}},{key:"renderAxisLine",value:function(){var c=this.props,y=c.cx,w=c.cy,P=c.angle,a=c.ticks,R=c.axisLine,z=yL(c,EY),$=a.reduce(function(ae,ee){return[Math.min(ae[0],ee.coordinate),Math.max(ae[1],ee.coordinate)]},[1/0,-1/0]),V=yo(y,w,$[0],P),W=yo(y,w,$[1],P),ie=Qp(Qp(Qp({},Vn(z,!1)),{},{fill:"none"},Vn(R,!1)),{},{x1:V.x,y1:V.y,x2:W.x,y2:W.y});return ct.createElement("line",iy({className:"recharts-polar-radius-axis-line"},ie))}},{key:"renderTicks",value:function(){var c=this,y=this.props,w=y.ticks,P=y.tick,a=y.angle,R=y.tickFormatter,z=y.stroke,$=yL(y,AY),V=this.getTickTextAnchor(),W=Vn($,!1),ie=Vn(P,!1),ae=w.map(function(ee,ne){var de=c.getTickValueCoord(ee),xe=Qp(Qp(Qp(Qp({textAnchor:V,transform:"rotate(".concat(90-a,", ").concat(de.x,", ").concat(de.y,")")},W),{},{stroke:"none",fill:z},ie),{},{index:ne},de),{},{payload:ee});return ct.createElement(eo,iy({className:ui("recharts-polar-radius-axis-tick",rN(P)),key:"tick-".concat(ee.coordinate)},hm(c.props,ee,ne)),n.renderTickItem(P,xe,R?R(ee.value,ne):ee.value))});return ct.createElement(eo,{className:"recharts-polar-radius-axis-ticks"},ae)}},{key:"render",value:function(){var c=this.props,y=c.ticks,w=c.axisLine,P=c.tick;return!y||!y.length?null:ct.createElement(eo,{className:ui("recharts-polar-radius-axis",this.props.className)},w&&this.renderAxisLine(),P&&this.renderTicks(),Qa.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(c,y,w){var P;return ct.isValidElement(c)?P=ct.cloneElement(c,y):Zn(c)?P=c(y):P=ct.createElement(fm,iy({},y,{className:"recharts-polar-radius-axis-tick-value"}),w),P}}])})(ir.PureComponent);Ix(Cx,"displayName","PolarRadiusAxis");Ix(Cx,"axisType","radiusAxis");Ix(Cx,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function Pg(r){"@babel/helpers - typeof";return Pg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Pg(r)}function nm(){return nm=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},nm.apply(this,arguments)}function xL(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function em(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?xL(Object(l),!0).forEach(function(c){Mx(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):xL(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function zY(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function bL(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,gN(c.key),c)}}function LY(r,n,l){return n&&bL(r.prototype,n),l&&bL(r,l),Object.defineProperty(r,"prototype",{writable:!1}),r}function FY(r,n,l){return n=j0(n),BY(r,mN()?Reflect.construct(n,l||[],j0(r).constructor):n.apply(r,l))}function BY(r,n){if(n&&(Pg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return NY(r)}function NY(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function mN(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mN=function(){return!!r})()}function j0(r){return j0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},j0(r)}function jY(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&cA(r,n)}function cA(r,n){return cA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},cA(r,n)}function Mx(r,n,l){return n=gN(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function gN(r){var n=UY(r,"string");return Pg(n)=="symbol"?n:n+""}function UY(r,n){if(Pg(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Pg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}var VY=Math.PI/180,wL=1e-5,Ox=(function(r){function n(){return zY(this,n),FY(this,n,arguments)}return jY(n,r),LY(n,[{key:"getTickLineCoord",value:function(c){var y=this.props,w=y.cx,P=y.cy,a=y.radius,R=y.orientation,z=y.tickSize,$=z||8,V=yo(w,P,a,c.coordinate),W=yo(w,P,a+(R==="inner"?-1:1)*$,c.coordinate);return{x1:V.x,y1:V.y,x2:W.x,y2:W.y}}},{key:"getTickTextAnchor",value:function(c){var y=this.props.orientation,w=Math.cos(-c.coordinate*VY),P;return w>wL?P=y==="outer"?"start":"end":w<-wL?P=y==="outer"?"end":"start":P="middle",P}},{key:"renderAxisLine",value:function(){var c=this.props,y=c.cx,w=c.cy,P=c.radius,a=c.axisLine,R=c.axisLineType,z=em(em({},Vn(this.props,!1)),{},{fill:"none"},Vn(a,!1));if(R==="circle")return ct.createElement(C2,nm({className:"recharts-polar-angle-axis-line"},z,{cx:y,cy:w,r:P}));var $=this.props.ticks,V=$.map(function(W){return yo(y,w,P,W.coordinate)});return ct.createElement(uY,nm({className:"recharts-polar-angle-axis-line"},z,{points:V}))}},{key:"renderTicks",value:function(){var c=this,y=this.props,w=y.ticks,P=y.tick,a=y.tickLine,R=y.tickFormatter,z=y.stroke,$=Vn(this.props,!1),V=Vn(P,!1),W=em(em({},$),{},{fill:"none"},Vn(a,!1)),ie=w.map(function(ae,ee){var ne=c.getTickLineCoord(ae),de=c.getTickTextAnchor(ae),xe=em(em(em({textAnchor:de},$),{},{stroke:"none",fill:z},V),{},{index:ee,payload:ae,x:ne.x2,y:ne.y2});return ct.createElement(eo,nm({className:ui("recharts-polar-angle-axis-tick",rN(P)),key:"tick-".concat(ae.coordinate)},hm(c.props,ae,ee)),a&&ct.createElement("line",nm({className:"recharts-polar-angle-axis-tick-line"},W,ne)),P&&n.renderTickItem(P,xe,R?R(ae.value,ee):ae.value))});return ct.createElement(eo,{className:"recharts-polar-angle-axis-ticks"},ie)}},{key:"render",value:function(){var c=this.props,y=c.ticks,w=c.radius,P=c.axisLine;return w<=0||!y||!y.length?null:ct.createElement(eo,{className:ui("recharts-polar-angle-axis",this.props.className)},P&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(c,y,w){var P;return ct.isValidElement(c)?P=ct.cloneElement(c,y):Zn(c)?P=c(y):P=ct.createElement(fm,nm({},y,{className:"recharts-polar-angle-axis-tick-value"}),w),P}}])})(ir.PureComponent);Mx(Ox,"displayName","PolarAngleAxis");Mx(Ox,"axisType","angleAxis");Mx(Ox,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var LT,SL;function $Y(){if(SL)return LT;SL=1;var r=AF(),n=r(Object.getPrototypeOf,Object);return LT=n,LT}var FT,TL;function qY(){if(TL)return FT;TL=1;var r=Wf(),n=$Y(),l=Zf(),c="[object Object]",y=Function.prototype,w=Object.prototype,P=y.toString,a=w.hasOwnProperty,R=P.call(Object);function z($){if(!l($)||r($)!=c)return!1;var V=n($);if(V===null)return!0;var W=a.call(V,"constructor")&&V.constructor;return typeof W=="function"&&W instanceof W&&P.call(W)==R}return FT=z,FT}var GY=qY();const HY=Xi(GY);var BT,EL;function WY(){if(EL)return BT;EL=1;var r=Wf(),n=Zf(),l="[object Boolean]";function c(y){return y===!0||y===!1||n(y)&&r(y)==l}return BT=c,BT}var ZY=WY();const XY=Xi(ZY);function Oy(r){"@babel/helpers - typeof";return Oy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Oy(r)}function U0(){return U0=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},U0.apply(this,arguments)}function KY(r,n){return eJ(r)||QY(r,n)||JY(r,n)||YY()}function YY(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JY(r,n){if(r){if(typeof r=="string")return AL(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return AL(r,n)}}function AL(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function QY(r,n){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var c,y,w,P,a=[],R=!0,z=!1;try{if(w=(l=l.call(r)).next,n!==0)for(;!(R=(c=w.call(l)).done)&&(a.push(c.value),a.length!==n);R=!0);}catch($){z=!0,y=$}finally{try{if(!R&&l.return!=null&&(P=l.return(),Object(P)!==P))return}finally{if(z)throw y}}return a}}function eJ(r){if(Array.isArray(r))return r}function PL(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function IL(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?PL(Object(l),!0).forEach(function(c){tJ(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):PL(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function tJ(r,n,l){return n=rJ(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function rJ(r){var n=nJ(r,"string");return Oy(n)=="symbol"?n:n+""}function nJ(r,n){if(Oy(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Oy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}var CL=function(n,l,c,y,w){var P=c-y,a;return a="M ".concat(n,",").concat(l),a+="L ".concat(n+c,",").concat(l),a+="L ".concat(n+c-P/2,",").concat(l+w),a+="L ".concat(n+c-P/2-y,",").concat(l+w),a+="L ".concat(n,",").concat(l," Z"),a},iJ={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},oJ=function(n){var l=IL(IL({},iJ),n),c=ir.useRef(),y=ir.useState(-1),w=KY(y,2),P=w[0],a=w[1];ir.useEffect(function(){if(c.current&&c.current.getTotalLength)try{var be=c.current.getTotalLength();be&&a(be)}catch{}},[]);var R=l.x,z=l.y,$=l.upperWidth,V=l.lowerWidth,W=l.height,ie=l.className,ae=l.animationEasing,ee=l.animationDuration,ne=l.animationBegin,de=l.isUpdateAnimationActive;if(R!==+R||z!==+z||$!==+$||V!==+V||W!==+W||$===0&&V===0||W===0)return null;var xe=ui("recharts-trapezoid",ie);return de?ct.createElement(Gf,{canBegin:P>0,from:{upperWidth:0,lowerWidth:0,height:W,x:R,y:z},to:{upperWidth:$,lowerWidth:V,height:W,x:R,y:z},duration:ee,animationEasing:ae,isActive:de},function(be){var ke=be.upperWidth,he=be.lowerWidth,_e=be.height,ze=be.x,Ne=be.y;return ct.createElement(Gf,{canBegin:P>0,from:"0px ".concat(P===-1?1:P,"px"),to:"".concat(P,"px 0px"),attributeName:"strokeDasharray",begin:ne,duration:ee,easing:ae},ct.createElement("path",U0({},Vn(l,!0),{className:xe,d:CL(ze,Ne,ke,he,_e),ref:c})))}):ct.createElement("g",null,ct.createElement("path",U0({},Vn(l,!0),{className:xe,d:CL(R,z,$,V,W)})))},aJ=["option","shapeType","propTransformer","activeClassName","isActive"];function Ry(r){"@babel/helpers - typeof";return Ry=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ry(r)}function sJ(r,n){if(r==null)return{};var l=lJ(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function lJ(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}function ML(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function V0(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?ML(Object(l),!0).forEach(function(c){uJ(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):ML(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function uJ(r,n,l){return n=cJ(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function cJ(r){var n=hJ(r,"string");return Ry(n)=="symbol"?n:n+""}function hJ(r,n){if(Ry(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Ry(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function fJ(r,n){return V0(V0({},n),r)}function dJ(r,n){return r==="symbols"}function OL(r){var n=r.shapeType,l=r.elementProps;switch(n){case"rectangle":return ct.createElement(I2,l);case"trapezoid":return ct.createElement(oJ,l);case"sector":return ct.createElement(oN,l);case"symbols":if(dJ(n))return ct.createElement(HA,l);break;default:return null}}function pJ(r){return ir.isValidElement(r)?r.props:r}function _N(r){var n=r.option,l=r.shapeType,c=r.propTransformer,y=c===void 0?fJ:c,w=r.activeClassName,P=w===void 0?"recharts-active-shape":w,a=r.isActive,R=sJ(r,aJ),z;if(ir.isValidElement(n))z=ir.cloneElement(n,V0(V0({},R),pJ(n)));else if(Zn(n))z=n(R);else if(HY(n)&&!XY(n)){var $=y(n,R);z=ct.createElement(OL,{shapeType:l,elementProps:$})}else{var V=R;z=ct.createElement(OL,{shapeType:l,elementProps:V})}return a?ct.createElement(eo,{className:P},z):z}function Rx(r,n){return n!=null&&"trapezoids"in r.props}function kx(r,n){return n!=null&&"sectors"in r.props}function ky(r,n){return n!=null&&"points"in r.props}function mJ(r,n){var l,c,y=r.x===(n==null||(l=n.labelViewBox)===null||l===void 0?void 0:l.x)||r.x===n.x,w=r.y===(n==null||(c=n.labelViewBox)===null||c===void 0?void 0:c.y)||r.y===n.y;return y&&w}function gJ(r,n){var l=r.endAngle===n.endAngle,c=r.startAngle===n.startAngle;return l&&c}function _J(r,n){var l=r.x===n.x,c=r.y===n.y,y=r.z===n.z;return l&&c&&y}function yJ(r,n){var l;return Rx(r,n)?l=mJ:kx(r,n)?l=gJ:ky(r,n)&&(l=_J),l}function vJ(r,n){var l;return Rx(r,n)?l="trapezoids":kx(r,n)?l="sectors":ky(r,n)&&(l="points"),l}function xJ(r,n){if(Rx(r,n)){var l;return(l=n.tooltipPayload)===null||l===void 0||(l=l[0])===null||l===void 0||(l=l.payload)===null||l===void 0?void 0:l.payload}if(kx(r,n)){var c;return(c=n.tooltipPayload)===null||c===void 0||(c=c[0])===null||c===void 0||(c=c.payload)===null||c===void 0?void 0:c.payload}return ky(r,n)?n.payload:{}}function bJ(r){var n=r.activeTooltipItem,l=r.graphicalItem,c=r.itemData,y=vJ(l,n),w=xJ(l,n),P=c.filter(function(R,z){var $=Tx(w,R),V=l.props[y].filter(function(ae){var ee=yJ(l,n);return ee(ae,n)}),W=l.props[y].indexOf(V[V.length-1]),ie=z===W;return $&&ie}),a=c.indexOf(P[P.length-1]);return a}var a0;function Ig(r){"@babel/helpers - typeof";return Ig=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ig(r)}function lg(){return lg=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},lg.apply(this,arguments)}function RL(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function go(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?RL(Object(l),!0).forEach(function(c){ju(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):RL(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function wJ(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function kL(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,vN(c.key),c)}}function SJ(r,n,l){return n&&kL(r.prototype,n),l&&kL(r,l),Object.defineProperty(r,"prototype",{writable:!1}),r}function TJ(r,n,l){return n=$0(n),EJ(r,yN()?Reflect.construct(n,l||[],$0(r).constructor):n.apply(r,l))}function EJ(r,n){if(n&&(Ig(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return AJ(r)}function AJ(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function yN(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(yN=function(){return!!r})()}function $0(r){return $0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},$0(r)}function PJ(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&hA(r,n)}function hA(r,n){return hA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},hA(r,n)}function ju(r,n,l){return n=vN(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function vN(r){var n=IJ(r,"string");return Ig(n)=="symbol"?n:n+""}function IJ(r,n){if(Ig(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Ig(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var Bh=(function(r){function n(l){var c;return wJ(this,n),c=TJ(this,n,[l]),ju(c,"pieRef",null),ju(c,"sectorRefs",[]),ju(c,"id",Vy("recharts-pie-")),ju(c,"handleAnimationEnd",function(){var y=c.props.onAnimationEnd;c.setState({isAnimationFinished:!0}),Zn(y)&&y()}),ju(c,"handleAnimationStart",function(){var y=c.props.onAnimationStart;c.setState({isAnimationFinished:!1}),Zn(y)&&y()}),c.state={isAnimationFinished:!l.isAnimationActive,prevIsAnimationActive:l.isAnimationActive,prevAnimationId:l.animationId,sectorToFocus:0},c}return PJ(n,r),SJ(n,[{key:"isActiveIndex",value:function(c){var y=this.props.activeIndex;return Array.isArray(y)?y.indexOf(c)!==-1:c===y}},{key:"hasActiveIndex",value:function(){var c=this.props.activeIndex;return Array.isArray(c)?c.length!==0:c||c===0}},{key:"renderLabels",value:function(c){var y=this.props.isAnimationActive;if(y&&!this.state.isAnimationFinished)return null;var w=this.props,P=w.label,a=w.labelLine,R=w.dataKey,z=w.valueKey,$=Vn(this.props,!1),V=Vn(P,!1),W=Vn(a,!1),ie=P&&P.offsetRadius||20,ae=c.map(function(ee,ne){var de=(ee.startAngle+ee.endAngle)/2,xe=yo(ee.cx,ee.cy,ee.outerRadius+ie,de),be=go(go(go(go({},$),ee),{},{stroke:"none"},V),{},{index:ne,textAnchor:n.getTextAnchor(xe.x,ee.cx)},xe),ke=go(go(go(go({},$),ee),{},{fill:"none",stroke:ee.fill},W),{},{index:ne,points:[yo(ee.cx,ee.cy,ee.outerRadius,de),xe]}),he=R;return xi(R)&&xi(z)?he="value":xi(R)&&(he=z),ct.createElement(eo,{key:"label-".concat(ee.startAngle,"-").concat(ee.endAngle,"-").concat(ee.midAngle,"-").concat(ne)},a&&n.renderLabelLineItem(a,ke,"line"),n.renderLabelItem(P,be,Cs(ee,he)))});return ct.createElement(eo,{className:"recharts-pie-labels"},ae)}},{key:"renderSectorsStatically",value:function(c){var y=this,w=this.props,P=w.activeShape,a=w.blendStroke,R=w.inactiveShape;return c.map(function(z,$){if(z?.startAngle===0&&z?.endAngle===0&&c.length!==1)return null;var V=y.isActiveIndex($),W=R&&y.hasActiveIndex()?R:null,ie=V?P:W,ae=go(go({},z),{},{stroke:a?z.fill:z.stroke,tabIndex:-1});return ct.createElement(eo,lg({ref:function(ne){ne&&!y.sectorRefs.includes(ne)&&y.sectorRefs.push(ne)},tabIndex:-1,className:"recharts-pie-sector"},hm(y.props,z,$),{key:"sector-".concat(z?.startAngle,"-").concat(z?.endAngle,"-").concat(z.midAngle,"-").concat($)}),ct.createElement(_N,lg({option:ie,isActive:V,shapeType:"sector"},ae)))})}},{key:"renderSectorsWithAnimation",value:function(){var c=this,y=this.props,w=y.sectors,P=y.isAnimationActive,a=y.animationBegin,R=y.animationDuration,z=y.animationEasing,$=y.animationId,V=this.state,W=V.prevSectors,ie=V.prevIsAnimationActive;return ct.createElement(Gf,{begin:a,duration:R,isActive:P,easing:z,from:{t:0},to:{t:1},key:"pie-".concat($,"-").concat(ie),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(ae){var ee=ae.t,ne=[],de=w&&w[0],xe=de.startAngle;return w.forEach(function(be,ke){var he=W&&W[ke],_e=ke>0?Yl(be,"paddingAngle",0):0;if(he){var ze=op(he.endAngle-he.startAngle,be.endAngle-be.startAngle),Ne=go(go({},be),{},{startAngle:xe+_e,endAngle:xe+ze(ee)+_e});ne.push(Ne),xe=Ne.endAngle}else{var rt=be.endAngle,kt=be.startAngle,He=op(0,rt-kt),yt=He(ee),gt=go(go({},be),{},{startAngle:xe+_e,endAngle:xe+yt+_e});ne.push(gt),xe=gt.endAngle}}),ct.createElement(eo,null,c.renderSectorsStatically(ne))})}},{key:"attachKeyboardHandlers",value:function(c){var y=this;c.onkeydown=function(w){if(!w.altKey)switch(w.key){case"ArrowLeft":{var P=++y.state.sectorToFocus%y.sectorRefs.length;y.sectorRefs[P].focus(),y.setState({sectorToFocus:P});break}case"ArrowRight":{var a=--y.state.sectorToFocus<0?y.sectorRefs.length-1:y.state.sectorToFocus%y.sectorRefs.length;y.sectorRefs[a].focus(),y.setState({sectorToFocus:a});break}case"Escape":{y.sectorRefs[y.state.sectorToFocus].blur(),y.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var c=this.props,y=c.sectors,w=c.isAnimationActive,P=this.state.prevSectors;return w&&y&&y.length&&(!P||!Tx(P,y))?this.renderSectorsWithAnimation():this.renderSectorsStatically(y)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var c=this,y=this.props,w=y.hide,P=y.sectors,a=y.className,R=y.label,z=y.cx,$=y.cy,V=y.innerRadius,W=y.outerRadius,ie=y.isAnimationActive,ae=this.state.isAnimationFinished;if(w||!P||!P.length||!Rr(z)||!Rr($)||!Rr(V)||!Rr(W))return null;var ee=ui("recharts-pie",a);return ct.createElement(eo,{tabIndex:this.props.rootTabIndex,className:ee,ref:function(de){c.pieRef=de}},this.renderSectors(),R&&this.renderLabels(P),Qa.renderCallByParent(this.props,null,!1),(!ie||ae)&&hp.renderCallByParent(this.props,P,!1))}}],[{key:"getDerivedStateFromProps",value:function(c,y){return y.prevIsAnimationActive!==c.isAnimationActive?{prevIsAnimationActive:c.isAnimationActive,prevAnimationId:c.animationId,curSectors:c.sectors,prevSectors:[],isAnimationFinished:!0}:c.isAnimationActive&&c.animationId!==y.prevAnimationId?{prevAnimationId:c.animationId,curSectors:c.sectors,prevSectors:y.curSectors,isAnimationFinished:!0}:c.sectors!==y.curSectors?{curSectors:c.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(c,y){return c>y?"start":c<y?"end":"middle"}},{key:"renderLabelLineItem",value:function(c,y,w){if(ct.isValidElement(c))return ct.cloneElement(c,y);if(Zn(c))return c(y);var P=ui("recharts-pie-label-line",typeof c!="boolean"?c.className:"");return ct.createElement(KE,lg({},y,{key:w,type:"linear",className:P}))}},{key:"renderLabelItem",value:function(c,y,w){if(ct.isValidElement(c))return ct.cloneElement(c,y);var P=w;if(Zn(c)&&(P=c(y),ct.isValidElement(P)))return P;var a=ui("recharts-pie-label-text",typeof c!="boolean"&&!Zn(c)?c.className:"");return ct.createElement(fm,lg({},y,{alignmentBaseline:"middle",className:a}),P)}}])})(ir.PureComponent);a0=Bh;ju(Bh,"displayName","Pie");ju(Bh,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!Gg.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});ju(Bh,"parseDeltaAngle",function(r,n){var l=Xs(n-r),c=Math.min(Math.abs(n-r),360);return l*c});ju(Bh,"getRealPieData",function(r){var n=r.data,l=r.children,c=Vn(r,!1),y=Vu(l,qy);return n&&n.length?n.map(function(w,P){return go(go(go({payload:w},c),w),y&&y[P]&&y[P].props)}):y&&y.length?y.map(function(w){return go(go({},c),w.props)}):[]});ju(Bh,"parseCoordinateOfPie",function(r,n){var l=n.top,c=n.left,y=n.width,w=n.height,P=tN(y,w),a=c+Ks(r.cx,y,y/2),R=l+Ks(r.cy,w,w/2),z=Ks(r.innerRadius,P,0),$=Ks(r.outerRadius,P,P*.8),V=r.maxRadius||Math.sqrt(y*y+w*w)/2;return{cx:a,cy:R,innerRadius:z,outerRadius:$,maxRadius:V}});ju(Bh,"getComposedData",function(r){var n=r.item,l=r.offset,c=n.type.defaultProps!==void 0?go(go({},n.type.defaultProps),n.props):n.props,y=a0.getRealPieData(c);if(!y||!y.length)return null;var w=c.cornerRadius,P=c.startAngle,a=c.endAngle,R=c.paddingAngle,z=c.dataKey,$=c.nameKey,V=c.valueKey,W=c.tooltipType,ie=Math.abs(c.minAngle),ae=a0.parseCoordinateOfPie(c,l),ee=a0.parseDeltaAngle(P,a),ne=Math.abs(ee),de=z;xi(z)&&xi(V)?(jc(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),de="value"):xi(z)&&(jc(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),de=V);var xe=y.filter(function(Ne){return Cs(Ne,de,0)!==0}).length,be=(ne>=360?xe:xe-1)*R,ke=ne-xe*ie-be,he=y.reduce(function(Ne,rt){var kt=Cs(rt,de,0);return Ne+(Rr(kt)?kt:0)},0),_e;if(he>0){var ze;_e=y.map(function(Ne,rt){var kt=Cs(Ne,de,0),He=Cs(Ne,$,rt),yt=(Rr(kt)?kt:0)/he,gt;rt?gt=ze.endAngle+Xs(ee)*R*(kt!==0?1:0):gt=P;var Pt=gt+Xs(ee)*((kt!==0?ie:0)+yt*ke),xt=(gt+Pt)/2,Tt=(ae.innerRadius+ae.outerRadius)/2,Ht=[{name:He,value:kt,payload:Ne,dataKey:de,type:W}],lt=yo(ae.cx,ae.cy,Tt,xt);return ze=go(go(go({percent:yt,cornerRadius:w,name:He,tooltipPayload:Ht,midAngle:xt,middleRadius:Tt,tooltipPosition:lt},Ne),ae),{},{value:Cs(Ne,de),startAngle:gt,endAngle:Pt,payload:Ne,paddingAngle:Xs(ee)*R}),ze})}return go(go({},ae),{},{sectors:_e,data:y})});var NT,DL;function CJ(){if(DL)return NT;DL=1;var r=Math.ceil,n=Math.max;function l(c,y,w,P){for(var a=-1,R=n(r((y-c)/(w||1)),0),z=Array(R);R--;)z[P?R:++a]=c,c+=w;return z}return NT=l,NT}var jT,zL;function xN(){if(zL)return jT;zL=1;var r=VF(),n=1/0,l=17976931348623157e292;function c(y){if(!y)return y===0?y:0;if(y=r(y),y===n||y===-n){var w=y<0?-1:1;return w*l}return y===y?y:0}return jT=c,jT}var UT,LL;function MJ(){if(LL)return UT;LL=1;var r=CJ(),n=px(),l=xN();function c(y){return function(w,P,a){return a&&typeof a!="number"&&n(w,P,a)&&(P=a=void 0),w=l(w),P===void 0?(P=w,w=0):P=l(P),a=a===void 0?w<P?1:-1:l(a),r(w,P,a,y)}}return UT=c,UT}var VT,FL;function OJ(){if(FL)return VT;FL=1;var r=MJ(),n=r();return VT=n,VT}var RJ=OJ();const q0=Xi(RJ);function Dy(r){"@babel/helpers - typeof";return Dy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Dy(r)}function BL(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function NL(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?BL(Object(l),!0).forEach(function(c){bN(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):BL(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function bN(r,n,l){return n=kJ(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function kJ(r){var n=DJ(r,"string");return Dy(n)=="symbol"?n:n+""}function DJ(r,n){if(Dy(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Dy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}var zJ=["Webkit","Moz","O","ms"],LJ=function(n,l){var c=n.replace(/(\w)/,function(w){return w.toUpperCase()}),y=zJ.reduce(function(w,P){return NL(NL({},w),{},bN({},P+c,l))},{});return y[n]=l,y};function Cg(r){"@babel/helpers - typeof";return Cg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Cg(r)}function G0(){return G0=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},G0.apply(this,arguments)}function jL(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function $T(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?jL(Object(l),!0).forEach(function(c){Zl(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):jL(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function FJ(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function UL(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,SN(c.key),c)}}function BJ(r,n,l){return n&&UL(r.prototype,n),l&&UL(r,l),Object.defineProperty(r,"prototype",{writable:!1}),r}function NJ(r,n,l){return n=H0(n),jJ(r,wN()?Reflect.construct(n,l||[],H0(r).constructor):n.apply(r,l))}function jJ(r,n){if(n&&(Cg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return UJ(r)}function UJ(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function wN(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(wN=function(){return!!r})()}function H0(r){return H0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},H0(r)}function VJ(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&fA(r,n)}function fA(r,n){return fA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},fA(r,n)}function Zl(r,n,l){return n=SN(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function SN(r){var n=$J(r,"string");return Cg(n)=="symbol"?n:n+""}function $J(r,n){if(Cg(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Cg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var qJ=function(n){var l=n.data,c=n.startIndex,y=n.endIndex,w=n.x,P=n.width,a=n.travellerWidth;if(!l||!l.length)return{};var R=l.length,z=ey().domain(q0(0,R)).range([w,w+P-a]),$=z.domain().map(function(V){return z(V)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:z(c),endX:z(y),scale:z,scaleValues:$}},VL=function(n){return n.changedTouches&&!!n.changedTouches.length},Mg=(function(r){function n(l){var c;return FJ(this,n),c=NJ(this,n,[l]),Zl(c,"handleDrag",function(y){c.leaveTimer&&(clearTimeout(c.leaveTimer),c.leaveTimer=null),c.state.isTravellerMoving?c.handleTravellerMove(y):c.state.isSlideMoving&&c.handleSlideDrag(y)}),Zl(c,"handleTouchMove",function(y){y.changedTouches!=null&&y.changedTouches.length>0&&c.handleDrag(y.changedTouches[0])}),Zl(c,"handleDragEnd",function(){c.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var y=c.props,w=y.endIndex,P=y.onDragEnd,a=y.startIndex;P?.({endIndex:w,startIndex:a})}),c.detachDragEndListener()}),Zl(c,"handleLeaveWrapper",function(){(c.state.isTravellerMoving||c.state.isSlideMoving)&&(c.leaveTimer=window.setTimeout(c.handleDragEnd,c.props.leaveTimeOut))}),Zl(c,"handleEnterSlideOrTraveller",function(){c.setState({isTextActive:!0})}),Zl(c,"handleLeaveSlideOrTraveller",function(){c.setState({isTextActive:!1})}),Zl(c,"handleSlideDragStart",function(y){var w=VL(y)?y.changedTouches[0]:y;c.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:w.pageX}),c.attachDragEndListener()}),c.travellerDragStartHandlers={startX:c.handleTravellerDragStart.bind(c,"startX"),endX:c.handleTravellerDragStart.bind(c,"endX")},c.state={},c}return VJ(n,r),BJ(n,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(c){var y=c.startX,w=c.endX,P=this.state.scaleValues,a=this.props,R=a.gap,z=a.data,$=z.length-1,V=Math.min(y,w),W=Math.max(y,w),ie=n.getIndexInRange(P,V),ae=n.getIndexInRange(P,W);return{startIndex:ie-ie%R,endIndex:ae===$?$:ae-ae%R}}},{key:"getTextOfTick",value:function(c){var y=this.props,w=y.data,P=y.tickFormatter,a=y.dataKey,R=Cs(w[c],a,c);return Zn(P)?P(R,c):R}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(c){var y=this.state,w=y.slideMoveStartX,P=y.startX,a=y.endX,R=this.props,z=R.x,$=R.width,V=R.travellerWidth,W=R.startIndex,ie=R.endIndex,ae=R.onChange,ee=c.pageX-w;ee>0?ee=Math.min(ee,z+$-V-a,z+$-V-P):ee<0&&(ee=Math.max(ee,z-P,z-a));var ne=this.getIndex({startX:P+ee,endX:a+ee});(ne.startIndex!==W||ne.endIndex!==ie)&&ae&&ae(ne),this.setState({startX:P+ee,endX:a+ee,slideMoveStartX:c.pageX})}},{key:"handleTravellerDragStart",value:function(c,y){var w=VL(y)?y.changedTouches[0]:y;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:c,brushMoveStartX:w.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(c){var y=this.state,w=y.brushMoveStartX,P=y.movingTravellerId,a=y.endX,R=y.startX,z=this.state[P],$=this.props,V=$.x,W=$.width,ie=$.travellerWidth,ae=$.onChange,ee=$.gap,ne=$.data,de={startX:this.state.startX,endX:this.state.endX},xe=c.pageX-w;xe>0?xe=Math.min(xe,V+W-ie-z):xe<0&&(xe=Math.max(xe,V-z)),de[P]=z+xe;var be=this.getIndex(de),ke=be.startIndex,he=be.endIndex,_e=function(){var Ne=ne.length-1;return P==="startX"&&(a>R?ke%ee===0:he%ee===0)||a<R&&he===Ne||P==="endX"&&(a>R?he%ee===0:ke%ee===0)||a>R&&he===Ne};this.setState(Zl(Zl({},P,z+xe),"brushMoveStartX",c.pageX),function(){ae&&_e()&&ae(be)})}},{key:"handleTravellerMoveKeyboard",value:function(c,y){var w=this,P=this.state,a=P.scaleValues,R=P.startX,z=P.endX,$=this.state[y],V=a.indexOf($);if(V!==-1){var W=V+c;if(!(W===-1||W>=a.length)){var ie=a[W];y==="startX"&&ie>=z||y==="endX"&&ie<=R||this.setState(Zl({},y,ie),function(){w.props.onChange(w.getIndex({startX:w.state.startX,endX:w.state.endX}))})}}}},{key:"renderBackground",value:function(){var c=this.props,y=c.x,w=c.y,P=c.width,a=c.height,R=c.fill,z=c.stroke;return ct.createElement("rect",{stroke:z,fill:R,x:y,y:w,width:P,height:a})}},{key:"renderPanorama",value:function(){var c=this.props,y=c.x,w=c.y,P=c.width,a=c.height,R=c.data,z=c.children,$=c.padding,V=ir.Children.only(z);return V?ct.cloneElement(V,{x:y,y:w,width:P,height:a,margin:$,compact:!0,data:R}):null}},{key:"renderTravellerLayer",value:function(c,y){var w,P,a=this,R=this.props,z=R.y,$=R.travellerWidth,V=R.height,W=R.traveller,ie=R.ariaLabel,ae=R.data,ee=R.startIndex,ne=R.endIndex,de=Math.max(c,this.props.x),xe=$T($T({},Vn(this.props,!1)),{},{x:de,y:z,width:$,height:V}),be=ie||"Min value: ".concat((w=ae[ee])===null||w===void 0?void 0:w.name,", Max value: ").concat((P=ae[ne])===null||P===void 0?void 0:P.name);return ct.createElement(eo,{tabIndex:0,role:"slider","aria-label":be,"aria-valuenow":c,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[y],onTouchStart:this.travellerDragStartHandlers[y],onKeyDown:function(he){["ArrowLeft","ArrowRight"].includes(he.key)&&(he.preventDefault(),he.stopPropagation(),a.handleTravellerMoveKeyboard(he.key==="ArrowRight"?1:-1,y))},onFocus:function(){a.setState({isTravellerFocused:!0})},onBlur:function(){a.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},n.renderTraveller(W,xe))}},{key:"renderSlide",value:function(c,y){var w=this.props,P=w.y,a=w.height,R=w.stroke,z=w.travellerWidth,$=Math.min(c,y)+z,V=Math.max(Math.abs(y-c)-z,0);return ct.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:R,fillOpacity:.2,x:$,y:P,width:V,height:a})}},{key:"renderText",value:function(){var c=this.props,y=c.startIndex,w=c.endIndex,P=c.y,a=c.height,R=c.travellerWidth,z=c.stroke,$=this.state,V=$.startX,W=$.endX,ie=5,ae={pointerEvents:"none",fill:z};return ct.createElement(eo,{className:"recharts-brush-texts"},ct.createElement(fm,G0({textAnchor:"end",verticalAnchor:"middle",x:Math.min(V,W)-ie,y:P+a/2},ae),this.getTextOfTick(y)),ct.createElement(fm,G0({textAnchor:"start",verticalAnchor:"middle",x:Math.max(V,W)+R+ie,y:P+a/2},ae),this.getTextOfTick(w)))}},{key:"render",value:function(){var c=this.props,y=c.data,w=c.className,P=c.children,a=c.x,R=c.y,z=c.width,$=c.height,V=c.alwaysShowText,W=this.state,ie=W.startX,ae=W.endX,ee=W.isTextActive,ne=W.isSlideMoving,de=W.isTravellerMoving,xe=W.isTravellerFocused;if(!y||!y.length||!Rr(a)||!Rr(R)||!Rr(z)||!Rr($)||z<=0||$<=0)return null;var be=ui("recharts-brush",w),ke=ct.Children.count(P)===1,he=LJ("userSelect","none");return ct.createElement(eo,{className:be,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:he},this.renderBackground(),ke&&this.renderPanorama(),this.renderSlide(ie,ae),this.renderTravellerLayer(ie,"startX"),this.renderTravellerLayer(ae,"endX"),(ee||ne||de||xe||V)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(c){var y=c.x,w=c.y,P=c.width,a=c.height,R=c.stroke,z=Math.floor(w+a/2)-1;return ct.createElement(ct.Fragment,null,ct.createElement("rect",{x:y,y:w,width:P,height:a,fill:R,stroke:"none"}),ct.createElement("line",{x1:y+1,y1:z,x2:y+P-1,y2:z,fill:"none",stroke:"#fff"}),ct.createElement("line",{x1:y+1,y1:z+2,x2:y+P-1,y2:z+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(c,y){var w;return ct.isValidElement(c)?w=ct.cloneElement(c,y):Zn(c)?w=c(y):w=n.renderDefaultTraveller(y),w}},{key:"getDerivedStateFromProps",value:function(c,y){var w=c.data,P=c.width,a=c.x,R=c.travellerWidth,z=c.updateId,$=c.startIndex,V=c.endIndex;if(w!==y.prevData||z!==y.prevUpdateId)return $T({prevData:w,prevTravellerWidth:R,prevUpdateId:z,prevX:a,prevWidth:P},w&&w.length?qJ({data:w,width:P,x:a,travellerWidth:R,startIndex:$,endIndex:V}):{scale:null,scaleValues:null});if(y.scale&&(P!==y.prevWidth||a!==y.prevX||R!==y.prevTravellerWidth)){y.scale.range([a,a+P-R]);var W=y.scale.domain().map(function(ie){return y.scale(ie)});return{prevData:w,prevTravellerWidth:R,prevUpdateId:z,prevX:a,prevWidth:P,startX:y.scale(c.startIndex),endX:y.scale(c.endIndex),scaleValues:W}}return null}},{key:"getIndexInRange",value:function(c,y){for(var w=c.length,P=0,a=w-1;a-P>1;){var R=Math.floor((P+a)/2);c[R]>y?a=R:P=R}return y>=c[a]?a:P}}])})(ir.PureComponent);Zl(Mg,"displayName","Brush");Zl(Mg,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var qT,$L;function GJ(){if($L)return qT;$L=1;var r=QA();function n(l,c){var y;return r(l,function(w,P,a){return y=c(w,P,a),!y}),!!y}return qT=n,qT}var GT,qL;function HJ(){if(qL)return GT;qL=1;var r=vF(),n=Fh(),l=GJ(),c=bl(),y=px();function w(P,a,R){var z=c(P)?r:l;return R&&y(P,a,R)&&(a=void 0),z(P,n(a,3))}return GT=w,GT}var WJ=HJ();const ZJ=Xi(WJ);var Dh=function(n,l){var c=n.alwaysShow,y=n.ifOverflow;return c&&(y="extendDomain"),y===l},HT,GL;function XJ(){if(GL)return HT;GL=1;var r=FF();function n(l,c,y){c=="__proto__"&&r?r(l,c,{configurable:!0,enumerable:!0,value:y,writable:!0}):l[c]=y}return HT=n,HT}var WT,HL;function KJ(){if(HL)return WT;HL=1;var r=XJ(),n=zF(),l=Fh();function c(y,w){var P={};return w=l(w,3),n(y,function(a,R,z){r(P,R,w(a,R,z))}),P}return WT=c,WT}var YJ=KJ();const JJ=Xi(YJ);var ZT,WL;function QJ(){if(WL)return ZT;WL=1;function r(n,l){for(var c=-1,y=n==null?0:n.length;++c<y;)if(!l(n[c],c,n))return!1;return!0}return ZT=r,ZT}var XT,ZL;function eQ(){if(ZL)return XT;ZL=1;var r=QA();function n(l,c){var y=!0;return r(l,function(w,P,a){return y=!!c(w,P,a),y}),y}return XT=n,XT}var KT,XL;function tQ(){if(XL)return KT;XL=1;var r=QJ(),n=eQ(),l=Fh(),c=bl(),y=px();function w(P,a,R){var z=c(P)?r:n;return R&&y(P,a,R)&&(a=void 0),z(P,l(a,3))}return KT=w,KT}var rQ=tQ();const TN=Xi(rQ);var nQ=["x","y"];function zy(r){"@babel/helpers - typeof";return zy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},zy(r)}function dA(){return dA=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},dA.apply(this,arguments)}function KL(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function X_(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?KL(Object(l),!0).forEach(function(c){iQ(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):KL(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function iQ(r,n,l){return n=oQ(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function oQ(r){var n=aQ(r,"string");return zy(n)=="symbol"?n:n+""}function aQ(r,n){if(zy(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(zy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function sQ(r,n){if(r==null)return{};var l=lQ(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function lQ(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}function uQ(r,n){var l=r.x,c=r.y,y=sQ(r,nQ),w="".concat(l),P=parseInt(w,10),a="".concat(c),R=parseInt(a,10),z="".concat(n.height||y.height),$=parseInt(z,10),V="".concat(n.width||y.width),W=parseInt(V,10);return X_(X_(X_(X_(X_({},n),y),P?{x:P}:{}),R?{y:R}:{}),{},{height:$,width:W,name:n.name,radius:n.radius})}function YL(r){return ct.createElement(_N,dA({shapeType:"rectangle",propTransformer:uQ,activeClassName:"recharts-active-bar"},r))}var cQ=function(n){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(c,y){if(typeof n=="number")return n;var w=Rr(c)||z6(c);return w?n(c,y):(w||pm(),l)}},hQ=["value","background"],EN;function Og(r){"@babel/helpers - typeof";return Og=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Og(r)}function fQ(r,n){if(r==null)return{};var l=dQ(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function dQ(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}function W0(){return W0=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},W0.apply(this,arguments)}function JL(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function xa(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?JL(Object(l),!0).forEach(function(c){lp(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):JL(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function pQ(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function QL(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,PN(c.key),c)}}function mQ(r,n,l){return n&&QL(r.prototype,n),l&&QL(r,l),Object.defineProperty(r,"prototype",{writable:!1}),r}function gQ(r,n,l){return n=Z0(n),_Q(r,AN()?Reflect.construct(n,l||[],Z0(r).constructor):n.apply(r,l))}function _Q(r,n){if(n&&(Og(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return yQ(r)}function yQ(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function AN(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(AN=function(){return!!r})()}function Z0(r){return Z0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},Z0(r)}function vQ(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&pA(r,n)}function pA(r,n){return pA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},pA(r,n)}function lp(r,n,l){return n=PN(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function PN(r){var n=xQ(r,"string");return Og(n)=="symbol"?n:n+""}function xQ(r,n){if(Og(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Og(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var bm=(function(r){function n(){var l;pQ(this,n);for(var c=arguments.length,y=new Array(c),w=0;w<c;w++)y[w]=arguments[w];return l=gQ(this,n,[].concat(y)),lp(l,"state",{isAnimationFinished:!1}),lp(l,"id",Vy("recharts-bar-")),lp(l,"handleAnimationEnd",function(){var P=l.props.onAnimationEnd;l.setState({isAnimationFinished:!0}),P&&P()}),lp(l,"handleAnimationStart",function(){var P=l.props.onAnimationStart;l.setState({isAnimationFinished:!1}),P&&P()}),l}return vQ(n,r),mQ(n,[{key:"renderRectanglesStatically",value:function(c){var y=this,w=this.props,P=w.shape,a=w.dataKey,R=w.activeIndex,z=w.activeBar,$=Vn(this.props,!1);return c&&c.map(function(V,W){var ie=W===R,ae=ie?z:P,ee=xa(xa(xa({},$),V),{},{isActive:ie,option:ae,index:W,dataKey:a,onAnimationStart:y.handleAnimationStart,onAnimationEnd:y.handleAnimationEnd});return ct.createElement(eo,W0({className:"recharts-bar-rectangle"},hm(y.props,V,W),{key:"rectangle-".concat(V?.x,"-").concat(V?.y,"-").concat(V?.value,"-").concat(W)}),ct.createElement(YL,ee))})}},{key:"renderRectanglesWithAnimation",value:function(){var c=this,y=this.props,w=y.data,P=y.layout,a=y.isAnimationActive,R=y.animationBegin,z=y.animationDuration,$=y.animationEasing,V=y.animationId,W=this.state.prevData;return ct.createElement(Gf,{begin:R,duration:z,isActive:a,easing:$,from:{t:0},to:{t:1},key:"bar-".concat(V),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(ie){var ae=ie.t,ee=w.map(function(ne,de){var xe=W&&W[de];if(xe){var be=op(xe.x,ne.x),ke=op(xe.y,ne.y),he=op(xe.width,ne.width),_e=op(xe.height,ne.height);return xa(xa({},ne),{},{x:be(ae),y:ke(ae),width:he(ae),height:_e(ae)})}if(P==="horizontal"){var ze=op(0,ne.height),Ne=ze(ae);return xa(xa({},ne),{},{y:ne.y+ne.height-Ne,height:Ne})}var rt=op(0,ne.width),kt=rt(ae);return xa(xa({},ne),{},{width:kt})});return ct.createElement(eo,null,c.renderRectanglesStatically(ee))})}},{key:"renderRectangles",value:function(){var c=this.props,y=c.data,w=c.isAnimationActive,P=this.state.prevData;return w&&y&&y.length&&(!P||!Tx(P,y))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(y)}},{key:"renderBackground",value:function(){var c=this,y=this.props,w=y.data,P=y.dataKey,a=y.activeIndex,R=Vn(this.props.background,!1);return w.map(function(z,$){z.value;var V=z.background,W=fQ(z,hQ);if(!V)return null;var ie=xa(xa(xa(xa(xa({},W),{},{fill:"#eee"},V),R),hm(c.props,z,$)),{},{onAnimationStart:c.handleAnimationStart,onAnimationEnd:c.handleAnimationEnd,dataKey:P,index:$,className:"recharts-bar-background-rectangle"});return ct.createElement(YL,W0({key:"background-bar-".concat($),option:c.props.background,isActive:$===a},ie))})}},{key:"renderErrorBar",value:function(c,y){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var w=this.props,P=w.data,a=w.xAxis,R=w.yAxis,z=w.layout,$=w.children,V=Vu($,Px);if(!V)return null;var W=z==="vertical"?P[0].height/2:P[0].width/2,ie=function(ne,de){var xe=Array.isArray(ne.value)?ne.value[1]:ne.value;return{x:ne.x,y:ne.y,value:xe,errorVal:Cs(ne,de)}},ae={clipPath:c?"url(#clipPath-".concat(y,")"):null};return ct.createElement(eo,ae,V.map(function(ee){return ct.cloneElement(ee,{key:"error-bar-".concat(y,"-").concat(ee.props.dataKey),data:P,xAxis:a,yAxis:R,layout:z,offset:W,dataPointFormatter:ie})}))}},{key:"render",value:function(){var c=this.props,y=c.hide,w=c.data,P=c.className,a=c.xAxis,R=c.yAxis,z=c.left,$=c.top,V=c.width,W=c.height,ie=c.isAnimationActive,ae=c.background,ee=c.id;if(y||!w||!w.length)return null;var ne=this.state.isAnimationFinished,de=ui("recharts-bar",P),xe=a&&a.allowDataOverflow,be=R&&R.allowDataOverflow,ke=xe||be,he=xi(ee)?this.id:ee;return ct.createElement(eo,{className:de},xe||be?ct.createElement("defs",null,ct.createElement("clipPath",{id:"clipPath-".concat(he)},ct.createElement("rect",{x:xe?z:z-V/2,y:be?$:$-W/2,width:xe?V:V*2,height:be?W:W*2}))):null,ct.createElement(eo,{className:"recharts-bar-rectangles",clipPath:ke?"url(#clipPath-".concat(he,")"):null},ae?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(ke,he),(!ie||ne)&&hp.renderCallByParent(this.props,w))}}],[{key:"getDerivedStateFromProps",value:function(c,y){return c.animationId!==y.prevAnimationId?{prevAnimationId:c.animationId,curData:c.data,prevData:y.curData}:c.data!==y.curData?{curData:c.data}:null}}])})(ir.PureComponent);EN=bm;lp(bm,"displayName","Bar");lp(bm,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Gg.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});lp(bm,"getComposedData",function(r){var n=r.props,l=r.item,c=r.barPosition,y=r.bandSize,w=r.xAxis,P=r.yAxis,a=r.xAxisTicks,R=r.yAxisTicks,z=r.stackedData,$=r.dataStartIndex,V=r.displayedData,W=r.offset,ie=X9(c,l);if(!ie)return null;var ae=n.layout,ee=l.type.defaultProps,ne=ee!==void 0?xa(xa({},ee),l.props):l.props,de=ne.dataKey,xe=ne.children,be=ne.minPointSize,ke=ae==="horizontal"?P:w,he=z?ke.scale.domain():null,_e=rZ({numericAxis:ke}),ze=Vu(xe,qy),Ne=V.map(function(rt,kt){var He,yt,gt,Pt,xt,Tt;z?He=K9(z[$+kt],he):(He=Cs(rt,de),Array.isArray(He)||(He=[_e,He]));var Ht=cQ(be,EN.defaultProps.minPointSize)(He[1],kt);if(ae==="horizontal"){var lt,Wt=[P.scale(He[0]),P.scale(He[1])],Zt=Wt[0],$e=Wt[1];yt=Tz({axis:w,ticks:a,bandSize:y,offset:ie.offset,entry:rt,index:kt}),gt=(lt=$e??Zt)!==null&&lt!==void 0?lt:void 0,Pt=ie.size;var pt=Zt-$e;if(xt=Number.isNaN(pt)?0:pt,Tt={x:yt,y:P.y,width:Pt,height:P.height},Math.abs(Ht)>0&&Math.abs(xt)<Math.abs(Ht)){var fr=Xs(xt||Ht)*(Math.abs(Ht)-Math.abs(xt));gt-=fr,xt+=fr}}else{var zr=[w.scale(He[0]),w.scale(He[1])],Hr=zr[0],Ir=zr[1];if(yt=Hr,gt=Tz({axis:P,ticks:R,bandSize:y,offset:ie.offset,entry:rt,index:kt}),Pt=Ir-Hr,xt=ie.size,Tt={x:w.x,y:gt,width:w.width,height:xt},Math.abs(Ht)>0&&Math.abs(Pt)<Math.abs(Ht)){var Lr=Xs(Pt||Ht)*(Math.abs(Ht)-Math.abs(Pt));Pt+=Lr}}return xa(xa(xa({},rt),{},{x:yt,y:gt,width:Pt,height:xt,value:z?He:He[1],payload:rt,background:Tt},ze&&ze[kt]&&ze[kt].props),{},{tooltipPayload:[QB(l,rt)],tooltipPosition:{x:yt+Pt/2,y:gt+xt/2}})});return xa({data:Ne,layout:ae},W)});function Ly(r){"@babel/helpers - typeof";return Ly=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ly(r)}function bQ(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function e3(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,IN(c.key),c)}}function wQ(r,n,l){return n&&e3(r.prototype,n),l&&e3(r,l),Object.defineProperty(r,"prototype",{writable:!1}),r}function t3(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Bc(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?t3(Object(l),!0).forEach(function(c){Dx(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):t3(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function Dx(r,n,l){return n=IN(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function IN(r){var n=SQ(r,"string");return Ly(n)=="symbol"?n:n+""}function SQ(r,n){if(Ly(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Ly(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}var TQ=function(n,l,c,y,w){var P=n.width,a=n.height,R=n.layout,z=n.children,$=Object.keys(l),V={left:c.left,leftMirror:c.left,right:P-c.right,rightMirror:P-c.right,top:c.top,topMirror:c.top,bottom:a-c.bottom,bottomMirror:a-c.bottom},W=!!Xl(z,bm);return $.reduce(function(ie,ae){var ee=l[ae],ne=ee.orientation,de=ee.domain,xe=ee.padding,be=xe===void 0?{}:xe,ke=ee.mirror,he=ee.reversed,_e="".concat(ne).concat(ke?"Mirror":""),ze,Ne,rt,kt,He;if(ee.type==="number"&&(ee.padding==="gap"||ee.padding==="no-gap")){var yt=de[1]-de[0],gt=1/0,Pt=ee.categoricalDomain.sort(B6);if(Pt.forEach(function(zr,Hr){Hr>0&&(gt=Math.min((zr||0)-(Pt[Hr-1]||0),gt))}),Number.isFinite(gt)){var xt=gt/yt,Tt=ee.layout==="vertical"?c.height:c.width;if(ee.padding==="gap"&&(ze=xt*Tt/2),ee.padding==="no-gap"){var Ht=Ks(n.barCategoryGap,xt*Tt),lt=xt*Tt/2;ze=lt-Ht-(lt-Ht)/Tt*Ht}}}y==="xAxis"?Ne=[c.left+(be.left||0)+(ze||0),c.left+c.width-(be.right||0)-(ze||0)]:y==="yAxis"?Ne=R==="horizontal"?[c.top+c.height-(be.bottom||0),c.top+(be.top||0)]:[c.top+(be.top||0)+(ze||0),c.top+c.height-(be.bottom||0)-(ze||0)]:Ne=ee.range,he&&(Ne=[Ne[1],Ne[0]]);var Wt=XB(ee,w,W),Zt=Wt.scale,$e=Wt.realScaleType;Zt.domain(de).range(Ne),KB(Zt);var pt=YB(Zt,Bc(Bc({},ee),{},{realScaleType:$e}));y==="xAxis"?(He=ne==="top"&&!ke||ne==="bottom"&&ke,rt=c.left,kt=V[_e]-He*ee.height):y==="yAxis"&&(He=ne==="left"&&!ke||ne==="right"&&ke,rt=V[_e]-He*ee.width,kt=c.top);var fr=Bc(Bc(Bc({},ee),pt),{},{realScaleType:$e,x:rt,y:kt,scale:Zt,width:y==="xAxis"?c.width:ee.width,height:y==="yAxis"?c.height:ee.height});return fr.bandSize=R0(fr,pt),!ee.hide&&y==="xAxis"?V[_e]+=(He?-1:1)*fr.height:ee.hide||(V[_e]+=(He?-1:1)*fr.width),Bc(Bc({},ie),{},Dx({},ae,fr))},{})},CN=function(n,l){var c=n.x,y=n.y,w=l.x,P=l.y;return{x:Math.min(c,w),y:Math.min(y,P),width:Math.abs(w-c),height:Math.abs(P-y)}},EQ=function(n){var l=n.x1,c=n.y1,y=n.x2,w=n.y2;return CN({x:l,y:c},{x:y,y:w})},MN=(function(){function r(n){bQ(this,r),this.scale=n}return wQ(r,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(l){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},y=c.bandAware,w=c.position;if(l!==void 0){if(w)switch(w){case"start":return this.scale(l);case"middle":{var P=this.bandwidth?this.bandwidth()/2:0;return this.scale(l)+P}case"end":{var a=this.bandwidth?this.bandwidth():0;return this.scale(l)+a}default:return this.scale(l)}if(y){var R=this.bandwidth?this.bandwidth()/2:0;return this.scale(l)+R}return this.scale(l)}}},{key:"isInRange",value:function(l){var c=this.range(),y=c[0],w=c[c.length-1];return y<=w?l>=y&&l<=w:l>=w&&l<=y}}],[{key:"create",value:function(l){return new r(l)}}])})();Dx(MN,"EPS",1e-4);var M2=function(n){var l=Object.keys(n).reduce(function(c,y){return Bc(Bc({},c),{},Dx({},y,MN.create(n[y])))},{});return Bc(Bc({},l),{},{apply:function(y){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},P=w.bandAware,a=w.position;return JJ(y,function(R,z){return l[z].apply(R,{bandAware:P,position:a})})},isInRange:function(y){return TN(y,function(w,P){return l[P].isInRange(w)})}})};function AQ(r){return(r%180+180)%180}var PQ=function(n){var l=n.width,c=n.height,y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,w=AQ(y),P=w*Math.PI/180,a=Math.atan(c/l),R=P>a&&P<Math.PI-a?c/Math.sin(P):l/Math.cos(P);return Math.abs(R)},YT,r3;function IQ(){if(r3)return YT;r3=1;var r=Fh(),n=$y(),l=fx();function c(y){return function(w,P,a){var R=Object(w);if(!n(w)){var z=r(P,3);w=l(w),P=function(V){return z(R[V],V,R)}}var $=y(w,P,a);return $>-1?R[z?w[$]:$]:void 0}}return YT=c,YT}var JT,n3;function CQ(){if(n3)return JT;n3=1;var r=xN();function n(l){var c=r(l),y=c%1;return c===c?y?c-y:c:0}return JT=n,JT}var QT,i3;function MQ(){if(i3)return QT;i3=1;var r=MF(),n=Fh(),l=CQ(),c=Math.max;function y(w,P,a){var R=w==null?0:w.length;if(!R)return-1;var z=a==null?0:l(a);return z<0&&(z=c(R+z,0)),r(w,n(P,3),z)}return QT=y,QT}var eE,o3;function OQ(){if(o3)return eE;o3=1;var r=IQ(),n=MQ(),l=r(n);return eE=l,eE}var RQ=OQ();const kQ=Xi(RQ);var DQ=H3();const zQ=Xi(DQ);var LQ=zQ(function(r){return{x:r.left,y:r.top,width:r.width,height:r.height}},function(r){return["l",r.left,"t",r.top,"w",r.width,"h",r.height].join("")}),O2=ir.createContext(void 0),R2=ir.createContext(void 0),ON=ir.createContext(void 0),RN=ir.createContext({}),kN=ir.createContext(void 0),DN=ir.createContext(0),zN=ir.createContext(0),a3=function(n){var l=n.state,c=l.xAxisMap,y=l.yAxisMap,w=l.offset,P=n.clipPathId,a=n.children,R=n.width,z=n.height,$=LQ(w);return ct.createElement(O2.Provider,{value:c},ct.createElement(R2.Provider,{value:y},ct.createElement(RN.Provider,{value:w},ct.createElement(ON.Provider,{value:$},ct.createElement(kN.Provider,{value:P},ct.createElement(DN.Provider,{value:z},ct.createElement(zN.Provider,{value:R},a)))))))},FQ=function(){return ir.useContext(kN)},LN=function(n){var l=ir.useContext(O2);l==null&&pm();var c=l[n];return c==null&&pm(),c},BQ=function(){var n=ir.useContext(O2);return sp(n)},NQ=function(){var n=ir.useContext(R2),l=kQ(n,function(c){return TN(c.domain,Number.isFinite)});return l||sp(n)},FN=function(n){var l=ir.useContext(R2);l==null&&pm();var c=l[n];return c==null&&pm(),c},jQ=function(){var n=ir.useContext(ON);return n},UQ=function(){return ir.useContext(RN)},k2=function(){return ir.useContext(zN)},D2=function(){return ir.useContext(DN)};function Rg(r){"@babel/helpers - typeof";return Rg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Rg(r)}function VQ(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function $Q(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,NN(c.key),c)}}function qQ(r,n,l){return n&&$Q(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function GQ(r,n,l){return n=X0(n),HQ(r,BN()?Reflect.construct(n,l||[],X0(r).constructor):n.apply(r,l))}function HQ(r,n){if(n&&(Rg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WQ(r)}function WQ(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function BN(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(BN=function(){return!!r})()}function X0(r){return X0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},X0(r)}function ZQ(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&mA(r,n)}function mA(r,n){return mA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},mA(r,n)}function s3(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function l3(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?s3(Object(l),!0).forEach(function(c){z2(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):s3(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function z2(r,n,l){return n=NN(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function NN(r){var n=XQ(r,"string");return Rg(n)=="symbol"?n:n+""}function XQ(r,n){if(Rg(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Rg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function KQ(r,n){return eee(r)||QQ(r,n)||JQ(r,n)||YQ()}function YQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JQ(r,n){if(r){if(typeof r=="string")return u3(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return u3(r,n)}}function u3(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function QQ(r,n){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var c,y,w,P,a=[],R=!0,z=!1;try{if(w=(l=l.call(r)).next,n!==0)for(;!(R=(c=w.call(l)).done)&&(a.push(c.value),a.length!==n);R=!0);}catch($){z=!0,y=$}finally{try{if(!R&&l.return!=null&&(P=l.return(),Object(P)!==P))return}finally{if(z)throw y}}return a}}function eee(r){if(Array.isArray(r))return r}function gA(){return gA=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},gA.apply(this,arguments)}var tee=function(n,l){var c;return ct.isValidElement(n)?c=ct.cloneElement(n,l):Zn(n)?c=n(l):c=ct.createElement("line",gA({},l,{className:"recharts-reference-line-line"})),c},ree=function(n,l,c,y,w,P,a,R,z){var $=w.x,V=w.y,W=w.width,ie=w.height;if(c){var ae=z.y,ee=n.y.apply(ae,{position:P});if(Dh(z,"discard")&&!n.y.isInRange(ee))return null;var ne=[{x:$+W,y:ee},{x:$,y:ee}];return R==="left"?ne.reverse():ne}if(l){var de=z.x,xe=n.x.apply(de,{position:P});if(Dh(z,"discard")&&!n.x.isInRange(xe))return null;var be=[{x:xe,y:V+ie},{x:xe,y:V}];return a==="top"?be.reverse():be}if(y){var ke=z.segment,he=ke.map(function(_e){return n.apply(_e,{position:P})});return Dh(z,"discard")&&ZJ(he,function(_e){return!n.isInRange(_e)})?null:he}return null};function nee(r){var n=r.x,l=r.y,c=r.segment,y=r.xAxisId,w=r.yAxisId,P=r.shape,a=r.className,R=r.alwaysShow,z=FQ(),$=LN(y),V=FN(w),W=jQ();if(!z||!W)return null;jc(R===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var ie=M2({x:$.scale,y:V.scale}),ae=za(n),ee=za(l),ne=c&&c.length===2,de=ree(ie,ae,ee,ne,W,r.position,$.orientation,V.orientation,r);if(!de)return null;var xe=KQ(de,2),be=xe[0],ke=be.x,he=be.y,_e=xe[1],ze=_e.x,Ne=_e.y,rt=Dh(r,"hidden")?"url(#".concat(z,")"):void 0,kt=l3(l3({clipPath:rt},Vn(r,!0)),{},{x1:ke,y1:he,x2:ze,y2:Ne});return ct.createElement(eo,{className:ui("recharts-reference-line",a)},tee(P,kt),Qa.renderCallByParent(r,EQ({x1:ke,y1:he,x2:ze,y2:Ne})))}var L2=(function(r){function n(){return VQ(this,n),GQ(this,n,arguments)}return ZQ(n,r),qQ(n,[{key:"render",value:function(){return ct.createElement(nee,this.props)}}])})(ct.Component);z2(L2,"displayName","ReferenceLine");z2(L2,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function _A(){return _A=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},_A.apply(this,arguments)}function kg(r){"@babel/helpers - typeof";return kg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},kg(r)}function c3(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function h3(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?c3(Object(l),!0).forEach(function(c){zx(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):c3(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function iee(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function oee(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,UN(c.key),c)}}function aee(r,n,l){return n&&oee(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function see(r,n,l){return n=K0(n),lee(r,jN()?Reflect.construct(n,l||[],K0(r).constructor):n.apply(r,l))}function lee(r,n){if(n&&(kg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return uee(r)}function uee(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function jN(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(jN=function(){return!!r})()}function K0(r){return K0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},K0(r)}function cee(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&yA(r,n)}function yA(r,n){return yA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},yA(r,n)}function zx(r,n,l){return n=UN(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function UN(r){var n=hee(r,"string");return kg(n)=="symbol"?n:n+""}function hee(r,n){if(kg(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(kg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var fee=function(n){var l=n.x,c=n.y,y=n.xAxis,w=n.yAxis,P=M2({x:y.scale,y:w.scale}),a=P.apply({x:l,y:c},{bandAware:!0});return Dh(n,"discard")&&!P.isInRange(a)?null:a},Lx=(function(r){function n(){return iee(this,n),see(this,n,arguments)}return cee(n,r),aee(n,[{key:"render",value:function(){var c=this.props,y=c.x,w=c.y,P=c.r,a=c.alwaysShow,R=c.clipPathId,z=za(y),$=za(w);if(jc(a===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!z||!$)return null;var V=fee(this.props);if(!V)return null;var W=V.x,ie=V.y,ae=this.props,ee=ae.shape,ne=ae.className,de=Dh(this.props,"hidden")?"url(#".concat(R,")"):void 0,xe=h3(h3({clipPath:de},Vn(this.props,!0)),{},{cx:W,cy:ie});return ct.createElement(eo,{className:ui("recharts-reference-dot",ne)},n.renderDot(ee,xe),Qa.renderCallByParent(this.props,{x:W-P,y:ie-P,width:2*P,height:2*P}))}}])})(ct.Component);zx(Lx,"displayName","ReferenceDot");zx(Lx,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});zx(Lx,"renderDot",function(r,n){var l;return ct.isValidElement(r)?l=ct.cloneElement(r,n):Zn(r)?l=r(n):l=ct.createElement(C2,_A({},n,{cx:n.cx,cy:n.cy,className:"recharts-reference-dot-dot"})),l});function vA(){return vA=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},vA.apply(this,arguments)}function Dg(r){"@babel/helpers - typeof";return Dg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Dg(r)}function f3(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function d3(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?f3(Object(l),!0).forEach(function(c){Fx(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):f3(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function dee(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function pee(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,$N(c.key),c)}}function mee(r,n,l){return n&&pee(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function gee(r,n,l){return n=Y0(n),_ee(r,VN()?Reflect.construct(n,l||[],Y0(r).constructor):n.apply(r,l))}function _ee(r,n){if(n&&(Dg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return yee(r)}function yee(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function VN(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(VN=function(){return!!r})()}function Y0(r){return Y0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},Y0(r)}function vee(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&xA(r,n)}function xA(r,n){return xA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},xA(r,n)}function Fx(r,n,l){return n=$N(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function $N(r){var n=xee(r,"string");return Dg(n)=="symbol"?n:n+""}function xee(r,n){if(Dg(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Dg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var bee=function(n,l,c,y,w){var P=w.x1,a=w.x2,R=w.y1,z=w.y2,$=w.xAxis,V=w.yAxis;if(!$||!V)return null;var W=M2({x:$.scale,y:V.scale}),ie={x:n?W.x.apply(P,{position:"start"}):W.x.rangeMin,y:c?W.y.apply(R,{position:"start"}):W.y.rangeMin},ae={x:l?W.x.apply(a,{position:"end"}):W.x.rangeMax,y:y?W.y.apply(z,{position:"end"}):W.y.rangeMax};return Dh(w,"discard")&&(!W.isInRange(ie)||!W.isInRange(ae))?null:CN(ie,ae)},Bx=(function(r){function n(){return dee(this,n),gee(this,n,arguments)}return vee(n,r),mee(n,[{key:"render",value:function(){var c=this.props,y=c.x1,w=c.x2,P=c.y1,a=c.y2,R=c.className,z=c.alwaysShow,$=c.clipPathId;jc(z===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var V=za(y),W=za(w),ie=za(P),ae=za(a),ee=this.props.shape;if(!V&&!W&&!ie&&!ae&&!ee)return null;var ne=bee(V,W,ie,ae,this.props);if(!ne&&!ee)return null;var de=Dh(this.props,"hidden")?"url(#".concat($,")"):void 0;return ct.createElement(eo,{className:ui("recharts-reference-area",R)},n.renderRect(ee,d3(d3({clipPath:de},Vn(this.props,!0)),ne)),Qa.renderCallByParent(this.props,ne))}}])})(ct.Component);Fx(Bx,"displayName","ReferenceArea");Fx(Bx,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});Fx(Bx,"renderRect",function(r,n){var l;return ct.isValidElement(r)?l=ct.cloneElement(r,n):Zn(r)?l=r(n):l=ct.createElement(I2,vA({},n,{className:"recharts-reference-area-rect"})),l});function qN(r,n,l){if(n<1)return[];if(n===1&&l===void 0)return r;for(var c=[],y=0;y<r.length;y+=n)c.push(r[y]);return c}function wee(r,n,l){var c={width:r.width+n.width,height:r.height+n.height};return PQ(c,l)}function See(r,n,l){var c=l==="width",y=r.x,w=r.y,P=r.width,a=r.height;return n===1?{start:c?y:w,end:c?y+P:w+a}:{start:c?y+P:w+a,end:c?y:w}}function J0(r,n,l,c,y){if(r*n<r*c||r*n>r*y)return!1;var w=l();return r*(n-r*w/2-c)>=0&&r*(n+r*w/2-y)<=0}function Tee(r,n){return qN(r,n+1)}function Eee(r,n,l,c,y){for(var w=(c||[]).slice(),P=n.start,a=n.end,R=0,z=1,$=P,V=function(){var ae=c?.[R];if(ae===void 0)return{v:qN(c,z)};var ee=R,ne,de=function(){return ne===void 0&&(ne=l(ae,ee)),ne},xe=ae.coordinate,be=R===0||J0(r,xe,de,$,a);be||(R=0,$=P,z+=1),be&&($=xe+r*(de()/2+y),R+=z)},W;z<=w.length;)if(W=V(),W)return W.v;return[]}function Fy(r){"@babel/helpers - typeof";return Fy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Fy(r)}function p3(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Ps(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?p3(Object(l),!0).forEach(function(c){Aee(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):p3(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function Aee(r,n,l){return n=Pee(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function Pee(r){var n=Iee(r,"string");return Fy(n)=="symbol"?n:n+""}function Iee(r,n){if(Fy(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Fy(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function Cee(r,n,l,c,y){for(var w=(c||[]).slice(),P=w.length,a=n.start,R=n.end,z=function(W){var ie=w[W],ae,ee=function(){return ae===void 0&&(ae=l(ie,W)),ae};if(W===P-1){var ne=r*(ie.coordinate+r*ee()/2-R);w[W]=ie=Ps(Ps({},ie),{},{tickCoord:ne>0?ie.coordinate-ne*r:ie.coordinate})}else w[W]=ie=Ps(Ps({},ie),{},{tickCoord:ie.coordinate});var de=J0(r,ie.tickCoord,ee,a,R);de&&(R=ie.tickCoord-r*(ee()/2+y),w[W]=Ps(Ps({},ie),{},{isShow:!0}))},$=P-1;$>=0;$--)z($);return w}function Mee(r,n,l,c,y,w){var P=(c||[]).slice(),a=P.length,R=n.start,z=n.end;if(w){var $=c[a-1],V=l($,a-1),W=r*($.coordinate+r*V/2-z);P[a-1]=$=Ps(Ps({},$),{},{tickCoord:W>0?$.coordinate-W*r:$.coordinate});var ie=J0(r,$.tickCoord,function(){return V},R,z);ie&&(z=$.tickCoord-r*(V/2+y),P[a-1]=Ps(Ps({},$),{},{isShow:!0}))}for(var ae=w?a-1:a,ee=function(xe){var be=P[xe],ke,he=function(){return ke===void 0&&(ke=l(be,xe)),ke};if(xe===0){var _e=r*(be.coordinate-r*he()/2-R);P[xe]=be=Ps(Ps({},be),{},{tickCoord:_e<0?be.coordinate-_e*r:be.coordinate})}else P[xe]=be=Ps(Ps({},be),{},{tickCoord:be.coordinate});var ze=J0(r,be.tickCoord,he,R,z);ze&&(R=be.tickCoord+r*(he()/2+y),P[xe]=Ps(Ps({},be),{},{isShow:!0}))},ne=0;ne<ae;ne++)ee(ne);return P}function F2(r,n,l){var c=r.tick,y=r.ticks,w=r.viewBox,P=r.minTickGap,a=r.orientation,R=r.interval,z=r.tickFormatter,$=r.unit,V=r.angle;if(!y||!y.length||!c)return[];if(Rr(R)||Gg.isSsr)return Tee(y,typeof R=="number"&&Rr(R)?R:0);var W=[],ie=a==="top"||a==="bottom"?"width":"height",ae=$&&ie==="width"?Q_($,{fontSize:n,letterSpacing:l}):{width:0,height:0},ee=function(be,ke){var he=Zn(z)?z(be.value,ke):be.value;return ie==="width"?wee(Q_(he,{fontSize:n,letterSpacing:l}),ae,V):Q_(he,{fontSize:n,letterSpacing:l})[ie]},ne=y.length>=2?Xs(y[1].coordinate-y[0].coordinate):1,de=See(w,ne,ie);return R==="equidistantPreserveStart"?Eee(ne,de,ee,y,P):(R==="preserveStart"||R==="preserveStartEnd"?W=Mee(ne,de,ee,y,P,R==="preserveStartEnd"):W=Cee(ne,de,ee,y,P),W.filter(function(xe){return xe.isShow}))}var Oee=["viewBox"],Ree=["viewBox"],kee=["ticks"];function zg(r){"@babel/helpers - typeof";return zg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},zg(r)}function ug(){return ug=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},ug.apply(this,arguments)}function m3(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function ka(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?m3(Object(l),!0).forEach(function(c){B2(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):m3(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function tE(r,n){if(r==null)return{};var l=Dee(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function Dee(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}function zee(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function g3(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,HN(c.key),c)}}function Lee(r,n,l){return n&&g3(r.prototype,n),l&&g3(r,l),Object.defineProperty(r,"prototype",{writable:!1}),r}function Fee(r,n,l){return n=Q0(n),Bee(r,GN()?Reflect.construct(n,l||[],Q0(r).constructor):n.apply(r,l))}function Bee(r,n){if(n&&(zg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Nee(r)}function Nee(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function GN(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(GN=function(){return!!r})()}function Q0(r){return Q0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},Q0(r)}function jee(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&bA(r,n)}function bA(r,n){return bA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},bA(r,n)}function B2(r,n,l){return n=HN(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function HN(r){var n=Uee(r,"string");return zg(n)=="symbol"?n:n+""}function Uee(r,n){if(zg(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(zg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var Xg=(function(r){function n(l){var c;return zee(this,n),c=Fee(this,n,[l]),c.state={fontSize:"",letterSpacing:""},c}return jee(n,r),Lee(n,[{key:"shouldComponentUpdate",value:function(c,y){var w=c.viewBox,P=tE(c,Oee),a=this.props,R=a.viewBox,z=tE(a,Ree);return!hg(w,R)||!hg(P,z)||!hg(y,this.state)}},{key:"componentDidMount",value:function(){var c=this.layerReference;if(c){var y=c.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];y&&this.setState({fontSize:window.getComputedStyle(y).fontSize,letterSpacing:window.getComputedStyle(y).letterSpacing})}}},{key:"getTickLineCoord",value:function(c){var y=this.props,w=y.x,P=y.y,a=y.width,R=y.height,z=y.orientation,$=y.tickSize,V=y.mirror,W=y.tickMargin,ie,ae,ee,ne,de,xe,be=V?-1:1,ke=c.tickSize||$,he=Rr(c.tickCoord)?c.tickCoord:c.coordinate;switch(z){case"top":ie=ae=c.coordinate,ne=P+ +!V*R,ee=ne-be*ke,xe=ee-be*W,de=he;break;case"left":ee=ne=c.coordinate,ae=w+ +!V*a,ie=ae-be*ke,de=ie-be*W,xe=he;break;case"right":ee=ne=c.coordinate,ae=w+ +V*a,ie=ae+be*ke,de=ie+be*W,xe=he;break;default:ie=ae=c.coordinate,ne=P+ +V*R,ee=ne+be*ke,xe=ee+be*W,de=he;break}return{line:{x1:ie,y1:ee,x2:ae,y2:ne},tick:{x:de,y:xe}}}},{key:"getTickTextAnchor",value:function(){var c=this.props,y=c.orientation,w=c.mirror,P;switch(y){case"left":P=w?"start":"end";break;case"right":P=w?"end":"start";break;default:P="middle";break}return P}},{key:"getTickVerticalAnchor",value:function(){var c=this.props,y=c.orientation,w=c.mirror,P="end";switch(y){case"left":case"right":P="middle";break;case"top":P=w?"start":"end";break;default:P=w?"end":"start";break}return P}},{key:"renderAxisLine",value:function(){var c=this.props,y=c.x,w=c.y,P=c.width,a=c.height,R=c.orientation,z=c.mirror,$=c.axisLine,V=ka(ka(ka({},Vn(this.props,!1)),Vn($,!1)),{},{fill:"none"});if(R==="top"||R==="bottom"){var W=+(R==="top"&&!z||R==="bottom"&&z);V=ka(ka({},V),{},{x1:y,y1:w+W*a,x2:y+P,y2:w+W*a})}else{var ie=+(R==="left"&&!z||R==="right"&&z);V=ka(ka({},V),{},{x1:y+ie*P,y1:w,x2:y+ie*P,y2:w+a})}return ct.createElement("line",ug({},V,{className:ui("recharts-cartesian-axis-line",Yl($,"className"))}))}},{key:"renderTicks",value:function(c,y,w){var P=this,a=this.props,R=a.tickLine,z=a.stroke,$=a.tick,V=a.tickFormatter,W=a.unit,ie=F2(ka(ka({},this.props),{},{ticks:c}),y,w),ae=this.getTickTextAnchor(),ee=this.getTickVerticalAnchor(),ne=Vn(this.props,!1),de=Vn($,!1),xe=ka(ka({},ne),{},{fill:"none"},Vn(R,!1)),be=ie.map(function(ke,he){var _e=P.getTickLineCoord(ke),ze=_e.line,Ne=_e.tick,rt=ka(ka(ka(ka({textAnchor:ae,verticalAnchor:ee},ne),{},{stroke:"none",fill:z},de),Ne),{},{index:he,payload:ke,visibleTicksCount:ie.length,tickFormatter:V});return ct.createElement(eo,ug({className:"recharts-cartesian-axis-tick",key:"tick-".concat(ke.value,"-").concat(ke.coordinate,"-").concat(ke.tickCoord)},hm(P.props,ke,he)),R&&ct.createElement("line",ug({},xe,ze,{className:ui("recharts-cartesian-axis-tick-line",Yl(R,"className"))})),$&&n.renderTickItem($,rt,"".concat(Zn(V)?V(ke.value,he):ke.value).concat(W||"")))});return ct.createElement("g",{className:"recharts-cartesian-axis-ticks"},be)}},{key:"render",value:function(){var c=this,y=this.props,w=y.axisLine,P=y.width,a=y.height,R=y.ticksGenerator,z=y.className,$=y.hide;if($)return null;var V=this.props,W=V.ticks,ie=tE(V,kee),ae=W;return Zn(R)&&(ae=W&&W.length>0?R(this.props):R(ie)),P<=0||a<=0||!ae||!ae.length?null:ct.createElement(eo,{className:ui("recharts-cartesian-axis",z),ref:function(ne){c.layerReference=ne}},w&&this.renderAxisLine(),this.renderTicks(ae,this.state.fontSize,this.state.letterSpacing),Qa.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(c,y,w){var P,a=ui(y.className,"recharts-cartesian-axis-tick-value");return ct.isValidElement(c)?P=ct.cloneElement(c,ka(ka({},y),{},{className:a})):Zn(c)?P=c(ka(ka({},y),{},{className:a})):P=ct.createElement(fm,ug({},y,{className:"recharts-cartesian-axis-tick-value"}),w),P}}])})(ir.Component);B2(Xg,"displayName","CartesianAxis");B2(Xg,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var Vee=["x1","y1","x2","y2","key"],$ee=["offset"];function mm(r){"@babel/helpers - typeof";return mm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},mm(r)}function _3(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function Is(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?_3(Object(l),!0).forEach(function(c){qee(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):_3(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function qee(r,n,l){return n=Gee(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function Gee(r){var n=Hee(r,"string");return mm(n)=="symbol"?n:n+""}function Hee(r,n){if(mm(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(mm(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function sm(){return sm=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},sm.apply(this,arguments)}function y3(r,n){if(r==null)return{};var l=Wee(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function Wee(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}var Zee=function(n){var l=n.fill;if(!l||l==="none")return null;var c=n.fillOpacity,y=n.x,w=n.y,P=n.width,a=n.height,R=n.ry;return ct.createElement("rect",{x:y,y:w,ry:R,width:P,height:a,stroke:"none",fill:l,fillOpacity:c,className:"recharts-cartesian-grid-bg"})};function WN(r,n){var l;if(ct.isValidElement(r))l=ct.cloneElement(r,n);else if(Zn(r))l=r(n);else{var c=n.x1,y=n.y1,w=n.x2,P=n.y2,a=n.key,R=y3(n,Vee),z=Vn(R,!1);z.offset;var $=y3(z,$ee);l=ct.createElement("line",sm({},$,{x1:c,y1:y,x2:w,y2:P,fill:"none",key:a}))}return l}function Xee(r){var n=r.x,l=r.width,c=r.horizontal,y=c===void 0?!0:c,w=r.horizontalPoints;if(!y||!w||!w.length)return null;var P=w.map(function(a,R){var z=Is(Is({},r),{},{x1:n,y1:a,x2:n+l,y2:a,key:"line-".concat(R),index:R});return WN(y,z)});return ct.createElement("g",{className:"recharts-cartesian-grid-horizontal"},P)}function Kee(r){var n=r.y,l=r.height,c=r.vertical,y=c===void 0?!0:c,w=r.verticalPoints;if(!y||!w||!w.length)return null;var P=w.map(function(a,R){var z=Is(Is({},r),{},{x1:a,y1:n,x2:a,y2:n+l,key:"line-".concat(R),index:R});return WN(y,z)});return ct.createElement("g",{className:"recharts-cartesian-grid-vertical"},P)}function Yee(r){var n=r.horizontalFill,l=r.fillOpacity,c=r.x,y=r.y,w=r.width,P=r.height,a=r.horizontalPoints,R=r.horizontal,z=R===void 0?!0:R;if(!z||!n||!n.length)return null;var $=a.map(function(W){return Math.round(W+y-y)}).sort(function(W,ie){return W-ie});y!==$[0]&&$.unshift(0);var V=$.map(function(W,ie){var ae=!$[ie+1],ee=ae?y+P-W:$[ie+1]-W;if(ee<=0)return null;var ne=ie%n.length;return ct.createElement("rect",{key:"react-".concat(ie),y:W,x:c,height:ee,width:w,stroke:"none",fill:n[ne],fillOpacity:l,className:"recharts-cartesian-grid-bg"})});return ct.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},V)}function Jee(r){var n=r.vertical,l=n===void 0?!0:n,c=r.verticalFill,y=r.fillOpacity,w=r.x,P=r.y,a=r.width,R=r.height,z=r.verticalPoints;if(!l||!c||!c.length)return null;var $=z.map(function(W){return Math.round(W+w-w)}).sort(function(W,ie){return W-ie});w!==$[0]&&$.unshift(0);var V=$.map(function(W,ie){var ae=!$[ie+1],ee=ae?w+a-W:$[ie+1]-W;if(ee<=0)return null;var ne=ie%c.length;return ct.createElement("rect",{key:"react-".concat(ie),x:W,y:P,width:ee,height:R,stroke:"none",fill:c[ne],fillOpacity:y,className:"recharts-cartesian-grid-bg"})});return ct.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},V)}var Qee=function(n,l){var c=n.xAxis,y=n.width,w=n.height,P=n.offset;return ZB(F2(Is(Is(Is({},Xg.defaultProps),c),{},{ticks:Nf(c,!0),viewBox:{x:0,y:0,width:y,height:w}})),P.left,P.left+P.width,l)},ete=function(n,l){var c=n.yAxis,y=n.width,w=n.height,P=n.offset;return ZB(F2(Is(Is(Is({},Xg.defaultProps),c),{},{ticks:Nf(c,!0),viewBox:{x:0,y:0,width:y,height:w}})),P.top,P.top+P.height,l)},og={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function ZN(r){var n,l,c,y,w,P,a=k2(),R=D2(),z=UQ(),$=Is(Is({},r),{},{stroke:(n=r.stroke)!==null&&n!==void 0?n:og.stroke,fill:(l=r.fill)!==null&&l!==void 0?l:og.fill,horizontal:(c=r.horizontal)!==null&&c!==void 0?c:og.horizontal,horizontalFill:(y=r.horizontalFill)!==null&&y!==void 0?y:og.horizontalFill,vertical:(w=r.vertical)!==null&&w!==void 0?w:og.vertical,verticalFill:(P=r.verticalFill)!==null&&P!==void 0?P:og.verticalFill,x:Rr(r.x)?r.x:z.left,y:Rr(r.y)?r.y:z.top,width:Rr(r.width)?r.width:z.width,height:Rr(r.height)?r.height:z.height}),V=$.x,W=$.y,ie=$.width,ae=$.height,ee=$.syncWithTicks,ne=$.horizontalValues,de=$.verticalValues,xe=BQ(),be=NQ();if(!Rr(ie)||ie<=0||!Rr(ae)||ae<=0||!Rr(V)||V!==+V||!Rr(W)||W!==+W)return null;var ke=$.verticalCoordinatesGenerator||Qee,he=$.horizontalCoordinatesGenerator||ete,_e=$.horizontalPoints,ze=$.verticalPoints;if((!_e||!_e.length)&&Zn(he)){var Ne=ne&&ne.length,rt=he({yAxis:be?Is(Is({},be),{},{ticks:Ne?ne:be.ticks}):void 0,width:a,height:R,offset:z},Ne?!0:ee);jc(Array.isArray(rt),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(mm(rt),"]")),Array.isArray(rt)&&(_e=rt)}if((!ze||!ze.length)&&Zn(ke)){var kt=de&&de.length,He=ke({xAxis:xe?Is(Is({},xe),{},{ticks:kt?de:xe.ticks}):void 0,width:a,height:R,offset:z},kt?!0:ee);jc(Array.isArray(He),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(mm(He),"]")),Array.isArray(He)&&(ze=He)}return ct.createElement("g",{className:"recharts-cartesian-grid"},ct.createElement(Zee,{fill:$.fill,fillOpacity:$.fillOpacity,x:$.x,y:$.y,width:$.width,height:$.height,ry:$.ry}),ct.createElement(Xee,sm({},$,{offset:z,horizontalPoints:_e,xAxis:xe,yAxis:be})),ct.createElement(Kee,sm({},$,{offset:z,verticalPoints:ze,xAxis:xe,yAxis:be})),ct.createElement(Yee,sm({},$,{horizontalPoints:_e})),ct.createElement(Jee,sm({},$,{verticalPoints:ze})))}ZN.displayName="CartesianGrid";function Lg(r){"@babel/helpers - typeof";return Lg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Lg(r)}function tte(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function rte(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,YN(c.key),c)}}function nte(r,n,l){return n&&rte(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function ite(r,n,l){return n=ex(n),ote(r,XN()?Reflect.construct(n,l||[],ex(r).constructor):n.apply(r,l))}function ote(r,n){if(n&&(Lg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ate(r)}function ate(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function XN(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(XN=function(){return!!r})()}function ex(r){return ex=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},ex(r)}function ste(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&wA(r,n)}function wA(r,n){return wA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},wA(r,n)}function KN(r,n,l){return n=YN(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function YN(r){var n=lte(r,"string");return Lg(n)=="symbol"?n:n+""}function lte(r,n){if(Lg(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Lg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function SA(){return SA=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},SA.apply(this,arguments)}function ute(r){var n=r.xAxisId,l=k2(),c=D2(),y=LN(n);return y==null?null:ir.createElement(Xg,SA({},y,{className:ui("recharts-".concat(y.axisType," ").concat(y.axisType),y.className),viewBox:{x:0,y:0,width:l,height:c},ticksGenerator:function(P){return Nf(P,!0)}}))}var Nx=(function(r){function n(){return tte(this,n),ite(this,n,arguments)}return ste(n,r),nte(n,[{key:"render",value:function(){return ir.createElement(ute,this.props)}}])})(ir.Component);KN(Nx,"displayName","XAxis");KN(Nx,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function Fg(r){"@babel/helpers - typeof";return Fg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Fg(r)}function cte(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function hte(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,ej(c.key),c)}}function fte(r,n,l){return n&&hte(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function dte(r,n,l){return n=tx(n),pte(r,JN()?Reflect.construct(n,l||[],tx(r).constructor):n.apply(r,l))}function pte(r,n){if(n&&(Fg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mte(r)}function mte(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function JN(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(JN=function(){return!!r})()}function tx(r){return tx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},tx(r)}function gte(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&TA(r,n)}function TA(r,n){return TA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},TA(r,n)}function QN(r,n,l){return n=ej(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function ej(r){var n=_te(r,"string");return Fg(n)=="symbol"?n:n+""}function _te(r,n){if(Fg(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Fg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}function EA(){return EA=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},EA.apply(this,arguments)}var yte=function(n){var l=n.yAxisId,c=k2(),y=D2(),w=FN(l);return w==null?null:ir.createElement(Xg,EA({},w,{className:ui("recharts-".concat(w.axisType," ").concat(w.axisType),w.className),viewBox:{x:0,y:0,width:c,height:y},ticksGenerator:function(a){return Nf(a,!0)}}))},jx=(function(r){function n(){return cte(this,n),dte(this,n,arguments)}return gte(n,r),fte(n,[{key:"render",value:function(){return ir.createElement(yte,this.props)}}])})(ir.Component);QN(jx,"displayName","YAxis");QN(jx,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function v3(r){return wte(r)||bte(r)||xte(r)||vte()}function vte(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xte(r,n){if(r){if(typeof r=="string")return AA(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return AA(r,n)}}function bte(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function wte(r){if(Array.isArray(r))return AA(r)}function AA(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}var PA=function(n,l,c,y,w){var P=Vu(n,L2),a=Vu(n,Lx),R=[].concat(v3(P),v3(a)),z=Vu(n,Bx),$="".concat(y,"Id"),V=y[0],W=l;if(R.length&&(W=R.reduce(function(ee,ne){if(ne.props[$]===c&&Dh(ne.props,"extendDomain")&&Rr(ne.props[V])){var de=ne.props[V];return[Math.min(ee[0],de),Math.max(ee[1],de)]}return ee},W)),z.length){var ie="".concat(V,"1"),ae="".concat(V,"2");W=z.reduce(function(ee,ne){if(ne.props[$]===c&&Dh(ne.props,"extendDomain")&&Rr(ne.props[ie])&&Rr(ne.props[ae])){var de=ne.props[ie],xe=ne.props[ae];return[Math.min(ee[0],de,xe),Math.max(ee[1],de,xe)]}return ee},W)}return w&&w.length&&(W=w.reduce(function(ee,ne){return Rr(ne)?[Math.min(ee[0],ne),Math.max(ee[1],ne)]:ee},W)),W},rE={exports:{}},x3;function Ste(){return x3||(x3=1,(function(r){var n=Object.prototype.hasOwnProperty,l="~";function c(){}Object.create&&(c.prototype=Object.create(null),new c().__proto__||(l=!1));function y(R,z,$){this.fn=R,this.context=z,this.once=$||!1}function w(R,z,$,V,W){if(typeof $!="function")throw new TypeError("The listener must be a function");var ie=new y($,V||R,W),ae=l?l+z:z;return R._events[ae]?R._events[ae].fn?R._events[ae]=[R._events[ae],ie]:R._events[ae].push(ie):(R._events[ae]=ie,R._eventsCount++),R}function P(R,z){--R._eventsCount===0?R._events=new c:delete R._events[z]}function a(){this._events=new c,this._eventsCount=0}a.prototype.eventNames=function(){var z=[],$,V;if(this._eventsCount===0)return z;for(V in $=this._events)n.call($,V)&&z.push(l?V.slice(1):V);return Object.getOwnPropertySymbols?z.concat(Object.getOwnPropertySymbols($)):z},a.prototype.listeners=function(z){var $=l?l+z:z,V=this._events[$];if(!V)return[];if(V.fn)return[V.fn];for(var W=0,ie=V.length,ae=new Array(ie);W<ie;W++)ae[W]=V[W].fn;return ae},a.prototype.listenerCount=function(z){var $=l?l+z:z,V=this._events[$];return V?V.fn?1:V.length:0},a.prototype.emit=function(z,$,V,W,ie,ae){var ee=l?l+z:z;if(!this._events[ee])return!1;var ne=this._events[ee],de=arguments.length,xe,be;if(ne.fn){switch(ne.once&&this.removeListener(z,ne.fn,void 0,!0),de){case 1:return ne.fn.call(ne.context),!0;case 2:return ne.fn.call(ne.context,$),!0;case 3:return ne.fn.call(ne.context,$,V),!0;case 4:return ne.fn.call(ne.context,$,V,W),!0;case 5:return ne.fn.call(ne.context,$,V,W,ie),!0;case 6:return ne.fn.call(ne.context,$,V,W,ie,ae),!0}for(be=1,xe=new Array(de-1);be<de;be++)xe[be-1]=arguments[be];ne.fn.apply(ne.context,xe)}else{var ke=ne.length,he;for(be=0;be<ke;be++)switch(ne[be].once&&this.removeListener(z,ne[be].fn,void 0,!0),de){case 1:ne[be].fn.call(ne[be].context);break;case 2:ne[be].fn.call(ne[be].context,$);break;case 3:ne[be].fn.call(ne[be].context,$,V);break;case 4:ne[be].fn.call(ne[be].context,$,V,W);break;default:if(!xe)for(he=1,xe=new Array(de-1);he<de;he++)xe[he-1]=arguments[he];ne[be].fn.apply(ne[be].context,xe)}}return!0},a.prototype.on=function(z,$,V){return w(this,z,$,V,!1)},a.prototype.once=function(z,$,V){return w(this,z,$,V,!0)},a.prototype.removeListener=function(z,$,V,W){var ie=l?l+z:z;if(!this._events[ie])return this;if(!$)return P(this,ie),this;var ae=this._events[ie];if(ae.fn)ae.fn===$&&(!W||ae.once)&&(!V||ae.context===V)&&P(this,ie);else{for(var ee=0,ne=[],de=ae.length;ee<de;ee++)(ae[ee].fn!==$||W&&!ae[ee].once||V&&ae[ee].context!==V)&&ne.push(ae[ee]);ne.length?this._events[ie]=ne.length===1?ne[0]:ne:P(this,ie)}return this},a.prototype.removeAllListeners=function(z){var $;return z?($=l?l+z:z,this._events[$]&&P(this,$)):(this._events=new c,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=l,a.EventEmitter=a,r.exports=a})(rE)),rE.exports}var Tte=Ste();const Ete=Xi(Tte);var nE=new Ete,iE="recharts.syncMouseEvents";function By(r){"@babel/helpers - typeof";return By=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},By(r)}function Ate(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function Pte(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,tj(c.key),c)}}function Ite(r,n,l){return n&&Pte(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function oE(r,n,l){return n=tj(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function tj(r){var n=Cte(r,"string");return By(n)=="symbol"?n:n+""}function Cte(r,n){if(By(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(By(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)}var Mte=(function(){function r(){Ate(this,r),oE(this,"activeIndex",0),oE(this,"coordinateList",[]),oE(this,"layout","horizontal")}return Ite(r,[{key:"setDetails",value:function(l){var c,y=l.coordinateList,w=y===void 0?null:y,P=l.container,a=P===void 0?null:P,R=l.layout,z=R===void 0?null:R,$=l.offset,V=$===void 0?null:$,W=l.mouseHandlerCallback,ie=W===void 0?null:W;this.coordinateList=(c=w??this.coordinateList)!==null&&c!==void 0?c:[],this.container=a??this.container,this.layout=z??this.layout,this.offset=V??this.offset,this.mouseHandlerCallback=ie??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(l){if(this.coordinateList.length!==0)switch(l.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(l){this.activeIndex=l}},{key:"spoofMouse",value:function(){var l,c;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var y=this.container.getBoundingClientRect(),w=y.x,P=y.y,a=y.height,R=this.coordinateList[this.activeIndex].coordinate,z=((l=window)===null||l===void 0?void 0:l.scrollX)||0,$=((c=window)===null||c===void 0?void 0:c.scrollY)||0,V=w+R+z,W=P+this.offset.top+a/2+$;this.mouseHandlerCallback({pageX:V,pageY:W})}}}])})();function Ote(r,n,l){if(l==="number"&&n===!0&&Array.isArray(r)){var c=r?.[0],y=r?.[1];if(c&&y&&Rr(c)&&Rr(y))return!0}return!1}function Rte(r,n,l,c){var y=c/2;return{stroke:"none",fill:"#ccc",x:r==="horizontal"?n.x-y:l.left+.5,y:r==="horizontal"?l.top+.5:n.y-y,width:r==="horizontal"?c:l.width-1,height:r==="horizontal"?l.height-1:c}}function rj(r){var n=r.cx,l=r.cy,c=r.radius,y=r.startAngle,w=r.endAngle,P=yo(n,l,c,y),a=yo(n,l,c,w);return{points:[P,a],cx:n,cy:l,radius:c,startAngle:y,endAngle:w}}function kte(r,n,l){var c,y,w,P;if(r==="horizontal")c=n.x,w=c,y=l.top,P=l.top+l.height;else if(r==="vertical")y=n.y,P=y,c=l.left,w=l.left+l.width;else if(n.cx!=null&&n.cy!=null)if(r==="centric"){var a=n.cx,R=n.cy,z=n.innerRadius,$=n.outerRadius,V=n.angle,W=yo(a,R,z,V),ie=yo(a,R,$,V);c=W.x,y=W.y,w=ie.x,P=ie.y}else return rj(n);return[{x:c,y},{x:w,y:P}]}function Ny(r){"@babel/helpers - typeof";return Ny=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ny(r)}function b3(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function r0(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?b3(Object(l),!0).forEach(function(c){Dte(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):b3(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function Dte(r,n,l){return n=zte(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function zte(r){var n=Lte(r,"string");return Ny(n)=="symbol"?n:n+""}function Lte(r,n){if(Ny(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Ny(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}function Fte(r){var n,l,c=r.element,y=r.tooltipEventType,w=r.isActive,P=r.activeCoordinate,a=r.activePayload,R=r.offset,z=r.activeTooltipIndex,$=r.tooltipAxisBandSize,V=r.layout,W=r.chartName,ie=(n=c.props.cursor)!==null&&n!==void 0?n:(l=c.type.defaultProps)===null||l===void 0?void 0:l.cursor;if(!c||!ie||!w||!P||W!=="ScatterChart"&&y!=="axis")return null;var ae,ee=KE;if(W==="ScatterChart")ae=P,ee=yY;else if(W==="BarChart")ae=Rte(V,P,R,$),ee=I2;else if(V==="radial"){var ne=rj(P),de=ne.cx,xe=ne.cy,be=ne.radius,ke=ne.startAngle,he=ne.endAngle;ae={cx:de,cy:xe,startAngle:ke,endAngle:he,innerRadius:be,outerRadius:be},ee=oN}else ae={points:kte(V,P,R)},ee=KE;var _e=r0(r0(r0(r0({stroke:"#ccc",pointerEvents:"none"},R),ae),Vn(ie,!1)),{},{payload:a,payloadIndex:z,className:ui("recharts-tooltip-cursor",ie.className)});return ir.isValidElement(ie)?ir.cloneElement(ie,_e):ir.createElement(ee,_e)}var Bte=["item"],Nte=["children","className","width","height","style","compact","title","desc"];function Bg(r){"@babel/helpers - typeof";return Bg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Bg(r)}function cg(){return cg=Object.assign?Object.assign.bind():function(r){for(var n=1;n<arguments.length;n++){var l=arguments[n];for(var c in l)Object.prototype.hasOwnProperty.call(l,c)&&(r[c]=l[c])}return r},cg.apply(this,arguments)}function w3(r,n){return Vte(r)||Ute(r,n)||ij(r,n)||jte()}function jte(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ute(r,n){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var c,y,w,P,a=[],R=!0,z=!1;try{if(w=(l=l.call(r)).next,n!==0)for(;!(R=(c=w.call(l)).done)&&(a.push(c.value),a.length!==n);R=!0);}catch($){z=!0,y=$}finally{try{if(!R&&l.return!=null&&(P=l.return(),Object(P)!==P))return}finally{if(z)throw y}}return a}}function Vte(r){if(Array.isArray(r))return r}function S3(r,n){if(r==null)return{};var l=$te(r,n),c,y;if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(r);for(y=0;y<w.length;y++)c=w[y],!(n.indexOf(c)>=0)&&Object.prototype.propertyIsEnumerable.call(r,c)&&(l[c]=r[c])}return l}function $te(r,n){if(r==null)return{};var l={};for(var c in r)if(Object.prototype.hasOwnProperty.call(r,c)){if(n.indexOf(c)>=0)continue;l[c]=r[c]}return l}function qte(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}function Gte(r,n){for(var l=0;l<n.length;l++){var c=n[l];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(r,oj(c.key),c)}}function Hte(r,n,l){return n&&Gte(r.prototype,n),Object.defineProperty(r,"prototype",{writable:!1}),r}function Wte(r,n,l){return n=rx(n),Zte(r,nj()?Reflect.construct(n,l||[],rx(r).constructor):n.apply(r,l))}function Zte(r,n){if(n&&(Bg(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Xte(r)}function Xte(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function nj(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nj=function(){return!!r})()}function rx(r){return rx=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},rx(r)}function Kte(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&IA(r,n)}function IA(r,n){return IA=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(c,y){return c.__proto__=y,c},IA(r,n)}function Ng(r){return Qte(r)||Jte(r)||ij(r)||Yte()}function Yte(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ij(r,n){if(r){if(typeof r=="string")return CA(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);if(l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set")return Array.from(r);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return CA(r,n)}}function Jte(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function Qte(r){if(Array.isArray(r))return CA(r)}function CA(r,n){(n==null||n>r.length)&&(n=r.length);for(var l=0,c=new Array(n);l<n;l++)c[l]=r[l];return c}function T3(r,n){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);n&&(c=c.filter(function(y){return Object.getOwnPropertyDescriptor(r,y).enumerable})),l.push.apply(l,c)}return l}function tr(r){for(var n=1;n<arguments.length;n++){var l=arguments[n]!=null?arguments[n]:{};n%2?T3(Object(l),!0).forEach(function(c){Bn(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):T3(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function Bn(r,n,l){return n=oj(n),n in r?Object.defineProperty(r,n,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[n]=l,r}function oj(r){var n=ere(r,"string");return Bg(n)=="symbol"?n:n+""}function ere(r,n){if(Bg(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var c=l.call(r,n);if(Bg(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}var tre={xAxis:["bottom","top"],yAxis:["left","right"]},rre={width:"100%",height:"100%"},aj={x:0,y:0};function n0(r){return r}var nre=function(n,l){return l==="horizontal"?n.x:l==="vertical"?n.y:l==="centric"?n.angle:n.radius},ire=function(n,l,c,y){var w=l.find(function($){return $&&$.index===c});if(w){if(n==="horizontal")return{x:w.coordinate,y:y.y};if(n==="vertical")return{x:y.x,y:w.coordinate};if(n==="centric"){var P=w.coordinate,a=y.radius;return tr(tr(tr({},y),yo(y.cx,y.cy,a,P)),{},{angle:P,radius:a})}var R=w.coordinate,z=y.angle;return tr(tr(tr({},y),yo(y.cx,y.cy,R,z)),{},{angle:z,radius:R})}return aj},Ux=function(n,l){var c=l.graphicalItems,y=l.dataStartIndex,w=l.dataEndIndex,P=(c??[]).reduce(function(a,R){var z=R.props.data;return z&&z.length?[].concat(Ng(a),Ng(z)):a},[]);return P.length>0?P:n&&n.length&&Rr(y)&&Rr(w)?n.slice(y,w+1):[]};function sj(r){return r==="number"?[0,"auto"]:void 0}var MA=function(n,l,c,y){var w=n.graphicalItems,P=n.tooltipAxis,a=Ux(l,n);return c<0||!w||!w.length||c>=a.length?null:w.reduce(function(R,z){var $,V=($=z.props.data)!==null&&$!==void 0?$:l;V&&n.dataStartIndex+n.dataEndIndex!==0&&n.dataEndIndex-n.dataStartIndex>=c&&(V=V.slice(n.dataStartIndex,n.dataEndIndex+1));var W;if(P.dataKey&&!P.allowDuplicatedCategory){var ie=V===void 0?a:V;W=hE(ie,P.dataKey,y)}else W=V&&V[c]||a[c];return W?[].concat(Ng(R),[QB(z,W)]):R},[])},E3=function(n,l,c,y){var w=y||{x:n.chartX,y:n.chartY},P=nre(w,c),a=n.orderedTooltipTicks,R=n.tooltipAxis,z=n.tooltipTicks,$=$9(P,a,z,R);if($>=0&&z){var V=z[$]&&z[$].value,W=MA(n,l,$,V),ie=ire(c,a,$,w);return{activeTooltipIndex:$,activeLabel:V,activePayload:W,activeCoordinate:ie}}return null},ore=function(n,l){var c=l.axes,y=l.graphicalItems,w=l.axisType,P=l.axisIdKey,a=l.stackGroups,R=l.dataStartIndex,z=l.dataEndIndex,$=n.layout,V=n.children,W=n.stackOffset,ie=WB($,w);return c.reduce(function(ae,ee){var ne,de=ee.type.defaultProps!==void 0?tr(tr({},ee.type.defaultProps),ee.props):ee.props,xe=de.type,be=de.dataKey,ke=de.allowDataOverflow,he=de.allowDuplicatedCategory,_e=de.scale,ze=de.ticks,Ne=de.includeHidden,rt=de[P];if(ae[rt])return ae;var kt=Ux(n.data,{graphicalItems:y.filter(function(pt){var fr,zr=P in pt.props?pt.props[P]:(fr=pt.type.defaultProps)===null||fr===void 0?void 0:fr[P];return zr===rt}),dataStartIndex:R,dataEndIndex:z}),He=kt.length,yt,gt,Pt;Ote(de.domain,ke,xe)&&(yt=GE(de.domain,null,ke),ie&&(xe==="number"||_e!=="auto")&&(Pt=ty(kt,be,"category")));var xt=sj(xe);if(!yt||yt.length===0){var Tt,Ht=(Tt=de.domain)!==null&&Tt!==void 0?Tt:xt;if(be){if(yt=ty(kt,be,xe),xe==="category"&&ie){var lt=F6(yt);he&&lt?(gt=yt,yt=q0(0,He)):he||(yt=Pz(Ht,yt,ee).reduce(function(pt,fr){return pt.indexOf(fr)>=0?pt:[].concat(Ng(pt),[fr])},[]))}else if(xe==="category")he?yt=yt.filter(function(pt){return pt!==""&&!xi(pt)}):yt=Pz(Ht,yt,ee).reduce(function(pt,fr){return pt.indexOf(fr)>=0||fr===""||xi(fr)?pt:[].concat(Ng(pt),[fr])},[]);else if(xe==="number"){var Wt=Z9(kt,y.filter(function(pt){var fr,zr,Hr=P in pt.props?pt.props[P]:(fr=pt.type.defaultProps)===null||fr===void 0?void 0:fr[P],Ir="hide"in pt.props?pt.props.hide:(zr=pt.type.defaultProps)===null||zr===void 0?void 0:zr.hide;return Hr===rt&&(Ne||!Ir)}),be,w,$);Wt&&(yt=Wt)}ie&&(xe==="number"||_e!=="auto")&&(Pt=ty(kt,be,"category"))}else ie?yt=q0(0,He):a&&a[rt]&&a[rt].hasStack&&xe==="number"?yt=W==="expand"?[0,1]:JB(a[rt].stackGroups,R,z):yt=HB(kt,y.filter(function(pt){var fr=P in pt.props?pt.props[P]:pt.type.defaultProps[P],zr="hide"in pt.props?pt.props.hide:pt.type.defaultProps.hide;return fr===rt&&(Ne||!zr)}),xe,$,!0);if(xe==="number")yt=PA(V,yt,rt,w,ze),Ht&&(yt=GE(Ht,yt,ke));else if(xe==="category"&&Ht){var Zt=Ht,$e=yt.every(function(pt){return Zt.indexOf(pt)>=0});$e&&(yt=Zt)}}return tr(tr({},ae),{},Bn({},rt,tr(tr({},de),{},{axisType:w,domain:yt,categoricalDomain:Pt,duplicateDomain:gt,originalDomain:(ne=de.domain)!==null&&ne!==void 0?ne:xt,isCategorical:ie,layout:$})))},{})},are=function(n,l){var c=l.graphicalItems,y=l.Axis,w=l.axisType,P=l.axisIdKey,a=l.stackGroups,R=l.dataStartIndex,z=l.dataEndIndex,$=n.layout,V=n.children,W=Ux(n.data,{graphicalItems:c,dataStartIndex:R,dataEndIndex:z}),ie=W.length,ae=WB($,w),ee=-1;return c.reduce(function(ne,de){var xe=de.type.defaultProps!==void 0?tr(tr({},de.type.defaultProps),de.props):de.props,be=xe[P],ke=sj("number");if(!ne[be]){ee++;var he;return ae?he=q0(0,ie):a&&a[be]&&a[be].hasStack?(he=JB(a[be].stackGroups,R,z),he=PA(V,he,be,w)):(he=GE(ke,HB(W,c.filter(function(_e){var ze,Ne,rt=P in _e.props?_e.props[P]:(ze=_e.type.defaultProps)===null||ze===void 0?void 0:ze[P],kt="hide"in _e.props?_e.props.hide:(Ne=_e.type.defaultProps)===null||Ne===void 0?void 0:Ne.hide;return rt===be&&!kt}),"number",$),y.defaultProps.allowDataOverflow),he=PA(V,he,be,w)),tr(tr({},ne),{},Bn({},be,tr(tr({axisType:w},y.defaultProps),{},{hide:!0,orientation:Yl(tre,"".concat(w,".").concat(ee%2),null),domain:he,originalDomain:ke,isCategorical:ae,layout:$})))}return ne},{})},sre=function(n,l){var c=l.axisType,y=c===void 0?"xAxis":c,w=l.AxisComp,P=l.graphicalItems,a=l.stackGroups,R=l.dataStartIndex,z=l.dataEndIndex,$=n.children,V="".concat(y,"Id"),W=Vu($,w),ie={};return W&&W.length?ie=ore(n,{axes:W,graphicalItems:P,axisType:y,axisIdKey:V,stackGroups:a,dataStartIndex:R,dataEndIndex:z}):P&&P.length&&(ie=are(n,{Axis:w,graphicalItems:P,axisType:y,axisIdKey:V,stackGroups:a,dataStartIndex:R,dataEndIndex:z})),ie},lre=function(n){var l=sp(n),c=Nf(l,!1,!0);return{tooltipTicks:c,orderedTooltipTicks:e2(c,function(y){return y.coordinate}),tooltipAxis:l,tooltipAxisBandSize:R0(l,c)}},A3=function(n){var l=n.children,c=n.defaultShowTooltip,y=Xl(l,Mg),w=0,P=0;return n.data&&n.data.length!==0&&(P=n.data.length-1),y&&y.props&&(y.props.startIndex>=0&&(w=y.props.startIndex),y.props.endIndex>=0&&(P=y.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:w,dataEndIndex:P,activeTooltipIndex:-1,isTooltipActive:!!c}},ure=function(n){return!n||!n.length?!1:n.some(function(l){var c=jf(l&&l.type);return c&&c.indexOf("Bar")>=0})},P3=function(n){return n==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:n==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:n==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},cre=function(n,l){var c=n.props,y=n.graphicalItems,w=n.xAxisMap,P=w===void 0?{}:w,a=n.yAxisMap,R=a===void 0?{}:a,z=c.width,$=c.height,V=c.children,W=c.margin||{},ie=Xl(V,Mg),ae=Xl(V,fg),ee=Object.keys(R).reduce(function(he,_e){var ze=R[_e],Ne=ze.orientation;return!ze.mirror&&!ze.hide?tr(tr({},he),{},Bn({},Ne,he[Ne]+ze.width)):he},{left:W.left||0,right:W.right||0}),ne=Object.keys(P).reduce(function(he,_e){var ze=P[_e],Ne=ze.orientation;return!ze.mirror&&!ze.hide?tr(tr({},he),{},Bn({},Ne,Yl(he,"".concat(Ne))+ze.height)):he},{top:W.top||0,bottom:W.bottom||0}),de=tr(tr({},ne),ee),xe=de.bottom;ie&&(de.bottom+=ie.props.height||Mg.defaultProps.height),ae&&l&&(de=H9(de,y,c,l));var be=z-de.left-de.right,ke=$-de.top-de.bottom;return tr(tr({brushBottom:xe},de),{},{width:Math.max(be,0),height:Math.max(ke,0)})},hre=function(n,l){if(l==="xAxis")return n[l].width;if(l==="yAxis")return n[l].height},lj=function(n){var l=n.chartName,c=n.GraphicalChild,y=n.defaultTooltipEventType,w=y===void 0?"axis":y,P=n.validateTooltipEventTypes,a=P===void 0?["axis"]:P,R=n.axisComponents,z=n.legendContent,$=n.formatAxisMap,V=n.defaultProps,W=function(de,xe){var be=xe.graphicalItems,ke=xe.stackGroups,he=xe.offset,_e=xe.updateId,ze=xe.dataStartIndex,Ne=xe.dataEndIndex,rt=de.barSize,kt=de.layout,He=de.barGap,yt=de.barCategoryGap,gt=de.maxBarSize,Pt=P3(kt),xt=Pt.numericAxisName,Tt=Pt.cateAxisName,Ht=ure(be),lt=[];return be.forEach(function(Wt,Zt){var $e=Ux(de.data,{graphicalItems:[Wt],dataStartIndex:ze,dataEndIndex:Ne}),pt=Wt.type.defaultProps!==void 0?tr(tr({},Wt.type.defaultProps),Wt.props):Wt.props,fr=pt.dataKey,zr=pt.maxBarSize,Hr=pt["".concat(xt,"Id")],Ir=pt["".concat(Tt,"Id")],Lr={},Ur=R.reduce(function(Ui,Fo){var Fa=xe["".concat(Fo.axisType,"Map")],Ms=pt["".concat(Fo.axisType,"Id")];Fa&&Fa[Ms]||Fo.axisType==="zAxis"||pm();var Js=Fa[Ms];return tr(tr({},Ui),{},Bn(Bn({},Fo.axisType,Js),"".concat(Fo.axisType,"Ticks"),Nf(Js)))},Lr),or=Ur[Tt],Er=Ur["".concat(Tt,"Ticks")],pn=ke&&ke[Hr]&&ke[Hr].hasStack&&nZ(Wt,ke[Hr].stackGroups),sr=jf(Wt.type).indexOf("Bar")>=0,Pi=R0(or,Er),Rn=[],In=Ht&&q9({barSize:rt,stackGroups:ke,totalSize:hre(Ur,Tt)});if(sr){var ci,Ki,wa=xi(zr)?gt:zr,$o=(ci=(Ki=R0(or,Er,!0))!==null&&Ki!==void 0?Ki:wa)!==null&&ci!==void 0?ci:0;Rn=G9({barGap:He,barCategoryGap:yt,bandSize:$o!==Pi?$o:Pi,sizeList:In[Ir],maxBarSize:wa}),$o!==Pi&&(Rn=Rn.map(function(Ui){return tr(tr({},Ui),{},{position:tr(tr({},Ui.position),{},{offset:Ui.position.offset-$o/2})})}))}var fo=Wt&&Wt.type&&Wt.type.getComposedData;fo&&lt.push({props:tr(tr({},fo(tr(tr({},Ur),{},{displayedData:$e,props:de,dataKey:fr,item:Wt,bandSize:Pi,barPosition:Rn,offset:he,stackedData:pn,layout:kt,dataStartIndex:ze,dataEndIndex:Ne}))),{},Bn(Bn(Bn({key:Wt.key||"item-".concat(Zt)},xt,Ur[xt]),Tt,Ur[Tt]),"animationId",_e)),childIndex:X6(Wt,de.children),item:Wt})}),lt},ie=function(de,xe){var be=de.props,ke=de.dataStartIndex,he=de.dataEndIndex,_e=de.updateId;if(!VO({props:be}))return null;var ze=be.children,Ne=be.layout,rt=be.stackOffset,kt=be.data,He=be.reverseStackOrder,yt=P3(Ne),gt=yt.numericAxisName,Pt=yt.cateAxisName,xt=Vu(ze,c),Tt=tZ(kt,xt,"".concat(gt,"Id"),"".concat(Pt,"Id"),rt,He),Ht=R.reduce(function(pt,fr){var zr="".concat(fr.axisType,"Map");return tr(tr({},pt),{},Bn({},zr,sre(be,tr(tr({},fr),{},{graphicalItems:xt,stackGroups:fr.axisType===gt&&Tt,dataStartIndex:ke,dataEndIndex:he}))))},{}),lt=cre(tr(tr({},Ht),{},{props:be,graphicalItems:xt}),xe?.legendBBox);Object.keys(Ht).forEach(function(pt){Ht[pt]=$(be,Ht[pt],lt,pt.replace("Map",""),l)});var Wt=Ht["".concat(Pt,"Map")],Zt=lre(Wt),$e=W(be,tr(tr({},Ht),{},{dataStartIndex:ke,dataEndIndex:he,updateId:_e,graphicalItems:xt,stackGroups:Tt,offset:lt}));return tr(tr({formattedGraphicalItems:$e,graphicalItems:xt,offset:lt,stackGroups:Tt},Zt),Ht)},ae=(function(ne){function de(xe){var be,ke,he;return qte(this,de),he=Wte(this,de,[xe]),Bn(he,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Bn(he,"accessibilityManager",new Mte),Bn(he,"handleLegendBBoxUpdate",function(_e){if(_e){var ze=he.state,Ne=ze.dataStartIndex,rt=ze.dataEndIndex,kt=ze.updateId;he.setState(tr({legendBBox:_e},ie({props:he.props,dataStartIndex:Ne,dataEndIndex:rt,updateId:kt},tr(tr({},he.state),{},{legendBBox:_e}))))}}),Bn(he,"handleReceiveSyncEvent",function(_e,ze,Ne){if(he.props.syncId===_e){if(Ne===he.eventEmitterSymbol&&typeof he.props.syncMethod!="function")return;he.applySyncEvent(ze)}}),Bn(he,"handleBrushChange",function(_e){var ze=_e.startIndex,Ne=_e.endIndex;if(ze!==he.state.dataStartIndex||Ne!==he.state.dataEndIndex){var rt=he.state.updateId;he.setState(function(){return tr({dataStartIndex:ze,dataEndIndex:Ne},ie({props:he.props,dataStartIndex:ze,dataEndIndex:Ne,updateId:rt},he.state))}),he.triggerSyncEvent({dataStartIndex:ze,dataEndIndex:Ne})}}),Bn(he,"handleMouseEnter",function(_e){var ze=he.getMouseInfo(_e);if(ze){var Ne=tr(tr({},ze),{},{isTooltipActive:!0});he.setState(Ne),he.triggerSyncEvent(Ne);var rt=he.props.onMouseEnter;Zn(rt)&&rt(Ne,_e)}}),Bn(he,"triggeredAfterMouseMove",function(_e){var ze=he.getMouseInfo(_e),Ne=ze?tr(tr({},ze),{},{isTooltipActive:!0}):{isTooltipActive:!1};he.setState(Ne),he.triggerSyncEvent(Ne);var rt=he.props.onMouseMove;Zn(rt)&&rt(Ne,_e)}),Bn(he,"handleItemMouseEnter",function(_e){he.setState(function(){return{isTooltipActive:!0,activeItem:_e,activePayload:_e.tooltipPayload,activeCoordinate:_e.tooltipPosition||{x:_e.cx,y:_e.cy}}})}),Bn(he,"handleItemMouseLeave",function(){he.setState(function(){return{isTooltipActive:!1}})}),Bn(he,"handleMouseMove",function(_e){_e.persist(),he.throttleTriggeredAfterMouseMove(_e)}),Bn(he,"handleMouseLeave",function(_e){he.throttleTriggeredAfterMouseMove.cancel();var ze={isTooltipActive:!1};he.setState(ze),he.triggerSyncEvent(ze);var Ne=he.props.onMouseLeave;Zn(Ne)&&Ne(ze,_e)}),Bn(he,"handleOuterEvent",function(_e){var ze=Z6(_e),Ne=Yl(he.props,"".concat(ze));if(ze&&Zn(Ne)){var rt,kt;/.*touch.*/i.test(ze)?kt=he.getMouseInfo(_e.changedTouches[0]):kt=he.getMouseInfo(_e),Ne((rt=kt)!==null&&rt!==void 0?rt:{},_e)}}),Bn(he,"handleClick",function(_e){var ze=he.getMouseInfo(_e);if(ze){var Ne=tr(tr({},ze),{},{isTooltipActive:!0});he.setState(Ne),he.triggerSyncEvent(Ne);var rt=he.props.onClick;Zn(rt)&&rt(Ne,_e)}}),Bn(he,"handleMouseDown",function(_e){var ze=he.props.onMouseDown;if(Zn(ze)){var Ne=he.getMouseInfo(_e);ze(Ne,_e)}}),Bn(he,"handleMouseUp",function(_e){var ze=he.props.onMouseUp;if(Zn(ze)){var Ne=he.getMouseInfo(_e);ze(Ne,_e)}}),Bn(he,"handleTouchMove",function(_e){_e.changedTouches!=null&&_e.changedTouches.length>0&&he.throttleTriggeredAfterMouseMove(_e.changedTouches[0])}),Bn(he,"handleTouchStart",function(_e){_e.changedTouches!=null&&_e.changedTouches.length>0&&he.handleMouseDown(_e.changedTouches[0])}),Bn(he,"handleTouchEnd",function(_e){_e.changedTouches!=null&&_e.changedTouches.length>0&&he.handleMouseUp(_e.changedTouches[0])}),Bn(he,"handleDoubleClick",function(_e){var ze=he.props.onDoubleClick;if(Zn(ze)){var Ne=he.getMouseInfo(_e);ze(Ne,_e)}}),Bn(he,"handleContextMenu",function(_e){var ze=he.props.onContextMenu;if(Zn(ze)){var Ne=he.getMouseInfo(_e);ze(Ne,_e)}}),Bn(he,"triggerSyncEvent",function(_e){he.props.syncId!==void 0&&nE.emit(iE,he.props.syncId,_e,he.eventEmitterSymbol)}),Bn(he,"applySyncEvent",function(_e){var ze=he.props,Ne=ze.layout,rt=ze.syncMethod,kt=he.state.updateId,He=_e.dataStartIndex,yt=_e.dataEndIndex;if(_e.dataStartIndex!==void 0||_e.dataEndIndex!==void 0)he.setState(tr({dataStartIndex:He,dataEndIndex:yt},ie({props:he.props,dataStartIndex:He,dataEndIndex:yt,updateId:kt},he.state)));else if(_e.activeTooltipIndex!==void 0){var gt=_e.chartX,Pt=_e.chartY,xt=_e.activeTooltipIndex,Tt=he.state,Ht=Tt.offset,lt=Tt.tooltipTicks;if(!Ht)return;if(typeof rt=="function")xt=rt(lt,_e);else if(rt==="value"){xt=-1;for(var Wt=0;Wt<lt.length;Wt++)if(lt[Wt].value===_e.activeLabel){xt=Wt;break}}var Zt=tr(tr({},Ht),{},{x:Ht.left,y:Ht.top}),$e=Math.min(gt,Zt.x+Zt.width),pt=Math.min(Pt,Zt.y+Zt.height),fr=lt[xt]&&lt[xt].value,zr=MA(he.state,he.props.data,xt),Hr=lt[xt]?{x:Ne==="horizontal"?lt[xt].coordinate:$e,y:Ne==="horizontal"?pt:lt[xt].coordinate}:aj;he.setState(tr(tr({},_e),{},{activeLabel:fr,activeCoordinate:Hr,activePayload:zr,activeTooltipIndex:xt}))}else he.setState(_e)}),Bn(he,"renderCursor",function(_e){var ze,Ne=he.state,rt=Ne.isTooltipActive,kt=Ne.activeCoordinate,He=Ne.activePayload,yt=Ne.offset,gt=Ne.activeTooltipIndex,Pt=Ne.tooltipAxisBandSize,xt=he.getTooltipEventType(),Tt=(ze=_e.props.active)!==null&&ze!==void 0?ze:rt,Ht=he.props.layout,lt=_e.key||"_recharts-cursor";return ct.createElement(Fte,{key:lt,activeCoordinate:kt,activePayload:He,activeTooltipIndex:gt,chartName:l,element:_e,isActive:Tt,layout:Ht,offset:yt,tooltipAxisBandSize:Pt,tooltipEventType:xt})}),Bn(he,"renderPolarAxis",function(_e,ze,Ne){var rt=Yl(_e,"type.axisType"),kt=Yl(he.state,"".concat(rt,"Map")),He=_e.type.defaultProps,yt=He!==void 0?tr(tr({},He),_e.props):_e.props,gt=kt&&kt[yt["".concat(rt,"Id")]];return ir.cloneElement(_e,tr(tr({},gt),{},{className:ui(rt,gt.className),key:_e.key||"".concat(ze,"-").concat(Ne),ticks:Nf(gt,!0)}))}),Bn(he,"renderPolarGrid",function(_e){var ze=_e.props,Ne=ze.radialLines,rt=ze.polarAngles,kt=ze.polarRadius,He=he.state,yt=He.radiusAxisMap,gt=He.angleAxisMap,Pt=sp(yt),xt=sp(gt),Tt=xt.cx,Ht=xt.cy,lt=xt.innerRadius,Wt=xt.outerRadius;return ir.cloneElement(_e,{polarAngles:Array.isArray(rt)?rt:Nf(xt,!0).map(function(Zt){return Zt.coordinate}),polarRadius:Array.isArray(kt)?kt:Nf(Pt,!0).map(function(Zt){return Zt.coordinate}),cx:Tt,cy:Ht,innerRadius:lt,outerRadius:Wt,key:_e.key||"polar-grid",radialLines:Ne})}),Bn(he,"renderLegend",function(){var _e=he.state.formattedGraphicalItems,ze=he.props,Ne=ze.children,rt=ze.width,kt=ze.height,He=he.props.margin||{},yt=rt-(He.left||0)-(He.right||0),gt=qB({children:Ne,formattedGraphicalItems:_e,legendWidth:yt,legendContent:z});if(!gt)return null;var Pt=gt.item,xt=S3(gt,Bte);return ir.cloneElement(Pt,tr(tr({},xt),{},{chartWidth:rt,chartHeight:kt,margin:He,onBBoxUpdate:he.handleLegendBBoxUpdate}))}),Bn(he,"renderTooltip",function(){var _e,ze=he.props,Ne=ze.children,rt=ze.accessibilityLayer,kt=Xl(Ne,zf);if(!kt)return null;var He=he.state,yt=He.isTooltipActive,gt=He.activeCoordinate,Pt=He.activePayload,xt=He.activeLabel,Tt=He.offset,Ht=(_e=kt.props.active)!==null&&_e!==void 0?_e:yt;return ir.cloneElement(kt,{viewBox:tr(tr({},Tt),{},{x:Tt.left,y:Tt.top}),active:Ht,label:xt,payload:Ht?Pt:[],coordinate:gt,accessibilityLayer:rt})}),Bn(he,"renderBrush",function(_e){var ze=he.props,Ne=ze.margin,rt=ze.data,kt=he.state,He=kt.offset,yt=kt.dataStartIndex,gt=kt.dataEndIndex,Pt=kt.updateId;return ir.cloneElement(_e,{key:_e.key||"_recharts-brush",onChange:Jv(he.handleBrushChange,_e.props.onChange),data:rt,x:Rr(_e.props.x)?_e.props.x:He.left,y:Rr(_e.props.y)?_e.props.y:He.top+He.height+He.brushBottom-(Ne.bottom||0),width:Rr(_e.props.width)?_e.props.width:He.width,startIndex:yt,endIndex:gt,updateId:"brush-".concat(Pt)})}),Bn(he,"renderReferenceElement",function(_e,ze,Ne){if(!_e)return null;var rt=he,kt=rt.clipPathId,He=he.state,yt=He.xAxisMap,gt=He.yAxisMap,Pt=He.offset,xt=_e.type.defaultProps||{},Tt=_e.props,Ht=Tt.xAxisId,lt=Ht===void 0?xt.xAxisId:Ht,Wt=Tt.yAxisId,Zt=Wt===void 0?xt.yAxisId:Wt;return ir.cloneElement(_e,{key:_e.key||"".concat(ze,"-").concat(Ne),xAxis:yt[lt],yAxis:gt[Zt],viewBox:{x:Pt.left,y:Pt.top,width:Pt.width,height:Pt.height},clipPathId:kt})}),Bn(he,"renderActivePoints",function(_e){var ze=_e.item,Ne=_e.activePoint,rt=_e.basePoint,kt=_e.childIndex,He=_e.isRange,yt=[],gt=ze.props.key,Pt=ze.item.type.defaultProps!==void 0?tr(tr({},ze.item.type.defaultProps),ze.item.props):ze.item.props,xt=Pt.activeDot,Tt=Pt.dataKey,Ht=tr(tr({index:kt,dataKey:Tt,cx:Ne.x,cy:Ne.y,r:4,fill:P2(ze.item),strokeWidth:2,stroke:"#fff",payload:Ne.payload,value:Ne.value},Vn(xt,!1)),l0(xt));return yt.push(de.renderActiveDot(xt,Ht,"".concat(gt,"-activePoint-").concat(kt))),rt?yt.push(de.renderActiveDot(xt,tr(tr({},Ht),{},{cx:rt.x,cy:rt.y}),"".concat(gt,"-basePoint-").concat(kt))):He&&yt.push(null),yt}),Bn(he,"renderGraphicChild",function(_e,ze,Ne){var rt=he.filterFormatItem(_e,ze,Ne);if(!rt)return null;var kt=he.getTooltipEventType(),He=he.state,yt=He.isTooltipActive,gt=He.tooltipAxis,Pt=He.activeTooltipIndex,xt=He.activeLabel,Tt=he.props.children,Ht=Xl(Tt,zf),lt=rt.props,Wt=lt.points,Zt=lt.isRange,$e=lt.baseLine,pt=rt.item.type.defaultProps!==void 0?tr(tr({},rt.item.type.defaultProps),rt.item.props):rt.item.props,fr=pt.activeDot,zr=pt.hide,Hr=pt.activeBar,Ir=pt.activeShape,Lr=!!(!zr&&yt&&Ht&&(fr||Hr||Ir)),Ur={};kt!=="axis"&&Ht&&Ht.props.trigger==="click"?Ur={onClick:Jv(he.handleItemMouseEnter,_e.props.onClick)}:kt!=="axis"&&(Ur={onMouseLeave:Jv(he.handleItemMouseLeave,_e.props.onMouseLeave),onMouseEnter:Jv(he.handleItemMouseEnter,_e.props.onMouseEnter)});var or=ir.cloneElement(_e,tr(tr({},rt.props),Ur));function Er(Fo){return typeof gt.dataKey=="function"?gt.dataKey(Fo.payload):null}if(Lr)if(Pt>=0){var pn,sr;if(gt.dataKey&&!gt.allowDuplicatedCategory){var Pi=typeof gt.dataKey=="function"?Er:"payload.".concat(gt.dataKey.toString());pn=hE(Wt,Pi,xt),sr=Zt&&$e&&hE($e,Pi,xt)}else pn=Wt?.[Pt],sr=Zt&&$e&&$e[Pt];if(Ir||Hr){var Rn=_e.props.activeIndex!==void 0?_e.props.activeIndex:Pt;return[ir.cloneElement(_e,tr(tr(tr({},rt.props),Ur),{},{activeIndex:Rn})),null,null]}if(!xi(pn))return[or].concat(Ng(he.renderActivePoints({item:rt,activePoint:pn,basePoint:sr,childIndex:Pt,isRange:Zt})))}else{var In,ci=(In=he.getItemByXY(he.state.activeCoordinate))!==null&&In!==void 0?In:{graphicalItem:or},Ki=ci.graphicalItem,wa=Ki.item,$o=wa===void 0?_e:wa,fo=Ki.childIndex,Ui=tr(tr(tr({},rt.props),Ur),{},{activeIndex:fo});return[ir.cloneElement($o,Ui),null,null]}return Zt?[or,null,null]:[or,null]}),Bn(he,"renderCustomized",function(_e,ze,Ne){return ir.cloneElement(_e,tr(tr({key:"recharts-customized-".concat(Ne)},he.props),he.state))}),Bn(he,"renderMap",{CartesianGrid:{handler:n0,once:!0},ReferenceArea:{handler:he.renderReferenceElement},ReferenceLine:{handler:n0},ReferenceDot:{handler:he.renderReferenceElement},XAxis:{handler:n0},YAxis:{handler:n0},Brush:{handler:he.renderBrush,once:!0},Bar:{handler:he.renderGraphicChild},Line:{handler:he.renderGraphicChild},Area:{handler:he.renderGraphicChild},Radar:{handler:he.renderGraphicChild},RadialBar:{handler:he.renderGraphicChild},Scatter:{handler:he.renderGraphicChild},Pie:{handler:he.renderGraphicChild},Funnel:{handler:he.renderGraphicChild},Tooltip:{handler:he.renderCursor,once:!0},PolarGrid:{handler:he.renderPolarGrid,once:!0},PolarAngleAxis:{handler:he.renderPolarAxis},PolarRadiusAxis:{handler:he.renderPolarAxis},Customized:{handler:he.renderCustomized}}),he.clipPathId="".concat((be=xe.id)!==null&&be!==void 0?be:Vy("recharts"),"-clip"),he.throttleTriggeredAfterMouseMove=$F(he.triggeredAfterMouseMove,(ke=xe.throttleDelay)!==null&&ke!==void 0?ke:1e3/60),he.state={},he}return Kte(de,ne),Hte(de,[{key:"componentDidMount",value:function(){var be,ke;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(be=this.props.margin.left)!==null&&be!==void 0?be:0,top:(ke=this.props.margin.top)!==null&&ke!==void 0?ke:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var be=this.props,ke=be.children,he=be.data,_e=be.height,ze=be.layout,Ne=Xl(ke,zf);if(Ne){var rt=Ne.props.defaultIndex;if(!(typeof rt!="number"||rt<0||rt>this.state.tooltipTicks.length-1)){var kt=this.state.tooltipTicks[rt]&&this.state.tooltipTicks[rt].value,He=MA(this.state,he,rt,kt),yt=this.state.tooltipTicks[rt].coordinate,gt=(this.state.offset.top+_e)/2,Pt=ze==="horizontal",xt=Pt?{x:yt,y:gt}:{y:yt,x:gt},Tt=this.state.formattedGraphicalItems.find(function(lt){var Wt=lt.item;return Wt.type.name==="Scatter"});Tt&&(xt=tr(tr({},xt),Tt.props.points[rt].tooltipPosition),He=Tt.props.points[rt].tooltipPayload);var Ht={activeTooltipIndex:rt,isTooltipActive:!0,activeLabel:kt,activePayload:He,activeCoordinate:xt};this.setState(Ht),this.renderCursor(Ne),this.accessibilityManager.setIndex(rt)}}}},{key:"getSnapshotBeforeUpdate",value:function(be,ke){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==ke.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==be.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==be.margin){var he,_e;this.accessibilityManager.setDetails({offset:{left:(he=this.props.margin.left)!==null&&he!==void 0?he:0,top:(_e=this.props.margin.top)!==null&&_e!==void 0?_e:0}})}return null}},{key:"componentDidUpdate",value:function(be){dE([Xl(be.children,zf)],[Xl(this.props.children,zf)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var be=Xl(this.props.children,zf);if(be&&typeof be.props.shared=="boolean"){var ke=be.props.shared?"axis":"item";return a.indexOf(ke)>=0?ke:w}return w}},{key:"getMouseInfo",value:function(be){if(!this.container)return null;var ke=this.container,he=ke.getBoundingClientRect(),_e=zG(he),ze={chartX:Math.round(be.pageX-_e.left),chartY:Math.round(be.pageY-_e.top)},Ne=he.width/ke.offsetWidth||1,rt=this.inRange(ze.chartX,ze.chartY,Ne);if(!rt)return null;var kt=this.state,He=kt.xAxisMap,yt=kt.yAxisMap,gt=this.getTooltipEventType(),Pt=E3(this.state,this.props.data,this.props.layout,rt);if(gt!=="axis"&&He&&yt){var xt=sp(He).scale,Tt=sp(yt).scale,Ht=xt&&xt.invert?xt.invert(ze.chartX):null,lt=Tt&&Tt.invert?Tt.invert(ze.chartY):null;return tr(tr({},ze),{},{xValue:Ht,yValue:lt},Pt)}return Pt?tr(tr({},ze),Pt):null}},{key:"inRange",value:function(be,ke){var he=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,_e=this.props.layout,ze=be/he,Ne=ke/he;if(_e==="horizontal"||_e==="vertical"){var rt=this.state.offset,kt=ze>=rt.left&&ze<=rt.left+rt.width&&Ne>=rt.top&&Ne<=rt.top+rt.height;return kt?{x:ze,y:Ne}:null}var He=this.state,yt=He.angleAxisMap,gt=He.radiusAxisMap;if(yt&&gt){var Pt=sp(yt);return Mz({x:ze,y:Ne},Pt)}return null}},{key:"parseEventsOfWrapper",value:function(){var be=this.props.children,ke=this.getTooltipEventType(),he=Xl(be,zf),_e={};he&&ke==="axis"&&(he.props.trigger==="click"?_e={onClick:this.handleClick}:_e={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var ze=l0(this.props,this.handleOuterEvent);return tr(tr({},ze),_e)}},{key:"addListener",value:function(){nE.on(iE,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){nE.removeListener(iE,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(be,ke,he){for(var _e=this.state.formattedGraphicalItems,ze=0,Ne=_e.length;ze<Ne;ze++){var rt=_e[ze];if(rt.item===be||rt.props.key===be.key||ke===jf(rt.item.type)&&he===rt.childIndex)return rt}return null}},{key:"renderClipPath",value:function(){var be=this.clipPathId,ke=this.state.offset,he=ke.left,_e=ke.top,ze=ke.height,Ne=ke.width;return ct.createElement("defs",null,ct.createElement("clipPath",{id:be},ct.createElement("rect",{x:he,y:_e,height:ze,width:Ne})))}},{key:"getXScales",value:function(){var be=this.state.xAxisMap;return be?Object.entries(be).reduce(function(ke,he){var _e=w3(he,2),ze=_e[0],Ne=_e[1];return tr(tr({},ke),{},Bn({},ze,Ne.scale))},{}):null}},{key:"getYScales",value:function(){var be=this.state.yAxisMap;return be?Object.entries(be).reduce(function(ke,he){var _e=w3(he,2),ze=_e[0],Ne=_e[1];return tr(tr({},ke),{},Bn({},ze,Ne.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(be){var ke;return(ke=this.state.xAxisMap)===null||ke===void 0||(ke=ke[be])===null||ke===void 0?void 0:ke.scale}},{key:"getYScaleByAxisId",value:function(be){var ke;return(ke=this.state.yAxisMap)===null||ke===void 0||(ke=ke[be])===null||ke===void 0?void 0:ke.scale}},{key:"getItemByXY",value:function(be){var ke=this.state,he=ke.formattedGraphicalItems,_e=ke.activeItem;if(he&&he.length)for(var ze=0,Ne=he.length;ze<Ne;ze++){var rt=he[ze],kt=rt.props,He=rt.item,yt=He.type.defaultProps!==void 0?tr(tr({},He.type.defaultProps),He.props):He.props,gt=jf(He.type);if(gt==="Bar"){var Pt=(kt.data||[]).find(function(lt){return JK(be,lt)});if(Pt)return{graphicalItem:rt,payload:Pt}}else if(gt==="RadialBar"){var xt=(kt.data||[]).find(function(lt){return Mz(be,lt)});if(xt)return{graphicalItem:rt,payload:xt}}else if(Rx(rt,_e)||kx(rt,_e)||ky(rt,_e)){var Tt=bJ({graphicalItem:rt,activeTooltipItem:_e,itemData:yt.data}),Ht=yt.activeIndex===void 0?Tt:yt.activeIndex;return{graphicalItem:tr(tr({},rt),{},{childIndex:Ht}),payload:ky(rt,_e)?yt.data[Tt]:rt.props.data[Tt]}}}return null}},{key:"render",value:function(){var be=this;if(!VO(this))return null;var ke=this.props,he=ke.children,_e=ke.className,ze=ke.width,Ne=ke.height,rt=ke.style,kt=ke.compact,He=ke.title,yt=ke.desc,gt=S3(ke,Nte),Pt=Vn(gt,!1);if(kt)return ct.createElement(a3,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},ct.createElement(mE,cg({},Pt,{width:ze,height:Ne,title:He,desc:yt}),this.renderClipPath(),qO(he,this.renderMap)));if(this.props.accessibilityLayer){var xt,Tt;Pt.tabIndex=(xt=this.props.tabIndex)!==null&&xt!==void 0?xt:0,Pt.role=(Tt=this.props.role)!==null&&Tt!==void 0?Tt:"application",Pt.onKeyDown=function(lt){be.accessibilityManager.keyboardEvent(lt)},Pt.onFocus=function(){be.accessibilityManager.focus()}}var Ht=this.parseEventsOfWrapper();return ct.createElement(a3,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},ct.createElement("div",cg({className:ui("recharts-wrapper",_e),style:tr({position:"relative",cursor:"default",width:ze,height:Ne},rt)},Ht,{ref:function(Wt){be.container=Wt}}),ct.createElement(mE,cg({},Pt,{width:ze,height:Ne,title:He,desc:yt,style:rre}),this.renderClipPath(),qO(he,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])})(ir.Component);Bn(ae,"displayName",l),Bn(ae,"defaultProps",tr({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},V)),Bn(ae,"getDerivedStateFromProps",function(ne,de){var xe=ne.dataKey,be=ne.data,ke=ne.children,he=ne.width,_e=ne.height,ze=ne.layout,Ne=ne.stackOffset,rt=ne.margin,kt=de.dataStartIndex,He=de.dataEndIndex;if(de.updateId===void 0){var yt=A3(ne);return tr(tr(tr({},yt),{},{updateId:0},ie(tr(tr({props:ne},yt),{},{updateId:0}),de)),{},{prevDataKey:xe,prevData:be,prevWidth:he,prevHeight:_e,prevLayout:ze,prevStackOffset:Ne,prevMargin:rt,prevChildren:ke})}if(xe!==de.prevDataKey||be!==de.prevData||he!==de.prevWidth||_e!==de.prevHeight||ze!==de.prevLayout||Ne!==de.prevStackOffset||!hg(rt,de.prevMargin)){var gt=A3(ne),Pt={chartX:de.chartX,chartY:de.chartY,isTooltipActive:de.isTooltipActive},xt=tr(tr({},E3(de,be,ze)),{},{updateId:de.updateId+1}),Tt=tr(tr(tr({},gt),Pt),xt);return tr(tr(tr({},Tt),ie(tr({props:ne},Tt),de)),{},{prevDataKey:xe,prevData:be,prevWidth:he,prevHeight:_e,prevLayout:ze,prevStackOffset:Ne,prevMargin:rt,prevChildren:ke})}if(!dE(ke,de.prevChildren)){var Ht,lt,Wt,Zt,$e=Xl(ke,Mg),pt=$e&&(Ht=(lt=$e.props)===null||lt===void 0?void 0:lt.startIndex)!==null&&Ht!==void 0?Ht:kt,fr=$e&&(Wt=(Zt=$e.props)===null||Zt===void 0?void 0:Zt.endIndex)!==null&&Wt!==void 0?Wt:He,zr=pt!==kt||fr!==He,Hr=!xi(be),Ir=Hr&&!zr?de.updateId:de.updateId+1;return tr(tr({updateId:Ir},ie(tr(tr({props:ne},de),{},{updateId:Ir,dataStartIndex:pt,dataEndIndex:fr}),de)),{},{prevChildren:ke,dataStartIndex:pt,dataEndIndex:fr})}return null}),Bn(ae,"renderActiveDot",function(ne,de,xe){var be;return ir.isValidElement(ne)?be=ir.cloneElement(ne,de):Zn(ne)?be=ne(de):be=ct.createElement(C2,de),ct.createElement(eo,{className:"recharts-active-dot",key:xe},be)});var ee=ir.forwardRef(function(de,xe){return ct.createElement(ae,cg({},de,{ref:xe}))});return ee.displayName=ae.displayName,ee},fre=lj({chartName:"BarChart",GraphicalChild:bm,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:Nx},{axisType:"yAxis",AxisComp:jx}],formatAxisMap:TQ}),uj=lj({chartName:"PieChart",GraphicalChild:Bh,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:Ox},{axisType:"radiusAxis",AxisComp:Cx}],formatAxisMap:dZ,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const I3=[{name:"Privado",value:67,color:"#6b7280"},{name:"Público",value:33,color:"#e5e7eb"}],aE=[{name:"COVID-19",value:23,percentage:7,color:"#6b7280"},{name:"Esquizofrenia",value:234,percentage:65,color:"#4b5563"},{name:"Insuficiencia Cardiaca",value:45,percentage:15,color:"#9ca3af"},{name:"Convulsiones Epilépticas",value:65,percentage:3,color:"#d1d5db"},{name:"Otro",value:4,percentage:10,color:"#e5e7eb"}],dre=[{year:"2005",value:20},{year:"2006",value:35},{year:"2007",value:45},{year:"2008",value:30},{year:"2009",value:50},{year:"2010",value:40},{year:"2011",value:60},{year:"2013",value:55},{year:"2014",value:70},{year:"2015",value:45},{year:"2016",value:35},{year:"2017",value:65}];function C3({data:r,title:n,centerText:l}){return Bt.jsxs(mg,{className:"p-4",children:[Bt.jsx("h3",{className:"text-sm font-medium mb-4",children:n}),Bt.jsxs("div",{className:"relative h-48",children:[Bt.jsx(r2,{width:"100%",height:"100%",children:Bt.jsx(uj,{children:Bt.jsx(Bh,{data:r,cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:r.map((c,y)=>Bt.jsx(qy,{fill:c.color},`cell-${y}`))})})}),l&&Bt.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:Bt.jsx("span",{className:"text-2xl font-semibold",children:l})})]}),Bt.jsx("div",{className:"mt-4 space-y-2",children:r.map((c,y)=>Bt.jsxs("div",{className:"flex items-center justify-between text-sm",children:[Bt.jsxs("div",{className:"flex items-center gap-2",children:[Bt.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:c.color}}),Bt.jsx("span",{children:c.name})]}),Bt.jsx("span",{className:"text-muted-foreground",children:c.value})]},y))})]})}function pre(){return Bt.jsxs(mg,{className:"p-4",children:[Bt.jsx("h3",{className:"text-sm font-medium mb-4",children:"Patologías principales"}),Bt.jsx("div",{className:"relative h-48",children:Bt.jsx(r2,{width:"100%",height:"100%",children:Bt.jsx(uj,{children:Bt.jsx(Bh,{data:aE,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",children:aE.map((r,n)=>Bt.jsx(qy,{fill:r.color},`cell-${n}`))})})})}),Bt.jsx("div",{className:"mt-4 space-y-2",children:aE.map((r,n)=>Bt.jsxs("div",{className:"flex items-center justify-between text-sm",children:[Bt.jsxs("div",{className:"flex items-center gap-2",children:[Bt.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:r.color}}),Bt.jsx("span",{children:r.name})]}),Bt.jsxs("div",{className:"flex items-center gap-2",children:[Bt.jsx("span",{children:r.value}),Bt.jsxs("span",{className:"text-xs bg-muted px-2 py-1 rounded",children:[r.percentage,"%"]})]})]},n))})]})}function mre(){return Bt.jsxs(mg,{className:"p-4",children:[Bt.jsx("h3",{className:"text-sm font-medium mb-4",children:"Línea temporal"}),Bt.jsx("div",{className:"h-64",children:Bt.jsx(r2,{width:"100%",height:"100%",children:Bt.jsxs(fre,{data:dre,layout:"horizontal",children:[Bt.jsx(ZN,{strokeDasharray:"3 3"}),Bt.jsx(Nx,{type:"number"}),Bt.jsx(jx,{dataKey:"year",type:"category"}),Bt.jsx(bm,{dataKey:"value",fill:"#9ca3af"})]})})})]})}function gre(){return Bt.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:[Bt.jsx(C3,{data:I3,title:"Tipo de acceso",centerText:"67%"}),Bt.jsx(C3,{data:I3,title:"Tipo de acceso"}),Bt.jsx(pre,{}),Bt.jsx("div",{className:"xl:col-span-2",children:Bt.jsx(mre,{})})]})}var s0={exports:{}},_re=s0.exports,M3;function yre(){return M3||(M3=1,(function(r,n){(function(l,c){r.exports=c()})(_re,(function(){var l,c,y;function w(a,R){if(!l)l=R;else if(!c)c=R;else{var z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+c+")(sharedChunk); self.onerror = null;",$={};l($),y=R($),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(y.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}w(["exports"],(function(a){var R=1e-6,z=typeof Float32Array<"u"?Float32Array:Array;function $(o,e){var i=e[0],u=e[1],h=e[2],p=e[3],m=i*p-h*u;return m?(o[0]=p*(m=1/m),o[1]=-u*m,o[2]=-h*m,o[3]=i*m,o):null}function V(){var o=new z(9);return z!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function W(o,e){var i=e[0],u=e[1],h=e[2],p=e[3],m=e[4],b=e[5],T=e[6],A=e[7],M=e[8];return o[0]=m*M-b*A,o[1]=h*A-u*M,o[2]=u*b-h*m,o[3]=b*T-p*M,o[4]=i*M-h*T,o[5]=h*p-i*b,o[6]=p*A-m*T,o[7]=u*T-i*A,o[8]=i*m-u*p,o}function ie(o,e,i){var u=e[0],h=e[1],p=e[2],m=e[3],b=e[4],T=e[5],A=e[6],M=e[7],O=e[8],D=i[0],N=i[1],U=i[2],H=i[3],X=i[4],te=i[5],ue=i[6],le=i[7],fe=i[8];return o[0]=D*u+N*m+U*A,o[1]=D*h+N*b+U*M,o[2]=D*p+N*T+U*O,o[3]=H*u+X*m+te*A,o[4]=H*h+X*b+te*M,o[5]=H*p+X*T+te*O,o[6]=ue*u+le*m+fe*A,o[7]=ue*h+le*b+fe*M,o[8]=ue*p+le*T+fe*O,o}function ae(){var o=new z(16);return z!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o}function ee(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function ne(o,e){var i=e[0],u=e[1],h=e[2],p=e[3],m=e[4],b=e[5],T=e[6],A=e[7],M=e[8],O=e[9],D=e[10],N=e[11],U=e[12],H=e[13],X=e[14],te=e[15],ue=i*b-u*m,le=i*T-h*m,fe=i*A-p*m,De=u*T-h*b,Ie=u*A-p*b,Ce=h*A-p*T,Be=M*H-O*U,je=M*X-D*U,st=M*te-N*U,Ge=O*X-D*H,ft=O*te-N*H,jt=D*te-N*X,_t=ue*jt-le*ft+fe*Ge+De*st-Ie*je+Ce*Be;return _t?(o[0]=(b*jt-T*ft+A*Ge)*(_t=1/_t),o[1]=(h*ft-u*jt-p*Ge)*_t,o[2]=(H*Ce-X*Ie+te*De)*_t,o[3]=(D*Ie-O*Ce-N*De)*_t,o[4]=(T*st-m*jt-A*je)*_t,o[5]=(i*jt-h*st+p*je)*_t,o[6]=(X*fe-U*Ce-te*le)*_t,o[7]=(M*Ce-D*fe+N*le)*_t,o[8]=(m*ft-b*st+A*Be)*_t,o[9]=(u*st-i*ft-p*Be)*_t,o[10]=(U*Ie-H*fe+te*ue)*_t,o[11]=(O*fe-M*Ie-N*ue)*_t,o[12]=(b*je-m*Ge-T*Be)*_t,o[13]=(i*Ge-u*je+h*Be)*_t,o[14]=(H*le-U*De-X*ue)*_t,o[15]=(M*De-O*le+D*ue)*_t,o):null}function de(o,e,i){var u=e[0],h=e[1],p=e[2],m=e[3],b=e[4],T=e[5],A=e[6],M=e[7],O=e[8],D=e[9],N=e[10],U=e[11],H=e[12],X=e[13],te=e[14],ue=e[15],le=i[0],fe=i[1],De=i[2],Ie=i[3];return o[0]=le*u+fe*b+De*O+Ie*H,o[1]=le*h+fe*T+De*D+Ie*X,o[2]=le*p+fe*A+De*N+Ie*te,o[3]=le*m+fe*M+De*U+Ie*ue,o[4]=(le=i[4])*u+(fe=i[5])*b+(De=i[6])*O+(Ie=i[7])*H,o[5]=le*h+fe*T+De*D+Ie*X,o[6]=le*p+fe*A+De*N+Ie*te,o[7]=le*m+fe*M+De*U+Ie*ue,o[8]=(le=i[8])*u+(fe=i[9])*b+(De=i[10])*O+(Ie=i[11])*H,o[9]=le*h+fe*T+De*D+Ie*X,o[10]=le*p+fe*A+De*N+Ie*te,o[11]=le*m+fe*M+De*U+Ie*ue,o[12]=(le=i[12])*u+(fe=i[13])*b+(De=i[14])*O+(Ie=i[15])*H,o[13]=le*h+fe*T+De*D+Ie*X,o[14]=le*p+fe*A+De*N+Ie*te,o[15]=le*m+fe*M+De*U+Ie*ue,o}function xe(o,e,i){var u,h,p,m,b,T,A,M,O,D,N,U,H=i[0],X=i[1],te=i[2];return e===o?(o[12]=e[0]*H+e[4]*X+e[8]*te+e[12],o[13]=e[1]*H+e[5]*X+e[9]*te+e[13],o[14]=e[2]*H+e[6]*X+e[10]*te+e[14],o[15]=e[3]*H+e[7]*X+e[11]*te+e[15]):(h=e[1],p=e[2],m=e[3],b=e[4],T=e[5],A=e[6],M=e[7],O=e[8],D=e[9],N=e[10],U=e[11],o[0]=u=e[0],o[1]=h,o[2]=p,o[3]=m,o[4]=b,o[5]=T,o[6]=A,o[7]=M,o[8]=O,o[9]=D,o[10]=N,o[11]=U,o[12]=u*H+b*X+O*te+e[12],o[13]=h*H+T*X+D*te+e[13],o[14]=p*H+A*X+N*te+e[14],o[15]=m*H+M*X+U*te+e[15]),o}function be(o,e,i){var u=i[0],h=i[1],p=i[2];return o[0]=e[0]*u,o[1]=e[1]*u,o[2]=e[2]*u,o[3]=e[3]*u,o[4]=e[4]*h,o[5]=e[5]*h,o[6]=e[6]*h,o[7]=e[7]*h,o[8]=e[8]*p,o[9]=e[9]*p,o[10]=e[10]*p,o[11]=e[11]*p,o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15],o}function ke(o,e,i){var u=Math.sin(i),h=Math.cos(i),p=e[4],m=e[5],b=e[6],T=e[7],A=e[8],M=e[9],O=e[10],D=e[11];return e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[3],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[4]=p*h+A*u,o[5]=m*h+M*u,o[6]=b*h+O*u,o[7]=T*h+D*u,o[8]=A*h-p*u,o[9]=M*h-m*u,o[10]=O*h-b*u,o[11]=D*h-T*u,o}function he(o,e,i){var u=Math.sin(i),h=Math.cos(i),p=e[0],m=e[1],b=e[2],T=e[3],A=e[8],M=e[9],O=e[10],D=e[11];return e!==o&&(o[4]=e[4],o[5]=e[5],o[6]=e[6],o[7]=e[7],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=p*h-A*u,o[1]=m*h-M*u,o[2]=b*h-O*u,o[3]=T*h-D*u,o[8]=p*u+A*h,o[9]=m*u+M*h,o[10]=b*u+O*h,o[11]=T*u+D*h,o}function _e(o,e,i){var u=Math.sin(i),h=Math.cos(i),p=e[0],m=e[1],b=e[2],T=e[3],A=e[4],M=e[5],O=e[6],D=e[7];return e!==o&&(o[8]=e[8],o[9]=e[9],o[10]=e[10],o[11]=e[11],o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o[0]=p*h+A*u,o[1]=m*h+M*u,o[2]=b*h+O*u,o[3]=T*h+D*u,o[4]=A*h-p*u,o[5]=M*h-m*u,o[6]=O*h-b*u,o[7]=D*h-T*u,o}function ze(o,e){return o[0]=e[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=e[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=e[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Ne(o,e,i){var u,h,p,m=i[0],b=i[1],T=i[2],A=Math.hypot(m,b,T);return A<R?null:(m*=A=1/A,b*=A,T*=A,u=Math.sin(e),h=Math.cos(e),o[0]=m*m*(p=1-h)+h,o[1]=b*m*p+T*u,o[2]=T*m*p-b*u,o[3]=0,o[4]=m*b*p-T*u,o[5]=b*b*p+h,o[6]=T*b*p+m*u,o[7]=0,o[8]=m*T*p+b*u,o[9]=b*T*p-m*u,o[10]=T*T*p+h,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}function rt(o,e){var i=e[0],u=e[1],h=e[2],p=e[3],m=i+i,b=u+u,T=h+h,A=i*m,M=u*m,O=u*b,D=h*m,N=h*b,U=h*T,H=p*m,X=p*b,te=p*T;return o[0]=1-O-U,o[1]=M+te,o[2]=D-X,o[3]=0,o[4]=M-te,o[5]=1-A-U,o[6]=N+H,o[7]=0,o[8]=D+X,o[9]=N-H,o[10]=1-A-O,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}Math.hypot||(Math.hypot=function(){for(var o=0,e=arguments.length;e--;)o+=arguments[e]*arguments[e];return Math.sqrt(o)});var kt=de;function He(){var o=new z(3);return z!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function yt(o){var e=new z(3);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e}function gt(o){return Math.hypot(o[0],o[1],o[2])}function Pt(o,e,i){var u=new z(3);return u[0]=o,u[1]=e,u[2]=i,u}function xt(o,e,i,u){return o[0]=e,o[1]=i,o[2]=u,o}function Tt(o,e,i){return o[0]=e[0]+i[0],o[1]=e[1]+i[1],o[2]=e[2]+i[2],o}function Ht(o,e,i){return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o[2]=e[2]-i[2],o}function lt(o,e,i){return o[0]=e[0]*i[0],o[1]=e[1]*i[1],o[2]=e[2]*i[2],o}function Wt(o,e,i){return o[0]=Math.min(e[0],i[0]),o[1]=Math.min(e[1],i[1]),o[2]=Math.min(e[2],i[2]),o}function Zt(o,e,i){return o[0]=Math.max(e[0],i[0]),o[1]=Math.max(e[1],i[1]),o[2]=Math.max(e[2],i[2]),o}function $e(o,e,i){return o[0]=e[0]*i,o[1]=e[1]*i,o[2]=e[2]*i,o}function pt(o,e,i,u){return o[0]=e[0]+i[0]*u,o[1]=e[1]+i[1]*u,o[2]=e[2]+i[2]*u,o}function fr(o,e){var i=e[0]-o[0],u=e[1]-o[1],h=e[2]-o[2];return i*i+u*u+h*h}function zr(o){var e=o[0],i=o[1],u=o[2];return e*e+i*i+u*u}function Hr(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o}function Ir(o,e){var i=e[0],u=e[1],h=e[2],p=i*i+u*u+h*h;return p>0&&(p=1/Math.sqrt(p)),o[0]=e[0]*p,o[1]=e[1]*p,o[2]=e[2]*p,o}function Lr(o,e){return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]}function Ur(o,e,i){var u=e[0],h=e[1],p=e[2],m=i[0],b=i[1],T=i[2];return o[0]=h*T-p*b,o[1]=p*m-u*T,o[2]=u*b-h*m,o}function or(o,e,i,u){var h=e[0],p=e[1],m=e[2];return o[0]=h+u*(i[0]-h),o[1]=p+u*(i[1]-p),o[2]=m+u*(i[2]-m),o}function Er(o,e,i){var u=e[0],h=e[1],p=e[2],m=i[3]*u+i[7]*h+i[11]*p+i[15];return o[0]=(i[0]*u+i[4]*h+i[8]*p+i[12])/(m=m||1),o[1]=(i[1]*u+i[5]*h+i[9]*p+i[13])/m,o[2]=(i[2]*u+i[6]*h+i[10]*p+i[14])/m,o}function pn(o,e,i){var u=e[0],h=e[1],p=e[2];return o[0]=u*i[0]+h*i[3]+p*i[6],o[1]=u*i[1]+h*i[4]+p*i[7],o[2]=u*i[2]+h*i[5]+p*i[8],o}function sr(o,e,i){var u=i[0],h=i[1],p=i[2],m=e[0],b=e[1],T=e[2],A=h*T-p*b,M=p*m-u*T,O=u*b-h*m,D=h*O-p*M,N=p*A-u*O,U=u*M-h*A,H=2*i[3];return M*=H,O*=H,N*=2,U*=2,o[0]=m+(A*=H)+(D*=2),o[1]=b+M+N,o[2]=T+O+U,o}function Pi(o){return o[0]=0,o[1]=0,o[2]=0,o}function Rn(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]}var In=Ht,ci=lt,Ki=gt;function wa(){var o=new z(4);return z!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0),o}function $o(o,e,i){return o[0]=e[0]*i,o[1]=e[1]*i,o[2]=e[2]*i,o[3]=e[3]*i,o}function fo(o,e){var i=e[0],u=e[1],h=e[2],p=e[3],m=i*i+u*u+h*h+p*p;return m>0&&(m=1/Math.sqrt(m)),o[0]=i*m,o[1]=u*m,o[2]=h*m,o[3]=p*m,o}function Ui(o,e,i){var u=e[0],h=e[1],p=e[2],m=e[3];return o[0]=i[0]*u+i[4]*h+i[8]*p+i[12]*m,o[1]=i[1]*u+i[5]*h+i[9]*p+i[13]*m,o[2]=i[2]*u+i[6]*h+i[10]*p+i[14]*m,o[3]=i[3]*u+i[7]*h+i[11]*p+i[15]*m,o}function Fo(){var o=new z(4);return z!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Fa(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function Ms(o,e,i){i*=.5;var u=e[0],h=e[1],p=e[2],m=e[3],b=Math.sin(i),T=Math.cos(i);return o[0]=u*T+m*b,o[1]=h*T+p*b,o[2]=p*T-h*b,o[3]=m*T-u*b,o}function Js(o,e,i){i*=.5;var u=e[0],h=e[1],p=e[2],m=e[3],b=Math.sin(i),T=Math.cos(i);return o[0]=u*T-p*b,o[1]=h*T+m*b,o[2]=p*T+u*b,o[3]=m*T-h*b,o}He(),wa();var la,Sa,Jl,Qs=fo,el=(la=He(),Sa=Pt(1,0,0),Jl=Pt(0,1,0),function(o,e,i){var u=Lr(e,i);return u<-.999999?(Ur(la,Sa,e),Ki(la)<1e-6&&Ur(la,Jl,e),Ir(la,la),(function(h,p,m){m*=.5;var b=Math.sin(m);h[0]=b*p[0],h[1]=b*p[1],h[2]=b*p[2],h[3]=Math.cos(m)})(o,la,Math.PI),o):u>.999999?(o[0]=0,o[1]=0,o[2]=0,o[3]=1,o):(Ur(la,e,i),o[0]=la[0],o[1]=la[1],o[2]=la[2],o[3]=1+u,Qs(o,o))});function vo(){var o=new z(2);return z!=Float32Array&&(o[0]=0,o[1]=0),o}function ts(o,e){var i=new z(2);return i[0]=o,i[1]=e,i}function wl(o,e,i){return o[0]=e[0]+i[0],o[1]=e[1]+i[1],o}function tl(o,e,i){return o[0]=e[0]-i[0],o[1]=e[1]-i[1],o}function Ql(o,e,i){return o[0]=e[0]*i,o[1]=e[1]*i,o}function rl(o){return Math.hypot(o[0],o[1])}function eu(o,e){var i=e[0],u=e[1],h=i*i+u*u;return h>0&&(h=1/Math.sqrt(h)),o[0]=e[0]*h,o[1]=e[1]*h,o}function ii(o,e){return o[0]*e[0]+o[1]*e[1]}Fo(),Fo(),V();var Gu,Hu,qo=tl;function nl(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}vo();var Kf=(function(){if(Hu)return Gu;function o(e,i,u,h){this.cx=3*e,this.bx=3*(u-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=u,this.p2y=h}return Hu=1,Gu=o,o.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var u=e,h=0;h<8;h++){var p=this.sampleCurveX(u)-e;if(Math.abs(p)<i)return u;var m=this.sampleCurveDerivativeX(u);if(Math.abs(m)<1e-6)break;u-=p/m}var b=0,T=1;for(u=e,h=0;h<20&&(p=this.sampleCurveX(u),!(Math.abs(p-e)<i));h++)e>p?b=u:T=u,u=.5*(T-b)+b;return u},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Gu})(),Wu=nl(Kf);function Ct(o,e){this.x=o,this.y=e}function il(o,e){if(Array.isArray(o)){if(!Array.isArray(e)||o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(!il(o[i],e[i]))return!1;return!0}if(typeof o=="object"&&o!==null&&e!==null){if(typeof e!="object"||Object.keys(o).length!==Object.keys(e).length)return!1;for(const i in o)if(!il(o[i],e[i]))return!1;return!0}return o===e}Ct.prototype={clone(){return new Ct(this.x,this.y)},add(o){return this.clone()._add(o)},sub(o){return this.clone()._sub(o)},multByPoint(o){return this.clone()._multByPoint(o)},divByPoint(o){return this.clone()._divByPoint(o)},mult(o){return this.clone()._mult(o)},div(o){return this.clone()._div(o)},rotate(o){return this.clone()._rotate(o)},rotateAround(o,e){return this.clone()._rotateAround(o,e)},matMult(o){return this.clone()._matMult(o)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(o){return this.x===o.x&&this.y===o.y},dist(o){return Math.sqrt(this.distSqr(o))},distSqr(o){const e=o.x-this.x,i=o.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith(o){return this.angleWithSep(o.x,o.y)},angleWithSep(o,e){return Math.atan2(this.x*e-this.y*o,this.x*o+this.y*e)},_matMult(o){const e=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=e,this},_add(o){return this.x+=o.x,this.y+=o.y,this},_sub(o){return this.x-=o.x,this.y-=o.y,this},_mult(o){return this.x*=o,this.y*=o,this},_div(o){return this.x/=o,this.y/=o,this},_multByPoint(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint(o){return this.x/=o.x,this.y/=o.y,this},_unit(){return this._div(this.mag()),this},_perp(){const o=this.y;return this.y=this.x,this.x=-o,this},_rotate(o){const e=Math.cos(o),i=Math.sin(o),u=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=u,this},_rotateAround(o,e){const i=Math.cos(o),u=Math.sin(o),h=e.y+u*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-u*(this.y-e.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Ct},Ct.convert=function(o){if(o instanceof Ct)return o;if(Array.isArray(o))return new Ct(+o[0],+o[1]);if(o.x!==void 0&&o.y!==void 0)return new Ct(+o.x,+o.y);throw new Error("Expected [x, y] or {x, y} point format")};const Yf=Math.PI/180,Zu=180/Math.PI;function Cn(o){return o*Yf}function Ke(o){return o*Zu}const re=[[0,0],[1,0],[1,1],[0,1]];function oe(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,i=e*o;return 4*(o<.5?i:3*(o-e)+i-.75)}function ye(o,e,i,u){const h=new Wu(o,e,i,u);return function(p){return h.solve(p)}}const Oe=ye(.25,.1,.25,1);function ve(o,e,i){return Math.min(i,Math.max(e,o))}function Fe(o,e,i){return(i=ve((i-o)/(e-o),0,1))*i*(3-2*i)}function et(o,e,i){const u=i-e,h=((o-e)%u+u)%u+e;return h===e?i:h}function Ue(o,e,i){if(!o.length)return i(null,[]);let u=o.length;const h=new Array(o.length);let p=null;o.forEach(((m,b)=>{e(m,((T,A)=>{T&&(p=T),h[b]=A,--u==0&&i(p,h)}))}))}function Qe(o,...e){for(const i of e)for(const u in i)o[u]=i[u];return o}let Nt=1;function mt(){return Nt++}function vr(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function Cr(o,e){o.forEach((i=>{e[i]&&(e[i]=e[i].bind(e))}))}function Br(o,e,i){const u={};for(const h in o)u[h]=e.call(this,o[h],h,o);return u}function ln(o,e,i){const u={};for(const h in o)e.call(this,o[h],h,o)&&(u[h]=o[h]);return u}function Jr(o){return Array.isArray(o)?o.map(Jr):typeof o=="object"&&o?Br(o,Jr):o}function cn(o,e){for(let i=0;i<o.length;i++)if(e.indexOf(o[i])>=0)return!0;return!1}const Yn={};function hn(o){Yn[o]||(typeof console<"u"&&console.warn(o),Yn[o]=!0)}function Li(o,e,i){return(i.y-o.y)*(e.x-o.x)>(e.y-o.y)*(i.x-o.x)}function $n(o){let e=0;for(let i,u,h=0,p=o.length,m=p-1;h<p;m=h++)i=o[h],u=o[m],e+=(u.x-i.x)*(i.y+u.y);return e}function to([o,e,i]){const u=Cn(e+90),h=Cn(i);return{x:o*Math.cos(u)*Math.sin(h),y:o*Math.sin(u)*Math.sin(h),z:o*Math.cos(h),azimuthal:e,polar:i}}function qn(o){return(typeof self<"u"||o!==void 0)&&typeof WorkerGlobalScope<"u"&&(o!==void 0?o:self)instanceof WorkerGlobalScope}function kn(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,u,h,p)=>{const m=h||p;return e[u]=!m||m.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let bi=null;function Ti(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}function gi(o,e,i,u){for(;e<i;){const h=e+i>>1;o[h]<u?e=h+1:i=h}return e}function oo(o,e,i,u){for(;e<i;){const h=e+i>>1;o[h]<=u?e=h+1:i=h}return e}function ro(o){return o>0?1/(1.001-o):1+o}function Qo(o){return o>0?1-1/(1.001-o):-o}function Ta(o,e,i){return(o-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Bo={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Bo.API_URL)return null;try{const o=new URL(Bo.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.1.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function tu(o){return Bo.API_URL_REGEX.test(o)}function Jf(o){return Bo.API_SPRITE_REGEX.test(o)}let ru,nu,iu,Xu,Ku,Nh;function Vc(){return ru==null&&(ru=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),ru}const ds={now:()=>Xu!==void 0?Xu:performance.now(),setNow(o){Xu=o},restoreNow(){Xu=void 0},frame(o){const e=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(o,e=0){const{width:i,height:u}=o;Ku||(Ku=document.createElement("canvas"));const h=Ku.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>Ku.width||u>Ku.height)&&(Ku.width=i,Ku.height=u),h.clearRect(-e,-e,i+2*e,u+2*e),h.drawImage(o,0,0,i,u),h.getImageData(-e,-e,i+2*e,u+2*e)},resolveURL:o=>(nu||(nu=document.createElement("a")),nu.href=o,nu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(iu==null&&(iu=window.matchMedia("(prefers-reduced-motion: reduce)")),iu.matches)},hasCanvasFingerprintNoise(){if(Nh!==void 0)return Nh;if(!Vc())return Nh=!1,!1;const o=new OffscreenCanvas(85,1),e=o.getContext("2d",{willReadFrequently:!0});let i=0;for(let h=0;h<o.width;++h)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(h,0,1,1);const u=e.getImageData(0,0,o.width,o.height);i=0;for(let h=0;h<u.data.length;++h)if(h%4!=3&&i++!==u.data[h])return Nh=!0,!0;return Nh=!1,!1}};function Ea(o,e){const i=o.indexOf("?");if(i<0)return`${o}?${new URLSearchParams(e).toString()}`;const u=new URLSearchParams(o.slice(i));for(const h in e)u.set(h,e[h]);return`${o.slice(0,i)}?${u.toString()}`}function ua(o,e={persistentParams:[]}){const i=o.indexOf("?");if(i<0)return o;const u=new URLSearchParams,h=new URLSearchParams(o.slice(i));for(const m of e.persistentParams){const b=h.get(m);b&&u.set(m,b)}const p=u.toString();return`${o.slice(0,i)}${p.length>0?`?${p}`:""}`}const Sl="mapbox-tiles";let rs=500,oi=50;const $c=["language","worldview","jobid"];let Os,Yu;function ou(){try{return caches}catch{}}function Ju(){const o=ou();o&&Os==null&&(Os=o.open(Sl))}let Qf=1/0;const jh={supported:!1,testSupport:function(o){!ps&&Ba&&(ns?Gc(o):Go=o)}};let Go,Ba,ps=!1,ns=!1;const qc=typeof self<"u"?self:{};function Gc(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Ba),o.isContextLost())return;jh.supported=!0}catch{}o.deleteTexture(e),ps=!0}qc.document&&(Ba=qc.document.createElement("img"),Ba.onload=function(){Go&&Gc(Go),Go=null,ns=!0},Ba.onerror=function(){ps=!0,Go=null},Ba.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ms={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ms);class bn extends Error{constructor(e,i,u){i===401&&tu(u)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Uh=qn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ol=function(o,e){if(!(/^file:/.test(i=o.url)||/^file:/.test(Uh())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(u,h){const p=new AbortController,m=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Uh(),referrerPolicy:u.referrerPolicy,signal:p.signal});let b=!1,T=!1;const A=(M=m.url).indexOf("sku=")>0&&tu(M);var M;u.type==="json"&&m.headers.set("Accept","application/json");const O=(N,U,H)=>{if(T)return;if(N&&N.message!=="SecurityError"&&hn(N.toString()),U&&H)return D(U);const X=Date.now();fetch(m).then((te=>{if(te.ok){const ue=A?te.clone():null;return D(te,ue,X)}return h(new bn(te.statusText,te.status,u.url))})).catch((te=>{te.name!=="AbortError"&&h(new Error(`${te.message} ${u.url}`))}))},D=(N,U,H)=>{(u.type==="arrayBuffer"?N.arrayBuffer():u.type==="json"?N.json():N.text()).then((X=>{T||(U&&H&&(function(te,ue,le){if(Ju(),Os==null)return;const fe=kn(ue.headers.get("Cache-Control")||"");if(fe["no-store"])return;const De={status:ue.status,statusText:ue.statusText,headers:new Headers};ue.headers.forEach(((Be,je)=>De.headers.set(je,Be))),fe["max-age"]&&De.headers.set("Expires",new Date(le+1e3*fe["max-age"]).toUTCString());const Ie=De.headers.get("Expires");if(!Ie||new Date(Ie).getTime()-le<42e4)return;let Ce=ua(te.url,{persistentParams:$c});if(ue.status===206){const Be=te.headers.get("Range");if(!Be)return;De.status=200,Ce=Ea(Ce,{range:Be})}(function(Be,je){if(Yu===void 0)try{new Response(new ReadableStream),Yu=!0}catch{Yu=!1}Yu?je(Be.body):Be.blob().then(je).catch((st=>hn(st.message)))})(ue,(Be=>{const je=new Response((st=ue.status)!==200&&st!==404&&[101,103,204,205,304].includes(st)?null:Be,De);var st;Ju(),Os?.then((Ge=>Ge.put(Ce,je))).catch((Ge=>hn(Ge.message)))}))})(m,U,H),b=!0,h(null,X,N.headers.get("Cache-Control"),N.headers.get("Expires")))})).catch((X=>{T||h(new Error(X.message))}))};return A?(function(N,U){if(Ju(),Os==null)return U(null);Os.then((H=>{let X=ua(N.url,{persistentParams:$c});const te=N.headers.get("Range");te&&(X=Ea(X,{range:te})),H.match(X).then((ue=>{const le=(function(fe){if(!fe)return!1;const De=new Date(fe.headers.get("Expires")||0),Ie=kn(fe.headers.get("Cache-Control")||"");return Number(De)>Date.now()&&!Ie["no-cache"]})(ue);H.delete(X).catch(U),le&&H.put(X,ue.clone()).catch(U),U(null,ue,le)})).catch(U)})).catch(U)})(m,O):O(null,null),{cancel:()=>{T=!0,b||p.abort()}}})(o,e);if(qn(self)&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var i;return(function(u,h){const p=new XMLHttpRequest;p.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const m in u.headers)p.setRequestHeader(m,u.headers[m]);return u.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=u.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(u.type==="json")try{m=JSON.parse(p.response)}catch(b){return h(b)}h(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new bn(p.statusText,p.status,u.url))},p.send(u.body),{cancel:()=>p.abort()}})(o,e)},Vh=function(o,e){return ol(Qe(o,{type:"arrayBuffer"}),e)};function wm(o){const e=document.createElement("a");return e.href=o,e.protocol===location.protocol&&e.host===location.host}const au="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let su,lu;su=[],lu=0;const Tl=function(o,e){if(jh.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),lu>=Bo.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return su.push(p),p}lu++;let i=!1;const u=()=>{if(!i)for(i=!0,lu--;su.length&&lu<Bo.MAX_PARALLEL_IMAGE_REQUESTS;){const p=su.shift(),{requestParameters:m,callback:b,cancelled:T}=p;T||(p.cancel=Tl(m,b).cancel)}},h=Vh(o,((p,m,b,T)=>{u(),p?e(p):m&&(self.createImageBitmap?(function(A,M){const O=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(O).then((D=>{M(null,D)})).catch((D=>{M(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(m,((A,M)=>e(A,M,b,T))):(function(A,M){const O=new Image;O.onload=()=>{M(null,O),URL.revokeObjectURL(O.src),O.onload=null,requestAnimationFrame((()=>{O.src=au}))},O.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Blob([new Uint8Array(A)],{type:"image/png"});O.src=A.byteLength?URL.createObjectURL(D):au})(m,((A,M)=>e(A,M,b,T))))}));return{cancel:()=>{h.cancel(),u()}}};var Hc,El,$h,Wc={exports:{}},Qu={exports:{}},ed={exports:{}},uu=(function(){if($h)return Wc.exports;$h=1;var o=(Hc||(Hc=1,Qu.exports=function(i,u){var h,p,m,b,T,A,M,O;for(p=i.length-(h=3&i.length),m=u,T=3432918353,A=461845907,O=0;O<p;)M=255&i.charCodeAt(O)|(255&i.charCodeAt(++O))<<8|(255&i.charCodeAt(++O))<<16|(255&i.charCodeAt(++O))<<24,++O,m=27492+(65535&(b=5*(65535&(m=(m^=M=(65535&(M=(M=(65535&M)*T+(((M>>>16)*T&65535)<<16)&4294967295)<<15|M>>>17))*A+(((M>>>16)*A&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(M=0,h){case 3:M^=(255&i.charCodeAt(O+2))<<16;case 2:M^=(255&i.charCodeAt(O+1))<<8;case 1:m^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(O)))*T+(((M>>>16)*T&65535)<<16)&4294967295)<<15|M>>>17))*A+(((M>>>16)*A&65535)<<16)&4294967295}return m^=i.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),Qu.exports),e=(El||(El=1,ed.exports=function(i,u){for(var h,p=i.length,m=u^p,b=0;p>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(b)|(255&i.charCodeAt(++b))<<8|(255&i.charCodeAt(++b))<<16|(255&i.charCodeAt(++b))<<24))+((1540483477*(h>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),p-=4,++b;switch(p){case 3:m^=(255&i.charCodeAt(b+2))<<16;case 2:m^=(255&i.charCodeAt(b+1))<<8;case 1:m=1540483477*(65535&(m^=255&i.charCodeAt(b)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),ed.exports);return Wc.exports=o,Wc.exports.murmur3=o,Wc.exports.murmur2=e,Wc.exports})(),cu=nl(uu);class al{constructor(e,...i){Qe(this,i[0]||{}),this.type=e}}class Io extends al{constructor(e,i={}){super("error",Qe({error:e},i))}}function qh(o,e,i){i[o]&&i[o].indexOf(e)!==-1||(i[o]=i[o]||[],i[o].push(e))}function Zc(o,e,i){if(i&&i[o]){const u=i[o].indexOf(e);u!==-1&&i[o].splice(u,1)}}class hu{on(e,i){return this._listeners=this._listeners||{},qh(e,i,this._listeners),this}off(e,i){return Zc(e,i,this._listeners),Zc(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},qh(e,i,this._oneTimeListeners),this):new Promise((u=>{this.once(e,u)}))}fire(e,i){const u=typeof e=="string"?new al(e,i):e,h=u.type;if(this.listens(h)){u.target=this;const p=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const T of p)T.call(this,u);const m=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const T of m)Zc(h,T,this._oneTimeListeners),T.call(this,u);const b=this._eventedParent;b&&(Qe(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(u))}else u instanceof Io&&console.error(u.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class ea{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new ea(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,u]=e.split("");return new ea({name:i,iconsetId:u})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return ea.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Xc,Gh={},Aa=(function(){if(Xc)return Gh;Xc=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(p){return(p=Math.round(p))<0?0:p>255?255:p}function i(p){return e(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function u(p){return(m=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:m>1?1:m;var m}function h(p,m,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?p+(m-p)*b*6:2*b<1?m:3*b<2?p+(m-p)*(2/3-b)*6:p}try{Gh.parseCSSColor=function(p){var m,b=p.replace(/ /g,"").toLowerCase();if(b in o)return o[b].slice();if(b[0]==="#")return b.length===4?(m=parseInt(b.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:b.length===7&&(m=parseInt(b.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var T=b.indexOf("("),A=b.indexOf(")");if(T!==-1&&A+1===b.length){var M=b.substr(0,T),O=b.substr(T+1,A-(T+1)).split(","),D=1;switch(M){case"rgba":if(O.length!==4)return null;D=u(O.pop());case"rgb":return O.length!==3?null:[i(O[0]),i(O[1]),i(O[2]),D];case"hsla":if(O.length!==4)return null;D=u(O.pop());case"hsl":if(O.length!==3)return null;var N=(parseFloat(O[0])%360+360)%360/360,U=u(O[1]),H=u(O[2]),X=H<=.5?H*(U+1):H+U-H*U,te=2*H-X;return[e(255*h(te,X,N+1/3)),e(255*h(te,X,N)),e(255*h(te,X,N-1/3)),D];default:return null}}return null}}catch{}return Gh})();class wn{constructor(e,i,u,h=1){this.r=e,this.g=i,this.b=u,this.a=h}static parse(e){if(!e)return;if(e instanceof wn)return e;if(typeof e!="string")return;const i=Aa.parseCSSColor(e);return i?new wn(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,u,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*u)},${h})`}toNonPremultipliedRenderColor(e){const{r:i,g:u,b:h,a:p}=this;return new sl(e,i,u,h,p)}toPremultipliedRenderColor(e){const{r:i,g:u,b:h,a:p}=this;return new Sm(e,i*p,u*p,h*p,p)}clone(){return new wn(this.r,this.g,this.b,this.a)}}class ec{constructor(e,i,u,h,p,m=!1){if(this.premultiplied=!1,this.premultiplied=m,e){const b=e.image.height,T=b*b;this.premultiplied?(i=p===0?0:i/p*(b-1),u=p===0?0:u/p*(b-1),h=p===0?0:h/p*(b-1)):(i*=b-1,u*=b-1,h*=b-1);const A=Math.floor(i),M=Math.floor(u),O=Math.floor(h),D=Math.ceil(i),N=Math.ceil(u),U=Math.ceil(h),H=i-A,X=u-M,te=h-O,ue=e.image.data,le=4*(A+M*T+O*b),fe=4*(A+M*T+U*b),De=4*(A+N*T+O*b),Ie=4*(A+N*T+U*b),Ce=4*(D+M*T+O*b),Be=4*(D+M*T+U*b),je=4*(D+N*T+O*b),st=4*(D+N*T+U*b);if(le<0||st>=ue.length)throw new Error("out of range");this.r=wr(wr(wr(ue[le],ue[fe],te),wr(ue[De],ue[Ie],te),X),wr(wr(ue[Ce],ue[Be],te),wr(ue[je],ue[st],te),X),H)/255*(this.premultiplied?p:1),this.g=wr(wr(wr(ue[le+1],ue[fe+1],te),wr(ue[De+1],ue[Ie+1],te),X),wr(wr(ue[Ce+1],ue[Be+1],te),wr(ue[je+1],ue[st+1],te),X),H)/255*(this.premultiplied?p:1),this.b=wr(wr(wr(ue[le+2],ue[fe+2],te),wr(ue[De+2],ue[Ie+2],te),X),wr(wr(ue[Ce+2],ue[Be+2],te),wr(ue[je+2],ue[st+2],te),X),H)/255*(this.premultiplied?p:1),this.a=p}else this.r=i,this.g=u,this.b=h,this.a=p}toArray(){const{r:e,g:i,b:u,a:h}=this;return[255*e,255*i,255*u,h]}toHslaArray(){let{r:e,g:i,b:u,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];e/=h,i/=h,u/=h}const p=Math.min(Math.max(e,0),1),m=Math.min(Math.max(i,0),1),b=Math.min(Math.max(u,0),1),T=Math.min(p,m,b),A=Math.max(p,m,b),M=(T+A)/2;if(T===A)return[0,0,100*M,h];const O=A-T,D=M>.5?O/(2-A-T):O/(A+T);let N=0;return A===p?N=(m-b)/O+(m<b?6:0):A===m?N=(b-p)/O+2:A===b&&(N=(p-m)/O+4),N*=60,[Math.min(Math.max(N,0),360),Math.min(Math.max(100*D,0),100),Math.min(Math.max(100*M,0),100),h]}toArray01(){const{r:e,g:i,b:u,a:h}=this;return[e,i,u,h]}toArray01Scaled(e){const{r:i,g:u,b:h}=this;return[i*e,u*e,h*e]}toArray01Linear(){const{r:e,g:i,b:u,a:h}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(u,2.2),h]}}class sl extends ec{constructor(e,i,u,h,p){super(e,i,u,h,p,!1)}}class Sm extends ec{constructor(e,i,u,h,p){super(e,i,u,h,p,!0)}}function wr(o,e,i){return o*(1-i)+e*i}function td(o,e,i){return o.map(((u,h)=>wr(u,e[h],i)))}wn.black=new wn(0,0,0,1),wn.white=new wn(1,1,1,1),wn.transparent=new wn(0,0,0,0),wn.red=new wn(1,0,0,1),wn.blue=new wn(0,0,1,1);var Al=Object.freeze({__proto__:null,array:td,color:function(o,e,i){return new wn(wr(o.r,e.r,i),wr(o.g,e.g,i),wr(o.b,e.b,i),wr(o.a,e.a,i))},number:wr});function ll(o,...e){for(const i of e)for(const u in i)o[u]=i[u];return o}class Na extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class gp{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[u,h]of i)this.bindings[u]=h}concat(e){return new gp(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Kc={kind:"null"},yr={kind:"number"},Dn={kind:"string"},Fn={kind:"boolean"},ja={kind:"color"},Pl={kind:"object"},Nn={kind:"value"},rd={kind:"collator"},Yc={kind:"formatted"},Hh={kind:"resolvedImage"};function ta(o,e){return{kind:"array",itemType:o,N:e}}function no(o){if(o.kind==="array"){const e=no(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}const Kg=[Kc,yr,Dn,Fn,ja,Yc,Pl,ta(Nn),Hh];function fu(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!fu(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(const i of Kg)if(!fu(i,e))return null}}return`Expected ${no(o)} but found ${no(e)} instead.`}function du(o,e){return e.some((i=>i.kind===o.kind))}function Wh(o,e){return e.some((i=>i==="null"?o===null:i==="array"?Array.isArray(o):i==="object"?o&&!Array.isArray(o)&&typeof o=="object":i===typeof o))}function nd(o,e){return o.kind==="array"&&e.kind==="array"?o.N===e.N&&nd(o.itemType,e.itemType):o.kind===e.kind}class Jc{constructor(e,i,u){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class id{constructor(e,i,u,h,p){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=u,this.fontStack=h,this.textColor=p}}class ca{constructor(e){this.sections=e}static fromString(e){return new ca([new id(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof ca?e:ca.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const h=i.image.getPrimary().id.toString();e.push(["image",h]);continue}e.push(i.text);const u={};i.fontStack&&(u["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(u["font-scale"]=i.scale),i.textColor&&(u["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(u)}return e}}class Il{constructor(e,i={}){if(this.id=ea.from(e),this.options=Object.assign({},i),i.transform){const{a:u,b:h,c:p,d:m,e:b,f:T}=i.transform;this.options.transform=new DOMMatrix([u,h,p,m,b,T])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:u,d:h,e:p,f:m}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:u,d:h,e:p,f:m}})}static parse(e){let i,u,h,p;try{({name:i,iconsetId:u,params:h,transform:p}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:m,b,c:T,d:A,e:M,f:O}=p||{};return new Il({name:i,iconsetId:u},{params:h,transform:new DOMMatrix([m,b,T,A,M,O])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class Pa{constructor(e,i,u,h,p=!1){this.primaryId=ea.from(e),this.primaryOptions=i,u&&(this.secondaryId=ea.from(u)),this.secondaryOptions=h,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Il(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Il(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Pa.build({name:e}):e}static build(e,i,u,h){return!e||typeof e=="object"&&!("name"in e)?null:new Pa(e,u,i,h)}}function tc(o,e,i,u){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[o,e,i,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[o,e,i,u]:[o,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Wr(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof wn||o instanceof Jc||o instanceof ca||o instanceof Pa)return!0;if(Array.isArray(o)){for(const e of o)if(!Wr(e))return!1;return!0}if(typeof o=="object"){for(const e in o)if(!Wr(o[e]))return!1;return!0}return!1}function Qt(o){if(o===null)return Kc;if(typeof o=="string")return Dn;if(typeof o=="boolean")return Fn;if(typeof o=="number")return yr;if(o instanceof wn)return ja;if(o instanceof Jc)return rd;if(o instanceof ca)return Yc;if(o instanceof Pa)return Hh;if(Array.isArray(o)){const e=o.length;let i;for(const u of o){const h=Qt(u);if(i){if(i===h)continue;i=Nn;break}i=h}return ta(i||Nn,e)}return Pl}function Ua(o){const e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof ca||o instanceof Pa||o instanceof wn?o.toString():JSON.stringify(o)}class Ar{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Wr(e[1]))return i.error("invalid value");const u=e[1];let h=Qt(u);const p=i.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new Ar(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof wn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ca?this.value.serialize():this.value}}class Yi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Qc={string:Dn,number:yr,boolean:Fn,object:Pl};class Sr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let u,h=1;const p=e[0];if(p==="array"){let b,T;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in Qc)||A==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);b=Qc[A],h++}else b=Nn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);T=e[2],h++}u=ta(b,T)}else u=Qc[p];const m=[];for(;h<e.length;h++){const b=i.parse(e[h],h,Nn);if(!b)return null;m.push(b)}return new Sr(u,m)}evaluate(e){for(let i=0;i<this.args.length;i++){const u=this.args[i].evaluate(e);if(!fu(this.type,Qt(u)))return u;if(i===this.args.length-1)throw new Yi(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${no(Qt(u))} but was expected to be of type ${no(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const u=e.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){i.push(u.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map((u=>u.serialize())))}}class rc{constructor(e){this.type=Yc,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const u=e[1];if(!Array.isArray(u)&&typeof u=="object")return i.error("First argument must be an image or text section.");const h=[];let p=!1;for(let m=1;m<=e.length-1;++m){const b=e[m];if(p&&typeof b=="object"&&!Array.isArray(b)){p=!1;let T=null;if(b["font-scale"]&&(T=i.parseObjectValue(b["font-scale"],m,"font-scale",yr),!T))return null;let A=null;if(b["text-font"]&&(A=i.parseObjectValue(b["text-font"],m,"text-font",ta(Dn)),!A))return null;let M=null;if(b["text-color"]&&(M=i.parseObjectValue(b["text-color"],m,"text-color",ja),!M))return null;const O=h[h.length-1];O.scale=T,O.font=A,O.textColor=M}else{const T=i.parse(e[m],m,Nn);if(!T)return null;const A=T.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:T,scale:null,font:null,textColor:null})}}return new rc(h)}evaluate(e){return new ca(this.sections.map((i=>{const u=i.content.evaluate(e);return nd(Qt(u),Hh)?new id("",u,null,null,null):new id(Ua(u),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const u={};i.scale&&(u["font-scale"]=i.scale.serialize()),i.font&&(u["text-font"]=i.font.serialize()),i.textColor&&(u["text-color"]=i.textColor.serialize()),e.push(u)}return e}}class nc{constructor(e,i,u,h){this._imageWarnHistory={},this.type=Hh,this.namePrimary=e,this.nameSecondary=i,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let u=1;const h=[];function p(){if(u<e.length){const b=i.parse(e[u],u++,Dn);return b?(h.push({image:b,options:{}}),!0):(i.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function m(){if(u<e.length){const T=e[u];if((b=T)===null||typeof b!="object"||Array.isArray(b))return!0;const A=T.params,M=T.iconset,O=i.concat(u);if(!A&&!M)return u++,!0;if(A){if(typeof A!="object"||A.constructor!==Object)return O.error('Image options "params" should be an object'),!1;const D={},N=O.concat(void 0,"params");for(const U in A){if(!U)return N.error("Image parameter name should be non-empty"),!1;const H=N.concat(void 0,U).parse(A[U],void 0,ja,void 0,{typeAnnotation:"coerce"});if(!H)return!1;D[U]=H}h[h.length-1].options.params=D}if(M){if(typeof M!="object"||M.constructor!==Object)return O.error('Image options "iconset" should be an object'),!1;if(!M.id)return O.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=M}return u++,!0}var b;return!0}for(let b=0;b<2;b++)if(!p()||!m())return;return new nc(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(e,i){const u={};if(i){for(const h in i)if(i[h])try{u[h]=i[h].evaluate(e)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,h=Pa.build(i,u,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(h&&e.availableImages){const p=h.getPrimary().id;if(h.available=e.availableImages.some((m=>ea.isEqual(m,p))),h.available){const m=h.getSecondary()?h.getSecondary().id:null;m&&(h.available=e.availableImages.some((b=>ea.isEqual(b,m))))}}return h}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const u={};if(i&&(u.iconset={id:i}),e){u.params={};for(const h in e)e[h]&&(u.params[h]=e[h].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Cl(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}const ic={"to-boolean":Fn,"to-color":ja,"to-number":yr,"to-string":Dn};class gs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const u=e[0],h=[];let p=Kc;if(u==="to-array"){if(!Array.isArray(e[1]))return null;const m=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);p=ta(i.expectedType.itemType,m)}else{if(!(m>0&&Wr(e[1][0])))return null;p=ta(Qt(e[1][0]),m)}for(let b=0;b<m;b++){const T=e[1][b];let A;if(Cl(T)==="array")A=i.parse(T,void 0,p.itemType);else{const M=Cl(T);if(M!==p.itemType.kind)return i.error(`Expected ${p.itemType.kind} but found ${M}.`);A=i.registry.literal.parse(["literal",T===void 0?null:T],i)}if(!A)return null;h.push(A)}}else{if((u==="to-boolean"||u==="to-string")&&e.length!==2)return i.error("Expected one argument.");p=ic[u];for(let m=1;m<e.length;m++){const b=i.parse(e[m],m,Nn);if(!b)return null;h.push(b)}}return new gs(p,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,u;for(const h of this.args){if(i=h.evaluate(e),u=null,i instanceof wn)return i;if(typeof i=="string"){const p=e.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(u=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:tc(i[0],i[1],i[2],i[3]),!u))return new wn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Yi(u||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const u of this.args){if(i=u.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new Yi(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ca.fromString(Ua(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Pa.build(Ua(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((i=>i.evaluate(e))):Ua(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new rc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new nc(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((i=>{e.push(i.serialize())})),e}}const ha=["Unknown","Point","LineString","Polygon"];class Zh{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ha[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*i-e[0])+this.featureDistanceData.bearing[1]*(h*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=wn.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class xo{constructor(e,i,u,h,p){this.name=e,this.type=i,this._evaluate=u,this.args=h,this._overloadIndex=p}evaluate(e){if(!this._evaluate){const i=xo.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,i){const u=e[0],h=xo.definitions[u];if(!h)return i.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,b=[];let T=null,A=-1;for(const[M,O]of m){if(Array.isArray(M)&&M.length!==e.length-1)continue;b.push(M),A++,T=new uh(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const D=[];let N=!1;for(let U=1;U<e.length;U++){const H=e[U],X=Array.isArray(M)?M[U-1]:M.type,te=T.parse(H,1+D.length,X);if(!te){N=!0;break}D.push(te)}if(!N)if(Array.isArray(M)&&M.length!==D.length)T.error(`Expected ${M.length} arguments, but found ${D.length} instead.`);else{for(let U=0;U<D.length;U++){const H=Array.isArray(M)?M[U]:M.type,X=D[U];T.concat(U+1).checkSubtype(H,X.type)}if(T.errors.length===0)return new xo(u,p,O,D,A)}}if(b.length===1)i.errors.push(...T.errors);else{const M=(b.length?b:m.map((([D])=>D))).map(od).join(" | "),O=[];for(let D=1;D<e.length;D++){const N=i.parse(e[D],1+O.length);if(!N)return null;O.push(no(N.type))}i.error(`Expected arguments of type ${M}, but found (${O.join(", ")}) instead.`)}return null}static register(e,i){xo.definitions=i;for(const u in i)e[u]=xo}}function od(o){return Array.isArray(o)?`(${o.map(no).join(", ")})`:`(${no(o.type)}...)`}class Va{constructor(e,i,u){this.type=rd,this.locale=u,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const u=e[1];if(typeof u!="object"||Array.isArray(u))return i.error("Collator options argument must be an object.");const h=u["case-sensitive"]===void 0?i.parse(!1,1,Fn):i.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Fn);if(!h)return null;const p=u["diacritic-sensitive"]===void 0?i.parse(!1,1,Fn):i.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Fn);if(!p)return null;let m=null;return u.locale&&(m=i.parseObjectValue(u.locale,1,"locale",Dn),!m)?null:new Va(h,p,m)}evaluate(e){return new Jc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function bo(o,e,i=0,u=o.length-1,h=ad){for(;u>i;){if(u-i>600){const T=u-i+1,A=e-i+1,M=Math.log(T),O=.5*Math.exp(2*M/3),D=.5*Math.sqrt(M*O*(T-O)/T)*(A-T/2<0?-1:1);bo(o,e,Math.max(i,Math.floor(e-A*O/T+D)),Math.min(u,Math.floor(e+(T-A)*O/T+D)),h)}const p=o[e];let m=i,b=u;for(Xh(o,i,e),h(o[u],p)>0&&Xh(o,i,u);m<b;){for(Xh(o,m,b),m++,b--;h(o[m],p)<0;)m++;for(;h(o[b],p)>0;)b--}h(o[i],p)===0?Xh(o,i,b):(b++,Xh(o,b,u)),b<=e&&(i=b+1),e<=b&&(u=b-1)}}function Xh(o,e,i){const u=o[e];o[e]=o[i],o[i]=u}function ad(o,e){return o<e?-1:o>e?1:0}function Yg(o){let e=0;for(let i,u,h=0,p=o.length,m=p-1;h<p;m=h++)i=o[h],u=o[m],e+=(u.x-i.x)*(i.y+u.y);return e}function Ml(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function pu(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function Ol(o,e,i){const u=o[0]-e[0],h=o[1]-e[1],p=o[0]-i[0],m=o[1]-i[1];return u*m-p*h==0&&u*p<=0&&h*m<=0}function oc(o,e,i=!1){let u=!1;for(let b=0,T=e.length;b<T;b++){const A=e[b];for(let M=0,O=A.length,D=O-1;M<O;D=M++){const N=A[D],U=A[M];if(Ol(o,N,U))return i;(p=N)[1]>(h=o)[1]!=(m=U)[1]>h[1]&&h[0]<(m[0]-p[0])*(h[1]-p[1])/(m[1]-p[1])+p[0]&&(u=!u)}}var h,p,m;return u}function _p(o,e,i,u){const h=u[0]-i[0],p=u[1]-i[1],m=(o[0]-i[0])*p-h*(o[1]-i[1]),b=(e[0]-i[0])*p-h*(e[1]-i[1]);return m>0&&b<0||m<0&&b>0}function Kh(o,e,i,u){return(h=[u[0]-i[0],u[1]-i[1]])[0]*(p=[e[0]-o[0],e[1]-o[1]])[1]-h[1]*p[0]!=0&&!(!_p(o,e,i,u)||!_p(i,u,o,e));var h,p}function yp(o){const e=new Ct(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Ct(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of o[0])e.x>u.x&&(e.x=u.x),e.y>u.y&&(e.y=u.y),i.x<u.x&&(i.x=u.x),i.y<u.y&&(i.y=u.y);return{min:e,max:i}}const mu=8192;function Jg(o,e){const i=(180+o[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*mu),Math.round(u*h*mu)]}function Tm(o,e){for(let i=0;i<e.length;i++)if(oc(o,e[i]))return!0;return!1}function Qg(o,e,i){for(const u of i)for(let h=0,p=u.length,m=p-1;h<p;m=h++)if(Kh(o,e,u[m],u[h]))return!0;return!1}function _s(o,e){for(let i=0;i<o.length;++i)if(!oc(o[i],e))return!1;for(let i=0;i<o.length-1;++i)if(Qg(o[i],o[i+1],e))return!1;return!0}function eh(o,e){for(let i=0;i<e.length;i++)if(_s(o,e[i]))return!0;return!1}function sd(o,e,i){const u=[];for(let h=0;h<o.length;h++){const p=[];for(let m=0;m<o[h].length;m++){const b=Jg(o[h][m],i);Ml(e,b),p.push(b)}u.push(p)}return u}function Rl(o,e,i){const u=[];for(let h=0;h<o.length;h++){const p=sd(o[h],e,i);u.push(p)}return u}function vp(o,e,i,u){if(o[0]<i[0]||o[0]>i[2]){const h=.5*u;let p=o[0]-i[0]>h?-u:i[0]-o[0]>h?u:0;p===0&&(p=o[0]-i[2]>h?-u:i[2]-o[0]>h?u:0),o[0]+=p}Ml(e,o)}function xp(o,e,i,u){const h=Math.pow(2,u.z)*mu,p=[u.x*mu,u.y*mu],m=[];if(!o)return m;for(const b of o)for(const T of b){const A=[T.x+p[0],T.y+p[1]];vp(A,e,i,h),m.push(A)}return m}function th(o,e,i,u){const h=Math.pow(2,u.z)*mu,p=[u.x*mu,u.y*mu],m=[];if(!o)return m;for(const T of o){const A=[];for(const M of T){const O=[M.x+p[0],M.y+p[1]];Ml(e,O),A.push(O)}m.push(A)}if(e[2]-e[0]<=h/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of m)for(const A of T)vp(A,e,i,h)}var b;return m}class gu{constructor(e,i){this.type=Fn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Wr(e[1])){const u=e[1];if(u.type==="FeatureCollection")for(let h=0;h<u.features.length;++h){const p=u.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new gu(u,u.features[h].geometry)}else if(u.type==="Feature"){const h=u.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new gu(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new gu(u,u)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,u){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(u.type==="Polygon"){const b=sd(u.coordinates,p,m),T=xp(i.geometry(),h,p,m);if(!pu(h,p))return!1;for(const A of T)if(!oc(A,b))return!1}if(u.type==="MultiPolygon"){const b=Rl(u.coordinates,p,m),T=xp(i.geometry(),h,p,m);if(!pu(h,p))return!1;for(const A of T)if(!Tm(A,b))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,u){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(u.type==="Polygon"){const b=sd(u.coordinates,p,m),T=th(i.geometry(),h,p,m);if(!pu(h,p))return!1;for(const A of T)if(!_s(A,b))return!1}if(u.type==="MultiPolygon"){const b=Rl(u.coordinates,p,m),T=th(i.geometry(),h,p,m);if(!pu(h,p))return!1;for(const A of T)if(!eh(A,b))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Yh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ra=1/298.257223563,Jh=ra*(2-ra),ul=Math.PI/180;class _u{static fromTile(e,i,u){const h=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),p=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/ul;return new _u(p,u)}static get units(){return Yh}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Yh[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Yh).join(", ")}`);const u=6378.137*ul*(i?Yh[i]:1),h=Math.cos(e*ul),p=1/(1-Jh*(1-h*h)),m=Math.sqrt(p);this.kx=u*m*h,this.ky=u*m*p*(1-Jh)}distance(e,i){const u=Ho(e[0]-i[0])*this.kx,h=(e[1]-i[1])*this.ky;return Math.sqrt(u*u+h*h)}bearing(e,i){const u=Ho(i[0]-e[0])*this.kx;return Math.atan2(u,(i[1]-e[1])*this.ky)/ul}destination(e,i,u){const h=u*ul;return this.offset(e,Math.sin(h)*i,Math.cos(h)*i)}offset(e,i,u){return[e[0]+i/this.kx,e[1]+u/this.ky]}lineDistance(e){let i=0;for(let u=0;u<e.length-1;u++)i+=this.distance(e[u],e[u+1]);return i}area(e){let i=0;for(let u=0;u<e.length;u++){const h=e[u];for(let p=0,m=h.length,b=m-1;p<m;b=p++)i+=Ho(h[p][0]-h[b][0])*(h[p][1]+h[b][1])*(u?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let u=0;if(i<=0)return e[0];for(let h=0;h<e.length-1;h++){const p=e[h],m=e[h+1],b=this.distance(p,m);if(u+=b,u>i)return ac(p,m,(i-(u-b))/b)}return e[e.length-1]}pointToSegmentDistance(e,i,u){let[h,p]=i,m=Ho(u[0]-h)*this.kx,b=(u[1]-p)*this.ky;if(m!==0||b!==0){const T=(Ho(e[0]-h)*this.kx*m+(e[1]-p)*this.ky*b)/(m*m+b*b);T>1?(h=u[0],p=u[1]):T>0&&(h+=m/this.kx*T,p+=b/this.ky*T)}return m=Ho(e[0]-h)*this.kx,b=(e[1]-p)*this.ky,Math.sqrt(m*m+b*b)}pointOnLine(e,i){let u=1/0,h=e[0][0],p=e[0][1],m=0,b=0;for(let T=0;T<e.length-1;T++){let A=e[T][0],M=e[T][1],O=Ho(e[T+1][0]-A)*this.kx,D=(e[T+1][1]-M)*this.ky,N=0;O===0&&D===0||(N=(Ho(i[0]-A)*this.kx*O+(i[1]-M)*this.ky*D)/(O*O+D*D),N>1?(A=e[T+1][0],M=e[T+1][1]):N>0&&(A+=O/this.kx*N,M+=D/this.ky*N)),O=Ho(i[0]-A)*this.kx,D=(i[1]-M)*this.ky;const U=O*O+D*D;U<u&&(u=U,h=A,p=M,m=T,b=N)}return{point:[h,p],index:m,t:Math.max(0,Math.min(1,b))}}lineSlice(e,i,u){let h=this.pointOnLine(u,e),p=this.pointOnLine(u,i);if(h.index>p.index||h.index===p.index&&h.t>p.t){const A=h;h=p,p=A}const m=[h.point],b=h.index+1,T=p.index;!ld(u[b],m[0])&&b<=T&&m.push(u[b]);for(let A=b+1;A<=T;A++)m.push(u[A]);return ld(u[T],p.point)||m.push(p.point),m}lineSliceAlong(e,i,u){let h=0;const p=[];for(let m=0;m<u.length-1;m++){const b=u[m],T=u[m+1],A=this.distance(b,T);if(h+=A,h>e&&p.length===0&&p.push(ac(b,T,(e-(h-A))/A)),h>=i)return p.push(ac(b,T,(i-(h-A))/A)),p;h>e&&p.push(T)}return p}bufferPoint(e,i){const u=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-u,e[0]+h,e[1]+u]}bufferBBox(e,i){const u=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-u,e[2]+h,e[3]+u]}insideBBox(e,i){return Ho(e[0]-i[0])>=0&&Ho(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function ld(o,e){return o[0]===e[0]&&o[1]===e[1]}function ac(o,e,i){const u=Ho(e[0]-o[0]);return[o[0]+u*i,o[1]+(e[1]-o[1])*i]}function Ho(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class rh{constructor(e=[],i=((u,h)=>u<h?-1:u>h?1:0)){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:u}=this,h=i[e];for(;e>0;){const p=e-1>>1,m=i[p];if(u(h,m)>=0)break;i[e]=m,e=p}i[e]=h}_down(e){const{data:i,compare:u}=this,h=this.length>>1,p=i[e];for(;e<h;){let m=1+(e<<1);const b=m+1;if(b<this.length&&u(i[b],i[m])<0&&(m=b),u(i[m],p)>=0)break;i[e]=i[m],e=m}i[e]=p}}var $t=8192;function nh(o,e){return e.dist-o.dist}const Qh=100,ef=50;function ih(o){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==o.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==o[i])return!1;return!0}function yu(o){return o[1]-o[0]+1}function is(o,e){const i=o[1]>=o[0]&&o[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function tf(o,e){if(o[0]>o[1])return[null,null];const i=yu(o);if(e){if(i===2)return[o,null];const u=Math.floor(i/2);return[[o[0],o[0]+u],[o[0]+u,o[1]]]}{if(i===1)return[o,null];const u=Math.floor(i/2)-1;return[[o[0],o[0]+u],[o[0]+u+1,o[1]]]}}function Ia(o,e){const i=[1/0,1/0,-1/0,-1/0];if(!is(e,o.length))return i;for(let u=e[0];u<=e[1];++u)Ml(i,o[u]);return i}function sc(o){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<o.length;++i)for(let u=0;u<o[i].length;++u)Ml(e,o[i][u]);return e}function os(o,e,i){if(ih(o)||ih(e))return NaN;let u=0,h=0;return o[2]<e[0]&&(u=e[0]-o[2]),o[0]>e[2]&&(u=o[0]-e[2]),o[1]>e[3]&&(h=o[1]-e[3]),o[3]<e[1]&&(h=e[1]-o[3]),i.distance([0,0],[u,h])}function gn(o){return 360*o-180}function e_(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function lc(o,e){const i=Math.pow(2,e.z),u=(o.y/$t+e.y)/i;return[gn((o.x/$t+e.x)/i),e_(u)]}function t_(o,e){const i=[];for(let u=0;u<o.length;++u)i.push(lc(o[u],e));return i}function ud(o,e,i){const u=i.pointOnLine(e,o).point;return i.distance(o,u)}function bp(o,e,i,u,h){const p=i.slice(u[0],u[1]+1);let m=1/0;for(let b=e[0];b<=e[1];++b)if((m=Math.min(m,ud(o[b],p,h)))===0)return 0;return m}function un(o,e,i,u,h){const p=Math.min(h.pointToSegmentDistance(o,i,u),h.pointToSegmentDistance(e,i,u)),m=Math.min(h.pointToSegmentDistance(i,o,e),h.pointToSegmentDistance(u,o,e));return Math.min(p,m)}function wp(o,e,i,u,h){if(!is(e,o.length)||!is(u,i.length))return NaN;let p=1/0;for(let m=e[0];m<e[1];++m)for(let b=u[0];b<u[1];++b){if(Kh(o[m],o[m+1],i[b],i[b+1]))return 0;p=Math.min(p,un(o[m],o[m+1],i[b],i[b+1],h))}return p}function cd(o,e,i,u,h){if(!is(e,o.length)||!is(u,i.length))return NaN;let p=1/0;for(let m=e[0];m<=e[1];++m)for(let b=u[0];b<=u[1];++b)if((p=Math.min(p,h.distance(o[m],i[b])))===0)return p;return p}function rf(o,e,i){if(oc(o,e,!0))return 0;let u=1/0;for(const h of e){const p=h.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[p-1]&&(u=Math.min(u,i.pointToSegmentDistance(o,h[p-1],h[0])))===0||(u=Math.min(u,ud(o,h,i)))===0)return u}return u}function Em(o,e,i,u){if(!is(e,o.length))return NaN;for(let p=e[0];p<=e[1];++p)if(oc(o[p],i,!0))return 0;let h=1/0;for(let p=e[0];p<e[1];++p)for(const m of i)for(let b=0,T=m.length,A=T-1;b<T;A=b++){if(Kh(o[p],o[p+1],m[A],m[b]))return 0;h=Math.min(h,un(o[p],o[p+1],m[A],m[b],u))}return h}function hd(o,e){for(const i of o)for(let u=0;u<=i.length-1;++u)if(oc(i[u],e,!0))return!0;return!1}function nf(o,e,i,u=1/0){const h=sc(o),p=sc(e);if(u!==1/0&&os(h,p,i)>=u)return u;if(pu(h,p)){if(hd(o,e))return 0}else if(hd(e,o))return 0;let m=u;for(const b of o)for(let T=0,A=b.length,M=A-1;T<A;M=T++)for(const O of e)for(let D=0,N=O.length,U=N-1;D<N;U=D++){if(Kh(b[M],b[T],O[U],O[D]))return 0;m=Math.min(m,un(b[M],b[T],O[U],O[D],i))}return m}function uc(o,e,i,u,h,p,m){if(p===null||m===null)return;const b=os(Ia(u,p),Ia(h,m),i);b<e&&o.push({dist:b,range1:p,range2:m})}function oh(o,e,i,u,h=1/0){let p=Math.min(u.distance(o[0],i[0][0]),h);if(p===0)return p;const m=new rh([{dist:0,range1:[0,o.length-1],range2:[0,0]}],nh),b=e?ef:Qh,T=sc(i);for(;m.length;){const A=m.pop();if(A.dist>=p)continue;const M=A.range1;if(yu(M)<=b){if(!is(M,o.length))return NaN;if(e){const O=Em(o,M,i,u);if((p=Math.min(p,O))===0)return p}else for(let O=M[0];O<=M[1];++O){const D=rf(o[O],i,u);if((p=Math.min(p,D))===0)return p}}else{const O=tf(M,e);if(O[0]!==null){const D=os(Ia(o,O[0]),T,u);D<p&&m.push({dist:D,range1:O[0],range2:[0,0]})}if(O[1]!==null){const D=os(Ia(o,O[1]),T,u);D<p&&m.push({dist:D,range1:O[1],range2:[0,0]})}}}return p}function Sp(o,e,i,u,h,p=1/0){let m=Math.min(p,h.distance(o[0],i[0]));if(m===0)return m;const b=new rh([{dist:0,range1:[0,o.length-1],range2:[0,i.length-1]}],nh),T=e?ef:Qh,A=u?ef:Qh;for(;b.length;){const M=b.pop();if(M.dist>=m)continue;const O=M.range1,D=M.range2;if(yu(O)<=T&&yu(D)<=A){if(!is(O,o.length)||!is(D,i.length))return NaN;if(e&&u?m=Math.min(m,wp(o,O,i,D,h)):e||u?e&&!u?m=Math.min(m,bp(i,D,o,O,h)):!e&&u&&(m=Math.min(m,bp(o,O,i,D,h))):m=Math.min(m,cd(o,O,i,D,h)),m===0)return m}else{const N=tf(O,e),U=tf(D,u);uc(b,m,h,o,i,N[0],U[0]),uc(b,m,h,o,i,N[0],U[1]),uc(b,m,h,o,i,N[1],U[0]),uc(b,m,h,o,i,N[1],U[1])}}return m}function Tp(o,e,i,u,h=1/0){let p=h;const m=Ia(o,[0,o.length-1]);for(const b of i)if(!(p!==1/0&&os(m,Ia(b,[0,b.length-1]),u)>=p)&&(p=Math.min(p,Sp(o,e,b,!0,u,p)),p===0))return p;return p}function fd(o,e,i,u,h=1/0){let p=h;const m=Ia(o,[0,o.length-1]);for(const b of i){if(p!==1/0&&os(m,sc(b),u)>=p)continue;const T=oh(o,e,b,u,p);if(isNaN(T))return T;if((p=Math.min(p,T))===0)return p}return p}function dd(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class cl{constructor(e,i){this.type=yr,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Wr(e[1])){const u=e[1];if(u.type==="FeatureCollection"){for(let h=0;h<u.features.length;++h)if(dd(u.features[h].geometry.type))return new cl(u,u.features[h].geometry)}else if(u.type==="Feature"){if(dd(u.geometry.type))return new cl(u,u.geometry)}else if(dd(u.type))return new cl(u,u)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),u=e.canonicalID();if(i!=null&&u!=null){if(e.geometryType()==="Point")return(function(h,p,m){const b=[];for(const A of h)for(const M of A)b.push(lc(M,p));const T=new _u(b[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?Sp(b,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",T):m.type==="MultiLineString"?Tp(b,!1,m.coordinates,T):m.type==="Polygon"||m.type==="MultiPolygon"?fd(b,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,T):null})(i,u,this.geometries);if(e.geometryType()==="LineString")return(function(h,p,m){const b=[];for(const A of h){const M=[];for(const O of A)M.push(lc(O,p));b.push(M)}const T=new _u(b[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Tp(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",b,T);if(m.type==="MultiLineString"){let A=1/0;for(let M=0;M<m.coordinates.length;M++){const O=Tp(m.coordinates[M],!0,b,T,A);if(isNaN(O))return O;if((A=Math.min(A,O))===0)return A}return A}if(m.type==="Polygon"||m.type==="MultiPolygon"){let A=1/0;for(let M=0;M<b.length;M++){const O=fd(b[M],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,T,A);if(isNaN(O))return O;if((A=Math.min(A,O))===0)return A}return A}return null})(i,u,this.geometries);if(e.geometryType()==="Polygon")return(function(h,p,m){const b=[];for(const A of(function(M,O){const D=M.length;if(D<=1)return[M];const N=[];let U,H;for(let X=0;X<D;X++){const te=Yg(M[X]);te!==0&&(M[X].area=Math.abs(te),H===void 0&&(H=te<0),H===te<0?(U&&N.push(U),U=[M[X]]):U.push(M[X]))}return U&&N.push(U),N})(h)){const M=[];for(let O=0;O<A.length;++O)M.push(t_(A[O],p));b.push(M)}const T=new _u(b[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return fd(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",b,T);if(m.type==="MultiLineString"){let A=1/0;for(let M=0;M<m.coordinates.length;M++){const O=fd(m.coordinates[M],!0,b,T,A);if(isNaN(O))return O;if((A=Math.min(A,O))===0)return A}return A}return m.type==="Polygon"||m.type==="MultiPolygon"?(function(A,M,O){let D=1/0;for(const N of A)for(const U of M){const H=nf(N,U,O,D);if(isNaN(H))return H;if((D=Math.min(D,H))===0)return D}return D})(m.type==="Polygon"?[m.coordinates]:m.coordinates,b,T):null})(i,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function kl(o){if(o instanceof xo&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof gu||o instanceof cl)return!1;if(o instanceof lh)return o.featureConstant;let e=!0;return o.eachChild((i=>{e&&!kl(i)&&(e=!1)})),e}function ah(o){if(o instanceof xo&&o.name==="feature-state")return!1;let e=!0;return o.eachChild((i=>{e&&!ah(i)&&(e=!1)})),e}function sh(o){if(o instanceof lh)return new Set([o.key]);let e=new Set;return o.eachChild((i=>{e=new Set([...e,...sh(i)])})),e}function vu(o,e){if(o instanceof xo&&e.indexOf(o.name)>=0)return!1;let i=!0;return o.eachChild((u=>{i&&!vu(u,e)&&(i=!1)})),i}function pd(o,e,i){return[o,e,i].filter(Boolean).join("")}function Ep(o,e){switch(o){case"string":return Ua(e);case"number":return+e;case"boolean":return!!e;case"color":return wn.parse(e);case"formatted":return ca.fromString(Ua(e));case"resolvedImage":return Pa.build(Ua(e))}return e}function Ap(o,e,i,u){return u!==void 0&&(o=u*Math.round(o/u)),e!==void 0&&o<e&&(o=e),i!==void 0&&o>i&&(o=i),o}class lh{constructor(e,i,u,h=!1){this.type=e,this.key=i,this.scope=u,this.featureConstant=h}static parse(e,i){let u=i.expectedType;if(u==null&&(u=Nn),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const h=i.parse(e[1],1);if(!(h instanceof Ar))return i.error("Key name of 'config' expression must be a string literal.");let p,m=!0;const b=Ua(h.value);if(e.length>=3){const T=i.parse(e[2],2);if(!(T instanceof Ar))return i.error("Scope of 'config' expression must be a string literal.");p=Ua(T.value)}if(i.options){const T=pd(b,p,i._scope),A=i.options.get(T);A&&(m=kl(A.value||A.default))}return new lh(u,b,p,m)}evaluate(e){const i=pd(this.key,this.scope,e.scope),u=e.getConfig(i);if(!u)return null;const{type:h,value:p,values:m,minValue:b,maxValue:T,stepValue:A}=u,M=u.default.evaluate(e);let O=M;if(p){const D=e.scope;e.scope=(D||"").split("").slice(1).join(""),O=p.evaluate(e),e.scope=D}return h&&(O=Ep(h,O)),O===void 0||b===void 0&&T===void 0&&A===void 0||(typeof O=="number"?O=Ap(O,b,T,A):Array.isArray(O)&&(O=O.map((D=>typeof D=="number"?Ap(D,b,T,A):D)))),p!==void 0&&O!==void 0&&m&&!m.includes(O)&&(O=M,h&&(O=Ep(h,O))),(h&&h!==this.type||O!==void 0&&!nd(Qt(O),this.type))&&(O=Ep(this.type.kind,O)),O}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class md{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const u=e[1];return i.scope.has(u)?new md(u,i.scope.get(u)):i.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class uh{constructor(e,i=[],u,h=new gp,p=[],m,b){this.registry=e,this.path=i,this.key=i.map((T=>typeof T=="string"?`['${T}']`:`[${T}]`)).join(""),this.scope=h,this.errors=p,this.expectedType=u,this._scope=m,this.options=b}parse(e,i,u,h,p={}){return i||u?this.concat(i,null,u,h)._parse(e,p):this._parse(e,p)}parseObjectValue(e,i,u,h,p,m={}){return this.concat(i,u,h,p)._parse(e,m)}_parse(e,i){function u(h,p,m){return m==="assert"?new Sr(p,[h]):m==="coerce"?new gs(p,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,b=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||b.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(m,b))return null}else p=u(p,m,i.typeAnnotation||"coerce");else p=u(p,m,i.typeAnnotation||"assert")}if(!(p instanceof Ar)&&p.type.kind!=="resolvedImage"&&hl(p)){const m=new Zh(this._scope,this.options);try{p=new Ar(p.type,p.evaluate(m))}catch(b){return this.error(b.message),null}}return p}return gs.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,u,h){let p=typeof e=="number"?this.path.concat(e):this.path;p=typeof i=="string"?p.concat(i):p;const m=h?this.scope.concat(h):this.scope;return new uh(this.registry,p,u||null,m,this.errors,this._scope,this.options)}error(e,...i){const u=`${this.key}${i.map((h=>`[${h}]`)).join("")}`;this.errors.push(new Na(u,e))}checkSubtype(e,i){const u=fu(e,i);return u&&this.error(u),u}}function hl(o){if(o instanceof md)return hl(o.boundExpression);if(o instanceof xo&&o.name==="error"||o instanceof Va||o instanceof gu||o instanceof cl||o instanceof lh)return!1;const e=o instanceof gs||o instanceof Sr;let i=!0;return o.eachChild((u=>{i=e?i&&hl(u):i&&u instanceof Ar})),!!i&&kl(o)&&vu(o,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function of(o,e){const i=o.length-1;let u,h,p=0,m=i,b=0;for(;p<=m;)if(b=Math.floor((p+m)/2),u=o[b],h=o[b+1],u<=e){if(b===i||e<h)return b;p=b+1}else{if(!(u>e))throw new Yi("Input is not a number.");m=b-1}return 0}class fl{constructor(e,i,u){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,p]of u)this.labels.push(h),this.outputs.push(p)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const u=i.parse(e[1],1,yr);if(!u)return null;const h=[];let p=null;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let m=1;m<e.length;m+=2){const b=m===1?-1/0:e[m],T=e[m+1],A=m,M=m+1;if(typeof b!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(h.length&&h[h.length-1][0]>=b)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const O=i.parse(T,M,p);if(!O)return null;p=p||O.type,h.push([b,O])}return new fl(p,u,h)}evaluate(e){const i=this.labels,u=this.outputs;if(i.length===1)return u[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return u[0].evaluate(e);const p=i.length;return h>=i[p-1]?u[p-1].evaluate(e):u[of(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Rs=.95047,ch=1.08883,dl=4/29,xu=6/29,Am=3*xu*xu,Pp=xu*xu*xu,cc=Math.PI/180,hh=180/Math.PI;function bu(o){return o>Pp?Math.pow(o,1/3):o/Am+dl}function fh(o){return o>xu?o*o*o:Am*(o-dl)}function af(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function Dl(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function pl(o){const e=Dl(o.r),i=Dl(o.g),u=Dl(o.b),h=bu((.4124564*e+.3575761*i+.1804375*u)/Rs),p=bu((.2126729*e+.7151522*i+.072175*u)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-bu((.0193339*e+.119192*i+.9503041*u)/ch)),alpha:o.a}}function Ii(o){let e=(o.l+16)/116,i=isNaN(o.a)?e:e+o.a/500,u=isNaN(o.b)?e:e-o.b/200;return e=1*fh(e),i=Rs*fh(i),u=ch*fh(u),new wn(af(3.2404542*i-1.5371385*e-.4985314*u),af(-.969266*i+1.8760108*e+.041556*u),af(.0556434*i-.2040259*e+1.0572252*u),o.alpha)}function Vi(o,e,i){const u=e-o;return o+i*(u>180||u<-180?u-360*Math.round(u/360):u)}const as={forward:pl,reverse:Ii,interpolate:function(o,e,i){return{l:wr(o.l,e.l,i),a:wr(o.a,e.a,i),b:wr(o.b,e.b,i),alpha:wr(o.alpha,e.alpha,i)}}},Co={forward:function(o){const{l:e,a:i,b:u}=pl(o),h=Math.atan2(u,i)*hh;return{h:h<0?h+360:h,c:Math.sqrt(i*i+u*u),l:e,alpha:o.a}},reverse:function(o){const e=o.h*cc,i=o.c;return Ii({l:o.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:o.alpha})},interpolate:function(o,e,i){return{h:Vi(o.h,e.h,i),c:wr(o.c,e.c,i),l:wr(o.l,e.l,i),alpha:wr(o.alpha,e.alpha,i)}}};var na=Object.freeze({__proto__:null,hcl:Co,lab:as});class wo{constructor(e,i,u,h,p){this.type=e,this.operator=i,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(const[m,b]of p)this.labels.push(m),this.outputs.push(b)}static interpolationFactor(e,i,u,h){let p=0;if(e.name==="exponential")p=wu(i,e.base,u,h);else if(e.name==="linear")p=wu(i,1,u,h);else if(e.name==="cubic-bezier"){const m=e.controlPoints;p=new Wu(m[0],m[1],m[2],m[3]).solve(wu(i,1,u,h))}return p}static parse(e,i){let[u,h,p,...m]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const A=h[1];if(typeof A!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:A}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const A=h.slice(1);if(A.length!==4||A.some((M=>typeof M!="number"||M<0||M>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,yr),!p)return null;const b=[];let T=null;u==="interpolate-hcl"||u==="interpolate-lab"?T=ja:i.expectedType&&i.expectedType.kind!=="value"&&(T=i.expectedType);for(let A=0;A<m.length;A+=2){const M=m[A],O=m[A+1],D=A+3,N=A+4;if(typeof M!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(b.length&&b[b.length-1][0]>=M)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const U=i.parse(O,N,T);if(!U)return null;T=T||U.type,b.push([M,U])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new wo(T,u,h,p,b):i.error(`Type ${no(T)} is not interpolatable.`)}evaluate(e){const i=this.labels,u=this.outputs;if(i.length===1)return u[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return u[0].evaluate(e);const p=i.length;if(h>=i[p-1])return u[p-1].evaluate(e);const m=of(i,h),b=wo.interpolationFactor(this.interpolation,h,i[m],i[m+1]),T=u[m].evaluate(e),A=u[m+1].evaluate(e);return this.operator==="interpolate"?Al[this.type.kind.toLowerCase()](T,A,b):this.operator==="interpolate-hcl"?Co.reverse(Co.interpolate(Co.forward(T),Co.forward(A),b)):as.reverse(as.interpolate(as.forward(T),as.forward(A),b))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let u=0;u<this.labels.length;u++)i.push(this.labels[u],this.outputs[u].serialize());return i}}function wu(o,e,i,u){const h=u-i,p=o-i;return h===0?0:e===1?p/h:(Math.pow(e,p)-1)/(Math.pow(e,h)-1)}class ia{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let u=null;const h=i.expectedType;h&&h.kind!=="value"&&(u=h);const p=[];for(const b of e.slice(1)){const T=i.parse(b,1+p.length,u,void 0,{typeAnnotation:"omit"});if(!T)return null;u=u||T.type,p.push(T)}const m=h&&p.some((b=>fu(h,b.type)));return new ia(m?Nn:u,p)}evaluate(e){let i,u=null,h=0;for(const p of this.args){if(h++,u=p.evaluate(e),u&&u instanceof Pa&&!u.available&&(i||(i=u),u=null,h===this.args.length))return i;if(u!==null)break}return u}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class Su{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const u=[];for(let p=1;p<e.length-1;p+=2){const m=e[p];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const b=i.parse(e[p+1],p+1);if(!b)return null;u.push([m,b])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,u);return h?new Su(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,u]of this.bindings)e.push(i,u.serialize());return e.push(this.result.serialize()),e}}class sf{constructor(e,i,u){this.type=e,this.index=i,this.input=u}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=i.parse(e[1],1,yr),h=i.parse(e[2],2,ta(i.expectedType||Nn));return u&&h?new sf(h.type.itemType,u,h):null}evaluate(e){const i=this.index.evaluate(e),u=this.input.evaluate(e);if(i<0)throw new Yi(`Array index out of bounds: ${i} < 0.`);if(i>=u.length)throw new Yi(`Array index out of bounds: ${i} > ${u.length-1}.`);if(i!==Math.floor(i))throw new Yi(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return u[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class gd{constructor(e,i,u){this.type=e,this.index=i,this.input=u}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=i.parse(e[1],1,yr),h=i.parse(e[2],2,ta(i.expectedType||Nn));return u&&h?new gd(h.type.itemType,u,h):null}evaluate(e){const i=this.index.evaluate(e),u=this.input.evaluate(e);if(i<0)throw new Yi(`Array index out of bounds: ${i} < 0.`);if(i>u.length-1)throw new Yi(`Array index out of bounds: ${i} > ${u.length-1}.`);if(i===Math.floor(i))return u[i];const h=Math.floor(i),p=Math.ceil(i),m=u[h],b=u[p];if(typeof m!="number"||typeof b!="number")throw new Yi(`Cannot interpolate between non-number values at index ${i}.`);const T=i-h;return m*(1-T)+b*T}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class dh{constructor(e,i){this.type=Fn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=i.parse(e[1],1,Nn),h=i.parse(e[2],2,Nn);return u&&h?du(u.type,[Fn,Dn,yr,Kc,Nn])?new dh(u,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${no(u.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(u==null)return!1;if(!Wh(i,["boolean","string","number","null"]))throw new Yi(`Expected first argument to be of type boolean, string, number or null, but found ${no(Qt(i))} instead.`);if(!Wh(u,["string","array"]))throw new Yi(`Expected second argument to be of type array or string, but found ${no(Qt(u))} instead.`);return u.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class lf{constructor(e,i,u){this.type=yr,this.needle=e,this.haystack=i,this.fromIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=i.parse(e[1],1,Nn),h=i.parse(e[2],2,Nn);if(!u||!h)return null;if(!du(u.type,[Fn,Dn,yr,Kc,Nn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${no(u.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,yr);return p?new lf(u,h,p):null}return new lf(u,h)}evaluate(e){const i=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!Wh(i,["boolean","string","number","null"]))throw new Yi(`Expected first argument to be of type boolean, string, number or null, but found ${no(Qt(i))} instead.`);if(!Wh(u,["string","array"]))throw new Yi(`Expected second argument to be of type array or string, but found ${no(Qt(u))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return u.indexOf(i,h)}return u.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ys{constructor(e,i,u,h,p,m){this.inputType=e,this.type=i,this.input=u,this.cases=h,this.outputs=p,this.otherwise=m}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let u,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const p={},m=[];for(let A=2;A<e.length-1;A+=2){let M=e[A];const O=e[A+1];Array.isArray(M)||(M=[M]);const D=i.concat(A);if(M.length===0)return D.error("Expected at least one branch label.");for(const U of M){if(typeof U!="number"&&typeof U!="string")return D.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return D.error("Numeric branch labels must be integer values.");if(u){if(D.checkSubtype(u,Qt(U)))return null}else u=Qt(U);if(p[String(U)]!==void 0)return D.error("Branch labels must be unique.");p[String(U)]=m.length}const N=i.parse(O,A,h);if(!N)return null;h=h||N.type,m.push(N)}const b=i.parse(e[1],1,Nn);if(!b)return null;const T=i.parse(e[e.length-1],e.length-1,h);return T?b.type.kind!=="value"&&i.concat(1).checkSubtype(u,b.type)?null:new ys(u,h,b,p,m,T):null}evaluate(e){const i=this.input.evaluate(e);return(nd(Qt(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),u=[],h={};for(const m of i){const b=h[this.cases[m]];b===void 0?(h[this.cases[m]]=u.length,u.push([this.cases[m],[m]])):u[b][1].push(m)}const p=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,b]of u)e.push(b.length===1?p(b[0]):b.map(p)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class hc{constructor(e,i,u){this.type=e,this.branches=i,this.otherwise=u}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const h=[];for(let m=1;m<e.length-1;m+=2){const b=i.parse(e[m],m,Fn);if(!b)return null;const T=i.parse(e[m+1],m+1,u);if(!T)return null;h.push([b,T]),u=u||T.type}const p=i.parse(e[e.length-1],e.length-1,u);return p?new hc(u,h,p):null}evaluate(e){for(const[i,u]of this.branches)if(i.evaluate(e))return u.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,u]of this.branches)e(i),e(u);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class zl{constructor(e,i,u,h){this.type=e,this.input=i,this.beginIndex=u,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=i.parse(e[1],1,Nn),h=i.parse(e[2],2,yr);if(!u||!h)return null;if(!du(u.type,[ta(Nn),Dn,Nn]))return i.error(`Expected first argument to be of type array or string, but found ${no(u.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,yr);return p?new zl(u.type,u,h,p):null}return new zl(u.type,u,h)}evaluate(e){const i=this.input.evaluate(e),u=this.beginIndex.evaluate(e);if(!Wh(i,["string","array"]))throw new Yi(`Expected first argument to be of type array or string, but found ${no(Qt(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(u,h)}return i.slice(u)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class _d{constructor(e,i){this.type=ta(Dn),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=i.parse(e[1],1,Dn),h=i.parse(e[2],2,Dn);return u&&h?new _d(u,h):void 0}evaluate(e){const i=this.str.evaluate(e),u=this.delimiter.evaluate(e);return i.split(u)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Ip(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ll(o,e,i,u){return u.compare(e,i)===0}function ks(o,e,i){const u=o!=="=="&&o!=="!=";return class cj{constructor(p,m,b){this.type=Fn,this.lhs=p,this.rhs=m,this.collator=b,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const b=p[0];let T=m.parse(p[1],1,Nn);if(!T)return null;if(!Ip(b,T.type))return m.concat(1).error(`"${b}" comparisons are not supported for type '${no(T.type)}'.`);let A=m.parse(p[2],2,Nn);if(!A)return null;if(!Ip(b,A.type))return m.concat(2).error(`"${b}" comparisons are not supported for type '${no(A.type)}'.`);if(T.type.kind!==A.type.kind&&T.type.kind!=="value"&&A.type.kind!=="value")return m.error(`Cannot compare types '${no(T.type)}' and '${no(A.type)}'.`);u&&(T.type.kind==="value"&&A.type.kind!=="value"?T=new Sr(A.type,[T]):T.type.kind!=="value"&&A.type.kind==="value"&&(A=new Sr(T.type,[A])));let M=null;if(p.length===4){if(T.type.kind!=="string"&&A.type.kind!=="string"&&T.type.kind!=="value"&&A.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(M=m.parse(p[3],3,rd),!M)return null}return new cj(T,A,M)}evaluate(p){const m=this.lhs.evaluate(p),b=this.rhs.evaluate(p);if(u&&this.hasUntypedArgument){const T=Qt(m),A=Qt(b);if(T.kind!==A.kind||T.kind!=="string"&&T.kind!=="number")throw new Yi(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${T.kind}, ${A.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const T=Qt(m),A=Qt(b);if(T.kind!=="string"||A.kind!=="string")return e(p,m,b)}return this.collator?i(p,m,b,this.collator.evaluate(p)):e(p,m,b)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[o];return this.eachChild((m=>{p.push(m.serialize())})),p}}}const fc=ks("==",(function(o,e,i){return e===i}),Ll),uf=ks("!=",(function(o,e,i){return e!==i}),(function(o,e,i,u){return!Ll(0,e,i,u)})),yd=ks("<",(function(o,e,i){return e<i}),(function(o,e,i,u){return u.compare(e,i)<0})),vs=ks(">",(function(o,e,i){return e>i}),(function(o,e,i,u){return u.compare(e,i)>0})),xs=ks("<=",(function(o,e,i){return e<=i}),(function(o,e,i,u){return u.compare(e,i)<=0})),ml=ks(">=",(function(o,e,i){return e>=i}),(function(o,e,i,u){return u.compare(e,i)>=0}));class Ds{constructor(e,i,u,h,p,m){this.type=Dn,this.number=e,this.locale=i,this.currency=u,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const u=i.parse(e[1],1,yr);if(!u)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=i.parseObjectValue(h.locale,2,"locale",Dn),!p))return null;let m=null;if(h.currency&&(m=i.parseObjectValue(h.currency,2,"currency",Dn),!m))return null;let b=null;if(h.unit&&(b=i.parseObjectValue(h.unit,2,"unit",Dn),!b))return null;let T=null;if(h["min-fraction-digits"]&&(T=i.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",yr),!T))return null;let A=null;return h["max-fraction-digits"]&&(A=i.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",yr),!A)?null:new Ds(u,p,m,b,T,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class zs{constructor(e){this.type=yr,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const u=i.parse(e[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${no(u.type)} instead.`):new zs(u):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Yi(`Expected value to be of type string or array, but found ${no(Qt(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((i=>{e.push(i.serialize())})),e}}function Tu(o){return function(){o=1831565813+(o|=0)|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const dc={"==":fc,"!=":uf,">":vs,"<":yd,">=":ml,"<=":xs,array:Sr,at:sf,"at-interpolated":gd,boolean:Sr,case:hc,coalesce:ia,collator:Va,format:rc,image:nc,in:dh,"index-of":lf,interpolate:wo,"interpolate-hcl":wo,"interpolate-lab":wo,length:zs,let:Su,literal:Ar,match:ys,number:Sr,"number-format":Ds,object:Sr,slice:zl,step:fl,string:Sr,"to-boolean":gs,"to-color":gs,"to-number":gs,"to-string":gs,var:md,within:gu,distance:cl,config:lh,split:_d};function cf(o,[e,i,u,h]){e=e.evaluate(o),i=i.evaluate(o),u=u.evaluate(o);const p=h?h.evaluate(o):1,m=tc(e,i,u,p);if(m)throw new Yi(m);return new wn(e/255,i/255,u/255,p)}function vd(o,[e,i,u,h]){e=e.evaluate(o),i=i.evaluate(o),u=u.evaluate(o);const p=h?h.evaluate(o):1,m=(function(A,M,O,D){return typeof A=="number"&&A>=0&&A<=360?typeof M=="number"&&M>=0&&M<=100&&typeof O=="number"&&O>=0&&O<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[A,M,O,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[A,M,O,D]:[A,M,O]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[A,M,O,D]:[A,M,O]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,u,p);if(m)throw new Yi(m);const b=`hsla(${e}, ${i}%, ${u}%, ${p})`,T=wn.parse(b);if(!T)throw new Yi(`Failed to parse HSLA color: ${b}`);return T}function $a(o,e){return o in e}function fa(o,e){const i=e[o];return i===void 0?null:i}function Ci(o){return{type:o}}function ss(o){return{result:"success",value:o}}function Fl(o){return{result:"error",value:o}}function Bl(o,e){return!!o&&!!o.parameters&&o.parameters.indexOf(e)>-1}function ph(o){return o["property-type"]==="data-driven"}function xd(o){return Bl(o.expression,"measure-light")}function Cp(o){return Bl(o.expression,"zoom")}function pc(o){return!!o.expression&&o.expression.interpolated}function hf(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function mc(o){return o}function ff(o,e){const i=e.type==="color",u=o.stops&&typeof o.stops[0][0]=="object",h=u||!(u||o.property!==void 0),p=o.type||(pc(e)?"exponential":"interval");if(i&&((o=ll({},o)).stops&&(o.stops=o.stops.map((A=>[A[0],wn.parse(A[1])]))),o.default=wn.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!na[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let m,b,T;if(p==="exponential")m=Mp;else if(p==="interval")m=df;else if(p==="categorical"){m=_c,b=Object.create(null);for(const A of o.stops)b[A[0]]=A[1];T=typeof o.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=Nl}if(u){const A={},M=[];for(let N=0;N<o.stops.length;N++){const U=o.stops[N],H=U[0].zoom;A[H]===void 0&&(A[H]={zoom:H,type:o.type,property:o.property,default:o.default,stops:[]},M.push(H)),A[H].stops.push([U[0].value,U[1]])}const O=[];for(const N of M)O.push([A[N].zoom,ff(A[N],e)]);const D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:wo.interpolationFactor.bind(void 0,D),zoomStops:O.map((N=>N[0])),evaluate:({zoom:N},U)=>Mp({stops:O,base:o.base},e,N).evaluate(N,U)}}if(h){const A=p==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:wo.interpolationFactor.bind(void 0,A),zoomStops:o.stops.map((M=>M[0])),evaluate:({zoom:M})=>m(o,e,M,b,T)}}return{kind:"source",evaluate(A,M){const O=M&&M.properties?M.properties[o.property]:void 0;return O===void 0?gc(o.default,e.default):m(o,e,O,b,T)}}}function gc(o,e,i){return o!==void 0?o:e!==void 0?e:i!==void 0?i:void 0}function _c(o,e,i,u,h){return gc(typeof i===h?u[i]:void 0,o.default,e.default)}function df(o,e,i){if(Cl(i)!=="number")return gc(o.default,e.default);const u=o.stops.length;if(u===1||i<=o.stops[0][0])return o.stops[0][1];if(i>=o.stops[u-1][0])return o.stops[u-1][1];const h=of(o.stops.map((p=>p[0])),i);return o.stops[h][1]}function Mp(o,e,i){const u=o.base!==void 0?o.base:1;if(Cl(i)!=="number")return gc(o.default,e.default);const h=o.stops.length;if(h===1||i<=o.stops[0][0])return o.stops[0][1];if(i>=o.stops[h-1][0])return o.stops[h-1][1];const p=of(o.stops.map((M=>M[0])),i),m=(function(M,O,D,N){const U=N-D,H=M-D;return U===0?0:O===1?H/U:(Math.pow(O,H)-1)/(Math.pow(O,U)-1)})(i,u,o.stops[p][0],o.stops[p+1][0]),b=o.stops[p][1],T=o.stops[p+1][1];let A=Al[e.type]||mc;if(o.colorSpace&&o.colorSpace!=="rgb"){const M=na[o.colorSpace];A=(O,D)=>M.reverse(M.interpolate(M.forward(O),M.forward(D),m))}return typeof b.evaluate=="function"?{evaluate(...M){const O=b.evaluate.apply(void 0,M),D=T.evaluate.apply(void 0,M);if(O!==void 0&&D!==void 0)return A(O,D,m)}}:A(b,T,m)}function Nl(o,e,i){return e.type==="color"?i=wn.parse(i):e.type==="formatted"?i=ca.fromString(i.toString()):e.type==="resolvedImage"?i=Pa.build(i.toString()):Cl(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),gc(i,o.default,e.default)}xo.register(dc,{error:[{kind:"error"},[Dn],(o,[e])=>{throw new Yi(e.evaluate(o))}],typeof:[Dn,[Nn],(o,[e])=>no(Qt(e.evaluate(o)))],"to-rgba":[ta(yr,4),[ja],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[ta(yr,4),[ja],(o,[e])=>e.evaluate(o).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ja,[yr,yr,yr],cf],rgba:[ja,[yr,yr,yr,yr],cf],hsl:[ja,[yr,yr,yr],vd],hsla:[ja,[yr,yr,yr,yr],vd],has:{type:Fn,overloads:[[[Dn],(o,[e])=>$a(e.evaluate(o),o.properties())],[[Dn,Pl],(o,[e,i])=>$a(e.evaluate(o),i.evaluate(o))]]},get:{type:Nn,overloads:[[[Dn],(o,[e])=>fa(e.evaluate(o),o.properties())],[[Dn,Pl],(o,[e,i])=>fa(e.evaluate(o),i.evaluate(o))]]},"feature-state":[Nn,[Dn],(o,[e])=>fa(e.evaluate(o),o.featureState||{})],properties:[Pl,[],o=>o.properties()],"geometry-type":[Dn,[],o=>o.geometryType()],worldview:[Dn,[],o=>o.globals.worldview||""],id:[Nn,[],o=>o.id()],zoom:[yr,[],o=>o.globals.zoom],pitch:[yr,[],o=>o.globals.pitch||0],"distance-from-center":[yr,[],o=>o.distanceFromCenter()],"measure-light":[yr,[Dn],(o,[e])=>o.measureLight(e.evaluate(o))],"heatmap-density":[yr,[],o=>o.globals.heatmapDensity||0],"line-progress":[yr,[],o=>o.globals.lineProgress||0],"raster-value":[yr,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[yr,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[yr,[],o=>o.globals.skyRadialProgress||0],accumulated:[Nn,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[yr,Ci(yr),(o,e)=>{let i=0;for(const u of e)i+=u.evaluate(o);return i}],"*":[yr,Ci(yr),(o,e)=>{let i=1;for(const u of e)i*=u.evaluate(o);return i}],"-":{type:yr,overloads:[[[yr,yr],(o,[e,i])=>e.evaluate(o)-i.evaluate(o)],[[yr],(o,[e])=>-e.evaluate(o)]]},"/":[yr,[yr,yr],(o,[e,i])=>e.evaluate(o)/i.evaluate(o)],"%":[yr,[yr,yr],(o,[e,i])=>e.evaluate(o)%i.evaluate(o)],ln2:[yr,[],()=>Math.LN2],pi:[yr,[],()=>Math.PI],e:[yr,[],()=>Math.E],"^":[yr,[yr,yr],(o,[e,i])=>Math.pow(e.evaluate(o),i.evaluate(o))],sqrt:[yr,[yr],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[yr,[yr],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[yr,[yr],(o,[e])=>Math.log(e.evaluate(o))],log2:[yr,[yr],(o,[e])=>Math.log(e.evaluate(o))/Math.LN2],sin:[yr,[yr],(o,[e])=>Math.sin(e.evaluate(o))],cos:[yr,[yr],(o,[e])=>Math.cos(e.evaluate(o))],tan:[yr,[yr],(o,[e])=>Math.tan(e.evaluate(o))],asin:[yr,[yr],(o,[e])=>Math.asin(e.evaluate(o))],acos:[yr,[yr],(o,[e])=>Math.acos(e.evaluate(o))],atan:[yr,[yr],(o,[e])=>Math.atan(e.evaluate(o))],min:[yr,Ci(yr),(o,e)=>Math.min(...e.map((i=>i.evaluate(o))))],max:[yr,Ci(yr),(o,e)=>Math.max(...e.map((i=>i.evaluate(o))))],abs:[yr,[yr],(o,[e])=>Math.abs(e.evaluate(o))],round:[yr,[yr],(o,[e])=>{const i=e.evaluate(o);return i<0?-Math.round(-i):Math.round(i)}],floor:[yr,[yr],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[yr,[yr],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[Fn,[Dn,Nn],(o,[e,i])=>o.properties()[e.value]===i.value],"filter-id-==":[Fn,[Nn],(o,[e])=>o.id()===e.value],"filter-type-==":[Fn,[Dn],(o,[e])=>o.geometryType()===e.value],"filter-<":[Fn,[Dn,Nn],(o,[e,i])=>{const u=o.properties()[e.value],h=i.value;return typeof u==typeof h&&u<h}],"filter-id-<":[Fn,[Nn],(o,[e])=>{const i=o.id(),u=e.value;return typeof i==typeof u&&i<u}],"filter->":[Fn,[Dn,Nn],(o,[e,i])=>{const u=o.properties()[e.value],h=i.value;return typeof u==typeof h&&u>h}],"filter-id->":[Fn,[Nn],(o,[e])=>{const i=o.id(),u=e.value;return typeof i==typeof u&&i>u}],"filter-<=":[Fn,[Dn,Nn],(o,[e,i])=>{const u=o.properties()[e.value],h=i.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[Fn,[Nn],(o,[e])=>{const i=o.id(),u=e.value;return typeof i==typeof u&&i<=u}],"filter->=":[Fn,[Dn,Nn],(o,[e,i])=>{const u=o.properties()[e.value],h=i.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[Fn,[Nn],(o,[e])=>{const i=o.id(),u=e.value;return typeof i==typeof u&&i>=u}],"filter-has":[Fn,[Nn],(o,[e])=>e.value in o.properties()],"filter-has-id":[Fn,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Fn,[ta(Dn)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[Fn,[ta(Nn)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[Fn,[Dn,ta(Nn)],(o,[e,i])=>i.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[Fn,[Dn,ta(Nn)],(o,[e,i])=>(function(u,h,p,m){for(;p<=m;){const b=p+m>>1;if(h[b]===u)return!0;h[b]>u?m=b-1:p=b+1}return!1})(o.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Fn,overloads:[[[Fn,Fn],(o,[e,i])=>e.evaluate(o)&&i.evaluate(o)],[Ci(Fn),(o,e)=>{for(const i of e)if(!i.evaluate(o))return!1;return!0}]]},any:{type:Fn,overloads:[[[Fn,Fn],(o,[e,i])=>e.evaluate(o)||i.evaluate(o)],[Ci(Fn),(o,e)=>{for(const i of e)if(i.evaluate(o))return!0;return!1}]]},"!":[Fn,[Fn],(o,[e])=>!e.evaluate(o)],"is-supported-script":[Fn,[Dn],(o,[e])=>{const i=o.globals&&o.globals.isSupportedScript;return!i||i(e.evaluate(o))}],upcase:[Dn,[Dn],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[Dn,[Dn],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[Dn,Ci(Nn),(o,e)=>e.map((i=>Ua(i.evaluate(o)))).join("")],"resolved-locale":[Dn,[rd],(o,[e])=>e.evaluate(o).resolvedLocale()],random:[yr,[yr,yr,Nn],(o,e)=>{const[i,u,h]=e.map((m=>m.evaluate(o)));if(i>u||i===u)return i;let p;if(typeof h=="string")p=(function(m){let b=0;if(m.length===0)return b;for(let T=0;T<m.length;T++)b=(b<<5)-b+m.charCodeAt(T),b|=0;return b})(h);else{if(typeof h!="number")throw new Yi(`Invalid seed input: ${h}`);p=h}return i+Tu(p)()*(u-i)}]});class Eu{constructor(e,i,u,h){this.expression=e,this._warningHistory={},this._evaluator=new Zh(u,h),this._defaultValue=i?(function(p){return p.type==="color"&&(hf(p.default)||Array.isArray(p.default))?new wn(0,0,0,0):p.type==="color"?wn.parse(p.default)||null:p.default===void 0?null:p.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=sh(e)}evaluateWithoutErrorHandling(e,i,u,h,p,m,b,T){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,u,h,p,m,b,T){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Yi(`Expected value to be one of ${Object.keys(this._enumValues).map((M=>JSON.stringify(M))).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${A.message}`)),this._defaultValue}}}function bd(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in dc}function gl(o,e,i,u){const h=new uh(dc,[],e?(function(m){const b={color:ja,string:Dn,number:yr,enum:Dn,boolean:Fn,formatted:Yc,resolvedImage:Hh};return m.type==="array"?ta(b[m.value]||Nn,m.length):b[m.type]})(e):void 0,void 0,void 0,i,u),p=h.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?ss(new Eu(p,e,i,u)):Fl(h.errors)}class yc{constructor(e,i,u,h){this.kind=e,this._styleExpression=i,this.isLightConstant=u,this.isLineProgressConstant=h,this.isStateDependent=e!=="constant"&&!ah(i.expression),this.configDependencies=sh(i.expression)}evaluateWithoutErrorHandling(e,i,u,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,u,h,p,m)}evaluate(e,i,u,h,p,m){return this._styleExpression.evaluate(e,i,u,h,p,m)}}class ls{constructor(e,i,u,h,p,m){this.kind=e,this.zoomStops=u,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!ah(i.expression),this.isLightConstant=p,this.isLineProgressConstant=m,this.configDependencies=sh(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,u,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,u,h,p,m)}evaluate(e,i,u,h,p,m){return this._styleExpression.evaluate(e,i,u,h,p,m)}interpolationFactor(e,i,u){return this.interpolationType?wo.interpolationFactor(this.interpolationType,e,i,u):0}}function pf(o,e,i,u){if((o=gl(o,e,i,u)).result==="error")return o;const h=o.value.expression,p=kl(h);if(!p&&!ph(e))return Fl([new Na("","data expressions not supported")]);const m=vu(h,["zoom","pitch","distance-from-center"]);if(!m&&!Cp(e))return Fl([new Na("","zoom expressions not supported")]);const b=vu(h,["measure-light"]);if(!b&&!xd(e))return Fl([new Na("","measure-light expression not supported")]);const T=vu(h,["line-progress"]);if(!T&&!(function(O){return Bl(O.expression,"line-progress")})(e))return Fl([new Na("","line-progress expression not supported")]);const A=e.expression&&e.expression.relaxZoomRestriction,M=vc(h);return M||m||A?M instanceof Na?Fl([M]):M instanceof wo&&!pc(e)?Fl([new Na("",'"interpolate" expressions cannot be used with this property')]):ss(M?new ls(p&&T?"camera":"composite",o.value,M.labels,M instanceof wo?M.interpolation:void 0,b,T):new yc(p&&T?"constant":"source",o.value,b,T)):Fl([new Na("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class jl{constructor(e,i){this._parameters=e,this._specification=i,ll(this,ff(this._parameters,this._specification))}static deserialize(e){return new jl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function vc(o){let e=null;if(o instanceof Su)e=vc(o.result);else if(o instanceof ia){for(const i of o.args)if(e=vc(i),e)break}else(o instanceof fl||o instanceof wo)&&o.input instanceof xo&&o.input.name==="zoom"&&(e=o);return e instanceof Na||o.eachChild((i=>{const u=vc(i);u instanceof Na?e=u:e&&u&&e!==u&&(e=new Na("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var mf,xc,qa=(function(){if(xc)return mf;xc=1,mf=e;var o=3;function e(i,u,h){var p=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var m=new Int32Array(this.arrayBuffer);i=m[0],this.d=(u=m[1])+2*(h=m[2]);for(var b=0;b<this.d*this.d;b++){var T=m[o+b],A=m[o+b+1];p.push(T===A?null:m.subarray(T,A))}var M=m[o+p.length+1];this.keys=m.subarray(m[o+p.length],M),this.bboxes=m.subarray(M),this.insert=this._insertReadonly}else{this.d=u+2*h;for(var O=0;O<this.d*this.d;O++)p.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=i,this.padding=h,this.scale=u/i,this.uid=0;var D=h/u*i;this.min=-D,this.max=i+D}return e.prototype.insert=function(i,u,h,p,m){this._forEachCell(u,h,p,m,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(m)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,u,h,p,m,b){this.cells[m].push(b)},e.prototype.query=function(i,u,h,p,m){var b=this.min,T=this.max;if(i<=b&&u<=b&&T<=h&&T<=p&&!m)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(i,u,h,p,this._queryCell,A,{},m),A},e.prototype._queryCell=function(i,u,h,p,m,b,T,A){var M=this.cells[m];if(M!==null)for(var O=this.keys,D=this.bboxes,N=0;N<M.length;N++){var U=M[N];if(T[U]===void 0){var H=4*U;(A?A(D[H+0],D[H+1],D[H+2],D[H+3]):i<=D[H+2]&&u<=D[H+3]&&h>=D[H+0]&&p>=D[H+1])?(T[U]=!0,b.push(O[U])):T[U]=!1}}},e.prototype._forEachCell=function(i,u,h,p,m,b,T,A){for(var M=this._convertToCellCoord(i),O=this._convertToCellCoord(u),D=this._convertToCellCoord(h),N=this._convertToCellCoord(p),U=M;U<=D;U++)for(var H=O;H<=N;H++){var X=this.d*H+U;if((!A||A(this._convertFromCellCoord(U),this._convertFromCellCoord(H),this._convertFromCellCoord(U+1),this._convertFromCellCoord(H+1)))&&m.call(this,i,u,h,p,X,b,T,A))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,u=o+this.cells.length+1+1,h=0,p=0;p<this.cells.length;p++)h+=this.cells[p].length;var m=new Int32Array(u+h+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var b=u,T=0;T<i.length;T++){var A=i[T];m[o+T]=b,m.set(A,b),b+=A.length}return m[o+i.length]=b,m.set(this.keys,b),m[o+i.length+1]=b+=this.keys.length,m.set(this.bboxes,b),b+=this.bboxes.length,m.buffer},mf})(),Ga=nl(qa);const bc={};function nr(o,e,i={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writable:!1}),bc[e]={klass:o,omit:i.omit||[]}}nr(Object,"Object"),Ga.serialize=function(o,e){const i=o.toArrayBuffer();return e&&e.add(i),{buffer:i}},Ga.deserialize=function(o){return new Ga(o.buffer)},Object.defineProperty(Ga,"name",{value:"Grid"}),nr(Ga,"Grid"),delete Ct.prototype.constructor,typeof DOMMatrix<"u"&&nr(DOMMatrix,"DOMMatrix"),nr(wn,"Color"),nr(Error,"Error"),nr(ca,"Formatted"),nr(id,"FormattedSection"),nr(bn,"AJAXError"),nr(Pa,"ResolvedImage"),nr(jl,"StylePropertyFunction"),nr(Eu,"StyleExpression",{omit:["_evaluator"]}),nr(ea,"ImageId"),nr(Il,"ImageVariant"),nr(ls,"ZoomDependentExpression"),nr(yc,"ZoomConstantExpression"),nr(xo,"CompoundExpression",{omit:["_evaluate"]});for(const o in dc)bc[dc[o]._classRegistryKey]||nr(dc[o],`Expression${o}`);function bs(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function ws(o){return self.ImageBitmap&&o instanceof ImageBitmap}function Ls(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(bs(o)||ws(o))return e&&e.add(o),o;if(ArrayBuffer.isView(o))return e&&e.add(o.buffer),o;if(o instanceof ImageData)return e&&e.add(o.data.buffer),o;if(Array.isArray(o)){const i=[];for(const u of o)i.push(Ls(u,e));return i}if(o instanceof Map){const i={$name:"Map",entries:[]};for(const[u,h]of o.entries())i.entries.push(Ls(u),Ls(h,e));return i}if(o instanceof Set){const i={$name:"Set"};let u=0;for(const h of o.values())i[++u]=Ls(h);return i}if(o instanceof DOMMatrix){const i={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of u)i[h]=o[h];return i}if(typeof o=="bigint")return{$name:"BigInt",value:o.toString()};if(typeof o=="object"){const i=o.constructor,u=i._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const h=i.serialize?i.serialize(o,e):{};if(!i.serialize){for(const p in o)o.hasOwnProperty(p)&&(bc[u].omit.indexOf(p)>=0||(h[p]=Ls(o[p],e)));o instanceof Error&&(h.message=o.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof o)}function da(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||bs(o)||ws(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(da);if(typeof o=="object"){const e=o.$name||"Object";if(e==="Map"){const h=o.entries||[],p=new Map;for(let m=0;m<h.length;m+=2)p.set(da(h[m]),da(h[m+1]));return p}if(e==="Set"){const h=new Set;for(const p of Object.keys(o))p!=="$name"&&h.add(da(o[p]));return h}if(e==="DOMMatrix"){let h;return h=o.is2D?[o.a,o.b,o.c,o.d,o.e,o.f]:[o.m11,o.m12,o.m13,o.m14,o.m21,o.m22,o.m23,o.m24,o.m31,o.m32,o.m33,o.m34,o.m41,o.m42,o.m43,o.m44],new DOMMatrix(h)}if(e==="BigInt")return BigInt(o.value);const{klass:i}=bc[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(o);const u=Object.create(i.prototype);for(const h of Object.keys(o))h!=="$name"&&(u[h]=da(o[h]));return u}throw new Error("can't deserialize object of type "+typeof o)}const br={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,Osage:o=>o>=66736&&o<=66815,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function _l(o){for(const e of o)if(wc(e.charCodeAt(0)))return!0;return!1}function wd(o){for(const e of o)if(!Pm(e.charCodeAt(0)))return!1;return!0}function Pm(o){return!(br.Arabic(o)||br["Arabic Supplement"](o)||br["Arabic Extended-A"](o)||br["Arabic Presentation Forms-A"](o)||br["Arabic Presentation Forms-B"](o))}function wc(o){return!(o!==746&&o!==747&&(o<4352||!(br["Bopomofo Extended"](o)||br.Bopomofo(o)||br["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||br["CJK Compatibility Ideographs"](o)||br["CJK Compatibility"](o)||br["CJK Radicals Supplement"](o)||br["CJK Strokes"](o)||!(!br["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||br["CJK Unified Ideographs Extension A"](o)||br["CJK Unified Ideographs"](o)||br["Enclosed CJK Letters and Months"](o)||br["Hangul Compatibility Jamo"](o)||br["Hangul Jamo Extended-A"](o)||br["Hangul Jamo Extended-B"](o)||br["Hangul Jamo"](o)||br["Hangul Syllables"](o)||br.Hiragana(o)||br["Ideographic Description Characters"](o)||br.Kanbun(o)||br["Kangxi Radicals"](o)||br["Katakana Phonetic Extensions"](o)||br.Katakana(o)&&o!==12540||!(!br["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!br["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||br["Unified Canadian Aboriginal Syllabics"](o)||br["Unified Canadian Aboriginal Syllabics Extended"](o)||br["Vertical Forms"](o)||br["Yijing Hexagram Symbols"](o)||br["Yi Syllables"](o)||br["Yi Radicals"](o))))}function gf(o){return!(wc(o)||(function(e){return!!(br["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||br["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||br["Letterlike Symbols"](e)||br["Number Forms"](e)||br["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||br["Control Pictures"](e)&&e!==9251||br["Optical Character Recognition"](e)||br["Enclosed Alphanumerics"](e)||br["Geometric Shapes"](e)||br["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||br["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||br["CJK Symbols and Punctuation"](e)||br.Katakana(e)||br["Private Use Area"](e)||br["CJK Compatibility Forms"](e)||br["Small Form Variants"](e)||br["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(o))}function mh(o){return br.Arabic(o)||br["Arabic Supplement"](o)||br["Arabic Extended-A"](o)||br["Arabic Presentation Forms-A"](o)||br["Arabic Presentation Forms-B"](o)}function us(o){return o>=1424&&o<=2303||br["Arabic Presentation Forms-A"](o)||br["Arabic Presentation Forms-B"](o)}function _f(o,e){return!(!e&&us(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||br.Khmer(o))}function yf(o){for(const e of o)if(us(e.charCodeAt(0)))return!0;return!1}const Mo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let vf=null,So=Mo.unavailable,Ul=null;const Sd=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(So=Mo.error),vf&&vf(o)};function Ji(){gh.fire(new al("pluginStateChange",{pluginStatus:So,pluginURL:Ul}))}const gh=new hu,xf=function(){return So},Td=function(){if(So!==Mo.deferred||!Ul)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");So=Mo.loading,Ji(),Ul&&Vh({url:Ul},(o=>{o?Sd(o):(So=Mo.loaded,Ji())}))},cs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>So===Mo.loaded||cs.applyArabicShaping!=null,isLoading:()=>So===Mo.loading,setState(o){So=o.pluginStatus,Ul=o.pluginURL},isParsing:()=>So===Mo.parsing,isParsed:()=>So===Mo.parsed,getPluginURL:()=>Ul};class Un{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,u){for(const h of i)if(!_f(h.charCodeAt(0),u))return!1;return!0})(e,cs.isLoaded())}}class Fs{constructor(e,i,u,h){this.property=e,this.value=i,this.expression=(function(p,m,b,T){if(hf(p))return new jl(p,m);if(bd(p)||Array.isArray(p)&&p.length>0){const A=pf(p,m,b,T);if(A.result==="error")throw new Error(A.value.map((M=>`${M.key}: ${M.message}`)).join(", "));return A.value}{let A=p;return typeof p=="string"&&m.type==="color"&&(A=wn.parse(p)),{kind:"constant",configDependencies:new Set,evaluate:()=>A}}})(i===void 0?e.specification.default:i,e.specification,u,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,u){return this.property.possiblyEvaluate(this,e,i,u)}}class Hi{constructor(e,i,u){this.property=e,this.value=new Fs(e,void 0,i,u)}transitioned(e,i){return new No(this.property,this.value,i,Qe({},e.transition,this.transition),e.now)}untransitioned(){return new No(this.property,this.value,null,{},0)}}class ao{constructor(e,i,u){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=u,this.configDependencies=new Set}getValue(e){return Jr(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Hi(this._values[e].property,this._scope,this._options)),this._values[e].value=new Fs(this._values[e].property,i===null?void 0:Jr(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const u=this._properties.properties;if(e)for(const h in e){const p=e[h];if(h.endsWith("-transition")){const m=h.slice(0,-11);u[m]&&this.setTransition(m,p)}else u.hasOwnProperty(h)&&this.setValue(h,p)}}getTransition(e){return Jr(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Hi(this._values[e].property)),this._values[e].transition=Jr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const u=this.getValue(i);u!==void 0&&(e[i]=u);const h=this.getTransition(i);h!==void 0&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const u=new bf(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(e,i._values[h]);return u}untransitioned(){const e=new bf(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class No{constructor(e,i,u,h,p){const m=h.delay||0,b=h.duration||0;p=p||0,this.property=e,this.value=i,this.begin=p+m,this.end=this.begin+b,e.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(e,i,u){const h=e.now||0,p=this.value.possiblyEvaluate(e,i,u),m=this.prior;if(m){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return m.possiblyEvaluate(e,i,u);{const b=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,i,u),p,oe(b))}}return p}}class bf{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,u){const h=new Ns(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,i,u);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ss{constructor(e,i,u){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=u,this.configDependencies=new Set}getValue(e){return Jr(this._values[e].value)}setValue(e,i){this._values[e]=new Fs(this._values[e].property,i===null?void 0:Jr(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const u=this.getValue(i);u!==void 0&&(e[i]=u)}return e}possiblyEvaluate(e,i,u){const h=new Ns(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,i,u);return h}}class Bs{constructor(e,i,u){this.property=e,this.value=i,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,u,h){return this.property.evaluate(this.value,this.parameters,e,i,u,h)}}class Ns{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class St{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,u){const h=Al[this.specification.type];return h?h(e,i,u):e}}class Jt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,u,h){return new Bs(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},u,h)}:e.expression,i)}interpolate(e,i,u){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Bs(this,{kind:"constant",value:void 0},e.parameters);const h=Al[this.specification.type];return h?new Bs(this,{kind:"constant",value:h(e.value.value,i.value.value,u)},e.parameters):e}evaluate(e,i,u,h,p,m){return e.kind==="constant"?e.value:e.evaluate(i,u,h,p,m)}}class Au{constructor(e){this.specification=e}possiblyEvaluate(e,i,u,h){return!!e.expression.evaluate(i,null,{},u,h)}interpolate(){return!1}}class Ei{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Un(0,{});for(const u in e){const h=e[u];h.specification.overridable&&this.overridableProperties.push(u);const p=this.defaultPropertyValues[u]=new Fs(h,void 0),m=this.defaultTransitionablePropertyValues[u]=new Hi(h);this.defaultTransitioningPropertyValues[u]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=p.possiblyEvaluate(i)}}}nr(Jt,"DataDrivenProperty"),nr(St,"DataConstantProperty"),nr(Au,"ColorRampProperty");var Ve=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"expression"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function hs(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Vl(o){if(Array.isArray(o))return o.map(Vl);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const i in o)e[i]=Vl(o[i]);return e}return hs(o)}function Sc(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!Sc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Pu(o,e="",i=null,u="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Sc(o)||(o=Sf(o));const h=o;let p=!0;try{p=(function(M){if(!Tc(M))return M;let O=Vl(M);return wf(O),O=Ed(O),O})(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let m=null,b=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){b=Ve[`filter_${u}`];const M=gl(p,b,e,i);if(M.result==="error")throw new Error(M.value.map((O=>`${O.key}: ${O.message}`)).join(", "));m=(O,D,N)=>M.value.evaluate(O,D,{},N)}let T=null,A=null;if(p!==h){const M=gl(h,b,e,i);if(M.result==="error")throw new Error(M.value.map((O=>`${O.key}: ${O.message}`)).join(", "));T=(O,D,N,U,H)=>M.value.evaluate(O,D,{},N,void 0,void 0,U,H),A=!kl(M.value.expression)}return{filter:m,dynamicFilter:T||void 0,needGeometry:Ad(p),needFeature:!!A}}function Ed(o){if(!Array.isArray(o))return o;const e=(function(i){if(js.has(i[0])){for(let u=1;u<i.length;u++)if(Tc(i[u]))return!0}return i})(o);return e===!0?e:e.map((i=>Ed(i)))}function wf(o){let e=!1;const i=[];if(o[0]==="case"){for(let u=1;u<o.length-1;u+=2)e=e||Tc(o[u]),i.push(o[u+1]);i.push(o[o.length-1])}else if(o[0]==="match"){e=e||Tc(o[1]);for(let u=2;u<o.length-1;u+=2)i.push(o[u+1]);i.push(o[o.length-1])}else if(o[0]==="step"){e=e||Tc(o[1]);for(let u=1;u<o.length-1;u+=2)i.push(o[u+1])}e&&(o.length=0,o.push("any",...i));for(let u=1;u<o.length;u++)wf(o[u])}function Tc(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<o.length;i++)if(Tc(o[i]))return!0;return!1}const js=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Im(o,e){return o<e?-1:o>e?1:0}function Ad(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let e=1;e<o.length;e++)if(Ad(o[e]))return!0;return!1}function Sf(o){if(!o)return!0;const e=o[0];return o.length<=1?e!=="any":e==="=="?Pd(o[1],o[2],"=="):e==="!="?Ec(Pd(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Pd(o[1],o[2],e):e==="any"?(i=o.slice(1),["any"].concat(i.map(Sf))):e==="all"?["all"].concat(o.slice(1).map(Sf)):e==="none"?["all"].concat(o.slice(1).map(Sf).map(Ec)):e==="in"?_h(o[1],o.slice(2)):e==="!in"?Ec(_h(o[1],o.slice(2))):e==="has"?Op(o[1]):e!=="!has"||Ec(Op(o[1]));var i}function Pd(o,e,i){switch(o){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,o,e]}}function _h(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",o,["literal",e.sort(Im)]]:["filter-in-small",o,["literal",e]]}}function Op(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Ec(o){return["!",o]}const Iu="";function Ac(o,e){return e?`${o}${Iu}${e}`:o}const Id="-transition",Cm=new Set(["fill","line","background","hillshade","raster"]);class Wo extends hu{constructor(e,i,u,h,p){if(super(),this.id=e.id,this.fqid=Ac(this.id,u),this.type=e.type,this.scope=u,this.lut=h,this.options=p,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const m=gl(this.filter,Ve[`filter_${e.type}`]);m.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...m.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new Ss(i.layout,this.scope,p),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new ao(i.paint,this.scope,p);for(const m in e.paint)this.setPaintProperty(m,e.paint[m]);for(const m in e.layout)this.setLayoutProperty(m,e.layout[m]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ns(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Cm.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const u=this._unevaluatedLayout;u._properties.properties[e]&&(u.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Id)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const u=this._transitionablePaint,h=u._properties.properties;if(e.endsWith(Id)){const O=e.slice(0,-11);return h[O]&&u.setTransition(O,i||void 0),!1}if(!h[e])return!1;const p=u._values[e],m=p.value.isDataDriven(),b=p.value;u.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const T=u._values[e].value,A=T.isDataDriven(),M=e.endsWith("pattern")||e==="line-dasharray";return A||m||M||this._handleOverridablePaintPropertyUpdate(e,b,T)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,u){return null}_handleOverridablePaintPropertyUpdate(e,i,u){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return ln({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Bs&&ph(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Pu(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,u,h,p,m,b,T,A){}}const Mm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class yh{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ni{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function mn(o,e=1){let i=0,u=0;return{members:o.map((h=>{const p=Mm[h.type].BYTES_PER_ELEMENT,m=i=Cd(i,Math.max(e,p)),b=h.components||1;return u=Math.max(u,p),i+=p*b,{name:h.name,type:h.type,components:b,offset:m}})),size:Cd(i,Math.max(u,e)),alignment:e}}function Cd(o,e){return Math.ceil(o/e)*e}class pa extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const u=this.length;return this.resize(u+1),this.emplace(u,e,i)}emplace(e,i,u){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=u,e}}pa.prototype.bytesPerElement=4,nr(pa,"StructArrayLayout2i4");class vh extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,u)}emplace(e,i,u,h){const p=3*e;return this.int16[p+0]=i,this.int16[p+1]=u,this.int16[p+2]=h,e}}vh.prototype.bytesPerElement=6,nr(vh,"StructArrayLayout3i6");class Pc extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,u,h)}emplace(e,i,u,h,p){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=u,this.int16[m+2]=h,this.int16[m+3]=p,e}}Pc.prototype.bytesPerElement=8,nr(Pc,"StructArrayLayout4i8");class Ic extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Ic.prototype.bytesPerElement=4,nr(Ic,"StructArrayLayout1f4");class Rp extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,u)}emplace(e,i,u,h){const p=4*e,m=2*e;return this.int16[p+0]=i,this.int16[p+1]=u,this.float32[m+1]=h,e}}Rp.prototype.bytesPerElement=8,nr(Rp,"StructArrayLayout2i1f8");class Md extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,u)}emplace(e,i,u,h){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=u,this.int16[p+2]=h,e}}Md.prototype.bytesPerElement=8,nr(Md,"StructArrayLayout3i8");class Tf extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,u,h,p)}emplace(e,i,u,h,p,m){const b=5*e;return this.int16[b+0]=i,this.int16[b+1]=u,this.int16[b+2]=h,this.int16[b+3]=p,this.int16[b+4]=m,e}}Tf.prototype.bytesPerElement=10,nr(Tf,"StructArrayLayout5i10");class Ef extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,u,h,p,m,b)}emplace(e,i,u,h,p,m,b,T){const A=6*e,M=12*e,O=3*e;return this.int16[A+0]=i,this.int16[A+1]=u,this.uint8[M+4]=h,this.uint8[M+5]=p,this.uint8[M+6]=m,this.uint8[M+7]=b,this.float32[O+2]=T,e}}Ef.prototype.bytesPerElement=12,nr(Ef,"StructArrayLayout2i4ub1f12");class ma extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,u)}emplace(e,i,u,h){const p=3*e;return this.float32[p+0]=i,this.float32[p+1]=u,this.float32[p+2]=h,e}}ma.prototype.bytesPerElement=12,nr(ma,"StructArrayLayout3f12");class Cu extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,u,h,p)}emplace(e,i,u,h,p,m){const b=6*e,T=3*e;return this.uint16[b+0]=i,this.uint16[b+1]=u,this.uint16[b+2]=h,this.uint16[b+3]=p,this.float32[T+2]=m,e}}Cu.prototype.bytesPerElement=12,nr(Cu,"StructArrayLayout4ui1f12");class xh extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,u,h)}emplace(e,i,u,h,p){const m=4*e;return this.uint16[m+0]=i,this.uint16[m+1]=u,this.uint16[m+2]=h,this.uint16[m+3]=p,e}}xh.prototype.bytesPerElement=8,nr(xh,"StructArrayLayout4ui8");class Od extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,u,h,p,m)}emplace(e,i,u,h,p,m,b){const T=6*e;return this.int16[T+0]=i,this.int16[T+1]=u,this.int16[T+2]=h,this.int16[T+3]=p,this.int16[T+4]=m,this.int16[T+5]=b,e}}Od.prototype.bytesPerElement=12,nr(Od,"StructArrayLayout6i12");class Ha extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m,b,T,A,M,O,D){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,u,h,p,m,b,T,A,M,O,D)}emplace(e,i,u,h,p,m,b,T,A,M,O,D,N){const U=12*e;return this.int16[U+0]=i,this.int16[U+1]=u,this.int16[U+2]=h,this.int16[U+3]=p,this.uint16[U+4]=m,this.uint16[U+5]=b,this.uint16[U+6]=T,this.uint16[U+7]=A,this.int16[U+8]=M,this.int16[U+9]=O,this.int16[U+10]=D,this.int16[U+11]=N,e}}Ha.prototype.bytesPerElement=24,nr(Ha,"StructArrayLayout4i4ui4i24");class Mu extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,u,h,p,m)}emplace(e,i,u,h,p,m,b){const T=10*e,A=5*e;return this.int16[T+0]=i,this.int16[T+1]=u,this.int16[T+2]=h,this.float32[A+2]=p,this.float32[A+3]=m,this.float32[A+4]=b,e}}Mu.prototype.bytesPerElement=20,nr(Mu,"StructArrayLayout3i3f20");class Us extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,u,h)}emplace(e,i,u,h,p){const m=4*e;return this.float32[m+0]=i,this.float32[m+1]=u,this.float32[m+2]=h,this.float32[m+3]=p,e}}Us.prototype.bytesPerElement=16,nr(Us,"StructArrayLayout4f16");class Rd extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Rd.prototype.bytesPerElement=4,nr(Rd,"StructArrayLayout1ul4");class Vs extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const u=this.length;return this.resize(u+1),this.emplace(u,e,i)}emplace(e,i,u){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=u,e}}Vs.prototype.bytesPerElement=4,nr(Vs,"StructArrayLayout2ui4");class kd extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m,b,T,A,M,O,D,N){const U=this.length;return this.resize(U+1),this.emplace(U,e,i,u,h,p,m,b,T,A,M,O,D,N)}emplace(e,i,u,h,p,m,b,T,A,M,O,D,N,U){const H=20*e,X=10*e;return this.int16[H+0]=i,this.int16[H+1]=u,this.int16[H+2]=h,this.int16[H+3]=p,this.int16[H+4]=m,this.float32[X+3]=b,this.float32[X+4]=T,this.float32[X+5]=A,this.float32[X+6]=M,this.int16[H+14]=O,this.uint32[X+8]=D,this.uint16[H+18]=N,this.uint16[H+19]=U,e}}kd.prototype.bytesPerElement=40,nr(kd,"StructArrayLayout5i4f1i1ul2ui40");class bh extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,u,h,p,m,b)}emplace(e,i,u,h,p,m,b,T){const A=8*e;return this.int16[A+0]=i,this.int16[A+1]=u,this.int16[A+2]=h,this.int16[A+4]=p,this.int16[A+5]=m,this.int16[A+6]=b,this.int16[A+7]=T,e}}bh.prototype.bytesPerElement=16,nr(bh,"StructArrayLayout3i2i2i16");class $s extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,u,h,p)}emplace(e,i,u,h,p,m){const b=4*e,T=8*e;return this.float32[b+0]=i,this.float32[b+1]=u,this.float32[b+2]=h,this.int16[T+6]=p,this.int16[T+7]=m,e}}$s.prototype.bytesPerElement=16,nr($s,"StructArrayLayout2f1f2i16");class Ou extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,u,h,p,m)}emplace(e,i,u,h,p,m,b){const T=20*e,A=5*e;return this.uint8[T+0]=i,this.uint8[T+1]=u,this.float32[A+1]=h,this.float32[A+2]=p,this.float32[A+3]=m,this.float32[A+4]=b,e}}Ou.prototype.bytesPerElement=20,nr(Ou,"StructArrayLayout2ub4f20");class ai extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,u)}emplace(e,i,u,h){const p=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=u,this.uint16[p+2]=h,e}}ai.prototype.bytesPerElement=6,nr(ai,"StructArrayLayout3ui6");class wh extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m,b,T,A,M,O,D,N,U,H,X,te,ue,le,fe,De){const Ie=this.length;return this.resize(Ie+1),this.emplace(Ie,e,i,u,h,p,m,b,T,A,M,O,D,N,U,H,X,te,ue,le,fe,De)}emplace(e,i,u,h,p,m,b,T,A,M,O,D,N,U,H,X,te,ue,le,fe,De,Ie){const Ce=30*e,Be=15*e,je=60*e;return this.int16[Ce+0]=i,this.int16[Ce+1]=u,this.int16[Ce+2]=h,this.float32[Be+2]=p,this.float32[Be+3]=m,this.uint16[Ce+8]=b,this.uint16[Ce+9]=T,this.uint32[Be+5]=A,this.uint32[Be+6]=M,this.uint32[Be+7]=O,this.uint16[Ce+16]=D,this.uint16[Ce+17]=N,this.uint16[Ce+18]=U,this.float32[Be+10]=H,this.float32[Be+11]=X,this.uint8[je+48]=te,this.uint8[je+49]=ue,this.uint8[je+50]=le,this.uint32[Be+13]=fe,this.int16[Ce+28]=De,this.uint8[je+58]=Ie,e}}wh.prototype.bytesPerElement=60,nr(wh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Dd extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m,b,T,A,M,O,D,N,U,H,X,te,ue,le,fe,De,Ie,Ce,Be,je,st,Ge,ft,jt,_t,Mt,Ft,ot){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,e,i,u,h,p,m,b,T,A,M,O,D,N,U,H,X,te,ue,le,fe,De,Ie,Ce,Be,je,st,Ge,ft,jt,_t,Mt,Ft,ot)}emplace(e,i,u,h,p,m,b,T,A,M,O,D,N,U,H,X,te,ue,le,fe,De,Ie,Ce,Be,je,st,Ge,ft,jt,_t,Mt,Ft,ot,Ot){const Xe=20*e,at=40*e,Ut=80*e;return this.float32[Xe+0]=i,this.float32[Xe+1]=u,this.int16[at+4]=h,this.int16[at+5]=p,this.int16[at+6]=m,this.int16[at+7]=b,this.int16[at+8]=T,this.int16[at+9]=A,this.int16[at+10]=M,this.int16[at+11]=O,this.int16[at+12]=D,this.uint16[at+13]=N,this.uint16[at+14]=U,this.uint16[at+15]=H,this.uint16[at+16]=X,this.uint16[at+17]=te,this.uint16[at+18]=ue,this.uint16[at+19]=le,this.uint16[at+20]=fe,this.uint16[at+21]=De,this.uint16[at+22]=Ie,this.uint16[at+23]=Ce,this.uint16[at+24]=Be,this.uint16[at+25]=je,this.uint16[at+26]=st,this.uint16[at+27]=Ge,this.uint32[Xe+14]=ft,this.float32[Xe+15]=jt,this.float32[Xe+16]=_t,this.float32[Xe+17]=Mt,this.float32[Xe+18]=Ft,this.uint8[Ut+76]=ot,this.uint16[at+39]=Ot,e}}Dd.prototype.bytesPerElement=80,nr(Dd,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class zd extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,u,h,p,m)}emplace(e,i,u,h,p,m,b){const T=6*e;return this.float32[T+0]=i,this.float32[T+1]=u,this.float32[T+2]=h,this.float32[T+3]=p,this.float32[T+4]=m,this.float32[T+5]=b,e}}zd.prototype.bytesPerElement=24,nr(zd,"StructArrayLayout6f24");class Ru extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,u,h,p)}emplace(e,i,u,h,p,m){const b=5*e;return this.float32[b+0]=i,this.float32[b+1]=u,this.float32[b+2]=h,this.float32[b+3]=p,this.float32[b+4]=m,e}}Ru.prototype.bytesPerElement=20,nr(Ru,"StructArrayLayout5f20");class Ld extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,u,h,p,m,b)}emplace(e,i,u,h,p,m,b,T){const A=7*e;return this.float32[A+0]=i,this.float32[A+1]=u,this.float32[A+2]=h,this.float32[A+3]=p,this.float32[A+4]=m,this.float32[A+5]=b,this.float32[A+6]=T,e}}Ld.prototype.bytesPerElement=28,nr(Ld,"StructArrayLayout7f28");class Sh extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m,b,T,A,M,O){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,u,h,p,m,b,T,A,M,O)}emplace(e,i,u,h,p,m,b,T,A,M,O,D){const N=11*e;return this.float32[N+0]=i,this.float32[N+1]=u,this.float32[N+2]=h,this.float32[N+3]=p,this.float32[N+4]=m,this.float32[N+5]=b,this.float32[N+6]=T,this.float32[N+7]=A,this.float32[N+8]=M,this.float32[N+9]=O,this.float32[N+10]=D,e}}Sh.prototype.bytesPerElement=44,nr(Sh,"StructArrayLayout11f44");class kp extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m,b,T,A){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,u,h,p,m,b,T,A)}emplace(e,i,u,h,p,m,b,T,A,M){const O=9*e;return this.float32[O+0]=i,this.float32[O+1]=u,this.float32[O+2]=h,this.float32[O+3]=p,this.float32[O+4]=m,this.float32[O+5]=b,this.float32[O+6]=T,this.float32[O+7]=A,this.float32[O+8]=M,e}}kp.prototype.bytesPerElement=36,nr(kp,"StructArrayLayout9f36");class To extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const u=this.length;return this.resize(u+1),this.emplace(u,e,i)}emplace(e,i,u){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=u,e}}To.prototype.bytesPerElement=8,nr(To,"StructArrayLayout2f8");class oa extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,u,h)}emplace(e,i,u,h,p){const m=6*e;return this.uint32[3*e+0]=i,this.uint16[m+2]=u,this.uint16[m+3]=h,this.uint16[m+4]=p,e}}oa.prototype.bytesPerElement=12,nr(oa,"StructArrayLayout1ul3ui12");class Fd extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Fd.prototype.bytesPerElement=2,nr(Fd,"StructArrayLayout1ui2");class Af extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m,b,T,A,M,O,D,N,U,H,X){const te=this.length;return this.resize(te+1),this.emplace(te,e,i,u,h,p,m,b,T,A,M,O,D,N,U,H,X)}emplace(e,i,u,h,p,m,b,T,A,M,O,D,N,U,H,X,te){const ue=16*e;return this.float32[ue+0]=i,this.float32[ue+1]=u,this.float32[ue+2]=h,this.float32[ue+3]=p,this.float32[ue+4]=m,this.float32[ue+5]=b,this.float32[ue+6]=T,this.float32[ue+7]=A,this.float32[ue+8]=M,this.float32[ue+9]=O,this.float32[ue+10]=D,this.float32[ue+11]=N,this.float32[ue+12]=U,this.float32[ue+13]=H,this.float32[ue+14]=X,this.float32[ue+15]=te,e}}Af.prototype.bytesPerElement=64,nr(Af,"StructArrayLayout16f64");class Cc extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,u,h,p,m,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,u,h,p,m,b)}emplace(e,i,u,h,p,m,b,T){const A=10*e,M=5*e;return this.uint16[A+0]=i,this.uint16[A+1]=u,this.uint16[A+2]=h,this.uint16[A+3]=p,this.float32[M+2]=m,this.float32[M+3]=b,this.float32[M+4]=T,e}}Cc.prototype.bytesPerElement=20,nr(Cc,"StructArrayLayout4ui3f20");class Bd extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Bd.prototype.bytesPerElement=2,nr(Bd,"StructArrayLayout1i2");class Pf extends ni{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Pf.prototype.bytesPerElement=1,nr(Pf,"StructArrayLayout1ub1");class If extends yh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}If.prototype.size=40;class Dp extends kd{get(e){return new If(this,e)}}nr(Dp,"CollisionBoxArray");class Th extends yh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Th.prototype.size=60;class Eh extends wh{get(e){return new Th(this,e)}}nr(Eh,"PlacedSymbolArray");class Nd extends yh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Nd.prototype.size=80;class jd extends Dd{get(e){return new Nd(this,e)}}nr(jd,"SymbolInstanceArray");class Cf extends Ic{getoffsetX(e){return this.float32[1*e+0]}}nr(Cf,"GlyphOffsetArray");class zp extends pa{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}nr(zp,"SymbolLineVertexArray");class Ah extends yh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ah.prototype.size=12;class Mf extends oa{get(e){return new Ah(this,e)}}nr(Mf,"FeatureIndexArray");class Om extends Vs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}nr(Om,"FillExtrusionCentroidArray");class Lp extends yh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Lp.prototype.size=6;class Ud extends vh{get(e){return new Lp(this,e)}}nr(Ud,"FillExtrusionWallArray");const Fp=mn([{name:"a_pos",components:2,type:"Int16"}],4),Vd=mn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),$l=mn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class wi{constructor(e=[]){this.segments=e}_prepareSegment(e,i,u,h){let p=this.segments[this.segments.length-1];return e>wi.MAX_VERTEX_ARRAY_LENGTH&&hn(`Max vertices per segment is ${wi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>wi.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:i,primitiveOffset:u,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}prepareSegment(e,i,u,h){return this._prepareSegment(e,i.length,u.length,h)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,u,h){return new wi([{vertexOffset:e,primitiveOffset:i,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}function Bp(o,e){return 256*(o=ve(Math.floor(o),0,255))+ve(Math.floor(e),0,255)}wi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,nr(wi,"SegmentVector");const Np=mn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),$d=mn([{name:"a_pattern_b",components:4,type:"Uint16"}]),Rm=mn([{name:"a_dash",components:4,type:"Uint16"}]);class ql{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,u,h){this.ids.push(Oo(e)),this.positions.push(i,u,h)}eachPosition(e,i){const u=Oo(e);let h=0,p=this.ids.length-1;for(;h<p;){const m=h+p>>1;this.ids[m]>=u?p=m:h=m+1}for(;this.ids[h]===u;)i(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,i){const u=new Float64Array(e.ids),h=new Uint32Array(e.positions);return jp(u,h,0,u.length-1),i&&(i.add(u.buffer),i.add(h.buffer)),{ids:u,positions:h}}static deserialize(e){const i=new ql;let u;i.ids=e.ids,i.positions=e.positions;for(const h of i.ids)h!==u&&i.uniqueIds.push(h),u=h;return i.indexed=!0,i}}function Oo(o){const e=+o;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:cu(String(o))}function jp(o,e,i,u){for(;i<u;){const h=o[i+u>>1];let p=i-1,m=u+1;for(;;){do p++;while(o[p]<h);do m--;while(o[m]>h);if(p>=m)break;qd(o,p,m),qd(e,3*p,3*m),qd(e,3*p+1,3*m+1),qd(e,3*p+2,3*m+2)}m-i<u-m?(jp(o,e,i,m),i=m+1):(jp(o,e,m+1,u),u=m)}}function qd(o,e,i){const u=o[e];o[e]=o[i],o[i]=u}nr(ql,"FeaturePositionMap");class Ca{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class jo extends Ca{constructor(e){super(e),this.current=0}set(e,i,u){this.fetchUniformLocation(e,i)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class $i extends Ca{constructor(e){super(e),this.current=0}set(e,i,u){this.fetchUniformLocation(e,i)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Nr extends Ca{constructor(e){super(e),this.current=[0,0]}set(e,i,u){this.fetchUniformLocation(e,i)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class qs extends Ca{constructor(e){super(e),this.current=[0,0,0]}set(e,i,u){this.fetchUniformLocation(e,i)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class Mc extends Ca{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,u){this.fetchUniformLocation(e,i)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class Gd extends Ca{constructor(e){super(e),this.current=wn.transparent.toPremultipliedRenderColor(null)}set(e,i,u){this.fetchUniformLocation(e,i)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const km=new Float32Array(16);class Gl extends Ca{constructor(e){super(e),this.current=km}set(e,i,u){if(this.fetchUniformLocation(e,i)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const Hd=new Float32Array(9),Wd=new Float32Array(4);class Zd extends Ca{constructor(e){super(e),this.current=Wd}set(e,i,u){if(this.fetchUniformLocation(e,i)){for(let h=0;h<4;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function Xd(o){return[Bp(255*o.r,255*o.g),Bp(255*o.b,255*o.a)]}class Ph{constructor(e,i,u,h){this.value=e,this.uniformNames=i.map((p=>`u_${p}`)),this.type=u,this.context=h}setUniform(e,i,u,h,p){const m=h.constantOr(this.value);i.set(e,p,m instanceof wn?m.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):m)}getBinding(e,i){return this.type==="color"?new Gd(e):new $i(e)}}class ku{constructor(e,i){this.uniformNames=i.map((u=>`u_${u}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,u,h,p){let m=null;p!=="u_pattern"&&p!=="u_dash"||(m=this.pattern),p==="u_pattern_b"&&(m=this.patternTransition),p==="u_pixel_ratio"&&(m=this.pixelRatio),m&&i.set(e,p,m)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Mc(e):new $i(e)}}class Gs{constructor(e,i,u,h){this.expression=e,this.type=u,this.maxValue=0,this.paintVertexAttributes=i.map((p=>({name:`a_${p}`,type:"Float32",components:u==="color"?2:1,offset:0}))),this.paintVertexArray=new h}populatePaintArray(e,i,u,h,p,m,b,T){const A=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Un(0,{brightness:m,worldview:T}),i,{},p,h,b):this.expression.kind==="constant"&&this.expression.value,O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Un(0,{brightness:m,worldview:T}),i,{},p,h,b):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(A,e,M,O?null:this.context.lut)}updatePaintArray(e,i,u,h,p,m,b,T){const A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:b,worldview:T},u,h,void 0,p):this.expression.kind==="constant"&&this.expression.value,M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Un(0,{brightness:b,worldview:T}),u,h,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,i,A,M?null:this.context.lut)}_setPaintValue(e,i,u,h){if(this.type==="color"){const p=Xd(u.toPremultipliedRenderColor(h));for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,p[0],p[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bi{constructor(e,i,u,h,p,m){this.expression=e,this.uniformNames=i.map((b=>`u_${b}_t`)),this.type=u,this.useIntegerZoom=h,this.context=p,this.maxValue=0,this.paintVertexAttributes=i.map((b=>({name:`a_${b}`,type:"Float32",components:u==="color"?4:2,offset:0}))),this.paintVertexArray=new m}populatePaintArray(e,i,u,h,p,m,b,T){const A=this.expression.evaluate(new Un(this.context.zoom,{brightness:m,worldview:T}),i,{},p,h,b),M=this.expression.evaluate(new Un(this.context.zoom+1,{brightness:m,worldview:T}),i,{},p,h,b),O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Un(0,{brightness:m,worldview:T}),i,{},p,h,b):this.lutExpression.value)==="none",D=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(D,e,A,M,O?null:this.context.lut)}updatePaintArray(e,i,u,h,p,m,b,T){const A=this.expression.evaluate({zoom:this.context.zoom,brightness:b,worldview:T},u,h,void 0,p),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b,worldview:T},u,h,void 0,p),O=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Un(0,{brightness:b,worldview:T}),u,h,void 0,p):this.lutExpression.value)==="none";this._setPaintValue(e,i,A,M,O?null:this.context.lut)}_setPaintValue(e,i,u,h,p){if(this.type==="color"){const m=Xd(u.toPremultipliedRenderColor(p)),b=Xd(u.toPremultipliedRenderColor(p));for(let T=e;T<i;T++)this.paintVertexArray.emplace(T,m[0],m[1],b[0],b[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,u,h,p){const m=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=ve(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);i.set(e,p,b)}getBinding(e,i){return new $i(e)}}class so{constructor(e,i,u,h,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(u==="array"?Rm:Np).members;for(let m=0;m<i.length;++m);this.paintVertexArray=new h,this.paintTransitionVertexArray=new xh}populatePaintArray(e,i,u,h){const p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(p,e,i.patterns&&i.patterns[this.layerId],u)}updatePaintArray(e,i,u,h,p,m,b){this._setPaintValues(e,i,u.patterns&&u.patterns[this.layerId],m)}_setPaintValues(e,i,u,h){if(!h||!u)return;const p=h[u[0]],m=h[u[1]];if(p){if(p){const{tl:b,br:T,pixelRatio:A}=p;for(let M=e;M<i;M++)this.paintVertexArray.emplace(M,b[0],b[1],T[0],T[1],A)}if(m){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:b,br:T}=m;for(let A=e;A<i;A++)this.paintTransitionVertexArray.emplace(A,b[0],b[1],T[0],T[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,$d.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class lo{constructor(e,i,u=(()=>!0)){this.binders={},this._buffers=[],this.context=i;const h=[];for(const p in e.paint._values){const m=e.paint.get(p);if(p.endsWith("-use-theme")||!u(p)||!(m instanceof Bs&&ph(m.property.specification)))continue;const b=Hs(p,e.type),T=m.value,A=m.property.specification.type,M=!!m.property.useIntegerZoom,O=p==="line-dasharray"||p.endsWith("pattern"),D=e.paint.get(`${p}-use-theme`),N=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||D&&D.value.kind!=="constant";if(T.kind!=="constant"||N)if(T.kind==="source"||N||O){const U=Lm(p,A,"source");this.binders[p]=O?new so(T,b,A,U,e.id):new Gs(T,b,A,U),h.push(`/a_${p}`)}else{const U=Lm(p,A,"composite");this.binders[p]=new Bi(T,b,A,M,i,U),h.push(`/z_${p}`)}else this.binders[p]=O?new ku(T.value,b):new Ph(T.value,b,A,i),h.push(`/u_${p}`);D&&(this.binders[p].lutExpression=D.value)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Gs||i instanceof Bi?i.maxValue:0}populatePaintArrays(e,i,u,h,p,m,b,T){for(const A in this.binders){const M=this.binders[A];M.context=this.context,(M instanceof Gs||M instanceof Bi||M instanceof so)&&M.populatePaintArray(e,i,u,h,p,m,b,T)}}setConstantPatternPositions(e,i){for(const u in this.binders){const h=this.binders[u];h instanceof ku&&h.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof so?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,u,h,p,m,b,T,A,M){let O=!1;const D=Object.keys(e),N=D.length!==0&&!T,U=N?D:i.uniqueIds;this.context.lut=p.lut;for(const H in this.binders){const X=this.binders[H];if(X.context=this.context,(X instanceof Gs||X instanceof Bi||X instanceof so)&&X.expression&&X.expression.kind&&X.expression.kind!=="constant"&&(X.expression.isStateDependent===!0||X.expression.isLightConstant===!1)){const te=p.paint.get(H);X.expression=te.value;for(const ue of U){const le=e[ue.toString()];i.eachPosition(ue,((fe,De,Ie)=>{const Ce=h.feature(fe);X.updatePaintArray(De,Ie,Ce,le,m,b,A,M)}))}if(!N)for(const ue of u.uniqueIds){const le=e[ue.toString()];u.eachPosition(ue,((fe,De,Ie)=>{const Ce=h.feature(fe);X.updatePaintArray(De,Ie,Ce,le,m,b,A,M)}))}O=!0}}return O}defines(){const e=[];for(const i in this.binders){const u=this.binders[i];(u instanceof Ph||u instanceof ku)&&e.push(...u.uniformNames.map((h=>`#define HAS_UNIFORM_${h}`)))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const u=this.binders[i];if(u instanceof Gs||u instanceof Bi||u instanceof so)for(let h=0;h<u.paintVertexAttributes.length;h++)e.push(u.paintVertexAttributes[h].name);if(u instanceof so)for(let h=0;h<$d.members.length;h++)e.push($d.members[h].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const u=this.binders[i];if(u instanceof Ph||u instanceof ku||u instanceof Bi)for(const h of u.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof Ph||h instanceof ku||h instanceof Bi)for(const p of h.uniformNames)i.push({name:p,property:u,binding:h.getBinding(e,p)})}return i}setUniforms(e,i,u,h,p){for(const{name:m,property:b,binding:T}of u)this.binders[b].setUniform(e,T,p,h.get(b),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Gs||i instanceof Bi||i instanceof so)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof so&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const u=this.binders[i];(u instanceof Gs||u instanceof Bi||u instanceof so)&&u.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Gs||i instanceof Bi||i instanceof so)&&i.destroy()}}}class Wa{constructor(e,i,u=(()=>!0)){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new lo(h,i,u);this.needsUpload=!1,this._featureMap=new ql,this._featureMapWithoutIds=new ql,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,u,h,p,m,b,T,A){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(e,i,h,p,m,b,T,A);i.id!==void 0?this._featureMap.add(i.id,u,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,u,h,p,m,b,T){for(const A of u)this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,A,h,p,m,b||0,T)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Dm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Hs(o,e){return Dm[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const zm={"line-pattern":{source:Cu,composite:Cu},"fill-pattern":{source:Cu,composite:Cu},"fill-extrusion-pattern":{source:Cu,composite:Cu},"line-dasharray":{source:xh,composite:xh}},yl={color:{source:To,composite:Us},number:{source:Ic,composite:To}};function Lm(o,e,i){const u=zm[o];return u&&u[i]||yl[e][i]}nr(Ph,"ConstantBinder"),nr(ku,"PatternConstantBinder"),nr(Gs,"SourceExpressionBinder"),nr(so,"PatternCompositeBinder"),nr(Bi,"CompositeExpressionBinder"),nr(lo,"ProgramConfiguration",{omit:["_buffers"]}),nr(Wa,"ProgramConfigurationSet");const Zo=$t/Math.PI/2,Up=5,f=6,t=16383,s=64,d=[s,32,16],_=-Zo,v=Zo;function S(o,e,i,u=Zo){return i=Cn(i),[o*Math.sin(i)*u,-e*u,o*Math.cos(i)*u]}function E(o,e,i){return S(Math.cos(Cn(o)),Math.sin(Cn(o)),e,i)}const C=63710088e-1,k=2*Math.PI*C;class L{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new L(et(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,u=this.lat*i,h=e.lat*i,p=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return C*Math.acos(Math.min(p,1))}toBounds(e=0){const i=360*e/40075017,u=i/Math.cos(Math.PI/180*this.lat);return new j({lng:this.lng-u,lat:this.lat-i},{lng:this.lng+u,lat:this.lat+i})}toEcef(e){return E(this.lat,this.lng,Zo+e*Zo/C)}static convert(e){if(e instanceof L)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new L(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new L(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class j{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const u=e;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=e;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(e){return this._ne=e instanceof L?new L(e.lng,e.lat):L.convert(e),this}setSouthWest(e){return this._sw=e instanceof L?new L(e.lng,e.lat):L.convert(e),this}extend(e){const i=this._sw,u=this._ne;let h,p;if(e instanceof L)h=e,p=e;else{if(!(e instanceof j))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(j.convert(e)):this.extend(L.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(L.convert(e)):this;if(h=e._sw,p=e._ne,!h||!p)return this}return i||u?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),u.lng=Math.max(p.lng,u.lng),u.lat=Math.max(p.lat,u.lat)):(this._sw=new L(h.lng,h.lat),this._ne=new L(p.lng,p.lat)),this}getCenter(){return new L((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new L(this.getWest(),this.getNorth())}getSouthEast(){return new L(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:u}=L.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(e){if(e)return e instanceof j?e:new j(e)}}const B=0,q=25.5;function K(o){return k*Math.cos(o*Math.PI/180)}function Z(o){return(180+o)/360}function J(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Y(o,e){return o/K(e)}function se(o){return 360*o-180}function ce(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function pe(o,e){return o*K(ce(e))}const Se=85.051129;function Pe(o){return Math.cos(Cn(ve(o,-Se,Se)))}function Me(o,e){const i=ve(e,B,q),u=Math.pow(2,i);return Pe(o)*k/(512*u)}function Te(o){return 1/Math.cos(o*Math.PI/180)}function Ee(o,e=0){const i=Math.exp(Math.PI*(1-(o.y+e/$t)/(1<<o.z)*2));return 80150034*i/(i*i+1)/$t/(1<<o.z)}class Ae{constructor(e,i,u=0){this.x=+e,this.y=+i,this.z=+u}static fromLngLat(e,i=0){const u=L.convert(e);return new Ae(Z(u.lng),J(u.lat),Y(i,u.lat))}toLngLat(){return new L(se(this.x),ce(this.y))}toAltitude(){return pe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/k*Te(ce(this.y))}}function We(o,e,i,u,h,p,m,b,T){const A=(e+u)/2,M=(i+h)/2,O=new Ct(A,M);b(O),(function(D,N,U,H,X,te){const ue=U-X,le=H-te;return Math.abs((H-N)*ue-(U-D)*le)/Math.hypot(ue,le)})(O.x,O.y,p.x,p.y,m.x,m.y)>=T?(We(o,e,i,A,M,p,O,b,T),We(o,A,M,u,h,O,m,b,T)):o.push(m)}function Le(o,e,i){let u=o[0],h=u.x,p=u.y;e(u);const m=[u];for(let b=1;b<o.length;b++){const T=o[b],{x:A,y:M}=T;e(T),We(m,h,p,A,M,u,T,e,i),h=A,p=M,u=T}return m}function ut(o,e,i,u){if(u(e,i)){const h=e.add(i)._mult(.5);ut(o,e,h,u),ut(o,h,i,u)}else o.push(i)}function Je(o,e){let i=o[0];const u=[i];for(let h=1;h<o.length;h++){const p=o[h];ut(u,i,p,e),i=p}return u}const dt=Math.pow(2,14)-1,wt=-dt-1;function qe(o,e){const i=Math.round(o.x*e),u=Math.round(o.y*e);return o.x=ve(i,wt,dt),o.y=ve(u,wt,dt),(i<o.x||i>o.x+1||u<o.y||u>o.y+1)&&hn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Re(o,e,i){const u=o.loadGeometry(),h=o.extent,p=$t/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:b,x:T,y:A,projection:M}=i,O=D=>{const N=se((e.x+D.x/h)/m),U=ce((e.y+D.y/h)/m),H=M.project(N,U);D.x=(H.x*b-T)*h,D.y=(H.y*b-A)*h};for(let D=0;D<u.length;D++)if(o.type!==1)u[D]=Le(u[D],O,1);else{const N=[];for(const U of u[D])U.x<0||U.x>=h||U.y<0||U.y>=h||(O(U),N.push(U));u[D]=N}}for(const m of u)for(const b of m)qe(b,p);return u}function tt(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?Re(o):[]}}class Ye{constructor(e,i,u,h,p){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=h,this._values=p,e.readFields(vt,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,u=[];let h,p=1,m=0,b=0,T=0;for(;e.pos<i;){if(m<=0){const A=e.readVarint();p=7&A,m=A>>3}if(m--,p===1||p===2)b+=e.readSVarint(),T+=e.readSVarint(),p===1&&(h&&u.push(h),h=[]),h&&h.push(new Ct(b,T));else{if(p!==7)throw new Error(`unknown command ${p}`);h&&h.push(h[0].clone())}}return h&&u.push(h),u}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let u=1,h=0,p=0,m=0,b=1/0,T=-1/0,A=1/0,M=-1/0;for(;e.pos<i;){if(h<=0){const O=e.readVarint();u=7&O,h=O>>3}if(h--,u===1||u===2)p+=e.readSVarint(),m+=e.readSVarint(),p<b&&(b=p),p>T&&(T=p),m<A&&(A=m),m>M&&(M=m);else if(u!==7)throw new Error(`unknown command ${u}`)}return[b,A,T,M]}toGeoJSON(e,i,u){const h=this.extent*Math.pow(2,u),p=this.extent*e,m=this.extent*i,b=this.loadGeometry();function T(D){return[360*(D.x+p)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+m)/h)*Math.PI))-90]}function A(D){return D.map(T)}let M;if(this.type===1){const D=[];for(const U of b)D.push(U[0]);const N=A(D);M=D.length===1?{type:"Point",coordinates:N[0]}:{type:"MultiPoint",coordinates:N}}else if(this.type===2){const D=b.map(A);M=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{const D=(function(U){const H=U.length;if(H<=1)return[U];const X=[];let te,ue;for(let le=0;le<H;le++){const fe=bt(U[le]);fe!==0&&(ue===void 0&&(ue=fe<0),ue===fe<0?(te&&X.push(te),te=[U[le]]):te&&te.push(U[le]))}return te&&X.push(te),X})(b),N=[];for(const U of D)N.push(U.map(A));M=N.length===1?{type:"Polygon",coordinates:N[0]}:{type:"MultiPolygon",coordinates:N}}}const O={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(O.id=this.id),O}}function vt(o,e,i){o===1?e.id=i.readVarint():o===2?(function(u,h){const p=u.readVarint()+u.pos;for(;u.pos<p;){const m=h._keys[u.readVarint()],b=h._values[u.readVarint()];h.properties[m]=b}})(i,e):o===3?e.type=i.readVarint():o===4&&(e._geometry=i.pos)}function bt(o){let e=0;for(let i,u,h=0,p=o.length,m=p-1;h<p;m=h++)i=o[h],u=o[m],e+=(u.x-i.x)*(i.y+u.y);return e}Ye.types=["Unknown","Point","LineString","Polygon"];class It{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Dt,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new Ye(this._pbf,i,this.extent,this._keys,this._values)}}function Dt(o,e,i){o===15?e.version=i.readVarint():o===1?e.name=i.readString():o===5?e.extent=i.readVarint():o===2?e._features.push(i.pos):o===3?e._keys.push(i.readString()):o===4&&e._values.push((function(u){let h=null;const p=u.readVarint()+u.pos;for(;u.pos<p;){const m=u.readVarint()>>3;h=m===1?u.readString():m===2?u.readFloat():m===3?u.readDouble():m===4?u.readVarint64():m===5?u.readVarint():m===6?u.readSVarint():m===7?u.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(i))}class lr{constructor(e,i){this.layers=e.readFields(pr,{},i)}}function pr(o,e,i){if(o===3){const u=new It(i,i.readVarint()+i.pos);u.length&&(e[u.name]=u)}}const Yt="3d_elevation_id",dr="level";class ur{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,u){return this.get(e,!0,i,u)}optional(e,i,u){return this.get(e,!1,i,u)}success(){return this._valid}get(e,i,u,h){const p=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&p!==void 0&&!Number.isNaN(p)?u(h?h(p):p):i&&(this._valid=!1),this}}class kr{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,u){return this.featureFunc(e,i,u)}parseVertex(e,i,u){return this.vertexFunc(e,i,u)}}const Vr=new kr(((o,e,i)=>o.reset(e).require(Yt,(u=>{i.id=u})).optional("fixed_height_relative",(u=>{i.constantHeight=u}),vn.decodeRelativeHeight).geometry((u=>{i.bounds=u}),yp).success()),((o,e,i)=>o.reset(e).require(Yt,(u=>{i.id=u})).require("elevation_idx",(u=>{i.idx=u})).require("extent",(u=>{i.extent=u})).require("height_relative",(u=>{i.height=u}),vn.decodeRelativeHeight).geometry((u=>{i.position=u}),vn.getPoint).success())),Xr=new kr(((o,e,i)=>o.reset(e).require(Yt,(u=>{i.id=u})).optional("fixed_height",(u=>{i.constantHeight=u}),vn.decodeMetricHeight).geometry((u=>{i.bounds=u}),yp).success()),((o,e,i)=>o.reset(e).require(Yt,(u=>{i.id=u})).require("elevation_idx",(u=>{i.idx=u})).require("extent",(u=>{i.extent=u})).require("height",(u=>{i.height=u}),vn.decodeMetricHeight).geometry((u=>{i.position=u}),vn.getPoint).success()));class vn{static getPoint(e){return ts(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],u=[],h=e.length,p=new ur;for(let b=0;b<h;b++){const T=e.feature(b),A=T.properties.version,M=(m=A)?m==="1.0.1"?Xr:void 0:Vr;if(M===void 0){hn(`Unknown elevation feature version number ${A||"(unknown)"}`);continue}const O=T.properties.hasOwnProperty("type")?T.properties.type:void 0;if(O){if(Ye.types[T.type]==="Point"&&O==="curve_point"){const D={};M.parseVertex(p,T,D)&&i.push(D)}else if(Ye.types[T.type]==="Polygon"&&O==="curve_meta"){const D={};M.parseFeature(p,T,D)&&u.push(D)}}}var m;return{vertices:i,features:u}}}class jr{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,u){const h=ii(i,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/h;return u[0]=this.pos[0]+this.dir[0]*p,u[1]=this.pos[1]+this.dir[1]*p,!0}}class Sn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,u){const h=Lr(i,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/h;return u[0]=this.pos[0]+this.dir[0]*p,u[1]=this.pos[1]+this.dir[1]*p,u[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,i,u){if((function(N,U){var H=N[0],X=N[1],te=N[2],ue=U[0],le=U[1],fe=U[2];return Math.abs(H-ue)<=R*Math.max(1,Math.abs(H),Math.abs(ue))&&Math.abs(X-le)<=R*Math.max(1,Math.abs(X),Math.abs(le))&&Math.abs(te-fe)<=R*Math.max(1,Math.abs(te),Math.abs(fe))})(this.pos,e)||i===0)return u[0]=u[1]=u[2]=0,!1;const[h,p,m]=this.dir,b=this.pos[0]-e[0],T=this.pos[1]-e[1],A=this.pos[2]-e[2],M=h*h+p*p+m*m,O=2*(b*h+T*p+A*m),D=O*O-4*M*(b*b+T*T+A*A-i*i);if(D<0){const N=Math.max(-O/2,0),U=b+h*N,H=T+p*N,X=A+m*N,te=Math.hypot(U,H,X);return u[0]=U*i/te,u[1]=H*i/te,u[2]=X*i/te,!1}{const N=(-O-Math.sqrt(D))/(2*M);if(N<0){const U=Math.hypot(b,T,A);return u[0]=b*i/U,u[1]=T*i/U,u[2]=A*i/U,!1}return u[0]=b+h*N,u[1]=T+p*N,u[2]=A+m*N,!0}}}class Mn{constructor(e,i,u,h,p){this.TL=e,this.TR=i,this.BR=u,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(e,i,u){const h=[-1,1,1],p=[1,1,1],m=[1,-1,1],b=[-1,-1,1],T=Er(h,h,e),A=Er(p,p,e),M=Er(m,m,e),O=Er(b,b,e);return new Mn(T,A,M,O,i/u)}}function Xn(o,e,i){let u=1/0,h=-1/0;const p=[];for(const m of o){In(p,m,e);const b=Lr(p,i);u=Math.min(u,b),h=Math.max(h,b)}return[u,h]}function Gr(o,e){let i=!0;for(let u=0;u<o.planes.length;u++){const h=o.planes[u];let p=0;for(let m=0;m<e.length;m++)p+=Lr(h,e[m])+h[3]>=0;if(p===0)return 0;p!==e.length&&(i=!1)}return i?2:1}function Tn(o,e){for(const i of o.projections){const u=Xn(e,o.points[0],i.axis);if(i.projection[1]<u[0]||i.projection[0]>u[1])return 0}return 1}function _n(o,e){let i=0;const u=[0,0,0,0];for(let m=0;m<o.length;m++)u[0]=o[m][0],u[1]=o[m][1],u[2]=o[m][2],u[3]=1,(h=u)[0]*(p=e)[0]+h[1]*p[1]+h[2]*p[2]+h[3]*p[3]>=0&&i++;var h,p;return i}class zn{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Mr.fromPoints(this.points),this.projections=[],this.frustumEdges=[In([],this.points[2],this.points[3]),In([],this.points[0],this.points[3]),In([],this.points[4],this.points[0]),In([],this.points[5],this.points[1]),In([],this.points[6],this.points[2]),In([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const h=[0,-u[2],u[1]],p=[u[2],0,-u[0]];this.projections.push({axis:h,projection:Xn(this.points,this.points[0],h)}),this.projections.push({axis:p,projection:Xn(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(e,i,u,h){const p=Math.pow(2,u),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((A=>{const M=Ui([],A,e),O=1/M[3]/i*p;return(D=M)[0]=(N=M)[0]*(U=[O,O,h?1/M[3]:O,O])[0],D[1]=N[1]*U[1],D[2]=N[2]*U[2],D[3]=N[3]*U[3],D;var D,N,U})),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((A=>{const M=Ir([],Ur([],In([],m[A[0]],m[A[1]]),In([],m[A[2]],m[A[1]]))),O=-Lr(M,m[A[1]]);return M.concat(O)})),T=[];for(let A=0;A<m.length;A++)T.push([m[A][0],m[A][1],m[A][2]]);return new zn(T,b)}intersectsPrecise(e,i,u){for(let h=0;h<i.length;h++)if(!_n(e,i[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!_n(e,this.planes[h]))return 0;for(const h of u)for(const p of this.frustumEdges){const m=Ur([],h,p),b=gt(m);if(b===0)continue;$e(m,m,1/b);const T=Xn(this.points,this.points[0],m),A=Xn(e,this.points[0],m);if(T[0]>A[1]||A[0]>T[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const u=i[3];if(Lr([i[0],i[1],i[2]],e)+u<0)return!1}return!0}}class Mr{static fromPoints(e){const i=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const h of e)Wt(i,i,h),Zt(u,u,h);return new Mr(i,u)}static fromTileIdAndHeight(e,i,u){const h=1<<e.canonical.z,p=e.canonical.x,m=e.canonical.y;return new Mr([p/h,m/h,i],[(p+1)/h,(m+1)/h,u])}static applyTransform(e,i){const u=e.getCorners();for(let h=0;h<u.length;++h)Er(u[h],u[h],i);return Mr.fromPoints(u)}static applyTransformFast(e,i){const u=[i[12],i[13],i[14]],h=[...u];for(let p=0;p<3;p++)for(let m=0;m<3;m++){const b=i[4*m+p],T=b*e.min[m],A=b*e.max[m];u[p]+=Math.min(T,A),h[p]+=Math.max(T,A)}return new Mr(u,h)}static projectAabbCorners(e,i){const u=e.getCorners();for(let h=0;h<u.length;++h)Er(u[h],u[h],i);return u}constructor(e,i){this.min=e,this.max=i,this.center=$e([],Tt([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],u=yt(this.min),h=yt(this.max);for(let p=0;p<i.length;p++)u[p]=i[p]?this.min[p]:this.center[p],h[p]=i[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new Mr(u,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Gr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Gr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Tn(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Tn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}nr(Mr,"Aabb");class Gn{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,u=i[1],h=-i[0],p=(e.extent+1)*this.metersToTile;return[new Ct(Math.trunc(e.position[0]+u*p),Math.trunc(e.position[1]+h*p)),new Ct(Math.trunc(e.position[0]-u*p),Math.trunc(e.position[1]-h*p))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class On{constructor(e,i,u,h,p,m){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:u,max:u},this.safeArea=i,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=p,this.edges=this.edges.filter((b=>{return b.a<this.vertices.length&&b.b<this.vertices.length&&!((T=this.vertices[b.a].position)[0]===(A=this.vertices[b.b].position)[0]&&T[1]===A[1]);var T,A})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const b of this.vertices)this.vertexProps.push({dir:ts(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,b.height),this.heightRange.max=Math.max(this.heightRange.max,b.height);for(const b of this.edges){const T=this.vertices[b.a].position,A=this.vertices[b.b].position,M=tl(vo(),A,T),O=rl(M),D=Ql(vo(),M,1/O);this.edgeProps.push({vec:M,dir:D,len:O});const N=this.vertexProps[b.a].dir,U=this.vertexProps[b.b].dir;wl(N,N,D),wl(U,U,D)}for(const b of this.vertexProps)b.dir[0]===0&&b.dir[1]===0||eu(b.dir,b.dir);this.tessellate(m)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[u,h]=i;return wr(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,h)}computeSlopeNormal(e,i){const u=this.getClosestEdge(e);if(!u)return Pt(0,0,1);const h=u[0],p=this.edges[h],m=this.edgeProps[h].vec,b=Pt(m[0],m[1],(this.vertices[p.b].height-this.vertices[p.a].height)*i),T=Pt(b[1],-b[0],0);Ur(T,T,b);const A=gt(T);return A>0?$e(T,T,1/A):Pt(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,u=Number.POSITIVE_INFINITY,h=0;const p=ts(e.x,e.y);for(let m=0;m<this.edges.length;m++){const b=this.edges[m],T=this.edgeProps[m].dir,A=new jr(p,this.edgeProps[m].dir),M=this.vertices[b.a].position,O=this.vertices[b.b].position,D=vo(),N=vo(),U=A.intersectsPlane(M,this.vertexProps[b.a].dir,D),H=A.intersectsPlane(O,this.vertexProps[b.b].dir,N);if(!U||!H)continue;const X=tl(vo(),N,D),te=tl(vo(),p,D),ue=ii(X,X),le=ue>0?ii(te,X)/ue:0,fe=ve(le,0,1),De=Math.abs((le-fe)*this.edgeProps[m].len),Ie=tl(vo(),p,M),Ce=De+Math.abs(ii(Ie,ts(T[1],-T[0])));Ce<u&&(i=m,u=Ce,h=fe)}return[i,h]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const u=this.edges[i].a,h=this.edges[i].b,{position:p,height:m,extent:b}=this.vertices[u],{position:T,height:A,extent:M}=this.vertices[h],O=this.vertexProps[u].dir,D=this.vertexProps[h].dir,N=Pt(p[0]/e,p[1]/e,m),U=Pt(T[0]/e,T[1]/e,A),H=Pt(O[1],-O[0],0);$e(H,H,b);const X=Pt(D[1],-D[0],0);if($e(X,X,M),this.distSqLines(Pt(N[0]+.5*H[0],N[1]+.5*H[1],N[2]+.5*H[2]),Pt(U[0]-.5*X[0],U[1]-.5*X[1],U[2]-.5*X[2]),Pt(N[0]-.5*H[0],N[1]-.5*H[1],N[2]-.5*H[2]),Pt(U[0]+.5*X[0],U[1]+.5*X[1],U[2]+.5*X[2]))<=.0025000000000000005)continue;const te=this.vertices.length,ue=wl(vo(),p,T);this.vertices.push({position:Ql(ue,ue,.5),height:.5*(m+A),extent:.5*(b+M)});const le=wl(vo(),O,D);this.vertexProps.push({dir:eu(le,le)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:u,b:te}),this.edges.push({a:te,b:h});const fe=tl(vo(),this.vertices[te].position,p),De=rl(fe),Ie={vec:fe,dir:Ql(vo(),fe,1/De),len:De};this.edgeProps.push(Ie),this.edgeProps.push(Ie)}}distSqLines(e,i,u,h){const p=Ht(He(),i,e),m=Ht(He(),h,u),b=Ht(He(),e,u),T=Lr(p,p),A=Lr(p,m),M=Lr(p,b),O=Lr(m,m),D=Lr(m,b),N=T*O-A*A;if(N===0){const X=Lr(b,m)/Lr(m,m);return fr(or(He(),u,h,X),e)}const U=(A*D-M*O)/N,H=(T*D-A*M)/N;return fr(or(He(),e,i,U),or(He(),u,h,H))}}class Si{static parseFrom(e,i){const u=vn.parse(e);if(!u)return[];let{vertices:h,features:p}=u;const m=1/Ee(i);p.sort(((M,O)=>M.id-O.id)),h.sort(((M,O)=>M.id-O.id||M.idx-O.idx)),h=h.filter(((M,O,D)=>O===D.findIndex((N=>N.id===M.id&&N.idx===M.idx))));const b=new Array;let T=0;const A=h.length;for(const M of p){if(M.constantHeight){b.push(new On(M.id,M.bounds,M.constantHeight));continue}for(;T!==A&&h[T].id<M.id;)T++;if(T===A||h[T].id!==M.id)continue;const O=new Array,D=new Array,N=T;for(;T!==A&&h[T].id===M.id;){const U=h[T];if(O.push({position:U.position,height:U.height,extent:U.extent}),T!==N&&h[T-1].idx===U.idx-1){const H=T-N;D.push({a:H-1,b:H})}T++}b.push(new On(M.id,M.bounds,void 0,O,D,m))}return b}static getElevationFeature(e,i){if(!i)return;const u=+e.properties[Yt];return Number.isNaN(u)?void 0:i.find((h=>h.id===u))}}class xn{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*$t,this.yOffset=(e.y*this.zScale-i.y)*$t)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,u){const h=this.constantElevation(i,u);return h??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),u))}computeBiasedHeight(e,i){return i<=0?e:e+i*Fe(0,i,e>=0?e:Math.abs(.5*e))}}nr(On,"ElevationFeature");class Ln{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new pa,this.indexArray=new ai,this.segments=new wi,this.programConfigurations=new Wa(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ic),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,u,h){const p=this.layers[0],m=[];let b=null;p.type==="circle"&&(b=p.layout.get("circle-sort-key"));for(const{feature:A,id:M,index:O,sourceLayerIndex:D}of e){const N=this.layers[0]._featureFilter.needGeometry,U=tt(A,N);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{worldview:this.worldview}),U,u))continue;const H=b?b.evaluate(U,{},u):void 0,X={id:M,properties:A.properties,type:A.type,sourceLayerIndex:D,index:O,geometry:N?U.geometry:Re(A,u,h),patterns:{},sortKey:H};m.push(X)}b&&m.sort(((A,M)=>A.sortKey-M.sortKey));let T=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Od,T=h.projection);for(const A of m){const{geometry:M,index:O,sourceLayerIndex:D}=A,N=e[O].feature;this.addFeature(A,M,O,i.availableImages,u,T,i.brightness,i.elevationFeatures),i.featureIndex.insert(N,M,O,D,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,u,h,p,m,b){this.programConfigurations.updatePaintArrays(e,i,p,u,h,m,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Fp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,$l.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Vd.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,u,h,p,m,b,T){let A;this.elevationMode!=="none"&&(A=Si.getElevationFeature(e,T));for(const M of i)for(const O of M){const D=O.x,N=O.y;if(D<0||D>=$t||N<0||N>=$t)continue;if(m){const X=m.projectTilePoint(D,N,p),te=m.upVector(p,D,N);this.addGlobeExtVertex(X,te),this.addGlobeExtVertex(X,te),this.addGlobeExtVertex(X,te),this.addGlobeExtVertex(X,te)}const U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),H=U.vertexLength;if(this.addCircleVertex(D,N,-1,-1),this.addCircleVertex(D,N,1,-1),this.addCircleVertex(D,N,1,1),this.addCircleVertex(D,N,-1,1),this.elevationMode!=="none"){const X=A?A.pointElevation(new Ct(D,N)):0;this.hasElevation=this.hasElevation||X!==0;for(let te=0;te<4;te++)this.elevatedLayoutVertexArray.emplaceBack(X)}this.indexArray.emplaceBack(H,H+1,H+2),this.indexArray.emplaceBack(H,H+2,H+3),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,{},h,p,b,void 0,this.worldview)}addCircleVertex(e,i,u,h){this.layoutVertexArray.emplaceBack(2*e+(u+1)/2,2*i+(h+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Wn(o,e){for(let i=0;i<o.length;i++)if(Ko(e,o[i]))return!0;for(let i=0;i<e.length;i++)if(Ko(o,e[i]))return!0;return!!Ro(o,e)}function qi(o,e,i){return!!Ko(o,e)||!!Eo(e,o,i)}function ti(o,e){if(o.length===1)return Za(e,o[0]);for(let i=0;i<e.length;i++){const u=e[i];for(let h=0;h<u.length;h++)if(Ko(o,u[h]))return!0}for(let i=0;i<o.length;i++)if(Za(e,o[i]))return!0;for(let i=0;i<e.length;i++)if(Ro(o,e[i]))return!0;return!1}function Ni(o,e,i){if(o.length>1){if(Ro(o,e))return!0;for(let u=0;u<e.length;u++)if(Eo(e[u],o,i))return!0}for(let u=0;u<o.length;u++)if(Eo(o[u],e,i))return!0;return!1}function Ro(o,e){if(o.length===0||e.length===0)return!1;for(let i=0;i<o.length-1;i++){const u=o[i],h=o[i+1];for(let p=0;p<e.length-1;p++)if(Xo(u,h,e[p],e[p+1]))return!0}return!1}function Xo(o,e,i,u){return Li(o,i,u)!==Li(e,i,u)&&Li(o,e,i)!==Li(o,e,u)}function Uo(o,e,i){return(o.x-i.x)*(e.y-i.y)-(o.y-i.y)*(e.x-i.x)}function ko(o,e,i,u){const h=Uo(o,e,u),p=Uo(o,e,i);if(Math.sign(h)===Math.sign(p))return;const m=Uo(i,u,o),b=m+p-h;return Math.sign(m)!==Math.sign(b)?[m/(m-b),p/(p-h)]:void 0}function Eo(o,e,i){const u=i*i;if(e.length===1)return o.distSqr(e[0])<u;for(let h=1;h<e.length;h++)if(Ma(o,e[h-1],e[h])<u)return!0;return!1}function Ma(o,e,i){const u=e.distSqr(i);if(u===0)return o.distSqr(e);const h=((o.x-e.x)*(i.x-e.x)+(o.y-e.y)*(i.y-e.y))/u;return o.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function Za(o,e){let i,u,h,p=!1;for(let m=0;m<o.length;m++){i=o[m];for(let b=0,T=i.length-1;b<i.length;T=b++)u=i[b],h=i[T],u.y>e.y!=h.y>e.y&&e.x<(h.x-u.x)*(e.y-u.y)/(h.y-u.y)+u.x&&(p=!p)}return p}function Ko(o,e){let i=!1;for(let u=0,h=o.length-1;u<o.length;h=u++){const p=o[u],m=o[h];p.y>e.y!=m.y>e.y&&e.x<(m.x-p.x)*(e.y-p.y)/(m.y-p.y)+p.x&&(i=!i)}return i}function Mi(o,e,i,u,h){for(const m of o)if(e<=m.x&&i<=m.y&&u>=m.x&&h>=m.y)return!0;const p=[new Ct(e,i),new Ct(e,h),new Ct(u,h),new Ct(u,i)];if(o.length>2){for(const m of p)if(Ko(o,m))return!0}for(let m=0;m<o.length-1;m++)if(Oi(o[m],o[m+1],p))return!0;return!1}function Oi(o,e,i){const u=i[0],h=i[2];if(o.x<u.x&&e.x<u.x||o.x>h.x&&e.x>h.x||o.y<u.y&&e.y<u.y||o.y>h.y&&e.y>h.y)return!1;const p=Li(o,e,i[0]);return p!==Li(o,e,i[1])||p!==Li(o,e,i[2])||p!==Li(o,e,i[3])}function Jn(o,e,i,u,h,p){let m=e.y-o.y,b=o.x-e.x;if(p=p||0){const T=m*m+b*b;if(T===0)return!0;const A=Math.sqrt(T);m/=A,b/=A}return!((i.x-o.x)*m+(i.y-o.y)*b-p<0||(u.x-o.x)*m+(u.y-o.y)*b-p<0||(h.x-o.x)*m+(h.y-o.y)*b-p<0)}function Qi(o,e,i,u,h,p,m){return!(Jn(o,e,u,h,p,m)||Jn(e,i,u,h,p,m)||Jn(i,o,u,h,p,m)||Jn(u,h,o,e,i,m)||Jn(h,p,o,e,i,m)||Jn(p,u,o,e,i,m))}function uo(o,e,i){const u=e.paint.get(o).value;return u.kind==="constant"?u.value:i.programConfigurations.get(e.id).getMaxValue(o)}function Ai(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Xa(o,e,i,u,h){if(!e[0]&&!e[1])return o;const p=Ct.convert(e)._mult(h);i==="viewport"&&p._rotate(-u);const m=[];for(let b=0;b<o.length;b++)m.push(o[b].sub(p));return m}function Hl(o,e,i,u){const h=Ct.convert(o)._mult(u);return e==="viewport"&&h._rotate(-i),h}let Du,Oc;function zu(o,e,i){var u=2*Math.PI*6378137/256/Math.pow(2,i);return[o*u-2*Math.PI*6378137/2,e*u-2*Math.PI*6378137/2]}nr(Ln,"CircleBucket",{omit:["layers"]});class ga{constructor(e,i,u){this.z=e,this.x=i,this.y=u,this.key=Ka(0,e,e,i,u)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const u=(function(p,m,b){var T=zu(256*p,256*(m=Math.pow(2,b)-m-1),b),A=zu(256*(p+1),256*(m+1),b);return T[0]+","+T[1]+","+A[0]+","+A[1]})(this.x,this.y,this.z),h=(function(p,m,b){let T,A="";for(let M=p;M>0;M--)T=1<<M-1,A+=(m&T?1:0)+(b&T?2:0);return A})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ts{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Ka(e,i.z,i.z,i.x,i.y)}}class Gi{constructor(e,i,u,h,p){this.overscaledZ=e,this.wrap=i,this.canonical=new ga(u,+h,+p),this.key=i===0&&e===u?this.canonical.key:Ka(i,e,u,h,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Gi(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Gi(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Ka(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-e;return Ka(this.wrap*+i,e,e,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Gi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new Gi(i,this.wrap,i,u,h),new Gi(i,this.wrap,i,u+1,h),new Gi(i,this.wrap,i,u,h+1),new Gi(i,this.wrap,i,u+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Gi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Gi(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ts(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ka(o,e,i,u,h){const p=1<<Math.min(i,22);let m=p*(h%p)+u%p;return o&&i<22&&(m+=p*p*((o<0?-2*o-1:2*o)%(1<<2*(22-i)))),16*(32*m+i)+(e-i)}const Rc=[o=>{let e=o.canonical.x-1,i=o.wrap;return e<0&&(e=(1<<o.canonical.z)-1,i--),new Gi(o.overscaledZ,i,o.canonical.z,e,o.canonical.y)},o=>{let e=o.canonical.x+1,i=o.wrap;return e===1<<o.canonical.z&&(e=0,i++),new Gi(o.overscaledZ,i,o.canonical.z,e,o.canonical.y)},o=>new Gi(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new Gi(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];nr(ga,"CanonicalTileID"),nr(Gi,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Fm=mn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Bm}=Fm,Vp=mn([{name:"a_pos_3",components:3,type:"Int16"}]);var Xy=mn([{name:"a_pos",type:"Int16",components:2}]);function Of(o){return o*Zo/C}const g=[new Mr([_,_,_],[v,v,v]),new Mr([_,_,_],[0,0,v]),new Mr([0,_,_],[v,0,v]),new Mr([_,0,_],[0,v,v]),new Mr([0,0,_],[v,v,v])];function x(o,e,i,u=!0){const h=$e([],o._camera.position,o.worldSize),p=[e,i,1,1];Ui(p,p,o.pixelMatrixInverse),$o(p,p,1/p[3]);const m=Ir([],In([],p,h)),b=o.globeMatrix,T=[b[12],b[13],b[14]],A=In([],T,h),M=gt(A),O=Ir([],A),D=o.worldSize/(2*Math.PI),N=Lr(O,m),U=Math.asin(D/M);if(U<Math.acos(N)){if(!u)return null;const st=[],Ge=[];$e(st,m,M/N),Ir(Ge,In(Ge,st,A)),Ir(m,Tt(m,A,$e(m,Ge,Math.tan(U)*M)))}const H=[];new Sn(h,m).closestPointOnSphere(T,D,H);const X=Ir([],Ti(b,0)),te=Ir([],Ti(b,1)),ue=Ir([],Ti(b,2)),le=Lr(X,H),fe=Lr(te,H),De=Lr(ue,H),Ie=Ke(Math.asin(-fe/D));let Ce=Ke(Math.atan2(le,De));Ce=o.center.lng+(function(st,Ge){const ft=(Ge-st+180)%360-180;return ft<-180?ft+360:ft})(o.center.lng,Ce);const Be=Z(Ce),je=ve(J(Ie),0,1);return new Ae(Be,je)}class I{constructor(e,i,u){this.a=In([],e,u),this.b=In([],i,u),this.center=u;const h=Ir([],this.a),p=Ir([],this.b);this.angle=Math.acos(Lr(h,p))}}function F(o,e){if(o.angle===0)return null;let i;return i=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),i<0||i>1?null:(function(u,h,p,m){const b=Math.sin(p);return u*(Math.sin((1-m)*p)/b)+h*(Math.sin(m*p)/b)})(o.a[e],o.b[e],o.angle,ve(i,0,1))+o.center[e]}function G(o){if(o.z<=1)return g[o.z+2*o.y+o.x];const e=qt(it(o));return Mr.fromPoints(e)}function Q(o,e,i){return $e(o,o,1-i),pt(o,o,e,i)}function we(o,e,i){for(const u of o)Er(u,u,e),$e(u,u,i)}function Ze(o,e,i,u){const h=e/o.worldSize,p=o.globeMatrix;if(i.z<=1){const je=G(i).getCorners();return we(je,p,h),Mr.fromPoints(je)}const m=it(i,u),b=qt(m,Zo+Of(o._tileCoverLift));we(b,p,h);const T=Number.MAX_VALUE,A=[-T,-T,-T],M=[T,T,T];if(m.contains(o.center)){for(const Ge of b)Wt(M,M,Ge),Zt(A,A,Ge);A[2]=0;const je=o.point,st=[je.x*h,je.y*h,0];return Wt(M,M,st),Zt(A,A,st),new Mr(M,A)}if(o._tileCoverLift>0){for(const je of b)Wt(M,M,je),Zt(A,A,je);return new Mr(M,A)}const O=[p[12]*h,p[13]*h,p[14]*h],D=m.getCenter(),N=ve(o.center.lat,-Se,Se),U=ve(D.lat,-Se,Se),H=Z(o.center.lng),X=J(N);let te=H-Z(D.lng);const ue=X-J(U);te>.5?te-=1:te<-.5&&(te+=1);let le=0;Math.abs(te)>Math.abs(ue)?le=te>=0?1:3:(le=ue>=0?0:2,pt(O,O,[p[4]*h,p[5]*h,p[6]*h],-Math.sin(Cn(ue>=0?m.getSouth():m.getNorth()))*Zo));const fe=b[le],De=b[(le+1)%4],Ie=new I(fe,De,O),Ce=[F(Ie,0)||fe[0],F(Ie,1)||fe[1],F(Ie,2)||fe[2]],Be=ht(o.zoom);if(Be>0){const je=(function({x:Ge,y:ft,z:jt},_t,Mt,Ft,ot){const Ot=1/(1<<jt);let Xe=Ge*Ot,at=Xe+Ot,Ut=ft*Ot,Rt=Ut+Ot,gr=0;const ar=(Xe+at)/2-Ft;return ar>.5?gr=-1:ar<-.5&&(gr=1),Xe=((Xe+gr)*_t-(Ft*=_t))*Mt+Ft,at=((at+gr)*_t-Ft)*Mt+Ft,Ut=(Ut*_t-(ot*=_t))*Mt+ot,Rt=(Rt*_t-ot)*Mt+ot,[[Xe,Rt,0],[at,Rt,0],[at,Ut,0],[Xe,Ut,0]]})(i,e,o._pixelsPerMercatorPixel,H,X);for(let Ge=0;Ge<b.length;Ge++)Q(b[Ge],je[Ge],Be);const st=Tt([],je[le],je[(le+1)%4]);$e(st,st,.5),Q(Ce,st,Be)}for(const je of b)Wt(M,M,je),Zt(A,A,je);return M[2]=Math.min(fe[2],De[2]),Wt(M,M,Ce),Zt(A,A,Ce),new Mr(M,A)}function it({x:o,y:e,z:i},u=!1){const h=1/(1<<i),p=new L(se(o*h),e===(1<<i)-1&&u?-90:ce((e+1)*h)),m=new L(se((o+1)*h),e===0&&u?90:ce(e*h));return new j(p,m)}function qt(o,e=Zo){const i=Cn(o.getNorth()),u=Cn(o.getSouth()),h=Math.cos(i),p=Math.cos(u),m=Math.sin(i),b=Math.sin(u),T=o.getWest(),A=o.getEast();return[S(p,b,T,e),S(p,b,A,e),S(h,m,A,e),S(h,m,T,e)]}function mr(o,e,i,u){const h=1<<i.z,p=(o/$t+i.x)/h;return E(ce((e/$t+i.y)/h),se(p),u)}function xr({min:o,max:e}){return t/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}const _r=new Float64Array(16);function $r(o){const e=xr(o),i=ze(_r,[e,e,e]);return xe(i,i,Hr([],o.min))}function Kr(o){const e=(u=o.min,(i=_r)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=u[0],i[13]=u[1],i[14]=u[2],i[15]=1,i);var i,u;const h=1/xr(o);return be(e,e,[h,h,h])}function Qr(o){const e=$t/(2*Math.PI);return o/(2*Math.PI)/e}function Do(o,e){return $t/(512*Math.pow(2,o))*xr(G(e))}function Et(o,e,i,u,h){const p=Qr(i),m=[o,e,-i/(2*Math.PI)],b=ee(new Float64Array(16));return xe(b,b,m),be(b,b,[p,p,p]),ke(b,b,Cn(-h)),he(b,b,Cn(-u)),b}function ht(o){return Fe(Up,f,o)}function Lt(o,e){const i=E(e.lat,e.lng),u=(function(U){const H=E(U._center.lat,U._center.lng);let X=Ur([],Pt(0,1,0),H);const te=Ne([],-U.angle,H);X=Er(X,X,te),Ne(te,-U._pitch,X);const ue=Ir([],H);return $e(ue,ue,Of(U.cameraToCenterDistance/U.pixelsPerMeter)),Er(ue,ue,te),Tt([],H,ue)})(o);return m=(h=Ht([],u,i))[0],b=h[1],T=h[2],A=(p=i)[0],M=p[1],O=p[2],N=(D=Math.sqrt(m*m+b*b+T*T)*Math.sqrt(A*A+M*M+O*O))&&Lr(h,p)/D,Math.acos(Math.min(Math.max(N,-1),1));var h,p,m,b,T,A,M,O,D,N}function Tr(o,e){return Lt(o,e)>Math.PI/2*1.01}const sn=Cn(85),En=Math.cos(sn),An=Math.sin(sn),jn=ae(),aa=o=>{const e=[];return o.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Ri(o,e,i,u,h,p,m,b,T){if(p&&o.queryGeometry.isAboveHorizon)return!1;p&&(T*=o.pixelToTileUnitsFactor);const A=o.tileID.canonical,M=i.projection.upVectorScale(A,i.center.lat,i.worldSize).metersToTile;for(const O of e)for(const D of O){const N=D.add(b),U=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(N.x,N.y,!0):0,H=i.projection.projectTilePoint(N.x,N.y,A);if(U>0){const le=i.projection.upVector(A,N.x,N.y);H.x+=le[0]*M*U,H.y+=le[1]*M*U,H.z+=le[2]*M*U}const X=p?N:Ih(H.x,H.y,H.z,u),te=p?o.tilespaceRays.map((le=>fj(le,U))):o.queryGeometry.screenGeometry,ue=Ui([],[H.x,H.y,H.z,1],u);if(!m&&p?T*=ue[3]/i.cameraToCenterDistance:m&&!p&&(T*=i.cameraToCenterDistance/ue[3]),p){const le=ce((D.y/$t+A.y)/(1<<A.z));T/=i.projection.pixelsPerMeter(le,1)/Y(1,le)}if(qi(te,X,T))return!0}return!1}function Ih(o,e,i,u){const h=Ui([],[o,e,i,1],u);return new Ct(h[0]/h[3],h[1]/h[3])}const Ky=Pt(0,0,0),hj=Pt(0,0,1);function fj(o,e){const i=He();return Ky[2]=e,o.intersectsPlane(Ky,hj,i),new Ct(i[0],i[1])}class N2 extends Ln{}let j2,U2,V2,$2;function q2(o,{width:e,height:i},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*u);return o.width=e,o.height=i,o.data=h,o}function G2(o,e,i){const{width:u,height:h}=e;u===o.width&&h===o.height||(Vx(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,u),height:Math.min(o.height,h)},i,null),o.width=u,o.height=h,o.data=e.data)}function Vx(o,e,i,u,h,p,m,b){if(h.width===0||h.height===0)return e;if(h.width>o.width||h.height>o.height||i.x>o.width-h.width||i.y>o.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||u.x>e.width-h.width||u.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const T=o.data,A=e.data,M=p===4&&b;for(let O=0;O<h.height;O++){const D=((i.y+O)*o.width+i.x)*p,N=((u.y+O)*e.width+u.x)*p;if(M)for(let U=0;U<h.width;U++){const H=D+U*p+3,X=N+U*p;A[X+0]=255,A[X+1]=255,A[X+2]=255,A[X+3]=T[H]}else if(m)for(let U=0;U<h.width;U++){const H=D+U*p,X=N+U*p,te=new wn(T[H+0]/255,T[H+1]/255,T[H+2]/255,T[H+3]).toNonPremultipliedRenderColor(m).toArray();A[X+0]=te[0],A[X+1]=te[1],A[X+2]=te[2],A[X+3]=te[3]}else for(let U=0;U<h.width*p;U++)A[N+U]=T[D+U]}return e}nr(N2,"HeatmapBucket",{omit:["layers"]});class Kd{constructor(e,i){q2(this,e,1,i)}resize(e){G2(this,new Kd(e),1)}clone(){return new Kd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,u,h,p){Vx(e,i,u,h,p,1,null)}}class _a{constructor(e,i){q2(this,e,4,i)}resize(e){G2(this,new _a(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new _a({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,u,h,p,m,b){Vx(e,i,u,h,p,4,m,b)}}class H2{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function r_(o){const e={},i=o.resolution||256,u=o.clips?o.clips.length:1,h=o.image||new _a({width:i,height:u}),p=(m,b,T)=>{e[o.evaluationKey]=T;const A=o.expression.evaluate(e),M=A?A.toNonPremultipliedRenderColor(null):null;M&&(h.data[m+b+0]=Math.floor(255*M.r),h.data[m+b+1]=Math.floor(255*M.g),h.data[m+b+2]=Math.floor(255*M.b),h.data[m+b+3]=Math.floor(255*M.a))};if(o.clips)for(let m=0,b=0;m<u;++m,b+=4*i)for(let T=0,A=0;T<i;T++,A+=4){const M=T/(i-1),{start:O,end:D}=o.clips[m];p(b,A,O*(1-M)+D*M)}else for(let m=0,b=0;m<i;m++,b+=4)p(0,b,m/(i-1));return h}nr(Kd,"AlphaImage"),nr(_a,"RGBAImage");const dj=mn([{name:"a_pos",components:2,type:"Int16"}],4),pj=mn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),mj=mn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),gj=mn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Nm(o,e,i=2){const u=e&&e.length,h=u?e[0]*i:o.length;let p=W2(o,0,h,i,!0);const m=[];if(!p||p.next===p.prev)return m;let b,T,A;if(u&&(p=(function(M,O,D,N){const U=[];for(let H=0,X=O.length;H<X;H++){const te=W2(M,O[H]*N,H<X-1?O[H+1]*N:M.length,N,!1);te===te.next&&(te.steiner=!0),U.push(Tj(te))}U.sort(bj);for(let H=0;H<U.length;H++)D=wj(U[H],D);return D})(o,e,p,i)),o.length>80*i){b=o[0],T=o[1];let M=b,O=T;for(let D=i;D<h;D+=i){const N=o[D],U=o[D+1];N<b&&(b=N),U<T&&(T=U),N>M&&(M=N),U>O&&(O=U)}A=Math.max(M-b,O-T),A=A!==0?32767/A:0}return n_(p,m,i,b,T,A,0),m}function W2(o,e,i,u,h){let p;if(h===(function(m,b,T,A){let M=0;for(let O=b,D=T-A;O<T;O+=A)M+=(m[D]-m[O])*(m[O+1]+m[D+1]),D=O;return M})(o,e,i,u)>0)for(let m=e;m<i;m+=u)p=Y2(m/u|0,o[m],o[m+1],p);else for(let m=i-u;m>=e;m-=u)p=Y2(m/u|0,o[m],o[m+1],p);return p&&jm(p,p.next)&&(a_(p),p=p.next),p}function $p(o,e){if(!o)return o;e||(e=o);let i,u=o;do if(i=!1,u.steiner||!jm(u,u.next)&&Vo(u.prev,u,u.next)!==0)u=u.next;else{if(a_(u),u=e=u.prev,u===u.next)break;i=!0}while(i||u!==e);return e}function n_(o,e,i,u,h,p,m){if(!o)return;!m&&p&&(function(T,A,M,O){let D=T;do D.z===0&&(D.z=$x(D.x,D.y,A,M,O)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==T);D.prevZ.nextZ=null,D.prevZ=null,(function(N){let U,H=1;do{let X,te=N;N=null;let ue=null;for(U=0;te;){U++;let le=te,fe=0;for(let Ie=0;Ie<H&&(fe++,le=le.nextZ,le);Ie++);let De=H;for(;fe>0||De>0&&le;)fe!==0&&(De===0||!le||te.z<=le.z)?(X=te,te=te.nextZ,fe--):(X=le,le=le.nextZ,De--),ue?ue.nextZ=X:N=X,X.prevZ=ue,ue=X;te=le}ue.nextZ=null,H*=2}while(U>1)})(D)})(o,u,h,p);let b=o;for(;o.prev!==o.next;){const T=o.prev,A=o.next;if(p?yj(o,u,h,p):_j(o))e.push(T.i,o.i,A.i),a_(o),o=A.next,b=A.next;else if((o=A)===b){m?m===1?n_(o=vj($p(o),e),e,i,u,h,p,2):m===2&&xj(o,e,i,u,h,p):n_($p(o),e,i,u,h,p,1);break}}}function _j(o){const e=o.prev,i=o,u=o.next;if(Vo(e,i,u)>=0)return!1;const h=e.x,p=i.x,m=u.x,b=e.y,T=i.y,A=u.y,M=Math.min(h,p,m),O=Math.min(b,T,A),D=Math.max(h,p,m),N=Math.max(b,T,A);let U=u.next;for(;U!==e;){if(U.x>=M&&U.x<=D&&U.y>=O&&U.y<=N&&i_(h,b,p,T,m,A,U.x,U.y)&&Vo(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function yj(o,e,i,u){const h=o.prev,p=o,m=o.next;if(Vo(h,p,m)>=0)return!1;const b=h.x,T=p.x,A=m.x,M=h.y,O=p.y,D=m.y,N=Math.min(b,T,A),U=Math.min(M,O,D),H=Math.max(b,T,A),X=Math.max(M,O,D),te=$x(N,U,e,i,u),ue=$x(H,X,e,i,u);let le=o.prevZ,fe=o.nextZ;for(;le&&le.z>=te&&fe&&fe.z<=ue;){if(le.x>=N&&le.x<=H&&le.y>=U&&le.y<=X&&le!==h&&le!==m&&i_(b,M,T,O,A,D,le.x,le.y)&&Vo(le.prev,le,le.next)>=0||(le=le.prevZ,fe.x>=N&&fe.x<=H&&fe.y>=U&&fe.y<=X&&fe!==h&&fe!==m&&i_(b,M,T,O,A,D,fe.x,fe.y)&&Vo(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;le&&le.z>=te;){if(le.x>=N&&le.x<=H&&le.y>=U&&le.y<=X&&le!==h&&le!==m&&i_(b,M,T,O,A,D,le.x,le.y)&&Vo(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;fe&&fe.z<=ue;){if(fe.x>=N&&fe.x<=H&&fe.y>=U&&fe.y<=X&&fe!==h&&fe!==m&&i_(b,M,T,O,A,D,fe.x,fe.y)&&Vo(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function vj(o,e){let i=o;do{const u=i.prev,h=i.next.next;!jm(u,h)&&X2(u,i,i.next,h)&&o_(u,h)&&o_(h,u)&&(e.push(u.i,i.i,h.i),a_(i),a_(i.next),i=o=h),i=i.next}while(i!==o);return $p(i)}function xj(o,e,i,u,h,p){let m=o;do{let b=m.next.next;for(;b!==m.prev;){if(m.i!==b.i&&Ej(m,b)){let T=K2(m,b);return m=$p(m,m.next),T=$p(T,T.next),n_(m,e,i,u,h,p,0),void n_(T,e,i,u,h,p,0)}b=b.next}m=m.next}while(m!==o)}function bj(o,e){let i=o.x-e.x;return i===0&&(i=o.y-e.y,i===0)&&(i=(o.next.y-o.y)/(o.next.x-o.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function wj(o,e){const i=(function(h,p){let m=p;const b=h.x,T=h.y;let A,M=-1/0;if(jm(h,m))return m;do{if(jm(h,m.next))return m.next;if(T<=m.y&&T>=m.next.y&&m.next.y!==m.y){const H=m.x+(T-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(H<=b&&H>M&&(M=H,A=m.x<m.next.x?m:m.next,H===b))return A}m=m.next}while(m!==p);if(!A)return null;const O=A,D=A.x,N=A.y;let U=1/0;m=A;do{if(b>=m.x&&m.x>=D&&b!==m.x&&Z2(T<N?b:M,T,D,N,T<N?M:b,T,m.x,m.y)){const H=Math.abs(T-m.y)/(b-m.x);o_(m,h)&&(H<U||H===U&&(m.x>A.x||m.x===A.x&&Sj(A,m)))&&(A=m,U=H)}m=m.next}while(m!==O);return A})(o,e);if(!i)return e;const u=K2(i,o);return $p(u,u.next),$p(i,i.next)}function Sj(o,e){return Vo(o.prev,o,e.prev)<0&&Vo(e.next,o,o.next)<0}function $x(o,e,i,u,h){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-i)*h|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-u)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Tj(o){let e=o,i=o;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==o);return i}function Z2(o,e,i,u,h,p,m,b){return(h-m)*(e-b)>=(o-m)*(p-b)&&(o-m)*(u-b)>=(i-m)*(e-b)&&(i-m)*(p-b)>=(h-m)*(u-b)}function i_(o,e,i,u,h,p,m,b){return!(o===m&&e===b)&&Z2(o,e,i,u,h,p,m,b)}function Ej(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!(function(i,u){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==u.i&&h.next.i!==u.i&&X2(h,h.next,i,u))return!0;h=h.next}while(h!==i);return!1})(o,e)&&(o_(o,e)&&o_(e,o)&&(function(i,u){let h=i,p=!1;const m=(i.x+u.x)/2,b=(i.y+u.y)/2;do h.y>b!=h.next.y>b&&h.next.y!==h.y&&m<(h.next.x-h.x)*(b-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==i);return p})(o,e)&&(Vo(o.prev,o,e.prev)||Vo(o,e.prev,e))||jm(o,e)&&Vo(o.prev,o,o.next)>0&&Vo(e.prev,e,e.next)>0)}function Vo(o,e,i){return(e.y-o.y)*(i.x-e.x)-(e.x-o.x)*(i.y-e.y)}function jm(o,e){return o.x===e.x&&o.y===e.y}function X2(o,e,i,u){const h=Jy(Vo(o,e,i)),p=Jy(Vo(o,e,u)),m=Jy(Vo(i,u,o)),b=Jy(Vo(i,u,e));return h!==p&&m!==b||!(h!==0||!Yy(o,i,e))||!(p!==0||!Yy(o,u,e))||!(m!==0||!Yy(i,o,u))||!(b!==0||!Yy(i,e,u))}function Yy(o,e,i){return e.x<=Math.max(o.x,i.x)&&e.x>=Math.min(o.x,i.x)&&e.y<=Math.max(o.y,i.y)&&e.y>=Math.min(o.y,i.y)}function Jy(o){return o>0?1:o<0?-1:0}function o_(o,e){return Vo(o.prev,o,o.next)<0?Vo(o,e,o.next)>=0&&Vo(o,o.prev,e)>=0:Vo(o,e,o.prev)<0||Vo(o,o.next,e)<0}function K2(o,e){const i=qx(o.i,o.x,o.y),u=qx(e.i,e.x,e.y),h=o.next,p=e.prev;return o.next=e,e.prev=o,i.next=h,h.prev=i,u.next=i,i.prev=u,p.next=u,u.prev=p,u}function Y2(o,e,i,u){const h=qx(o,e,i);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function a_(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function qx(o,e,i){return{i:o,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function s_(o,e){const i=o.length;if(i<=1)return[o];const u=[];let h,p;for(let m=0;m<i;m++){const b=$n(o[m]);b!==0&&(o[m].area=Math.abs(b),p===void 0&&(p=b<0),p===b<0?(h&&u.push(h),h=[o[m]]):h.push(o[m]))}if(h&&u.push(h),e>1)for(let m=0;m<u.length;m++)u[m].length<=e||(bo(u[m],e,1,u[m].length-1,Aj),u[m]=u[m].slice(0,e));return u}function Aj(o,e){return e.area-o.area}function J2(o,e,i=1){if(!o)return null;const u=typeof o=="string"?Pa.from(o).getPrimary():o.getPrimary(),h=typeof o=="string"?null:o.getSecondary();for(const p of[u,h]){if(!p)continue;const m=p.id.toString();e.has(m)||e.set(m,[]),p.scaleSelf(i),e.get(m).push(p)}return{primary:u.toString(),secondary:h?h.toString():null}}function Gx(o,e,i,u){const h=u.patternDependencies;let p=!1;for(const m of e){const b=m.paint.get(`${o}-pattern`);b.isConstant()||(p=!0),J2(b.constantOr(null),h,i)&&(p=!0)}return p}function Hx(o,e,i,u,h,p){const m=p.patternDependencies;for(const b of e){const T=b.paint.get(`${o}-pattern`).value;if(T.kind!=="constant"){let A=T.evaluate({zoom:u},i,{},p.availableImages);A=A&&A.name?A.name:A;const M=J2(A,m,h);if(!M)continue;const{primary:O,secondary:D}=M;O&&(i.patterns[b.id]=[O,D].filter(Boolean))}}return i}class Q2{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,u]of e.polygons)this.add(i,...u)}}class qp{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new qp;let i=[];for(const A of e)i.push(...A.portals);if(i.length===0)return new qp;const u=(A,M)=>A<=0&&M<=0||A>=$t&&M>=$t;for(const A of i){const M=A.va,O=A.vb;(u(M.x,O.x)||u(M.y,O.y))&&(A.type="border")}const h=i.filter((A=>A.type!=="unevaluated")),p=i.filter((A=>A.type==="unevaluated"));if(p.length===0)return new qp;p.sort(((A,M)=>A.hash===M.hash?A.isTunnel===M.isTunnel?0:A.isTunnel?-1:1:A.hash<M.hash?1:-1)),i=h.concat(p);let m=h.length,b=m,T=m;do if(b++,b===i.length||i[m].hash!==i[b].hash){if(b-m==2){T<m&&(i[T]=i[m],i[m]=null);const A=i[T],M=i[b-1];A.type=A.isTunnel!==M.isTunnel?"tunnel":"polygon",A.connection={a:A.connection.a,b:M.connection.a},T++}m=b}while(m!==i.length);return i.splice(T),i.sort(((A,M)=>A.hash<M.hash?1:-1)),{portals:i}}}nr(qp,"ElevationPortalGraph"),nr(Q2,"ElevationPolygons");class Pj{constructor(e,i,u){this.outPositions=e,this.outNormals=i,this.outIndices=u,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,u){let h=e[2];u!=null&&(h*=u);const p=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),m=this.vertexLookup.get(p);if(m!=null)return m;const b=this.outPositions.length;this.vertexLookup.set(p,b);const T=Math.trunc(16384*i[0]),A=Math.trunc(16384*i[1]),M=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],h),this.outNormals.emplaceBack(T,A,M),b}addTriangle(e,i,u){this.outIndices.emplaceBack(e,i,u)}addTriangles(e,i,u){if(e.length===0)return;const h=u.length===1,p=He(),m=He();for(let b=0;b<e.length;b+=3){const T=i[e[b+0]],A=i[e[b+1]],M=i[e[b+2]],O=h?u[0]:u[e[b+1]],D=h?u[0]:u[e[b+2]];xt(p,T.x,T.y,h?u[0]:u[e[b+0]]);const N=this.addVertex(p,m);xt(p,A.x,A.y,O);const U=this.addVertex(p,m);xt(p,M.x,M.y,D);const H=this.addVertex(p,m);this.outIndices.emplaceBack(N,U,H)}}addQuad(e,i,u,h,p,m){const b=this.addVertex(e,p,m),T=this.addVertex(i,p,m),A=this.addVertex(u,p,m),M=this.addVertex(h,p,m);this.addTriangle(b,T,A),this.addTriangle(A,M,b)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Ws{constructor(e,i,u,h){this.unevaluatedPortals=new qp,this.portalPolygons=new Q2,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Rp,this.vertexNormals=new Md,this.indexArray=new ai,this.tileToMeters=Ee(e),this.bridgeProgramConfigurations=new Wa(i,{zoom:u,lut:h},(p=>p!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new Wa(i,{zoom:u,lut:h},(p=>p!=="fill-bridge-guard-rail-color"))}addVertices(e,i){const u=this.unevalVertices.length;for(let h=0;h<e.length;h++)this.unevalVertices.push(e[h]),this.unevalHeights.push(i[h]);return u}addTriangles(e,i,u){const h=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of e)h.push(p+i)}addRenderableRing(e,i,u,h,p,m){const b=[new Ct(p.min.x,p.min.y),new Ct(p.max.x,p.min.y),new Ct(p.max.x,p.max.y),new Ct(p.min.x,p.max.y)];for(let T=0;T<u-1;T++){const A=i+T,M=A+1,O=this.unevalVertices[A],D=this.unevalVertices[M];if(!(O.x>=p.min.x&&O.x<=p.max.x&&O.y>=p.min.y&&O.y<=p.max.y||D.x>=p.min.x&&D.x<=p.max.x&&D.y>=p.min.y&&D.y<=p.max.y||Oi(O,D,b))||this.isOnBorder(O.x,D.x)||this.isOnBorder(O.y,D.y))continue;const N=Ws.computeEdgeHash(this.unevalVertices[A],this.unevalVertices[M]);let U,H=this.vertexHashLookup.get(Ws.computePosHash(O));H!=null?U=H.next:(H=this.vertexHashLookup.get(Ws.computePosHash(D)),U=H!=null?H.prev:N),this.unevalEdges.push({polygonIdx:e,a:A,b:M,hash:N,portalHash:U,isTunnel:h,type:"unevaluated",featureInfo:m})}}addPortalCandidates(e,i,u,h,p){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:p});const m=i[0];this.vertexHashLookup.clear();let b=Ws.computeEdgeHash(m[m.length-2],m[m.length-1]);for(let T=0;T<m.length-1;T++){const A=m[T+0],M=m[T+1],O=ts(M.x-A.x,M.y-A.y),D=rl(O);if(D===0)continue;let N="unevaluated";const U=h.pointElevation(A),H=h.pointElevation(M);Math.abs(U)<.01&&Math.abs(H)<.01?N="entrance":(this.isOnBorder(A.x,M.x)||this.isOnBorder(A.y,M.y))&&(N="border");const X=Ws.computeEdgeHash(A,M);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:A,vb:M,vab:O,length:D,hash:X,isTunnel:u,type:N});const te=Ws.computePosHash(A);this.vertexHashLookup.set(te,{prev:b,next:X}),b=X}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=D=>{D.primitiveLength=this.indexArray.length-D.primitiveOffset},h=new Pj(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const p=i(),m=i(),b=i(),T=(D,N)=>{D.sort(((H,X)=>H.type===N&&X.type!==N?-1:H.type!==N&&X.type===N?1:0));const U=D.findIndex((H=>H.type!==N));return U>=0?U:D.length};let A=0;this.unevalEdges.length>0&&(A=T(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},this.tileToMeters)),u(b);const M=i(),O=i();if(this.unevalEdges.length>0){const D=this.unevalEdges.splice(A),N=T(D,"tunnel")+A;this.unevalEdges.push(...D),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},{min:A,max:N})}u(M),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(O),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(m),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(p),this.maskSegments=wi.simpleSegment(0,O.primitiveOffset,0,O.primitiveLength),this.depthSegments=wi.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength),this.renderableBridgeSegments=wi.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableTunnelSegments=wi.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.shadowCasterSegments=wi.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}update(e,i,u,h,p,m,b,T){this.bridgeProgramConfigurations.updatePaintArrays(e,i,p,u,h,m,b,T),this.tunnelProgramConfigurations.updatePaintArrays(e,i,p,u,h,m,b,T)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,mj.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,gj.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,u,h,p){const m=(b,T)=>{for(let A=0;A<T.length-1;A++){const M=T[A].featureIndex,O=T[A+1].vertexStart,D=e.feature(M);b.populatePaintArrays(O,D,M,{},u,i,h,void 0,p)}};m(this.bridgeProgramConfigurations,this.bridgeFeatureSections),m(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,u,h,p){const m=new Map;for(let b=h;b<p;b++){const T=u[b],A=T.a,M=T.b,O=Ws.computePosHash(e[A]),D=Ws.computePosHash(e[M]);let N=m.get(O);N||(N={},m.set(O,N));let U=m.get(D);U||(U={},m.set(D,U)),i[A]<=0&&i[M]<=0||(N.to=M,U.from=A)}return m}isTerminalVertex(e,i){const u=Ws.computePosHash(this.unevalVertices[e]),h=i.get(u);return!h||!h.from||!h.to}constructBridgeStructures(e,i,u,h,p,m){e.clearVertexLookup();const b=this.computeVertexConnections(i,u,h,p.min,p.max),T=1/m,A=.5*T,M=(Mt,Ft)=>xt(Mt,i[Ft].x,i[Ft].y,u[Ft]*T),O=He(),D=He(),N=He(),U=He(),H=He(),X=(Mt,Ft)=>{const ot=b.get(Ws.computePosHash(i[Ft])),Ot=ot.from,Xe=ot.to;if(!Ot||!Xe)return;M(O,Ot),M(D,Ft),M(N,Xe),Pi(U),Rn(O,D)||(In(H,D,O),Ir(U,H)),Rn(N,D)||(In(H,N,D),Tt(U,U,Ir(H,H)));const at=Ki(U);return at>0?$e(Mt,U,1/at):void 0};let te=Number.POSITIVE_INFINITY;this.sortSubarray(h,p.min,p.max,((Mt,Ft)=>Mt.featureInfo.featureIndex-Ft.featureInfo.featureIndex));const ue=He(),le=He(),fe=He(),De=He(),Ie=He(),Ce=He(),Be=He(),je=He(),st=He(),Ge=[He(),He(),He(),He()],ft=[He(),He(),He(),He()],jt=[{coord:new Ct(0,0),height:0},{coord:new Ct(0,0),height:0}],_t=(Mt,Ft)=>Mt>Ft;for(let Mt=p.min;Mt<p.max;Mt++){const Ft=h[Mt];if(!Ft.featureInfo.guardRailEnabled||!this.prepareEdgePoints(jt,i,u,Ft,_t))continue;const[ot,Ot]=jt;if(xt(ue,ot.coord.x,ot.coord.y,T*ot.height),xt(le,Ot.coord.x,Ot.coord.y,T*Ot.height),Rn(ue,le))continue;In(fe,le,ue),Ir(fe,fe);const Xe=X(je,Ft.a)||fe,at=X(st,Ft.b)||fe;xt(De,Xe[1],-Xe[0],0),Ir(De,De),xt(Ie,at[1],-at[0],0),Ir(Ie,Ie),Ur(je,De,Xe),Ir(Ce,je),Ur(je,Ie,at),Ir(Be,je),Tt(Ge[0],ue,$e(je,In(je,De,Ce),A)),Tt(Ge[1],ue,$e(je,Tt(je,De,Ce),A)),Tt(Ge[2],ue,$e(je,Ce,A)),Ge[3]=ue,Tt(ft[0],le,$e(je,In(je,Ie,Be),A)),Tt(ft[1],le,$e(je,Tt(je,Ie,Be),A)),Tt(ft[2],le,$e(je,Be,A)),ft[3]=le,te=this.addFeatureSection(Ft.featureInfo.featureIndex,te,this.bridgeFeatureSections,e);const Ut=e.addVertex(Ge[0],De,m),Rt=e.addVertex(Ge[1],De,m),gr=e.addVertex(ft[0],Ie,m),ar=e.addVertex(ft[1],Ie,m);e.addTriangle(Ut,Rt,gr),e.addTriangle(Rt,ar,gr);const At=e.addVertex(Ge[1],Ce,m),zt=e.addVertex(Ge[2],Ce,m),hr=e.addVertex(ft[1],Be,m),er=e.addVertex(ft[2],Be,m);e.addTriangle(At,zt,hr),e.addTriangle(zt,er,hr),Hr(De,De),Hr(Ie,Ie);const Gt=e.addVertex(Ge[2],De,m),rr=e.addVertex(Ge[3],De,m),Pr=e.addVertex(ft[2],Ie,m),Fr=e.addVertex(ft[3],Ie,m);e.addTriangle(Gt,rr,Pr),e.addTriangle(rr,Fr,Pr);const Zr=this.isTerminalVertex(Ft.a,b),qr=this.isTerminalVertex(Ft.b,b);ot.height<.01&&Zr&&e.addQuad(Ge[3],Ge[2],Ge[1],Ge[0],Hr(Xe,Xe),m),Ot.height<.01&&qr&&e.addQuad(ft[0],ft[1],ft[2],ft[3],at,m)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,u,h,p,m){e.clearVertexLookup();let b=Number.POSITIVE_INFINITY;const T=(te,ue)=>te.featureInfo.featureIndex-ue.featureInfo.featureIndex;this.sortSubarray(h,p.min,p.max,T),this.sortSubarray(h,m.min,m.max,T);const A=te=>Ir(te,te),M=[{coord:new Ct(0,0),height:0},{coord:new Ct(0,0),height:0}],O=(te,ue)=>te<ue,D=He(),N=He(),U=He(),H=He(),X=He();for(let te=p.min;te<p.max;te++){if(!this.prepareEdgePoints(M,i,u,h[te],O))continue;const[ue,le]=M,fe=A(xt(X,-(le.coord.y-ue.coord.y),le.coord.x-ue.coord.x,0));b=this.addFeatureSection(h[te].featureInfo.featureIndex,b,this.tunnelFeatureSections,e),e.addQuad(xt(D,ue.coord.x,ue.coord.y,ue.height),xt(N,le.coord.x,le.coord.y,le.height),xt(U,le.coord.x,le.coord.y,h[te].isTunnel?-.1:0),xt(H,ue.coord.x,ue.coord.y,h[te].isTunnel?-.1:0),fe)}for(let te=m.min;te<m.max;te++){const ue=h[te];ue.isTunnel&&([ue.a,ue.b]=[ue.b,ue.a]);const le=i[ue.a],fe=i[ue.b],De=A(xt(X,-(fe.y-le.y),fe.x-le.x,0));b=this.addFeatureSection(ue.featureInfo.featureIndex,b,this.tunnelFeatureSections,e),e.addQuad(xt(D,fe.x,fe.y,0),xt(N,le.x,le.y,0),xt(U,le.x,le.y,u[ue.a]+4),xt(H,fe.x,fe.y,u[ue.b]+4),De),e.addQuad(xt(D,le.x,le.y,0),xt(N,fe.x,fe.y,0),xt(U,fe.x,fe.y,u[ue.b]+4),xt(H,le.x,le.y,u[ue.a]+4),De)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,u,h){e.coord.x=i,e.coord.y=u,e.height=h}prepareEdgePoints(e,i,u,h,p){let m=i[h.a].x,b=i[h.a].y,T=i[h.b].x,A=i[h.b].y,M=u[h.a],O=u[h.b];const D=p(M,0),N=p(O,0);if(D&&N)return this.setElevatedPoint(e[0],m,b,M),this.setElevatedPoint(e[1],T,A,O),!0;if(!D&&!N)return!1;if(D){if(!N){const U=O/(O-M);T=wr(T,m,U),A=wr(A,b,U),O=wr(O,M,U)}}else{const U=M/(M-O);m=wr(m,T,U),b=wr(b,A,U),M=wr(M,O,U)}return this.setElevatedPoint(e[0],m,b,M),this.setElevatedPoint(e[1],T,A,O),!0}prepareEdges(e,i){if(i.length===0)return;i.sort(((b,T)=>b.hash===T.hash?T.polygonIdx-b.polygonIdx:T.hash>b.hash?1:-1));let u=0,h=0,p=0,m=i[u].polygonIdx;do h++,(h===i.length||i[u].hash!==i[h].hash)&&((h-u==1||i[h-1].polygonIdx!==m)&&(p<u&&(i[p]=i[u],i[u]=null),i[p].type="none",p++),u=h,u!==i.length&&(m=i[u].polygonIdx));while(u!==i.length);if(i.splice(p),i.length!==0&&e.length!==0){i.sort(((A,M)=>A.portalHash<M.portalHash?1:-1));let b=0,T=0;for(;b!==i.length&&T!==e.length;){const A=i[b],M=e[T];A.portalHash>M.hash?b++:M.hash>A.portalHash?T++:(A.type=M.type,b++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=$t&&i>=$t}addFeatureSection(e,i,u,h){return e!==i&&(i=e,u.push({featureIndex:e,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),i}sortSubarray(e,i,u,h){const p=e.slice(i,u);p.sort(h),e.splice(i,p.length,...p)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Ws.computePosHash(e))<<32n|BigInt(Ws.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var eP,tP={exports:{}},rP=(eP||(eP=1,(function(o,e){(function(i){function u(me,ge){return me>ge?1:me<ge?-1:0}var h=function(me,ge){me===void 0&&(me=u),ge===void 0&&(ge=!1),this._compare=me,this._root=null,this._size=0,this._noDuplicates=!!ge},p={size:{configurable:!0}};function m(me,ge,nt,Vt,Kt){var Xt=Kt-Vt;if(Xt>0){var cr=Vt+Math.floor(Xt/2),Dr={key:ge[cr],data:nt[cr],parent:me};return Dr.left=m(Dr,ge,nt,Vt,cr),Dr.right=m(Dr,ge,nt,cr+1,Kt),Dr}return null}function b(me,ge,nt,Vt,Kt){if(!(nt>=Vt)){for(var Xt=me[nt+Vt>>1],cr=nt-1,Dr=Vt+1;;){do cr++;while(Kt(me[cr],Xt)<0);do Dr--;while(Kt(me[Dr],Xt)>0);if(cr>=Dr)break;var fn=me[cr];me[cr]=me[Dr],me[Dr]=fn,fn=ge[cr],ge[cr]=ge[Dr],ge[Dr]=fn}b(me,ge,nt,Dr,Kt),b(me,ge,Dr+1,Vt,Kt)}}h.prototype.rotateLeft=function(me){var ge=me.right;ge&&(me.right=ge.left,ge.left&&(ge.left.parent=me),ge.parent=me.parent),me.parent?me===me.parent.left?me.parent.left=ge:me.parent.right=ge:this._root=ge,ge&&(ge.left=me),me.parent=ge},h.prototype.rotateRight=function(me){var ge=me.left;ge&&(me.left=ge.right,ge.right&&(ge.right.parent=me),ge.parent=me.parent),me.parent?me===me.parent.left?me.parent.left=ge:me.parent.right=ge:this._root=ge,ge&&(ge.right=me),me.parent=ge},h.prototype._splay=function(me){for(;me.parent;){var ge=me.parent;ge.parent?ge.left===me&&ge.parent.left===ge?(this.rotateRight(ge.parent),this.rotateRight(ge)):ge.right===me&&ge.parent.right===ge?(this.rotateLeft(ge.parent),this.rotateLeft(ge)):ge.left===me&&ge.parent.right===ge?(this.rotateRight(ge),this.rotateLeft(ge)):(this.rotateLeft(ge),this.rotateRight(ge)):ge.left===me?this.rotateRight(ge):this.rotateLeft(ge)}},h.prototype.splay=function(me){for(var ge,nt,Vt,Kt,Xt;me.parent;)(nt=(ge=me.parent).parent)&&nt.parent?((Vt=nt.parent).left===nt?Vt.left=me:Vt.right=me,me.parent=Vt):(me.parent=null,this._root=me),Kt=me.left,Xt=me.right,me===ge.left?(nt&&(nt.left===ge?(ge.right?(nt.left=ge.right,nt.left.parent=nt):nt.left=null,ge.right=nt,nt.parent=ge):(Kt?(nt.right=Kt,Kt.parent=nt):nt.right=null,me.left=nt,nt.parent=me)),Xt?(ge.left=Xt,Xt.parent=ge):ge.left=null,me.right=ge,ge.parent=me):(nt&&(nt.right===ge?(ge.left?(nt.right=ge.left,nt.right.parent=nt):nt.right=null,ge.left=nt,nt.parent=ge):(Xt?(nt.left=Xt,Xt.parent=nt):nt.left=null,me.right=nt,nt.parent=me)),Kt?(ge.right=Kt,Kt.parent=ge):ge.right=null,me.left=ge,ge.parent=me)},h.prototype.replace=function(me,ge){me.parent?me===me.parent.left?me.parent.left=ge:me.parent.right=ge:this._root=ge,ge&&(ge.parent=me.parent)},h.prototype.minNode=function(me){if(me===void 0&&(me=this._root),me)for(;me.left;)me=me.left;return me},h.prototype.maxNode=function(me){if(me===void 0&&(me=this._root),me)for(;me.right;)me=me.right;return me},h.prototype.insert=function(me,ge){var nt=this._root,Vt=null,Kt=this._compare;if(this._noDuplicates)for(;nt;){if(Vt=nt,Kt(nt.key,me)===0)return;nt=Kt(nt.key,me)<0?nt.right:nt.left}else for(;nt;)Vt=nt,nt=Kt(nt.key,me)<0?nt.right:nt.left;return nt={key:me,data:ge,left:null,right:null,parent:Vt},Vt?Kt(Vt.key,nt.key)<0?Vt.right=nt:Vt.left=nt:this._root=nt,this.splay(nt),this._size++,nt},h.prototype.find=function(me){for(var ge=this._root,nt=this._compare;ge;){var Vt=nt(ge.key,me);if(Vt<0)ge=ge.right;else{if(!(Vt>0))return ge;ge=ge.left}}return null},h.prototype.contains=function(me){for(var ge=this._root,nt=this._compare;ge;){var Vt=nt(me,ge.key);if(Vt===0)return!0;ge=Vt<0?ge.left:ge.right}return!1},h.prototype.remove=function(me){var ge=this.find(me);if(!ge)return!1;if(this.splay(ge),ge.left)if(ge.right){var nt=this.minNode(ge.right);nt.parent!==ge&&(this.replace(nt,nt.right),nt.right=ge.right,nt.right.parent=nt),this.replace(ge,nt),nt.left=ge.left,nt.left.parent=nt}else this.replace(ge,ge.left);else this.replace(ge,ge.right);return this._size--,!0},h.prototype.removeNode=function(me){if(!me)return!1;if(this.splay(me),me.left)if(me.right){var ge=this.minNode(me.right);ge.parent!==me&&(this.replace(ge,ge.right),ge.right=me.right,ge.right.parent=ge),this.replace(me,ge),ge.left=me.left,ge.left.parent=ge}else this.replace(me,me.left);else this.replace(me,me.right);return this._size--,!0},h.prototype.erase=function(me){var ge=this.find(me);if(ge){this.splay(ge);var nt=ge.left,Vt=ge.right,Kt=null;nt&&(nt.parent=null,Kt=this.maxNode(nt),this.splay(Kt),this._root=Kt),Vt&&(nt?Kt.right=Vt:this._root=Vt,Vt.parent=Kt),this._size--}},h.prototype.pop=function(){var me=this._root,ge=null;if(me){for(;me.left;)me=me.left;ge={key:me.key,data:me.data},this.remove(me.key)}return ge},h.prototype.next=function(me){var ge=me;if(ge)if(ge.right)for(ge=ge.right;ge&&ge.left;)ge=ge.left;else for(ge=me.parent;ge&&ge.right===me;)me=ge,ge=ge.parent;return ge},h.prototype.prev=function(me){var ge=me;if(ge)if(ge.left)for(ge=ge.left;ge&&ge.right;)ge=ge.right;else for(ge=me.parent;ge&&ge.left===me;)me=ge,ge=ge.parent;return ge},h.prototype.forEach=function(me){for(var ge=this._root,nt=[],Vt=!1,Kt=0;!Vt;)ge?(nt.push(ge),ge=ge.left):nt.length>0?(me(ge=nt.pop(),Kt++),ge=ge.right):Vt=!0;return this},h.prototype.range=function(me,ge,nt,Vt){for(var Kt=[],Xt=this._compare,cr=this._root;Kt.length!==0||cr;)if(cr)Kt.push(cr),cr=cr.left;else{if(Xt((cr=Kt.pop()).key,ge)>0)break;if(Xt(cr.key,me)>=0&&nt.call(Vt,cr))return this;cr=cr.right}return this},h.prototype.keys=function(){for(var me=this._root,ge=[],nt=[],Vt=!1;!Vt;)me?(ge.push(me),me=me.left):ge.length>0?(me=ge.pop(),nt.push(me.key),me=me.right):Vt=!0;return nt},h.prototype.values=function(){for(var me=this._root,ge=[],nt=[],Vt=!1;!Vt;)me?(ge.push(me),me=me.left):ge.length>0?(me=ge.pop(),nt.push(me.data),me=me.right):Vt=!0;return nt},h.prototype.at=function(me){for(var ge=this._root,nt=[],Vt=!1,Kt=0;!Vt;)if(ge)nt.push(ge),ge=ge.left;else if(nt.length>0){if(ge=nt.pop(),Kt===me)return ge;Kt++,ge=ge.right}else Vt=!0;return null},h.prototype.load=function(me,ge,nt){if(me===void 0&&(me=[]),ge===void 0&&(ge=[]),nt===void 0&&(nt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Vt=me.length;return nt&&b(me,ge,0,Vt-1,this._compare),this._root=m(null,me,ge,0,Vt),this._size=Vt,this},h.prototype.min=function(){var me=this.minNode(this._root);return me?me.key:null},h.prototype.max=function(){var me=this.maxNode(this._root);return me?me.key:null},h.prototype.isEmpty=function(){return this._root===null},p.size.get=function(){return this._size},h.createTree=function(me,ge,nt,Vt,Kt){return new h(nt,Kt).load(me,ge,Vt)},Object.defineProperties(h.prototype,p);var T=0,A=1,M=2,O=3,D=0,N=1,U=2,H=3;function X(me,ge,nt){ge===null?(me.inOut=!1,me.otherInOut=!0):(me.isSubject===ge.isSubject?(me.inOut=!ge.inOut,me.otherInOut=ge.otherInOut):(me.inOut=!ge.otherInOut,me.otherInOut=ge.isVertical()?!ge.inOut:ge.inOut),ge&&(me.prevInResult=!te(ge,nt)||ge.isVertical()?ge.prevInResult:ge));var Vt=te(me,nt);me.resultTransition=Vt?(function(Kt,Xt){var cr,Dr=!Kt.inOut,fn=!Kt.otherInOut;switch(Xt){case D:cr=Dr&&fn;break;case N:cr=Dr||fn;break;case H:cr=Dr^fn;break;case U:cr=Kt.isSubject?Dr&&!fn:fn&&!Dr}return cr?1:-1})(me,nt):0}function te(me,ge){switch(me.type){case T:switch(ge){case D:return!me.otherInOut;case N:return me.otherInOut;case U:return me.isSubject&&me.otherInOut||!me.isSubject&&!me.otherInOut;case H:return!0}break;case M:return ge===D||ge===N;case O:return ge===U;case A:return!1}return!1}var ue=function(me,ge,nt,Vt,Kt){this.left=ge,this.point=me,this.otherEvent=nt,this.isSubject=Vt,this.type=Kt||T,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},le={inResult:{configurable:!0}};function fe(me,ge){return me[0]===ge[0]&&me[1]===ge[1]}ue.prototype.isBelow=function(me){var ge=this.point,nt=this.otherEvent.point;return this.left?(ge[0]-me[0])*(nt[1]-me[1])-(nt[0]-me[0])*(ge[1]-me[1])>0:(nt[0]-me[0])*(ge[1]-me[1])-(ge[0]-me[0])*(nt[1]-me[1])>0},ue.prototype.isAbove=function(me){return!this.isBelow(me)},ue.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},le.inResult.get=function(){return this.resultTransition!==0},ue.prototype.clone=function(){var me=new ue(this.point,this.left,this.otherEvent,this.isSubject,this.type);return me.contourId=this.contourId,me.resultTransition=this.resultTransition,me.prevInResult=this.prevInResult,me.isExteriorRing=this.isExteriorRing,me.inOut=this.inOut,me.otherInOut=this.otherInOut,me},Object.defineProperties(ue.prototype,le);var De=11102230246251565e-32,Ie=134217729,Ce=(3+8*De)*De;function Be(me,ge,nt,Vt,Kt){var Xt,cr,Dr,fn,dn=ge[0],en=Vt[0],Qn=0,zi=0;en>dn==en>-dn?(Xt=dn,dn=ge[++Qn]):(Xt=en,en=Vt[++zi]);var Yr=0;if(Qn<me&&zi<nt)for(en>dn==en>-dn?(Dr=Xt-((cr=dn+Xt)-dn),dn=ge[++Qn]):(Dr=Xt-((cr=en+Xt)-en),en=Vt[++zi]),Xt=cr,Dr!==0&&(Kt[Yr++]=Dr);Qn<me&&zi<nt;)en>dn==en>-dn?(Dr=Xt-((cr=Xt+dn)-(fn=cr-Xt))+(dn-fn),dn=ge[++Qn]):(Dr=Xt-((cr=Xt+en)-(fn=cr-Xt))+(en-fn),en=Vt[++zi]),Xt=cr,Dr!==0&&(Kt[Yr++]=Dr);for(;Qn<me;)Dr=Xt-((cr=Xt+dn)-(fn=cr-Xt))+(dn-fn),dn=ge[++Qn],Xt=cr,Dr!==0&&(Kt[Yr++]=Dr);for(;zi<nt;)Dr=Xt-((cr=Xt+en)-(fn=cr-Xt))+(en-fn),en=Vt[++zi],Xt=cr,Dr!==0&&(Kt[Yr++]=Dr);return Xt===0&&Yr!==0||(Kt[Yr++]=Xt),Yr}function je(me){return new Float64Array(me)}var st=33306690738754716e-32,Ge=22204460492503146e-32,ft=11093356479670487e-47,jt=je(4),_t=je(8),Mt=je(12),Ft=je(16),ot=je(4);function Ot(me,ge,nt){var Vt=(function(Kt,Xt,cr,Dr,fn,dn){var en=(Xt-dn)*(cr-fn),Qn=(Kt-fn)*(Dr-dn),zi=en-Qn;if(en===0||Qn===0||en>0!=Qn>0)return zi;var Yr=Math.abs(en+Qn);return Math.abs(zi)>=st*Yr?zi:-(function(_i,si,Hn,ki,di,li,hi){var Kn,tn,ei,Di,Or,Pn,pi,Fi,yi,po,ri,co,Es,ya,sa,As,Oh,mo,zo=_i-di,va=Hn-di,Ya=si-li,Oa=ki-li;jt[0]=(sa=(Fi=zo-(pi=(Pn=Ie*zo)-(Pn-zo)))*(po=Oa-(yi=(Pn=Ie*Oa)-(Pn-Oa)))-((ya=zo*Oa)-pi*yi-Fi*yi-pi*po))-((ri=sa-(Oh=(Fi=Ya-(pi=(Pn=Ie*Ya)-(Pn-Ya)))*(po=va-(yi=(Pn=Ie*va)-(Pn-va)))-((As=Ya*va)-pi*yi-Fi*yi-pi*po)))+(Or=sa-ri))+(Or-Oh),jt[1]=(Es=ya-((co=ya+ri)-(Or=co-ya))+(ri-Or))-((ri=Es-As)+(Or=Es-ri))+(Or-As),jt[2]=co-((mo=co+ri)-(Or=mo-co))+(ri-Or),jt[3]=mo;var np=(function(Cre,pM){for(var mM=pM[0],Yb=1;Yb<4;Yb++)mM+=pM[Yb];return mM})(0,jt),B_=Ge*hi;if(np>=B_||-np>=B_||(Kn=_i-(zo+(Or=_i-zo))+(Or-di),ei=Hn-(va+(Or=Hn-va))+(Or-di),tn=si-(Ya+(Or=si-Ya))+(Or-li),Di=ki-(Oa+(Or=ki-Oa))+(Or-li),Kn===0&&tn===0&&ei===0&&Di===0)||(B_=ft*hi+Ce*Math.abs(np),(np+=zo*Di+Oa*Kn-(Ya*ei+va*tn))>=B_||-np>=B_))return np;ot[0]=(sa=(Fi=Kn-(pi=(Pn=Ie*Kn)-(Pn-Kn)))*(po=Oa-(yi=(Pn=Ie*Oa)-(Pn-Oa)))-((ya=Kn*Oa)-pi*yi-Fi*yi-pi*po))-((ri=sa-(Oh=(Fi=tn-(pi=(Pn=Ie*tn)-(Pn-tn)))*(po=va-(yi=(Pn=Ie*va)-(Pn-va)))-((As=tn*va)-pi*yi-Fi*yi-pi*po)))+(Or=sa-ri))+(Or-Oh),ot[1]=(Es=ya-((co=ya+ri)-(Or=co-ya))+(ri-Or))-((ri=Es-As)+(Or=Es-ri))+(Or-As),ot[2]=co-((mo=co+ri)-(Or=mo-co))+(ri-Or),ot[3]=mo;var PU=Be(4,jt,4,ot,_t);ot[0]=(sa=(Fi=zo-(pi=(Pn=Ie*zo)-(Pn-zo)))*(po=Di-(yi=(Pn=Ie*Di)-(Pn-Di)))-((ya=zo*Di)-pi*yi-Fi*yi-pi*po))-((ri=sa-(Oh=(Fi=Ya-(pi=(Pn=Ie*Ya)-(Pn-Ya)))*(po=ei-(yi=(Pn=Ie*ei)-(Pn-ei)))-((As=Ya*ei)-pi*yi-Fi*yi-pi*po)))+(Or=sa-ri))+(Or-Oh),ot[1]=(Es=ya-((co=ya+ri)-(Or=co-ya))+(ri-Or))-((ri=Es-As)+(Or=Es-ri))+(Or-As),ot[2]=co-((mo=co+ri)-(Or=mo-co))+(ri-Or),ot[3]=mo;var IU=Be(PU,_t,4,ot,Mt);ot[0]=(sa=(Fi=Kn-(pi=(Pn=Ie*Kn)-(Pn-Kn)))*(po=Di-(yi=(Pn=Ie*Di)-(Pn-Di)))-((ya=Kn*Di)-pi*yi-Fi*yi-pi*po))-((ri=sa-(Oh=(Fi=tn-(pi=(Pn=Ie*tn)-(Pn-tn)))*(po=ei-(yi=(Pn=Ie*ei)-(Pn-ei)))-((As=tn*ei)-pi*yi-Fi*yi-pi*po)))+(Or=sa-ri))+(Or-Oh),ot[1]=(Es=ya-((co=ya+ri)-(Or=co-ya))+(ri-Or))-((ri=Es-As)+(Or=Es-ri))+(Or-As),ot[2]=co-((mo=co+ri)-(Or=mo-co))+(ri-Or),ot[3]=mo;var CU=Be(IU,Mt,4,ot,Ft);return Ft[CU-1]})(Kt,Xt,cr,Dr,fn,dn,Yr)})(me[0],me[1],ge[0],ge[1],nt[0],nt[1]);return Vt>0?-1:Vt<0?1:0}function Xe(me,ge){var nt=me.point,Vt=ge.point;return nt[0]>Vt[0]?1:nt[0]<Vt[0]?-1:nt[1]!==Vt[1]?nt[1]>Vt[1]?1:-1:(function(Kt,Xt,cr,Dr){return Kt.left!==Xt.left?Kt.left?1:-1:Ot(cr,Kt.otherEvent.point,Xt.otherEvent.point)!==0?Kt.isBelow(Xt.otherEvent.point)?-1:1:!Kt.isSubject&&Xt.isSubject?1:-1})(me,ge,nt)}function at(me,ge,nt){var Vt=new ue(ge,!1,me,me.isSubject),Kt=new ue(ge,!0,me.otherEvent,me.isSubject);return fe(me.point,me.otherEvent.point)&&console.warn("what is that, a collapsed segment?",me),Vt.contourId=Kt.contourId=me.contourId,Xe(Kt,me.otherEvent)>0&&(me.otherEvent.left=!0,Kt.left=!1),me.otherEvent.otherEvent=Kt,me.otherEvent=Vt,nt.push(Kt),nt.push(Vt),nt}function Ut(me,ge){return me[0]*ge[1]-me[1]*ge[0]}function Rt(me,ge){return me[0]*ge[0]+me[1]*ge[1]}function gr(me,ge,nt){var Vt=(function(fn,dn,en,Qn,zi){var Yr=[dn[0]-fn[0],dn[1]-fn[1]],_i=[Qn[0]-en[0],Qn[1]-en[1]];function si(Pn,pi,Fi){return[Pn[0]+pi*Fi[0],Pn[1]+pi*Fi[1]]}var Hn=[en[0]-fn[0],en[1]-fn[1]],ki=Ut(Yr,_i),di=ki*ki,li=Rt(Yr,Yr);if(di>0){var hi=Ut(Hn,_i)/ki;if(hi<0||hi>1)return null;var Kn=Ut(Hn,Yr)/ki;return Kn<0||Kn>1?null:hi===0||hi===1?[si(fn,hi,Yr)]:Kn===0||Kn===1?[si(en,Kn,_i)]:[si(fn,hi,Yr)]}if((di=(ki=Ut(Hn,Yr))*ki)>0)return null;var tn=Rt(Yr,Hn)/li,ei=tn+Rt(Yr,_i)/li,Di=Math.min(tn,ei),Or=Math.max(tn,ei);return Di<=1&&Or>=0?Di===1?[si(fn,Di>0?Di:0,Yr)]:Or===0?[si(fn,Or<1?Or:1,Yr)]:[si(fn,Di>0?Di:0,Yr),si(fn,Or<1?Or:1,Yr)]:null})(me.point,me.otherEvent.point,ge.point,ge.otherEvent.point),Kt=Vt?Vt.length:0;if(Kt===0||Kt===1&&(fe(me.point,ge.point)||fe(me.otherEvent.point,ge.otherEvent.point))||Kt===2&&me.isSubject===ge.isSubject)return 0;if(Kt===1)return fe(me.point,Vt[0])||fe(me.otherEvent.point,Vt[0])||at(me,Vt[0],nt),fe(ge.point,Vt[0])||fe(ge.otherEvent.point,Vt[0])||at(ge,Vt[0],nt),1;var Xt=[],cr=!1,Dr=!1;return fe(me.point,ge.point)?cr=!0:Xe(me,ge)===1?Xt.push(ge,me):Xt.push(me,ge),fe(me.otherEvent.point,ge.otherEvent.point)?Dr=!0:Xe(me.otherEvent,ge.otherEvent)===1?Xt.push(ge.otherEvent,me.otherEvent):Xt.push(me.otherEvent,ge.otherEvent),cr&&Dr||cr?(ge.type=A,me.type=ge.inOut===me.inOut?M:O,cr&&!Dr&&at(Xt[1].otherEvent,Xt[0].point,nt),2):Dr?(at(Xt[0],Xt[1].point,nt),3):Xt[0]!==Xt[3].otherEvent?(at(Xt[0],Xt[1].point,nt),at(Xt[1],Xt[2].point,nt),3):(at(Xt[0],Xt[1].point,nt),at(Xt[3].otherEvent,Xt[2].point,nt),3)}function ar(me,ge){if(me===ge)return 0;if(Ot(me.point,me.otherEvent.point,ge.point)!==0||Ot(me.point,me.otherEvent.point,ge.otherEvent.point)!==0)return fe(me.point,ge.point)?me.isBelow(ge.otherEvent.point)?-1:1:me.point[0]===ge.point[0]?me.point[1]<ge.point[1]?-1:1:Xe(me,ge)===1?ge.isAbove(me.point)?-1:1:me.isBelow(ge.point)?-1:1;if(me.isSubject!==ge.isSubject)return me.isSubject?-1:1;var nt=me.point,Vt=ge.point;return nt[0]===Vt[0]&&nt[1]===Vt[1]?(nt=me.otherEvent.point)[0]===(Vt=ge.otherEvent.point)[0]&&nt[1]===Vt[1]?0:me.contourId>ge.contourId?1:-1:Xe(me,ge)===1?1:-1}var At=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function zt(me,ge,nt,Vt){var Kt,Xt=me+1,cr=ge[me].point,Dr=ge.length;for(Xt<Dr&&(Kt=ge[Xt].point);Xt<Dr&&Kt[0]===cr[0]&&Kt[1]===cr[1];){if(!nt[Xt])return Xt;++Xt<Dr&&(Kt=ge[Xt].point)}for(Xt=me-1;nt[Xt]&&Xt>Vt;)Xt--;return Xt}At.prototype.isExterior=function(){return this.holeOf==null};var hr=Gt,er=Gt;function Gt(me,ge){if(!(this instanceof Gt))return new Gt(me,ge);if(this.data=me||[],this.length=this.data.length,this.compare=ge||rr,this.length>0)for(var nt=(this.length>>1)-1;nt>=0;nt--)this._down(nt)}function rr(me,ge){return me<ge?-1:me>ge?1:0}Gt.prototype={push:function(me){this.data.push(me),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var me=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),me}},peek:function(){return this.data[0]},_up:function(me){for(var ge=this.data,nt=this.compare,Vt=ge[me];me>0;){var Kt=me-1>>1,Xt=ge[Kt];if(nt(Vt,Xt)>=0)break;ge[me]=Xt,me=Kt}ge[me]=Vt},_down:function(me){for(var ge=this.data,nt=this.compare,Vt=this.length>>1,Kt=ge[me];me<Vt;){var Xt=1+(me<<1),cr=Xt+1,Dr=ge[Xt];if(cr<this.length&&nt(ge[cr],Dr)<0&&(Xt=cr,Dr=ge[cr]),nt(Dr,Kt)>=0)break;ge[me]=Dr,me=Xt}ge[me]=Kt}},hr.default=er;var Pr=Math.max,Fr=Math.min,Zr=0;function qr(me,ge,nt,Vt,Kt,Xt){var cr,Dr,fn,dn,en,Qn;for(cr=0,Dr=me.length-1;cr<Dr;cr++)if(dn=me[cr+1],en=new ue(fn=me[cr],!1,void 0,ge),Qn=new ue(dn,!1,en,ge),en.otherEvent=Qn,fn[0]!==dn[0]||fn[1]!==dn[1]){en.contourId=Qn.contourId=nt,Xt||(en.isExteriorRing=!1,Qn.isExteriorRing=!1),Xe(en,Qn)>0?Qn.left=!0:en.left=!0;var zi=fn[0],Yr=fn[1];Kt[0]=Fr(Kt[0],zi),Kt[1]=Fr(Kt[1],Yr),Kt[2]=Pr(Kt[2],zi),Kt[3]=Pr(Kt[3],Yr),Vt.push(en),Vt.push(Qn)}}var yn=[];function nn(me,ge,nt){typeof me[0][0][0]=="number"&&(me=[me]),typeof ge[0][0][0]=="number"&&(ge=[ge]);var Vt=(function(Yr,_i,si){var Hn=null;return Yr.length*_i.length==0&&(si===D?Hn=yn:si===U?Hn=Yr:si!==N&&si!==H||(Hn=Yr.length===0?_i:Yr)),Hn})(me,ge,nt);if(Vt)return Vt===yn?null:Vt;var Kt=[1/0,1/0,-1/0,-1/0],Xt=[1/0,1/0,-1/0,-1/0],cr=(function(Yr,_i,si,Hn,ki){var di,li,hi,Kn,tn,ei,Di=new hr(null,Xe);for(hi=0,Kn=Yr.length;hi<Kn;hi++)for(tn=0,ei=(di=Yr[hi]).length;tn<ei;tn++)(li=tn===0)&&Zr++,qr(di[tn],!0,Zr,Di,si,li);for(hi=0,Kn=_i.length;hi<Kn;hi++)for(tn=0,ei=(di=_i[hi]).length;tn<ei;tn++)li=tn===0,ki===U&&(li=!1),li&&Zr++,qr(di[tn],!1,Zr,Di,Hn,li);return Di})(me,ge,Kt,Xt,nt);if(Vt=(function(Yr,_i,si,Hn,ki){var di=null;return(si[0]>Hn[2]||Hn[0]>si[2]||si[1]>Hn[3]||Hn[1]>si[3])&&(ki===D?di=yn:ki===U?di=Yr:ki!==N&&ki!==H||(di=Yr.concat(_i))),di})(me,ge,Kt,Xt,nt))return Vt===yn?null:Vt;for(var Dr=(function(Yr){var _i,si,Hn=(function(hi){var Kn,tn,ei,Di,Or=[];for(tn=0,ei=hi.length;tn<ei;tn++)((Kn=hi[tn]).left&&Kn.inResult||!Kn.left&&Kn.otherEvent.inResult)&&Or.push(Kn);for(var Pn=!1;!Pn;)for(Pn=!0,tn=0,ei=Or.length;tn<ei;tn++)tn+1<ei&&Xe(Or[tn],Or[tn+1])===1&&(Di=Or[tn],Or[tn]=Or[tn+1],Or[tn+1]=Di,Pn=!1);for(tn=0,ei=Or.length;tn<ei;tn++)(Kn=Or[tn]).otherPos=tn;for(tn=0,ei=Or.length;tn<ei;tn++)(Kn=Or[tn]).left||(Di=Kn.otherPos,Kn.otherPos=Kn.otherEvent.otherPos,Kn.otherEvent.otherPos=Di);return Or})(Yr),ki={},di=[],li=function(){if(!ki[_i]){var hi=di.length,Kn=(function(Or,Pn,pi){var Fi=new At;if(Or.prevInResult!=null){var yi=Or.prevInResult,po=yi.outputContourId;if(yi.resultTransition>0){var ri=Pn[po];if(ri.holeOf!=null){var co=ri.holeOf;Pn[co].holeIds.push(pi),Fi.holeOf=co,Fi.depth=Pn[po].depth}else Pn[po].holeIds.push(pi),Fi.holeOf=po,Fi.depth=Pn[po].depth+1}else Fi.holeOf=null,Fi.depth=Pn[po].depth}else Fi.holeOf=null,Fi.depth=0;return Fi})(Hn[_i],di,hi),tn=function(Or){ki[Or]=!0,Or<Hn.length&&Hn[Or]&&(Hn[Or].outputContourId=hi)},ei=_i,Di=_i;for(Kn.points.push(Hn[_i].point);tn(ei),tn(ei=Hn[ei].otherPos),Kn.points.push(Hn[ei].point),!((ei=zt(ei,Hn,ki,Di))==Di||ei>=Hn.length)&&Hn[ei];);di.push(Kn)}};for(_i=0,si=Hn.length;_i<si;_i++)li();return di})((function(Yr,_i,si,Hn,ki,di){for(var li,hi,Kn,tn=new h(ar),ei=[],Di=Math.min(Hn[2],ki[2]);Yr.length!==0;){var Or=Yr.pop();if(ei.push(Or),di===D&&Or.point[0]>Di||di===U&&Or.point[0]>Hn[2])break;if(Or.left){hi=li=tn.insert(Or),li=li!==(Kn=tn.minNode())?tn.prev(li):null,hi=tn.next(hi);var Pn=li?li.key:null;if(X(Or,Pn,di),hi&&gr(Or,hi.key,Yr)===2&&(X(Or,Pn,di),X(hi.key,Or,di)),li&&gr(li.key,Or,Yr)===2){var pi=li;X(Pn,(pi=pi!==Kn?tn.prev(pi):null)?pi.key:null,di),X(Or,Pn,di)}}else hi=li=tn.find(Or=Or.otherEvent),li&&hi&&(li=li!==Kn?tn.prev(li):null,hi=tn.next(hi),tn.remove(Or),hi&&li&&gr(li.key,hi.key,Yr))}return ei})(cr,0,0,Kt,Xt,nt)),fn=[],dn=0;dn<Dr.length;dn++){var en=Dr[dn];if(en.isExterior()){for(var Qn=[en.points],zi=0;zi<en.holeIds.length;zi++)Qn.push(Dr[en.holeIds[zi]].points);fn.push(Qn)}}return fn}var fi={UNION:N,DIFFERENCE:U,INTERSECTION:D,XOR:H};i.diff=function(me,ge){return nn(me,ge,U)},i.intersection=function(me,ge){return nn(me,ge,D)},i.operations=fi,i.union=function(me,ge){return nn(me,ge,N)},i.xor=function(me,ge){return nn(me,ge,H)},Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,tP.exports)),tP.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Qy(o,e,i,u){const h=[],p=u===0?(m,b,T,A,M,O)=>{m.push(new Ct(O,T+(O-b)/(A-b)*(M-T)))}:(m,b,T,A,M,O)=>{m.push(new Ct(b+(O-T)/(M-T)*(A-b),O))};for(const m of o){const b=[];for(const T of m){if(T.length<=2)continue;const A=[];for(let D=0;D<T.length-1;D++){const N=T[D].x,U=T[D].y,H=T[D+1].x,X=T[D+1].y,te=u===0?N:U,ue=u===0?H:X;te<e?ue>e&&p(A,N,U,H,X,e):te>i?ue<i&&p(A,N,U,H,X,i):A.push(T[D]),ue<e&&te>=e&&p(A,N,U,H,X,e),ue>i&&te<=i&&p(A,N,U,H,X,i)}let M=T[T.length-1];const O=u===0?M.x:M.y;O>=e&&O<=i&&A.push(M),A.length&&(M=A[A.length-1],A[0].x===M.x&&A[0].y===M.y||A.push(A[0]),b.push(A))}b.length&&h.push(b)}return h}function Ij(o,e){const i=Wx(o),u=Wx([e]),h=rP.intersection(i,u);return h==null?[]:nP(h)}function Cj(o,e){let u=Wx(o,65536);for(;e.valid();e.next()){const[h,p]=e.get(),m=h.x*65536,b=h.y*65536,T=p.x*65536,A=p.y*65536,M=T-m,O=A-b,D=Math.hypot(M,O),N=Math.trunc(O/D*3),U=-Math.trunc(M/D*3);u=rP.diff(u,[[[m,b],[T,A],[T+N,A+U],[m+N,b+U],[m,b]]])}return nP(u,1/65536)}function Wx(o,e=1){return[o.map((i=>i.map((u=>[u.x*e,u.y*e]))))]}function nP(o,e=1){return o.map((i=>i.map(((u,h)=>{const p=u.map((m=>new Ct(m[0]*e,m[1]*e).round()));return h>0&&p.reverse(),p}))))}class Zx{constructor(e,i){this.layoutVertexArray=new pa,this.indexArray=new ai,this.lineIndexArray=new Vs,this.triangleSegments=new wi,this.lineSegments=new wi,this.programConfigurations=new Wa(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Ic)}update(e,i,u,h,p,m,b,T){this.programConfigurations.updatePaintArrays(e,i,p,u,h,m,b,T)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dj.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,pj.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,u,h,p,m,b){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,u,h,p,m,void 0,b)}}class Xx{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Zx(e,!1),this.elevationBufferData=new Zx(e,!0),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,u,h){this.hasPattern=Gx("fill",this.layers,this.pixelRatio,i);const p=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:b,id:T,index:A,sourceLayerIndex:M}of e){const O=this.layers[0]._featureFilter.needGeometry,D=tt(b,O);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{worldview:this.worldview}),D,u))continue;const N=p?p.evaluate(D,{},u,i.availableImages):void 0,U={id:T,properties:b.properties,type:b.type,sourceLayerIndex:M,index:A,geometry:O?D.geometry:Re(b,u,h),patterns:{},sortKey:N};m.push(U)}p&&m.sort(((b,T)=>b.sortKey-T.sortKey));for(const b of m){const{geometry:T,index:A,sourceLayerIndex:M}=b;if(this.hasPattern){const O=Hx("fill",this.layers,b,this.zoom,this.pixelRatio,i);this.patternFeatures.push(O)}else this.addFeature(b,T,A,u,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[A].feature,T,A,M,this.index)}}update(e,i,u,h,p,m,b){this.bufferData.update(e,i,u,h,p,m,b,this.worldview),this.elevationBufferData.update(e,i,u,h,p,m,b,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,u,h,p,m,b,this.worldview)}addFeatures(e,i,u,h,p,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,i,u,h,m,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,u,h,p,m=[],b,T){const A=s_(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,A,h,u,T):this.addGeometry(A,this.bufferData),this.bufferData.populatePaintArrays(e,u,p,m,h,b,this.worldview),this.elevationBufferData.populatePaintArrays(e,u,p,m,h,b,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,u,h,p){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,u,h,p,this.worldview))}addElevatedRoadFeature(e,i,u,h,p){const m=new Array,b=Si.getElevationFeature(e,p);if(!b)return void this.addGeometry(i,this.bufferData);{const A=this.clipPolygonsToTile(i,1);A.length>0&&m.push({polygons:A,elevationFeature:b,elevationTileID:u})}const T={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},u),featureIndex:h};for(const A of m)if(A.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Ws(A.elevationTileID,this.layers,this.zoom,this.lut));const O=A.elevationFeature.isTunnel();let D=0;e.properties.hasOwnProperty(dr)&&(D=+e.properties[dr]);for(const N of A.polygons)this.elevatedStructures.addPortalCandidates(A.elevationFeature.id,N,O,A.elevationFeature,D)}A.elevationFeature.constantHeight==null&&(A.polygons=this.prepareElevatedPolygons(A.polygons,A.elevationFeature,A.elevationTileID));const M=new xn(u,A.elevationTileID);this.addElevatedGeometry(A.polygons,M,A.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,T)}}addElevatedGeometry(e,i,u,h,p,m){const b={elevation:u,elevationSampler:i,bias:h,index:p,featureInfo:m},[T,A]=this.addGeometry(e,this.elevationBufferData,b);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:T,max:A}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,T),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,A))}addGeometry(e,i,u){let h=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,m=null;u&&(m=u.elevationSampler.constantElevation(u.elevation,u.bias),m!=null&&(h=m,p=m));const b=(T,A,M)=>{if(u!=null)if(A.push(T),m!=null)i.elevatedLayoutVertexArray.emplaceBack(m),M.push(m);else{const O=u.elevationSampler.pointElevation(T,u.elevation,u.bias);i.elevatedLayoutVertexArray.emplaceBack(O),M.push(O),h=Math.min(h,O),p=Math.max(p,O)}};for(const T of e){let A=0;for(const le of T)A+=le.length;const M=i.triangleSegments.prepareSegment(A,i.layoutVertexArray,i.indexArray),O=M.vertexLength,D=[],N=[],U=[],H=[],X=[],te=i.layoutVertexArray.length;for(const le of T){if(le.length===0)continue;le!==T[0]&&N.push(D.length/2);const fe=i.lineSegments.prepareSegment(le.length,i.layoutVertexArray,i.lineIndexArray),De=fe.vertexLength;u&&X.push(i.layoutVertexArray.length-te),b(le[0],U,H),i.layoutVertexArray.emplaceBack(le[0].x,le[0].y),i.lineIndexArray.emplaceBack(De+le.length-1,De),D.push(le[0].x),D.push(le[0].y);for(let Ie=1;Ie<le.length;Ie++)b(le[Ie],U,H),i.layoutVertexArray.emplaceBack(le[Ie].x,le[Ie].y),i.lineIndexArray.emplaceBack(De+Ie-1,De+Ie),D.push(le[Ie].x),D.push(le[Ie].y);fe.vertexLength+=le.length,fe.primitiveLength+=le.length}const ue=Nm(D,N);for(let le=0;le<ue.length;le+=3)i.indexArray.emplaceBack(O+ue[le],O+ue[le+1],O+ue[le+2]);if(ue.length>0&&u&&this.elevationMode==="hd-road-base"){const le=u.elevation.isTunnel(),fe=u.elevation.safeArea,De=this.elevatedStructures.addVertices(U,H);this.elevatedStructures.addTriangles(ue,De,le);const Ie=X.length;if(Ie>0){for(let Ce=0;Ce<Ie-1;Ce++)this.elevatedStructures.addRenderableRing(u.index,X[Ce]+De,X[Ce+1]-X[Ce],le,fe,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,X[Ie-1]+De,U.length-X[Ie-1],le,fe,u.featureInfo)}}M.vertexLength+=A,M.primitiveLength+=ue.length/3}return[h,p]}prepareElevatedPolygons(e,i,u){const h=1/Ee(u),p=[];for(const m of e){const b=Cj(m,new Gn(i,h));p.push(...b)}return p}clipPolygonsToTile(e,i){const u=-i,h=-i,p=$t+i,m=$t+i;let b=0;const T=[],A=[];for(;b<e.length;b++){const D=e[b],N=yp(D);(N.min.x>=u&&N.max.x<=p&&N.min.y>=h&&N.max.y<=m?T:A).push(D)}if(T.length===e.length)return e;const M=[new Ct(u,h),new Ct(p,h),new Ct(p,m),new Ct(u,m),new Ct(u,h)],O=T;for(const D of A)O.push(...Ij(D,M));return O}}let iP,oP,aP,sP;nr(Xx,"FillBucket",{omit:["layers","patternFeatures"]}),nr(Zx,"FillBufferData"),nr(Ws,"ElevatedStructures");class ev{constructor(e,i,u,h){if(this.triangleCount=i.length/3,this.min=new Ct(0,0),this.max=new Ct(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[p,m]=[e[0].clone(),e[0].clone()];for(let O=1;O<e.length;++O){const D=e[O];p.x=Math.min(p.x,D.x),p.y=Math.min(p.y,D.y),m.x=Math.max(m.x,D.x),m.y=Math.max(m.y,D.y)}if(h){const O=Math.ceil(Math.max(m.x-p.x,m.y-p.y)/h);u=Math.max(u,O)}if(u===0)return;this.min=p,this.max=m;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const T=Math.max(b.x,b.y)/u;this.cellsX=Math.max(1,Math.ceil(b.x/T)),this.cellsY=Math.max(1,Math.ceil(b.y/T)),this.xScale=1/T,this.yScale=1/T;const A=[];for(let O=0;O<this.triangleCount;O++){const D=e[i[3*O+0]].sub(this.min),N=e[i[3*O+1]].sub(this.min),U=e[i[3*O+2]].sub(this.min),H=Ch(Math.floor(Math.min(D.x,N.x,U.x)),this.xScale,this.cellsX),X=Ch(Math.floor(Math.max(D.x,N.x,U.x)),this.xScale,this.cellsX),te=Ch(Math.floor(Math.min(D.y,N.y,U.y)),this.yScale,this.cellsY),ue=Ch(Math.floor(Math.max(D.y,N.y,U.y)),this.yScale,this.cellsY),le=new Ct(0,0),fe=new Ct(0,0),De=new Ct(0,0),Ie=new Ct(0,0);for(let Ce=te;Ce<=ue;++Ce){le.y=fe.y=Ce*T,De.y=Ie.y=(Ce+1)*T;for(let Be=H;Be<=X;++Be)le.x=De.x=Be*T,fe.x=Ie.x=(Be+1)*T,(Qi(D,N,U,le,fe,Ie)||Qi(D,N,U,le,Ie,De))&&A.push({cellIdx:Ce*this.cellsX+Be,triIdx:O})}}if(A.length===0)return;A.sort(((O,D)=>O.cellIdx-D.cellIdx||O.triIdx-D.triIdx));let M=0;for(;M<A.length;){const O=A[M].cellIdx,D={start:this.payload.length,len:0};for(;M<A.length&&A[M].cellIdx===O;)++D.len,this.payload.push(A[M++].triIdx);this.cells[O]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const u=Ch(e.x-this.min.x,this.xScale,this.cellsX),h=Ch(e.y-this.min.y,this.yScale,this.cellsY),p=this.cells[h*this.cellsX+u];if(p){this._lazyInitLookup();for(let m=0;m<p.len;m++){const b=this.payload[p.start+m],T=Math.floor(b/8),A=1<<b%8;if(!(this.lookup[T]&A)&&(this.lookup[T]|=A,i.push(b),i.length===this.triangleCount))return}}}query(e,i,u){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const h=Ch(e.x-this.min.x,this.xScale,this.cellsX),p=Ch(i.x-this.min.x,this.xScale,this.cellsX),m=Ch(e.y-this.min.y,this.yScale,this.cellsY),b=Ch(i.y-this.min.y,this.yScale,this.cellsY);for(let T=m;T<=b;T++)for(let A=h;A<=p;A++){const M=this.cells[T*this.cellsX+A];if(M)for(let O=0;O<M.len;O++){const D=this.payload[M.start+O],N=Math.floor(D/8),U=1<<D%8;if(!(this.lookup[N]&U)&&(this.lookup[N]|=U,u.push(D),u.length===this.triangleCount))return}}}}function Ch(o,e,i){return Math.max(0,Math.min(i-1,Math.floor(o*e)))}nr(ev,"TriangleGridIndex");class lP{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const u of this.footprints)i.push({footprint:u,id:e})}populate(e,i,u,h){const p=[];for(const{feature:m,id:b,index:T,sourceLayerIndex:A}of e){const M=this.layers[0]._featureFilter.needGeometry,O=tt(m,M);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{worldview:this.worldview}),O,u))continue;const D={id:b,properties:m.properties,type:m.type,sourceLayerIndex:A,index:T,geometry:M?O.geometry:Re(m,u,h),patterns:{}};p.push(D)}for(const m of p){const{geometry:b,index:T,sourceLayerIndex:A}=m;this.addFeature(m,b,T,u,{},i.availableImages,i.brightness),i.featureIndex.insert(e[T].feature,b,T,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,u,h,p,m,b){}destroy(){}addFeature(e,i,u,h,p,m=[],b){for(const T of s_(i,2)){const A=[],M=[],O=[],D=new Ct(1/0,1/0),N=new Ct(-1/0,-1/0);for(const X of T)if(X.length!==0){X!==T[0]&&O.push(M.length/2);for(let te=0;te<X.length;te++)M.push(X[te].x),M.push(X[te].y),A.push(X[te]),D.x=Math.min(D.x,X[te].x),D.y=Math.min(D.y,X[te].y),N.x=Math.max(N.x,X[te].x),N.y=Math.max(N.y,X[te].y)}const U=Nm(M,O),H=new ev(A,U,8,256);this.footprints.push({vertices:A,indices:U,grid:H,min:D,max:N})}}}nr(lP,"ClipBucket",{omit:["layers"]});const Mj=mn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Oj=mn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Rj=mn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),kj=mn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Dj=mn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),zj=mn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Lj}=Mj,l_=Number.MAX_SAFE_INTEGER,uP=l_-1;function cP(o,e,i,u){return o.order<e||o.order===l_||!(o.clipMask&i)||(function(h,p){return p.length!==0&&p.find((m=>m===h))===void 0})(u,o.clipScope)}function tv(o,e){return o.x-e.x||o.y-e.y}function hP(o,e){return tv(o.min,e.min)===0&&tv(o.max,e.max)===0}function Kx(o,e){return!(o.min.x>e.max.x||o.max.x<e.min.x||o.min.y>e.max.y||o.max.y<e.min.y)}function rv(o,e){if(o.length!==e.length)return!1;for(let i=0;i<o.length;i++)if(o[i].sourceId!==e[i].sourceId||!hP(o[i],e[i])||o[i].order!==e[i].order||o[i].clipMask!==e[i].clipMask||!il(o[i].clipScope,e[i].clipScope))return!1;return!0}function fP(o,e,i){const u=1/$t,h=1/(1<<i.canonical.z),p=(e.x*u+i.canonical.x)*h+i.wrap,m=(e.y*u+i.canonical.y)*h;return{min:new Ct((o.x*u+i.canonical.x)*h+i.wrap,(o.y*u+i.canonical.y)*h),max:new Ct(p,m)}}function Fj(o,e,i){const u=1<<i.canonical.z,h=((e.x-i.wrap)*u-i.canonical.x)*$t,p=(e.y*u-i.canonical.y)*$t;return{min:new Ct(((o.x-i.wrap)*u-i.canonical.x)*$t,(o.y*u-i.canonical.y)*$t),max:new Ct(h,p)}}function Yx(o,e,i,u,h,p,m){const b=o.indices,T=o.vertices,A=[];for(let M=u;M<u+h;M+=3){const O=e[i[M+0]+p],D=e[i[M+1]+p],N=e[i[M+2]+p],U=Math.min(O.x,D.x,N.x),H=Math.max(O.x,D.x,N.x),X=Math.min(O.y,D.y,N.y),te=Math.max(O.y,D.y,N.y);A.length=0,o.grid.query(new Ct(U,X),new Ct(H,te),A);for(let ue=0;ue<A.length;ue++){const le=A[ue];if(Qi(T[b[3*le+0]],T[b[3*le+1]],T[b[3*le+2]],O,D,N,m))return!0}}return!1}function dP(o,e,i,u){if(!o||!i)return!1;let h=o.vertices;if(!e.canonical.equals(u.canonical)||e.wrap!==u.wrap){if(i.vertices.length<o.vertices.length)return dP(i,u,o,e);const p=e.canonical,m=u.canonical,b=Math.pow(2,m.z-p.z);h=o.vertices.map((T=>new Ct((T.x+p.x*$t)*b-m.x*$t,(T.y+p.y*$t)*b-m.y*$t)))}return Yx(i,h,o.indices,0,o.indices.length,0,0)}function pP(o,e,i,u){const h=Math.pow(2,u.z-i.z);return new Ct((o+i.x*$t)*h-u.x*$t,(e+i.y*$t)*h-u.y*$t)}function Jx(o,e){const i=[];e.grid.queryPoint(o,i);const u=e.indices,h=e.vertices;for(let p=0;p<i.length;p++){const m=i[p];if(Ko([h[u[3*m+0]],h[u[3*m+1]],h[u[3*m+2]]],o))return!0}return!1}const Qx=[new Ct(0,0),new Ct($t,0),new Ct($t,$t),new Ct(0,$t)];function mP(o,e){const i=[];let u=[];if(!e||o.length<2)return[o];if(o.length===2)return Oi(o[0],o[1],Qx)?[o]:[];for(let h=0;h<o.length+2;h++){const p=o[h%o.length],m=o[(h+1)%o.length],b=Oi(h===0?o[o.length-1]:o[(h-1)%o.length],p,Qx),T=Oi(p,m,Qx),A=b||T;A&&u.push(p),A&&T||u.length>0&&(u.length>1&&i.push(u),u=[])}return u.length>1&&i.push(u),i}const eb=Ye.types,Bj=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Nj=["fill-extrusion-flood-light-ground-radius"],jj=Math.pow(2,13),Uj=Math.pow(2,15)-1,gP=new Ct(0,1),Yd=2147483648;function u_(o,e,i,u,h,p,m,b){o.emplaceBack((e<<1)+m,(i<<1)+p,(Math.floor(u*jj)<<1)+h,Math.round(b))}function c_(o,e,i){o.emplaceBack(e.x*$t,e.y*$t,i?1:0)}function nv(o,e,i,u,h,p){o.emplaceBack(e.x,e.y,(i.x<<1)+u,(i.y<<1)+h,p)}function h_(o,e,i){o.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class _P{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class yP{constructor(){this.centroidXY=new Ct(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ct(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ct(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Ct(this.max.x-this.min.x,this.max.y-this.min.y)}}class vP{constructor(){this.acc=new Ct(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,u){this.accCount++,this.acc._add(i);let h=!!this.borders;i.x<e.min.x?(e.min.x=i.x,h=!0):i.x>e.max.x&&(e.max.x=i.x,h=!0),i.y<e.min.y?(e.min.y=i.y,h=!0):i.y>e.max.y&&(e.max.y=i.y,h=!0),((i.x===0||i.x===$t)&&i.x===u.x)!=((i.y===0||i.y===$t)&&i.y===u.y)&&this.processBorderOverlap(i,u),h&&this.checkBorderIntersection(i,u)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,wr(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>$t!=e.x>$t&&this.addBorderIntersection(1,wr(i.y,e.y,($t-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,wr(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>$t!=e.y>$t&&this.addBorderIntersection(3,wr(i.x,e.x,($t-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[e];i<u[0]&&(u[0]=i),i>u[1]&&(u[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const u=e.x===0?0:1;this.addBorderIntersection(u,i.y),this.addBorderIntersection(u,e.y)}else{const u=e.y===0?2:3;this.addBorderIntersection(u,i.x),this.addBorderIntersection(u,e.x)}}centroid(){return this.accCount===0?new Ct(0,0):new Ct(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,i)=>e+ +(i[0]!==Number.MAX_VALUE)),0):0}}function xP(o,e){const i=o.add(e)._unit(),u=ve(o.x*i.x+o.y*i.y,-1,1);var h,p,m;return h=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(h)))/4*Uj*((p=o).x*(m=e).y-p.y*m.x<0?-1:1)}const Vj=[o=>o.x<0,o=>o.x>$t,o=>o.y<0,o=>o.y>$t];function $j(o,e,i,u){const h=[4];if(u===0)return h;i._mult(u);const p=o.sub(i),m=e.sub(i),b=[o,e,p,m];for(let T=0;T<4;T++)for(const A of b)if(Vj[T](A)){h.push(T);break}return h}class tb{constructor(e){this.vertexArray=new Tf,this.indexArray=new ai,this.programConfigurations=new Wa(e.layers,{zoom:e.zoom,lut:e.lut},(i=>Nj.includes(i))),this._segments=new wi,this.hiddenByLandmarkVertexArray=new Pf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new wi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,u,h=!1){const p=e.length;if(p>2){let m=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let T;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const A=e[0],M=e[1];T=xP(A.sub(e[p-1])._perp()._unit(),M.sub(A)._perp()._unit())}for(let A=0;A<p;A++){const M=A===p-1?0:A+1,O=e[A],D=e[M],N=e[M===p-1?0:M+1],U=D.sub(O)._perp()._unit(),H=xP(U,N.sub(D)._perp()._unit()),X=T,te=H;if(rb(O,D,i)||h&&SP(O,i)&&SP(D,i)){T=H;continue}const ue=b.vertexLength;nv(this.vertexArray,O,D,1,1,X),nv(this.vertexArray,O,D,1,0,X),nv(this.vertexArray,O,D,0,1,te),nv(this.vertexArray,O,D,0,0,te),b.vertexLength+=4;const le=$j(O,D,U,u);for(const fe of le)this._segmentToGroundQuads[m].push({id:ue,region:fe}),this._segmentToRegionTriCounts[m][fe]+=2,b.primitiveLength+=2;T=H}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let u=0;u<i;u++)this._segmentToGroundQuads[u].sort(((h,p)=>h.region-p.region));for(let u=0;u<i;u++){const h=this._segmentToGroundQuads[u],p=e[u],m=this._segmentToRegionTriCounts[u];m.reduce(((T,A)=>T+A),0);let b=0;for(let T=0;T<=4;T++){const A=m[T];if(A!==0){let M=this.regionSegments[T];M||(M=this.regionSegments[T]=new wi);const O={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+b,vertexLength:p.vertexLength,primitiveLength:A};M.get().push(O)}b+=A}for(let T=0;T<h.length;T++){const A=h[T].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,u,h,p,m,b){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,u,h,p,m,void 0,b)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Oj.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,u,h,p,m,b,T){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,u,h,p,m,b,T)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Yd))}updateHiddenByLandmarkRange(e,i,u){if(!this.hasData())return;const h=i+e;if(i!==0){for(let p=e;p<h;++p)this.hiddenByLandmarkVertexArray.emplace(p,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Dj.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class iv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ai,this.footprintVertices=new pa,this.footprintSegments=[],this.layoutVertexArray=new Pc,this.centroidVertexArray=new Om,this.wallVertexArray=new Ud,this.indexArray=new ai,this.programConfigurations=new Wa(e.layers,{zoom:e.zoom,lut:e.lut},(i=>Bj.includes(i))),this.segments=new wi,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.groundEffect=new tb(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,u,h){this.features=[],this.hasPattern=Gx("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ee(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:m,index:b,sourceLayerIndex:T}of e){const A=this.layers[0]._featureFilter.needGeometry,M=tt(p,A);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{worldview:this.worldview}),M,u))continue;const O={id:m,sourceLayerIndex:T,index:b,geometry:A?M.geometry:Re(p,u,h),properties:p.properties,type:p.type,patterns:{}},D=this.layoutVertexArray.length,N=eb[O.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:p.id,feature:Hx("fill-extrusion",this.layers,O,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const U of O.geometry)for(const H of mP(U,N))this.addFeature(p.id,O,[H],b,u,{},i.availableImages,h,i.brightness);else this.addFeature(p.id,O,O.geometry,b,u,{},i.availableImages,h,i.brightness);i.featureIndex.insert(p,O.geometry,b,T,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,u,h,p,m){for(const{featureId:b,feature:T}of this.features){const A=eb[T.type]==="Polygon",{geometry:M}=T;if(this.wallMode)for(const O of M)for(const D of mP(O,A))this.addFeature(b,T,[D],T.index,i,u,h,p,m);else this.addFeature(b,T,M,T.index,i,u,h,p,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,u,h,p,m,b){this.programConfigurations.updatePaintArrays(e,i,p,u,h,m,b,this.worldview),this.groundEffect.update(e,i,p,u,h,m,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lj),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,kj.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,zj.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Rj.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,u,h,p,m,b,T,A){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,O=[new Ct(0,0),new Ct($t,$t)],D=T.projection,N=D.name==="globe",U=this.wallMode||eb[i.type]==="Polygon",H=new vP;H.centroidDataIndex=this.centroidData.length;const X=new yP;X.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(X.buildingId=i.properties.building_id);const te=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},p)<=0,ue=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},p);let le;if(X.height=ue,X.vertexArrayOffset=this.layoutVertexArray.length,X.groundVertexArrayOffset=this.groundEffect.vertexArray.length,N&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Od),this.wallMode){if(N)return void hn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;le=(function(Ge){const ft=Ge[0].x===Ge[Ge.length-1].x&&Ge[0].y===Ge[Ge.length-1].y;(function(zt){let hr=0;const er=zt.length;for(let Gt=0;Gt<er;Gt++)hr+=(zt[(Gt+1)%er].x-zt[Gt].x)*(zt[(Gt+1)%er].y+zt[Gt].y);return hr>=0})(Ge)||(Ge=Ge.reverse());const _t={geometry:[],joinNormals:[],indices:[]},Mt=[],Ft=[],ot=[];let Ot=Ge.length;for(;Ot>=2&&Ge[Ot-1].equals(Ge[Ot-2]);)Ot--;if(Ot<(ft?3:2))return _t;let Xe,at,Ut,Rt,gr,ar=0;for(;ar<Ot-1&&Ge[ar].equals(Ge[ar+1]);)ar++;ft&&(Xe=Ge[Ot-2],gr=Ge[ar].sub(Xe)._unit()._perp());for(let zt=ar;zt<Ot;zt++){if(Ut=zt===Ot-1?ft?Ge[ar+1]:void 0:Ge[zt+1],Ut&&Ge[zt].equals(Ut))continue;gr&&(Rt=gr),Xe&&(at=Xe),Xe=Ge[zt],gr=Ut?Ut.sub(Xe)._unit()._perp():Rt,Rt=Rt||gr;let hr=Rt.add(gr);hr.x===0&&hr.y===0||hr._unit();const er=hr.x*gr.x+hr.y*gr.y,Gt=er!==0?1/er:1/0,rr=Rt.x*gr.y-Rt.y*gr.x>0;let Pr="miter";const Fr=2;Pr==="miter"&&Gt>Fr&&(Pr="bevel"),Pr==="bevel"&&(Gt>100&&(Pr="flipbevel"),Gt<Fr&&(Pr="miter"));const Zr=(qr,yn,nn,fi)=>{const me=new Ct(qr.x,qr.y),ge=new Ct(qr.x,qr.y);me.x+=yn.x*fi,me.y+=yn.y*fi,ge.x-=yn.x*Math.max(nn,1),ge.y-=yn.y*Math.max(nn,1),ot.push(yn),Mt.push(me),Ft.push(ge)};if(Pr==="miter")hr._mult(Gt),Zr(Xe,hr,0,0);else if(Pr==="flipbevel")hr=gr.mult(-1),Zr(Xe,hr,0,0),Zr(Xe,hr.mult(-1),0,0);else{const qr=-Math.sqrt(Gt*Gt-1),yn=rr?qr:0,nn=rr?0:qr;at&&Zr(Xe,Rt,yn,nn),Ut&&Zr(Xe,gr,yn,nn)}}_t.geometry=[...Mt,...Ft.reverse(),Mt[0]],_t.joinNormals=[...ot,...ot.reverse(),ot[ot.length-1]];const At=_t.geometry.length-1;for(let zt=0;zt<At/2;zt++)if(zt+1<At/2){let hr=zt,er=zt+1,Gt=At-1-zt,rr=At-2-zt;hr=hr===0?At-1:hr-1,er=er===0?At-1:er-1,Gt=Gt===0?At-1:Gt-1,rr=rr===0?At-1:rr-1,_t.indices.push(Gt),_t.indices.push(er),_t.indices.push(hr),_t.indices.push(Gt),_t.indices.push(rr),_t.indices.push(er)}return _t})(u[0]),u=[le.geometry]}const fe=(Ge,ft)=>Ge<(ft.length-1)/2||Ge===ft.length-1,De=this.wallMode?[u]:s_(u,500);for(let Ge=De.length-1;Ge>=0;Ge--){const ft=De[Ge];(ft.length===0||(Ie=ft[0]).every((jt=>jt.x<=0))||Ie.every((jt=>jt.x>=$t))||Ie.every((jt=>jt.y<=0))||Ie.every((jt=>jt.y>=$t)))&&De.splice(Ge,1)}var Ie;let Ce;if(N)Ce=PP(De,O,p);else{Ce=[];for(const Ge of De)Ce.push({polygon:Ge,bounds:O})}const Be=U?this.edgeRadius:0,je=Be>0&&this.zoom<17,st=(Ge,ft)=>{if(Ge.length===0)return!1;const jt=Ge[Ge.length-1];return ft.x===jt.x&&ft.y===jt.y};for(const{polygon:Ge,bounds:ft}of Ce){let jt=0,_t=0;for(const Ot of Ge)U&&!Ot[0].equals(Ot[Ot.length-1])&&Ot.push(Ot[0]),_t+=U?Ot.length-1:Ot.length;const Mt=this.segments.prepareSegment((U?5:4)*_t,this.layoutVertexArray,this.indexArray);X.footprintSegIdx<0&&(X.footprintSegIdx=this.footprintSegments.length),X.polygonSegIdx<0&&(X.polygonSegIdx=this.polygonSegments.length);const Ft={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ot=new _P;if(ot.vertexOffset=this.footprintVertices.length,ot.indexOffset=3*this.footprintIndices.length,ot.ringIndices=[],U){const Ot=[],Xe=[];jt=Mt.vertexLength;for(let Ut=0;Ut<Ge.length;Ut++){const Rt=Ge[Ut];Rt.length&&Ut!==0&&Xe.push(Ot.length/2);const gr=[];let ar,At;ar=Rt[1].sub(Rt[0])._perp()._unit(),ot.ringIndices.push(Rt.length-1);for(let zt=1;zt<Rt.length;zt++){const hr=Rt[zt],er=Rt[zt===Rt.length-1?1:zt+1],Gt=hr.clone();if(Be){At=er.sub(hr)._perp()._unit();const rr=ar.add(At)._unit(),Pr=Be*Math.min(4,1/(ar.x*rr.x+ar.y*rr.y));Gt.x+=Pr*rr.x,Gt.y+=Pr*rr.y,Gt.x=Math.round(Gt.x),Gt.y=Math.round(Gt.y),ar=At}if(!te||Be!==0&&!je||st(gr,Gt)||gr.push(Gt),u_(this.layoutVertexArray,Gt.x,Gt.y,0,0,1,1,0),this.wallMode){const rr=fe(zt,Rt);c_(this.wallVertexArray,le.joinNormals[zt],!rr)}Mt.vertexLength++,this.footprintVertices.emplaceBack(hr.x,hr.y),Ot.push(hr.x,hr.y),N&&h_(this.layoutVertexExtArray,D.projectTilePoint(Gt.x,Gt.y,p),D.upVector(p,Gt.x,Gt.y))}te&&(Be===0||je)&&(gr.length!==0&&st(gr,gr[0])&&gr.pop(),this.groundEffect.addData(gr,ft,M))}const at=this.wallMode?le.indices:Nm(Ot,Xe);for(let Ut=0;Ut<at.length;Ut+=3)this.footprintIndices.emplaceBack(ot.vertexOffset+at[Ut+0],ot.vertexOffset+at[Ut+1],ot.vertexOffset+at[Ut+2]),this.indexArray.emplaceBack(jt+at[Ut],jt+at[Ut+2],jt+at[Ut+1]),Mt.primitiveLength++;ot.indexCount+=at.length,ot.vertexCount+=this.footprintVertices.length-ot.vertexOffset}for(let Ot=0;Ot<Ge.length;Ot++){const Xe=Ge[Ot];H.startRing(X,Xe[0]);let at=Xe.length>4&&TP(Xe[Xe.length-2],Xe[0],Xe[1]),Ut=Be?qj(Xe[Xe.length-2],Xe[0],Xe[1],Be):0;const Rt=[];let gr,ar,At;ar=Xe[1].sub(Xe[0])._perp()._unit();let zt=!0;for(let hr=1,er=0;hr<Xe.length;hr++){let Gt=Xe[hr-1],rr=Xe[hr];const Pr=Xe[hr===Xe.length-1?1:hr+1];if(H.appendEdge(X,rr,Gt),rb(rr,Gt,ft)){Be&&(ar=Pr.sub(rr)._perp()._unit(),zt=!zt);continue}const Fr=rr.sub(Gt)._perp(),Zr=Fr.x/(Math.abs(Fr.x)+Math.abs(Fr.y)),qr=Fr.y>0?1:0,yn=Gt.dist(rr);if(er+yn>32768&&(er=0),Be){At=Pr.sub(rr)._perp()._unit();let ge=wP(Gt,rr,Pr,bP(ar,At),Be);isNaN(ge)&&(ge=0);const nt=rr.sub(Gt)._unit();Gt=Gt.add(nt.mult(Ut))._round(),rr=rr.add(nt.mult(-ge))._round(),Ut=ge,ar=At,te&&this.zoom>=17&&(st(Rt,Gt)||Rt.push(Gt),st(Rt,rr)||Rt.push(rr))}const nn=Mt.vertexLength,fi=Xe.length>4&&TP(Gt,rr,Pr);let me=EP(er,at,zt);if(u_(this.layoutVertexArray,Gt.x,Gt.y,Zr,qr,0,0,me),u_(this.layoutVertexArray,Gt.x,Gt.y,Zr,qr,0,1,me),this.wallMode){const ge=fe(hr-1,Xe),nt=le.joinNormals[hr-1];c_(this.wallVertexArray,nt,ge),c_(this.wallVertexArray,nt,ge)}if(er+=yn,me=EP(er,fi,!zt),at=fi,u_(this.layoutVertexArray,rr.x,rr.y,Zr,qr,0,0,me),u_(this.layoutVertexArray,rr.x,rr.y,Zr,qr,0,1,me),this.wallMode){const ge=fe(hr,Xe),nt=le.joinNormals[hr];c_(this.wallVertexArray,nt,ge),c_(this.wallVertexArray,nt,ge)}if(Mt.vertexLength+=4,this.indexArray.emplaceBack(nn+0,nn+1,nn+2),this.indexArray.emplaceBack(nn+1,nn+3,nn+2),Mt.primitiveLength+=2,Be){const ge=jt+(hr===1?Xe.length-2:hr-2),nt=hr===1?jt:ge+1;if(this.indexArray.emplaceBack(nn+1,ge,nn+3),this.indexArray.emplaceBack(ge,nt,nn+3),Mt.primitiveLength+=2,gr===void 0&&(gr=nn),!rb(Pr,Xe[hr],ft)){const Vt=hr===Xe.length-1?gr:Mt.vertexLength;this.indexArray.emplaceBack(nn+2,nn+3,Vt),this.indexArray.emplaceBack(nn+3,Vt+1,Vt),this.indexArray.emplaceBack(nn+3,nt,Vt+1),Mt.primitiveLength+=3}zt=!zt}if(N){const ge=this.layoutVertexExtArray,nt=D.projectTilePoint(Gt.x,Gt.y,p),Vt=D.projectTilePoint(rr.x,rr.y,p),Kt=D.upVector(p,Gt.x,Gt.y),Xt=D.upVector(p,rr.x,rr.y);h_(ge,nt,Kt),h_(ge,nt,Kt),h_(ge,Vt,Xt),h_(ge,Vt,Xt)}}U&&(jt+=Xe.length-1),te&&Be&&this.zoom>=17&&(Rt.length!==0&&st(Rt,Rt[0])&&Rt.pop(),this.groundEffect.addData(Rt,ft,M,Be>0))}this.footprintSegments.push(ot),Ft.triangleCount=this.indexArray.length-Ft.triangleArrayOffset,this.polygonSegments.push(Ft),++X.footprintSegLen,++X.polygonSegLen}if(X.vertexCount=this.layoutVertexArray.length-X.vertexArrayOffset,X.groundVertexCount=this.groundEffect.vertexArray.length-X.groundVertexArrayOffset,X.vertexCount!==0){if(X.centroidXY=H.borders?gP:this.encodeCentroid(H,X),this.centroidData.push(X),H.borders){this.featuresOnBorder.push(H);const Ge=this.featuresOnBorder.length-1;for(let ft=0;ft<H.borders.length;ft++)H.borders[ft][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ft].push(Ge)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,m,b,p,A,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,h,m,b,p,A,this.worldview),this.maxHeight=Math.max(this.maxHeight,ue)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((i,u)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[u].borders[e][0]))}splitToSubtiles(){const e=[];for(let b=0;b<this.centroidData.length;b++){const T=this.centroidData[b],A=+(T.min.y+T.max.y>$t),M=2*A+(+(T.min.x+T.max.x>$t)^A);for(let O=0;O<T.polygonSegLen;O++){const D=T.polygonSegIdx+O;e.push({centroidIdx:b,subtile:M,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}const i=new ai;e.sort(((b,T)=>b.triangleSegmentIdx===T.triangleSegmentIdx?b.subtile-T.subtile:b.triangleSegmentIdx-T.triangleSegmentIdx));let u=0,h=0,p=0;for(const b of e){if(b.triangleSegmentIdx!==u)break;p++}const m=e.length;for(;h!==e.length;){u=e[h].triangleSegmentIdx;let b=0,T=h,A=h;for(let M=T;M<p&&e[M].subtile===b;M++)A++;for(;T!==p;){const M=e[T];b=M.subtile;const O=this.centroidData[M.centroidIdx].min.clone(),D=this.centroidData[M.centroidIdx].max.clone(),N={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let U=T;U<A;U++){const H=e[U],X=this.polygonSegments[H.polygonSegmentIdx],te=this.centroidData[H.centroidIdx].min,ue=this.centroidData[H.centroidIdx].max,le=this.indexArray.uint16;for(let fe=X.triangleArrayOffset;fe<X.triangleArrayOffset+X.triangleCount;fe++)i.emplaceBack(le[3*fe],le[3*fe+1],le[3*fe+2]);N.primitiveLength+=X.triangleCount,O.x=Math.min(O.x,te.x),O.y=Math.min(O.y,te.y),D.x=Math.max(D.x,ue.x),D.y=Math.max(D.y,ue.y)}N.primitiveLength>0&&this.triangleSubSegments.push({segment:N,min:O,max:D}),T=A;for(let U=T;U<p&&e[U].subtile===e[T].subtile;U++)A++}h=p;for(let M=h;M<m&&e[M].triangleSegmentIdx===e[h].triangleSegmentIdx;M++)p++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,u){const h=new wi;if(this.wallMode){for(const H of this.triangleSubSegments)h.segments.push(H.segment);return h}let p=0,m=0;const b=1<<e.canonical.z;if(i){const H=i.getMinMaxForTile(e);H&&(p=H.min,m=H.max)}m+=this.maxHeight;const T=e.toUnwrapped();let A;const M=[T.canonical.x/b+T.wrap,T.canonical.y/b],O=[(T.canonical.x+1)/b+T.wrap,(T.canonical.y+1)/b],D=(H,X,te)=>[H[0]*(1-te[0])+X[0]*te[0],H[1]*(1-te[1])+X[1]*te[1]],N=[],U=[];for(const H of this.triangleSubSegments){N[0]=H.min.x/$t,N[1]=H.min.y/$t,U[0]=H.max.x/$t,U[1]=H.max.y/$t;const X=D(M,O,N),te=D(M,O,U);if(new Mr([X[0],X[1],p],[te[0],te[1],m]).intersectsPrecise(u)===0){A&&(h.segments.push(A),A=void 0);continue}const ue=H.segment;A&&A.vertexOffset!==ue.vertexOffset&&(h.segments.push(A),A=void 0),A?(A.vertexLength+=ue.vertexLength,A.primitiveLength+=ue.primitiveLength):A={vertexOffset:ue.vertexOffset,primitiveLength:ue.primitiveLength,vertexLength:ue.vertexLength,primitiveOffset:ue.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&h.segments.push(A),h}encodeCentroid(e,i){const u=e.centroid(),h=i.span(),p=Math.min(7,Math.round(h.x*this.tileToMeter/10)),m=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new Ct(ve(u.x,1,$t-1)<<3|p,ve(u.y,1,$t-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new Ct(0,0);const i=e.borders,u=Number.MAX_VALUE;if(i[0][0]!==u||i[1][0]!==u){const h=i[0][0]!==u?0:1;return new Ct(6|(i[0][0]!==u?0:65528),(i[h][0]+i[h][1])/2<<3|6)}{const h=i[2][0]!==u?2:3;return new Ct((i[h][0]+i[h][1])/2<<3|6,6|(i[2][0]!==u?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,u=e.vertexCount+e.vertexArrayOffset,h=e.flags&Yd?gP:e.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==h.y||p!==h.x){for(let m=i;m<u;++m)this.centroidVertexArray.emplace(m,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,u){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped());if(rv(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const p=[];for(const m of this.activeReplacements){if(m.order<u)continue;const b=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));if(m.footprint.buildingId){const T=m.footprint.buildingId;for(const A of this.centroidData)A.buildingId===T&&(A.flags|=Yd)}else for(const T of this.centroidData)if(!(T.flags&Yd||m.min.x>T.max.x||T.min.x>m.max.x||m.min.y>T.max.y||T.min.y>m.max.y))for(let A=0;A<T.footprintSegLen;A++){const M=this.footprintSegments[T.footprintSegIdx+A];if(p.length=0,Gj(this.footprintVertices,M.vertexOffset,M.vertexCount,m.footprintTileId.canonical,e.canonical,p),Yx(m.footprint,p,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-b)){T.flags|=Yd;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,u){let h=!1;for(let p=0;p<u.footprintSegLen;p++){const m=this.footprintSegments[u.footprintSegIdx+p];let b=0;for(const T of m.ringIndices){for(let A=b,M=T+b-1;A<T+b;M=A++){const O=this.footprintVertices.int16[2*(A+m.vertexOffset)+0],D=this.footprintVertices.int16[2*(A+m.vertexOffset)+1],N=this.footprintVertices.int16[2*(M+m.vertexOffset)+1];D>i!=N>i&&e<(this.footprintVertices.int16[2*(M+m.vertexOffset)+0]-O)*(i-D)/(N-D)+O&&(h=!h)}b=T}}return h}getHeightAtTileCoord(e,i){let u=Number.NEGATIVE_INFINITY,h=!0;const p=4*(e+$t)*$t+(i+$t);if(this.partLookup.hasOwnProperty(p)){const m=this.partLookup[p];return m?{height:m.height,hidden:!!(m.flags&Yd)}:void 0}for(const m of this.centroidData)e>m.max.x||m.min.x>e||i>m.max.y||m.min.y>i||m.height<=u||this.footprintContainsPoint(e,i,m)&&(u=m.height,this.partLookup[p]=m,h=!!(m.flags&Yd));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.partLookup[p]=void 0}}function bP(o,e){const i=o.add(e)._unit();return o.x*i.x+o.y*i.y}function qj(o,e,i,u){const h=e.sub(o)._perp()._unit(),p=i.sub(e)._perp()._unit();return wP(o,e,i,bP(h,p),u)}function wP(o,e,i,u,h){const p=Math.sqrt(1-u*u);return Math.min(o.dist(e)/3,e.dist(i)/3,h*p/u)}function rb(o,e,i){return o.x<i[0].x&&e.x<i[0].x||o.x>i[1].x&&e.x>i[1].x||o.y<i[0].y&&e.y<i[0].y||o.y>i[1].y&&e.y>i[1].y}function SP(o,e){return o.x<e[0].x||o.x>e[1].x||o.y<e[0].y||o.y>e[1].y}function TP(o,e,i){if(o.x<0||o.x>=$t||e.x<0||e.x>=$t||i.x<0||i.x>=$t)return!1;const u=i.sub(e),h=u.perp(),p=o.sub(e);return(u.x*p.x+u.y*p.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function EP(o,e,i){const u=e?2|o:-3&o;return i?1|u:-2&u}function AP(){const o=Math.PI/32,e=Math.tan(o),i=C;return i*Math.sqrt(1+2*e*e)-i}function PP(o,e,i){const u=1<<i.z,h=se(i.x/u),p=se((i.x+1)/u),m=ce(i.y/u),b=ce((i.y+1)/u);return(function(T,A,M,O,D=0,N){const U=[];if(!T.length||!M||!O)return U;const H=(Ie,Ce)=>{for(const Be of Ie)U.push({polygon:Be,bounds:Ce})},X=Math.ceil(Math.log2(M)),te=Math.ceil(Math.log2(O)),ue=X-te,le=[];for(let Ie=0;Ie<Math.abs(ue);Ie++)le.push(ue>0?0:1);for(let Ie=0;Ie<Math.min(X,te);Ie++)le.push(0),le.push(1);let fe=T;if(fe=Qy(fe,A[0].y-D,A[1].y+D,1),fe=Qy(fe,A[0].x-D,A[1].x+D,0),!fe.length)return U;const De=[];for(le.length?De.push({polygons:fe,bounds:A,depth:0}):H(fe,A);De.length;){const Ie=De.pop(),Ce=Ie.depth,Be=le[Ce],je=Ie.bounds[0],st=Ie.bounds[1],Ge=Be===0?je.x:je.y,ft=Be===0?st.x:st.y,jt=N?N(Be,Ge,ft):.5*(Ge+ft),_t=Qy(Ie.polygons,Ge-D,jt+D,Be),Mt=Qy(Ie.polygons,jt-D,ft+D,Be);if(_t.length){const Ft=[je,new Ct(Be===0?jt:st.x,Be===1?jt:st.y)];le.length>Ce+1?De.push({polygons:_t,bounds:Ft,depth:Ce+1}):H(_t,Ft)}if(Mt.length){const Ft=[new Ct(Be===0?jt:je.x,Be===1?jt:je.y),st];le.length>Ce+1?De.push({polygons:Mt,bounds:Ft,depth:Ce+1}):H(Mt,Ft)}}return U})(o,e,Math.ceil((p-h)/11.25),Math.ceil((m-b)/11.25),1,((T,A,M)=>{if(T===0)return .5*(A+M);{const O=ce((i.y+A/$t)/u);return(J(.5*(ce((i.y+M/$t)/u)+O))*u-i.y)*$t}}))}function Gj(o,e,i,u,h,p){const m=Math.pow(2,u.z-h.z);for(let b=0;b<i;b++){let T=o.int16[2*(b+e)+0],A=o.int16[2*(b+e)+1];T=(T+h.x*$t)*m-u.x*$t,A=(A+h.y*$t)*m-u.y*$t,p.push(new Ct(T,A))}}let IP,CP;nr(iv,"FillExtrusionBucket",{omit:["layers","features"]}),nr(yP,"PartData"),nr(_P,"FootprintSegment"),nr(vP,"BorderCentroidData"),nr(tb,"GroundEffect");class Gp extends Ct{constructor(e,i,u){super(e,i),this.z=u}}class MP extends Gp{constructor(e,i,u,h){super(e,i,u),this.w=h}}function OP(o,e,i,u){const h=i==="x"?"y":"x",p=(u-o[i])/(e[i]-o[i]);o[h]=Math.round(o[h]+(e[h]-o[h])*p),o[i]=u,o.hasOwnProperty("z")&&(o.z=wr(o.z,e.z,p)),o.hasOwnProperty("w")&&(o.w=wr(o.w,e.w,p))}function RP(o,e,i,u){const h=i,p=u;for(const m of["x","y"]){let b=o,T=e;b[m]>=T[m]&&(b=e,T=o),b[m]<h&&T[m]>h&&OP(b,T,m,h),b[m]<p&&T[m]>p&&OP(T,b,m,p)}}function ov(o,e,i,u,h,p){const m=[];for(let b=0;b<o.length;b++){const T=o[b];let A;const M=m.length;let O=0;for(let D=0;D<T.length-1;D++){let N=T[D],U=T[D+1],H=0;const X=O;let te,ue;p&&(H=Math.hypot(U.x-N.x,U.y-N.y),O+=H,te=N,ue=U),N.x<e&&U.x<e||(N.x<e?N=new Ct(e,N.y+(e-N.x)/(U.x-N.x)*(U.y-N.y))._round():U.x<e&&(U=new Ct(e,N.y+(e-N.x)/(U.x-N.x)*(U.y-N.y))._round()),N.y<i&&U.y<i||(N.y<i?N=new Ct(N.x+(i-N.y)/(U.y-N.y)*(U.x-N.x),i)._round():U.y<i&&(U=new Ct(N.x+(i-N.y)/(U.y-N.y)*(U.x-N.x),i)._round()),N.x>=u&&U.x>=u||(N.x>=u?N=new Ct(u,N.y+(u-N.x)/(U.x-N.x)*(U.y-N.y))._round():U.x>=u&&(U=new Ct(u,N.y+(u-N.x)/(U.x-N.x)*(U.y-N.y))._round()),N.y>=h&&U.y>=h||(N.y>=h?N=new Ct(N.x+(h-N.y)/(U.y-N.y)*(U.x-N.x),h)._round():U.y>=h&&(U=new Ct(N.x+(h-N.y)/(U.y-N.y)*(U.x-N.x),h)._round()),A&&N.equals(A[A.length-1])||(A=[N],m.push(A),p&&p.push({progress:{min:X+kP(te,ue,N)*H,max:1},parentIndex:b,prevPoint:te,nextPoint:ue})),A.push(U),p&&(p[p.length-1].progress.max=X+kP(te,ue,U)*H,p[p.length-1].nextPoint=ue)))))}if(p&&O>0)for(let D=M;D<m.length;D++)p[D].progress.min/=O,p[D].progress.max/=O}return m}function Hj(o,e,i,u,h){if(o.length<2)return void u.push(o);const p=[];for(;e.valid();){const[A,M]=e.get();for(let O=0;O<o.length-1;O++){const D=o[O],N=o[O+1],U=ko(D,N,A,M);if(U){const[H]=U,X=new Ct(wr(D.x,N.x,H),wr(D.y,N.y,H));p.push({t:O+H,distance:0,point:X})}}e.next()}if(p.length===0)return void u.push(o);p.sort(((A,M)=>A.t-M.t));let m=0,b=0,T=[];for(u.push(T);m!==o.length;){if(b===p.length){for(;m!==o.length;)T.length!==0&&T[T.length-1].equals(o[m])||T.push(o[m]),m++;break}p[b].t<=m?(T.length!==0&&T[T.length-1].equals(p[b].point)||T.push(p[b].point),Math.trunc(p[b].t),b++):(T.length!==0&&T[T.length-1].equals(o[m])||T.push(o[m]),m++)}}function kP(o,e,i){return o.x!==e.x?(i.x-o.x)/(e.x-o.x):o.y!==e.y?(i.y-o.y)/(e.y-o.y):0}function f_(o,e){return o.x*e.x+o.y*e.y}function DP(o,e){if(o.length===1){let i=0;const u=e[i++];let h;for(;!h||u.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const p=e[i],m=o[0],b=h.sub(u),T=p.sub(u),A=m.sub(u),M=f_(b,b),O=f_(b,T),D=f_(T,T),N=f_(A,b),U=f_(A,T),H=M*D-O*O,X=(D*N-O*U)/H,te=(M*U-O*N)/H,ue=u.z*(1-X-te)+h.z*X+p.z*te;if(isFinite(ue))return ue}return 1/0}{let i=1/0;for(const u of e)i=Math.min(i,u.z);return i}}function zP(o,e,i,u,h,p,m,b){const T=m*h.getElevationAt(o,e,!0,!0),A=p[0]!==0,M=A?p[1]===0?m*(p[0]/7-450):m*(function(O,D,N){const U=Math.floor(D[0]/8),H=Math.floor(D[1]/8),X=10*(D[0]-8*U),te=10*(D[1]-8*H),ue=O.getElevationAt(U,H,!0,!0),le=O.getMeterToDEM(N),fe=Math.floor(.5*(X*le-1)),De=Math.floor(.5*(te*le-1)),Ie=O.tileCoordToPixel(U,H),Ce=2*fe+1,Be=2*De+1,je=(function(Mt,Ft,ot,Ot,Xe){return[Mt.getElevationAtPixel(Ft,ot,!0),Mt.getElevationAtPixel(Ft+Xe,ot,!0),Mt.getElevationAtPixel(Ft,ot+Xe,!0),Mt.getElevationAtPixel(Ft+Ot,ot+Xe,!0)]})(O,Ie.x-fe,Ie.y-De,Ce,Be),st=Math.abs(je[0]-je[1]),Ge=Math.abs(je[2]-je[3]),ft=Math.abs(je[0]-je[2])+Math.abs(je[1]-je[3]),jt=Math.min(.25,.5*le*(st+Ge)/Ce),_t=Math.min(.25,.5*le*ft/Be);return ue+Math.max(jt*X,_t*te)})(h,p,b):T;return{base:T+(i===0?-1:i),top:A?Math.max(M+u,T+i+2):T+u}}class Wj{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Zj{constructor(){this.tasks={},this.taskQueue=[],Cr(["process"],this),this.invoker=new Wj(this.process),this.nextId=0}add(e,i){const u=this.nextId++,h=(function({type:p,isSymbolTile:m,zoom:b}){return b=b||0,p==="message"?0:p!=="maybePrepare"||m?p!=="parseTile"||m?p==="parseTile"&&m?300-b:p==="maybePrepare"&&m?400-b:500:200-b:100-b})(i);if(h===0){try{e()}finally{}return null}return this.tasks[u]={fn:e,metadata:i,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((u=>!!this.tasks[u])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<i&&(i=p.priority,e=h)}if(e===null)return null;const u=this.taskQueue[e];return this.taskQueue.splice(e,1),u}remove(){this.invoker.remove()}}class LP{constructor(e,i,u){this.target=e,this.parent=i,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Cr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Zj}send(e,i,u,h,p=!1,m){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=m,this.callbacks[b]=u);const T=new Set;return this.target.postMessage({id:b,type:e,hasCallback:!!u,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:Ls(i,T)},T),{cancel:()=>{u&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const u=i.id;if(u&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h.cancel()}else if(i.mustQueue||qn(self)){const h=this.callbacks[u],p=this.scheduler.add((()=>this.processTask(u,i)),h&&h.metadata||{type:"message"});p&&(this.cancelCallbacks[u]=p)}else this.processTask(u,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const u=this.callbacks[e];delete this.callbacks[e],u&&(i.error?u(da(i.error)):u(null,da(i.data)))}else{const u=new Set,h=i.hasCallback?(m,b)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?Ls(m):null,data:Ls(b,u)},u)}:()=>{},p=da(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,p,h);else if(this.parent.getWorkerSource){const m=i.type.split("."),{source:b,scope:T}=p;this.parent.getWorkerSource(i.sourceMapId,m[0],b,T)[m[1]](p,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var d_={workerUrl:"",workerClass:null,workerParams:void 0};const nb="mapboxgl_preloaded_worker_pool";class Hp{constructor(){this.active={}}acquire(e,i=Hp.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(d_.workerClass!=null?new d_.workerClass:new self.Worker(d_.workerUrl,d_.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((i=>{i.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[nb]}numActive(){return Object.keys(this.active).length}}Hp.workerCount=2;class Um{constructor(e,i,u="Worker",h=Hp.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=mt();const p=this.workerPool.acquire(this.id,h);for(let m=0;m<p.length;m++){const b=new Um.Actor(p[m],i,this.id);b.name=`${u} ${m}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,i,u){Ue(this.actors,((h,p)=>{h.send(e,i,p)}),u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let p_,ib;function av(){return p_||(p_=new Hp),p_}Um.Actor=LP;class Xj{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),u=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,u/i.BYTES_PER_ELEMENT),u}createFloatArray(e){const i=new Float32Array(e),u=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,u/i.BYTES_PER_ELEMENT),u}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let u=0;u<e.length;++u)this.module.heapU8[i+u]=e.charCodeAt(u);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,u=e.facadeGlazingColorRgb,h=e.roofColorRgb,p=e.wallColorRgb,m=e.normalScale;this.module.setStyle(i[0],i[1],i[2],u[0],u[1],u[2],h[0],h[1],h[2],p[0],p[1],p[2],m[0],m[1],m[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,u){this.module.setFauxFacadeOptions(e?1:0,i?1:0,u)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){for(const b of e){const T=this.createStringBuffer(b.roofType),A=[0],M=[];for(const N of b.coordinates)if(Array.isArray(N)){for(const U of N)M.push(U.x),M.push(U.y);A.push(M.length)}const O=this.createIntArray(A),D=this.createFloatArray(M);this.module.addFeature(b.id,b.sourceId,b.minHeight,b.height,T,b.roofType.length,D,O,A.length-1),this.module.free(T),this.module.free(O),this.module.free(D)}for(const b of i){let T;T=b.entrances?JSON.parse(b.entrances):[];const A=this.createFloatArray(T),M=[];for(const D of b.coordinates)M.push(D.x),M.push(D.y);const O=this.createFloatArray(M);this.module.addFacade(b.sourceId,b.crossPerc,b.distanceToRoad,A,T.length,O,M.length),this.module.free(A),this.module.free(O)}if(!this.module.generateMesh()){const b=this.module.getLastError();return this.readStringBuffer(b)}const u=this.module.getMeshCount(),h=new Array(u);for(let b=0;b<u;b++){const T=this.module.getPositionsPtr(b),A=this.module.getPositionsLength(b),M=new Float32Array(this.module.heapF32.buffer,T,A),O=this.module.getNormalsPtr(b),D=this.module.getNormalsLength(b),N=new Float32Array(this.module.heapF32.buffer,O,D),U=this.module.getColorsPtr(b),H=this.module.getColorsLength(b),X=new Uint8Array(this.module.heapU8.buffer,U,H),te=this.module.getAOPtr(b),ue=this.module.getAOLength(b),le=new Float32Array(this.module.heapF32.buffer,te,ue),fe=this.module.getUVPtr(b),De=this.module.getUVLength(b),Ie=new Float32Array(this.module.heapF32.buffer,fe,De),Ce=this.module.getFauxFacadePtr(b),Be=this.module.getFauxFacadeLength(b),je=new Uint8Array(this.module.heapU8.buffer,Ce,Be),st=this.module.getIndicesPtr(b),Ge=this.module.getIndicesLength(b),ft=new Int32Array(this.module.heap32.buffer,st,Ge),jt=this.module.getBuildingPart(b),_t=this.readStringBuffer(jt);h[b]={positions:M,normals:N,colors:X,ao:le,uv:Ie,isFauxFacade:je,indices:ft,buildingPart:_t}}const p=this.module.getRingCount(),m=[];for(let b=0;b<p;b++){const T=this.module.getRingPtr(b),A=this.module.getRingLength(b),M=new Float32Array(this.module.heapF32.buffer,T,A);m.push(M)}return{meshes:h,modifiedPolygonRings:m}}}let m_,ob,kc,Vm,ab,$m=null,qm=null,FP=null,sv=null;function BP(){return qn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:ob||Bo.DRACO_URL}function NP(){if(qn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Vm)return Vm;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Vm=WebAssembly.validate(o)?Bo.MESHOPT_SIMD_URL:Bo.MESHOPT_URL,Vm}function Kj(){return sv}const lv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Yj={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},g_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function jP(o,e,i){const u=i.json.bufferViews.length,h=i.buffers.length;e.bufferView=u,i.json.bufferViews[u]={buffer:h,byteLength:o.byteLength},i.buffers[h]=o}const sb="KHR_draco_mesh_compression";function Jj(o,e){const i=o.extensions&&o.extensions[sb];if(!i)return;const u=new kc.Decoder,h=qP(e,i.bufferView),p=new kc.Mesh;if(!u.DecodeArrayToMesh(h,h.byteLength,p))throw new Error("Failed to decode Draco mesh");const m=e.json.accessors[o.indices],b=lv[m.componentType],T=m.count*b.BYTES_PER_ELEMENT,A=kc._malloc(T);b===Uint16Array?u.GetTrianglesUInt16Array(p,T,A):u.GetTrianglesUInt32Array(p,T,A),jP(kc.memory.buffer.slice(A,A+T),m,e),kc._free(A);for(const M of Object.keys(i.attributes)){const O=u.GetAttributeByUniqueId(p,i.attributes[M]),D=e.json.accessors[o.attributes[M]],N=Yj[D.componentType],U=D.count*g_[D.type]*lv[D.componentType].BYTES_PER_ELEMENT,H=kc._malloc(U);u.GetAttributeDataArrayForAllPoints(p,O,kc[N],U,H),jP(kc.memory.buffer.slice(H,H+U),D,e),kc._free(H)}u.destroy(),p.destroy(),delete o.extensions[sb]}const uv="EXT_meshopt_compression";function Qj(o,e){if(!o.extensions||!o.extensions[uv])return;const i=o.extensions[uv],u=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),h=new Uint8Array(i.count*i.byteStride);ab.decodeGltfBuffer(h,i.count,i.byteStride,u,i.mode,i.filter),o.buffer=e.buffers.length,o.byteOffset=0,e.buffers[o.buffer]=h.buffer,delete o.extensions[uv]}const UP=1179937895,VP=new TextDecoder("utf8");function $P(o,e){return new URL(o,e).href}function e5(o,e,i,u){return fetch($P(o.uri,u)).then((h=>h.arrayBuffer())).then((h=>{e.buffers[i]=h}))}function qP(o,e){const i=o.json.bufferViews[e];return new Uint8Array(o.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function t5(o,e,i,u){if(o.uri){const h=$P(o.uri,u);return fetch(h).then((p=>p.blob())).then((p=>createImageBitmap(p))).then((p=>{e.images[i]=p}))}if(o.bufferView!==void 0){const h=qP(e,o.bufferView),p=new Blob([h],{type:o.mimeType});return createImageBitmap(p).then((m=>{e.images[i]=m}))}}function GP(o,e=0,i){const u={json:null,images:[],buffers:[]};if(new Uint32Array(o,e,1)[0]===UP){const M=new Uint32Array(o,e);let O=2;const D=(M[O++]>>2)-3,N=M[O++]>>2;if(O++,u.json=JSON.parse(VP.decode(M.subarray(O,O+N))),O+=N,O<D){const U=M[O++];O++;const H=e+(O<<2);u.buffers[0]=o.slice(H,H+U)}}else u.json=JSON.parse(VP.decode(new Uint8Array(o,e)));const{buffers:h,images:p,meshes:m,extensionsUsed:b,bufferViews:T}=u.json;let A=Promise.resolve();if(h){const M=[];for(let O=0;O<h.length;O++){const D=h[O];D.uri?M.push(e5(D,u,O,i)):u.buffers[O]||(u.buffers[O]=null)}A=Promise.all(M)}return A.then((()=>{const M=[],O=b&&b.includes(sb),D=b&&b.includes(uv);if(O&&M.push((function(){if(!kc)return m_??(m_=(function(N){let U,H=null;function X(){U=new Uint8Array(H.buffer)}function te(){throw new Error("Unexpected Draco error.")}const ue={a:{a:te,d:function(le,fe,De){return U.copyWithin(le,fe,fe+De)},c:function(le){const fe=U.length,De=Math.max(le>>>0,Math.ceil(1.2*fe)),Ie=Math.ceil((De-fe)/65536);try{return H.grow(Ie),X(),!0}catch{return!1}},b:te}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(N,ue):N.then((le=>le.arrayBuffer())).then((le=>WebAssembly.instantiate(le,ue)))).then((le=>{const{Rb:fe,Qb:De,P:Ie,T:Ce,X:Be,Ja:je,La:st,Qa:Ge,Va:ft,Wa:jt,eb:_t,jb:Mt,f:Ft,e:ot,yb:Ot,zb:Xe,Ab:at,Bb:Ut,Db:Rt,Gb:gr}=le.instance.exports;H=ot;const ar=(()=>{let At=0,zt=0,hr=0,er=0;return Gt=>{hr&&(fe(er),fe(At),zt+=hr,hr=At=0),At||(zt+=128,At=De(zt));const rr=Gt.length+7&-8;let Pr=At;rr>=zt&&(hr=rr,Pr=er=De(rr));for(let Fr=0;Fr<Gt.length;Fr++)U[Pr+Fr]=Gt[Fr];return Pr}})();return X(),Ft(),{memory:ot,_free:fe,_malloc:De,Mesh:class{constructor(){this.ptr=Ie()}destroy(){Ce(this.ptr)}},Decoder:class{constructor(){this.ptr=je()}destroy(){Mt(this.ptr)}DecodeArrayToMesh(At,zt,hr){const er=ar(At),Gt=st(this.ptr,er,zt,hr.ptr);return!!Be(Gt)}GetAttributeByUniqueId(At,zt){return{ptr:Ge(this.ptr,At.ptr,zt)}}GetTrianglesUInt16Array(At,zt,hr){ft(this.ptr,At.ptr,zt,hr)}GetTrianglesUInt32Array(At,zt,hr){jt(this.ptr,At.ptr,zt,hr)}GetAttributeDataArrayForAllPoints(At,zt,hr,er,Gt){_t(this.ptr,At.ptr,zt.ptr,hr,er,Gt)}},DT_INT8:Ot(),DT_UINT8:Xe(),DT_INT16:at(),DT_UINT16:Ut(),DT_UINT32:Rt(),DT_FLOAT32:gr()}}))})(fetch(BP())),m_.then((N=>{kc=N,m_=void 0})))})()),D&&M.push((function(){if(ab)return;const N=(function(U){let H;const X=WebAssembly.instantiateStreaming(U,{}).then((le=>{H=le.instance,H.exports.__wasm_call_ctors()})),te={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ue={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:X,supported:!0,decodeGltfBuffer(le,fe,De,Ie,Ce,Be){(function(je,st,Ge,ft,jt,_t,Mt){const Ft=je.exports.sbrk,ot=ft+3&-4,Ot=Ft(ot*jt),Xe=Ft(_t.length),at=new Uint8Array(je.exports.memory.buffer);at.set(_t,Xe);const Ut=st(Ot,ft,jt,Xe,_t.length);if(Ut===0&&Mt&&Mt(Ot,ot,jt),Ge.set(at.subarray(Ot,Ot+ft*jt)),Ft(Ot-Ft(0)),Ut!==0)throw new Error(`Malformed buffer data: ${Ut}`)})(H,H.exports[ue[Ce]],le,fe,De,Ie,H.exports[te[Be]])}}})(fetch(NP()));return N.ready.then((()=>{ab=N}))})()),p)for(let N=0;N<p.length;N++)M.push(t5(p[N],u,N,i));return(M.length?Promise.all(M):Promise.resolve()).then((()=>{if(O&&m)for(const{primitives:N}of m)for(const U of N)Jj(U,u);if(D&&m&&T)for(const N of T)Qj(N,u);return u}))}))}function lb(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function ub(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class cb{constructor(e,i,u,h){this.context=e,this.format=u,this.useMipmap=h&&h.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:h&&h.premultiply})}update(e,i){const u=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,h=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:p}=this,{gl:m}=p,{x:b,y:T}=i&&i.position?i.position:{x:0,y:0},A=b+u,M=T+h;!this.size||this.size[0]===A&&this.size[1]===M||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!i||i.premultiply!==!1));const O=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&A>0&&M>0){const D=this.useMipmap?Math.floor(Math.log2(Math.max(A,M)))+1:1;m.texStorage2D(m.TEXTURE_2D,D,this.format,A,M),this.size=[A,M]}if(this.size)if(O)m.texSubImage2D(m.TEXTURE_2D,0,b,T,lb(this.format),ub(this.format),e);else{const D=e.data;D&&m.texSubImage2D(m.TEXTURE_2D,0,b,T,u,h,lb(this.format),ub(this.format),D)}this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,i,u=!1){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!u?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,u,h,p){const{context:m}=this,{gl:b}=m;b.bindTexture(b.TEXTURE_2D,this.texture),i!==this.magFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.useMipmap?e===b.NEAREST?b.NEAREST_MIPMAP_NEAREST:b.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),u!==this.wrapS&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,u),this.wrapS=u),h!==this.wrapT&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),this.wrapT=h),p!==this.compareMode&&(p?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.COMPARE_REF_TO_TEXTURE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_FUNC,p)):b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.NONE),this.compareMode=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class __{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}}const r5=mn([{name:"a_pos_3f",components:3,type:"Float32"}]),n5=mn([{name:"a_color_3f",components:3,type:"Float32"}]),i5=mn([{name:"a_color_4f",components:4,type:"Float32"}]),o5=mn([{name:"a_uv_2f",components:2,type:"Float32"}]),a5=mn([{name:"a_normal_3f",components:3,type:"Float32"}]),s5=mn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),l5=mn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function HP(o,e){const i=cv(o.projection,o.zoom,o.width,o.height),u=(function(p,m,b,T,A){const M=new L(b.lng-180*Jd,b.lat),O=new L(b.lng+180*Jd,b.lat),D=p.project(M.lng,M.lat),N=p.project(O.lng,O.lat),U=-Math.atan2(N.y-D.y,N.x-D.x),H=Ae.fromLngLat(b);H.y=ve(H.y,-1+Jd,1-Jd);const X=H.toLngLat(),te=p.project(X.lng,X.lat),ue=Ae.fromLngLat(X);ue.x+=Jd;const le=ue.toLngLat(),fe=p.project(le.lng,le.lat),De=ZP(fe.x-te.x,fe.y-te.y,U),Ie=Ae.fromLngLat(X);Ie.y+=Jd;const Ce=Ie.toLngLat(),Be=p.project(Ce.lng,Ce.lat),je=ZP(Be.x-te.x,Be.y-te.y,U),st=Math.abs(De.x)/Math.abs(je.y),Ge=ee([]);_e(Ge,Ge,-U*(1-(A?0:T)));const ft=ee([]);return be(ft,ft,[1,1-(1-st)*T,1]),ft[4]=-je.x/je.y*T,_e(ft,ft,U),de(ft,Ge,ft),ft})(o.projection,0,o.center,i,e),h=WP(o);return be(u,u,[h,h,1]),u}function WP(o){const e=o.projection,i=cv(o.projection,o.zoom,o.width,o.height),u=hb(e,o.center),h=hb(e,L.convert(e.center));return Math.pow(2,u*i+(1-i)*h)}function cv(o,e,i,u,h=1/0){const p=o.range;if(!p)return 0;const m=Math.min(h,Math.max(i,u)),b=Math.log(m/1024)/Math.LN2;return Fe(p[0]+b,p[1]+b,e)}const Jd=1/4e4;function hb(o,e){const i=ve(e.lat,-Se,Se),u=new L(e.lng-180*Jd,i),h=new L(e.lng+180*Jd,i),p=o.project(u.lng,i),m=o.project(h.lng,i),b=Ae.fromLngLat(u),T=Ae.fromLngLat(h),A=m.x-p.x,M=m.y-p.y,O=T.x-b.x,D=T.y-b.y,N=Math.sqrt((O*O+D*D)/(A*A+M*M));return Math.log(N)/Math.LN2}function ZP(o,e,i){const u=Math.cos(i),h=Math.sin(i);return{x:o*u-e*h,y:o*h+e*u}}function XP(o,e,i){ee(o),_e(o,o,Cn(e[2])),ke(o,o,Cn(e[0])),he(o,o,Cn(e[1])),be(o,o,i),de(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function hv(o,e,i,u,h,p,m,b){const T=[i[0]-e[0],i[1]-e[1],0],A=[u[0]-e[0],u[1]-e[1],0];if(gt(T)<1e-12||gt(A)<1e-12)return Fa(o);const M=Ur([],T,A);Ir(M,M),Ht(A,u,e),T[2]=(p-h)*b,A[2]=(m-h)*b;const O=T;return Ur(O,T,A),Ir(O,O),el(o,M,O)}function fb(o,e,i=!1){const u=ht(e.zoom),h=(function(p,m,b){const T=m.worldSize,A=[p[12],p[13],p[14]],M=ce(A[1]/T),O=se(A[0]/T),D=ee([]),N=Y(1,M)*T,U=Y(1,0)*T*Me(M,m.zoom),H=1/Qr(T);let X=U*H;if(b){const fe=cv(m.projection,m.zoom,m.width,m.height,1024);X=H*m.projection.pixelSpaceConversion(m.center.lat,T,fe)}const te=E(M,O);Tt(te,te,$e([],Ir([],te),N*X*A[2]));const ue=(function(fe){const De=[fe[0],fe[1],fe[2]];let Ie=[0,1,0];const Ce=Ur([],Ie,De);return Ur(Ie,De,Ce),zr(Ie)===0&&(Ie=[0,1,0],Ur(Ce,De,Ie)),Ir(Ce,Ce),Ir(Ie,Ie),Ir(De,De),[Ce[0],Ce[1],Ce[2],0,Ie[0],Ie[1],Ie[2],0,De[0],De[1],De[2],0,fe[0],fe[1],fe[2],1]})(te);be(D,D,[X,X,X*N]),xe(D,D,[-A[0],-A[1],-A[2]]);const le=de([],m.globeMatrix,ue);return de(le,le,D),de(le,le,p),le})(o,e,i);if(u>0){const p=(function(m,b){const T=b.worldSize,A=Y(1,0)*T*Me(b.center.lat,b.zoom)/Qr(T),M=Y(1,b.center.lat)*T,O=ee([]);return he(O,O,Cn(b.center.lng)),ke(O,O,Cn(b.center.lat)),xe(O,O,[0,0,Zo]),be(O,O,[A,A,A*M]),xe(O,O,[b.point.x-.5*T,b.point.y-.5*T,0]),de(O,O,m),de(O,b.globeMatrix,O)})(o,e);return(function(m,b,T){const A=(U,H,X)=>{const te=gt(U),ue=gt(H),le=Q(U,H,X);return $e(le,le,1/gt(le)*wr(te,ue,X))},M=A([m[0],m[1],m[2]],[b[0],b[1],b[2]],T),O=A([m[4],m[5],m[6]],[b[4],b[5],b[6]],T),D=A([m[8],m[9],m[10]],[b[8],b[9],b[10]],T),N=Q([m[12],m[13],m[14]],[b[12],b[13],b[14]],T);return[M[0],M[1],M[2],0,O[0],O[1],O[2],0,D[0],D[1],D[2],0,N[0],N[1],N[2],1]})(h,p,u)}return h}function KP(o,e,i,u){const h=Mr.projectAabbCorners(u,i);let p=Number.MAX_VALUE,m=-1;for(let A=0;A<h.length;++A){const M=h[A];M[0]=(.5*M[0]+.5)*e.width,M[1]=(.5-.5*M[1])*e.height,M[2]<p&&(m=A,p=M[2])}const b=A=>new Ct(h[A][0],h[A][1]);let T;switch(m){case 0:case 6:T=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:T=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:T=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:T=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(Wn(o,T))return p}const Wp=64,Gm={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function YP(o,e,i,u,h,p,m,b,T,A=!1){const M=i.zoom,O=i.project(u),D=Me(u.lat,M),N=1/D;ee(o),xe(o,o,[O.x+m[0]*N,O.y+m[1]*N,m[2]]);let U=1,H=1;const X=i.worldSize;if(A){if(i.projection.name==="mercator"){let fe=0;i.elevation&&(fe=i.elevation.getAtPointOrZero(new Ae(O.x/X,O.y/X),0));const De=Ui([],[O.x,O.y,fe,1],i.projMatrix)[3]/i.cameraToCenterDistance;U=De,H=De*Me(i.center.lat,M)}else if(i.projection.name==="globe"){const fe=fb(o,i),De=[0,0,0,1];Ui(De,De,de([],i.projMatrix,fe));const Ie=De[3]/i.cameraToCenterDistance,Ce=ht(M),Be=i.projection.pixelsPerMeter(u.lat,X)*Me(u.lat,M),je=i.projection.pixelsPerMeter(i.center.lat,X)*Me(i.center.lat,M);U=Ie/wr(Be,Pe(i.center.lat),Ce),H=Ie*D/Be,U*=je,H*=je}}else U=N;be(o,o,[U,U,H]);const te=[...o],ue=e.orientation,le=[];if(XP(le,[ue[0]+h[0],ue[1]+h[1],ue[2]+h[2]],p),de(o,te,le),b&&i.elevation){let fe=0;const De=[];if(T&&i.elevation){fe=(function(Ce,Be,je,st,Ge){const ft=Be.elevation;if(!ft)return 0;const jt=Mr.projectAabbCorners(je,st),_t=Y(1,Ge.lat)*Be.worldSize,Mt=(function(zt,hr){const er=[0,0,1],Gt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const rr of Gt){const Pr=zt[rr.corners[0]],Fr=zt[rr.corners[1]],Zr=zt[rr.corners[2]],qr=[Fr[0]-Pr[0],Fr[1]-Pr[1],hr*(Fr[2]-Pr[2])],yn=Ur(qr,qr,[Zr[0]-Pr[0],Zr[1]-Pr[1],hr*(Zr[2]-Pr[2])]);Ir(yn,yn),rr.dotProductWithUp=Lr(yn,er)}return Gt.sort(((rr,Pr)=>rr.dotProductWithUp-Pr.dotProductWithUp)),Gt[0].corners})(jt,_t),Ft=jt[Mt[0]],ot=jt[Mt[1]],Ot=jt[Mt[2]],Xe=jt[Mt[3]],at=ft.getAtPointOrZero(new Ae(Ft[0]/Be.worldSize,Ft[1]/Be.worldSize),0),Ut=ft.getAtPointOrZero(new Ae(ot[0]/Be.worldSize,ot[1]/Be.worldSize),0),Rt=ft.getAtPointOrZero(new Ae(Ot[0]/Be.worldSize,Ot[1]/Be.worldSize),0),gr=ft.getAtPointOrZero(new Ae(Xe[0]/Be.worldSize,Xe[1]/Be.worldSize),0),ar=(at+gr)/2,At=(Ut+Rt)/2;return ar>At?Ut<Rt?hv(Ce,ot,Xe,Ft,Ut,gr,at,_t):hv(Ce,Ot,Ft,Xe,Rt,at,gr,_t):at<gr?hv(Ce,Ft,ot,Ot,at,Ut,Rt,_t):hv(Ce,Xe,Ot,ot,gr,Rt,Ut,_t),Math.max(ar,At)})(De,i,e.aabb,o,u);const Ie=de([],rt([],De),le);de(o,te,Ie)}else fe=i.elevation.getAtPointOrZero(new Ae(O.x/X,O.y/X),0);fe!==0&&(o[14]+=fe)}}function y_(o,e,i=!1){o.uploaded||(o.gfxTexture=new cb(e,o.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:o.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function u5(o,e,i){o.indexBuffer=e.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=e.createVertexBuffer(o.vertexArray,r5.members,!1,!0),o.normalArray&&(o.normalBuffer=e.createVertexBuffer(o.normalArray,a5.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=e.createVertexBuffer(o.texcoordArray,o5.members,!1,!0)),o.colorArray&&(o.colorBuffer=e.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?n5:i5).members,!1,!0)),o.featureArray&&(o.pbrBuffer=e.createVertexBuffer(o.featureArray,l5.members,!0)),o.segments=wi.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const u=o.material;u.pbrMetallicRoughness.baseColorTexture&&y_(u.pbrMetallicRoughness.baseColorTexture,e),u.pbrMetallicRoughness.metallicRoughnessTexture&&y_(u.pbrMetallicRoughness.metallicRoughnessTexture,e),u.normalTexture&&y_(u.normalTexture,e),u.occlusionTexture&&y_(u.occlusionTexture,e,i),u.emissionTexture&&y_(u.emissionTexture,e)}function db(o,e,i){if(o.meshes)for(const u of o.meshes)u5(u,e,i);if(o.children)for(const u of o.children)db(u,e,i)}function fv(o){if(o.meshes)for(const e of o.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(o.children)for(const e of o.children)fv(e)}function pb(o){if(o.meshes)for(const i of o.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(o.children)for(const i of o.children)pb(i)}function Zp(o,e){const i=o.json.bufferViews[e.bufferView],u=lv[e.componentType];return new u(o.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==g_[e.type]*u.BYTES_PER_ELEMENT?i.byteStride/u.BYTES_PER_ELEMENT:g_[e.type]))}function mb(o,e,i,u){const h=lv[e.componentType],p=(function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(h),m=o.json.bufferViews[e.bufferView],b=m.byteStride?m.byteStride/h.BYTES_PER_ELEMENT:g_[e.type],T=i.float32,A=T.length/i.capacity;for(let M=0,O=0;M<e.count*b;M+=b,O+=A)for(let D=0;D<A;D++)T[O+D]=u[M+D]*p;i._trim()}function c5(o,e,i){const u=o.indices,h=o.attributes,p={};p.indexArray=new ai;const m=e.json.accessors[u],b=m.count/3;p.indexArray.reserve(b);const T=Zp(e,m);for(let D=0;D<b;D++)p.indexArray.emplaceBack(T[3*D],T[3*D+1],T[3*D+2]);p.indexArray._trim(),p.vertexArray=new ma;const A=e.json.accessors[h.POSITION];p.vertexArray.reserve(A.count);const M=Zp(e,A);for(let D=0;D<A.count;D++)p.vertexArray.emplaceBack(M[3*D],M[3*D+1],M[3*D+2]);if(p.vertexArray._trim(),p.aabb=new Mr(A.min,A.max),p.centroid=(function(D,N){const U=[0,0,0],H=D.length;if(H>0){for(let X=0;X<H;X++){const te=3*D[X];U[0]+=N[te],U[1]+=N[te+1],U[2]+=N[te+2]}U[0]/=H,U[1]/=H,U[2]/=H}return U})(T,M),h.COLOR_0!==void 0){const D=e.json.accessors[h.COLOR_0],N=g_[D.type],U=Zp(e,D);p.colorArray=N===3?new ma:new Us,p.colorArray.resize(D.count),mb(e,D,p.colorArray,U)}if(h.NORMAL!==void 0){p.normalArray=new ma;const D=e.json.accessors[h.NORMAL];p.normalArray.resize(D.count);const N=Zp(e,D);mb(e,D,p.normalArray,N)}if(h.TEXCOORD_0!==void 0&&i.length>0){p.texcoordArray=new To;const D=e.json.accessors[h.TEXCOORD_0];p.texcoordArray.resize(D.count);const N=Zp(e,D);mb(e,D,p.texcoordArray,N)}if(h._FEATURE_ID_RGBA4444!==void 0){const D=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=Zp(e,D))}h._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(Zp(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));const O=o.material;return p.material=(function(D,N){const{emissiveFactor:U=[0,0,0],alphaMode:H="OPAQUE",alphaCutoff:X=.5,normalTexture:te,occlusionTexture:ue,emissiveTexture:le,doubleSided:fe}=D,{baseColorFactor:De=[1,1,1,1],metallicFactor:Ie=1,roughnessFactor:Ce=1,baseColorTexture:Be,metallicRoughnessTexture:je}=D.pbrMetallicRoughness||{},st=ue?N[ue.index]:void 0;if(ue&&ue.extensions&&ue.extensions.KHR_texture_transform&&st){const Ge=ue.extensions.KHR_texture_transform;st.offsetScale=[Ge.offset[0],Ge.offset[1],Ge.scale[0],Ge.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new wn(...De),metallicFactor:Ie,roughnessFactor:Ce,baseColorTexture:Be?N[Be.index]:void 0,metallicRoughnessTexture:je?N[je.index]:void 0},doubleSided:fe,emissiveFactor:new wn(...U),alphaMode:H,alphaCutoff:X,normalTexture:te?N[te.index]:void 0,occlusionTexture:st,emissionTexture:le?N[le.index]:void 0,defined:D.defined===void 0}})(O!==void 0?e.json.materials[O]:{defined:!1},i),p}function JP(o,e,i){const{matrix:u,rotation:h,translation:p,scale:m,mesh:b,extras:T,children:A}=o,M={};if(M.matrix=u||(function(O,D,N,U){var H=D[0],X=D[1],te=D[2],ue=D[3],le=H+H,fe=X+X,De=te+te,Ie=H*le,Ce=H*fe,Be=H*De,je=X*fe,st=X*De,Ge=te*De,ft=ue*le,jt=ue*fe,_t=ue*De,Mt=U[0],Ft=U[1],ot=U[2];return O[0]=(1-(je+Ge))*Mt,O[1]=(Ce+_t)*Mt,O[2]=(Be-jt)*Mt,O[3]=0,O[4]=(Ce-_t)*Ft,O[5]=(1-(Ie+Ge))*Ft,O[6]=(st+ft)*Ft,O[7]=0,O[8]=(Be+jt)*ot,O[9]=(st-ft)*ot,O[10]=(1-(Ie+je))*ot,O[11]=0,O[12]=N[0],O[13]=N[1],O[14]=N[2],O[15]=1,O})([],h||[0,0,0,1],p||[0,0,0],m||[1,1,1]),b!==void 0){M.meshes=i[b];const O=M.anchor=[0,0];for(const D of M.meshes){const{min:N,max:U}=D.aabb;O[0]+=N[0]+U[0],O[1]+=N[1]+U[1]}O[0]=Math.floor(O[0]/M.meshes.length/2),O[1]=Math.floor(O[1]/M.meshes.length/2)}if(T&&(T.id&&(M.id=T.id),T.lights&&(M.lights=(function(O){if(!O.length)return[];const D=(function(te){const ue=atob(te),le=new Uint8Array(ue.length);for(let fe=0;fe<ue.length;fe++)le[fe]=ue.codePointAt(fe);return le})(O),N=[],U=D.length/24,H=new Uint16Array(D.buffer),X=new Float32Array(D.buffer);for(let te=0;te<U;te++){const ue=H[2*te*6]/30,le=H[2*te*6+1]/30,fe=H[2*te*6+10]/100,De=X[6*te+1],Ie=X[6*te+2],Ce=X[6*te+3],Be=X[6*te+4],je=Ce-De,st=Be-Ie,Ge=Math.hypot(je,st);N.push({pos:[De+.5*je,Ie+.5*st,le],normal:[st/Ge,-je/Ge,0],width:Ge,height:ue,depth:fe,points:[De,Ie,Ce,Be]})}return N})(T.lights))),A){const O=[];for(const D of A)O.push(JP(e.json.nodes[D],e,i));M.children=O}return M}function h5(o){if(o.vertices.length===0||o.indices.length===0)return null;const e=new ev(o.vertices,o.indices,8,256),[i,u]=[e.min.clone(),e.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:e,min:i,max:u}}function f5(o){if(!o.extras||!o.extras.ground)return null;const e=o.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const u=[];for(const m of i){if(!Array.isArray(m)||m.length!==2)continue;const b=m[0],T=m[1];typeof b=="number"&&typeof T=="number"&&u.push(new Ct(b,T))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let h=0;for(let m=0;m<u.length;m++){const b=u[m],T=u[(m+1)%u.length],A=u[(m+2)%u.length];h+=(b.x-T.x)*(A.y-T.y)-(A.x-T.x)*(b.y-T.y)}h>0&&u.reverse();const p=Nm(u.flatMap((m=>[m.x,m.y])),[]);return p.length===0?null:{vertices:u,indices:p}}function d5(o,e){const i=[],u=[];let h=0;const p=[];for(const m of o){h=i.length;const b=m.vertexArray.float32,T=m.indexArray.uint16;for(let A=0;A<m.vertexArray.length;A++)p[0]=b[3*A+0],p[1]=b[3*A+1],p[2]=b[3*A+2],Er(p,p,e),i.push(new Ct(p[0],p[1]));for(let A=0;A<3*m.indexArray.length;A++)u.push(T[A]+h)}if(u.length%3!=0)return null;for(let m=0;m<u.length;m+=3){const b=i[u[m+0]],T=i[u[m+1]],A=i[u[m+2]];(b.x-T.x)*(A.y-T.y)-(A.x-T.x)*(b.y-T.y)>0&&([u[m+1],u[m+2]]=[u[m+2],u[m+1]])}return{vertices:i,indices:u}}function QP(o){const e=(function(T,A){const M=[],O=WebGL2RenderingContext;if(T.json.textures)for(const D of T.json.textures){const N={magFilter:O.LINEAR,minFilter:O.NEAREST,wrapS:O.REPEAT,wrapT:O.REPEAT};D.sampler!==void 0&&Object.assign(N,T.json.samplers[D.sampler]),M.push({image:A[D.source],sampler:N,uploaded:!1})}return M})(o,o.images),i=(function(T,A){const M=[];for(const O of T.json.meshes){const D=[];for(const N of O.primitives)D.push(c5(N,T,A));M.push(D)}return M})(o,e),{scenes:u,scene:h,nodes:p}=o.json,m=u?u[h||0].nodes:p,b=[];for(const T of m)b.push(JP(p[T],o,i));return(function(T,A,M){const O={},D=new Set;for(let N=0;N<T.length;N++){const U=M[A[N]];if(!U.extras)continue;const H=U.extras["mapbox:footprint:version"],X=U.extras["mapbox:footprint:id"];(H||X)&&D.add(N),H==="1.0.0"&&X&&(O[X]=N)}for(let N=0;N<T.length;N++){if(D.has(N))continue;const U=T[N],H=M[A[N]];if(!H.extras)continue;let X=null;U.id in O&&(X=d5(T[O[U.id]].meshes,U.matrix)),X||(X=f5(H)),X&&(U.footprint=h5(X))}if(D.size>0){const N=Array.from(D.values()).sort(((U,H)=>U-H));for(let U=N.length-1;U>=0;U--)T.splice(N[U],1)}})(b,m,o.json.nodes),b}function p5(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const e=o.vertexArray.float32,i=o.aabb.min[0]-1,u=o.aabb.min[1]-1,h=Wp/(o.aabb.max[0]-i+2),p=Wp/(o.aabb.max[1]-u+2);for(let m=0;m<e.length;m+=3){const b=e[m+2],T=(e[m+0]-i)*h|0,A=(e[m+1]-u)*p|0;b>o.heightmap[A*Wp+T]&&(o.heightmap[A*Wp+T]=b)}}function eI(o,e,i,u,h){i.reserve(i.length+4*o.length),u.reserve(u.length+10*o.length),h.reserve(h.length+10*o.length);let p=u.length;for(const m of o){const b=Math.min(10,Math.max(4,1.3*m.height))*e,T=[-m.normal[1],m.normal[0],0],A=Math.min(.29,.1*m.width/m.depth),M=m.width-2*m.depth*e*(A+.01),O=pt([],m.pos,T,M/2),D=pt([],m.pos,T,-M/2),N=[O[0],O[1],O[2]+m.height],U=[D[0],D[1],D[2]+m.height],H=pt([],m.normal,T,A);$e(H,H,b);const X=pt([],m.normal,T,-A);$e(X,X,b),Tt(H,O,H),Tt(X,D,X),O[2]+=.1,D[2]+=.1,u.emplaceBack(H[0],H[1],H[2]),u.emplaceBack(X[0],X[1],X[2]),u.emplaceBack(O[0],O[1],O[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(N[0],N[1],N[2]),u.emplaceBack(U[0],U[1],U[2]),u.emplaceBack(O[0],O[1],O[2]),u.emplaceBack(D[0],D[1],D[2]),u.emplaceBack(H[0],H[1],H[2]),u.emplaceBack(X[0],X[1],X[2]);const te=M/b/2;h.emplaceBack(-te-A,-1,te,.8),h.emplaceBack(te+A,-1,te,.8),h.emplaceBack(-te,0,te,1.3),h.emplaceBack(te,0,te,1.3),h.emplaceBack(te+A,-.8,te,.7),h.emplaceBack(te+A,-.8,te,.7),h.emplaceBack(0,0,te,1.3),h.emplaceBack(0,0,te,1.3),h.emplaceBack(te+A,-1.2,te,.8),h.emplaceBack(te+A,-1.2,te,.8),i.emplaceBack(6+p,4+p,8+p),i.emplaceBack(7+p,9+p,5+p),i.emplaceBack(0+p,1+p,2+p),i.emplaceBack(1+p,3+p,2+p),p+=10}}function m5(o,e){const i={};i.indexArray=new ai,i.vertexArray=new ma,i.colorArray=new Us,eI(o,e,i.indexArray,i.vertexArray,i.colorArray);const u={defined:!0};u.emissiveFactor=wn.black;const h={};return h.baseColorFactor=wn.white,u.pbrMetallicRoughness=h,i.material=u,i.aabb=new Mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const tI=mn([{name:"a_pos_3f",components:3,type:"Float32"}]),g5=mn([{name:"a_normal_3",components:3,type:"Int16"}]),rI=mn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),_5=mn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),nI=Ye.types,gb=32767;function y5(o,e){const i=$t+e;for(const u of o)for(const h of u)if(h.x<-e||h.x>i||h.y<-e||h.y>i)return!1;return!0}class iI{constructor(e){this.layoutAOArray=[],this.indexArrayForConflationUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.layoutVertexArray=new ma,this.layoutNormalArray=new vh,this.layoutColorArray=new Vs,this.indexArray=new ai,this.indexArrayForConflation=new ai,this.entranceBloom={layoutVertexArray:new ma,layoutVertexBuffer:null,layoutAttenuationArray:new Us,layoutAttenuationBuffer:null,layoutColorArray:new Vs,layoutColorBuffer:null,indexArray:new ai,indexArrayForConflation:new ai,indexBuffer:null,segmentsBucket:new wi},this.programConfigurations=new Wa(e.layers,{zoom:e.zoom,lut:e.lut}),this.segmentsBucket=new wi,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.groundEffect=new tb(e)}get segments(){return this.segmentsBucket}get bloomGeometry(){return this.entranceBloom}updateFootprints(e,i){for(const u of this.footprints)i.push({footprint:u,id:e})}prepare(){return(function(){if(sv!=null||FP!=null)return null;if(qm!=null)return qm;const e=fetch(Bo.BUILDING_GEN_URL);return qm=(function(i){let u,h,p,m;function b(){u=new Uint8Array(m.buffer),h=new Int32Array(m.buffer),p=new Float32Array(m.buffer)}function T(){throw new Error("Unexpected BuildingGen error.")}const A=()=>{},M={a:{a:T,f:function(O){const D=u.length,N=Math.max(O>>>0,Math.ceil(1.2*D)),U=Math.ceil((N-D)/65536);try{return m.grow(U),b(),!0}catch{return!1}},g:T,b:A,c:A,d:A,e:A}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,M):i.then((O=>O.arrayBuffer())).then((O=>WebAssembly.instantiate(O,M)))).then((O=>{const D=O.instance.exports;return(0,D.g)(),m=D.f,b(),new Xj({setStyle:D.h,setAOOptions:D.i,setMetricOptions:D.j,setStructuralOptions:D.k,setFacadeOptions:D.l,setFauxFacadeOptions:D.m,setFacadeClassifierOptions:D.n,addFeature:D.o,addFacade:D.p,generateMesh:D.q,getLastError:D.r,getMeshCount:D.s,getPositionsPtr:D.t,getPositionsLength:D.u,getNormalsPtr:D.v,getNormalsLength:D.w,getColorsPtr:D.x,getColorsLength:D.y,getAOPtr:D.z,getAOLength:D.A,getUVPtr:D.B,getUVLength:D.C,getFauxFacadePtr:D.D,getFauxFacadeLength:D.E,getIndicesPtr:D.F,getIndicesLength:D.G,getBuildingPart:D.H,getRingCount:D.I,getRingPtr:D.J,getRingLength:D.K,free:D.L,malloc:D.M,heapU8:u,heap32:h,heapF32:p})}))})(e).then((i=>(qm=null,sv=i,sv))).catch((i=>{hn("Could not load building-gen"),qm=null,FP=i})),qm})()}populate(e,i,u,h){const p=Kj();if(!p)return;const m=Ee(u);this.tileToMeter=m,this.brightness=i.brightness,p.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,m],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:m,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),p.setAOOptions(!1,.3),p.setMetricOptions(!1,16),p.setStructuralOptions(!0),p.setFacadeOptions(4,!0),p.setFauxFacadeOptions(!1,!1,1),p.setFacadeClassifierOptions(3);const b=new Map;for(const{feature:T}of e){if(nI[T.type]!=="LineString")continue;const A=this.layers[0]._featureFilter.needGeometry,M=tt(T,A);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom),M,u))continue;const O=A?M.geometry:Re(T,u,h),D=[];for(const X of O)for(const te of X)D.push({x:te.x,y:te.y});const N={coordinates:D,crossPerc:T.properties.cross_perc,distanceToRoad:T.properties.distance_to_road,entrances:T.properties.entrances,sourceId:0},U=T.properties.source_id;let H=b.get(U);H||(H=[],b.set(U,H)),H.push(N)}this.maxHeight=0;for(const{feature:T,index:A}of e){if(nI[T.type]==="LineString")continue;const M=this.layers[0]._featureFilter.needGeometry,O=tt(T,M);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom),O,u))continue;const D=M?O.geometry:Re(T,u,h),N=s_(D,500);if(!y5(D,163))continue;const U=this.layers[0],H=U.layout.get("building-base").evaluate(T,{},u),X=U.layout.get("building-height").evaluate(T,{},u),te=U.layout.get("building-roof-shape").evaluate(T,{},u),ue=U.paint.get("building-ambient-occlusion-intensity"),le=U.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(te==="flat")continue;const fe=T.properties.source_id;let De;De=b.has(fe)?b.get(fe):[];const Ie=[],Ce=new Ct(1/0,1/0),Be=new Ct(-1/0,-1/0);for(const At of N)if(At.length>0){const zt=[];for(const hr of At){const er=[];for(let Gt=hr.length-1;Gt>=0;Gt--){const rr=hr[Gt];er.push({x:rr.x,y:rr.y}),Ce.x=Math.min(Ce.x,rr.x),Ce.y=Math.min(Ce.y,rr.y),Be.x=Math.max(Be.x,rr.x),Be.y=Math.max(Be.y,rr.y)}zt.push(er)}Ie.push({id:T.id,height:X,minHeight:H,sourceId:0,roofType:te,coordinates:zt})}const je=p.generateMesh(Ie,De);if(typeof je=="string"||je.meshes.length===0||je.modifiedPolygonRings.length===0)continue;let st=0;for(const At of je.meshes)st+=At.positions.length/3;const Ge=this.segmentsBucket.prepareSegment(st,this.layoutVertexArray,this.indexArray),ft=[];let jt=null,_t=0,Mt=-1;const Ft=this.indexArray.length;let ot=0;for(const At of je.meshes){const zt=this.layoutVertexArray.length;if(At.buildingPart==="entrance"){const er=new Array;for(let Fr=0;Fr<At.indices.length;Fr+=12){const Zr=At.positions[Fr+0],qr=At.positions[Fr+1],yn=At.positions[Fr+3],nn=At.positions[Fr+4],fi=At.positions[Fr+2],me=At.positions[Fr+8]-fi,ge=1,nt=yn-Zr,Vt=nn-qr,Kt=Math.hypot(nt,Vt);er.push({pos:[Zr+.5*nt,qr+.5*Vt,fi],normal:[Vt/Kt,-nt/Kt,0],width:Kt,height:me,depth:ge,points:[Zr,qr,yn,nn]})}const Gt=this.entranceBloom.segmentsBucket.prepareSegment(10*er.length,this.entranceBloom.layoutVertexArray,this.entranceBloom.indexArray),rr=this.entranceBloom.layoutVertexArray.length;_t=this.entranceBloom.indexArray.length,eI(er,.5/this.tileToMeter,this.entranceBloom.indexArray,this.entranceBloom.layoutVertexArray,this.entranceBloom.layoutAttenuationArray);const Pr=this.entranceBloom.layoutVertexArray.length-rr;Mt=this.entranceBloom.indexArray.length-_t;for(let Fr=0;Fr<Pr;Fr++)this.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Gt.vertexLength+=Pr,Gt.primitiveLength+=Mt,jt={part:At.buildingPart,vertexOffset:rr,vertexLength:Pr}}for(let er=0;er<At.positions.length;er+=3)ot=Math.max(ot,At.positions[er+2]),this.layoutVertexArray.emplaceBack(At.positions[er],At.positions[er+1],At.positions[er+2]);for(let er=0;er<At.normals.length;er+=3)this.layoutNormalArray.emplaceBack(At.normals[er+0]*gb,At.normals[er+1]*gb,At.normals[er+2]*gb);for(let er=0;er<At.ao.length;er++)this.layoutAOArray.push(At.ao[er]);for(let er=0;er<At.colors.length;er+=3){const Gt=1+(At.ao[er/3]-1)*ue;this.layoutColorArray.emplaceBack(At.colors[er]*Gt<<8|At.colors[er+1]*Gt,At.colors[er+2]*Gt<<8)}const hr=Ge.vertexLength;for(let er=0;er<At.indices.length;er+=3)this.indexArray.emplaceBack(hr+At.indices[er],hr+At.indices[er+1],hr+At.indices[er+2]);Ge.vertexLength+=At.positions.length/3,Ge.primitiveLength+=At.indices.length/3,(At.buildingPart==="roof"||At.buildingPart==="wall"||At.buildingPart==="facade_glazing"||At.buildingPart==="entrance")&&ft.push({part:At.buildingPart,vertexOffset:zt,vertexLength:At.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,ot),this.buildingFeatures.push({feature:O,segment:Ge,parts:ft,buildingBloom:jt});const Ot=this.indexArray.length-Ft,Xe=[],at=[],Ut=new Ct(1/0,1/0),Rt=new Ct(-1/0,-1/0),gr=this.groundEffect.vertexArray.length;for(const At of je.modifiedPolygonRings){const zt=[],hr=new Ct(1/0,1/0),er=new Ct(-1/0,-1/0);for(let Gt=0;Gt<At.length;Gt+=2){const rr=At.length-Gt-2;hr.x=Math.min(hr.x,At[rr]),hr.y=Math.min(hr.y,At[rr+1]),er.x=Math.max(er.x,At[rr]),er.y=Math.max(er.y,At[rr+1]);const Pr=new Ct(At[rr],At[rr+1]);zt.push(Pr),Xe.push(Pr.x,Pr.y),at.push(Pr.clone())}Ut.x=Math.min(Ut.x,hr.x),Ut.y=Math.min(Ut.y,hr.y),Rt.x=Math.max(Rt.x,er.x),Rt.y=Math.max(Rt.y,er.y),this.groundEffect.addData(zt,[hr,er],le)}const ar=this.groundEffect.vertexArray.length-gr;(Ce.x<0||Be.x>$t||Ce.y<0||Be.y>$t)&&this.featuresOnBorder.push({featureId:T.id,footprintIndex:this.footprints.length});{const At=Nm(Xe,null,2),zt=new ev(at,At,8,256);let hr=T.id;T.properties&&T.properties.hasOwnProperty("building_id")&&(hr=T.properties.building_id),this.footprints.push({vertices:at,indices:At,grid:zt,min:Ut,max:Rt,buildingId:hr,hiddenFlags:0,indicesOffset:Ft,indicesLength:Ot,bloomIndicesOffset:_t,bloomIndicesLength:Mt,groundEffectVertexOffset:gr,groundEffectVertexLength:ar,segment:Ge,height:ot})}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,T,A,{},i.availableImages,u,i.brightness),this.groundEffect.addPaintPropertiesData(T,A,{},i.availableImages,u,i.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0])}update(e,i,u,h,p,m,b){this.programConfigurations.updatePaintArrays(e,i,p,u,h,m,b),this.groundEffect.update(e,i,p,u,h,m,b)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tI.members),this.layoutNormalBuffer=e.createVertexBuffer(this.layoutNormalArray,g5.members),this.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(this.entranceBloom.layoutVertexArray,tI.members),this.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(this.entranceBloom.layoutAttenuationArray,_5.members),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutNormalBuffer.destroy(),this.layoutColorBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segmentsBucket.destroy(),this.entranceBloom.layoutVertexBuffer.destroy(),this.entranceBloom.layoutColorBuffer.destroy(),this.entranceBloom.layoutAttenuationBuffer.destroy(),this.entranceBloom.indexBuffer.destroy(),this.entranceBloom.segmentsBucket.destroy())}updateFootprintHiddenFlags(e,i,u=!0){let h=!1;const p=u?i:0,m=0|(u?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const b of e){const T=this.footprints[b],A=T.hiddenFlags&m|p;T.hiddenFlags!==A&&(T.hiddenFlags=A,h=!0,this.groundEffect.updateHiddenByLandmarkRange(T.groundEffectVertexOffset,T.groundEffectVertexLength,T.hiddenFlags!==0))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),!this.indexArrayForConflationUploaded&&this.indexArray.length!==0){this.indexArrayForConflation.resize(this.indexArray.length),this.indexArrayForConflation.uint16.set(this.indexArray.uint16),this.entranceBloom.indexArrayForConflation.resize(this.entranceBloom.indexArray.length),this.entranceBloom.indexArrayForConflation.uint16.set(this.entranceBloom.indexArray.uint16);for(const i of this.footprints){const u=i.indicesOffset+i.indicesLength;if(i.hiddenFlags!==0){for(let p=i.indicesOffset;p<u;p++)this.indexArrayForConflation.uint16[3*p+0]=0,this.indexArrayForConflation.uint16[3*p+1]=0,this.indexArrayForConflation.uint16[3*p+2]=0;const h=i.bloomIndicesOffset+i.bloomIndicesLength;for(let p=i.bloomIndicesOffset;p<h;p++)this.entranceBloom.indexArrayForConflation.uint16[3*p+0]=0,this.entranceBloom.indexArrayForConflation.uint16[3*p+1]=0,this.entranceBloom.indexArrayForConflation.uint16[3*p+2]=0}}this.indexBuffer?this.indexBuffer.updateData(this.indexArrayForConflation):this.indexBuffer=e.createIndexBuffer(this.indexArrayForConflation,!0),this.entranceBloom.indexBuffer?this.entranceBloom.indexBuffer.updateData(this.entranceBloom.indexArrayForConflation):this.entranceBloom.indexBuffer=e.createIndexBuffer(this.entranceBloom.indexArrayForConflation,!0),this.indexArrayForConflationUploaded=!0}}uploadUpdatedColorBuffer(e){this.layoutColorBuffer?this.layoutColorBuffer.updateData(this.layoutColorArray):this.layoutColorBuffer=e.createVertexBuffer(this.layoutColorArray,rI.members,!0),this.entranceBloom.layoutColorBuffer?this.entranceBloom.layoutColorBuffer.updateData(this.entranceBloom.layoutColorArray):this.entranceBloom.layoutColorBuffer=e.createVertexBuffer(this.entranceBloom.layoutColorArray,rI.members,!0)}evaluate(e){const i=e.paint.get("building-ambient-occlusion-intensity");for(const u of this.buildingFeatures){const h=u.feature;h.properties["building-part"]="roof";const p=e.paint.get("building-color").evaluate(h,{},this.canonical),m=e.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);h.properties["building-part"]="wall";const b=e.paint.get("building-color").evaluate(h,{},this.canonical),T=e.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);h.properties["building-part"]="window";const A=e.paint.get("building-color").evaluate(h,{},this.canonical),M=e.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);h.properties["building-part"]="door";const O=e.paint.get("building-color").evaluate(h,{},this.canonical),D=e.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);for(const U of u.parts){let H,X=p;U.part==="roof"?(X=p,H=m):U.part==="wall"?(X=b,H=T):U.part==="facade_glazing"?(X=A,H=M):U.part==="entrance"&&(X=O,H=D),H=ve(H,0,1);for(let te=0;te<U.vertexLength;te++){const ue=U.vertexOffset+te,le=1+(this.layoutAOArray[ue]-1)*i;this.layoutColorArray.emplace(ue,X.r*le*255<<8|X.g*le*255,X.b*le*255<<8|255*H)}}const N=u.buildingBloom;if(N)for(let U=0;U<N.vertexLength;U++)this.bloomGeometry.layoutColorArray.emplace(N.vertexOffset+U,255*O.r<<8|255*O.g,255*O.b<<8|51*D)}}needsEvaluation(e,i){const u=e.transform.projectionOptions,h=e.style.getBrightness();return!(this.uploaded&&u.name===this.projection.name&&this.brightness===h||(this.projection=u,this.brightness=h,0))}updateReplacement(e,i,u){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped());if(rv(this.activeReplacements,h))return;this.activeReplacements=h;for(const m of this.footprints)m.hiddenFlags&=-2;const p=[];for(const m of this.activeReplacements){if(m.order<=uP)continue;const b=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));for(const T of this.footprints)T.min.x>m.max.x||T.max.x<m.min.x||T.min.y>m.max.y||T.max.y<m.min.y||(p.length=0,v5(T.vertices,0,T.vertices.length,m.footprintTileId.canonical,e.canonical,p),Yx(m.footprint,p,T.indices,0,T.indices.length,0,-b)&&(T.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const m of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(m.groundEffectVertexOffset,m.groundEffectVertexLength,m.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(e,i){let u=Number.NEGATIVE_INFINITY,h=!0;const p=4*(e+$t)*$t+(i+$t);if(this.footprintLookup.hasOwnProperty(p)){const b=this.footprintLookup[p];return b?{height:b.height,hidden:b.hiddenFlags!==0}:void 0}const m=new Ct(e,i);for(const b of this.footprints)e>b.max.x||b.min.x>e||i>b.max.y||b.min.y>i||b.height<=u||Jx(m,b)&&(u=b.height,this.footprintLookup[p]=b,h=b.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.footprintLookup[p]=void 0}}function v5(o,e,i,u,h,p){const m=Math.pow(2,u.z-h.z);for(let b=0;b<i;b++){let T=o[b+e].x,A=o[b+e].y;T=(T+h.x*$t)*m-u.x*$t,A=(A+h.y*$t)*m-u.y*$t,p.push(new Ct(T,A))}}let oI,aI;nr(iI,"BuildingBucket",{omit:["layers"]});const x5=mn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),b5=mn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:w5}=x5,S5=mn([{name:"a_packed",components:3,type:"Float32"}]),{members:T5}=S5,E5=mn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:A5}=E5;class sI{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Kd({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const u=this.getKey(e,i);return this.positions[u]}trim(){const e=this.width,i=this.height=vr(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,u){const h=[];let p=e.length%2==1?-e[e.length-1]*u:0,m=e[0]*u,b=!0;h.push({left:p,right:m,isDash:b,zeroLength:e[0]===0});let T=e[0];for(let A=1;A<e.length;A++){b=!b;const M=e[A];p=T*u,T+=M,m=T*u,h.push({left:p,right:m,isDash:b,zeroLength:M===0})}return h}addRoundDash(e,i,u){const h=i/2;for(let p=-u;p<=u;p++){const m=this.width*(this.nextRow+u+p);let b=0,T=e[b];for(let A=0;A<this.width;A++){A/T.right>1&&(T=e[++b]);const M=Math.abs(A-T.left),O=Math.abs(A-T.right),D=Math.min(M,O);let N;const U=p/u*(h+1);if(T.isDash){const H=h-Math.abs(U);N=Math.sqrt(D*D+H*H)}else N=h-Math.sqrt(D*D+U*U);this.image.data[m+A]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(e,i){for(let T=e.length-1;T>=0;--T){const A=e[T],M=e[T+1];A.zeroLength?e.splice(T,1):M&&M.isDash===A.isDash&&(M.left=A.left,e.splice(T,1))}const u=e[0],h=e[e.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);const p=this.width*this.nextRow;let m=0,b=e[m];for(let T=0;T<this.width;T++){T/b.right>1&&(b=e[++m]);const A=Math.abs(T-b.left),M=Math.abs(T-b.right),O=Math.min(A,M);this.image.data[p+T]=Math.max(0,Math.min(255,(b.isDash?O:-O)+i+128))}}addDash(e,i){const u=this.getKey(e,i);if(this.positions[u])return this.positions[u];const h=i==="round",p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return hn("LineAtlas out of space"),null;e.length===0&&e.push(1);let b=0;for(let M=0;M<e.length;M++)e[M]<0&&(hn("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),b+=e[M];if(b!==0){const M=this.width/b,O=this.getDashRanges(e,this.width,M);h?this.addRoundDash(O,M,p):this.addRegularDash(O,i==="square"?.5*M:0)}const T=this.nextRow+p;this.nextRow+=m;const A={tl:[T,p],br:[b,0]};return this.positions[u]=A,A}}nr(sI,"LineAtlas");const P5=Ye.types,I5=Math.cos(Math.PI/180*37.5),C5=Math.cos(Math.PI/180*5);class _b{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new Ef,this.layoutVertexArray2=new ma,this.patternVertexArray=new ma,this.indexArray=new ai,this.programConfigurations=new Wa(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new wi,this.maxLineLength=0,this.zOffsetVertexArray=new ma,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:$t/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,u,h){this.hasPattern=Gx("line",this.layers,this.pixelRatio,i);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ee(u);const m=this.layers[0].layout.get("line-elevation-reference");if(m==="hd-road-markup")this.elevationType="road";else{const D=this.layers[0].layout.get("line-z-offset"),N=D.isConstant()&&!D.constantOr(0);this.elevationType=m!=="sea"&&m!=="ground"&&N?"none":"offset",this.elevationType==="offset"&&m==="none"&&hn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const b=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&b!==void 0;const T=[];for(const{feature:D,id:N,index:U,sourceLayerIndex:H}of e){const X=this.layers[0]._featureFilter.needGeometry,te=tt(D,X);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{worldview:this.worldview}),te,u))continue;const ue=p?p.evaluate(te,{},u):void 0,le={id:N,properties:D.properties,type:D.type,sourceLayerIndex:H,index:U,geometry:X?te.geometry:Re(D,u,h),patterns:{},sortKey:ue};T.push(le)}p&&T.sort(((D,N)=>D.sortKey-N.sortKey));const{lineAtlas:A,featureIndex:M}=i,O=this.addConstantDashes(A);for(const D of T){const{geometry:N,index:U,sourceLayerIndex:H}=D;if(O&&this.addFeatureDashes(D,A),this.hasPattern){const X=Hx("line",this.layers,D,this.zoom,this.pixelRatio,i);this.patternFeatures.push(X)}else this.addFeature(D,N,U,u,A.positions,i.availableImages,i.brightness,i.elevationFeatures);M.insert(e[U].feature,N,U,H,this.index)}}addConstantDashes(e){let i=!1;for(const u of this.layers){const h=u.paint.get("line-dasharray").value,p=u.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")i=!0;else{const m=p.value,b=h.value;if(!b)continue;e.addDash(b,m)}}return i}addFeatureDashes(e,i){const u=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,m=h.layout.get("line-cap").value;if(p.kind==="constant"&&m.kind==="constant")continue;let b,T;if(p.kind==="constant"){if(b=p.value,!b)continue}else b=p.evaluate({zoom:u},e);T=m.kind==="constant"?m.value:m.evaluate({zoom:u},e),i.addDash(b,T),e.patterns[h.id]=[i.getKey(b,T)]}}update(e,i,u,h,p,m,b,T){this.programConfigurations.updatePaintArrays(e,i,p,u,h,m,b,T)}addFeatures(e,i,u,h,p,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,i,u,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,T5)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,A5)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,b5.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,w5),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,u,h,p,m,b,T){const A=this.layers[0].layout,M=A.get("line-join").evaluate(e,{}),O=A.get("line-cap").evaluate(e,{}),D=A.get("line-miter-limit"),N=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=A.get("line-z-offset").value;const U=this.layers[0].paint.get("line-width").value;if(U.kind!=="constant"&&U.isLineProgressConstant===!1&&(this.variableWidthValue=U),this.elevationType==="road"){const H=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,h,T,M,O,D,N)){const[X,te]=this.clipRuntimeLinesToTile(i,1);for(let ue=0;ue<X.length;ue++){const le=X[ue],fe=te[ue],De={progress:{min:fe.progress.min,max:fe.progress.max},nextDir:this.computeSegNextDir(fe,le),prevDir:this.computeSegPrevDir(fe,le)};this.addLine(le,e,h,M,O,D,N,De)}this.fillNonElevatedRoadSegment(H)}}else for(const H of i)this.addLine(H,e,h,M,O,D,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,p,m,h,b,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return ov(e,-i,-i,$t+i,$t+i)}clipRuntimeLinesToTile(e,i){const u=[];return[ov(e,-i,-i,$t+i,$t+i,u),u]}addElevatedRoadFeature(e,i,u,h,p,m,b,T){const A=[],M=Si.getElevationFeature(e,h);if(M){const O=this.clipLinesToTile(i,1),D=this.prepareElevatedLines(O,M,u);for(const N of D)A.push({geometry:N,elevation:M,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(A.length===0)return!1;for(const O of A){const D=this.layoutVertexArray.length;this.addLine(O.geometry,e,u,p,m,b,T);const N=new xn(u,O.elevationTileID);if(O.elevation)for(let U=D;U<this.layoutVertexArray.length;U++){const H=new Ct(this.layoutVertexArray.int16[6*U]>>1,this.layoutVertexArray.int16[6*U+1]>>1),X=N.pointElevation(H,O.elevation,.05);this.updateHeightRange(X),this.zOffsetVertexArray.emplaceBack(X,0,0)}else this.fillNonElevatedRoadSegment(D)}return!0}prepareElevatedLines(e,i,u){if(i.constantHeight!=null)return e;const h=[],p=1/Ee(u);for(const m of e)Hj(m,new Gn(i,p),0,h);return h}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,u,h,p,m,b,T){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const A=h==="none";this.patternJoinNone=this.hasPattern&&A,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const M=T&&T.progress.min>0,O=T&&T.progress.max<1;if(this.lineClips){let Be={min:this.lineClips.start,max:this.lineClips.end},je=1;if(T){const ft=this.lineClips.end-this.lineClips.start;Be=(function(jt,_t,Mt){return{min:Ta(jt.min,_t,Mt),max:Ta(jt.max,_t,Mt)}})(T.progress,{min:0,max:1},Be),ft>0&&(je=(Be.max-Be.min)/ft)}const st=+i.properties.mapbox_clip_feature_len,Ge=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(st)||Number.isNaN(Ge)){for(let jt=0;jt<e.length-1;jt++)this.totalDistance+=e[jt].dist(e[jt+1]);const ft=this.totalDistance/(Be.max-Be.min);this.totalFeatureLength=Number.isFinite(ft)?ft:0,this.lineClips.start=Be.min,this.lineClips.end=Be.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=st,this.distance=Ge*je,this.lineClips.start=Be.min,this.lineClips.end=Be.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const D=P5[i.type]==="Polygon";let N=e.length;for(;N>=2&&e[N-1].equals(e[N-2]);)N--;let U=0;for(;U<N-1&&e[U].equals(e[U+1]);)U++;if(N<(D?3:2))return;h==="bevel"&&(m=1.05);const H=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let X,te,ue,le,fe,De,Ie,Ce;T&&T.prevDir&&(De=T.prevDir.perp()),T&&T.nextDir&&(Ie=T.nextDir.perp()),this.e1=this.e2=-1,D&&(X=e[N-2],fe=e[U].sub(X)._unit()._perp());for(let Be=U;Be<N;Be++){if(ue=Be===N-1?D?e[U+1]:void 0:e[Be+1],ue&&e[Be].equals(ue))continue;fe&&(le=fe),X&&(te=X),X=e[Be],Ce=this.evaluateLineProgressFeatures(te?te.dist(X):0),fe=ue?ue.sub(X)._unit()._perp():le,le=le||fe;const je=te&&ue;let st=je?h:D||A?"butt":p;const Ge=le.x*fe.x+le.y*fe.y;if(A){const Xe=function(at){if(at.patternJoinNone){const Ut=at.segmentPoints.length/2,Rt=at.lineSoFar-at.segmentStart;for(let gr=0;gr<Ut;++gr){const ar=at.segmentPoints[2*gr+1],At=Math.round(at.segmentPoints[2*gr])+.5+.25*ar;at.patternVertexArray.emplaceBack(At,Rt,at.segmentStart),at.patternVertexArray.emplaceBack(At,Rt,at.segmentStart)}at.segmentPoints.length=0}at.e1=at.e2=-1};if(je&&Ge<C5){this.updateDistance(te,X),this.addCurrentVertex(X,le,1,1,H,Ce),Xe(this),this.addCurrentVertex(X,fe,-1,-1,H,Ce);continue}if(te){if(!ue){this.updateDistance(te,X),this.addCurrentVertex(X,le,1,1,H,Ce),Xe(this);continue}st="miter"}}let ft=le.add(fe);ft.x===0&&ft.y===0||ft._unit();const jt=ft.x*fe.x+ft.y*fe.y,_t=jt!==0?1/jt:1/0,Mt=2*Math.sqrt(2-2*jt),Ft=jt<I5&&te&&ue,ot=le.x*fe.y-le.y*fe.x>0,Ot=this.overscaling<=16?15*$t/(512*this.overscaling):0;if(je&&st==="round"){if(_t<b)st="miter";else if(_t<=2){const Xe=yb(X,-10,$t+10);st=this.elevationType==="offset"&&(Xe||this.hasCrossSlope)?"miter":"fakeround"}}if(st==="miter"&&_t>m&&(st="bevel"),st==="bevel"&&(_t>2&&(st="flipbevel"),_t<m&&(st="miter")),te&&!(st==="miter"&&Ft)&&this.updateDistance(te,X),st==="miter")if(Ft){const Xe=X.dist(te);if(Xe>2*Ot){const Ut=X.sub(X.sub(te)._mult(Ot/Xe)._round());this.updateDistance(te,Ut),this.addCurrentVertex(Ut,le,0,0,H,Ce),te=Ut}this.updateDistance(te,X),ft._mult(_t),this.addCurrentVertex(X,ft,0,0,H,Ce);const at=X.dist(ue);if(at>2*Ot){const Ut=X.add(ue.sub(X)._mult(Ot/at)._round());this.updateDistance(X,Ut),this.addCurrentVertex(Ut,fe,0,0,H,Ce),X=Ut}}else ft._mult(_t),this.addCurrentVertex(X,ft,0,0,H,Ce);else if(st==="flipbevel"){if(_t>100)ft=fe.mult(-1);else{const Xe=_t*le.add(fe).mag()/le.sub(fe).mag();ft._perp()._mult(Xe*(ot?-1:1))}this.addCurrentVertex(X,ft,0,0,H,Ce),this.addCurrentVertex(X,ft.mult(-1),0,0,H,Ce)}else if(st==="bevel"||st==="fakeround"){Ce!=null&&te&&this.addCurrentVertex(X,Ie||le,-1,-1,H,Ce);const Xe=X.dist(te)<=2*Ot&&st!=="bevel",at=ft.mult(ot?1:-1);at._mult(_t);const Ut=fe.mult(ot?-1:1),Rt=le.mult(ot?-1:1),gr=this.evaluateLineProgressFeatures(this.distance);if(Ce==null&&(this.addHalfVertex(X,at.x,at.y,!1,!ot,0,H,gr),Xe||this.addHalfVertex(X,at.x+2*Rt.x,at.y+2*Rt.y,!1,ot,0,H,gr)),st==="fakeround"){const ar=Math.round(180*Mt/Math.PI/20);this.addHalfVertex(X,Rt.x,Rt.y,!1,ot,0,H,gr);for(let At=0;At<ar;At++){let zt=At/ar;if(zt!==.5){const er=zt-.5;zt+=zt*er*(zt-1)*((1.0904+Ge*(Ge*(3.55645-1.43519*Ge)-3.2452))*er*er+(.848013+Ge*(.215638*Ge-1.06021)))}const hr=Ut.sub(Rt)._mult(zt)._add(Rt)._unit();this.addHalfVertex(X,hr.x,hr.y,!1,ot,0,H,gr)}this.addHalfVertex(X,Ut.x,Ut.y,!1,ot,0,H,gr)}Xe||Ce!=null||this.addHalfVertex(X,at.x+2*Ut.x,at.y+2*Ut.y,!1,ot,0,H,gr),Ce!=null&&ue&&this.addCurrentVertex(X,De||fe,1,1,H,Ce)}else if(st==="butt")this.addCurrentVertex(X,ft,0,0,H,Ce);else if(st==="square"){if(!te){const Xe=M?0:-1;this.addCurrentVertex(X,ft,Xe,Xe,H,Ce)}if(this.addCurrentVertex(X,ft,0,0,H,Ce),te){const Xe=O?0:1;this.addCurrentVertex(X,ft,Xe,Xe,H,Ce)}}else if(st==="round"){if(te){const Xe=!je&&Ie?Ie:le;this.addCurrentVertex(X,Xe,0,0,H,Ce),!je&&O||this.addCurrentVertex(X,Xe,1,1,H,Ce,!0)}if(ue){const Xe=!je&&De?De:fe;!je&&M||this.addCurrentVertex(X,Xe,-1,-1,H,Ce,!0),this.addCurrentVertex(X,Xe,0,0,H,Ce)}}}}addVerticesTo(e,i,u,h,p,m,b,T,A,M){const O=(i.w-e.w)/this.tessellationStep|0;let D=0;const N=this.scaledDistance;if(O>1){this.lineSoFar=e.w;const H=(i.x-e.x)/O,X=(i.y-e.y)/O,te=(i.z-e.z)/O,ue=(i.w-e.w)/O;for(let le=1;le<O;++le){e.x+=H,e.y+=X,e.z+=te,this.lineSoFar+=ue,D+=ue;const fe=this.evaluateLineProgressFeatures(this.prevDistance+D);this.scaledDistance=(this.prevDistance+D)/this.totalDistance,this.addHalfVertex(e,u,h,M,!1,b,A,fe),this.addHalfVertex(e,p,m,M,!0,-T,A,fe)}}this.lineSoFar=i.w,this.scaledDistance=N;const U=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,u,h,M,!1,b,A,U),this.addHalfVertex(i,p,m,M,!0,-T,A,U)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):hn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,u,h,p,m,b=!1){const T=i.x+i.y*u,A=i.y-i.x*u,M=i.y*h-i.x,O=-i.y-i.x*h;if(m!=null){const D=this.elevationType==="offset",N=-10,U=$t+10,H=m.zOffset,X=new MP(e.x,e.y,H,this.lineSoFar),te=!!D&&yb(e,N,U),ue=this.lineSoFar,le=this.distance;if(this.currentVertex)if(te){const fe=this.currentVertexIsOutside,De=this.currentVertex,Ie=new MP(e.x,e.y,H,this.lineSoFar);if(RP(De,Ie,N,U),!yb(Ie,N,U)){if(fe){this.e1=this.e2=-1,this.distance-=De.dist(X),this.lineSoFar=De.w;const Ce=this.evaluateLineProgressFeatures(De.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(De,T,A,b,!1,u,p,Ce),this.addHalfVertex(De,M,O,b,!0,-h,p,Ce),this.prevDistance=this.distance}this.distance=this.prevDistance+De.dist(Ie),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(De,Ie,T,A,M,O,u,h,p,b),this.distance=le,this.scaledDistance=this.distance/this.totalDistance}}else{const fe=this.currentVertex;if(this.currentVertexIsOutside){RP(fe,X,N,U),this.e1=this.e2=-1,this.distance-=fe.dist(X),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=fe.w;const De=this.evaluateLineProgressFeatures(fe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(fe,T,A,b,!1,u,p,De),this.addHalfVertex(fe,M,O,b,!0,-h,p,De),this.prevDistance=this.distance,this.distance=le,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(fe,X,T,A,M,O,u,h,p,b)}else te||(this.addHalfVertex(e,T,A,b,!1,u,p,m),this.addHalfVertex(e,M,O,b,!0,-h,p,m));this.currentVertex=X,this.currentVertexIsOutside=te,this.lineSoFar=ue}else this.addHalfVertex(e,T,A,b,!1,u,p,m),this.addHalfVertex(e,M,O,b,!0,-h,p,m)}addHalfVertex({x:e,y:i},u,h,p,m,b,T,A){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(i<<1)+(m?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const O=wr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,O)}const M=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),T.primitiveLength++),m?this.e2=M:this.e1=M,A!=null&&this.zOffsetVertexArray.emplaceBack(A.zOffset,A.variableWidth,A.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function yb(o,e,i){return o.x<e||o.x>i||o.y<e||o.y>i}let lI,uI;function cI(o,e,i){return e*($t/(o.tileSize*Math.pow(2,i-o.tileID.overscaledZ)))}nr(_b,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const hI=(o,e,i)=>(1-i)*o+i*e;function fI(o,e){return 1/cI(o,1,e.tileZoom)}function dI(o,e,i,u){return o.translatePosMatrix(u||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const pI=o=>{const e=[];mI(o)&&e.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=o.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const u=o.layout.get("line-join").constantOr("miter")==="none",h=!!o.paint.get("line-pattern").constantOr(1);return u&&h&&e.push("LINE_JOIN_NONE"),e};function mI(o){const e=o.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let vb;const gI=()=>vb||(vb={layout:lI||(lI=new Ei({"line-cap":new Jt(Ve.layout_line["line-cap"]),"line-join":new Jt(Ve.layout_line["line-join"]),"line-miter-limit":new St(Ve.layout_line["line-miter-limit"]),"line-round-limit":new St(Ve.layout_line["line-round-limit"]),"line-sort-key":new Jt(Ve.layout_line["line-sort-key"]),"line-z-offset":new Jt(Ve.layout_line["line-z-offset"]),"line-elevation-reference":new St(Ve.layout_line["line-elevation-reference"]),"line-cross-slope":new St(Ve.layout_line["line-cross-slope"]),visibility:new St(Ve.layout_line.visibility),"line-width-unit":new St(Ve.layout_line["line-width-unit"])})),paint:uI||(uI=new Ei({"line-opacity":new Jt(Ve.paint_line["line-opacity"]),"line-color":new Jt(Ve.paint_line["line-color"]),"line-translate":new St(Ve.paint_line["line-translate"]),"line-translate-anchor":new St(Ve.paint_line["line-translate-anchor"]),"line-width":new Jt(Ve.paint_line["line-width"]),"line-gap-width":new Jt(Ve.paint_line["line-gap-width"]),"line-offset":new Jt(Ve.paint_line["line-offset"]),"line-blur":new Jt(Ve.paint_line["line-blur"]),"line-dasharray":new Jt(Ve.paint_line["line-dasharray"]),"line-pattern":new Jt(Ve.paint_line["line-pattern"]),"line-pattern-cross-fade":new St(Ve.paint_line["line-pattern-cross-fade"]),"line-gradient":new Au(Ve.paint_line["line-gradient"]),"line-trim-offset":new St(Ve.paint_line["line-trim-offset"]),"line-trim-fade-range":new St(Ve.paint_line["line-trim-fade-range"]),"line-trim-color":new St(Ve.paint_line["line-trim-color"]),"line-emissive-strength":new St(Ve.paint_line["line-emissive-strength"]),"line-border-width":new Jt(Ve.paint_line["line-border-width"]),"line-border-color":new Jt(Ve.paint_line["line-border-color"]),"line-occlusion-opacity":new St(Ve.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"})}))},vb);class M5 extends Jt{possiblyEvaluate(e,i){return i=new Un(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,u,h){return i=Qe({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,u,h)}}let v_;function _I(o,e){return e>0?e+2*o:o}const O5=mn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),R5=mn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),k5=mn([{name:"a_projected_pos",components:4,type:"Float32"}],4);mn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const D5=mn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),z5=mn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),L5=mn([{name:"a_texb",components:2,type:"Uint16"}]),F5=mn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),B5=mn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);mn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const yI=mn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),N5=mn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);mn([{name:"triangle",components:3,type:"Uint16"}]),mn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),mn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),mn([{type:"Float32",name:"offsetX"}]),mn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Yo=24;function j5(o,e,i){return o.sections.forEach((u=>{u.text=(function(h,p,m){const b=p.layout.get("text-transform").evaluate(m,{});return b==="uppercase"?h=h.toLocaleUpperCase():b==="lowercase"&&(h=h.toLocaleLowerCase()),cs.applyArabicShaping&&(h=cs.applyArabicShaping(h)),h})(u.text,e,i)})),o}const x_={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function U5(o){return o==="︶"||o==="﹈"||o==="︸"||o==="﹄"||o==="﹂"||o==="︾"||o==="︼"||o==="︺"||o==="︘"||o==="﹀"||o==="︐"||o==="︓"||o==="︔"||o==="｀"||o==="￣"||o==="︑"||o==="︒"}function V5(o){return o==="︵"||o==="﹇"||o==="︷"||o==="﹃"||o==="﹁"||o==="︽"||o==="︻"||o==="︹"||o==="︗"||o==="︿"}const xb=4294967296,vI=1/xb,xI=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let dv=class{constructor(o=new Uint8Array(16)){this.buf=ArrayBuffer.isView(o)?o:new Uint8Array(o),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(o,e,i=this.length){for(;this.pos<i;){const u=this.readVarint(),h=u>>3,p=this.pos;this.type=7&u,o(h,e,this),this.pos===p&&this.skip(u)}return e}readMessage(o,e){return this.readFields(o,e,this.readVarint()+this.pos)}readFixed32(){const o=this.dataView.getUint32(this.pos,!0);return this.pos+=4,o}readSFixed32(){const o=this.dataView.getInt32(this.pos,!0);return this.pos+=4,o}readFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*xb;return this.pos+=8,o}readSFixed64(){const o=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*xb;return this.pos+=8,o}readFloat(){const o=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,o}readDouble(){const o=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,o}readVarint(o){const e=this.buf;let i,u;return u=e[this.pos++],i=127&u,u<128?i:(u=e[this.pos++],i|=(127&u)<<7,u<128?i:(u=e[this.pos++],i|=(127&u)<<14,u<128?i:(u=e[this.pos++],i|=(127&u)<<21,u<128?i:(u=e[this.pos],i|=(15&u)<<28,(function(h,p,m){const b=m.buf;let T,A;if(A=b[m.pos++],T=(112&A)>>4,A<128||(A=b[m.pos++],T|=(127&A)<<3,A<128)||(A=b[m.pos++],T|=(127&A)<<10,A<128)||(A=b[m.pos++],T|=(127&A)<<17,A<128)||(A=b[m.pos++],T|=(127&A)<<24,A<128)||(A=b[m.pos++],T|=(1&A)<<31,A<128))return Hm(h,T,p);throw new Error("Expected varint not more than 10 bytes")})(i,o,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const o=this.readVarint();return o%2==1?(o+1)/-2:o/2}readBoolean(){return!!this.readVarint()}readString(){const o=this.readVarint()+this.pos,e=this.pos;return this.pos=o,o-e>=12&&xI?xI.decode(this.buf.subarray(e,o)):(function(i,u,h){let p="",m=u;for(;m<h;){const b=i[m];let T,A,M,O=null,D=b>239?4:b>223?3:b>191?2:1;if(m+D>h)break;D===1?b<128&&(O=b):D===2?(T=i[m+1],(192&T)==128&&(O=(31&b)<<6|63&T,O<=127&&(O=null))):D===3?(T=i[m+1],A=i[m+2],(192&T)==128&&(192&A)==128&&(O=(15&b)<<12|(63&T)<<6|63&A,(O<=2047||O>=55296&&O<=57343)&&(O=null))):D===4&&(T=i[m+1],A=i[m+2],M=i[m+3],(192&T)==128&&(192&A)==128&&(192&M)==128&&(O=(15&b)<<18|(63&T)<<12|(63&A)<<6|63&M,(O<=65535||O>=1114112)&&(O=null))),O===null?(O=65533,D=1):O>65535&&(O-=65536,p+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),p+=String.fromCharCode(O),m+=D}return p})(this.buf,e,o)}readBytes(){const o=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,o);return this.pos=o,e}readPackedVarint(o=[],e){const i=this.readPackedEnd();for(;this.pos<i;)o.push(this.readVarint(e));return o}readPackedSVarint(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSVarint());return o}readPackedBoolean(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readBoolean());return o}readPackedFloat(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFloat());return o}readPackedDouble(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readDouble());return o}readPackedFixed32(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFixed32());return o}readPackedSFixed32(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSFixed32());return o}readPackedFixed64(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readFixed64());return o}readPackedSFixed64(o=[]){const e=this.readPackedEnd();for(;this.pos<e;)o.push(this.readSFixed64());return o}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(o){const e=7&o;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(o,e){this.writeVarint(o<<3|e)}realloc(o){let e=this.length||16;for(;e<this.pos+o;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeSFixed32(o){this.realloc(4),this.dataView.setInt32(this.pos,o,!0),this.pos+=4}writeFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*vI),!0),this.pos+=8}writeSFixed64(o){this.realloc(8),this.dataView.setInt32(this.pos,-1&o,!0),this.dataView.setInt32(this.pos+4,Math.floor(o*vI),!0),this.pos+=8}writeVarint(o){(o=+o||0)>268435455||o<0?(function(e,i){let u,h;if(e>=0?(u=e%4294967296|0,h=e/4294967296|0):(u=~(-e%4294967296),h=~(-e/4294967296),4294967295^u?u=u+1|0:(u=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(p,m,b){b.buf[b.pos++]=127&p|128,p>>>=7,b.buf[b.pos++]=127&p|128,p>>>=7,b.buf[b.pos++]=127&p|128,p>>>=7,b.buf[b.pos++]=127&p|128,b.buf[b.pos]=127&(p>>>=7)})(u,0,i),(function(p,m){const b=(7&p)<<4;m.buf[m.pos++]|=b|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))})(h,i)})(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))}writeSVarint(o){this.writeVarint(o<0?2*-o-1:2*o)}writeBoolean(o){this.writeVarint(+o)}writeString(o){o=String(o),this.realloc(4*o.length),this.pos++;const e=this.pos;this.pos=(function(u,h,p){for(let m,b,T=0;T<h.length;T++){if(m=h.charCodeAt(T),m>55295&&m<57344){if(!b){m>56319||T+1===h.length?(u[p++]=239,u[p++]=191,u[p++]=189):b=m;continue}if(m<56320){u[p++]=239,u[p++]=191,u[p++]=189,b=m;continue}m=b-55296<<10|m-56320|65536,b=null}else b&&(u[p++]=239,u[p++]=191,u[p++]=189,b=null);m<128?u[p++]=m:(m<2048?u[p++]=m>>6|192:(m<65536?u[p++]=m>>12|224:(u[p++]=m>>18|240,u[p++]=m>>12&63|128),u[p++]=m>>6&63|128),u[p++]=63&m|128)}return p})(this.buf,o,this.pos);const i=this.pos-e;i>=128&&bI(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(o){this.realloc(4),this.dataView.setFloat32(this.pos,o,!0),this.pos+=4}writeDouble(o){this.realloc(8),this.dataView.setFloat64(this.pos,o,!0),this.pos+=8}writeBytes(o){const e=o.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=o[i]}writeRawMessage(o,e){this.pos++;const i=this.pos;o(e,this);const u=this.pos-i;u>=128&&bI(i,u,this),this.pos=i-1,this.writeVarint(u),this.pos+=u}writeMessage(o,e,i){this.writeTag(o,2),this.writeRawMessage(e,i)}writePackedVarint(o,e){e.length&&this.writeMessage(o,$5,e)}writePackedSVarint(o,e){e.length&&this.writeMessage(o,q5,e)}writePackedBoolean(o,e){e.length&&this.writeMessage(o,W5,e)}writePackedFloat(o,e){e.length&&this.writeMessage(o,G5,e)}writePackedDouble(o,e){e.length&&this.writeMessage(o,H5,e)}writePackedFixed32(o,e){e.length&&this.writeMessage(o,Z5,e)}writePackedSFixed32(o,e){e.length&&this.writeMessage(o,X5,e)}writePackedFixed64(o,e){e.length&&this.writeMessage(o,K5,e)}writePackedSFixed64(o,e){e.length&&this.writeMessage(o,Y5,e)}writeBytesField(o,e){this.writeTag(o,2),this.writeBytes(e)}writeFixed32Field(o,e){this.writeTag(o,5),this.writeFixed32(e)}writeSFixed32Field(o,e){this.writeTag(o,5),this.writeSFixed32(e)}writeFixed64Field(o,e){this.writeTag(o,1),this.writeFixed64(e)}writeSFixed64Field(o,e){this.writeTag(o,1),this.writeSFixed64(e)}writeVarintField(o,e){this.writeTag(o,0),this.writeVarint(e)}writeSVarintField(o,e){this.writeTag(o,0),this.writeSVarint(e)}writeStringField(o,e){this.writeTag(o,2),this.writeString(e)}writeFloatField(o,e){this.writeTag(o,5),this.writeFloat(e)}writeDoubleField(o,e){this.writeTag(o,1),this.writeDouble(e)}writeBooleanField(o,e){this.writeVarintField(o,+e)}};function Hm(o,e,i){return i?4294967296*e+(o>>>0):4294967296*(e>>>0)+(o>>>0)}function bI(o,e,i){const u=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(u);for(let h=i.pos-1;h>=o;h--)i.buf[h+u]=i.buf[h]}function $5(o,e){for(let i=0;i<o.length;i++)e.writeVarint(o[i])}function q5(o,e){for(let i=0;i<o.length;i++)e.writeSVarint(o[i])}function G5(o,e){for(let i=0;i<o.length;i++)e.writeFloat(o[i])}function H5(o,e){for(let i=0;i<o.length;i++)e.writeDouble(o[i])}function W5(o,e){for(let i=0;i<o.length;i++)e.writeBoolean(o[i])}function Z5(o,e){for(let i=0;i<o.length;i++)e.writeFixed32(o[i])}function X5(o,e){for(let i=0;i<o.length;i++)e.writeSFixed32(o[i])}function K5(o,e){for(let i=0;i<o.length;i++)e.writeFixed64(o[i])}function Y5(o,e){for(let i=0;i<o.length;i++)e.writeSFixed64(o[i])}const bb=3;function J5(o,e,i){e.glyphs=[],o===1&&i.readMessage(Q5,e)}function Q5(o,e,i){if(o===3){const{id:u,bitmap:h,width:p,height:m,left:b,top:T,advance:A}=i.readMessage(e4,{});e.glyphs.push({id:u,bitmap:new Kd({width:p+2*bb,height:m+2*bb},h),metrics:{width:p,height:m,left:b,top:T,advance:A}})}else o===4?e.ascender=i.readSVarint():o===5&&(e.descender=i.readSVarint())}function e4(o,e,i){o===1?e.id=i.readVarint():o===2?e.bitmap=i.readBytes():o===3?e.width=i.readVarint():o===4?e.height=i.readVarint():o===5?e.left=i.readSVarint():o===6?e.top=i.readSVarint():o===7&&(e.advance=i.readVarint())}const wI=bb,Zs={horizontal:1,vertical:2,horizontalOnly:3};class b_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const u=new b_;return u.scale=e||1,u.fontStack=i,u}static forImage(e){const i=new b_;return i.image=e,i}}class Wm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,u){const h=new Wm;for(let p=0;p<e.sections.length;p++){const m=e.sections[p];m.image?h.addImageSection(m,u):h.addTextSection(m,i)}return h}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,u){let h="";for(let p=0;p<i.length;p++){const m=i.charCodeAt(p+1)||null,b=i.charCodeAt(p-1)||null;h+=!u&&(m&&gf(m)&&!x_[i[p+1]]||b&&gf(b)&&!x_[i[p-1]])||!x_[i[p]]?i[p]:x_[i[p]]}return h})(this.text,e)}trim(){let e=0;for(let u=0;u<this.text.length&&pv[this.text.charCodeAt(u)];u++)e++;let i=this.text.length;for(let u=this.text.length-1;u>=0&&u>=e&&pv[this.text.charCodeAt(u)];u--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const u=new Wm;return u.text=this.text.substring(e,i),u.sectionIndex=this.sectionIndex.slice(e,i),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(b_.forText(e.scale,e.fontStack||i));const u=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(u)}addImageSection(e,i){const u=e.image?e.image.getPrimary():null;if(!u)return void hn("Can't add FormattedSection with an empty image.");u.scaleSelf(i);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(b_.forImage(u)),this.sectionIndex.push(this.sections.length-1)):hn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function wb(o,e,i,u,h,p,m,b,T,A,M,O,D,N,U,H=1){const X=Wm.fromFeature(o,h,H);O===Zs.vertical&&X.verticalizePunctuation(D);let te=[];const ue=(function(Ce,Be,je,st,Ge,ft){if(!Ce)return[];const jt=[],_t=(function(Ot,Xe,at,Ut,Rt,gr){let ar=0;for(let At=0;At<Ot.length();At++){const zt=Ot.getSection(At);ar+=SI(Ot.getCodePoint(At),zt,Ut,Rt,Xe,gr)}return ar/Math.max(1,Math.ceil(ar/at))})(Ce,Be,je,st,Ge,ft),Mt=Ce.text.indexOf("​")>=0;let Ft=0;for(let Ot=0;Ot<Ce.length();Ot++){const Xe=Ce.getSection(Ot),at=Ce.getCodePoint(Ot);if(pv[at]||(Ft+=SI(at,Xe,st,Ge,Be,ft)),Ot<Ce.length()-1){const Ut=!((ot=at)<11904||!(br["Bopomofo Extended"](ot)||br.Bopomofo(ot)||br["CJK Compatibility Forms"](ot)||br["CJK Compatibility Ideographs"](ot)||br["CJK Compatibility"](ot)||br["CJK Radicals Supplement"](ot)||br["CJK Strokes"](ot)||br["CJK Symbols and Punctuation"](ot)||br["CJK Unified Ideographs Extension A"](ot)||br["CJK Unified Ideographs"](ot)||br["Enclosed CJK Letters and Months"](ot)||br["Halfwidth and Fullwidth Forms"](ot)||br.Hiragana(ot)||br["Ideographic Description Characters"](ot)||br["Kangxi Radicals"](ot)||br["Katakana Phonetic Extensions"](ot)||br.Katakana(ot)||br["Vertical Forms"](ot)||br["Yi Radicals"](ot)||br["Yi Syllables"](ot)));(t4[at]||Ut||Xe.image)&&jt.push(EI(Ot+1,Ft,_t,jt,r4(at,Ce.getCodePoint(Ot+1),Ut&&Mt),!1))}}var ot;return AI(EI(Ce.length(),Ft,_t,jt,0,!0))})(X,A,p,e,u,N),{processBidirectionalText:le,processStyledBidirectionalText:fe}=cs;if(le&&X.sections.length===1){const Ce=le(X.toString(),ue);for(const Be of Ce){const je=new Wm;je.text=Be,je.sections=X.sections;for(let st=0;st<Be.length;st++)je.sectionIndex.push(0);te.push(je)}}else if(fe){const Ce=fe(X.text,X.sectionIndex,ue);for(const Be of Ce){const je=new Wm;je.text=Be[0],je.sectionIndex=Be[1],je.sections=X.sections,te.push(je)}}else te=(function(Ce,Be){const je=[],st=Ce.text;let Ge=0;for(const ft of Be)je.push(Ce.substring(Ge,ft)),Ge=ft;return Ge<st.length&&je.push(Ce.substring(Ge,st.length)),je})(X,ue);const De=[],Ie={positionedLines:De,text:X.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Ce,Be,je,st,Ge,ft,jt,_t,Mt,Ft,ot,Ot){let Xe=0,at=0,Ut=0;const Rt=_t==="right"?1:_t==="left"?0:.5;let gr=!1;for(const Gt of Ge){const rr=Gt.getSections();for(const Pr of rr){if(Pr.image)continue;const Fr=Be[Pr.fontStack];if(Fr&&(gr=Fr.ascender!==void 0&&Fr.descender!==void 0,!gr))break}if(!gr)break}let ar=0;for(const Gt of Ge){Gt.trim();const rr=Gt.getMaxScale(),Pr=(rr-1)*Yo,Fr={positionedGlyphs:[],lineOffset:0};Ce.positionedLines[ar]=Fr;const Zr=Fr.positionedGlyphs;let qr=0;if(!Gt.length()){at+=ft,++ar;continue}let yn=0,nn=0;for(let me=0;me<Gt.length();me++){const ge=Gt.getSection(me),nt=Gt.getSectionIndex(me),Vt=Gt.getCodePoint(me);let Kt=ge.scale,Xt=null,cr=null,Dr=null,fn=Yo,dn=0,en=Mt;en===Zs.vertical&&((At=Vt)===12312||At===12313||At===12316||At===12540||At===12448)&&(en=Zs.horizontal);const Qn=!(en===Zs.horizontal||!ot&&!wc(Vt)||ot&&(pv[Vt]||mh(Vt)));if(ge.image){const zi=st.get(ge.image.toString());if(!zi)continue;Dr=ge.image,Ce.iconsInText=Ce.iconsInText||!0,cr=zi.paddedRect;const Yr=zi.displaySize;Kt=Kt*Yo/Ot,Xt={width:Yr[0],height:Yr[1],left:0,top:-wI,advance:Qn?Yr[1]:Yr[0],localGlyph:!1},dn=gr?-Xt.height*Kt:rr*Yo-17-Yr[1]*Kt,fn=Xt.advance;const _i=(Qn?Yr[0]:Yr[1])*Kt-Yo*rr;_i>0&&_i>qr&&(qr=_i)}else{const zi=je[ge.fontStack];if(!zi)continue;zi[Vt]&&(cr=zi[Vt]);const Yr=Be[ge.fontStack];if(!Yr)continue;const _i=Yr.glyphs[Vt];if(!_i)continue;if(Xt=_i.metrics,fn=Vt!==8203?Yo:0,gr){const si=Yr.ascender!==void 0?Math.abs(Yr.ascender):0,Hn=Yr.descender!==void 0?Math.abs(Yr.descender):0,ki=(si+Hn)*Kt;yn<ki&&(yn=ki,nn=(si-Hn)/2*Kt),dn=-si*Kt}else dn=(rr-Kt)*Yo-17}Qn?(Ce.verticalizable=!0,Zr.push({glyph:Vt,image:Dr,x:Xe,y:at+dn,vertical:Qn,scale:Kt,localGlyph:Xt.localGlyph,fontStack:ge.fontStack,sectionIndex:nt,metrics:Xt,rect:cr}),Xe+=fn*Kt+Ft):(Zr.push({glyph:Vt,image:Dr,x:Xe,y:at+dn,vertical:Qn,scale:Kt,localGlyph:Xt.localGlyph,fontStack:ge.fontStack,sectionIndex:nt,metrics:Xt,rect:cr}),Xe+=Xt.advance*Kt+Ft)}Zr.length!==0&&(Ut=Math.max(Xe-Ft,Ut),gr?PI(Zr,Rt,qr,nn,ft*rr/2):PI(Zr,Rt,qr,0,ft/2)),Xe=0;const fi=ft*rr+qr;Fr.lineOffset=Math.max(qr,Pr),at+=fi,++ar}var At;const zt=at,{horizontalAlign:hr,verticalAlign:er}=Sb(jt);(function(Gt,rr,Pr,Fr,Zr,qr){const yn=(rr-Pr)*Zr,nn=-qr*Fr;for(const fi of Gt)for(const me of fi.positionedGlyphs)me.x+=yn,me.y+=nn})(Ce.positionedLines,Rt,hr,er,Ut,zt),Ce.top+=-er*zt,Ce.bottom=Ce.top+zt,Ce.left+=-hr*Ut,Ce.right=Ce.left+Ut,Ce.hasBaseline=gr})(Ie,e,i,u,te,m,b,T,O,A,D,U),!(function(Ce){for(const Be of Ce)if(Be.positionedGlyphs.length!==0)return!1;return!0})(De))return Ie}const pv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},t4={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function SI(o,e,i,u,h,p){if(e.image){const m=u.get(e.image.toString());return m?m.displaySize[0]*e.scale*Yo/p+h:0}{const m=i[e.fontStack],b=m&&m.glyphs[o];return b?b.metrics.advance*e.scale+h:0}}function TI(o,e,i,u){const h=Math.pow(o-e,2);return u?o<e?h/2:2*h:h+Math.abs(i)*i}function r4(o,e,i){let u=0;return o===10&&(u-=1e4),i&&(u+=150),o!==40&&o!==65288||(u+=50),e!==41&&e!==65289||(u+=50),u}function EI(o,e,i,u,h,p){let m=null,b=TI(e,i,h,p);for(const T of u){const A=TI(e-T.x,i,h,p)+T.badness;A<=b&&(m=T,b=A)}return{index:o,x:e,priorBreak:m,badness:b}}function AI(o){return o?AI(o.priorBreak).concat(o.index):[]}function Sb(o){let e=.5,i=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function PI(o,e,i,u,h){if(!(e||i||u||h))return;const p=o.length-1,m=o[p],b=(m.x+m.metrics.advance*m.scale)*e;for(let T=0;T<=p;T++)o[T].x-=b,o[T].y+=i+u+h}function II(o){return o.imagePrimary!==void 0&&o.top!==void 0&&o.bottom!==void 0&&o.left!==void 0&&o.right!==void 0}function n4(o,e,i,u){const{horizontalAlign:h,verticalAlign:p}=Sb(u),m=i[0]-o.displaySize[0]*h,b=i[1]-o.displaySize[1]*p;return{imagePrimary:o,imageSecondary:e,top:b,bottom:b+o.displaySize[1],left:m,right:m+o.displaySize[0]}}function CI(o,e,i,u,h,p){const m=o.imagePrimary;let b;if(m.content){const X=m.content,te=m.pixelRatio||1;b=[X[0]/te,X[1]/te,m.displaySize[0]-X[2]/te,m.displaySize[1]-X[3]/te]}const T=e.left*p,A=e.right*p;let M,O,D,N;i==="width"||i==="both"?(N=h[0]+T-u[3],O=h[0]+A+u[1]):(N=h[0]+(T+A-m.displaySize[0])/2,O=N+m.displaySize[0]);const U=e.top*p,H=e.bottom*p;return i==="height"||i==="both"?(M=h[1]+U-u[0],D=h[1]+H+u[2]):(M=h[1]+(U+H-m.displaySize[1])/2,D=M+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:M,right:O,bottom:D,left:N,collisionPadding:b}}function MI(o){return!o.imagePrimary.stretchX}function OI(o){return!o.imagePrimary.stretchY}function RI(o){return{width:o.right-o.left,height:o.bottom-o.top}}const Mh=128;function kI(o,e,i){const{expression:u}=e;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Un(o+1,{worldview:i}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:p}=u;let m=0;for(;m<h.length&&h[m]<=o;)m++;m=Math.max(0,m-1);let b=m;for(;b<h.length&&h[b]<o+1;)b++;b=Math.min(h.length-1,b);const T=h[m],A=h[b];return u.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:A,interpolationType:p}:{kind:"camera",minZoom:T,maxZoom:A,minSize:u.evaluate(new Un(T,{worldview:i})),maxSize:u.evaluate(new Un(A,{worldview:i})),interpolationType:p}}}function Tb(o,{uSize:e,uSizeT:i},{lowerSize:u,upperSize:h}){return o.kind==="source"?u/Mh:o.kind==="composite"?wr(u/Mh,h/Mh,i):e}function w_(o,e,i=1){let u=0,h=0;if(o.kind==="constant")h=o.layoutSize*i;else if(o.kind!=="source"){const{interpolationType:p,minZoom:m,maxZoom:b}=o,T=p?ve(wo.interpolationFactor(p,e,m,b),0,1):0;o.kind==="camera"?h=wr(o.minSize,o.maxSize,T)*i:u=T*i}return{uSizeT:u,uSize:h}}class Rf extends Ct{constructor(e,i,u,h,p){super(e,i),this.angle=h,this.z=u,p!==void 0&&(this.segment=p)}clone(){return new Rf(this.x,this.y,this.z,this.angle,this.segment)}}function DI(o,e,i,u,h){if(e.segment===void 0)return!0;let p=e,m=e.segment+1,b=0;for(;b>-i/2;){if(m--,m<0)return!1;b-=o[m].dist(p),p=o[m]}b+=o[m].dist(o[m+1]),m++;const T=[];let A=0;for(;b<i/2;){const M=o[m],O=o[m+1];if(!O)return!1;let D=o[m-1].angleTo(M)-M.angleTo(O);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:D}),A+=D;b-T[0].distance>u;)A-=T.shift().angleDelta;if(A>h)return!1;m++,b+=M.dist(O)}return!0}function zI(o){let e=0;for(let i=0;i<o.length-1;i++)e+=o[i].dist(o[i+1]);return e}function LI(o,e,i){return o?.6*e*i:0}function FI(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function i4(o,e,i,u,h,p){const m=LI(i,h,p),b=FI(i,u)*p;let T=0;const A=zI(o)/2;for(let M=0;M<o.length-1;M++){const O=o[M],D=o[M+1],N=O.dist(D);if(T+N>A){const U=(A-T)/N,H=wr(O.x,D.x,U),X=wr(O.y,D.y,U),te=new Rf(H,X,0,D.angleTo(O),M);return!m||DI(o,te,b,m,e)?te:void 0}T+=N}}function o4(o,e,i,u,h,p,m,b,T){const A=LI(u,p,m),M=FI(u,h),O=M*m,D=o[0].x===0||o[0].x===T||o[0].y===0||o[0].y===T;return e-O<e/4&&(e=O+e/4),BI(o,D?e/2*b%e:(M/2+2*p)*m*b%e,e,A,i,O,D,!1,T)}function BI(o,e,i,u,h,p,m,b,T){const A=p/2,M=zI(o);let O=0,D=e-i,N=[];for(let U=0;U<o.length-1;U++){const H=o[U],X=o[U+1],te=H.dist(X),ue=X.angleTo(H);for(;D+i<O+te;){D+=i;const le=(D-O)/te,fe=wr(H.x,X.x,le),De=wr(H.y,X.y,le);if(fe>=0&&fe<T&&De>=0&&De<T&&D-A>=0&&D+A<=M){const Ie=new Rf(fe,De,0,ue,U);u&&!DI(o,Ie,p,u,h)||N.push(Ie)}}O+=te}return b||N.length||m||(N=BI(o,O/2,i,u,h,p,m,!0,T)),N}function NI(o){let e=0,i=0;for(const m of o)e+=m.w*m.h,i=Math.max(i,m.w);o.sort(((m,b)=>b.h-m.h));const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,p=0;for(const m of o)for(let b=u.length-1;b>=0;b--){const T=u[b];if(!(m.w>T.w||m.h>T.h)){if(m.x=T.x,m.y=T.y,p=Math.max(p,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===T.w&&m.h===T.h){const A=u.pop();A&&b<u.length&&(u[b]=A)}else m.h===T.h?(T.x+=m.w,T.w-=m.w):m.w===T.w?(T.y+=m.h,T.h-=m.h):(u.push({x:T.x+m.w,y:T.y,w:T.w-m.w,h:m.h}),T.y+=m.h,T.h-=m.h);break}}return{w:h,h:p,fill:e/(h*p)||0}}nr(Rf,"Anchor");const Xp=1;class S_{static getImagePositionScale(e,i,u){if(i&&e&&e.options&&e.options.transform){const h=e.options.transform;return{x:h.a,y:h.d}}return{x:u,y:u}}constructor(e,i,u,h){this.paddedRect=e;const{pixelRatio:p,version:m,stretchX:b,stretchY:T,content:A,sdf:M,usvg:O}=i;this.pixelRatio=p,this.stretchX=b,this.stretchY=T,this.content=A,this.version=m,this.padding=u,this.sdf=M,this.usvg=O,this.scale=S_.getImagePositionScale(h,O,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Eb(o,e,i){const u=Il.parse(o),h=(function(p,m,b=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*b[0])+2*m,h:(p.data?p.data.height:p.height*b[1])+2*m}})(e,i,[u.options.transform.a,u.options.transform.d]);return{bin:h,imagePosition:new S_(h,e,i,u),imageVariant:u}}class jI{constructor(e,i,u){const h=new Map,p=new Map;this.haveRenderCallbacks=[];const m=[];this.addImages(e,h,Xp,m),this.addImages(i,p,2,m);const{w:b,h:T}=NI(m),A=new _a({width:b||1,height:T||1});for(const[M,O]of e.entries()){const D=h.get(M).paddedRect;_a.copy(O.data,A,{x:0,y:0},{x:D.x+Xp,y:D.y+Xp},O.data,u,O.sdf)}for(const[M,O]of i.entries()){const D=p.get(M),N=D.paddedRect;let U=D.padding;const H=N.x+U,X=N.y+U,te=O.data.width,ue=O.data.height;U=U>1?U-1:U,_a.copy(O.data,A,{x:0,y:0},{x:H,y:X},O.data,u),_a.copy(O.data,A,{x:0,y:ue-U},{x:H,y:X-U},{width:te,height:U},u),_a.copy(O.data,A,{x:0,y:0},{x:H,y:X+ue},{width:te,height:U},u),_a.copy(O.data,A,{x:te-U,y:0},{x:H-U,y:X},{width:U,height:ue},u),_a.copy(O.data,A,{x:0,y:0},{x:H+te,y:X},{width:U,height:ue},u),_a.copy(O.data,A,{x:te-U,y:ue-U},{x:H-U,y:X-U},{width:U,height:U},u),_a.copy(O.data,A,{x:0,y:ue-U},{x:H+te,y:X-U},{width:U,height:U},u),_a.copy(O.data,A,{x:0,y:0},{x:H+te,y:X+ue},{width:U,height:U},u),_a.copy(O.data,A,{x:te-U,y:0},{x:H-U,y:X+ue},{width:U,height:U},u)}this.lut=u,this.image=A,this.iconPositions=h,this.patternPositions=p}addImages(e,i,u,h){for(const[p,m]of e.entries()){const{bin:b,imagePosition:T,imageVariant:A}=Eb(p,m,u);i.set(p,T),h.push(b),m.hasRenderCallback&&this.haveRenderCallbacks.push(A.id)}}patchUpdatedImages(e,i,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((h=>e.hasImage(h,u))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const h of e.getUpdatedImages(u)){for(const p of this.iconPositions.keys()){const m=Il.parse(p);if(ea.isEqual(m.id,h)){const b=e.getImage(h,u);this.patchUpdatedImage(this.iconPositions.get(p),b,i)}}for(const p of this.patternPositions.keys()){const m=Il.parse(p);if(ea.isEqual(m.id,h)){const b=e.getImage(h,u);this.patchUpdatedImage(this.patternPositions.get(p),b,i)}}}}patchUpdatedImage(e,i,u){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,p]=e.tl,m=e.sdf;if(this.lut||m){const b={width:i.data.width,height:i.data.height},T=new _a(b);_a.copy(i.data,T,{x:0,y:0},{x:0,y:0},b,this.lut,m),u.update(T,{position:{x:h,y:p}})}else u.update(i.data,{position:{x:h,y:p}})}}nr(S_,"ImagePosition"),nr(jI,"ImageAtlas");const T_=1e20;function UI(o,e,i,u,h,p,m,b,T){for(let A=e;A<e+u;A++)VI(o,i*p+A,p,h,m,b,T);for(let A=i;A<i+h;A++)VI(o,A*p+e,1,u,m,b,T)}function VI(o,e,i,u,h,p,m){p[0]=0,m[0]=-T_,m[1]=T_,h[0]=o[e];for(let b=1,T=0,A=0;b<u;b++){h[b]=o[e+b*i];const M=b*b;do{const O=p[T];A=(h[b]-h[O]+M-O*O)/(b-O)/2}while(A<=m[T]&&--T>-1);T++,p[T]=b,m[T]=A,m[T+1]=T_}for(let b=0,T=0;b<u;b++){for(;m[T+1]<b;)T++;const A=p[T],M=b-A;o[e+b*i]=h[A]+M*M}}const Dc=2,Ab={none:0,ideographs:1,all:2};class Zm{constructor(e,i,u){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const u=[],h=this.url||Bo.GLYPHS_URL;for(const p in e)for(const m of e[p])u.push({stack:p,id:m});Ue(u,(({stack:p,id:m},b)=>{let T=this.entries[p];T||(T=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=T.glyphs[m];if(A!==void 0)return void b(null,{stack:p,id:m,glyph:A});if(A=this._tinySDF(T,p,m),A)return T.glyphs[m]=A,void b(null,{stack:p,id:m,glyph:A});const M=Math.floor(m/256);if(256*M>65535)return hn("glyphs > 65535 not supported"),void b(null,{stack:p,id:m,glyph:A});if(T.ranges[M])return void b(null,{stack:p,id:m,glyph:A});let O=T.requests[M];O||(O=T.requests[M]=[],Zm.loadGlyphRange(p,M,h,this.requestManager,((D,N)=>{if(N){T.ascender=N.ascender,T.descender=N.descender;for(const U in N.glyphs)this._doesCharSupportLocalGlyph(+U)||(T.glyphs[+U]=N.glyphs[+U]);T.ranges[M]=!0}for(const U of O)U(D,N);delete T.requests[M]}))),O.push(((D,N)=>{D?b(D):N&&b(null,{stack:p,id:m,glyph:N.glyphs[m]||null})}))}),((p,m)=>{if(p)i(p);else if(m){const b={};for(const{stack:T,id:A,glyph:M}of m)b[T]===void 0&&(b[T]={}),b[T].glyphs===void 0&&(b[T].glyphs={}),b[T].glyphs[A]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},b[T].ascender=this.entries[T].ascender,b[T].descender=this.entries[T].descender;i(null,b)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ab.none&&(this.localGlyphMode===Ab.all?!!this.localFontFamily:!!this.localFontFamily&&(br["CJK Unified Ideographs"](e)||br["Hangul Syllables"](e)||br.Hiragana(e)||br.Katakana(e)||br["CJK Symbols and Punctuation"](e)||br["CJK Unified Ideographs Extension A"](e)||br["CJK Unified Ideographs Extension B"](e)||br.Osage(e)))}_tinySDF(e,i,u){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let p=e.tinySDF;if(!p){let H="400";/bold/i.test(i)?H="900":/medium/i.test(i)?H="500":/light/i.test(i)&&(H="200"),p=e.tinySDF=new Zm.TinySDF({fontFamily:h,fontWeight:H,fontSize:24*Dc,buffer:3*Dc,radius:8*Dc}),p.fontWeight=H}if(this.localGlyphs[p.fontWeight][u])return this.localGlyphs[p.fontWeight][u];const m=String.fromCodePoint(u),{data:b,width:T,height:A,glyphWidth:M,glyphHeight:O,glyphLeft:D,glyphTop:N,glyphAdvance:U}=p.draw(m);return this.localGlyphs[p.fontWeight][u]={id:u,bitmap:new Kd({width:T,height:A},b),metrics:{width:M/Dc,height:O/Dc,left:D/Dc,top:N/Dc-27,advance:U/Dc,localGlyph:!0}}}}Zm.loadGlyphRange=function(o,e,i,u,h){const p=256*e,m=p+255,b=u.transformRequest(u.normalizeGlyphsURL(i).replace("{fontstack}",o).replace("{range}",`${p}-${m}`),ms.Glyphs);Vh(b,((T,A)=>{if(T)h(T);else if(A){const M={},O=(function(D){return new dv(D).readFields(J5,{})})(A);for(const D of O.glyphs)M[D.id]=D;h(null,{glyphs:M,ascender:O.ascender,descender:O.descender})}}))},Zm.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:i=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=i;const b=this.size=o+4*e,T=this._createCanvas(b),A=this.ctx=T.getContext("2d",{willReadFrequently:!0});A.font=`${m} ${p} ${o}px ${h}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(o),m=Math.ceil(i),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),T=Math.min(this.size-this.buffer,m+Math.ceil(u)),A=b+2*this.buffer,M=T+2*this.buffer,O=Math.max(A*M,0),D=new Uint8ClampedArray(O),N={data:D,width:A,height:M,glyphWidth:b,glyphHeight:T,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(b===0||T===0)return N;const{ctx:U,buffer:H,gridInner:X,gridOuter:te}=this;U.clearRect(H,H,b,T),U.fillText(o,H,H+m);const ue=U.getImageData(H,H,b,T);te.fill(T_,0,O),X.fill(0,0,O);for(let le=0;le<T;le++)for(let fe=0;fe<b;fe++){const De=ue.data[4*(le*b+fe)+3]/255;if(De===0)continue;const Ie=(le+H)*A+fe+H;if(De===1)te[Ie]=0,X[Ie]=T_;else{const Ce=.5-De;te[Ie]=Ce>0?Ce*Ce:0,X[Ie]=Ce<0?Ce*Ce:0}}UI(te,0,0,A,M,A,this.f,this.v,this.z),UI(X,H,H,b,T,A,this.f,this.v,this.z);for(let le=0;le<O;le++){const fe=Math.sqrt(te[le])-Math.sqrt(X[le]);D[le]=Math.round(255-255*(fe/this.radius+this.cutoff))}return N}};const Qd=Xp;function $I(o,e){return o+e[1]-e[0]}function qI(o,e,i,u,h=1){const p=[],m=o.imagePrimary,b=m.pixelRatio,T=m.paddedRect.w-2*Qd,A=m.paddedRect.h-2*Qd,M=(o.right-o.left)*h,O=(o.bottom-o.top)*h,D=m.stretchX||[[0,T]],N=m.stretchY||[[0,A]],U=D.reduce($I,0),H=N.reduce($I,0),X=T-U,te=A-H;let ue=0,le=U,fe=0,De=H,Ie=0,Ce=X,Be=0,je=te;if(m.content&&u){const Ge=m.content;ue=mv(D,0,Ge[0]),fe=mv(N,0,Ge[1]),le=mv(D,Ge[0],Ge[2]),De=mv(N,Ge[1],Ge[3]),Ie=Ge[0]-ue,Be=Ge[1]-fe,Ce=Ge[2]-Ge[0]-le,je=Ge[3]-Ge[1]-De}const st=(Ge,ft,jt,_t)=>{const Mt=gv(Ge.stretch-ue,le,M,o.left*h),Ft=_v(Ge.fixed-Ie,Ce,Ge.stretch,U),ot=gv(ft.stretch-fe,De,O,o.top*h),Ot=_v(ft.fixed-Be,je,ft.stretch,H),Xe=gv(jt.stretch-ue,le,M,o.left*h),at=_v(jt.fixed-Ie,Ce,jt.stretch,U),Ut=gv(_t.stretch-fe,De,O,o.top*h),Rt=_v(_t.fixed-Be,je,_t.stretch,H),gr=new Ct(Mt,ot),ar=new Ct(Xe,ot),At=new Ct(Xe,Ut),zt=new Ct(Mt,Ut),hr=new Ct(Ft/b,Ot/b),er=new Ct(at/b,Rt/b),Gt=e*Math.PI/180;if(Gt){const yn=Math.sin(Gt),nn=Math.cos(Gt),fi=[nn,-yn,yn,nn];gr._matMult(fi),ar._matMult(fi),zt._matMult(fi),At._matMult(fi)}const rr=Ge.stretch+Ge.fixed,Pr=jt.stretch+jt.fixed,Fr=ft.stretch+ft.fixed,Zr=_t.stretch+_t.fixed,qr=o.imageSecondary;return{tl:gr,tr:ar,bl:zt,br:At,texPrimary:{x:m.paddedRect.x+Qd+rr,y:m.paddedRect.y+Qd+Fr,w:Pr-rr,h:Zr-Fr},texSecondary:qr?{x:qr.paddedRect.x+Qd+rr,y:qr.paddedRect.y+Qd+Fr,w:Pr-rr,h:Zr-Fr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:hr,pixelOffsetBR:er,minFontScaleX:Ce/b/M,minFontScaleY:je/b/O,isSDF:i}};if(u&&(m.stretchX||m.stretchY)){const Ge=GI(D,X,U),ft=GI(N,te,H);for(let jt=0;jt<Ge.length-1;jt++){const _t=Ge[jt],Mt=Ge[jt+1];for(let Ft=0;Ft<ft.length-1;Ft++)p.push(st(_t,ft[Ft],Mt,ft[Ft+1]))}}else p.push(st({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:A+1}));return p}function mv(o,e,i){let u=0;for(const h of o)u+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return u}function GI(o,e,i){const u=[{fixed:-Qd,stretch:0}];for(const[h,p]of o){const m=u[u.length-1];u.push({fixed:h-m.stretch,stretch:m.stretch}),u.push({fixed:h-m.stretch,stretch:m.stretch+(p-h)})}return u.push({fixed:e+Qd,stretch:i}),u}function gv(o,e,i,u){return o/e*i+u}function _v(o,e,i,u){return o-e*i/u}function a4(o,e,i,u){const h=e+o.positionedLines[u].lineOffset;return u===0?i+h/2:i+(h+(e+o.positionedLines[u-1].lineOffset))/2}function s4(o,e=1,i=!1){let u=1/0,h=1/0,p=-1/0,m=-1/0;const b=o[0];for(let N=0;N<b.length;N++){const U=b[N];(!N||U.x<u)&&(u=U.x),(!N||U.y<h)&&(h=U.y),(!N||U.x>p)&&(p=U.x),(!N||U.y>m)&&(m=U.y)}const T=Math.min(p-u,m-h);let A=T/2;const M=new rh([],l4);if(T===0)return new Ct(u,h);for(let N=u;N<p;N+=T)for(let U=h;U<m;U+=T)M.push(new Xm(N+A,U+A,A,o));let O=(function(N){let U=0,H=0,X=0;const te=N[0];for(let ue=0,le=te.length,fe=le-1;ue<le;fe=ue++){const De=te[ue],Ie=te[fe],Ce=De.x*Ie.y-Ie.x*De.y;H+=(De.x+Ie.x)*Ce,X+=(De.y+Ie.y)*Ce,U+=3*Ce}return new Xm(H/U,X/U,0,N)})(o),D=M.length;for(;M.length;){const N=M.pop();(N.d>O.d||!O.d)&&(O=N,i&&console.log("found best %d after %d probes",Math.round(1e4*N.d)/1e4,D)),N.max-O.d<=e||(A=N.h/2,M.push(new Xm(N.p.x-A,N.p.y-A,A,o)),M.push(new Xm(N.p.x+A,N.p.y-A,A,o)),M.push(new Xm(N.p.x-A,N.p.y+A,A,o)),M.push(new Xm(N.p.x+A,N.p.y+A,A,o)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${O.d}`)),O.p}function l4(o,e){return e.max-o.max}class Xm{constructor(e,i,u,h){this.p=new Ct(e,i),this.h=u,this.d=(function(p,m){let b=!1,T=1/0;for(let A=0;A<m.length;A++){const M=m[A];for(let O=0,D=M.length,N=D-1;O<D;N=O++){const U=M[O],H=M[N];U.y>p.y!=H.y>p.y&&p.x<(H.x-U.x)*(p.y-U.y)/(H.y-U.y)+U.x&&(b=!b),T=Math.min(T,Ma(p,U,H))}}return(b?1:-1)*Math.sqrt(T)})(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const u4=Object.keys,Pb=Number.POSITIVE_INFINITY,c4=Math.sqrt(2);function HI(o,[e,i]){let u=0,h=0;if(i===Pb){e<0&&(e=0);const p=e/c4;switch(o){case"top-right":case"top-left":h=p-7;break;case"bottom-right":case"bottom-left":h=7-p;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(o){case"top-right":case"bottom-right":u=-p;break;case"top-left":case"bottom-left":u=p;break;case"left":u=e;break;case"right":u=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),o){case"top-right":case"top-left":case"top":h=i-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-i}switch(o){case"top-right":case"bottom-right":case"right":u=-e;break;case"top-left":case"bottom-left":case"left":u=e}}return[u,h]}function yv(o,e,i,u,h,p,m,b,T){if(!e||!e.usvg)return;const A=RI(u),M=RI(h),O=p!=="both"&&p!=="width"||!MI(u)?1:M.width/A.width,D=p!=="both"&&p!=="height"||!OI(u)?1:M.height/A.height;i.scaleSelf(O,D);const N=i.toString();m.set(N,i),b.set(N,e);const{imagePosition:U}=Eb(N,e,Xp);T.set(N,U)}function WI(o,e,i,u,h,p,m,b,T){if(!o)return;const A=(function(M,O,D,N,U,H){if(M.kind==="camera")return M.maxSize;if(M.kind==="composite"){const X=O.possiblyEvaluate(new Un(M.maxZoom,{worldview:H}),D).evaluate(U,{},D),te=O.possiblyEvaluate(new Un(M.minZoom,{worldview:H}),D).evaluate(U,{},D);return Math.max(X,te)}return O.possiblyEvaluate(new Un(N,{worldview:H})).evaluate(U,{},D)})(e,i,u,h,p,T);return o.scaleSelf(A*b*m)}function ZI(o,e,i,u,h,p,m,b,T){return{iconPrimary:WI(o.getPrimary(),e,i,u,h,p,m,b,T),iconSecondary:WI(o.getSecondary(),e,i,u,h,p,m,b,T)}}function h4(o,e,i){if(!e)return;const u=i.get(o.toString()),h=i.get(e.toString());h&&(u.paddedRect.w===h.paddedRect.w&&u.paddedRect.h===h.paddedRect.h||hn(`Mismatch in icon variant sizes: ${o.toString()} and ${e.toString()}`),u.usvg!==h.usvg&&hn(`Mismatch in icon variant image types: ${o.id} and ${e.id}`))}function XI(o,e,i,u){if(!o)return;const h=e.get(i.toString());if(o.imagePrimary=h,u){const p=e.get(u.toString());o.imageSecondary=p}}function f4(o,e){for(const i in o.horizontal)KI(o.horizontal[i],e);KI(o.vertical,e)}function KI(o,e){if(o){for(const i of o.positionedLines)for(const u of i.positionedGlyphs)if(u.image!==null){const h=u.image.toString();u.rect=e.get(h).paddedRect}}}function Ib(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function d4(o,e,i,u,h,p,m,b,T){const A=Cb(p.horizontal)||p.vertical,M=i.get("icon-text-fit-padding").evaluate(u,{},h);let O,D=e;return e&&T!=="none"&&(o.allowVerticalPlacement&&p.vertical&&(O=CI(e,p.vertical,T,M,b,m)),A&&(D=CI(e,A,T,M,b,m))),{defaultShapedIcon:D,verticallyShapedIcon:O}}function p4(o,e,i,u,h,p,m,b,T,A,M,O,D,N,U,H,X,te,ue,le){let fe=m.textMaxSize.evaluate(e,{},D);fe===void 0?fe=b*m.textScaleFactor:fe*=m.textScaleFactor;const De=o.layers[0].layout,Ie=Cb(i.horizontal)||i.vertical,Ce=N.name==="globe",Be=Yo,je=o.tilePixelRatio*fe/Be,st=(Ft=o.overscaling,o.zoom>18&&Ft>2&&(Ft>>=1),Math.max($t/(512*Ft),1)*De.get("symbol-spacing")),Ge=De.get("text-padding")*o.tilePixelRatio,ft=De.get("icon-padding")*o.tilePixelRatio,jt=Cn(De.get("text-max-angle")),_t=De.get("icon-rotation-alignment")==="map"&&le!=="point",Mt=st/2;var Ft;o.hasAnyIconTextFit===!1&&X!=="none"&&(o.hasAnyIconTextFit=!0);const ot=e.properties?+e.properties[Yt]:null,Ot=ot&&o.elevationFeatureIdToIndex?o.elevationFeatureIdToIndex.get(ot):65535,Xe=(at,Ut,Rt)=>{if(Ut.x<0||Ut.x>=$t||Ut.y<0||Ut.y>=$t)return;let gr=null;if(Ce){const{x:ar,y:At,z:zt}=N.projectTilePoint(Ut.x,Ut.y,Rt);gr={anchor:new Rf(ar,At,zt,0,void 0),up:N.upVector(Rt,Ut.x,Ut.y)}}(function(ar,At,zt,hr,er,Gt,rr,Pr,Fr,Zr,qr,yn,nn,fi,me,ge,nt,Vt,Kt,Xt,cr,Dr,fn,dn,en,Qn,zi,Yr,_i){const si=ar.addToLineVertexArray(At,hr);let Hn,ki,di,li,hi,Kn,tn,ei=0,Di=0,Or=0,Pn=0,pi=-1,Fi=-1;const yi={};let po=cu("");const ri=zt?zt.anchor:At,co=Yr!=="none";let Es=0,ya=0;if(Fr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const mo=Fr.layout.get("text-offset").evaluate(cr,{},en);Es=mo[0]*Yo,ya=mo[1]*Yo}else Es=Fr.layout.get("text-radial-offset").evaluate(cr,{},en)*Yo,ya=Pb;if(ar.allowVerticalPlacement&&er.vertical){const mo=er.vertical;if(me)Kn=Mb(mo),Pr&&(tn=Mb(Pr));else{const zo=Fr.layout.get("text-rotate").evaluate(cr,{},en)+90;di=vv(Zr,ri,At,qr,yn,nn,mo,fi,zo,ge),Pr&&(li=vv(Zr,ri,At,qr,yn,nn,Pr,Vt,zo))}}if(Gt){const mo=ar.iconSizeData,zo=Fr.layout.get("icon-rotate").evaluate(cr,{},en),va=qI(Gt,zo,fn,co,Dr.iconScaleFactor),Ya=Pr?qI(Pr,zo,fn,co,Dr.iconScaleFactor):void 0;ki=vv(Zr,ri,At,qr,yn,nn,Gt,Vt,zo,null),ei=4*va.length;let Oa=null;mo.kind==="source"?(Oa=[Mh*Fr.layout.get("icon-size").evaluate(cr,{},en)*Dr.iconScaleFactor],Oa[0]>ep&&hn(`${ar.layerIds[0]}: Value for "icon-size" is >= ${E_}. Reduce your "icon-size".`)):mo.kind==="composite"&&(Oa=[Mh*Dr.compositeIconSizes[0].evaluate(cr,{},en)*Dr.iconScaleFactor,Mh*Dr.compositeIconSizes[1].evaluate(cr,{},en)*Dr.iconScaleFactor],(Oa[0]>ep||Oa[1]>ep)&&hn(`${ar.layerIds[0]}: Value for "icon-size" is >= ${E_}. Reduce your "icon-size".`)),ar.addSymbols(ar.icon,va,Oa,Xt,Kt,cr,void 0,zt,At,si.lineStartIndex,si.lineLength,-1,dn,en,Qn,zi),pi=ar.icon.placedSymbolArray.length-1,Ya&&(Di=4*Ya.length,ar.addSymbols(ar.icon,Ya,Oa,Xt,Kt,cr,Zs.vertical,zt,At,si.lineStartIndex,si.lineLength,-1,dn,en,Qn,zi),Fi=ar.icon.placedSymbolArray.length-1)}for(const mo in er.horizontal){const zo=mo,va=er.horizontal[zo];Hn||(po=cu(va.text),me?hi=Mb(va):Hn=vv(Zr,ri,At,qr,yn,nn,va,fi,Fr.layout.get("text-rotate").evaluate(cr,{},en),ge));const Ya=va.positionedLines.length===1;if(Or+=YI(ar,zt,At,va,rr,Fr,me,cr,ge,si,er.vertical?Zs.horizontal:Zs.horizontalOnly,Ya?u4(er.horizontal):[zo],yi,pi,Dr,dn,en,Qn),Ya)break}er.vertical&&(Pn+=YI(ar,zt,At,er.vertical,rr,Fr,me,cr,ge,si,Zs.vertical,["vertical"],yi,Fi,Dr,dn,en,Qn));let sa=-1;const As=(mo,zo)=>mo?Math.max(mo,zo):zo;sa=As(hi,sa),sa=As(Kn,sa),sa=As(tn,sa);const Oh=sa>-1?1:0;ar.glyphOffsetArray.length>=65535&&hn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),cr.sortKey!==void 0&&ar.addToSortKeyRanges(ar.symbolInstances.length,cr.sortKey),ar.symbolInstances.emplaceBack(At.x,At.y,ri.x,ri.y,ri.z,yi.right>=0?yi.right:-1,yi.center>=0?yi.center:-1,yi.left>=0?yi.left:-1,yi.vertical>=0?yi.vertical:-1,pi,Fi,po,Hn!==void 0?Hn:ar.collisionBoxArray.length,Hn!==void 0?Hn+1:ar.collisionBoxArray.length,di!==void 0?di:ar.collisionBoxArray.length,di!==void 0?di+1:ar.collisionBoxArray.length,ki!==void 0?ki:ar.collisionBoxArray.length,ki!==void 0?ki+1:ar.collisionBoxArray.length,li||ar.collisionBoxArray.length,li?li+1:ar.collisionBoxArray.length,qr,Or,Pn,ei,Di,Oh,0,Es,ya,sa,0,co?1:0,_i)})(o,Ut,gr,at,i,u,p,h,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,Ge,ue,A,0,ft,_t,te,e,m,M,O,D,U,H,X,Ot)};if(le==="line")for(const at of ov(e.geometry,0,0,$t,$t)){const Ut=o4(at,st,jt,i.vertical||Ie,u,Be,je,o.overscaling,$t);for(const Rt of Ut)Ie&&m4(o,Ie.text,Mt,Rt)||Xe(at,Rt,D)}else if(le==="line-center"){for(const at of e.geometry)if(at.length>1){const Ut=i4(at,jt,i.vertical||Ie,u,Be,je);Ut&&Xe(at,Ut,D)}}else if(e.type==="Polygon")for(const at of s_(e.geometry,0)){const Ut=s4(at,16);Xe(at[0],new Rf(Ut.x,Ut.y,0,0,void 0),D)}else if(e.type==="LineString")for(const at of e.geometry)Xe(at,new Rf(at[0].x,at[0].y,0,0,void 0),D);else if(e.type==="Point")for(const at of e.geometry)for(const Ut of at)Xe([Ut],new Rf(Ut.x,Ut.y,0,0,void 0),D)}const E_=255,ep=E_*Mh;function YI(o,e,i,u,h,p,m,b,T,A,M,O,D,N,U,H,X,te){const ue=(function(De,Ie,Ce,Be,je,st,Ge,ft){const jt=[];if(Ie.positionedLines.length===0)return jt;const _t=Be.layout.get("text-rotate").evaluate(st,{})*Math.PI/180,Mt=(function(at){const Ut=at[0],Rt=at[1],gr=Ut*Rt;return gr>0?[Ut,-Rt]:gr<0?[-Ut,Rt]:Ut===0?[Rt,Ut]:[Rt,-Ut]})(Ce);let Ft=Math.abs(Ie.top-Ie.bottom);for(const at of Ie.positionedLines)Ft-=at.lineOffset;const ot=Ie.positionedLines.length,Ot=Ft/ot;let Xe=Ie.top-Ce[1];for(let at=0;at<ot;++at){const Ut=Ie.positionedLines[at];Xe=a4(Ie,Ot,Xe,at);for(const Rt of Ut.positionedGlyphs){if(!Rt.rect)continue;const gr=Rt.rect||{};let ar=wI+1,At=!0,zt=1,hr=0;if(Rt.image){const cr=Ge.get(Rt.image.toString());if(!cr)continue;if(cr.sdf){hn("SDF images are not supported in formatted text and will be ignored.");continue}At=!1,zt=cr.pixelRatio,ar=Xp/zt}const er=(je||ft)&&Rt.vertical,Gt=Rt.metrics.advance*Rt.scale/2,rr=Rt.metrics,Pr=Rt.rect;if(Pr===null)continue;ft&&Ie.verticalizable&&(hr=Rt.image?Gt-Rt.metrics.width*Rt.scale/2:0);const Fr=je?[Rt.x+Gt,Rt.y]:[0,0];let Zr=[0,0],qr=[0,0],yn=!1;je||(er?(qr=[Rt.x+Gt+Mt[0],Rt.y+Mt[1]-hr],yn=!0):Zr=[Rt.x+Gt+Ce[0],Rt.y+Ce[1]-hr]);const nn=Pr.w*Rt.scale/(zt*(Rt.localGlyph?Dc:1)),fi=Pr.h*Rt.scale/(zt*(Rt.localGlyph?Dc:1));let me,ge,nt,Vt;if(er){const cr=Rt.y-Xe,Dr=new Ct(-Gt,Gt-cr),fn=-Math.PI/2,dn=new Ct(...qr);me=new Ct(-Gt+Zr[0],Zr[1]),me._rotateAround(fn,Dr)._add(dn),me.x+=-cr+Gt,me.y-=(rr.left-ar)*Rt.scale;const en=Rt.image?rr.advance*Rt.scale:Yo*Rt.scale,Qn=String.fromCodePoint(Rt.glyph);U5(Qn)?me.x+=(1-ar)*Rt.scale:V5(Qn)?me.x+=en-rr.height*Rt.scale+(-ar-1)*Rt.scale:me.x+=Rt.image||rr.width+2*ar===Pr.w&&rr.height+2*ar===Pr.h?(en-fi)/2:(en-(rr.height+2*ar)*Rt.scale)/2,ge=new Ct(me.x,me.y-nn),nt=new Ct(me.x+fi,me.y),Vt=new Ct(me.x+fi,me.y-nn)}else{const cr=(rr.left-ar)*Rt.scale-Gt+Zr[0],Dr=(-rr.top-ar)*Rt.scale+Zr[1],fn=cr+nn,dn=Dr+fi;me=new Ct(cr,Dr),ge=new Ct(fn,Dr),nt=new Ct(cr,dn),Vt=new Ct(fn,dn)}if(_t){let cr;cr=je?new Ct(0,0):yn?new Ct(Mt[0],Mt[1]):new Ct(Ce[0],Ce[1]),me._rotateAround(_t,cr),ge._rotateAround(_t,cr),nt._rotateAround(_t,cr),Vt._rotateAround(_t,cr)}const Kt=new Ct(0,0),Xt=new Ct(0,0);jt.push({tl:me,tr:ge,bl:nt,br:Vt,texPrimary:gr,texSecondary:void 0,writingMode:Ie.writingMode,glyphOffset:Fr,sectionIndex:Rt.sectionIndex,isSDF:At,pixelOffsetTL:Kt,pixelOffsetBR:Xt,minFontScaleX:0,minFontScaleY:0})}}return jt})(0,u,T,p,m,b,h,o.allowVerticalPlacement),le=o.textSizeData;let fe=null;le.kind==="source"?(fe=[Mh*p.layout.get("text-size").evaluate(b,{},X)*U.textScaleFactor],fe[0]>ep&&hn(`${o.layerIds[0]}: Value for "text-size" is >= ${E_}. Reduce your "text-size".`)):le.kind==="composite"&&(fe=[Mh*U.compositeTextSizes[0].evaluate(b,{},X)*U.textScaleFactor,Mh*U.compositeTextSizes[1].evaluate(b,{},X)*U.textScaleFactor],(fe[0]>ep||fe[1]>ep)&&hn(`${o.layerIds[0]}: Value for "text-size" is >= ${E_}. Reduce your "text-size".`)),o.addSymbols(o.text,ue,fe,T,m,b,M,e,i,A.lineStartIndex,A.lineLength,N,H,X,te,!1);for(const De of O)D[De]=o.text.placedSymbolArray.length-1;return 4*ue.length}function Cb(o){for(const e in o)return o[e];return null}function vv(o,e,i,u,h,p,m,b,T,A){let M=m.top,O=m.bottom,D=m.left,N=m.right;if(II(m)&&m.collisionPadding){const U=m.collisionPadding;D-=U[0],M-=U[1],N+=U[2],O+=U[3]}if(T){const U=new Ct(D,M),H=new Ct(N,M),X=new Ct(D,O),te=new Ct(N,O),ue=Cn(T);let le=new Ct(0,0);A&&(le=new Ct(A[0],A[1])),U._rotateAround(ue,le),H._rotateAround(ue,le),X._rotateAround(ue,le),te._rotateAround(ue,le),D=Math.min(U.x,H.x,X.x,te.x),N=Math.max(U.x,H.x,X.x,te.x),M=Math.min(U.y,H.y,X.y,te.y),O=Math.max(U.y,H.y,X.y,te.y)}return o.emplaceBack(e.x,e.y,e.z,i.x,i.y,D,M,N,O,b,u,h,p),o.length-1}function Mb(o){II(o)&&o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function m4(o,e,i,u){const h=o.compareText;if(e in h){const p=h[e];for(let m=p.length-1;m>=0;m--)if(u.dist(p[m])<i)return!0}else h[e]=[];return h[e].push(u),!1}function JI(o,e){const i=o.fovAboveCenter,u=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,h=(o._camera.position[2]*o.worldSize-u)/Math.cos(o._pitch),p=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-o._pitch-i,.01));let m=Math.sin(o._pitch)*p+h;const b=h*(1/o._horizonShift);if(!o.elevation||o.elevation.exaggeration()===0){let T=Math.max(o.zoom-17,0);o.isOrthographic&&(T/=10),m*=1+T}return Math.min(1.01*m,b)}function A_(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};const i=Math.pow(2,-o.z),u=o.x*i,h=(o.x+1)*i,p=o.y*i,m=(o.y+1)*i,b=se(u),T=se(h),A=ce(p),M=ce(m),O=e.project(b,A),D=e.project(T,A),N=e.project(T,M),U=e.project(b,M);let H=Math.min(O.x,D.x,N.x,U.x),X=Math.min(O.y,D.y,N.y,U.y),te=Math.max(O.x,D.x,N.x,U.x),ue=Math.max(O.y,D.y,N.y,U.y);const le=i/16;function fe(Ie,Ce,Be,je,st,Ge){const ft=(Be+st)/2,jt=(je+Ge)/2,_t=e.project(se(ft),ce(jt)),Mt=Math.max(0,H-_t.x,X-_t.y,_t.x-te,_t.y-ue);H=Math.min(H,_t.x),te=Math.max(te,_t.x),X=Math.min(X,_t.y),ue=Math.max(ue,_t.y),Mt>le&&(fe(Ie,_t,Be,je,ft,jt),fe(_t,Ce,ft,jt,st,Ge))}fe(O,D,u,p,h,p),fe(D,N,h,p,h,m),fe(N,U,h,m,u,m),fe(U,O,u,m,u,p),H-=le,X-=le,te+=le,ue+=le;const De=1/Math.max(te-H,ue-X);return{scale:De,x:H*De,y:X*De,x2:te*De,y2:ue*De,projection:e}}function QI(o,{x:e,y:i},u=0){return new Ct(((e-u)*o.scale-o.x)*$t,(i*o.scale-o.y)*$t)}const g4=ee(new Float32Array(16));class tp{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new L(0,0)}projectTilePoint(e,i,u){return{x:e,y:i,z:0}}locationPoint(e,i,u,h=!0){return e._coordinatePoint(e.locationCoordinate(i,u),h)}pixelsPerMeter(e,i){return Y(1,e)*i}pixelSpaceConversion(e,i,u){return 1}farthestPixelDistance(e){return JI(e,e.pixelsPerMeter)}pointCoordinate(e,i,u,h){const p=e.horizonLineFromTop(!1),m=new Ct(i,Math.max(p,u));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,h))}pointCoordinate3D(e,i,u){const h=new Ct(i,u);if(e.elevation)return e.elevation.pointCoordinate(h);{const p=this.pointCoordinate(e,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const u=e.horizonLineFromTop();return i.y<u}createInversionMatrix(e,i){return g4}createTileMatrix(e,i,u){let h,p,m;const b=u.canonical,T=ee(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=A_(b,this);h=1,p=A.x+u.wrap*A.scale,m=A.y,be(T,T,[h/A.scale,h/A.scale,e.pixelsPerMeter/i])}else h=i/e.zoomScale(b.z),p=(b.x+Math.pow(2,b.z)*u.wrap)*h,m=b.y*h;return xe(T,T,[p,m,0]),be(T,T,[h/$t,h/$t,1]),T}upVector(e,i,u){return[0,0,1]}upVectorScale(e,i,u){return{metersToTile:1}}}class _4 extends tp{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,u]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(Cn(i));this.n=(h+Math.sin(Cn(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:u,c:h,r0:p}=this,m=Cn(e-this.center[0]),b=Cn(i),T=Math.sqrt(h-2*u*Math.sin(b))/u;return{x:T*Math.sin(m*u),y:T*Math.cos(m*u)-p,z:0}}unproject(e,i){const{n:u,c:h,r0:p}=this,m=p+i;let b=Math.atan2(e,Math.abs(m))*Math.sign(m);m*u<0&&(b-=Math.PI*Math.sign(e)*Math.sign(m));const T=Cn(this.center[0])*u;b=et(b,-Math.PI-T,Math.PI-T);const A=ve(Ke(b/u)+this.center[0],-180,180),M=Math.asin(ve((h-(e*e+m*m)*u*u)/(2*u),-1,1)),O=ve(Ke(M),-Se,Se);return new L(A,O)}}const P_=1.340264,I_=-.081106,C_=893e-6,M_=.003796,xv=Math.sqrt(3)/2;class y4 extends tp{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const u=Math.asin(xv*Math.sin(i)),h=u*u,p=h*h*h;return{x:.5*(e*Math.cos(u)/(xv*(P_+3*I_*h+p*(7*C_+9*M_*h)))/Math.PI+.5),y:1-.5*(u*(P_+I_*h+p*(C_+M_*h))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let u=i=(2*(1-i)-1)*Math.PI,h=u*u,p=h*h*h;for(let M,O,D,N=0;N<12&&(O=u*(P_+I_*h+p*(C_+M_*h))-i,D=P_+3*I_*h+p*(7*C_+9*M_*h),M=O/D,u=ve(u-M,-Math.PI/3,Math.PI/3),h=u*u,p=h*h*h,!(Math.abs(M)<1e-12));++N);const m=xv*e*(P_+3*I_*h+p*(7*C_+9*M_*h))/Math.cos(u),b=Math.asin(Math.sin(u)/xv),T=ve(180*m/Math.PI,-180,180),A=ve(180*b/Math.PI,-Se,Se);return new L(T,A)}}class v4 extends tp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const u=360*(e-.5),h=ve(360*(.5-i),-Se,Se);return new L(u,h)}}const Km=Math.PI/2;function bv(o){return Math.tan((Km+o)/2)}class x4 extends tp{constructor(e){super(e),this.center=e.center||[0,30];const[i,u]=this.parallels=e.parallels||[30,30];let h=Cn(i),p=Cn(u);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const m=Math.cos(h),b=bv(h);this.n=h===p?Math.sin(h):Math.log(m/Math.cos(p))/Math.log(bv(p)/b),this.f=m*Math.pow(bv(h),this.n)/this.n}project(e,i){i=Cn(i),this.southernCenter&&(i=-i),e=Cn(e-this.center[0]);const u=1e-6,{n:h,f:p}=this;p>0?i<-Km+u&&(i=-Km+u):i>Km-u&&(i=Km-u);const m=p/Math.pow(bv(i),h);let b=m*Math.sin(h*e),T=p-m*Math.cos(h*e);return b=.5*(b/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:b,y:this.southernCenter?T:1-T,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:u,f:h}=this,p=h-i,m=Math.sign(p),b=Math.sign(u)*Math.sqrt(e*e+p*p);let T=Math.atan2(e,Math.abs(p))*m;p*u<0&&(T-=Math.PI*Math.sign(e)*m);const A=ve(Ke(T/u)+this.center[0],-180,180),M=ve(Ke(2*Math.atan(Math.pow(h/b,1/u))-Km),-Se,Se);return new L(A,this.southernCenter?-M:M)}}class eC extends tp{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Z(e),y:J(i),z:0}}unproject(e,i){const u=se(e),h=ce(i);return new L(u,h)}}const tC=Cn(Se);class b4 extends tp{project(e,i){const u=(i=Cn(i))*i,h=u*u;return{x:.5*((e=Cn(e))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let u=i=(2*(1-i)-1)*Math.PI,h=25,p=0,m=u*u;do{m=u*u;const A=m*m;p=(u*(1.007226+m*(.015085+A*(.028874*m-.044475-.005916*A)))-i)/(1.007226+m*(.045255+A*(.259866*m-.311325-.005916*11*A))),u=ve(u-p,-tC,tC)}while(Math.abs(p)>1e-6&&--h>0);m=u*u;const b=ve(Ke(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),T=Ke(u);return new L(b,T)}}const rC=Cn(Se);class w4 extends tp{project(e,i){i=Cn(i),e=Cn(e);const u=Math.cos(i),h=2/Math.PI,p=Math.acos(u*Math.cos(e/2)),m=Math.sin(p)/p,b=.5*(e*h+2*u*Math.sin(e/2)/m)||0,T=.5*(i+Math.sin(i)/m)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(e,i){let u=e=(2*e-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,p=25;const m=1e-6;let b=0,T=0;do{const A=Math.cos(h),M=Math.sin(h),O=2*M*A,D=M*M,N=A*A,U=Math.cos(u/2),H=Math.sin(u/2),X=2*U*H,te=H*H,ue=1-N*U*U,le=ue?1/ue:0,fe=ue?Math.acos(A*U)*Math.sqrt(1/ue):0,De=.5*(2*fe*A*H+2*u/Math.PI)-e,Ie=.5*(fe*M+h)-i,Ce=.5*le*(N*te+fe*A*U*D)+1/Math.PI,Be=le*(X*O/4-fe*M*H),je=.125*le*(O*H-fe*M*N*X),st=.5*le*(D*U+fe*te*A)+.5,Ge=Be*je-st*Ce;b=(Ie*Be-De*st)/Ge,T=(De*je-Ie*Ce)/Ge,u=ve(u-b,-Math.PI,Math.PI),h=ve(h-T,-rC,rC)}while((Math.abs(b)>m||Math.abs(T)>m)&&--p>0);return new L(Ke(u),Ke(h))}}class nC extends tp{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Cn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:u,cosPhi:h}=this;return{x:Cn(e)*h*u+.5,y:-Math.sin(Cn(i))/h*u+.5,z:0}}unproject(e,i){const{scale:u,cosPhi:h}=this,p=-(i-.5)/u,m=ve(Ke((e-.5)/u)/h,-180,180),b=Math.asin(ve(p*h,-1,1)),T=ve(Ke(b),-Se,Se);return new L(m,T)}}class S4 extends eC{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,u){const h=mr(e,i,u);return Er(h,h,$r(G(u))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,i,u){const h=E(i.lat,i.lng),p=Ir([],h),m=u?e._centerAltitude+u:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;pt(h,h,p,Y(1,0)*$t*m);const b=ee(new Float64Array(16));return de(b,e.pixelMatrix,e.globeMatrix),Er(h,h,b),new Ct(h[0],h[1])}pixelsPerMeter(e,i){return Y(1,0)*i}pixelSpaceConversion(e,i,u){const h=Y(1,e)*i,p=wr(Y(1,45)*i,h,u);return this.pixelsPerMeter(e,i)/p}createTileMatrix(e,i,u){const h=Kr(G(u.canonical));return de(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,i){const{center:u}=e,h=$r(G(i));return he(h,h,Cn(u.lng)),ke(h,h,Cn(u.lat)),be(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,i,u,h){return x(e,i,u,!0)||new Ae(0,0)}pointCoordinate3D(e,i,u){const h=this.pointCoordinate(e,i,u,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,i){return!x(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=(function(h,p){const m=h.cameraToCenterDistance,b=h._centerAltitude*p,T=h._camera,A=h._camera.forward(),M=Tt([],$e([],A,-m),[0,0,b]),O=h.worldSize/(2*Math.PI),D=[0,0,-O],N=h.width/h.height,U=Math.tan(h.fovAboveCenter),H=$e([],T.up(),U),X=$e([],T.right(),U*N),te=Ir([],Tt([],Tt([],A,H),X)),ue=[];let le;if(new Sn(M,te).closestPointOnSphere(D,O,ue)){const fe=Tt([],ue,D),De=In([],fe,M);le=Math.cos(h.fovAboveCenter)*gt(De)}else{const fe=In([],M,D),De=In([],D,M);Ir(De,De);const Ie=gt(fe)-O;le=Math.sqrt(Ie*(Ie+2*O));const Ce=Math.acos(le/(O+Ie))-Math.acos(Lr(A,De));le*=Math.cos(Ce)}return 1.01*le})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),u=ht(e.zoom);if(u>0){const h=JI(e,Y(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return wr(i,h+p*(1-Math.cos(m)),Math.pow(u,10))}return i}upVector(e,i,u){return mr(i,u,e,1)}upVectorScale(e){return{metersToTile:Of(xr(G(e)))}}}function iC(o){const e=o.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new eC(o);case"equirectangular":return new v4(o);case"naturalEarth":return new b4(o);case"equalEarth":return new y4(o);case"winkelTripel":return new w4(o);case"albers":return i?new nC(o):new _4(o);case"lambertConformalConic":return i?new nC(o):new x4(o);case"globe":return new S4(o)}throw new Error(`Invalid projection name: ${o.name}`)}const T4=Ye.types,E4=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wv(o,e,i,u,h,p,m,b,T,A,M,O,D){const N=b?Math.min(ep,Math.round(b[0])):0,U=b?Math.min(ep,Math.round(b[1])):0;o.emplaceBack(e,i,Math.round(32*u),Math.round(32*h),p,m,(N<<1)+(T?1:0),U,16*A,16*M,256*O,256*D)}function Sv(o,e,i){o.emplaceBack(e,i)}function Tv(o,e,i,u,h,p,m){o.emplaceBack(e,i,u,h,p,m)}const Ev=(o,e,i,u)=>{for(let h=0;h<e;h++)o.emplaceBack(i[0],i[1],i[2],u[0],u[1],u[2])};function Av(o,e,i,u,h){o.emplaceBack(e,i,u,h),o.emplaceBack(e,i,u,h),o.emplaceBack(e,i,u,h),o.emplaceBack(e,i,u,h)}function A4(o){for(const e of o.sections)if(yf(e.text))return!0;return!1}class Ob{constructor(e){this.layoutVertexArray=new Ha,this.indexArray=new ai,this.programConfigurations=e,this.segments=new wi,this.dynamicLayoutVertexArray=new Us,this.opacityVertexArray=new Rd,this.placedSymbolArray=new Eh,this.iconTransitioningVertexArray=new Vs,this.globeExtVertexArray=new Mu,this.zOffsetVertexArray=new Ic,this.orientationVertexArray=new zd}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,u,h,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,O5.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,k5.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,E4,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,L5.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,R5.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,D5.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,z5.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}nr(Ob,"SymbolBuffers");class Rb{constructor(e,i,u){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new u,this.segments=new wi,this.collisionVertexArray=new Ou,this.collisionVertexArrayExt=new Us}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,F5.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,B5.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}nr(Rb,"CollisionBuffers");class Pv{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((m=>m.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ee([]),this.placementViewportMatrix=ee([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=kI(this.zoom,i["text-size"],this.worldview),this.iconSizeData=kI(this.zoom,i["icon-size"],this.worldview);const u=this.layers[0].layout,h=u.get("symbol-sort-key"),p=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map((m=>Zs[m])),this.stateDependentLayerIds=this.layers.filter((m=>m.isStateDependent())).map((m=>m.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new Ob(new Wa(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new Ob(new Wa(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new Cf,this.lineVertexArray=new zp,this.symbolInstances=new jd}calculateGlyphDependencies(e,i,u,h,p){for(const m of e){const b=m.codePointAt(0);if(b===void 0)break;if(i[b]=!0,h&&p&&b<=65535){const T=x_[m];T&&(i[T.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!rv(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(e,i,u,h){const p=this.layers[0],m=p.layout,b=this.projection.name==="globe",T=m.get("text-font"),A=m.get("text-field"),M=m.get("icon-image"),[O,D]=m.get("icon-size-scale-range"),N=ve(i.scaleFactor||1,O,D),U=(A.value.kind!=="constant"||A.value.value instanceof ca&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),H=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,X=m.get("symbol-sort-key");if(this.features=[],!U&&!H)return;const te=i.iconDependencies,ue=i.glyphDependencies,le=i.availableImages,fe=new Un(this.zoom,{worldview:this.worldview});for(const{feature:De,id:Ie,index:Ce,sourceLayerIndex:Be}of e){const je=p._featureFilter.needGeometry,st=tt(De,je);if(!p._featureFilter.filter(fe,st,u))continue;if(je||(st.geometry=Re(De,u,h)),b&&De.type!==1&&u.z<=5){const Mt=st.geometry,Ft=.98078528056,ot=(Ot,Xe)=>Lr(mr(Ot.x,Ot.y,u,1),mr(Xe.x,Xe.y,u,1))<Ft;for(let Ot=0;Ot<Mt.length;Ot++)Mt[Ot]=Je(Mt[Ot],ot)}let Ge,ft;if(U){const Mt=p.getValueAndResolveTokens("text-field",st,u,le),Ft=ca.factory(Mt);A4(Ft)&&(this.hasRTLText=!0),(!this.hasRTLText||xf()==="unavailable"||this.hasRTLText&&cs.isParsed())&&(Ge=j5(Ft,p,st))}if(H){const Mt=p.getValueAndResolveTokens("icon-image",st,u,le);ft=typeof Mt=="string"?Pa.build(Mt):Mt}if(!Ge&&!ft)continue;const jt=this.sortFeaturesByKey?X.evaluate(st,{},u):void 0,_t={id:Ie,text:Ge,icon:ft,index:Ce,sourceLayerIndex:Be,geometry:st.geometry,properties:De.properties,type:T4[De.type],sortKey:jt};if(this.features.push(_t),ft){const Mt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Ft,iconSecondary:ot}=ZI(ft,this.iconSizeData,Mt["icon-size"],u,this.zoom,_t,this.pixelRatio,N,this.worldview),Ot=Ft.id.toString();if(te.has(Ot)?te.get(Ot).push(Ft):te.set(Ot,[Ft]),ot){this.hasAnySecondaryIcon=!0;const Xe=ot.id.toString();te.has(Xe)?te.get(Xe).push(ot):te.set(Xe,[ot])}}if(Ge){const Mt=T.evaluate(st,{},u).join(","),Ft=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Zs.vertical)>=0;for(const ot of Ge.sections)if(ot.image){const Ot=ot.image.getPrimary().scaleSelf(this.pixelRatio),Xe=Ot.id.toString(),at=te.get(Xe)||[];at.push(Ot),te.set(Xe,at)}else{const Ot=_l(Ge.toString()),Xe=ot.fontStack||Mt,at=ue[Xe]=ue[Xe]||{};this.calculateGlyphDependencies(ot.text,at,Ft,this.allowVerticalPlacement,Ot)}}}if(m.get("symbol-placement")==="line"&&(this.features=(function(De){const Ie={},Ce={},Be=[];let je=0;function st(_t){Be.push(De[_t]),je++}function Ge(_t,Mt,Ft){const ot=Ce[_t];return delete Ce[_t],Ce[Mt]=ot,Be[ot].geometry[0].pop(),Be[ot].geometry[0]=Be[ot].geometry[0].concat(Ft[0]),ot}function ft(_t,Mt,Ft){const ot=Ie[Mt];return delete Ie[Mt],Ie[_t]=ot,Be[ot].geometry[0].shift(),Be[ot].geometry[0]=Ft[0].concat(Be[ot].geometry[0]),ot}function jt(_t,Mt,Ft){const ot=Ft?Mt[0][Mt[0].length-1]:Mt[0][0];return`${_t}:${ot.x}:${ot.y}`}for(let _t=0;_t<De.length;_t++){const Mt=De[_t],Ft=Mt.geometry,ot=Mt.text?Mt.text.toString():null;if(!ot){st(_t);continue}const Ot=jt(ot,Ft),Xe=jt(ot,Ft,!0);if(Ot in Ce&&Xe in Ie&&Ce[Ot]!==Ie[Xe]){const at=ft(Ot,Xe,Ft),Ut=Ge(Ot,Xe,Be[at].geometry);delete Ie[Ot],delete Ce[Xe],Ce[jt(ot,Be[Ut].geometry,!0)]=Ut,Be[at].geometry=null}else Ot in Ce?Ge(Ot,Xe,Ft):Xe in Ie?ft(Ot,Xe,Ft):(st(_t),Ie[Ot]=je-1,Ce[Xe]=je-1)}return Be.filter((_t=>_t.geometry))})(this.features)),m.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const De of i.elevationFeatures)this.elevationFeatureIdToIndex.set(De.id,this.elevationFeatures.length),this.elevationFeatures.push(De)}}else m.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((De,Ie)=>De.sortKey-Ie.sortKey))}update(e,i,u,h,p,m,b){this.text.programConfigurations.updatePaintArrays(e,i,p,u,h,m,b,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,p,u,h,m,b,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const u=Ee(e),h=1/u;let p=!1,m=!1;for(let b=0;b<this.symbolInstances.length;b++){const T=this.symbolInstances.get(b),A=Pt(1,0,0),M=Pt(0,1,0),{numHorizontalGlyphVertices:O,numVerticalGlyphVertices:D,numIconVertices:N,numVerticalIconVertices:U}=T,H=O>0||D>0,X=N>0,te=this.elevationFeatures[T.elevationFeatureIndex];if(te){const ue=new Ct(T.tileAnchorX,T.tileAnchorY),le=.075+te.pointElevation(ue);T.zOffset!==le&&(i=!0,T.zOffset=le);const fe=te.computeSlopeNormal(ue,h),De=el(Fo(),Pt(0,0,1),fe);sr(A,A,De),sr(M,M,De),A[2]*=u,M[2]*=u,A[0]===1&&A[1]===0&&A[2]===0&&M[0]===0&&M[1]===1&&M[2]===0||(p=p||H,m=m||X)}if(H&&(Ev(this.text.orientationVertexArray,O,A,M),Ev(this.text.orientationVertexArray,D,A,M)),X){const{placedIconSymbolIndex:ue,verticalPlacedIconSymbolIndex:le}=T;ue>=0&&Ev(this.icon.orientationVertexArray,N,A,M),le>=0&&Ev(this.icon.orientationVertexArray,U,A,M)}}p||(this.text.orientationVertexArray=void 0),m||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(p,m,b)=>{u+=m,u>p.length&&p.resize(u);for(let T=-m;T<0;T++)p.emplace(T+u,b)},i=(p,m,b)=>{h+=m,h>p.length&&p.resize(h);for(let T=-m;T<0;T++)p.emplace(T+h,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,h=0;for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:T,numIconVertices:A}=m,M=m.zOffset,O=A>0;if((b>0||T>0)&&(e(this.text.zOffsetVertexArray,b,M),e(this.text.zOffsetVertexArray,T,M)),O){const{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:N}=m;D>=0&&i(this.icon.zOffsetVertexArray,A,M),N>=0&&i(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=iC(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const u=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:p}of i)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(e,i,u,h,p,m,b,T,A,M,O,D,N,U,H,X){const te=e.indexArray,ue=e.layoutVertexArray,le=e.globeExtVertexArray,fe=e.segments.prepareSegment(4*i.length,ue,te,this.canOverlap?m.sortKey:void 0),De=this.glyphOffsetArray.length,Ie=fe.vertexLength,Ce=this.allowVerticalPlacement&&b===Zs.vertical?Math.PI/2:0,Be=m.text&&m.text.sections;for(let st=0;st<i.length;st++){const{tl:Ge,tr:ft,bl:jt,br:_t,texPrimary:Mt,texSecondary:Ft,pixelOffsetTL:ot,pixelOffsetBR:Ot,minFontScaleX:Xe,minFontScaleY:at,glyphOffset:Ut,isSDF:Rt,sectionIndex:gr}=i[st],ar=fe.vertexLength,At=Ut[1];if(wv(ue,A.x,A.y,Ge.x,At+Ge.y,Mt.x,Mt.y,u,Rt,ot.x,ot.y,Xe,at),wv(ue,A.x,A.y,ft.x,At+ft.y,Mt.x+Mt.w,Mt.y,u,Rt,Ot.x,ot.y,Xe,at),wv(ue,A.x,A.y,jt.x,At+jt.y,Mt.x,Mt.y+Mt.h,u,Rt,ot.x,Ot.y,Xe,at),wv(ue,A.x,A.y,_t.x,At+_t.y,Mt.x+Mt.w,Mt.y+Mt.h,u,Rt,Ot.x,Ot.y,Xe,at),T){const{x:zt,y:hr,z:er}=T.anchor,[Gt,rr,Pr]=T.up;Tv(le,zt,hr,er,Gt,rr,Pr),Tv(le,zt,hr,er,Gt,rr,Pr),Tv(le,zt,hr,er,Gt,rr,Pr),Tv(le,zt,hr,er,Gt,rr,Pr),Av(e.dynamicLayoutVertexArray,zt,hr,er,Ce)}else Av(e.dynamicLayoutVertexArray,A.x,A.y,A.z,Ce);if(X){const zt=Ft||Mt;Sv(e.iconTransitioningVertexArray,zt.x,zt.y),Sv(e.iconTransitioningVertexArray,zt.x+zt.w,zt.y),Sv(e.iconTransitioningVertexArray,zt.x,zt.y+zt.h),Sv(e.iconTransitioningVertexArray,zt.x+zt.w,zt.y+zt.h)}te.emplaceBack(ar,ar+1,ar+2),te.emplaceBack(ar+1,ar+2,ar+3),fe.vertexLength+=4,fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ut[0]),st!==i.length-1&&gr===i[st+1].sectionIndex||e.programConfigurations.populatePaintArrays(ue.length,m,m.index,{},N,U,H,Be&&Be[gr],this.worldview)}const je=T?T.anchor:A;e.placedSymbolArray.emplaceBack(je.x,je.y,je.z,A.x,A.y,De,this.glyphOffsetArray.length-De,Ie,M,O,A.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],b,0,0,0,D,0)}_commitLayoutVertex(e,i,u,h,p,m,b){e.emplaceBack(i,u,h,p,m,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,i,u,h,p,m,b){const T=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),A=T.vertexLength,M=b.tileAnchorX,O=b.tileAnchorY;for(let N=0;N<4;N++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,i,e.padding,b.zOffset),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,M,O,new Ct(e.x1,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,M,O,new Ct(e.x2,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,M,O,new Ct(e.x2,e.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,p,m,M,O,new Ct(e.x1,e.y2)),T.vertexLength+=4;const D=u.indexArray;D.emplaceBack(A,A+1),D.emplaceBack(A+1,A+2),D.emplaceBack(A+2,A+3),D.emplaceBack(A+3,A),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,u,h,p,m){for(let b=h;b<p;b++){const T=u.get(b),A=this.getSymbolInstanceTextSize(e,m,i,b);this._addCollisionDebugVertices(T,A,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,i,u,h,p,m){for(let b=h;b<p;b++){const T=u.get(b),A=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._addCollisionDebugVertices(T,A,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,i,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rb(bh,yI.members,Vs),this.iconCollisionBox=new Rb(bh,yI.members,Vs);const h=w_(this.iconSizeData,e),p=w_(this.textSizeData,e,u);for(let m=0;m<this.symbolInstances.length;m++){const b=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(p,e,i,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(p,e,i,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,e,i,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,e,i,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(e,i,u,h){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),m=Tb(this.textSizeData,e,p)/Yo;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,i,u){const h=this.icon.placedSymbolArray.get(u),p=Tb(this.iconSizeData,e,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,i,u,h){e.emplaceBack(i,-u,-u,h),e.emplaceBack(i,u,-u,h),e.emplaceBack(i,u,u,h),e.emplaceBack(i,-u,u,h)}_updateTextDebugCollisionBoxes(e,i,u,h,p,m,b){for(let T=h;T<p;T++){const A=u.get(T),M=this.getSymbolInstanceTextSize(e,m,i,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,A.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,i,u,h,p,m,b){for(let T=h;T<p;T++){const A=u.get(T),M=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,A.padding,m.zOffset)}}updateCollisionDebugBuffers(e,i,u,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=w_(this.iconSizeData,e,h),m=w_(this.textSizeData,e,u);for(let b=0;b<this.symbolInstances.length;b++){const T=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(m,e,i,T.textBoxStartIndex,T.textBoxEndIndex,T,u),this._updateTextDebugCollisionBoxes(m,e,i,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T,u),this._updateIconDebugCollisionBoxes(p,e,i,T.iconBoxStartIndex,T.iconBoxEndIndex,T,h),this._updateIconDebugCollisionBoxes(p,e,i,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex,T,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,u,h,p,m,b,T,A){const M={};if(i<u){const{x1:O,y1:D,x2:N,y2:U,padding:H,projectedAnchorX:X,projectedAnchorY:te,projectedAnchorZ:ue,tileAnchorX:le,tileAnchorY:fe,featureIndex:De}=e.get(i);M.textBox={x1:O,y1:D,x2:N,y2:U,padding:H,projectedAnchorX:X,projectedAnchorY:te,projectedAnchorZ:ue,tileAnchorX:le,tileAnchorY:fe},M.textFeatureIndex=De}if(h<p){const{x1:O,y1:D,x2:N,y2:U,padding:H,projectedAnchorX:X,projectedAnchorY:te,projectedAnchorZ:ue,tileAnchorX:le,tileAnchorY:fe,featureIndex:De}=e.get(h);M.verticalTextBox={x1:O,y1:D,x2:N,y2:U,padding:H,projectedAnchorX:X,projectedAnchorY:te,projectedAnchorZ:ue,tileAnchorX:le,tileAnchorY:fe},M.verticalTextFeatureIndex=De}if(m<b){const{x1:O,y1:D,x2:N,y2:U,padding:H,projectedAnchorX:X,projectedAnchorY:te,projectedAnchorZ:ue,tileAnchorX:le,tileAnchorY:fe,featureIndex:De}=e.get(m);M.iconBox={x1:O,y1:D,x2:N,y2:U,padding:H,projectedAnchorX:X,projectedAnchorY:te,projectedAnchorZ:ue,tileAnchorX:le,tileAnchorY:fe},M.iconFeatureIndex=De}if(T<A){const{x1:O,y1:D,x2:N,y2:U,padding:H,projectedAnchorX:X,projectedAnchorY:te,projectedAnchorZ:ue,tileAnchorX:le,tileAnchorY:fe,featureIndex:De}=e.get(T);M.verticalIconBox={x1:O,y1:D,x2:N,y2:U,padding:H,projectedAnchorX:X,projectedAnchorY:te,projectedAnchorZ:ue,tileAnchorX:le,tileAnchorY:fe},M.verticalIconFeatureIndex=De}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const u=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const u=e.placedSymbolArray.get(i),h=u.vertexStartIndex+4*u.numGlyphs;for(let p=u.vertexStartIndex;p<h;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),u=Math.cos(e),h=[],p=[],m=[];for(let b=0;b<this.symbolInstances.length;++b){m.push(b);const T=this.symbolInstances.get(b);h.push(0|Math.round(i*T.tileAnchorX+u*T.tileAnchorY)),p.push(T.featureIndex)}return m.sort(((b,T)=>h[b]-h[T]||p[T]-p[b])),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,i){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===i?u.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const u=this.symbolInstances.get(i);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:A}=u;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let oC,aC,kb;nr(Pv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Pv.addDynamicAttributes=Av;class sC{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Kc,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}nr(sC,"FormatSectionOverride",{omit:["defaultValue"]});const Db=()=>kb||(kb={layout:oC||(oC=new Ei({"symbol-placement":new St(Ve.layout_symbol["symbol-placement"]),"symbol-spacing":new St(Ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new St(Ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Jt(Ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new St(Ve.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new St(Ve.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new St(Ve.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new St(Ve.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new St(Ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new St(Ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new St(Ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new Jt(Ve.layout_symbol["icon-size"]),"icon-size-scale-range":new St(Ve.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Jt(Ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Jt(Ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new Jt(Ve.layout_symbol["icon-image"]),"icon-rotate":new Jt(Ve.layout_symbol["icon-rotate"]),"icon-padding":new St(Ve.layout_symbol["icon-padding"]),"icon-keep-upright":new St(Ve.layout_symbol["icon-keep-upright"]),"icon-offset":new Jt(Ve.layout_symbol["icon-offset"]),"icon-anchor":new Jt(Ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new St(Ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new St(Ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new St(Ve.layout_symbol["text-rotation-alignment"]),"text-field":new Jt(Ve.layout_symbol["text-field"]),"text-font":new Jt(Ve.layout_symbol["text-font"]),"text-size":new Jt(Ve.layout_symbol["text-size"]),"text-size-scale-range":new St(Ve.layout_symbol["text-size-scale-range"]),"text-max-width":new Jt(Ve.layout_symbol["text-max-width"]),"text-line-height":new Jt(Ve.layout_symbol["text-line-height"]),"text-letter-spacing":new Jt(Ve.layout_symbol["text-letter-spacing"]),"text-justify":new Jt(Ve.layout_symbol["text-justify"]),"text-radial-offset":new Jt(Ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new St(Ve.layout_symbol["text-variable-anchor"]),"text-anchor":new Jt(Ve.layout_symbol["text-anchor"]),"text-max-angle":new St(Ve.layout_symbol["text-max-angle"]),"text-writing-mode":new St(Ve.layout_symbol["text-writing-mode"]),"text-rotate":new Jt(Ve.layout_symbol["text-rotate"]),"text-padding":new St(Ve.layout_symbol["text-padding"]),"text-keep-upright":new St(Ve.layout_symbol["text-keep-upright"]),"text-transform":new Jt(Ve.layout_symbol["text-transform"]),"text-offset":new Jt(Ve.layout_symbol["text-offset"]),"text-allow-overlap":new St(Ve.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new St(Ve.layout_symbol["text-ignore-placement"]),"text-optional":new St(Ve.layout_symbol["text-optional"]),visibility:new St(Ve.layout_symbol.visibility)})),paint:aC||(aC=new Ei({"icon-opacity":new Jt(Ve.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Jt(Ve.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Jt(Ve.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Jt(Ve.paint_symbol["text-emissive-strength"]),"icon-color":new Jt(Ve.paint_symbol["icon-color"]),"icon-halo-color":new Jt(Ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new Jt(Ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Jt(Ve.paint_symbol["icon-halo-blur"]),"icon-translate":new St(Ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new St(Ve.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new St(Ve.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Jt(Ve.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Jt(Ve.paint_symbol["text-occlusion-opacity"]),"text-color":new Jt(Ve.paint_symbol["text-color"],{runtimeType:ja,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Jt(Ve.paint_symbol["text-halo-color"]),"text-halo-width":new Jt(Ve.paint_symbol["text-halo-width"]),"text-halo-blur":new Jt(Ve.paint_symbol["text-halo-blur"]),"text-translate":new St(Ve.paint_symbol["text-translate"]),"text-translate-anchor":new St(Ve.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new St(Ve.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new St(Ve.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new St(Ve.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new St(Ve.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Jt(Ve.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"})}))},kb);class Iv extends Wo{constructor(e,i,u,h){super(e,Db(),i,u,h),this._colorAdjustmentMatrix=ee([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const h=[];for(const p of u)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,u,h){return this._saturation===e&&this._contrast===i&&this._brightnessMin===u&&this._brightnessMax===h||(this._colorAdjustmentMatrix=(function(p,m,b,T){p=Qo(p),m=ro(m);const A=ae(),M=p/3,O=1-2*M,D=[O,M,M,0,M,O,M,0,M,M,O,0,0,0,0,1],N=.5-.5*m,U=T-b;return de(A,[U,0,0,0,0,U,0,0,0,0,U,0,b,b,b,1],[m,0,0,0,0,m,0,0,0,0,m,0,N,N,N,1]),de(A,A,D),A})(e,i,u,h),this._saturation=e,this._contrast=i,this._brightnessMin=u,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,u,h){const p=this.layout.get(e).evaluate(i,{},u,h),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||bd(m.value)||!p?p:(function(b,T){return T.replace(/{([^{}]+)}/g,((A,M)=>M in b?String(b[M]):""))})(i.properties,p)}createBucket(e){return new Pv(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Db().paint.overridableProperties){if(!Iv.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),u=new sC(i),h=new Eu(u,i.property.specification,this.scope,this.options);let p=null;p=i.value.kind==="constant"||i.value.kind==="source"?new yc("source",h):new ls("composite",h,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Bs(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,u){return!(!this.layout||i.isDataDriven()||u.isDataDriven())&&Iv.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const u=e.get("text-field"),h=Db().paint.properties[i];let p=!1;const m=b=>{for(const T of b)if(h.overrides&&h.overrides.hasOverride(T))return void(p=!0)};if(u.value.kind==="constant"&&u.value.value instanceof ca)m(u.value.value.sections);else if(u.value.kind==="source"){const b=A=>{p||(A instanceof Ar&&Qt(A.value)===Yc?m(A.value.sections):A instanceof rc?m(A.sections):A.eachChild(b))},T=u.value;T._styleExpression&&b(T._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,u){return{config:new lo(this,{zoom:i,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let lC,uC,cC,hC;var zb=mn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Cv(o,e,i,u,h,p,m,b){const T=[o,e,1,i,u,1,h,p,1],A=[m,b,1],M=W([],T),[O,D,N]=pn(A,A,M);return ie(T,T,[O,0,0,0,D,0,0,0,N])}function fC(o,e,i,u,h,p,m,b){const T=(function(A,M,O,D,N,U,H,X){const te=Cv(0,0,1,0,1,1,0,1),ue=Cv(A,M,O,D,N,U,H,X);return ie(ue,ue,W([],te))})(o,e,i,u,h,p,m,b);return[T[2]/T[8]/$t,T[5]/T[8]/$t]}function Mv(o){return[o[0],Math.min(Math.max(o[1],-Se),Se)]}class dC extends hu{constructor(e,i,u,h){super(),this.id=e,this.dispatcher=u,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new al("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Tl(this.map._requestManager.transformRequest(this.url,ms.Image),((u,h)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new Io(u)):h&&(this.image=h instanceof HTMLImageElement?ds.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new __(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new al("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof __||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],u=e[0][1];for(const p of e)p[1]>u&&(u=p[1]),p[1]<i&&(i=p[1]);const h=(u+i)/2;if(h>Se?this.onNorthPole=!0:h<-Se&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=e.map(Ae.fromLngLat);this.tileID=(function(m){let b=1/0,T=1/0,A=-1/0,M=-1/0;for(const H of m)b=Math.min(b,H.x),T=Math.min(T,H.y),A=Math.max(A,H.x),M=Math.max(M,H.y);const O=Math.max(A-b,M-T),D=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),N=Math.pow(2,D);let U=Math.floor((b+A)/2*N);return U>1&&(U-=1),new ga(D,U,Math.floor((T+M)/2*N))})(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new al("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof __||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const te in this.tiles){const ue=this.tiles[te];ue.state!=="loaded"&&(ue.state="loaded",ue.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=A_(new ga(0,0,0),this.map.transform.projection),u=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(te){const ue=te[1].x-te[0].x,le=te[1].y-te[0].y,fe=te[2].x-te[1].x,De=te[2].y-te[1].y,Ie=te[3].x-te[2].x,Ce=te[3].y-te[2].y,Be=te[0].x-te[3].x,je=te[0].y-te[3].y,st=ue*De-fe*le,Ge=fe*Ce-Ie*De,ft=Ie*je-Be*Ce,jt=Be*le-ue*je;return st>0&&Ge>0&&ft>0&&jt>0||st<0&&Ge<0&&ft<0&&jt<0})(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=A_(this.tileID,this.map.transform.projection),[p,m,b,T]=this.coordinates.map((te=>{const ue=h.projection.project(te[0],te[1]);return QI(h,ue)._round()}));this.perspectiveTransform=fC(p.x,p.y,m.x,m.y,b.x,b.y,T.x,T.y);const A=this._boundsArray=new Pc;A.emplaceBack(p.x,p.y,0,0),A.emplaceBack(m.x,m.y,$t,0),A.emplaceBack(T.x,T.y,0,$t),A.emplaceBack(b.x,b.y,$t,$t),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(A,zb.members),this.boundsSegments=wi.simpleSegment(0,0,4,2);const M=[],O=[Mv((D=this.coordinates)[0]),Mv(D[1]),Mv(D[2]),Mv(D[3])];var D;const[N,U,H,X]=(function(te){let ue=te[0][0],le=ue,fe=te[0][1],De=fe;for(let Ie=1;Ie<te.length;Ie++)te[Ie][0]<ue?ue=te[Ie][0]:te[Ie][0]>le&&(le=te[Ie][0]),te[Ie][1]<fe?fe=te[Ie][1]:te[Ie][1]>De&&(De=te[Ie][1]);return[ue,fe,le-ue,De-fe]})(O);{const te=new Pc,[ue,le,fe,De]=(function(ot){let Ot=ot[0].x,Xe=Ot,at=ot[0].y,Ut=at;for(let Rt=1;Rt<ot.length;Rt++)ot[Rt].x<Ot?Ot=ot[Rt].x:ot[Rt].x>Xe&&(Xe=ot[Rt].x),ot[Rt].y<at?at=ot[Rt].y:ot[Rt].y>Ut&&(Ut=ot[Rt].y);return[Ot,at,Xe-Ot,Ut-at]})(u),Ie=ot=>[(ot.x-ue)/fe,(ot.y-le)/De],[Ce,Be,je,st]=u.map(Ie),Ge=(function(ot,Ot,Xe,at,Ut,Rt,gr,ar){const At=Cv(0,0,1,0,1,1,0,1);return ie(At,At,W([],Cv(ot,Ot,Xe,at,Ut,Rt,gr,ar)))})(Ce[0],Ce[1],Be[0],Be[1],je[0],je[1],st[0],st[1]);this.elevatedGlobePerspectiveTransform=fC(Ce[0],Ce[1],Be[0],Be[1],je[0],je[1],st[0],st[1]);const ft=(ot,Ot)=>{M.push(ot.lng);const Xe=Math.round((ot.lng-N)/H*$t),at=Math.round((ot.lat-U)/X*$t),Ut=Ie(Ot),Rt=pn([],[Ut[0],Ut[1],1],Ge),gr=Math.round(Rt[0]/Rt[2]*$t),ar=Math.round(Rt[1]/Rt[2]*$t);te.emplaceBack(Xe,at,gr,ar)},jt=u[3].x-u[0].x,_t=u[3].y-u[0].y,Mt=u[2].x-u[1].x,Ft=u[2].y-u[1].y;for(let ot=0;ot<65;ot++){const Ot=ot/64,Xe=[u[0].x+Ot*jt,u[0].y+Ot*_t],at=[u[1].x+Ot*Mt,u[1].y+Ot*Ft],Ut=at[0]-Xe[0],Rt=at[1]-Xe[1];for(let gr=0;gr<65;gr++){const ar=gr/64,At={x:Xe[0]+Ut*ar,y:Xe[1]+Rt*ar};ft(i.projection.unproject(At.x,At.y),At)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(te,zb.members)}{this.maxLongitudeTriangleSize=0;let te=[],ue=new ai;const le=(fe,De,Ie)=>{ue.emplaceBack(fe,De,Ie);const Ce=M[fe],Be=M[De],je=M[Ie],st=Math.min(Math.min(Ce,Be),je),Ge=Math.max(Math.max(Ce,Be),je)-st;Ge>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ge),te.push(st+Ge/2)};for(let fe=0;fe<64;fe++)for(let De=0;De<64;De++){const Ie=65*fe+De,Ce=Ie+1,Be=Ie+65,je=Be+1;le(Ie,Be,Ce),le(Ce,Be,je)}[te,ue]=(function(fe,De){const Ie=Array.from({length:fe.length},((je,st)=>st));Ie.sort(((je,st)=>fe[je]-fe[st]));const Ce=[],Be=new ai;for(let je=0;je<Ie.length;je++){const st=Ie[je];Ce.push(fe[st]);const Ge=3*st,ft=Ge+1;Be.emplaceBack(De.uint16[Ge],De.uint16[ft],De.uint16[ft+1])}return[Ce,Be]})(te,ue),this.elevatedGlobeTrianglesCenterLongitudes=te,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ue)}this.elevatedGlobeSegments=wi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,H/$t,0,X/$t,0,0,U,N,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,u=i.gl;!this._dirty||this.texture instanceof __||(this.texture?this.texture.update(this.image):(this.texture=new cb(i,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let h=(p=e+180)+360*Math.round((u[0]-p)/360);var p;const m=new wi,b=(O,D)=>{m.segments.push({vertexOffset:0,primitiveOffset:O,vertexLength:i.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},T=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-h)<=T){const O=oo(u,0,u.length,h+T);return O===u.length||b(O,gi(u,O+1,u.length,h+360-T)-O),m}h<u[0]&&(h+=360);const A=gi(u,0,u.length,h-T);if(A===u.length)return b(0,u.length),m;b(0,A-0);const M=oo(u,A+1,u.length,h+T);return M!==u.length&&b(M,u.length-M),m}}const P4=(Math.pow(256,2)-1)/16907520;class pC extends Wo{constructor(e,i,u,h){super(e,{layout:cC||(cC=new Ei({visibility:new St(Ve.layout_raster.visibility)})),paint:hC||(hC=new Ei({"raster-opacity":new St(Ve.paint_raster["raster-opacity"]),"raster-color":new Au(Ve.paint_raster["raster-color"]),"raster-color-mix":new St(Ve.paint_raster["raster-color-mix"]),"raster-color-range":new St(Ve.paint_raster["raster-color-range"]),"raster-hue-rotate":new St(Ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new St(Ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new St(Ve.paint_raster["raster-brightness-max"]),"raster-saturation":new St(Ve.paint_raster["raster-saturation"]),"raster-contrast":new St(Ve.paint_raster["raster-contrast"]),"raster-resampling":new St(Ve.paint_raster["raster-resampling"]),"raster-fade-duration":new St(Ve.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new St(Ve.paint_raster["raster-emissive-strength"]),"raster-array-band":new St(Ve.paint_raster["raster-array-band"]),"raster-elevation":new St(Ve.paint_raster["raster-elevation"]),"raster-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"})}))},i,u,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof dC&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[u,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(h)||u===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=r_({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,h])}}let mC,gC,_C,yC,vC;class xC extends Wo{constructor(e,i,u,h){super(e,{layout:mC||(mC=new Ei({visibility:new St(Ve["layout_raster-particle"].visibility)})),paint:gC||(gC=new Ei({"raster-particle-array-band":new St(Ve["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new St(Ve["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Au(Ve["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new St(Ve["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new St(Ve["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new St(Ve["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new St(Ve["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new St(Ve["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"})}))},i,u,h),this._updateColorRamp(),this.lastInvalidatedAt=ds.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=r_({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ds.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class I4 extends Wo{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Lb(o,e,i){const u=[0,0,1],h=Fa([]);return Js(h,h,i?-Cn(o)+Math.PI:Cn(o)),Ms(h,h,-Cn(e)),sr(u,u,h),Ir(u,u)}const bC={None:0,Model:1,Symbol:2,FillExtrusion:4};class Ov{constructor(e,i,u,h){this.message=(e?`${e}: `:"")+u,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function Fb(o,e){const i=o.indexOf("://")===-1;try{return new URL(o,i&&e?"http://example.com":void 0),!0}catch{return!1}}class wC{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class SC{constructor(){this.instancedDataArray=new Af,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Bb{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,u,h){this.tileToMeter=Ee(u);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:b,index:T,sourceLayerIndex:A}of e){const M=b??(m.properties&&m.properties.hasOwnProperty("id")?m.properties.id:void 0),O=tt(m,p);if(!this.layers[0]._featureFilter.filter(new Un(this.zoom,{worldview:this.worldview}),O,u))continue;const D={id:M,sourceLayerIndex:A,index:T,geometry:p?O.geometry:Re(m,u,h),properties:m.properties,type:m.type,patterns:{}},N=this.addFeature(D,D.geometry,O);N&&i.featureIndex.insert(m,D.geometry,T,A,this.index,this.instancesPerModel[N].instancedDataArray.length,$t/32)}this.lookup=null}update(e,i,u,h){for(const p in this.instancesPerModel){const m=this.instancesPerModel[p];for(const b in e)m.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(m.features[m.idToFeaturesIndex[b]],e[b],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const u=this.instancesPerModel[i];for(const h of u.features){const p=this.layers[0],m=h.feature,b=this.canonical,T=p.paint.get("model-rotation").evaluate(m,{},b),A=p.paint.get("model-scale").evaluate(m,{},b),M=p.paint.get("model-translation").evaluate(m,{},b);Rn(h.rotation,T)&&Rn(h.scale,A)&&Rn(h.translation,M)||(this.evaluate(h,h.featureStates,u,!0),e=!0)}}return e}updateReplacement(e,i,u,h){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const p=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(rv(this.activeReplacements,p))return!1;this.activeReplacements=p;let m=!1;for(const b in this.instancesPerModel){const T=this.instancesPerModel[b],A=T.instancedDataArray;for(const M of T.features){const O=M.instancedDataOffset,D=M.instancedDataCount;for(let N=0;N<D;N++){const U=16*(N+O);let H=A.float32[U+0];const X=H>$t;H=X?H-$t:H;const te=Math.floor(H),ue=A.float32[U+1];let le=!1;for(const fe of this.activeReplacements)if(!cP(fe,u,bC.Model,h)&&!(fe.min.x>te||te>fe.max.x||fe.min.y>ue||ue>fe.max.y)&&(le=Jx(pP(te,ue,e.canonical,fe.footprintTileId.canonical),fe.footprint),le))break;A.float32[U]=le?H+$t:H,m=m||le!==X}}}return m}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const u=this.instancesPerModel[i];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=e.createVertexBuffer(u.instancedDataArray,s5.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const u=this.instancesPerModel[i];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,u){const h=this.layers[0],p=h.layout.get("model-id").evaluate(u,{},this.canonical);if(!p)return hn(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),p;(Fb(p,!1)||this.styleDefinedModelURLs[p]!==void 0)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new SC);const m=this.instancesPerModel[p],b=m.instancedDataArray,T=new wC(u,b.length);for(const A of i)for(const M of A){if(M.x<0||M.x>=$t||M.y<0||M.y>=$t)continue;const O=(this.lookupDim-1)/$t,D=this.lookupDim*(M.y*O|0)+M.x*O|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}this.instanceCount++;const N=b.length;b.resize(N+1),m.instancesEvaluatedElevation.push(0),b.float32[16*N]=M.x,b.float32[16*N+1]=M.y}return T.instancedDataCount=m.instancedDataArray.length-T.instancedDataOffset,T.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(T),this.evaluate(T,{},m,!1)),p}getModelUris(){return this.modelUris}evaluate(e,i,u,h){const p=this.layers[0],m=e.feature,b=this.canonical,T=e.rotation=p.paint.get("model-rotation").evaluate(m,i,b),A=e.scale=p.paint.get("model-scale").evaluate(m,i,b),M=e.translation=p.paint.get("model-translation").evaluate(m,i,b),O=p.paint.get("model-color").evaluate(m,i,b);O.a=p.paint.get("model-color-mix-intensity").evaluate(m,i,b);const D=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),XP(D,T,A);const N=Math.round(100*O.a)+O.b/1.05;for(let U=0;U<e.instancedDataCount;++U){const H=e.instancedDataOffset+U,X=16*H,te=u.instancedDataArray.float32;let ue=0;h&&(ue=te[X+6]-u.instancesEvaluatedElevation[H]);const le=0|te[X+1];te[X]=(0|te[X])+O.r/1.05,te[X+1]=le+O.g/1.05,te[X+2]=N,te[X+3]=1/(b.z>10?this.tileToMeter:Ee(b,le)),te[X+4]=M[0],te[X+5]=M[1],te[X+6]=M[2]+ue,te[X+7]=D[0],te[X+8]=D[1],te[X+9]=D[2],te[X+10]=D[4],te[X+11]=D[5],te[X+12]=D[6],te[X+13]=D[8],te[X+14]=D[9],te[X+15]=D[10],u.instancesEvaluatedElevation[H]=M[2]}}}let TC,EC;nr(Bb,"ModelBucket",{omit:["layers"]}),nr(SC,"PerModelAttributes"),nr(wC,"ModelFeature");class Ym{constructor(e,i,u){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=u}static create(e,i,u){const h=u||e.findDEMTileFor(i);if(!h||!h.dem)return;const p=h.dem,m=h.tileID,b=1<<i.canonical.z-m.canonical.z;return new Ym(h,p.dim/$t/b,[(i.canonical.x/b-m.canonical.x)*p.dim,(i.canonical.y/b-m.canonical.y)*p.dim])}tileCoordToPixel(e,i){const u=i*this._scale+this._offset[1];return new Ct(Math.floor(e*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(e,i,u,h){const p=e*this._scale+this._offset[0],m=i*this._scale+this._offset[1],b=Math.floor(p),T=Math.floor(m),A=this._dem;return h=!!h,u?wr(wr(A.get(b,T,h),A.get(b,T+1,h),m-T),wr(A.get(b+1,T,h),A.get(b+1,T+1,h),m-T),p-b):A.get(b,T,h)}getElevationAtPixel(e,i,u){return this._dem.get(e,i,!!u)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Y(1,e)*this._dem.stride}}const Nb=new Float32Array(262144),Kp=new Uint8Array(262144);function AC(o){let e=0;if(o.meshes)for(const i of o.meshes)e=Math.max(e,i.aabb.max[2]);if(o.children)for(const i of o.children)e=Math.max(e,AC(i));return e}function PC(o,e,i){if(o.meshes)for(const u of o.meshes){if(u.aabb.min[0]===1/0)continue;const h=Mr.applyTransform(u.aabb,o.matrix);i.insert(e,h.min[0],h.min[1],h.max[0],h.max[1])}if(o.children)for(const u of o.children)PC(u,e,i)}const IC=["","wall","door","roof","window","lamp","logo"];class CC{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:AC(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==e&&(u.transformedAabb=Mr.applyTransformFast(u.aabb,this.node.matrix),i.encapsulate(u.transformedAabb)),e++;this.aabb=i}return this.aabb}}class Rv{constructor(e,i,u,h,p,m,b,T){this.id=u,this.layers=e,this.layerIds=this.layers.map((A=>A.fqid)),this.stateDependentLayerIds=this.layers.filter((A=>A.isStateDependent())).map((A=>A.id)),this.modelTraits|=Gm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=Gm.HasMapboxMeshFeatures),p&&(this.modelTraits|=Gm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.worldview=T,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const A of i)this.nodesInfo.push(new CC(A)),PC(A,b.featureIndexArray.length,b.grid),b.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,b.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const u of this.getNodesInfo()){const h=u.node;h.footprint&&i.push({footprint:h.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const u=i?this.stateDependentLayers:this.layers;if(!il(e,this.states))for(const h of u)this.evaluate(h,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const u of i){const h=u.node;this.uploaded?this.updatePbrBuffer(h):db(h,e,!0)}for(const u of i)fv(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const u of e.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),i=!0);return i}needsReEvaluation(e,i,u){const h=e.transform.projectionOptions,p=e.style.getBrightness(),m=this.brightness!==p;if(!this.uploaded||this.dirty||h.name!==this.projection.name||O_(u.paint.get("model-color").value,m)||O_(u.paint.get("model-color-mix-intensity").value,m)||O_(u.paint.get("model-roughness").value,m)||O_(u.paint.get("model-emissive-strength").value,m)||O_(u.paint.get("model-height-based-emissive-strength-multiplier").value,m)){this.projection=h,this.brightness=p;const b=this.getNodesInfo();for(const T of b)T.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const u=this.getNodesInfo(),h=this.id.canonical;for(const p of u){const m=p.feature;p.evaluatedTranslation=i.paint.get("model-translation").evaluate(m,{},h),p.evaluatedScale=i.paint.get("model-scale").evaluate(m,{},h)}}evaluate(e,i){const u=this.getNodesInfo();for(const h of u){if(!h.node.meshes)continue;const p=h.feature,m=i&&i[p.id];if(il(m,h.state))continue;h.state=structuredClone(m);const b=h.node.meshes&&h.node.meshes[0].featureData,T=h.evaluatedColor[2],A=h.evaluatedRMEA[2],M=this.id.canonical;if(h.hasTranslucentParts=!1,b){for(let O=0;O<IC.length;O++){const D=IC[O];D.length&&(p.properties.part=D);const N=e.paint.get("model-color").evaluate(p,m,M).toPremultipliedRenderColor(null),U=e.paint.get("model-color-mix-intensity").evaluate(p,m,M);h.evaluatedColor[O]=[N.r,N.g,N.b,U],h.evaluatedRMEA[O][0]=e.paint.get("model-roughness").evaluate(p,m,M),h.evaluatedRMEA[O][2]=e.paint.get("model-emissive-strength").evaluate(p,m,M),h.evaluatedRMEA[O][3]=N.a,h.emissionHeightBasedParams[O]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,m,M),!h.hasTranslucentParts&&N.a<1&&(h.hasTranslucentParts=!0)}delete p.properties.part,M4(h,T!==h.evaluatedColor[2]||A!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(p,m,M);h.evaluatedTranslation=e.paint.get("model-translation").evaluate(p,m,M),h.evaluatedScale=e.paint.get("model-scale").evaluate(p,m,M),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,u,h){const p=e.findDEMTileFor(u);if(p&&(p.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const m=Ym.create(e,u,p);if(!m)return;this.modelTraits&Gm.HasMapboxMeshFeatures&&this.updateDEM(e,m,u,h);for(const b of this.getNodesInfo()){const T=b.node;if(!T.footprint||!T.footprint.vertices||!T.footprint.vertices.length)continue;const A=T.footprint.vertices;let M=m.getElevationAt(A[0].x,A[0].y,!0,!0);for(let O=1;O<A.length;O++)M=Math.min(M,m.getElevationAt(A[O].x,A[O].y,!0,!0));T.elevation=M}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,u,h){let p=i._dem._modifiedForSources[h];if(p===void 0&&(i._dem._modifiedForSources[h]=[],p=i._dem._modifiedForSources[h]),p.includes(u.canonical))return;const m=i._dem.dim;p.push(u.canonical);let b=!1;for(const T of this.getNodesInfo()){const A=T.node;if(!A.footprint||!A.footprint.grid)continue;const M=A.footprint.grid,O=i.tileCoordToPixel(M.min.x,M.min.y),D=i.tileCoordToPixel(M.max.x,M.max.y),N=Math.min(Math.min(m-D.y,O.x),Math.min(O.y,m-D.x));if(N<0)continue;const U=ve(N,2,5);let H=Math.max(0,O.x-U),X=Math.max(0,O.y-U),te=Math.min(D.x+U,m-1),ue=Math.min(D.y+U,m-1);for(let Ie=X;Ie<=ue;++Ie)for(let Ce=H;Ce<=te;++Ce)Kp[Ie*m+Ce]=255;let le=0,fe=0;for(let Ie=0;Ie<M.cellsY;++Ie)for(let Ce=0;Ce<M.cellsX;++Ce){if(!M.cells[Ie*M.cellsX+Ce])continue;const Be=i.tileCoordToPixel(M.min.x+Ce/M.xScale,M.min.y+Ie/M.yScale),je=i.tileCoordToPixel(M.min.x+(Ce+1)/M.xScale,M.min.y+(Ie+1)/M.yScale);for(let st=Be.y;st<=Math.min(je.y+1,m-1);++st)for(let Ge=Be.x;Ge<=Math.min(je.x+1,m-1);++Ge)Kp[st*m+Ge]===255&&(Kp[st*m+Ge]=0,le+=i.getElevationAtPixel(Ge,st),fe++)}const De=le/fe;H=Math.max(1,O.x-U),X=Math.max(1,O.y-U),te=Math.min(D.x+U,m-2),ue=Math.min(D.y+U,m-2),b=!0;for(let Ie=X;Ie<=ue;++Ie)for(let Ce=H;Ce<=te;++Ce)Kp[Ie*m+Ce]===0&&(Nb[Ie*m+Ce]=i._dem.set(Ce,Ie,De));for(let Ie=1;Ie<U;++Ie){H=Math.max(1,O.x-Ie),X=Math.max(1,O.y-Ie),te=Math.min(D.x+Ie,m-2),ue=Math.min(D.y+Ie,m-2);for(let Ce=X;Ce<=ue;++Ce)for(let Be=H;Be<=te;++Be){const je=Ce*m+Be;if(Kp[je]===255){let st=0,Ge=0,ft=-1,jt=-1;for(let _t=-1;_t<=1;++_t)for(let Mt=-1;Mt<=1;++Mt){const Ft=(Ce+_t)*m+Be+Mt;if(Kp[Ft]>=Ie)continue;const ot=Nb[Ft],Ot=Math.abs(ot);Ot>Ge&&(st=ot,Ge=Ot,ft=Mt,jt=_t)}if(Ge>.1){const _t=1-(Ie+.5*Math.abs(ft*jt))/U;let Mt=i._dem.get(Be,Ce)+st*_t;const Ft=i._dem.get(Be+ft,Ce+jt),ot=i._dem.get(Be-ft,Ce-jt,!0);(Mt-Ft)*(Mt-ot)>0&&(Mt=(Ft+ot)/2),Nb[je]=i._dem.set(Be,Ce,Mt),Kp[je]=Ie}}}}}b&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ds.now())}setFilter(e){this.filter=e?Pu(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new Un(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)fv(i.node),pb(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());for(const h of this.getNodesInfo()){const p=h.node.footprint;h.hiddenByReplacement=!!p&&!u.find((m=>m.footprint===p))}}getHeightAtTileCoord(e,i){const u=[],h=[0,0,0],p=ee([]);for(const m of this.getNodesInfo()){const b=m.node.meshes[0],T=b.transformedAabb;if(e<T.min[0]||i<T.min[1]||e>T.max[0]||i>T.max[1])continue;if(m.node.hidden===!0)return{height:1/0,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};ne(p,m.node.matrix),h[0]=e,h[1]=i,Er(h,h,p);const A=(h[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*Wp|0,M=Math.min(63,(h[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*Wp|0)*Wp+Math.min(63,A),O=b.heightmap[M];if(!(O<0&&m.node.footprint))return m.hiddenByReplacement?void 0:{height:O,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};if(m.node.footprint.grid.query(new Ct(e,i),new Ct(e,i),u),u.length>0)return{height:void 0,maxHeight:m.feature.properties.height,hidden:m.hiddenByReplacement,verticalScale:m.evaluatedScale[2]}}}}function O_(o,e){return o instanceof yc&&!o.isLightConstant&&e}function C4(o,e,i,u,h,p,m,b){let T=(61440&e|(61440&e)>>4)>>8,A=(3840&e|(3840&e)>>4)>>4,M=240&e|(240&e)>>4;i[3]>0&&(T=wr(T,255*i[0],i[3]),A=wr(A,255*i[1],i[3]),M=wr(M,255*i[2],i[3]));const O=T<<8|A,D=M<<8|Math.floor(255*u[3]),N=(function(Ie){const Ce=ve(Ie,0,2);return Math.min(Math.round(.5*Ce*255),255)})(u[2])<<8|15*u[0]<<4|15*u[1],U=ve(h[0],0,1),H=ve(h[1],0,1),X=ve(h[2],0,1),te=ve(h[3],0,1);let ue,le,fe,De;if(U!==H&&m!==p&&H!==U){const Ie=m-p;le=1/(Ie*(H-U)),fe=-(p+Ie*U)/(Ie*(H-U));const Ce=ve(h[4],-1,1);De=Math.pow(10,Ce),ue=255*X<<8|255*te}else ue=65535,le=0,fe=1,De=1;if(o.emplaceBack(O,D,N,ue,le,fe,De),b){const Ie=b.length;b.clear();for(let Ce=0;Ce<Ie;Ce++)b.emplaceBack(O,D,N,ue,le,fe,De)}}function M4(o,e,i){const u=o.node;let h=0;const p=i&Gm.HasMeshoptCompression;for(const m of u.meshes){if(u.lights&&u.lightMeshIndex===h||!m.featureData)continue;m.featureArray=new Cc,m.featureArray.reserve(m.featureData.length);let b=e;for(const T of m.featureData){const A=p?65535&T:T>>16&65535,M=p?T>>16&65535:65535&T,O=(15&M)<8?15&M:0,D=o.evaluatedRMEA[O],N=o.evaluatedColor[O],U=o.emissionHeightBasedParams[O];let H;if(b&&O===2&&u.lights&&(H=new Cc,H.resize(10*u.lights.length)),C4(m.featureArray,A,N,D,U,m.aabb.min[2],m.aabb.max[2],H),H&&b){b=!1;const X=u.meshes[u.lightMeshIndex];X.featureArray=H,X.featureArray._trim()}}m.featureArray._trim(),h++}}function MC(o,e,i,u){const h=1<<o.z;e.lat=ce((u/$t+o.y)/h),e.lng=se((i/$t+o.x)/h)}function O4(o,e,i,u){const h=o.getNodesInfo()[e];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let p=Number.MAX_VALUE;const m=h.node,b=i.tile,T=u.calculatePosMatrix(b.tileID.toUnwrapped(),u.worldSize),A=h.evaluatedScale;let M=0;u.elevation&&m.elevation&&(M=m.elevation*u.elevation.exaggeration()),xe(T,T,[(m.anchor?m.anchor[0]:0)*(A[0]-1),(m.anchor?m.anchor[1]:0)*(A[1]-1),M]),be(T,T,A);const O=i.queryGeometry,D=O.isPointQuery()?O.screenBounds:O.screenGeometry,N=function(H){const X=de([],T,H.matrix);de(X,u.expandedFarZProjMatrix,X);for(let te=0;te<H.meshes.length;++te){const ue=H.meshes[te];if(te===H.lightMeshIndex)continue;const le=KP(D,u,X,ue.aabb);le!=null&&(p=Math.min(le,p))}if(H.children)for(const te of H.children)N(te)};if(N(m),p===Number.MAX_VALUE)return;const U=new L(0,0);return MC(b.tileID.canonical,U,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:p,position:U,feature:h.feature}}nr(Rv,"Tiled3dModelBucket",{omit:["layers"]}),nr(CC,"Tiled3dModelFeature");const R4={circle:class extends Wo{constructor(o,e,i,u){super(o,{layout:Du||(Du=new Ei({"circle-sort-key":new Jt(Ve.layout_circle["circle-sort-key"]),"circle-elevation-reference":new St(Ve.layout_circle["circle-elevation-reference"]),visibility:new St(Ve.layout_circle.visibility)})),paint:Oc||(Oc=new Ei({"circle-radius":new Jt(Ve.paint_circle["circle-radius"]),"circle-color":new Jt(Ve.paint_circle["circle-color"]),"circle-blur":new Jt(Ve.paint_circle["circle-blur"]),"circle-opacity":new Jt(Ve.paint_circle["circle-opacity"]),"circle-translate":new St(Ve.paint_circle["circle-translate"]),"circle-translate-anchor":new St(Ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new St(Ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new St(Ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Jt(Ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Jt(Ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Jt(Ve.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new St(Ve.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u)}createBucket(o){return new Ln(o)}queryRadius(o){const e=o;return uo("circle-radius",this,e)+uo("circle-stroke-width",this,e)+Ai(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,i,u,h,p,m,b){const T=Hl(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Ri(o,u,p,m,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,e,i){const u=aa(this);return{config:new lo(this,{zoom:e,lut:i}),defines:u,overrideFog:!1}}is3D(o){return!o&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Wo{createBucket(o){return new N2(o)}constructor(o,e,i,u){super(o,{layout:j2||(j2=new Ei({visibility:new St(Ve.layout_heatmap.visibility)})),paint:U2||(U2=new Ei({"heatmap-radius":new Jt(Ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Jt(Ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new St(Ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Au(Ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new St(Ve.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=r_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(o){return uo("heatmap-radius",this,o)}queryIntersectsFeature(o,e,i,u,h,p,m,b){const T=this.paint.get("heatmap-radius").evaluate(e,i);return Ri(o,u,p,m,b,!0,!0,new Ct(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,e,i){return o==="heatmap"?{config:new lo(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Wo{constructor(o,e,i,u){super(o,{layout:V2||(V2=new Ei({visibility:new St(Ve.layout_hillshade.visibility)})),paint:$2||($2=new Ei({"hillshade-illumination-direction":new St(Ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new St(Ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new St(Ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new St(Ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new St(Ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new St(Ve.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new St(Ve.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,e,i){return{overrideFog:!1}}},fill:class extends Wo{constructor(o,e,i,u){super(o,{layout:iP||(iP=new Ei({"fill-sort-key":new Jt(Ve.layout_fill["fill-sort-key"]),visibility:new St(Ve.layout_fill.visibility),"fill-elevation-reference":new St(Ve.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Jt(Ve.layout_fill["fill-construct-bridge-guard-rail"])})),paint:oP||(oP=new Ei({"fill-antialias":new St(Ve.paint_fill["fill-antialias"]),"fill-opacity":new Jt(Ve.paint_fill["fill-opacity"]),"fill-color":new Jt(Ve.paint_fill["fill-color"]),"fill-outline-color":new Jt(Ve.paint_fill["fill-outline-color"]),"fill-translate":new St(Ve.paint_fill["fill-translate"]),"fill-translate-anchor":new St(Ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new Jt(Ve.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new St(Ve.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new St(Ve.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Jt(Ve.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Jt(Ve.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Jt(Ve.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(o,e,i){return{config:new lo(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(o,e){super.recalculate(o,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Xx(o)}queryRadius(){return Ai(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,i,u,h,p){return!o.queryGeometry.isAboveHorizon&&ti(Xa(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(o){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return o!=null?e&&!o:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Wo{constructor(o,e,i,u){super(o,{layout:IP||(IP=new Ei({visibility:new St(Ve["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new St(Ve["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:CP||(CP=new Ei({"fill-extrusion-opacity":new St(Ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Jt(Ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new St(Ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new St(Ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Jt(Ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new St(Ve["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Jt(Ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Jt(Ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new St(Ve["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new St(Ve["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new St(Ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new St(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new St(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new St(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new St(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new St(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new St(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new St(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Jt(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Jt(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new St(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new St(Ve["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new St(Ve["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new St(Ve["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Jt(Ve["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Jt(Ve["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new St(Ve["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new iv(o)}queryRadius(){return Ai(this.paint.get("fill-extrusion-translate"))}is3D(o){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,e,i,u,h,p,m,b,T){const A=Hl(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,i),O=this.paint.get("fill-extrusion-base").evaluate(e,i),D=[0,0],N=b&&p.elevation,U=p.elevation?p.elevation.exaggeration():1,H=o.tile.getBucket(this);if(N&&H instanceof iv){const fe=H.centroidVertexArray,De=T+1;De<fe.length&&(D[0]=fe.geta_centroid_pos0(De),D[1]=fe.geta_centroid_pos1(De))}if(D[0]===0&&D[1]===1)return!1;p.projection.name==="globe"&&(u=PP([u],[new Ct(0,0),new Ct($t,$t)],o.tileID.canonical).map((fe=>fe.polygon)).flat());const X=N?b:null,[te,ue]=(function(fe,De,Ie,Ce,Be,je,st,Ge,ft,jt,_t){return fe.projection.name==="globe"?(function(Mt,Ft,ot,Ot,Xe,at,Ut,Rt,gr,ar,At){const zt=[],hr=[],er=Mt.projection.upVectorScale(At,Mt.center.lat,Mt.worldSize).metersToTile,Gt=[0,0,0,1],rr=[0,0,0,1],Pr=(Zr,qr,yn,nn)=>{Zr[0]=qr,Zr[1]=yn,Zr[2]=nn,Zr[3]=1},Fr=AP();ot>0&&(ot+=Fr),Ot+=Fr;for(const Zr of Ft){const qr=[],yn=[];for(const nn of Zr){const fi=nn.x+Xe.x,me=nn.y+Xe.y,ge=Mt.projection.projectTilePoint(fi,me,At),nt=Mt.projection.upVector(At,nn.x,nn.y);let Vt=ot,Kt=Ot;if(Ut){const Xt=zP(fi,me,ot,Ot,Ut,Rt,gr,ar);Vt+=Xt.base,Kt+=Xt.top}ot!==0?Pr(Gt,ge.x+nt[0]*er*Vt,ge.y+nt[1]*er*Vt,ge.z+nt[2]*er*Vt):Pr(Gt,ge.x,ge.y,ge.z),Pr(rr,ge.x+nt[0]*er*Kt,ge.y+nt[1]*er*Kt,ge.z+nt[2]*er*Kt),Er(Gt,Gt,at),Er(rr,rr,at),qr.push(new Gp(Gt[0],Gt[1],Gt[2])),yn.push(new Gp(rr[0],rr[1],rr[2]))}zt.push(qr),hr.push(yn)}return[zt,hr]})(fe,De,Ie,Ce,Be,je,st,Ge,ft,jt,_t):st?(function(Mt,Ft,ot,Ot,Xe,at,Ut,Rt,gr){const ar=[],At=[],zt=[0,0,0,1];for(const hr of Mt){const er=[],Gt=[];for(const rr of hr){const Pr=rr.x+Ot.x,Fr=rr.y+Ot.y,Zr=zP(Pr,Fr,Ft,ot,at,Ut,Rt,gr);zt[0]=Pr,zt[1]=Fr,zt[2]=Zr.base,zt[3]=1,Ui(zt,zt,Xe),zt[3]=Math.max(zt[3],1e-5);const qr=new Gp(zt[0]/zt[3],zt[1]/zt[3],zt[2]/zt[3]);zt[0]=Pr,zt[1]=Fr,zt[2]=Zr.top,zt[3]=1,Ui(zt,zt,Xe),zt[3]=Math.max(zt[3],1e-5);const yn=new Gp(zt[0]/zt[3],zt[1]/zt[3],zt[2]/zt[3]);er.push(qr),Gt.push(yn)}ar.push(er),At.push(Gt)}return[ar,At]})(De,Ie,Ce,Be,je,st,Ge,ft,jt):(function(Mt,Ft,ot,Ot,Xe){const at=[],Ut=[],Rt=Xe[8]*Ft,gr=Xe[9]*Ft,ar=Xe[10]*Ft,At=Xe[11]*Ft,zt=Xe[8]*ot,hr=Xe[9]*ot,er=Xe[10]*ot,Gt=Xe[11]*ot;for(const rr of Mt){const Pr=[],Fr=[];for(const Zr of rr){const qr=Zr.x+Ot.x,yn=Zr.y+Ot.y,nn=Xe[0]*qr+Xe[4]*yn+Xe[12],fi=Xe[1]*qr+Xe[5]*yn+Xe[13],me=Xe[2]*qr+Xe[6]*yn+Xe[14],ge=Xe[3]*qr+Xe[7]*yn+Xe[15],nt=nn+Rt,Vt=fi+gr,Kt=me+ar,Xt=Math.max(ge+At,1e-5),cr=nn+zt,Dr=fi+hr,fn=me+er,dn=Math.max(ge+Gt,1e-5);Pr.push(new Gp(nt/Xt,Vt/Xt,Kt/Xt)),Fr.push(new Gp(cr/dn,Dr/dn,fn/dn))}at.push(Pr),Ut.push(Fr)}return[at,Ut]})(De,Ie,Ce,Be,je)})(p,u,O,M,A,m,X,D,U,p.center.lat,o.tileID.canonical),le=o.queryGeometry;return(function(fe,De,Ie){let Ce=1/0;ti(Ie,De)&&(Ce=DP(Ie,De[0]));for(let Be=0;Be<De.length;Be++){const je=De[Be],st=fe[Be];for(let Ge=0;Ge<je.length-1;Ge++){const ft=je[Ge],jt=[ft,je[Ge+1],st[Ge+1],st[Ge],ft];Wn(Ie,jt)&&(Ce=Math.min(Ce,DP(Ie,jt)))}}return Ce!==1/0&&Ce})(te,ue,le.isPointQuery()?le.screenBounds:le.screenGeometry)}},building:class extends Wo{constructor(o,e,i,u){super(o,{layout:oI||(oI=new Ei({visibility:new St(Ve.layout_building.visibility),"building-facade":new Jt(Ve.layout_building["building-facade"]),"building-facade-floors":new Jt(Ve.layout_building["building-facade-floors"]),"building-facade-window":new Jt(Ve.layout_building["building-facade-window"]),"building-roof-shape":new Jt(Ve.layout_building["building-roof-shape"]),"building-height":new Jt(Ve.layout_building["building-height"]),"building-base":new Jt(Ve.layout_building["building-base"])})),paint:aI||(aI=new Ei({"building-opacity":new St(Ve.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new St(Ve.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new St(Ve.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new St(Ve.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new St(Ve.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new St(Ve.paint_building["building-vertical-scale"]),"building-cast-shadows":new St(Ve.paint_building["building-cast-shadows"]),"building-color":new Jt(Ve.paint_building["building-color"]),"building-emissive-strength":new Jt(Ve.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new St(Ve.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new St(Ve.paint_building["building-cutoff-fade-range"]),"building-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new iI(o)}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(o){return!0}},line:class extends Wo{constructor(o,e,i,u){const h=gI();super(o,h,e,i,u),h.layout&&(this.layout=new Ns(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof fl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=(()=>{if(v_)return v_;const i=gI();return v_=new M5(i.paint.properties["line-width"].specification),v_.useIntegerZoom=!0,v_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new _b(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,e,i){const u=pI(this);return{config:new lo(this,{zoom:e,lut:i}),defines:u,overrideFog:!1}}queryRadius(o){const e=o,i=_I(uo("line-width",this,e),uo("line-gap-width",this,e)),u=uo("line-offset",this,e);return i/2+Math.abs(u)+Ai(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,i,u,h,p){if(o.queryGeometry.isAboveHorizon)return!1;const m=Xa(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,o.pixelToTileUnitsFactor),b=o.pixelToTileUnitsFactor/2*_I(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),T=this.paint.get("line-offset").evaluate(e,i);return T&&(u=(function(A,M){const O=[],D=new Ct(0,0);for(let N=0;N<A.length;N++){const U=A[N],H=[];for(let X=0;X<U.length;X++){const te=U[X],ue=U[X+1],le=X===0?D:te.sub(U[X-1])._unit()._perp(),fe=X===U.length-1?D:ue.sub(te)._unit()._perp(),De=le._add(fe)._unit();De._mult(1/(De.x*fe.x+De.y*fe.y)),H.push(De._mult(M)._add(te))}O.push(H)}return O})(u,T*o.pixelToTileUnitsFactor)),(function(A,M,O){for(let D=0;D<M.length;D++){const N=M[D];if(A.length>=3){for(let U=0;U<N.length;U++)if(Ko(A,N[U]))return!0}if(Ni(A,N,O))return!0}return!1})(m,u,b)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(o){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Iv,background:class extends Wo{constructor(o,e,i,u){super(o,{layout:lC||(lC=new Ei({visibility:new St(Ve.layout_background.visibility)})),paint:uC||(uC=new Ei({"background-pitch-alignment":new St(Ve.paint_background["background-pitch-alignment"]),"background-color":new St(Ve.paint_background["background-color"]),"background-pattern":new St(Ve.paint_background["background-pattern"]),"background-opacity":new St(Ve.paint_background["background-opacity"]),"background-emissive-strength":new St(Ve.paint_background["background-emissive-strength"]),"background-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,e,i){return{overrideFog:!1}}is3D(o){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:pC,"raster-particle":xC,sky:class extends Wo{constructor(o,e,i,u){super(o,{layout:_C||(_C=new Ei({visibility:new St(Ve.layout_sky.visibility)})),paint:yC||(yC=new Ei({"sky-type":new St(Ve.paint_sky["sky-type"]),"sky-atmosphere-sun":new St(Ve.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new St(Ve.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new St(Ve.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new St(Ve.paint_sky["sky-gradient-radius"]),"sky-gradient":new Au(Ve.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new St(Ve.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new St(Ve.paint_sky["sky-atmosphere-color"]),"sky-opacity":new St(Ve.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=r_({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),h=!u,p=o.style.light,m=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&hn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Lb(m.azimuthal,90-m.polar,e):Lb(u[0],90-u[1],e)}const i=this.paint.get("sky-gradient-center");return Lb(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends Wo{constructor(o,e,i,u){super(o,{paint:vC||(vC=new Ei({}))},e,null)}},model:class extends Wo{constructor(o,e,i,u){super(o,{layout:TC||(TC=new Ei({visibility:new St(Ve.layout_model.visibility),"model-id":new Jt(Ve.layout_model["model-id"])})),paint:EC||(EC=new Ei({"model-opacity":new Jt(Ve.paint_model["model-opacity"]),"model-rotation":new Jt(Ve.paint_model["model-rotation"]),"model-scale":new Jt(Ve.paint_model["model-scale"]),"model-translation":new Jt(Ve.paint_model["model-translation"]),"model-color":new Jt(Ve.paint_model["model-color"]),"model-color-mix-intensity":new Jt(Ve.paint_model["model-color-mix-intensity"]),"model-type":new St(Ve.paint_model["model-type"]),"model-cast-shadows":new St(Ve.paint_model["model-cast-shadows"]),"model-receive-shadows":new St(Ve.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new St(Ve.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Jt(Ve.paint_model["model-emissive-strength"]),"model-roughness":new Jt(Ve.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Jt(Ve.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new St(Ve.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new St(Ve.paint_model["model-front-cutoff"]),"model-color-use-theme":new Jt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new Bb(o)}getProgramIds(){return["model"]}is3D(o){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof Rv?$t-1:0}queryIntersectsFeature(o,e,i,u,h,p){if(!this.modelManager)return!1;const m=this.modelManager,b=o.tile.getBucket(this);if(!(b&&b instanceof Bb))return!1;for(const T in b.instancesPerModel){const A=b.instancesPerModel[T],M=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(A.idToFeaturesIndex.hasOwnProperty(M)){const O=A.features[A.idToFeaturesIndex[M]],D=m.getModel(T,this.scope);if(!D)return!1;let N=ae();const U=new L(0,0),H=b.canonical;let X=Number.MAX_VALUE;for(let te=0;te<O.instancedDataCount;++te){const ue=16*(O.instancedDataOffset+te),le=A.instancedDataArray.float32,fe=[le[ue+4],le[ue+5],le[ue+6]];MC(H,U,le[ue],0|le[ue+1]),YP(N,D,p,U,O.rotation,O.scale,fe,!1,!1,!1),p.projection.name==="globe"&&(N=fb(N,p));const De=de([],p.projMatrix,N),Ie=o.queryGeometry,Ce=KP(Ie.isPointQuery()?Ie.screenBounds:Ie.screenGeometry,p,De,D.aabb);Ce!=null&&(X=Math.min(Ce,X))}return X!==Number.MAX_VALUE&&X}}return!1}_handleOverridablePaintPropertyUpdate(o,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){const e=this._transitionablePaint._values[o];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof ls}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Wo{constructor(o,e,i,u){super(o,{layout:aP||(aP=new Ei({"clip-layer-types":new St(Ve.layout_clip["clip-layer-types"]),"clip-layer-scope":new St(Ve.layout_clip["clip-layer-scope"])})),paint:sP||(sP=new Ei({}))},e,i,u)}recalculate(o,e){super.recalculate(o,e)}createBucket(o){return new lP(o)}is3D(o){return!0}}},jb=new wn(0,0,0),Ub={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Vb={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},kv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},k4={PAINT_ORDER_FILL_AND_STROKE:1},R_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},OC={MASK_TYPE_LUMINANCE:1};function D4(o,e,i){o===1&&e.icons.push((function(u,h){return(function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:m}=p;if(m.content_area){const{content_area:b}=m;b.top==null&&(b.top=b.left),b.width==null&&(b.width=p.usvg_tree.width),b.height==null&&(b.height=b.width)}return m.stretch_x&&m.stretch_x.length&&RC(m,"x"),m.stretch_y&&m.stretch_y.length&&RC(m,"y"),p})(u.readFields(z4,{name:void 0},h))})(i,i.readVarint()+i.pos))}function RC(o,e){const i=[],u=o[`stretch_${e}`];let h=null;for(let p=0;p<u.length;p++)h===null?h=i.length===0?u[0]:i[i.length-1][1]+u[p]:(i.push([h,h+u[p]]),h=null);o[`stretch_${e}_areas`]=i}function z4(o,e,i){o===1?e.name=i.readString():o===2?e.metadata=(function(u,h){return u.readFields(L4,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)})(i,i.readVarint()+i.pos):o===3&&(e.usvg_tree=(function(u,h){return u.readFields(N4,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function L4(o,e,i){o===1?e.stretch_x=i.readPackedVarint():o===2?e.stretch_y=i.readPackedVarint():o===3?e.content_area=(function(u,h){return u.readFields(F4,{left:0},h)})(i,i.readVarint()+i.pos):o===4&&e.variables.push((function(u,h){return u.readFields(B4,{name:void 0},h)})(i,i.readVarint()+i.pos))}function F4(o,e,i){o===1?e.left=i.readVarint():o===2?e.width=i.readVarint():o===3?e.top=i.readVarint():o===4&&(e.height=i.readVarint())}function B4(o,e,i){o===1?e.name=i.readString():o===2&&(e.rgb_color=Lv(i.readVarint()),e.value="rgb_color")}function N4(o,e,i){o===1?e.width=e.height=i.readVarint():o===2?e.height=i.readVarint():o===3?e.children.push(Dv(i,i.readVarint()+i.pos)):o===4?e.linear_gradients.push((function(u,h){return u.readFields(H4,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)})(i,i.readVarint()+i.pos)):o===5?e.radial_gradients.push((function(u,h){return u.readFields(Z4,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)})(i,i.readVarint()+i.pos)):o===7?e.clip_paths.push((function(u,h){return u.readFields(X4,{children:[]},h)})(i,i.readVarint()+i.pos)):o===8&&e.masks.push((function(u,h){const p=u.readFields(K4,{left:0,width:20,mask_type:OC.MASK_TYPE_LUMINANCE,children:[]},h);return p.height==null&&(p.height=p.width),p.top==null&&(p.top=p.left),p})(i,i.readVarint()+i.pos))}function Dv(o,e){return o.readFields(j4,{},e)}function j4(o,e,i){o===1?(e.group=(function(u,h){return u.readFields(U4,{opacity:255,children:[]},h)})(i,i.readVarint()+i.pos),e.node="group"):o===2&&(e.path=(function(u,h){return u.readFields($4,{paint_order:1,commands:[],step:1,diffs:[],rule:Ub.PATH_RULE_NON_ZERO},h)})(i,i.readVarint()+i.pos),e.node="path")}function U4(o,e,i){o===1?e.transform=zv(i,i.readVarint()+i.pos):o===2?e.opacity=i.readVarint():o===5?e.clip_path_idx=i.readVarint():o===6?e.mask_idx=i.readVarint():o===7&&e.children.push(Dv(i,i.readVarint()+i.pos))}function zv(o,e){return o.readFields(V4,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function V4(o,e,i){o===1?e.sx=i.readFloat():o===2?e.ky=i.readFloat():o===3?e.kx=i.readFloat():o===4?e.sy=i.readFloat():o===5?e.tx=i.readFloat():o===6&&(e.ty=i.readFloat())}function $4(o,e,i){o===1?e.fill=(function(u,h){return u.readFields(q4,{rgb_color:jb,paint:"rgb_color",opacity:255},h)})(i,i.readVarint()+i.pos):o===2?e.stroke=(function(u,h){return u.readFields(G4,{rgb_color:jb,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)})(i,i.readVarint()+i.pos):o===3?e.paint_order=i.readVarint():o===5?i.readPackedVarint(e.commands):o===6?e.step=i.readFloat():o===7?i.readPackedSVarint(e.diffs):o===8&&(e.rule=i.readVarint())}function q4(o,e,i){o===1?(e.rgb_color=Lv(i.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):o===5&&(e.opacity=i.readVarint())}function Lv(o){return new wn((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function G4(o,e,i){o===1?(e.rgb_color=Lv(i.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):o===5?i.readPackedFloat(e.dasharray):o===6?e.dashoffset=i.readFloat():o===7?e.miterlimit=i.readFloat():o===8?e.opacity=i.readVarint():o===9?e.width=i.readFloat():o===10?e.linecap=i.readVarint():o===11&&(e.linejoin=i.readVarint())}function H4(o,e,i){o===1?e.transform=zv(i,i.readVarint()+i.pos):o===2?e.spread_method=i.readVarint():o===3?e.stops.push(kC(i,i.readVarint()+i.pos)):o===4?e.x1=i.readFloat():o===5?e.y1=i.readFloat():o===6?e.x2=i.readFloat():o===7&&(e.y2=i.readFloat())}function kC(o,e){return o.readFields(W4,{offset:0,opacity:255,rgb_color:jb},e)}function W4(o,e,i){o===1?e.offset=i.readFloat():o===2?e.opacity=i.readVarint():o===3&&(e.rgb_color=Lv(i.readVarint()))}function Z4(o,e,i){o===1?e.transform=zv(i,i.readVarint()+i.pos):o===2?e.spread_method=i.readVarint():o===3?e.stops.push(kC(i,i.readVarint()+i.pos)):o===4?e.cx=i.readFloat():o===5?e.cy=i.readFloat():o===6?e.r=i.readFloat():o===7?e.fx=i.readFloat():o===8?e.fy=i.readFloat():o===9&&(e.fr=i.readFloat())}function X4(o,e,i){o===1?e.transform=zv(i,i.readVarint()+i.pos):o===2?e.clip_path_idx=i.readVarint():o===3&&e.children.push(Dv(i,i.readVarint()+i.pos))}function K4(o,e,i){o===1?e.left=e.top=i.readFloat():o===2?e.width=e.height=i.readFloat():o===3?e.top=i.readFloat():o===4?e.height=i.readFloat():o===5?e.mask_type=i.readVarint():o===6?e.mask_idx=i.readVarint():o===7&&e.children.push(Dv(i,i.readVarint()+i.pos))}class Y4{static calculate(e={},i=[]){const u=new Map,h=new Map;if(Object.keys(e).length===0)return u;i.forEach((p=>{h.set(p.name,p.rgb_color||new wn(0,0,0))}));for(const[p,m]of Object.entries(e))h.has(p)?u.set(h.get(p).toString(),m):console.warn(`Ignoring unknown image variable "${p}"`);return u}}function Jm(o,e=255,i){const u=e/255,h=o.toString(),p=i.has(h)?i.get(h).clone():o.clone();return p.a*=u,p.toString()}function k_(o,e){if(!Vc()){const i=document.createElement("canvas");return i.width=o,i.height=e,i}return new OffscreenCanvas(o,e)}function J4(o,e){const i=Y4.calculate(e.params,o.metadata?o.metadata.variables:[]),u=o.usvg_tree,h=u.width,p=u.height,m=e.transform?e.transform:new DOMMatrix,b=Math.max(1,Math.round(h*m.a)),T=Math.max(1,Math.round(p*m.d)),A=new DOMMatrix([b/h,0,0,T/p,0,0]),M=k_(b,T).getContext("2d");return $b(M,A,u,u,i),M.getImageData(0,0,b,T)}function $b(o,e,i,u,h){for(const p of u.children)DC(o,e,i,p,h)}function DC(o,e,i,u,h){u.group?(o.save(),(function(p,m,b,T,A){const M=T.mask_idx!=null?b.masks[T.mask_idx]:null,O=T.clip_path_idx!=null?b.clip_paths[T.clip_path_idx]:null;if(T.transform&&(m=Qm(T.transform).preMultiplySelf(m)),!(function(U,H,X){return U.opacity!==255||H||X})(T,O!=null,M!=null))return void $b(p,m,b,T,A);const D=k_(p.canvas.width,p.canvas.height),N=D.getContext("2d");$b(N,m,b,T,A),O&&UC(N,m,b,O),M&&VC(N,m,b,M,A),p.globalAlpha=T.opacity/255,p.drawImage(D,0,0)})(o,e,i,u.group,h),o.restore()):u.path&&(o.save(),(function(p,m,b,T,A){p.setTransform(m),T.paint_order===k4.PAINT_ORDER_FILL_AND_STROKE?(zC(p,b,T,A),FC(p,b,T,A)):(FC(p,b,T,A),zC(p,b,T,A))})(o,e,i,u.path,h),o.restore())}function zC(o,e,i,u){const h=i.fill;if(!h)return;const p=h.opacity/255;switch(o.save(),o.beginPath(),$C(i,o),h.paint){case"rgb_color":o.fillStyle=Jm(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":{const m=e.linear_gradients[h.linear_gradient_idx];m.transform&&o.setTransform(Qm(m.transform).preMultiplySelf(o.getTransform())),o.fillStyle=BC(o,m,p,u);break}case"radial_gradient_idx":{const m=e.radial_gradients[h.radial_gradient_idx];m.transform&&o.setTransform(Qm(m.transform).preMultiplySelf(o.getTransform())),o.fillStyle=NC(o,m,p,u)}}o.fill(LC(i)),o.restore()}function LC(o){return o.rule===Ub.PATH_RULE_NON_ZERO?"nonzero":o.rule===Ub.PATH_RULE_EVEN_ODD?"evenodd":void 0}function FC(o,e,i,u){const h=i.stroke;if(!h)return;const p=qC(i);o.lineWidth=h.width,o.miterLimit=h.miterlimit,o.setLineDash(h.dasharray),o.lineDashOffset=h.dashoffset;const m=h.opacity/255;switch(h.paint){case"rgb_color":o.strokeStyle=Jm(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":o.strokeStyle=BC(o,e.linear_gradients[h.linear_gradient_idx],m,u,!0);break;case"radial_gradient_idx":o.strokeStyle=NC(o,e.radial_gradients[h.radial_gradient_idx],m,u,!0)}switch(h.linejoin){case kv.LINE_JOIN_MITER_CLIP:case kv.LINE_JOIN_MITER:o.lineJoin="miter";break;case kv.LINE_JOIN_ROUND:o.lineJoin="round";break;case kv.LINE_JOIN_BEVEL:o.lineJoin="bevel"}switch(h.linecap){case Vb.LINE_CAP_BUTT:o.lineCap="butt";break;case Vb.LINE_CAP_ROUND:o.lineCap="round";break;case Vb.LINE_CAP_SQUARE:o.lineCap="square"}o.stroke(p)}function BC(o,e,i,u,h=!1){if(e.stops.length===1){const D=e.stops[0];return Jm(D.rgb_color,D.opacity*i,u)}const{x1:p,y1:m,x2:b,y2:T}=e;let A=new DOMPoint(p,m),M=new DOMPoint(b,T);if(h){const D=Qm(e.transform);A=D.transformPoint(A),M=D.transformPoint(M)}const O=o.createLinearGradient(A.x,A.y,M.x,M.y);for(const D of e.stops)O.addColorStop(D.offset,Jm(D.rgb_color,D.opacity*i,u));return O}function NC(o,e,i,u,h=!1){if(e.stops.length===1){const te=e.stops[0];return Jm(te.rgb_color,te.opacity*i,u)}const p=Qm(e.transform),{fx:m,fy:b,fr:T,cx:A,cy:M,r:O}=e;let D=new DOMPoint(m,b),N=new DOMPoint(A,M),U=T,H=O;if(h){D=p.transformPoint(D),N=p.transformPoint(N);const te=(p.a+p.d)/2;U=T*te,H=e.r*te}const X=o.createRadialGradient(D.x,D.y,U,N.x,N.y,H);for(const te of e.stops)X.addColorStop(te.offset,Jm(te.rgb_color,te.opacity*i,u));return X}function jC(o,e,i,u){const h=u.transform?Qm(u.transform).preMultiplySelf(e):e,p=k_(o.canvas.width,o.canvas.height),m=p.getContext("2d");for(const T of u.children)if(T.group)jC(m,h,i,T.group);else if(T.path){const A=T.path,M=new Path2D;M.addPath(qC(A),h),m.fill(M,LC(A))}const b=u.clip_path_idx!=null?i.clip_paths[u.clip_path_idx]:null;b&&UC(m,h,i,b),o.globalCompositeOperation="source-over",o.drawImage(p,0,0)}function UC(o,e,i,u){const h=k_(o.canvas.width,o.canvas.height);jC(h.getContext("2d"),e,i,u),o.globalCompositeOperation="destination-in",o.drawImage(h,0,0)}function VC(o,e,i,u,h){if(u.children.length===0)return;const p=u.mask_idx!=null?i.masks[u.mask_idx]:null;p&&VC(o,e,i,p,h);const m=o.canvas.width,b=o.canvas.height,T=k_(m,b),A=T.getContext("2d"),M=u.width,O=u.height,D=u.left,N=u.top,U=new Path2D,H=new Path2D;H.rect(D,N,M,O),U.addPath(H,e),A.clip(U);for(const ue of u.children)DC(A,e,i,ue,h);const X=A.getImageData(0,0,m,b),te=X.data;if(u.mask_type===OC.MASK_TYPE_LUMINANCE)for(let ue=0;ue<te.length;ue+=4)te[ue+3]=te[ue+3]/255*(.2126*te[ue]+.7152*te[ue+1]+.0722*te[ue+2]);A.putImageData(X,0,0),o.globalCompositeOperation="destination-in",o.drawImage(T,0,0)}function Qm(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function $C(o,e){const i=o.step;let u=o.diffs[0]*i,h=o.diffs[1]*i;e.moveTo(u,h);for(let p=0,m=2;p<o.commands.length;p++)switch(o.commands[p]){case R_.PATH_COMMAND_MOVE:u+=o.diffs[m++]*i,h+=o.diffs[m++]*i,e.moveTo(u,h);break;case R_.PATH_COMMAND_LINE:u+=o.diffs[m++]*i,h+=o.diffs[m++]*i,e.lineTo(u,h);break;case R_.PATH_COMMAND_QUAD:{const b=u+o.diffs[m++]*i,T=h+o.diffs[m++]*i;u=b+o.diffs[m++]*i,h=T+o.diffs[m++]*i,e.quadraticCurveTo(b,T,u,h);break}case R_.PATH_COMMAND_CUBIC:{const b=u+o.diffs[m++]*i,T=h+o.diffs[m++]*i,A=b+o.diffs[m++]*i,M=T+o.diffs[m++]*i;u=A+o.diffs[m++]*i,h=M+o.diffs[m++]*i,e.bezierCurveTo(b,T,A,M,u,h);break}case R_.PATH_COMMAND_CLOSE:e.closePath()}return e}function qC(o){return $C(o,new Path2D)}class Fv{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}nr(Fv,"LRUCache");class qb{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new _a(e,e.data)}getFromCache(e,i,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new Fv(150)),this.cacheMap.get(u).get(Ac(e.toString(),i))}setInCache(e,i,u,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new Fv(150));const p=this.cacheDependenciesMap.get(h),m=Ac(e.id.toString(),u);p.get(m)||p.set(m,new Set);const b=this.cacheMap.get(h),T=e.toString();p.get(m).add(T),b.put(Ac(e.toString(),u),i)}removeImagesFromCacheByIds(e,i,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const h=this.cacheMap.get(u),p=this.cacheDependenciesMap.get(u);for(const m of e){const b=Ac(m.toString(),i);if(p.has(b)){for(const T of p.get(b))h.delete(T);p.delete(b)}}}rasterize(e,i,u,h,p=J4){const m=this.getFromCache(e,u,h);if(m)return m.clone();const b=p(i.icon,e.options),T=qb._getImage(b);return this.setInCache(e,T,u,h),T.clone()}}class GC{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const u=this.toIdx(e,i);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function HC(o,e,i,u){let h=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(u[m])<1e-15){if(i[m]<o[m]||i[m]>e[m])return null}else{const b=1/u[m];let T=(o[m]-i[m])*b,A=(e[m]-i[m])*b;if(T>A){const M=T;T=A,A=M}if(T>h&&(h=T),A<p&&(p=A),h>p)return null}return h}function WC(o,e,i,u,h,p,m,b,T,A,M){const O=u-o,D=h-e,N=p-i,U=m-o,H=b-e,X=T-i,te=M[1]*X-M[2]*H,ue=M[2]*U-M[0]*X,le=M[0]*H-M[1]*U,fe=O*te+D*ue+N*le;if(Math.abs(fe)<1e-15)return null;const De=1/fe,Ie=A[0]-o,Ce=A[1]-e,Be=A[2]-i,je=(Ie*te+Ce*ue+Be*le)*De;if(je<0||je>1)return null;const st=Ce*N-Be*D,Ge=Be*O-Ie*N,ft=Ie*D-Ce*O,jt=(M[0]*st+M[1]*Ge+M[2]*ft)*De;return jt<0||je+jt>1?null:(U*st+H*Ge+X*ft)*De}function ZC(o,e,i){return(o-e)/(i-e)}function XC(o,e,i,u,h,p,m,b,T){const A=1<<i,M=p-u,O=m-h,D=(o+1)/A*M+u,N=(e+0)/A*O+h,U=(e+1)/A*O+h;b[0]=(o+0)/A*M+u,b[1]=N,T[0]=D,T[1]=U}class KC{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=(function(p){const m=Math.ceil(Math.log2(p.dim/8)),b=[];let T=Math.ceil(Math.pow(2,m));const A=1/T,M=(N,U,H,X,te)=>{const ue=X?1:0,le=(N+1)*H-ue,fe=U*H,De=(U+1)*H-ue;te[0]=N*H,te[1]=fe,te[2]=le,te[3]=De};let O=new GC(T);const D=[];for(let N=0;N<T*T;N++){M(N%T,Math.floor(N/T),A,!1,D);const U=rp(D[0],D[1],p),H=rp(D[2],D[1],p),X=rp(D[2],D[3],p),te=rp(D[0],D[3],p);O.minimums.push(Math.min(U,H,X,te)),O.maximums.push(Math.max(U,H,X,te)),O.leaves.push(1)}for(b.push(O),T/=2;T>=1;T/=2){const N=b[b.length-1];O=new GC(T);for(let U=0;U<T*T;U++){M(U%T,Math.floor(U/T),2,!0,D);const H=N.getElevation(D[0],D[1]),X=N.getElevation(D[2],D[1]),te=N.getElevation(D[2],D[3]),ue=N.getElevation(D[0],D[3]),le=N.isLeaf(D[0],D[1]),fe=N.isLeaf(D[2],D[1]),De=N.isLeaf(D[2],D[3]),Ie=N.isLeaf(D[0],D[3]),Ce=Math.min(H.min,X.min,te.min,ue.min),Be=Math.max(H.max,X.max,te.max,ue.max),je=le&&fe&&De&&Ie;O.maximums.push(Be),O.minimums.push(Ce),O.leaves.push(Be-Ce<=5&&je?1:0)}b.push(O)}return b})(this.dem),u=i.length-1,h=i[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,u,0)}raycastRoot(e,i,u,h,p,m,b=1){return HC([e,i,-100],[u,h,this.maximums[0]*b],p,m)}raycast(e,i,u,h,p,m,b=1){if(!this.nodeCount)return null;const T=this.raycastRoot(e,i,u,h,p,m,b);if(T==null)return null;const A=[],M=[],O=[],D=[],N=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;N.length>0;){const{idx:U,t:H,nodex:X,nodey:te,depth:ue}=N.pop();if(this.leaves[U]){XC(X,te,ue,e,i,u,h,O,D);const fe=1<<ue,De=(X+0)/fe,Ie=(X+1)/fe,Ce=(te+0)/fe,Be=(te+1)/fe,je=rp(De,Ce,this.dem)*b,st=rp(Ie,Ce,this.dem)*b,Ge=rp(Ie,Be,this.dem)*b,ft=rp(De,Be,this.dem)*b,jt=WC(O[0],O[1],je,D[0],O[1],st,D[0],D[1],Ge,p,m),_t=WC(D[0],D[1],Ge,O[0],D[1],ft,O[0],O[1],je,p,m),Mt=Math.min(jt!==null?jt:Number.MAX_VALUE,_t!==null?_t:Number.MAX_VALUE);if(Mt!==Number.MAX_VALUE)return Mt;{const Ft=pt([],p,m,H);if(YC(je,st,ft,Ge,ZC(Ft[0],O[0],D[0]),ZC(Ft[1],O[1],D[1]))>=Ft[2])return H}continue}let le=0;for(let fe=0;fe<this._siblingOffset.length;fe++){XC((X<<1)+this._siblingOffset[fe][0],(te<<1)+this._siblingOffset[fe][1],ue+1,e,i,u,h,O,D),O[2]=-100,D[2]=this.maximums[this.childOffsets[U]+fe]*b;const De=HC(O,D,p,m);if(De!=null){const Ie=De;A[fe]=Ie;let Ce=!1;for(let Be=0;Be<le&&!Ce;Be++)Ie>=A[M[Be]]&&(M.splice(Be,0,fe),Ce=!0);Ce||(M[le]=fe),le++}}for(let fe=0;fe<le;fe++){const De=M[fe];N.push({idx:this.childOffsets[U]+De,t:A[De],nodex:(X<<1)+this._siblingOffset[De][0],nodey:(te<<1)+this._siblingOffset[De][1],depth:ue+1})}}return null}_addNode(e,i,u){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,u,h,p){if(e[h].isLeaf(i,u)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const m=h-1,b=e[m];let T=0,A=0;for(let M=0;M<this._siblingOffset.length;M++){const O=2*i+this._siblingOffset[M][0],D=2*u+this._siblingOffset[M][1],N=b.getElevation(O,D),U=b.isLeaf(O,D),H=this._addNode(N.min,N.max,U);U&&(T|=1<<M),A||(A=H)}for(let M=0;M<this._siblingOffset.length;M++)T&1<<M||this._construct(e,2*i+this._siblingOffset[M][0],2*u+this._siblingOffset[M][1],m,A+M)}}function YC(o,e,i,u,h,p){return wr(wr(o,i,p),wr(e,u,p),h)}function rp(o,e,i){const u=i.dim,h=ve(o*u-.5,0,u-1),p=ve(e*u-.5,0,u-1),m=Math.floor(h),b=Math.floor(p),T=Math.min(m+1,u-1),A=Math.min(b+1,u-1);return YC(i.get(m,b),i.get(T,b),i.get(m,A),i.get(T,A),h-m,p-b)}const Q4={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function eU(o,e,i){return(256*o*256+256*e+i)/10-1e4}function tU(o,e,i){return 256*o+e+i/256-32768}class Bv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,u,h=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void hn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const p=this.dim=i.height-2,m=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let T=0;T<p;T++)m[this._idx(-1,T)]=m[this._idx(0,T)],m[this._idx(p,T)]=m[this._idx(p-1,T)],m[this._idx(T,-1)]=m[this._idx(T,0)],m[this._idx(T,p)]=m[this._idx(T,p-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(p,-1)]=m[this._idx(p-1,0)],m[this._idx(-1,p)]=m[this._idx(0,p-1)],m[this._idx(p,p)]=m[this._idx(p-1,p-1)]}const b=u==="terrarium"?tU:eU;for(let T=0;T<m.length;++T){const A=4*T;this.floatView[T]=b(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=ds.now()}_buildQuadTree(){this._tree=new KC(this)}get(e,i,u=!1){u&&(e=ve(e,-1,this.dim),i=ve(i,-1,this.dim));const h=this._idx(e,i);return this.floatView[h]}set(e,i,u){const h=this._idx(e,i),p=this.floatView[h];return this.floatView[h]=u,u-p}static getUnpackVector(e){return Q4[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const u=[0,0,0,0],h=Bv.getUnpackVector(i);let p=Math.floor((e+h[3])/h[2]);return u[2]=p%256,p=Math.floor(p/256),u[1]=p%256,p=Math.floor(p/256),u[0]=p,u}getPixels(){return new H2({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,u){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,p=i*this.dim+this.dim,m=u*this.dim,b=u*this.dim+this.dim;switch(i){case-1:h=p-1;break;case 1:p=h+1}switch(u){case-1:m=b-1;break;case 1:b=m+1}const T=-i*this.dim,A=-u*this.dim;for(let M=m;M<b;M++)for(let O=h;O<p;O++){const D=4*this._idx(O,M),N=4*this._idx(O+T,M+A);this.pixels[D+0]=e.pixels[N+0],this.pixels[D+1]=e.pixels[N+1],this.pixels[D+2]=e.pixels[N+2],this.pixels[D+3]=e.pixels[N+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function rU(o,e,i){o===1?e.headerLength=i.readFixed32():o===2?e.x=i.readVarint():o===3?e.y=i.readVarint():o===4?e.z=i.readVarint():o===5&&e.layers.push((function(u,h){return u.readFields(sU,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)})(i,i.readVarint()+i.pos))}function nU(o,e,i){o===1?(e.delta_filter=(function(u,h){return u.readFields(iU,{blockSize:0},h)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):o===2?(i.readVarint(),e.filter="zigzag_filter"):o===3?(i.readVarint(),e.filter="bitshuffle_filter"):o===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function iU(o,e,i){o===1&&(e.blockSize=i.readVarint())}function oU(o,e,i){o===1?(i.readVarint(),e.codec="gzip_data"):o===2?(i.readVarint(),e.codec="jpeg_image"):o===3?(i.readVarint(),e.codec="webp_image"):o===4&&(i.readVarint(),e.codec="png_image")}function aU(o,e,i){let u=0,h=0;o===1?e.firstByte=i.readFixed64():o===2?e.lastByte=i.readFixed64():o===3?e.filters.push((function(p,m){return p.readFields(nU,{},m)})(i,i.readVarint()+i.pos)):o===4?e.codec=(function(p,m){return p.readFields(oU,{},m)})(i,i.readVarint()+i.pos):o===5?h=i.readFloat():o===6?u=i.readFloat():o===7?e.bands.push(i.readString()):o===8?e.offset=i.readDouble():o===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=h),e.scale===0&&(e.scale=u)}function sU(o,e,i){o===1?e.version=i.readVarint():o===2?e.name=i.readString():o===3?e.units=i.readString():o===4?e.tileSize=i.readVarint():o===5?e.buffer=i.readVarint():o===6?e.pixelFormat=i.readVarint():o===7&&e.dataIndex.push((function(u,h){return u.readFields(aU,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)})(i,i.readVarint()+i.pos))}function lU(o,e,i){if(o===2)(function(u,h,p){u.readFields(uU,p,h)})(i,i.readVarint()+i.pos,e);else if(o===3)throw new Error("Not implemented")}function uU(o,e,i){if(o===1){let u=0;const h=i.readVarint()+i.pos;for(;i.pos<h;)e[u++]=i.readVarint()}}function cU(o,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let u=2;u>=1;u--){const h=u===1?1:0,p=u===2?1:0;for(let m=0;m<e[0];m++){const b=e[1]*m;for(let T=h;T<e[1];T++){const A=e[2]*(T+b);for(let M=p;M<e[2];M++){const O=e[3]*(M+A);for(let D=0;D<e[3];D++){const N=O+D;o[N]+=o[N-i]}}}}i*=e[u]}return o}function hU(o){for(let e=0,i=o.length;e<i;e++)o[e]=o[e]>>>1^-(1&o[e]);return o}function fU(o,e){switch(e){case"uint32":return o;case"uint16":for(let i=0;i<o.length;i+=2){const u=o[i],h=o[i+1];o[i]=(240&u)>>4|(61440&u)>>8|(240&h)<<4|61440&h,o[i+1]=15&u|(3840&u)>>4|(15&h)<<8|(3840&h)<<4}return o;case"uint8":for(let i=0;i<o.length;i+=4){const u=o[i],h=o[i+1],p=o[i+2],m=o[i+3];o[i+0]=(192&u)>>6|(192&h)>>4|(192&p)>>2|192&m,o[i+1]=(48&u)>>4|(48&h)>>2|48&p|(48&m)<<2,o[i+2]=(12&u)>>2|12&h|(12&p)<<2|(12&m)<<4,o[i+3]=3&u|(3&h)<<2|(3&p)<<4|(3&m)<<6}return o;default:throw new Error(`Invalid pixel format, "${e}"`)}}nr(Bv,"DEMData"),nr(KC,"DemMinMaxQuadTree",{omit:["dem"]});var Wl=Uint8Array,D_=Uint16Array,dU=Int32Array,JC=new Wl([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),QC=new Wl([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),pU=new Wl([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),eM=function(o,e){for(var i=new D_(31),u=0;u<31;++u)i[u]=e+=1<<o[u-1];var h=new dU(i[30]);for(u=1;u<30;++u)for(var p=i[u];p<i[u+1];++p)h[p]=p-i[u]<<5|u;return{b:i,r:h}},tM=eM(JC,2),rM=tM.b,mU=tM.r;rM[28]=258,mU[258]=28;for(var gU=eM(QC,0).b,nM=new D_(32768),Ao=0;Ao<32768;++Ao){var eg=(43690&Ao)>>1|(21845&Ao)<<1;nM[Ao]=((65280&(eg=(61680&(eg=(52428&eg)>>2|(13107&eg)<<2))>>4|(3855&eg)<<4))>>8|(255&eg)<<8)>>1}var z_=function(o,e,i){for(var u=o.length,h=0,p=new D_(e);h<u;++h)o[h]&&++p[o[h]-1];var m,b=new D_(e);for(h=1;h<e;++h)b[h]=b[h-1]+p[h-1]<<1;m=new D_(1<<e);var T=15-e;for(h=0;h<u;++h)if(o[h])for(var A=h<<4|o[h],M=e-o[h],O=b[o[h]-1]++<<M,D=O|(1<<M)-1;O<=D;++O)m[nM[O]>>T]=A;return m},L_=new Wl(288);for(Ao=0;Ao<144;++Ao)L_[Ao]=8;for(Ao=144;Ao<256;++Ao)L_[Ao]=9;for(Ao=256;Ao<280;++Ao)L_[Ao]=7;for(Ao=280;Ao<288;++Ao)L_[Ao]=8;var iM=new Wl(32);for(Ao=0;Ao<32;++Ao)iM[Ao]=5;var _U=z_(L_,9),yU=z_(iM,5),Gb=function(o){for(var e=o[0],i=1;i<o.length;++i)o[i]>e&&(e=o[i]);return e},zc=function(o,e,i){var u=e/8|0;return(o[u]|o[u+1]<<8)>>(7&e)&i},Hb=function(o,e){var i=e/8|0;return(o[i]|o[i+1]<<8|o[i+2]<<16)>>(7&e)},vU=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Lc=function(o,e,i){var u=new Error(e||vU[o]);if(u.code=o,Error.captureStackTrace&&Error.captureStackTrace(u,Lc),!i)throw u;return u},xU=new Wl(0),bU=typeof TextDecoder<"u"&&new TextDecoder;try{bU.decode(xU,{stream:!0})}catch{}const wU={gzip_data:"gzip"};class Lu extends Error{constructor(e){super(e),this.name="MRTError"}}const SU={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},oM={uint32:1,uint16:2,uint8:4},TU={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Wb;class Nv{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Lu(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),u=new DataView(e);if(i[0]!==13)throw new Lu("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),u=this.getHeaderLength(e);if(i.length<u)throw new Lu(`Expected header with length >= ${u} but got buffer of length ${i.length}`);const h=new Wb(i.subarray(0,u)).readFields(rU,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Lu(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const p of h.layers)this.layers[p.name]=new aM(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],u=this.getLayer(e.layerName);for(let h of e.blockIndices){const p=u.dataIndex[h],m=p.firstByte-e.firstByte,b=p.lastByte-e.firstByte;if(u._blocksInProgress.has(h))continue;const T={layerName:u.name,firstByte:m,lastByte:b,pixelFormat:u.pixelFormat,blockIndex:h,blockShape:[p.bands.length].concat(u.bandShape),buffer:u.buffer,codec:p.codec.codec,filters:p.filters.map((A=>A.filter))};u._blocksInProgress.add(h),i.push(T)}return new sM(i,(()=>{i.forEach((h=>u._blocksInProgress.delete(h.blockIndex)))}),((h,p)=>{if(i.forEach((m=>u._blocksInProgress.delete(m.blockIndex))),h)throw h;p.forEach((m=>{this.getLayer(m.layerName).processDecodedData(m)}))}))}}class aM{constructor({version:e,name:i,units:u,tileSize:h,pixelFormat:p,buffer:m,dataIndex:b},T){if(this.version=e,this.version!==1)throw new Lu(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=u,this.tileSize=h,this.buffer=m,this.pixelFormat=SU[p],this.dataIndex=b,this.bandShape=[h+2*m,h+2*m,oM[this.pixelFormat]],this._decodedBlocks=new Fv(T?T.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return oM[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[u,h]of this.dataIndex.entries()){for(const[p,m]of h.bands.entries())if(m===e)return{bandIndex:i+p,blockIndex:u,blockBandIndex:p};i+=h.bands.length}break;case"number":for(const[u,h]of this.dataIndex.entries()){if(e>=i&&e<i+h.bands.length)return{bandIndex:e,blockIndex:u,blockBandIndex:e-i};i+=h.bands.length}break;default:throw new Lu(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,u=-1/0;const h=[],p=new Set;for(const m of e){const{blockIndex:b}=this.getBlockForBand(m);if(b<0)throw new Lu(`Invalid band: ${JSON.stringify(m)}`);const T=this.dataIndex[b];h.includes(b)||h.push(b),p.add(b),i=Math.min(i,T.firstByte),u=Math.max(u,T.lastByte)}if(p.size>this.cacheSize)throw new Lu(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:u,blockIndices:h}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:u}=this.getBlockForBand(e);if(i<0)throw new Lu(`Band not found: ${JSON.stringify(e)}`);const h=this._decodedBlocks.get(i.toString());if(!h)throw new Lu(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[i],m=this.bandShape.reduce(((A,M)=>A*M),1),b=u*m,T=h.subarray(b,b+m);return{data:T,bytes:new Uint8Array(T.buffer).subarray(T.byteOffset,T.byteOffset+T.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}Nv.setPbf=function(o){Wb=o};class sM{constructor(e,i,u){this.tasks=e,this._onCancel=i,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}Nv.performDecoding=function(o,e){const i=new Uint8Array(o);return Promise.all(e.tasks.map((u=>{const{layerName:h,firstByte:p,lastByte:m,pixelFormat:b,blockShape:T,blockIndex:A,filters:M,codec:O}=u,D=i.subarray(p,m+1),N=new Uint32Array(T[0]*T[1]*T[2]);let U;if(O!=="gzip_data")throw new Lu(`Unhandled codec: ${O}`);return U=(function(H,X){if(!globalThis.DecompressionStream&&X==="gzip_data")return Promise.resolve(((fe=(function(Ce){Ce[0]==31&&Ce[1]==139&&Ce[2]==8||Lc(6,"invalid gzip data");var Be=Ce[3],je=10;4&Be&&(je+=2+(Ce[10]|Ce[11]<<8));for(var st=(Be>>3&1)+(Be>>4&1);st>0;st-=!Ce[je++]);return je+(2&Be)})(le=H))+8>le.length&&Lc(6,"invalid gzip data"),(function(Ce,Be,je,st){var Ge=Ce.length;if(!Ge||Be.f&&!Be.l)return je||new Wl(0);var ft=!je,jt=ft||Be.i!=2,_t=Be.i;ft&&(je=new Wl(3*Ge));var Mt,Ft,ot=function(ki){var di=je.length;if(ki>di){var li=new Wl(Math.max(2*di,ki));li.set(je),je=li}},Ot=Be.f||0,Xe=Be.p||0,at=Be.b||0,Ut=Be.l,Rt=Be.d,gr=Be.m,ar=Be.n,At=8*Ge;do{if(!Ut){Ot=zc(Ce,Xe,1);var zt=zc(Ce,Xe+1,3);if(Xe+=3,!zt){var hr=Ce[(me=4+((Xe+7)/8|0))-4]|Ce[me-3]<<8,er=me+hr;if(er>Ge){_t&&Lc(0);break}jt&&ot(at+hr),je.set(Ce.subarray(me,er),at),Be.b=at+=hr,Be.p=Xe=8*er,Be.f=Ot;continue}if(zt==1)Ut=_U,Rt=yU,gr=9,ar=5;else if(zt==2){var Gt=zc(Ce,Xe,31)+257,rr=zc(Ce,Xe+10,15)+4,Pr=Gt+zc(Ce,Xe+5,31)+1;Xe+=14;for(var Fr=new Wl(Pr),Zr=new Wl(19),qr=0;qr<rr;++qr)Zr[pU[qr]]=zc(Ce,Xe+3*qr,7);Xe+=3*rr;var yn=Gb(Zr),nn=(1<<yn)-1,fi=z_(Zr,yn);for(qr=0;qr<Pr;){var me,ge=fi[zc(Ce,Xe,nn)];if(Xe+=15&ge,(me=ge>>4)<16)Fr[qr++]=me;else{var nt=0,Vt=0;for(me==16?(Vt=3+zc(Ce,Xe,3),Xe+=2,nt=Fr[qr-1]):me==17?(Vt=3+zc(Ce,Xe,7),Xe+=3):me==18&&(Vt=11+zc(Ce,Xe,127),Xe+=7);Vt--;)Fr[qr++]=nt}}var Kt=Fr.subarray(0,Gt),Xt=Fr.subarray(Gt);gr=Gb(Kt),ar=Gb(Xt),Ut=z_(Kt,gr),Rt=z_(Xt,ar)}else Lc(1);if(Xe>At){_t&&Lc(0);break}}jt&&ot(at+131072);for(var cr=(1<<gr)-1,Dr=(1<<ar)-1,fn=Xe;;fn=Xe){var dn=(nt=Ut[Hb(Ce,Xe)&cr])>>4;if((Xe+=15&nt)>At){_t&&Lc(0);break}if(nt||Lc(2),dn<256)je[at++]=dn;else{if(dn==256){fn=Xe,Ut=null;break}var en=dn-254;dn>264&&(en=zc(Ce,Xe,(1<<(Yr=JC[qr=dn-257]))-1)+rM[qr],Xe+=Yr);var Qn=Rt[Hb(Ce,Xe)&Dr],zi=Qn>>4;if(Qn||Lc(3),Xe+=15&Qn,Xt=gU[zi],zi>3){var Yr=QC[zi];Xt+=Hb(Ce,Xe)&(1<<Yr)-1,Xe+=Yr}if(Xe>At){_t&&Lc(0);break}jt&&ot(at+131072);var _i=at+en;if(at<Xt){var si=0-Xt,Hn=Math.min(Xt,_i);for(si+at<0&&Lc(3);at<Hn;++at)je[at]=(void 0)[si+at]}for(;at<_i;++at)je[at]=je[at-Xt]}}Be.l=Ut,Be.p=fn,Be.b=at,Be.f=Ot,Ut&&(Ot=1,Be.m=gr,Be.d=Rt,Be.n=ar)}while(!Ot);return at!=je.length&&ft?(Mt=je,((Ft=at)==null||Ft>Mt.length)&&(Ft=Mt.length),new Wl(Mt.subarray(0,Ft))):je.subarray(0,at)})(le.subarray(fe,-8),{i:2},new Wl(((te=le)[(ue=te.length)-4]|te[ue-3]<<8|te[ue-2]<<16|te[ue-1]<<24)>>>0))));var te,ue,le,fe;const De=wU[X];if(!De)throw new Error(`Unhandled codec: ${X}`);const Ie=new globalThis.DecompressionStream(De);return new Response(new Blob([H]).stream().pipeThrough(Ie)).arrayBuffer().then((Ce=>new Uint8Array(Ce)))})(D,O).then((H=>((function(X,te){X.readFields(lU,te)})(new Wb(H),N),new TU[b](N.buffer)))),U.then((H=>{for(let X=M.length-1;X>=0;X--)switch(M[X]){case"delta_filter":cU(H,T);break;case"zigzag_filter":hU(H);break;case"bitshuffle_filter":fU(H,b);break;default:throw new Lu(`Unhandled filter "${M[X]}"`)}return{layerName:h,blockIndex:A,data:H}})).catch((H=>{throw H}))})))},nr(sM,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),nr(Nv,"MapboxRasterTile"),nr(aM,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class lM{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const u=e[i];this._stringToNumber[u]=i,this._numberToString[i]=u}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const EU=["id","tile","layer","source","sourceLayer","state"];class tg{constructor(e,i,u,h,p){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=u,this._y=h,this.properties=e.properties,this.id=p}clone(){const e=new tg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of EU)this[i]!==void 0&&(e[i]=this[i]);return e}}class uM{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ga($t,16,0),this.featureIndexArray=new Mf,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,u,h,p,m=0,b=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,p,m);const A=this.grid;for(let M=0;M<i.length;M++){const O=i[M],D=[1/0,1/0,-1/0,-1/0];for(let N=0;N<O.length;N++){const U=O[N];D[0]=Math.min(D[0],U.x),D[1]=Math.min(D[1],U.y),D[2]=Math.max(D[2],U.x),D[3]=Math.max(D[3],U.y)}b!==0&&(D[0]-=b,D[1]-=b,D[2]+=b,D[3]+=b),D[0]<$t&&D[1]<$t&&D[2]>=0&&D[3]>=0&&A.insert(T,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new lr(new dv(this.rawTileData)).layers,this.sourceLayerCoder=new lM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:u,transform:h,tileTransform:p,pixelPosMatrix:m,availableImages:b,worldview:T}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const A=u.bufferedTilespaceBounds,M=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,((U,H,X,te)=>Mi(u.bufferedTilespaceGeometry,U,H,X,te)));M.sort(AU);let O=null;h.elevation&&M.length>0&&(O=Ym.create(h.elevation,this.tileID));const D={};let N;for(let U=0;U<M.length;U++){const H=M[U];if(H===N)continue;N=H;const X=this.featureIndexArray.get(H);let te=null;this.is3DTile?this.loadMatchingModelFeature(D,X,e,u,h,T):this.loadMatchingFeature(D,X,e,b,T,((ue,le,fe,De=0)=>(te||(te=Re(ue,this.tileID.canonical,p)),le.queryIntersectsFeature(u,ue,fe,te,this.z,h,m,O,De))))}return D}loadMatchingFeature(e,i,u,h,p,m){const{featureIndex:b,bucketIndex:T,sourceLayerIndex:A,layoutVertexArrayOffset:M}=i,O=this.bucketLayerIDs[T],D=u.layers,N=Object.keys(D);if(N.length&&!cn(N,O))return;const U=u.sourceCache,H=this.sourceLayerCoder.decode(A),X=this.vtLayers[H].feature(b),te=this.getId(X,H);for(let ue=0;ue<O.length;ue++){const le=O[ue];if(!D[le])continue;const{styleLayer:fe,targets:De}=D[le];let Ie={};te!==void 0&&(Ie=U.getFeatureState(fe.sourceLayer,te));const Ce=!m||m(X,fe,Ie,M);if(!Ce)continue;const Be=new tg(X,this.z,this.x,this.y,te);Be.tile=this.tileID.canonical,Be.state=Ie;let je=this.serializedLayersCache.get(le);je||(je=fe.serialize(),je.id=le,this.serializedLayersCache.set(le,je)),Be.source=je.source,Be.sourceLayer=je["source-layer"],Be.layer=Qe({},je),Be.layer.paint=cM(je.paint,fe.paint,X,Ie,h),Be.layer.layout=cM(je.layout,fe.layout,X,Ie,h);let st=!1;for(const Ge of De){this.updateFeatureProperties(Be,Ge);const{filter:ft}=Ge;if(ft){if(X.properties=Be.properties,ft.needGeometry){const jt=tt(X,!0);if(!ft.filter(new Un(this.tileID.overscaledZ,{worldview:p}),jt,this.tileID.canonical))continue}else if(!ft.filter(new Un(this.tileID.overscaledZ,{worldview:p}),X))continue}st=!0,Ge.targetId&&this.addFeatureVariant(Be,Ge)}st&&this.appendToResult(e,le,b,Be,Ce)}}loadMatchingModelFeature(e,i,u,h,p,m){const{featureIndex:b,bucketIndex:T}=i,A=this.bucketLayerIDs[T],M=u.layers,O=Object.keys(M);if(!O.length||cn(O,A))for(let D=0;D<A.length;D++){const N=A[D],{styleLayer:U,targets:H}=M[N];if(U.type!=="model")continue;const X=h.tile,te=X.getBucket(U);if(!(te&&te instanceof Rv))continue;const ue=O4(te,b,h,p);if(!ue)continue;const{z:le,x:fe,y:De}=X.tileID.canonical,{feature:Ie,intersectionZ:Ce,position:Be}=ue;let je={};Ie.id!==void 0&&(je=u.sourceCache.getFeatureState(U.sourceLayer,Ie.id));const st=new tg({},le,fe,De,Ie.id);st.tile=this.tileID.canonical,st.state=je,st.properties=Ie.properties,st.geometry={type:"Point",coordinates:[Be.lng,Be.lat]};let Ge=this.serializedLayersCache.get(N);Ge||(Ge=U.serialize(),Ge.id=N,this.serializedLayersCache.set(N,Ge)),st.source=Ge.source,st.sourceLayer=Ge["source-layer"],st.layer=Qe({},Ge);let ft=!1;for(const jt of H){this.updateFeatureProperties(st,jt);const{filter:_t}=jt;if(_t){if(Ie.properties=st.properties,_t.needGeometry){if(!_t.filter(new Un(this.tileID.overscaledZ,{worldview:m}),Ie,this.tileID.canonical))continue}else if(!_t.filter(new Un(this.tileID.overscaledZ,{worldview:m}),Ie))continue}ft=!0,jt.targetId&&this.addFeatureVariant(st,jt)}ft&&this.appendToResult(e,N,b,st,Ce)}}updateFeatureProperties(e,i,u){if(i.properties){const h={};for(const p in i.properties){const m=i.properties[p].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,u);m!=null&&(h[p]=m)}e.properties=h}}addFeatureVariant(e,i,u){const h={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(h.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(h)}appendToResult(e,i,u,h,p){let m=e[i];m===void 0&&(m=e[i]=[]),m.push({featureIndex:u,feature:h,intersectionZ:p})}lookupSymbolFeatures(e,i,u,h,p,m){const b={};this.loadVTLayers();for(const T of e)this.loadMatchingFeature(b,{bucketIndex:i,sourceLayerIndex:u,featureIndex:T,layoutVertexArrayOffset:0},h,p,m);return b}loadFeature(e){const{featureIndex:i,sourceLayerIndex:u}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(u),p=this.vtFeatures[h];if(p[i])return p[i];const m=this.vtLayers[h].feature(i);return p[i]=m,m}hasLayer(e){for(const i of this.bucketLayerIDs)for(const u of i)if(e===u)return!0;return!1}getId(e,i){let u=e.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const p=gl(h);if(p.result!=="success"){const m=p.value.map((b=>`${b.key}: ${b.message}`)).join(", ");return void hn(`Failed to create expression for promoteId: ${m}`)}this.promoteIdExpression=p.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Zh),u=this.promoteIdExpression.evaluate({zoom:0},e)}else u=e.properties[h];typeof u=="boolean"&&(u=Number(u))}return u}}function cM(o,e,i,u,h){return Br(o,((p,m)=>{const b=e instanceof Ns?e.get(m):null;return b&&b.evaluate?b.evaluate(i,u,void 0,h):b}))}function AU(o,e){return e-o}nr(uM,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const hM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Zb{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,u]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=u>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=hM[15&u];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new Zb(b,m,p,e)}constructor(e,i=64,u=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=u,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=hM.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-b%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${u}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+T,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+b+T),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+T,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=e,this.coords[this._pos++]=i,u}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Xb(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:b}=this,T=[0,p.length-1,0],A=[];for(;T.length;){const M=T.pop()||0,O=T.pop()||0,D=T.pop()||0;if(O-D<=b){for(let X=D;X<=O;X++){const te=m[2*X],ue=m[2*X+1];te>=e&&te<=u&&ue>=i&&ue<=h&&A.push(p[X])}continue}const N=D+O>>1,U=m[2*N],H=m[2*N+1];U>=e&&U<=u&&H>=i&&H<=h&&A.push(p[N]),(M===0?e<=U:i<=H)&&(T.push(D),T.push(N-1),T.push(1-M)),(M===0?u>=U:h>=H)&&(T.push(N+1),T.push(O),T.push(1-M))}return A}within(e,i,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:m}=this,b=[0,h.length-1,0],T=[],A=u*u;for(;b.length;){const M=b.pop()||0,O=b.pop()||0,D=b.pop()||0;if(O-D<=m){for(let X=D;X<=O;X++)dM(p[2*X],p[2*X+1],e,i)<=A&&T.push(h[X]);continue}const N=D+O>>1,U=p[2*N],H=p[2*N+1];dM(U,H,e,i)<=A&&T.push(h[N]),(M===0?e-u<=U:i-u<=H)&&(b.push(D),b.push(N-1),b.push(1-M)),(M===0?e+u>=U:i+u>=H)&&(b.push(N+1),b.push(O),b.push(1-M))}return T}}function Xb(o,e,i,u,h,p){if(h-u<=i)return;const m=u+h>>1;fM(o,e,m,u,h,p),Xb(o,e,i,u,m-1,1-p),Xb(o,e,i,m+1,h,1-p)}function fM(o,e,i,u,h,p){for(;h>u;){if(h-u>600){const A=h-u+1,M=i-u+1,O=Math.log(A),D=.5*Math.exp(2*O/3),N=.5*Math.sqrt(O*D*(A-D)/A)*(M-A/2<0?-1:1);fM(o,e,i,Math.max(u,Math.floor(i-M*D/A+N)),Math.min(h,Math.floor(i+(A-M)*D/A+N)),p)}const m=e[2*i+p];let b=u,T=h;for(F_(o,e,u,i),e[2*h+p]>m&&F_(o,e,u,h);b<T;){for(F_(o,e,b,T),b++,T--;e[2*b+p]<m;)b++;for(;e[2*T+p]>m;)T--}e[2*u+p]===m?F_(o,e,u,T):(T++,F_(o,e,T,h)),T<=i&&(u=T+1),i<=T&&(h=T-1)}}function F_(o,e,i,u){Kb(o,i,u),Kb(e,2*i,2*u),Kb(e,2*i+1,2*u+1)}function Kb(o,e,i){const u=o[e];o[e]=o[i],o[i]=u}function dM(o,e,i,u){const h=o-i,p=e-u;return h*h+p*p}a.$=xo,a.A=al,a.B=Il,a.C=Ac,a.D=Um,a.E=hu,a.F=2,a.G=S_,a.H=NI,a.I=ea,a.J=Cl,a.K=class extends Ov{},a.L=ll,a.M=hs,a.N=pc,a.O=ph,a.P=Ct,a.Q=Cp,a.R=ms,a.S=bd,a.T=cb,a.U=Vl,a.V=Ov,a.W=pf,a.X=gl,a.Y=ah,a.Z=vu,a._=kl,a.a=function(o){return Bo.API_CDN_URL_REGEX.test(o)},a.a$=mt,a.a0=Aa,a.a1=Sc,a.a2=hf,a.a3=xd,a.a4=function(o){const e=o.value;let i=[];if(!e)return i;const u=Cl(e);return u!=="string"?(i=i.concat([new Ov(o.key,e,`string expected, "${u}" found`)]),i):(Fb(e,!0)||(i=i.concat([new Ov(o.key,e,`invalid url "${e}"`)])),i)},a.a5=Ve,a.a6=ao,a.a7=Ei,a.a8=St,a.a9=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return to(o.expression.evaluate(e))}interpolate(o,e,i){return{x:wr(o.x,e.x,i),y:wr(o.y,e.y,i),z:wr(o.z,e.z,i),azimuthal:wr(o.azimuthal,e.azimuthal,i),polar:wr(o.polar,e.polar,i)}}},a.aA=Ui,a.aB=Zo,a.aC=Ko,a.aD=Z,a.aE=Le,a.aF=function(o,e){const i={};for(let u=0;u<e.length;u++){const h=e[u];h in o&&(i[h]=o[h])}return i},a.aG=j,a.aH=J,a.aI=class{constructor(o){this.entries={},this.scheduler=o}request(o,e,i,u){const h=this.entries[o]=this.entries[o]||{callbacks:[]};if(h.result){const[p,m]=h.result;return this.scheduler?this.scheduler.add((()=>{u(p,m)}),e):u(p,m),()=>{}}return h.callbacks.push(u),h.cancel||(h.cancel=i(((p,m)=>{h.result=[p,m];for(const b of h.callbacks)this.scheduler?this.scheduler.add((()=>{b(p,m)}),e):b(p,m);setTimeout((()=>delete this.entries[o]),3e3)}))),()=>{h.result||(h.callbacks=h.callbacks.filter((p=>p!==u)),h.callbacks.length||(h.cancel(),delete this.entries[o]))}}},a.aJ=function(o,e,i){const u=JSON.stringify(o.request);return o.data&&(this.deduped.entries[u]={result:[null,o.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},(h=>{const p=Vh(o.request,((m,b,T,A)=>{m?h(m):b&&h(null,{vectorTile:i?void 0:new lr(new dv(b)),rawData:b,cacheControl:T,expires:A})}));return()=>{p.cancel(),h()}}),e)},a.aK=function(o){Qf++,Qf>oi&&(o.getActor().send("enforceCacheSizeLimit",rs),Qf=0)},a.aL=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},a.aM=Gi,a.aN=pC,a.aO=xC,a.aP=dC,a.aQ=function(o,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let u=0;u<o.length;u++){const h=document.createElement("source");wm(o[u])||(i.crossOrigin="Anonymous"),h.src=o[u],i.appendChild(h)}return{cancel:()=>{}}},a.aR=__,a.aS=function(o){return fetch(o).then((e=>e.arrayBuffer())).then((e=>GP(e,0,o)))},a.aT=QP,a.aU=class{constructor(o,e,i,u){this.id=o,this.position=e!=null?new L(e[0],e[1]):new L(0,0),this.orientation=i??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,e){if(de(o.matrix,e,o.matrix),o.meshes)for(const i of o.meshes){const u=Mr.applyTransformFast(i.aabb,o.matrix);this.aabb.encapsulate(u)}if(o.children)for(const i of o.children)this._applyTransformations(i,o.matrix)}computeBoundsAndApplyParent(){const o=ee([]);for(const e of this.nodes)this._applyTransformations(e,o)}computeModelMatrix(o,e,i,u,h,p,m=!1){YP(this.matrix,this,o.transform,this.position,e,i,u,h,p,m)}upload(o){if(!this.uploaded){for(const e of this.nodes)db(e,o);for(const e of this.nodes)fv(e);this.uploaded=!0}}destroy(){for(const o of this.nodes)pb(o)}},a.aV=Cr,a.aW=A_,a.aX=se,a.aY=ce,a.aZ=Pc,a.a_=ai,a.aa=Un,a.ab=ls,a.ac=Ae,a.ad=Er,a.ae=gt,a.af=Fe,a.ag=Ns,a.ah=ht,a.ai=wr,a.aj=$t,a.ak=td,a.al=Cn,a.am=wn,a.an=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return(function([i,u]){const h=to([1,i,u]);return{x:h.x,y:h.y,z:h.z}})(o.expression.evaluate(e))}interpolate(o,e,i){return{x:wr(o.x,e.x,i),y:wr(o.y,e.y,i),z:wr(o.z,e.z,i)}}},a.ao=function(o,e,i=0,u=!0){const h=new Ct(i,i),p=o.sub(h),m=e.add(h),b=[p,new Ct(m.x,p.y),m,new Ct(p.x,m.y)];return u&&b.push(p.clone()),b},a.ap=function(o,e){const i=[];for(let u=0;u<o.length;u++){const h=et(u-1,-1,o.length-1),p=et(u+1,-1,o.length-1),m=o[u],b=o[p],T=o[h].sub(m).unit(),A=b.sub(m).unit(),M=A.angleWithSep(T.x,T.y),O=T.add(A).unit().mult(-1*e/Math.sin(M/2));i.push(m.add(O))}return i},a.aq=QI,a.ar=Mi,a.as=function(o,e,i=0){return Pt(((e.x-i)*o.scale-o.x)*$t,(e.y*o.scale-o.y)*$t,pe(e.z,e.y))},a.at=In,a.au=Ir,a.av=Sn,a.aw=cI,a.ax=function(o){let e=1/0,i=1/0,u=-1/0,h=-1/0;for(const p of o)e=Math.min(e,p.x),i=Math.min(i,p.y),u=Math.max(u,p.x),h=Math.max(h,p.y);return{min:new Ct(e,i),max:new Ct(u,h)}},a.ay=ve,a.az=de,a.b=function(o){return Bo.API_FONTS_REGEX.test(o)},a.b$=Ib,a.b0=Dp,a.b1=Pv,a.b2=function(){cs.isLoading()||cs.isLoaded()||xf()!=="deferred"||Td()},a.b3=Pu,a.b4=tt,a.b5=tg,a.b6=kn,a.b7=_b,a.b8=Xx,a.b9=Re,a.bA=function(o,e){const{x:i,y:u}=o.point,h=Et(i,u,o.worldSize/o._pixelsPerMercatorPixel,0,0);return de(h,h,Kr(G(e)))},a.bB=$,a.bC=Pi,a.bD=function(o,e){return Math.hypot(e[0]-o[0],e[1]-o[1],e[2]-o[2])},a.bE=pt,a.bF=Ur,a.bG=Lr,a.bH=w_,a.bI=Zs,a.bJ=Tb,a.bK=function(o,e,i,u,h){const p=5*e+2;o.float32[p+0]=i,o.float32[p+1]=u,o.float32[p+2]=h},a.bL=Av,a.bM=ts,a.bN=Ql,a.bO=wl,a.bP=qo,a.bQ=et,a.bR=function(o,e,i,u){var h=new z(4);return h[0]=o,h[1]=e,h[2]=i,h[3]=u,h},a.bS=ov,a.bT=Wn,a.bU=Yo,a.bV=cP,a.bW=bC,a.bX=pP,a.bY=Jx,a.bZ=Sb,a.b_=HI,a.ba=pa,a.bb=Fd,a.bc=Xy,a.bd=wi,a.be=Nm,a.bf=zb,a.bg=function(o,e){const i=ht(e.zoom);if(i===0)return G(o);const u=it(o),h=qt(u),p=Z(u.getWest())*e.worldSize,m=Z(u.getEast())*e.worldSize,b=J(u.getNorth())*e.worldSize,T=J(u.getSouth())*e.worldSize,A=[p,b,0],M=[m,b,0],O=[p,T,0],D=[m,T,0],N=ne([],e.globeMatrix);return Er(A,A,N),Er(M,M,N),Er(O,O,N),Er(D,D,N),h[0]=Q(h[0],O,i),h[1]=Q(h[1],D,i),h[2]=Q(h[2],M,i),h[3]=Q(h[3],A,i),Mr.fromPoints(h)},a.bh=$r,a.bi=ne,a.bj=mr,a.bk=Q,a.bl=vh,a.bm=Vp,a.bn=ze,a.bo=xe,a.bp=Nv,a.bq=dv,a.br=Vh,a.bs=function(o,e){const i=[];for(const u in o)u in e||i.push(u);return i},a.bt=Ue,a.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.bv=il,a.bw=function(o){var e=new z(16);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=o[3],e[4]=o[4],e[5]=o[5],e[6]=o[6],e[7]=o[7],e[8]=o[8],e[9]=o[9],e[10]=o[10],e[11]=o[11],e[12]=o[12],e[13]=o[13],e[14]=o[14],e[15]=o[15],e},a.bx=ee,a.by=_e,a.bz=ae,a.c=Jf,a.c$=45,a.c0=Zb,a.c1=$e,a.c2=Ki,a.c3=Fa,a.c4=function(o,e,i){i*=.5;var u=e[0],h=e[1],p=e[2],m=e[3],b=Math.sin(i),T=Math.cos(i);return o[0]=u*T+h*b,o[1]=h*T-u*b,o[2]=p*T+m*b,o[3]=m*T-p*b,o},a.c5=Ms,a.c6=Ti,a.c7=function(o,e){return o[0]=-e[0],o[1]=-e[1],o[2]=-e[2],o[3]=e[3],o},a.c8=rt,a.c9=function(o,e,i,u,h){var p,m=1/Math.tan(e/2);return o[0]=m/i,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=m,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,h!=null&&h!==1/0?(o[10]=(h+u)*(p=1/(u-h)),o[14]=2*h*u*p):(o[10]=-1,o[14]=-2*u),o},a.cA=ga,a.cB=Ze,a.cC=function(o,e,i,u,h,p,m,b,T){if(T.name==="globe")return Ze(o,e,new ga(i,u,h),!1);const A=A_({z:i,x:u,y:h},T);return new Mr([(p+A.x/A.scale)*e,e*(A.y/A.scale),m],[(p+A.x2/A.scale)*e,e*(A.y2/A.scale),b])},a.cD=function(o,e,i){return o[0]=Math.min(e[0],i[0]),o[1]=Math.min(e[1],i[1]),o[2]=Math.min(e[2],i[2]),o[3]=Math.min(e[3],i[3]),o},a.cE=function(o,e,i){return o[0]=Math.max(e[0],i[0]),o[1]=Math.max(e[1],i[1]),o[2]=Math.max(e[2],i[2]),o[3]=Math.max(e[3],i[3]),o},a.cF=function(o){const e=Math.round((o+45+360)%360/90)%4;return re[e]},a.cG=Se,a.cH=$o,a.cI=f,a.cJ=function(o){const e=ee(new Float64Array(16));de(e,o.pixelMatrix,o.globeMatrix);const i=[0,_,0],u=[0,v,0];return Er(i,i,e),Er(u,u,e),[i[0]>0&&i[0]<=o.width&&i[1]>0&&i[1]<=o.height&&!Tr(o,new L(o.center.lat,90)),u[0]>0&&u[0]<=o.width&&u[1]>0&&u[1]<=o.height&&!Tr(o,new L(o.center.lat,-90))]},a.cK=function(o,e){const{scale:i}=o.tileTransform,u=i*$t/(o.tileSize*Math.pow(2,e.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return(function(h,p,m){var b=p[1],T=p[2],A=p[3],M=m[0],O=m[1];return h[0]=p[0]*M,h[1]=b*M,h[2]=T*O,h[3]=A*O,h})(new Float32Array(4),e.inverseAdjustmentMatrix,[u,u])},a.cL=cv,a.cM=kt,a.cN=HP,a.cO=function(o){const e=HP(o,!0);return $([],[e[0],e[1],e[4],e[5]])},a.cP=be,a.cQ=Mn,a.cR=ke,a.cS=function(o){const{x:e,y:i}=o.point,{lng:u,lat:h}=o._center;return Et(e,i,o.worldSize,u,h)},a.cT=lt,a.cU=Ke,a.cV=Ka,a.cW=Oi,a.cX=Up,a.cY=function(o,e,i){let u=0;for(let h=0;h<2;++h)o[h]>0&&(u+=(o[h]-0)*(o[h]-0)),e[h]<0&&(u+=(0-e[h])*(0-e[h]));return u},a.cZ=function(o){return o*o*o*o*o},a.c_=K,a.ca=function(o,e,i,u,h,p,m){var b=1/(e-i),T=1/(u-h),A=1/(p-m);return o[0]=-2*b,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*T,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*A,o[11]=0,o[12]=(e+i)*b,o[13]=(h+u)*T,o[14]=(m+p)*A,o[15]=1,o},a.cb=Y,a.cc=function(o,e,i){o[4*e+0]=i[0],o[4*e+1]=i[1],o[4*e+2]=i[2],o[4*e+3]=i[3]},a.cd=jo,a.ce=qs,a.cf=$i,a.cg=Nr,a.ch=Gl,a.ci=L,a.cj=iC,a.ck=function(){var o=new z(4);return z!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},a.cl=function(o,e,i){var u=e[0],h=e[1],p=e[2],m=e[3],b=Math.sin(i),T=Math.cos(i);return o[0]=u*T+p*b,o[1]=h*T+m*b,o[2]=u*-b+p*T,o[3]=h*-b+m*T,o},a.cm=function(o,e){return o[0]===e[0]&&o[1]===e[1]&&o[2]===e[2]&&o[3]===e[3]},a.cn=Rn,a.co=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},a.cp=Qs,a.cq=sr,a.cr=Ts,a.cs=3,a.ct=2,a.cu=7,a.cv=6,a.cw=or,a.cx=He,a.cy=zn,a.cz=WP,a.d=function(o){return Bo.API_TILEJSON_REGEX.test(o)},a.d$=(o,e,i,u,h,p,m,b,T,A)=>{const M=o.transform,O=M.calculatePixelsToTileUnitsMatrix(e),D=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",N=M.pitch<15?hI(.07,.7,ve((14-M.zoom)/5,0,1)):.07;return{u_matrix:dI(o,e,i,u),u_pixels_to_tile_units:O,u_device_pixel_ratio:p,u_width_scale:m,u_floor_width_scale:b,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:mI(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:fI(e,o.transform),u_alpha_discard_threshold:0,u_trim_offset:T,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:N,u_tile_to_meter:Ee(e.tileID.canonical,0),u_ground_shadow_factor:A}},a.d0=Mc,a.d1=function(o,e,i){const u=Math.sqrt(o*o+e*e+i*i),h=u>0?Math.acos(i/u)*Zu:0;let p=o!==0||e!==0?Math.atan2(-e,-o)*Zu+90:0;return p<0&&(p+=360),[u,p,h]},a.d2=Pt,a.d3=to,a.d4=Ee,a.d5=Tt,a.d6=Mr,a.d7=Ht,a.d8=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},a.d9=Fb,a.dA=it,a.dB=function(o){const e=Se-5;o=ve(o,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Cn(o))),3);return Math.round(i*(d.length-1))},a.dC=function(o,e,i,u){const h=e.getNorth(),p=e.getSouth(),m=e.getWest(),b=e.getEast(),T=1<<o.z,A=b-m,M=h-p,O=A/s,D=-M/d[i],N=[0,O,0,D,0,0,h,m,0];if(o.z>0){const U=180/u;ie(N,N,[U/A+1,0,0,0,U/M+1,0,-.5*U/O,.5*U/D,1])}return N[2]=T,N[5]=o.x,N[8]=o.y,N},a.dD=G,a.dE=function(o,e,i){const u=ee(new Float64Array(16)),h=(e/(1<<o)-.5)*Math.PI*2;return he(u,i.globeMatrix,h),Float32Array.from(u)},a.dF=class{isDataAvailableAtPoint(o){const e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;const i=e.getSource().maxzoom,u=1<<i,h=Math.floor(o.x),p=Math.floor((o.x-h)*u),m=Math.floor(o.y*u),b=this.findDEMTileFor(new Gi(i,h,i,p,m));return!(!b||!b.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const u=this._source();if(!u||o.y<0||o.y>1)return e;const h=u.getSource().maxzoom,p=1<<h,m=Math.floor(o.x),b=o.x-m,T=new Gi(h,m,h,Math.floor(b*p),Math.floor(o.y*p)),A=this.findDEMTileFor(T);if(!A||!A.dem)return e;const M=A.dem,O=1<<A.tileID.canonical.z,D=(b*O-A.tileID.canonical.x)*M.dim,N=(o.y*O-A.tileID.canonical.y)*M.dim,U=Math.floor(D),H=Math.floor(N);return(i?this.exaggeration():1)*wr(wr(M.get(U,H),M.get(U,H+1),N-H),wr(M.get(U+1,H),M.get(U+1,H+1),N-H),D-U)}getAtTileOffset(o,e,i){const u=1<<o.canonical.z;return this.getAtPointOrZero(new Ae(o.wrap+(o.canonical.x+e/$t)/u,(o.canonical.y+i/$t)/u))}getAtTileOffsetFunc(o,e,i,u){return h=>{const p=this.getAtTileOffset(o,h.x,h.y),m=u.upVector(o.canonical,h.x,h.y);return $e(m,m,p*u.upVectorScale(o.canonical,e,i).metersToTile),m}}getForTilePoints(o,e,i,u){if(this.isUsingMockSource())return!1;const h=Ym.create(this,o,u);return!!h&&(e.forEach((p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],i)})),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const i=e.dem.tree,u=e.tileID,h=1<<o.canonical.z-u.canonical.z;let p=o.canonical.x/h-u.canonical.x,m=o.canonical.y/h-u.canonical.y,b=0;for(let T=0;T<o.canonical.z-u.canonical.z&&!i.leaves[b];T++){p*=2,m*=2;const A=2*Math.floor(m)+Math.floor(p);b=i.childOffsets[b]+A,p%=1,m%=1}return{min:this.exaggeration()*i.minimums[b],max:this.exaggeration()*i.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(o.length===0)return null;let e=!1,i=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const h of o){const p=this.getMinMaxForTile(h.tileID);p&&(i=Math.min(i,p.min),u=Math.max(u,p.max),e=!0)}return e?{min:i,max:u}:null}},a.dG=H2,a.dH=Of,a.dI=function(o,e){return[Math.pow(o[0],2.2)*e,Math.pow(o[1],2.2)*e,Math.pow(o[2],2.2)*e]},a.dJ=V,a.dK=function(o,e){var i=Math.sin(e),u=Math.cos(e);return o[0]=u,o[1]=i,o[2]=0,o[3]=-i,o[4]=u,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},a.dL=pn,a.dM=Do,a.dN=ro,a.dO=Qo,a.dP=256,a.dQ=function(o,e){const i=[0,0,0];return Er(i,i,$r(G(e.canonical))),Er(i,i,o),i},a.dR=o=>({u_matrix:new Gl(o),u_texsize:new Nr(o),u_pixels_to_tile_units:new Zd(o),u_device_pixel_ratio:new $i(o),u_width_scale:new $i(o),u_floor_width_scale:new $i(o),u_image:new jo(o),u_units_to_pixels:new Nr(o),u_tile_units_to_pixels:new $i(o),u_alpha_discard_threshold:new $i(o),u_trim_offset:new Nr(o),u_trim_fade_range:new Nr(o),u_trim_color:new Mc(o),u_emissive_strength:new $i(o),u_zbias_factor:new $i(o),u_tile_to_meter:new $i(o),u_ground_shadow_factor:new qs(o),u_pattern_transition:new $i(o)}),a.dS=o=>({u_matrix:new Gl(o),u_pixels_to_tile_units:new Zd(o),u_device_pixel_ratio:new $i(o),u_width_scale:new $i(o),u_floor_width_scale:new $i(o),u_units_to_pixels:new Nr(o),u_dash_image:new jo(o),u_gradient_image:new jo(o),u_image_height:new $i(o),u_texsize:new Nr(o),u_tile_units_to_pixels:new $i(o),u_alpha_discard_threshold:new $i(o),u_trim_offset:new Nr(o),u_trim_fade_range:new Nr(o),u_trim_color:new Mc(o),u_emissive_strength:new $i(o),u_zbias_factor:new $i(o),u_tile_to_meter:new $i(o),u_ground_shadow_factor:new qs(o)}),a.dT=o=>({u_camera_to_center_distance:new $i(o),u_extrude_scale:new Zd(o),u_device_pixel_ratio:new $i(o),u_matrix:new Gl(o),u_inv_rot_matrix:new Gl(o),u_merc_center:new Nr(o),u_tile_id:new qs(o),u_zoom_transition:new $i(o),u_up_dir:new qs(o),u_emissive_strength:new $i(o)}),a.dU=$s,a.dV=N5,a.dW=aa,a.dX=(o,e,i,u,h,p)=>{const m=o.transform,b=m.projection.name==="globe";let T;if(p.paint.get("circle-pitch-alignment")==="map")if(b){const M=Do(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;T=Float32Array.from([M,0,0,M])}else T=m.calculatePixelsToTileUnitsMatrix(i);else T=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(m.projection),u_matrix:o.translatePosMatrix(e.projMatrix,i,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ds.devicePixelRatio,u_extrude_scale:T,u_inv_rot_matrix:jn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(b){A.u_inv_rot_matrix=u,A.u_merc_center=h,A.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],A.u_zoom_transition=ht(m.zoom);const M=h[0]*$t,O=h[1]*$t;A.u_up_dir=m.projection.upVector(new ga(0,0,0),M,O)}return A},a.dY=pI,a.dZ=Pa,a.d_=(o,e,i,u,h,p,m,b,T,A)=>{const M=o.transform,O=M.pitch<15?hI(.07,.7,ve((14-M.zoom)/5,0,1)):.07,D=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:dI(o,e,i,u),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_width_scale:p,u_floor_width_scale:m,u_image:0,u_tile_units_to_pixels:fI(e,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:O,u_tile_to_meter:Ee(e.tileID.canonical,0),u_ground_shadow_factor:T,u_pattern_transition:A}},a.da=function(o,e){return o.readFields(D4,{icons:[]},e)},a.db=av,a.dc=Zm,a.dd=Ab,a.de=Uh,a.df=Sd,a.dg=ua,a.dh=cu,a.di=Jr,a.dj=function(o){const e=o.indexOf(Iu);return e>=0?o.slice(0,e):o},a.dk=function(o){return o.indexOf(Iu)>=0},a.dl=function(o){const e=o.lastIndexOf(Iu);return e>=0?o.slice(e+1):""},a.dm=function(o){const e=[],i=o.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},a.dn=function(o,e,i,u){return o.type==="custom"?new I4(o,e):new R4[o.type](o,e,i,u)},a.dp=ln,a.dq=function(o){const e=o.indexOf(Iu);return e>=0?o.slice(e+1):""},a.dr=class extends tg{constructor(o,e){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state=Object.assign({},o.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){const o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},a.ds=gh,a.dt=ol,a.du=function(o){return o({pluginStatus:So,pluginURL:Ul}),gh.on("pluginStateChange",o),o},a.dv=Gd,a.dw=class extends Ca{constructor(o){super(o),this.current=Hd}set(o,e,i){if(this.fetchUniformLocation(o,e)){for(let u=0;u<9;u++)if(i[u]!==this.current[u]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},a.dx=oe,a.dy=function(o,e,i){const u=ht(i.zoom),h=o.style.map._antialias,p=o.terrain&&o.terrain.exaggeration()>0;return u===0&&!h&&!p},a.dz=function(o){const e=o.pixelsPerMeter,i=e/Y(1,o.center.lat),u=ee(new Float64Array(16));return xe(u,u,[o.point.x,o.point.y,0]),be(u,u,[i,i,e]),Float32Array.from(u)},a.e=Bo,a.e$=xf,a.e0=vr,a.e1=r_,a.e2=pe,a.e3=Rc,a.e4=iv,a.e5=AP,a.e6=Yd,a.e7=450,a.e8=7,a.e9=Me,a.eA=function(o,e,i,u,h,p,m,b,T,A,M,O,D,N,U,H){var X=new z(16);return X[0]=o,X[1]=e,X[2]=i,X[3]=u,X[4]=h,X[5]=p,X[6]=m,X[7]=b,X[8]=T,X[9]=A,X[10]=M,X[11]=O,X[12]=D,X[13]=N,X[14]=U,X[15]=H,X},a.eB=C,a.eC=kp,a.eD=Sh,a.eE=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ct(1/0,1/0),max:new Ct(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,e=!1){const i=fP(new Ct(0,0),new Ct($t,$t),o),u=[];if(e&&!Kx(i,this._globalClipBounds))return u;for(const h of this._activeRegions){if(h.hiddenByOverlap||!Kx(i,h))continue;const p=Fj(h.min,h.max,o);u.push({min:p.min,max:p.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return u}setSources(o){this._setSources(o.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const u of e.cache.getVisibleCoordinates()){const h=e.cache.getTile(u).buckets[e.layer];h&&h.updateFootprints(u.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(o){const e=o.getFootprints();if(e.length===0)return;const i=o.getOrder(),u=o.getClipMask(),h=o.getClipScope();for(const p of e){if(!p.footprint)continue;const m=fP(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:i,clipMask:u,clipScope:h})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,i)=>e.priority-i.priority||tv(e.min,i.min)||tv(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(u,h){const p=(m,b)=>m+b;return u.length-h.length||u.reduce(p,"").localeCompare(h.reduce(p,""))})(e.clipScope,i.clipScope)));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let e=0;for(;!o&&e!==this._activeRegions.length;){const i=this._activeRegions[e],u=this._prevRegions[e];o=i.priority!==u.priority||!hP(i,u)||i.order!==u.order||i.clipMask!==u.clipMask||!il(i.clipScope,u.clipScope),++e}}if(o){++this._updateTime;for(const i of this._activeRegions)i.order!==l_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const u=this._activeRegions;if(i>=u.length)return i;const h=u[i].priority;for(;i<u.length&&u[i].priority===h;)++i;return i};if(this._sourceIds.length>1){let i=0,u=e(i);for(;i!==u;){let h=i;const p=i;for(;h!==u;){const m=this._activeRegions[h];m.hiddenByOverlap=!1;for(let b=0;b<p;b++){const T=this._activeRegions[b];if(!T.hiddenByOverlap&&m.order===l_&&Kx(m,T)&&(m.hiddenByOverlap=dP(m.footprint,m.tileId,T.footprint,T.tileId),m.hiddenByOverlap))break}++h}i=u,u=e(i)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=o.length-1;e>=0;e--)this._addSource(o[e]);this._computeReplacement()}},a.eF=l_,a.eG=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,e){const i=new pa,u=new ai,h=[],p=o+1+2,m=e[0]+1,b=e[0]+1+(1+e.length),T=(A,M,O)=>{let D=A===p-1?A-2:A===0?A:A-1;return D+=O?24575:0,[D,M]};for(let A=0;A<p;++A)i.emplaceBack(...T(A,0,!0));for(let A=0;A<m;++A)for(let M=0;M<p;++M)i.emplaceBack(...T(M,A,(M===0||M===p-1)&&!0));for(let A=0;A<e.length;++A){const M=e[A];for(let O=0;O<p;++O)i.emplaceBack(...T(O,M,!0))}for(let A=0;A<e.length;++A){const M=u.length,O=e[A]+1+2,D=new ai;for(let H=0;H<O-1;H++){const X=H===O-2,te=X?p*(b-e.length+A-H):p;for(let ue=0;ue<p-1;ue++){const le=H*p+ue;H===0||X||ue===0||ue===p-2?(D.emplaceBack(le+1,le,le+te),D.emplaceBack(le+te,le+te+1,le+1)):(u.emplaceBack(le+1,le,le+te),u.emplaceBack(le+te,le+te+1,le+1))}}const N=wi.simpleSegment(0,M,i.length,u.length-M);for(let H=0;H<D.uint16.length;H+=3)u.emplaceBack(D.uint16[H],D.uint16[H+1],D.uint16[H+2]);const U=wi.simpleSegment(0,M,i.length,u.length-M);h.push({withoutSkirts:N,withSkirts:U})}return{vertices:i,indices:u,segments:h}}_createGrid(o){const e=this._fillGridMeshWithLods(s,d);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,Xy.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){const e=new ai;for(let m=0;m<=s;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);const i=new Ru,u=new Ru,h=new Ru,p=new Ru;this._poleSegments=[];for(let m=0,b=0;m<Up;m++){const T=360/(1<<m);i.emplaceBack(0,-Zo,0,.5,0),u.emplaceBack(0,-Zo,0,.5,1),h.emplaceBack(0,-Zo,0,.5,.5),p.emplaceBack(0,-Zo,0,.5,.5);for(let A=0;A<=s;A++){let M=A/s,O=0;const D=wr(0,T,M),[N,U,H]=S(En,An,D,Zo);i.emplaceBack(N,U,H,M,O),u.emplaceBack(N,U,H,M,1-O);const X=Cn(D);M=.5+.5*Math.sin(X),O=.5+.5*Math.cos(X),h.emplaceBack(N,U,H,M,O),p.emplaceBack(N,U,H,M,1-O)}this._poleSegments.push(wi.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(i,Bm,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(u,Bm,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(h,Bm,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(p,Bm,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},a.eH=uP,a.eI=ye,a.eJ=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},a.eK=Oe,a.eL=Te,a.eM=function(o,e,i){return o[0]=e[0]/i[0],o[1]=e[1]/i[1],o[2]=e[2]/i[2],o},a.eN=ci,a.eO=E,a.eP=zr,a.eQ=xt,a.eR=function([o,e,i]){const u=Math.hypot(o,e,i),h=Math.atan2(o,i),p=.5*Math.PI-Math.acos(-e/u);return new L(Ke(h),Ke(p))},a.eS=fo,a.eT=hb,a.eU=function(o){const e=o.navigator?o.navigator.userAgent:null;return!!(function(i){if(bi==null){const u=i.navigator?i.navigator.userAgent:null;bi=!!i.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return bi})(o)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},a.eV=function(o,e){rs=o,oi=e},a.eW=Tr,a.eX=Lt,a.eY=function(o){const e=[0,0,0],i=ee(new Float64Array(16));return de(i,o.pixelMatrix,o.globeMatrix),Er(e,e,i),new Ct(e[0],e[1])},a.eZ=function(){const o=p_;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(nb),p_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.e_=function(){av().acquire(nb)},a.ea=function(o,e){if(o===e){var i=e[1],u=e[2],h=e[3],p=e[6],m=e[7],b=e[11];o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=i,o[6]=e[9],o[7]=e[13],o[8]=u,o[9]=p,o[11]=e[14],o[12]=h,o[13]=m,o[14]=b}else o[0]=e[0],o[1]=e[4],o[2]=e[8],o[3]=e[12],o[4]=e[1],o[5]=e[5],o[6]=e[9],o[7]=e[13],o[8]=e[2],o[9]=e[6],o[10]=e[10],o[11]=e[14],o[12]=e[3],o[13]=e[7],o[14]=e[11],o[15]=e[15];return o},a.eb=P4,a.ec=mn,a.ed=Bd,a.ee=256,a.ef=Kr,a.eg=ma,a.eh=he,a.ei=function(o,e){return o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=e[4],o[4]=e[5],o[5]=e[6],o[6]=e[8],o[7]=e[9],o[8]=e[10],o},a.ej=Ru,a.ek=Ld,a.el=Tu,a.em=function(o,e,i,u,h){return ve((o-e)/(i-e)*(h-u)+u,u,h)},a.en=Js,a.eo=function(o,e){var i=e[0],u=e[1],h=e[2],p=e[3],m=e[4],b=e[5],T=e[6],A=e[7],M=e[8],O=M*m-b*A,D=-M*p+b*T,N=A*p-m*T,U=i*O+u*D+h*N;return U?(o[0]=O*(U=1/U),o[1]=(-M*u+h*A)*U,o[2]=(b*u-h*m)*U,o[3]=D*U,o[4]=(M*i-h*T)*U,o[5]=(-b*i+h*p)*U,o[6]=N*U,o[7]=(-A*i+u*T)*U,o[8]=(m*i-u*p)*U,o):null},a.ep=2,a.eq=Hr,a.er=fb,a.es=[1,1,1],a.et=class{constructor(o,e,i,u){this.context=o,this.format=u,this.size=i,this.texture=o.gl.createTexture();const[h,p,m]=this.size,{gl:b}=o;b.bindTexture(b.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),b.texImage3D(b.TEXTURE_3D,0,this.format,h,p,m,0,lb(this.format),ub(this.format),e.data)}bind(o,e){const{context:i}=this,{gl:u}=i;u.bindTexture(u.TEXTURE_3D,this.texture),o!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,o),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,o),this.minFilter=o),e!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,e),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},a.eu=Ym,a.ev=wa,a.ew=function(o,e,i,u){var h=e[0],p=e[1],m=e[2],b=e[3];return o[0]=h+u*(i[0]-h),o[1]=p+u*(i[1]-p),o[2]=m+u*(i[2]-m),o[3]=b+u*(i[3]-b),o},a.ex=Gm,a.ey=Vs,a.ez=To,a.f=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,((e,i)=>String.fromCharCode(+("0x"+i)))))},a.f0=function(o,e,i=!1){if(So===Mo.deferred||So===Mo.loading||So===Mo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ul=ds.resolveURL(o),So=Mo.deferred,vf=e,Ji(),i||Td()},a.f1=function(o){Vm=ds.resolveURL(o),$m||($m=new Um(av(),new hu)),$m.broadcast("setMeshoptUrl",Vm)},a.f2=NP,a.f3=function(o){ob=ds.resolveURL(o),$m||($m=new Um(av(),new hu)),$m.broadcast("setDracoUrl",ob)},a.f4=BP,a.f5=d_,a.f6=function(o){const e=ou();if(!e)return;const i=e.delete(Sl);o&&i.then((()=>o())).catch(o)},a.f7=Hp,a.f8=nr,a.f9=Kd,a.fa=Dc,a.fb=lM,a.fc=uM,a.fd=sI,a.fe=Yt,a.ff="hd_road_elevation",a.fg=Si,a.fh=Br,a.fi=qp,a.fj=Eb,a.fk=Xp,a.fl=function(o,e,i,u,h,p,m,b=1,T,A,M){o.createArrays(),o.tilePixelRatio=$t/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const O=o.layers[0].layout,D=o.layers[0]._unevaluatedLayout._values,N={};N.scaleFactor=b,N.textSizeScaleRange=O.get("text-size-scale-range"),N.iconSizeScaleRange=O.get("icon-size-scale-range");const[U,H]=N.textSizeScaleRange,[X,te]=N.iconSizeScaleRange;N.textScaleFactor=ve(N.scaleFactor,U,H),N.iconScaleFactor=ve(N.scaleFactor,X,te);const ue=D["text-size"],le=D["icon-size"];if(o.textSizeData.kind==="composite"){const{minZoom:je,maxZoom:st}=o.textSizeData;N.compositeTextSizes=[ue.possiblyEvaluate(new Un(je,{worldview:M}),p),ue.possiblyEvaluate(new Un(st,{worldview:M}),p)]}if(o.iconSizeData.kind==="composite"){const{minZoom:je,maxZoom:st}=o.iconSizeData;N.compositeIconSizes=[le.possiblyEvaluate(new Un(je,{worldview:M}),p),le.possiblyEvaluate(new Un(st,{worldview:M}),p)]}N.layoutTextSize=ue.possiblyEvaluate(new Un(m+1,{worldview:M}),p),N.layoutIconSize=le.possiblyEvaluate(new Un(m+1,{worldview:M}),p),N.textMaxSize=ue.possiblyEvaluate(new Un(18,{worldview:M}),p);const fe=O.get("symbol-placement"),De=O.get("text-rotation-alignment")==="map"&&fe!=="point",Ie=O.get("text-size");let Ce=!1;const Be=[];for(const je of o.features){const st=O.get("text-font").evaluate(je,{},p).join(","),Ge=Ie.evaluate(je,{},p)*N.textScaleFactor,ft=N.layoutTextSize.evaluate(je,{},p)*N.textScaleFactor,jt=N.layoutIconSize.evaluate(je,{},p)*N.iconScaleFactor,_t={horizontal:{},vertical:void 0},Mt=je.text;let Ft,ot=[0,0];if(Mt){const rr=Mt.toString(),Pr=O.get("text-letter-spacing").evaluate(je,{},p)*Yo,Fr=O.get("text-line-height").evaluate(je,{},p)*Yo,Zr=wd(rr)?Pr:0,qr=O.get("text-anchor").evaluate(je,{},p),yn=O.get("text-variable-anchor");if(!yn){const nt=O.get("text-radial-offset").evaluate(je,{},p);if(nt)ot=HI(qr,[nt*Yo,Pb]);else{const Vt=O.get("text-offset").evaluate(je,{},p);ot=[Vt[0]*Yo,Vt[1]*Yo]}}let nn=De?"center":O.get("text-justify").evaluate(je,{},p);const fi=fe==="point",me=fi?O.get("text-max-width").evaluate(je,{},p)*Yo:1/0,ge=nt=>{o.allowVerticalPlacement&&_l(rr)&&(_t.vertical=wb(Mt,e,i,h,st,me,Fr,qr,nt,Zr,ot,Zs.vertical,!0,ft,Ge,T))};if(!De&&yn){const nt=nn==="auto"?yn.map((Kt=>Ib(Kt))):[nn];let Vt=!1;for(let Kt=0;Kt<nt.length;Kt++){const Xt=nt[Kt];if(!_t.horizontal[Xt])if(Vt)_t.horizontal[Xt]=_t.horizontal[0];else{const cr=wb(Mt,e,i,h,st,me,Fr,"center",Xt,Zr,ot,Zs.horizontal,!1,ft,Ge,T);cr&&(_t.horizontal[Xt]=cr,Vt=cr.positionedLines.length===1)}}ge("left")}else{if(nn==="auto"&&(nn=Ib(qr)),fi||O.get("text-writing-mode").indexOf("horizontal")>=0||!_l(rr)){const nt=wb(Mt,e,i,h,st,me,Fr,qr,nn,Zr,ot,Zs.horizontal,!1,ft,Ge,T);nt&&(_t.horizontal[nn]=nt)}ge(fi?"left":nn)}}let Ot,Xe,at,Ut,Rt,gr,ar=!1;const At=O.get("icon-text-fit").evaluate(je,{},p);if(je.icon&&je.icon.hasPrimary()){const rr=ZI(je.icon,o.iconSizeData,D["icon-size"],p,o.zoom,je,T,N.iconScaleFactor,M);Ot=rr.iconPrimary,at=rr.iconSecondary;const Pr=Ot.toString();if(Xe=u.get(Pr),Xe&&(Rt=O.get("icon-offset").evaluate(je,{},p),gr=O.get("icon-anchor").evaluate(je,{},p),Ft=n4(h.get(Pr),at?h.get(at.toString()):void 0,Rt,gr),ar=Xe.sdf,o.sdfIcons===void 0?o.sdfIcons=Xe.sdf:o.sdfIcons!==Xe.sdf&&hn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Xe.pixelRatio!==o.pixelRatio||O.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0)),at){const Fr=at.toString();Ut=u.get(Fr)}}Ce=Ce||!(!je.icon||!je.icon.hasSecondary());const zt=Cb(_t.horizontal)||_t.vertical;o.iconsInText||(o.iconsInText=!!zt&&zt.iconsInText);const hr=ft*N.textScaleFactor/Yo,{defaultShapedIcon:er,verticallyShapedIcon:Gt}=d4(o,Ft,O,je,p,_t,hr,Rt,At);At!=="none"&&Ft&&(MI(Ft)||OI(Ft))&&(yv(0,Xe,Ot,Ft,er,At,A,u,h),yv(0,Ut,at,Ft,er,At,A,u,h),Gt&&(yv(0,Xe,Ot,Ft,Gt,At,A,u,h),yv(0,Ut,at,Ft,Gt,At,A,u,h))),Ft=er,Be.push({feature:je,shapedTextOrientations:_t,shapedText:zt,shapedIcon:Ft,iconPrimary:Ot,iconSecondary:at,iconOffset:Rt,iconAnchor:gr,verticallyShapedIcon:Gt,layoutTextSize:ft,layoutIconSize:jt,textOffset:ot,isSDFIcon:ar,iconTextFit:At})}return{featureData:Be,sizes:N,hasAnySecondaryIcon:Ce,textAlongLine:De,symbolPlacement:fe}},a.fm=jI,a.fn=function(o,e,i,u,h,p,m,b,T,A){const{featureData:M,hasAnySecondaryIcon:O,sizes:D,textAlongLine:N,symbolPlacement:U}=e;for(const H of M){const{shapedIcon:X,verticallyShapedIcon:te,feature:ue,shapedTextOrientations:le,shapedText:fe,layoutTextSize:De,textOffset:Ie,isSDFIcon:Ce,iconPrimary:Be,iconSecondary:je,iconTextFit:st,iconOffset:Ge}=H;XI(X,A.iconPositions,Be,je),XI(te,A.iconPositions,Be,je),f4(le,A.iconPositions),h4(Be,je,A.iconPositions),(fe||X)&&p4(o,ue,le,X,te,T,D,De,0,Ie,Ce,u,h,m,b,O,st,Ge,N,U)}i&&o.generateCollisionDebugBuffers(p,o.collisionBoxArray,D.textScaleFactor)},a.fo=lr,a.fp=Bv,a.fq=Ye,a.fr=function(o){let e=0;if(new Uint32Array(o,0,1)[0]!==UP){const i=new Uint32Array(o,0,7),[,,u,h,p,m]=i;e=i.byteLength+h+p+m+p,(u!==o.byteLength||e>=o.byteLength)&&hn("Invalid b3dm header information.")}return GP(o,e)},a.fs=function(o,e){const i=QP(o);for(const u of i){for(const h of u.meshes)p5(h);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(m5(u.lights,e)))}return i},a.ft=Rv,a.fu=qn,a.fv=LP,a.fw=cs,a.fx=Mo,a.fy=function(o){Ju(),Os?.then((e=>{e.keys().then((i=>{for(let u=0;u<i.length-o;u++)e.delete(i[u]).catch((h=>hn(h.message)))})).catch((i=>hn(i.message)))})).catch((e=>hn(e.message)))},a.g=function(o,e){return ol(Qe(o,{method:"GET"}),e)},a.h=Qe,a.i=function(o){return Bo.API_STYLE_REGEX.test(o)&&!Jf(o)},a.j=function(o){return o.indexOf("mapbox:")===0},a.k=tu,a.l=jh,a.m=function(o){return decodeURIComponent(atob(o).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},a.n=function(o,e){return ol(Qe(o,{type:"json"}),e)},a.o=Tl,a.p=function(o,e){return ol(Qe(o,{method:"POST"}),e)},a.q=ds,a.r=_a,a.s=function(o){try{const e=self[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},a.t=Vc,a.u=function(){return(function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)})()},a.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},a.w=hn,a.x=function(){return ib||(ib=new Hp),ib},a.y=qb,a.z=Io})),w(["./shared"],(function(a){function R(Ke){const re=Ke?Ke.url.toString():void 0;return re?performance.getEntriesByName(re):[]}function z(Ke){if(typeof Ke=="number"||typeof Ke=="boolean"||typeof Ke=="string"||Ke==null)return JSON.stringify(Ke);if(Array.isArray(Ke)){let oe="[";for(const ye of Ke)oe+=`${z(ye)},`;return`${oe}]`}let re="{";for(const oe of Object.keys(Ke).sort())re+=`${oe}:${z(Ke[oe])},`;return`${re}}`}function $(Ke){let re="";for(const oe of a.bu)re+=`/${z(Ke[oe])}`;return re}class V{constructor(re){this.keyCache={},this._layers={},this._layerConfigs={},re&&this.replace(re)}replace(re,oe){this._layerConfigs={},this._layers={},this.update(re,[],oe)}update(re,oe,ye){this._options=ye;for(const ve of re)this._layerConfigs[ve.id]=ve,(this._layers[ve.id]=a.dn(ve,this.scope,null,this._options)).compileFilter(ye),this.keyCache[ve.id]&&delete this.keyCache[ve.id];for(const ve of oe)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const Oe=(function(ve,Fe){const et={};for(let Qe=0;Qe<ve.length;Qe++){const Nt=ve[Qe];let mt=Fe&&Fe[Nt.id];mt||(Nt.type==="symbol"?mt=Nt.id:(mt=$(Nt),Nt.type==="line"&&Nt.paint&&(function Cr(Br){return typeof Br=="string"&&Br==="line-progress"||(Array.isArray(Br)?Br.some(Cr):!(!Br||typeof Br!="object")&&Object.values(Br).some(Cr))})(Nt.paint["line-width"])&&(mt+=`/${z(Nt.paint["line-width"])}`))),Fe&&(Fe[Nt.id]=mt);let vr=et[mt];vr||(vr=et[mt]=[]),vr.push(Nt)}const Ue=[];for(const Qe in et)Ue.push(et[Qe]);return Ue})(Object.values(this._layerConfigs),this.keyCache);for(const ve of Oe){const Fe=ve.map((vr=>this._layers[vr.id])),et=Fe[0];if(et.visibility==="none")continue;const Ue=et.source||"";let Qe=this.familiesBySource[Ue];Qe||(Qe=this.familiesBySource[Ue]={});const Nt=et.sourceLayer||"_geojsonTileLayer";let mt=Qe[Nt];mt||(mt=Qe[Nt]=[]),mt.push(Fe)}}}const W=1*a.fa;class ie{constructor(re){const oe={},ye=[];for(const et in re){const Ue=re[et],Qe=oe[et]={};for(const Nt in Ue.glyphs){const mt=Ue.glyphs[+Nt];if(!mt||mt.bitmap.width===0||mt.bitmap.height===0)continue;const vr=mt.metrics.localGlyph?W:1,Cr={x:0,y:0,w:mt.bitmap.width+2*vr,h:mt.bitmap.height+2*vr};ye.push(Cr),Qe[Nt]=Cr}}const{w:Oe,h:ve}=a.H(ye),Fe=new a.f9({width:Oe||1,height:ve||1});for(const et in re){const Ue=re[et];for(const Qe in Ue.glyphs){const Nt=Ue.glyphs[+Qe];if(!Nt||Nt.bitmap.width===0||Nt.bitmap.height===0)continue;const mt=oe[et][Qe],vr=Nt.metrics.localGlyph?W:1;a.f9.copy(Nt.bitmap,Fe,{x:0,y:0},{x:mt.x+vr,y:mt.y+vr},Nt.bitmap)}}this.image=Fe,this.positions=oe}}a.f8(ie,"GlyphAtlas");class ae{constructor(re){this.tileID=new a.aM(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.tileZoom=re.tileZoom,this.uid=re.uid,this.zoom=re.zoom,this.lut=re.lut,this.canonical=re.tileID.canonical,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.scope=re.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=re.showCollisionBoxes,this.collectResourceTiming=!!re.request&&re.request.collectResourceTiming,this.promoteId=re.promoteId,this.isSymbolTile=re.isSymbolTile,this.tileTransform=a.aW(re.tileID.canonical,re.projection),this.projection=re.projection,this.worldview=re.worldview,this.localizableLayerIds=re.localizableLayerIds,this.brightness=re.brightness,this.extraShadowCaster=!!re.extraShadowCaster,this.tessellationStep=re.tessellationStep,this.scaleFactor=re.scaleFactor,this.worldview=re.worldview}parse(re,oe,ye,Oe,ve,Fe){this.status="parsing",this.data=re,this.collisionBoxArray=new a.b0;const et=new a.fb(Object.keys(re.layers).sort()),Ue=new a.fc(this.tileID,this.promoteId);Ue.bucketLayerIDs=[];const Qe={},Nt=new a.fd(256,256),mt={featureIndex:Ue,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Nt,availableImages:ye,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},vr=[],Cr=oe.familiesBySource[this.source];for(const ln in Cr){const Jr=re.layers[ln];if(!Jr)continue;let cn=!1,Yn=!1,hn=!1;for(const qn of Cr[ln])qn[0].type==="symbol"?cn=!0:Yn=!0,qn[0].is3D()&&qn[0].type!=="model"&&(hn=!0);if(this.extraShadowCaster&&!hn||this.isSymbolTile===!0&&!cn||this.isSymbolTile===!1&&!Yn)continue;Jr.version===1&&a.w(`Vector tile source "${this.source}" layer "${ln}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Li=et.encode(ln),$n=[];let to=!1;for(let qn=0,kn=0;qn<Jr.length;qn++){const bi=Jr.feature(qn),Ti=Ue.getId(bi,ln);if(this.localizableLayerIds&&this.localizableLayerIds.has(ln)){const gi=bi.properties?bi.properties.worldview:null;if(this.worldview&&typeof gi=="string")if(gi==="all")bi.properties.$localized=!0;else{if(!gi.split(",").includes(this.worldview))continue;bi.properties.$localized=!0,bi.properties.worldview=this.worldview}}!to&&bi.properties&&bi.properties.hasOwnProperty(a.fe)&&(to=!0),$n.push({feature:bi,id:Ti,index:kn,sourceLayerIndex:Li}),kn++}to&&!mt.elevationFeatures&&re.layers.hasOwnProperty(a.ff)&&(mt.elevationFeatures=a.fg.parseFrom(re.layers[a.ff],this.canonical));for(const qn of Cr[ln]){const kn=qn[0];if(this.extraShadowCaster&&(!kn.is3D()||kn.type==="model")||this.isSymbolTile!==void 0&&kn.type==="symbol"!==this.isSymbolTile||kn.minzoom&&this.zoom<Math.floor(kn.minzoom)||kn.maxzoom&&this.zoom>=kn.maxzoom||kn.visibility==="none")continue;ee(qn,this.zoom,mt.brightness,ye,this.worldview);const bi=Qe[kn.id]=kn.createBucket({index:Ue.bucketLayerIDs.length,layers:qn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Li,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Oe,worldview:this.worldview});Ue.bucketLayerIDs.push(qn.map((gi=>a.C(gi.id,gi.scope))));let Ti=bi.prepare?bi.prepare():null;Ti!=null?(Ti=Ti.then((()=>bi.populate($n,mt,this.tileID.canonical,this.tileTransform))),vr.push(Ti)):bi.populate($n,mt,this.tileID.canonical,this.tileTransform)}}const Br=()=>{let ln,Jr,cn,Yn,hn,Li;Nt.trim();const $n={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},to=()=>{if(ln)return this.status="done",Fe(ln);if(this.extraShadowCaster)this.status="done",Fe(null,{buckets:Object.values(Qe).filter((kn=>!kn.isEmpty())),featureIndex:Ue,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:mt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Jr&&cn&&Yn){const kn=new ie(Jr),bi=new Map;for(const[oo,ro]of cn.entries()){const{imagePosition:Qo}=a.fj(oo,ro,a.fk);bi.set(oo,Qo)}const Ti={};for(const oo in Qe){const ro=Qe[oo];ro instanceof a.b1&&(ee(ro.layers,this.zoom,mt.brightness,ye,this.worldview),Ti[oo]=a.fl(ro,Jr,kn.positions,cn,bi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,hn,this.worldview))}const gi={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ve,cn,hn,(()=>{gi.iconsPending=!1,qn(Ti,kn,gi)})),this.rasterizeIfNeeded(ve,Yn,Li,(()=>{gi.patternsPending=!1,qn(Ti,kn,gi)}))}},qn=(kn,bi,Ti,gi)=>{if(Ti.iconsPending||Ti.patternsPending)return;const oo=new a.fm(cn,Yn,this.lut);for(const ro in Qe){const Qo=Qe[ro];if(ro in kn)a.fn(Qo,kn[ro],this.showCollisionBoxes,ye,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,cn,oo);else if(Qo.hasPattern&&(Qo instanceof a.b7||Qo instanceof a.b8||Qo instanceof a.e4)){ee(Qo.layers,this.zoom,mt.brightness,ye,this.worldview);const Ta=Object.fromEntries(oo.patternPositions);Qo.addFeatures(mt,this.tileID.canonical,Ta,ye,this.tileTransform,this.brightness)}}this.status="done",Fe(null,{buckets:Object.values(Qe).filter((ro=>!ro.isEmpty())),featureIndex:Ue,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bi.image,lineAtlas:Nt,imageAtlas:oo,brightness:mt.brightness})};if(!this.extraShadowCaster){const kn=a.fh(mt.glyphDependencies,(gi=>Object.keys(gi).map(Number)));Object.keys(kn).length?ve.send("getGlyphs",{uid:this.uid,stacks:kn},((gi,oo)=>{ln||(ln=gi,Jr=oo,to())}),void 0,!1,$n):Jr={};const bi=Array.from(mt.iconDependencies.keys()).map((gi=>a.I.parse(gi)));bi.length?ve.send("getImages",{images:bi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((gi,oo)=>{ln||(ln=gi,cn=new Map,hn=this.updateImageMapAndGetImageTaskQueue(cn,oo,mt.iconDependencies),to())}),void 0,!1,$n):(cn=new Map,hn=new Map);const Ti=Array.from(mt.patternDependencies.keys()).map((gi=>a.I.parse(gi)));Ti.length?ve.send("getImages",{images:Ti,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((gi,oo)=>{ln||(ln=gi,Yn=new Map,Li=this.updateImageMapAndGetImageTaskQueue(Yn,oo,mt.patternDependencies),to())}),void 0,!1,$n):(Yn=new Map,Li=new Map)}if(mt.elevationFeatures&&mt.elevationFeatures.length>0){const kn=[];for(const Ti of Object.values(Qe))if(Ti instanceof a.b8){const gi=Ti.getUnevaluatedPortalGraph();gi&&kn.push(gi)}const bi=a.fi.evaluate(kn);for(const Ti of Object.values(Qe))if(Ti instanceof a.b8){const gi=re.layers[et.decode(Ti.sourceLayerIndex)];Ti.setEvaluatedPortalGraph(bi,gi,this.tileID.canonical,mt.availableImages,mt.brightness)}}to()};vr.length>0?Promise.allSettled(vr).then(Br).catch(Fe):Br()}rasterizeIfNeeded(re,oe,ye,Oe){Array.from(oe.values()).some((ve=>ve.usvg))?this.rasterize(re,oe,ye,Oe):Oe()}updateImageMapAndGetImageTaskQueue(re,oe,ye){const Oe=new Map;for(const ve of oe.keys()){const Fe=ye.get(ve)||[];for(const et of Fe){const Ue=et.toString(),Qe=oe.get(et.id.toString());Qe.usvg?Oe.has(Ue)||(Oe.set(Ue,et),re.set(Ue,Object.assign({},Qe))):re.set(Ue,Qe)}}return Oe}rasterize(re,oe,ye,Oe){this.rasterizeTask=re.send("rasterizeImages",{scope:this.scope,tasks:ye},((ve,Fe)=>{if(!ve)for(const[et,Ue]of Fe.entries()){const Qe=Object.assign(oe.get(et),{data:Ue});oe.set(et,Qe)}Oe()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ee(Ke,re,oe,ye,Oe){const ve=new a.aa(re,{brightness:oe,worldview:Oe});for(const Fe of Ke)Fe.recalculate(ve,ye)}class ne extends a.E{constructor(re,oe,ye,Oe,ve,Fe,et){super(),this.actor=re,this.layerIndex=oe,this.availableImages=ye,this.availableModels=Oe,this.loadVectorData=Fe||a.aJ,this.loading={},this.loaded={},this.deduped=new a.aI(re.scheduler),this.isSpriteLoaded=ve,this.scheduler=re.scheduler,this.brightness=et}loadTile(re,oe){const ye=re.uid,Oe=re&&re.request,ve=Oe&&Oe.collectResourceTiming,Fe=this.loading[ye]=new ae(re);Fe.abort=this.loadVectorData(re,((et,Ue)=>{const Qe=!this.loading[ye];if(delete this.loading[ye],Fe.cancelRasterize(),Qe||et||!Ue)return Fe.status="done",Qe||(this.loaded[ye]=Fe),oe(et);const Nt=Ue.rawData,mt={};Ue.expires&&(mt.expires=Ue.expires),Ue.cacheControl&&(mt.cacheControl=Ue.cacheControl),Fe.vectorTile=Ue.vectorTile||new a.fo(new a.bq(Nt));const vr=()=>{Fe.parse(Fe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((Cr,Br)=>{if(Cr||!Br)return oe(Cr);const ln={};if(ve){const Jr=R(Oe);Jr.length>0&&(ln.resourceTiming=JSON.parse(JSON.stringify(Jr)))}oe(null,a.h({rawTileData:Nt.slice(0)},Br,mt,ln))}))};this.isSpriteLoaded?vr():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(vr,{type:"parseTile",isSymbolTile:re.isSymbolTile,zoom:re.tileZoom}):vr()})),this.loaded=this.loaded||{},this.loaded[ye]=Fe}))}reloadTile(re,oe){const ye=this.loaded,Oe=re.uid;if(ye&&ye[Oe]){const ve=ye[Oe];ve.scaleFactor=re.scaleFactor,ve.showCollisionBoxes=re.showCollisionBoxes,ve.projection=re.projection,ve.brightness=re.brightness,ve.tileTransform=a.aW(re.tileID.canonical,re.projection),ve.extraShadowCaster=re.extraShadowCaster,ve.lut=re.lut,ve.worldview=re.worldview;const Fe=(et,Ue)=>{const Qe=ve.reloadCallback;Qe&&(delete ve.reloadCallback,ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Qe)),oe(et,Ue)};ve.status==="parsing"?ve.reloadCallback=Fe:ve.status==="done"&&(ve.vectorTile?ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Fe):Fe())}else oe(null,void 0)}abortTile(re,oe){const ye=re.uid,Oe=this.loading[ye];Oe&&(Oe.abort&&Oe.abort(),delete this.loading[ye]),oe()}removeTile(re,oe){const ye=this.loaded,Oe=re.uid;ye&&ye[Oe]&&delete ye[Oe],oe()}}class de{loadTile(re,oe){const{uid:ye,encoding:Oe,rawImageData:ve,padding:Fe}=re,et=ImageBitmap&&ve instanceof ImageBitmap?this.getImageData(ve,Fe):ve;oe(null,new a.fp(ye,et,Oe,Fe<1))}reloadTile(re,oe){oe(null,null)}abortTile(re,oe){oe()}removeTile(re,oe){oe()}getImageData(re,oe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(re.width,re.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=re.width,this.offscreenCanvas.height=re.height,this.offscreenCanvasContext.drawImage(re,0,0,re.width,re.height);const ye=this.offscreenCanvasContext.getImageData(-oe,-oe,re.width+2*oe,re.height+2*oe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ye}}a.bp.setPbf(a.bq);class xe{constructor(re){this._mrt=new a.bp(re.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=re.uid,this.tileID=re.tileID,this.source=re.source}parse(re,oe){const ye=this._mrt;this.status="parsing",this._entireBuffer=re;try{ye.parseHeader(re),this._isHeaderLoaded=!0;const Oe=[];for(const ve in ye.layers){const Fe=ye.getLayer(ve),et=Fe.getDataRange(Fe.getBandList()),Ue=ye.createDecodingTask(et),Qe=re.slice(et.firstByte,et.lastByte+1),Nt=a.bp.performDecoding(Qe,Ue).then((mt=>Ue.complete(null,mt))).catch((mt=>Ue.complete(mt,null)));Oe.push(Nt)}Promise.allSettled(Oe).then((()=>oe(null,ye))).catch((ve=>oe(ve)))}catch(Oe){oe(Oe)}}}class be{constructor(re){this.actor=re,this.loading={},this.loaded={}}loadTile(re,oe){const ye=re.uid,Oe=re.request,ve=this.loading[ye]=new xe(re),{cancel:Fe}=a.br(Oe,((et,Ue,Qe,Nt)=>{const mt=!this.loading[ye];if(delete this.loading[ye],mt||et||!Ue)return ve.status="done",mt||(this.loaded[ye]=ve),oe(et);ve.parse(Ue,((vr,Cr)=>{if(vr||!Cr)return oe(vr);oe(null,Cr,Qe,Nt)})),this.loaded[ye]=ve}));ve.abort=Fe}reloadTile(re,oe){oe(null,void 0)}abortTile(re,oe){const ye=re.uid,Oe=this.loading[ye];Oe&&(Oe.abort&&Oe.abort(),delete this.loading[ye]),oe()}removeTile(re,oe){const ye=re.uid;this.loaded[ye]&&delete this.loaded[ye],oe()}decodeRasterArray(re,oe){a.bp.performDecoding(re.buffer,re.task).then((ye=>oe(null,ye))).catch((ye=>oe(ye)))}}const ke=a.fq.prototype.toGeoJSON;class he{constructor(re){this._feature=re,this.extent=a.aj,this.type=re.type,this.properties=re.tags,"id"in re&&!isNaN(re.id)&&(this.id=parseInt(re.id,10))}loadGeometry(){if(this._feature.type===1){const re=[];for(const oe of this._feature.geometry)re.push([new a.P(oe[0],oe[1])]);return re}{const re=[];for(const oe of this._feature.geometry){const ye=[];for(const Oe of oe)ye.push(new a.P(Oe[0],Oe[1]));re.push(ye)}return re}}toGeoJSON(re,oe,ye){return ke.call(this,re,oe,ye)}}class _e{constructor(re,oe){this.name=re,this.extent=a.aj,this.length=oe.length,this._jsonFeatures=oe}feature(re){return new he(this._jsonFeatures[re])}}class ze{constructor(re){this.layers={},this.extent=a.aj;for(const oe of Object.keys(re))this.layers[oe]=new _e(oe,re[oe])}}const Ne=64/4096,rt=128;class kt{constructor(){this.features=new Map}clear(){this.features.clear()}load(re=[],oe){for(const ye of re){const Oe=ye.id;if(Oe==null)continue;let ve=this.features.get(Oe);ve&&this.updateCache(ve,oe),ye.geometry?(ve=yt(ye),this.updateCache(ve,oe),this.features.set(Oe,ve)):this.features.delete(Oe),this.updateCache(ve,oe)}}updateCache(re,oe){for(const{canonical:ye,uid:Oe}of Object.values(oe)){const{z:ve,x:Fe,y:et}=ye;He(re,Math.pow(2,ve),Fe,et)&&delete oe[Oe]}}getTile(re,oe,ye){const Oe=Math.pow(2,re),ve=[];for(const Fe of this.features.values())He(Fe,Oe,oe,ye)&&ve.push(Tt(Fe,Oe,oe,ye));return{features:ve}}getFeatures(){return[...this.features.values()]}}function He({minX:Ke,minY:re,maxX:oe,maxY:ye},Oe,ve,Fe){return Ke<(ve+1+Ne)/Oe&&re<(Fe+1+Ne)/Oe&&oe>(ve-Ne)/Oe&&ye>(Fe-Ne)/Oe}function yt(Ke){const{id:re,geometry:oe,properties:ye}=Ke;if(!oe)return;if(oe.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Oe,coordinates:ve}=oe,Fe={id:re,type:1,geometry:[],tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},et=Fe.geometry;if(Oe==="Point")gt(ve,et,Fe);else if(Oe==="MultiPoint")for(const Ue of ve)gt(Ue,et,Fe);else if(Oe==="LineString")Fe.type=2,Pt(ve,et,Fe);else if(Oe==="MultiLineString")Fe.type=2,xt(ve,et,Fe);else if(Oe==="Polygon")Fe.type=3,xt(ve,et,Fe,!0);else{if(Oe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Fe.type=3;for(const Ue of ve)xt(Ue,et,Fe,!0)}return Fe}function gt([Ke,re],oe,ye){const Oe=a.aD(Ke);let ve=a.aH(re);ve=ve<0?0:ve>1?1:ve,oe.push(Oe,ve),ye.minX=Math.min(ye.minX,Oe),ye.minY=Math.min(ye.minY,ve),ye.maxX=Math.max(ye.maxX,Oe),ye.maxY=Math.max(ye.maxY,ve)}function Pt(Ke,re,oe,ye=!1,Oe=!1){const ve=[];for(const Fe of Ke)gt(Fe,ve,oe);re.push(ve),ye&&(function(Fe,et){let Ue=0;for(let Qe=0,Nt=Fe.length,mt=Nt-2;Qe<Nt;mt=Qe,Qe+=2)Ue+=(Fe[Qe]-Fe[mt])*(Fe[Qe+1]+Fe[mt+1]);if(Ue>0===et)for(let Qe=0,Nt=Fe.length;Qe<Nt/2;Qe+=2){const mt=Fe[Qe],vr=Fe[Qe+1];Fe[Qe]=Fe[Nt-2-Qe],Fe[Qe+1]=Fe[Nt-1-Qe],Fe[Nt-2-Qe]=mt,Fe[Nt-1-Qe]=vr}})(ve,Oe)}function xt(Ke,re,oe,ye=!1){for(let Oe=0;Oe<Ke.length;Oe++)Pt(Ke[Oe],re,oe,ye,Oe===0)}function Tt(Ke,re,oe,ye){const{id:Oe,type:ve,geometry:Fe,tags:et}=Ke,Ue=[];if(ve===1)(function(Qe,Nt,mt,vr,Cr){for(let Br=0;Br<Qe.length;Br+=2){const ln=Math.round(a.aj*(Qe[Br+0]*Nt-mt)),Jr=Math.round(a.aj*(Qe[Br+1]*Nt-vr));Cr.push([ln,Jr])}})(Fe,re,oe,ye,Ue);else for(const Qe of Fe)Ht(Qe,re,oe,ye,Ue);return{id:Oe,type:ve,geometry:Ue,tags:et}}function Ht(Ke,re,oe,ye,Oe){const ve=-rt,Fe=a.aj+rt;let et;for(let Ue=0;Ue<Ke.length-2;Ue+=2){let Qe=Math.round(a.aj*(Ke[Ue+0]*re-oe)),Nt=Math.round(a.aj*(Ke[Ue+1]*re-ye)),mt=Math.round(a.aj*(Ke[Ue+2]*re-oe)),vr=Math.round(a.aj*(Ke[Ue+3]*re-ye));const Cr=mt-Qe,Br=vr-Nt;Qe<ve&&mt<ve||(Qe<ve?(Nt+=Math.round(Br*((ve-Qe)/Cr)),Qe=ve):mt<ve&&(vr=Nt+Math.round(Br*((ve-Qe)/Cr)),mt=ve),Nt<ve&&vr<ve||(Nt<ve?(Qe+=Math.round(Cr*((ve-Nt)/Br)),Nt=ve):vr<ve&&(mt=Qe+Math.round(Cr*((ve-Nt)/Br)),vr=ve),Qe>=Fe&&mt>=Fe||(Qe>=Fe?(Nt+=Math.round(Br*((Fe-Qe)/Cr)),Qe=Fe):mt>=Fe&&(vr=Nt+Math.round(Br*((Fe-Qe)/Cr)),mt=Fe),Nt>=Fe&&vr>=Fe||(Nt>=Fe?(Qe+=Math.round(Cr*((Fe-Nt)/Br)),Nt=Fe):vr>=Fe&&(mt=Qe+Math.round(Cr*((Fe-Nt)/Br)),vr=Fe),et&&Qe===et[et.length-1][0]&&Nt===et[et.length-1][1]||(et=[[Qe,Nt]],Oe.push(et)),et.push([mt,vr])))))}}function lt({name:Ke,features:re},oe){oe.writeStringField(1,Ke),oe.writeVarintField(5,a.aj);const ye=new Map,Oe=new Map,ve={keys:ye,values:Oe,feature:null};for(const Fe of re)ve.feature=Fe,oe.writeMessage(2,Wt,ve);for(const Fe of ye.keys())oe.writeStringField(3,Fe);for(const Fe of Oe.keys())oe.writeMessage(4,zr,Fe)}function Wt(Ke,re){const oe=Ke.feature;oe.id===void 0||isNaN(+oe.id)||re.writeVarintField(1,+oe.id),oe.tags&&re.writeMessage(2,Zt,Ke),re.writeVarintField(3,oe.type),re.writeMessage(4,fr,oe)}function Zt({keys:Ke,values:re,feature:oe},ye){for(const Oe of Object.keys(oe.tags)){let ve=oe.tags[Oe];if(ve===null)continue;let Fe=Ke.get(Oe);Fe===void 0&&(Fe=Ke.size,Ke.set(Oe,Fe)),ye.writeVarint(Fe);const et=typeof ve;et!=="string"&&et!=="boolean"&&et!=="number"&&(ve=JSON.stringify(ve));let Ue=re.get(ve);Ue===void 0&&(Ue=re.size,re.set(ve,Ue)),ye.writeVarint(Ue)}}function $e(Ke,re){return(re<<3)+(7&Ke)}function pt(Ke){return Ke<<1^Ke>>31}function fr(Ke,re){const{geometry:oe,type:ye}=Ke;let Oe=0,ve=0;if(ye===1){re.writeVarint($e(1,oe.length));for(const Fe of oe){const et=Fe[0]-Oe,Ue=Fe[1]-ve;re.writeVarint(pt(et)),re.writeVarint(pt(Ue)),Oe+=et,ve+=Ue}}else for(const Fe of oe){re.writeVarint($e(1,1));const et=Fe.length-(ye===3?1:0);for(let Ue=0;Ue<et;Ue++){Ue===1&&re.writeVarint($e(2,et-1));const Qe=Fe[Ue][0]-Oe,Nt=Fe[Ue][1]-ve;re.writeVarint(pt(Qe)),re.writeVarint(pt(Nt)),Oe+=Qe,ve+=Nt}ye===3&&re.writeVarint($e(7,1))}}function zr(Ke,re){const oe=typeof Ke;oe==="string"?re.writeStringField(1,Ke):oe==="boolean"?re.writeBooleanField(7,Ke):oe==="number"&&(Ke%1!=0?re.writeDoubleField(3,Ke):Ke<0?re.writeSVarintField(6,Ke):re.writeVarintField(5,Ke))}const Hr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ke=>Ke},Ir=Math.fround||(Lr=new Float32Array(1),Ke=>(Lr[0]=+Ke,Lr[0]));var Lr;const Ur=3,or=5,Er=6;class pn{constructor(re){this.options=Object.assign(Object.create(Hr),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:oe,minZoom:ye,maxZoom:Oe}=this.options;oe&&console.time("total time");const ve=`prepare ${re.length} points`;oe&&console.time(ve),this.points=re;const Fe=[];for(let Ue=0;Ue<re.length;Ue++){const Qe=re[Ue];if(!Qe.geometry)continue;const[Nt,mt]=Qe.geometry.coordinates,vr=Ir(Rn(Nt)),Cr=Ir(In(mt));Fe.push(vr,Cr,1/0,Ue,-1,1),this.options.reduce&&Fe.push(0)}let et=this.trees[Oe+1]=this._createTree(Fe);oe&&console.timeEnd(ve);for(let Ue=Oe;Ue>=ye;Ue--){const Qe=+Date.now();et=this.trees[Ue]=this._createTree(this._cluster(et,Ue)),oe&&console.log("z%d: %d clusters in %dms",Ue,et.numItems,+Date.now()-Qe)}return oe&&console.timeEnd("total time"),this}getClusters(re,oe){let ye=((re[0]+180)%360+360)%360-180;const Oe=Math.max(-90,Math.min(90,re[1]));let ve=re[2]===180?180:((re[2]+180)%360+360)%360-180;const Fe=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)ye=-180,ve=180;else if(ye>ve){const mt=this.getClusters([ye,Oe,180,Fe],oe),vr=this.getClusters([-180,Oe,ve,Fe],oe);return mt.concat(vr)}const et=this.trees[this._limitZoom(oe)],Ue=et.range(Rn(ye),In(Fe),Rn(ve),In(Oe)),Qe=et.data,Nt=[];for(const mt of Ue){const vr=this.stride*mt;Nt.push(Qe[vr+or]>1?sr(Qe,vr,this.clusterProps):this.points[Qe[vr+Ur]])}return Nt}getChildren(re){const oe=this._getOriginId(re),ye=this._getOriginZoom(re),Oe="No cluster with the specified id.",ve=this.trees[ye];if(!ve)throw new Error(Oe);const Fe=ve.data;if(oe*this.stride>=Fe.length)throw new Error(Oe);const et=this.options.radius/(this.options.extent*Math.pow(2,ye-1)),Ue=ve.within(Fe[oe*this.stride],Fe[oe*this.stride+1],et),Qe=[];for(const Nt of Ue){const mt=Nt*this.stride;Fe[mt+4]===re&&Qe.push(Fe[mt+or]>1?sr(Fe,mt,this.clusterProps):this.points[Fe[mt+Ur]])}if(Qe.length===0)throw new Error(Oe);return Qe}getLeaves(re,oe,ye){const Oe=[];return this._appendLeaves(Oe,re,oe=oe||10,ye=ye||0,0),Oe}getTile(re,oe,ye){const Oe=this.trees[this._limitZoom(re)],ve=Math.pow(2,re),{extent:Fe,radius:et}=this.options,Ue=et/Fe,Qe=(ye-Ue)/ve,Nt=(ye+1+Ue)/ve,mt={features:[]};return this._addTileFeatures(Oe.range((oe-Ue)/ve,Qe,(oe+1+Ue)/ve,Nt),Oe.data,oe,ye,ve,mt),oe===0&&this._addTileFeatures(Oe.range(1-Ue/ve,Qe,1,Nt),Oe.data,ve,ye,ve,mt),oe===ve-1&&this._addTileFeatures(Oe.range(0,Qe,Ue/ve,Nt),Oe.data,-1,ye,ve,mt),mt.features.length?mt:null}getClusterExpansionZoom(re){let oe=this._getOriginZoom(re)-1;for(;oe<=this.options.maxZoom;){const ye=this.getChildren(re);if(oe++,ye.length!==1)break;re=ye[0].properties.cluster_id}return oe}_appendLeaves(re,oe,ye,Oe,ve){const Fe=this.getChildren(oe);for(const et of Fe){const Ue=et.properties;if(Ue&&Ue.cluster?ve+Ue.point_count<=Oe?ve+=Ue.point_count:ve=this._appendLeaves(re,Ue.cluster_id,ye,Oe,ve):ve<Oe?ve++:re.push(et),re.length===ye)break}return ve}_createTree(re){const oe=new a.c0(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ye=0;ye<re.length;ye+=this.stride)oe.add(re[ye],re[ye+1]);return oe.finish(),oe.data=re,oe}_addTileFeatures(re,oe,ye,Oe,ve,Fe){for(const et of re){const Ue=et*this.stride,Qe=oe[Ue+or]>1;let Nt,mt,vr;if(Qe)Nt=Pi(oe,Ue,this.clusterProps),mt=oe[Ue],vr=oe[Ue+1];else{const ln=this.points[oe[Ue+Ur]];Nt=ln.properties;const[Jr,cn]=ln.geometry.coordinates;mt=Rn(Jr),vr=In(cn)}const Cr={type:1,geometry:[[Math.round(this.options.extent*(mt*ve-ye)),Math.round(this.options.extent*(vr*ve-Oe))]],tags:Nt};let Br;Br=Qe||this.options.generateId?oe[Ue+Ur]:this.points[oe[Ue+Ur]].id,Br!==void 0&&(Cr.id=Br),Fe.features.push(Cr)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,oe){const{radius:ye,extent:Oe,reduce:ve,minPoints:Fe}=this.options,et=ye/(Oe*Math.pow(2,oe)),Ue=re.data,Qe=[],Nt=this.stride;for(let mt=0;mt<Ue.length;mt+=Nt){if(Ue[mt+2]<=oe)continue;Ue[mt+2]=oe;const vr=Ue[mt],Cr=Ue[mt+1],Br=re.within(Ue[mt],Ue[mt+1],et),ln=Ue[mt+or];let Jr=ln;for(const cn of Br){const Yn=cn*Nt;Ue[Yn+2]>oe&&(Jr+=Ue[Yn+or])}if(Jr>ln&&Jr>=Fe){let cn,Yn=vr*ln,hn=Cr*ln,Li=-1;const $n=(mt/Nt<<5)+(oe+1)+this.points.length;for(const to of Br){const qn=to*Nt;if(Ue[qn+2]<=oe)continue;Ue[qn+2]=oe;const kn=Ue[qn+or];Yn+=Ue[qn]*kn,hn+=Ue[qn+1]*kn,Ue[qn+4]=$n,ve&&(cn||(cn=this._map(Ue,mt,!0),Li=this.clusterProps.length,this.clusterProps.push(cn)),ve(cn,this._map(Ue,qn)))}Ue[mt+4]=$n,Qe.push(Yn/Jr,hn/Jr,1/0,$n,-1,Jr),ve&&Qe.push(Li)}else{for(let cn=0;cn<Nt;cn++)Qe.push(Ue[mt+cn]);if(Jr>1)for(const cn of Br){const Yn=cn*Nt;if(!(Ue[Yn+2]<=oe)){Ue[Yn+2]=oe;for(let hn=0;hn<Nt;hn++)Qe.push(Ue[Yn+hn])}}}}return Qe}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,oe,ye){if(re[oe+or]>1){const Fe=this.clusterProps[re[oe+Er]];return ye?Object.assign({},Fe):Fe}const Oe=this.points[re[oe+Ur]].properties,ve=this.options.map(Oe);return ye&&ve===Oe?Object.assign({},ve):ve}}function sr(Ke,re,oe){return{type:"Feature",id:Ke[re+Ur],properties:Pi(Ke,re,oe),geometry:{type:"Point",coordinates:[(ye=Ke[re],360*(ye-.5)),ci(Ke[re+1])]}};var ye}function Pi(Ke,re,oe){const ye=Ke[re+or],Oe=ye>=1e4?`${Math.round(ye/1e3)}k`:ye>=1e3?Math.round(ye/100)/10+"k":ye,ve=Ke[re+Er],Fe=ve===-1?{}:Object.assign({},oe[ve]);return Object.assign(Fe,{cluster:!0,cluster_id:Ke[re+Ur],point_count:ye,point_count_abbreviated:Oe})}function Rn(Ke){return Ke/360+.5}function In(Ke){const re=Math.sin(Ke*Math.PI/180),oe=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return oe<0?0:oe>1?1:oe}function ci(Ke){const re=(180-360*Ke)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}function Ki(Ke,re,oe,ye){let Oe=ye;const ve=re+(oe-re>>1);let Fe,et=oe-re;const Ue=Ke[re],Qe=Ke[re+1],Nt=Ke[oe],mt=Ke[oe+1];for(let vr=re+3;vr<oe;vr+=3){const Cr=wa(Ke[vr],Ke[vr+1],Ue,Qe,Nt,mt);if(Cr>Oe)Fe=vr,Oe=Cr;else if(Cr===Oe){const Br=Math.abs(vr-ve);Br<et&&(Fe=vr,et=Br)}}Oe>ye&&(Fe-re>3&&Ki(Ke,re,Fe,ye),Ke[Fe+2]=Oe,oe-Fe>3&&Ki(Ke,Fe,oe,ye))}function wa(Ke,re,oe,ye,Oe,ve){let Fe=Oe-oe,et=ve-ye;if(Fe!==0||et!==0){const Ue=((Ke-oe)*Fe+(re-ye)*et)/(Fe*Fe+et*et);Ue>1?(oe=Oe,ye=ve):Ue>0&&(oe+=Fe*Ue,ye+=et*Ue)}return Fe=Ke-oe,et=re-ye,Fe*Fe+et*et}function $o(Ke,re,oe,ye){const Oe={id:Ke??null,type:re,geometry:oe,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(re==="Point"||re==="MultiPoint"||re==="LineString")fo(Oe,oe);else if(re==="Polygon")fo(Oe,oe[0]);else if(re==="MultiLineString")for(const ve of oe)fo(Oe,ve);else if(re==="MultiPolygon")for(const ve of oe)fo(Oe,ve[0]);return Oe}function fo(Ke,re){for(let oe=0;oe<re.length;oe+=3)Ke.minX=Math.min(Ke.minX,re[oe]),Ke.minY=Math.min(Ke.minY,re[oe+1]),Ke.maxX=Math.max(Ke.maxX,re[oe]),Ke.maxY=Math.max(Ke.maxY,re[oe+1])}function Ui(Ke,re,oe,ye){if(!re.geometry)return;const Oe=re.geometry.coordinates;if(Oe&&Oe.length===0)return;const ve=re.geometry.type,Fe=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2);let et=[],Ue=re.id;if(oe.promoteId?Ue=re.properties[oe.promoteId]:oe.generateId&&(Ue=ye||0),ve==="Point")Fo(Oe,et);else if(ve==="MultiPoint")for(const Qe of Oe)Fo(Qe,et);else if(ve==="LineString")Fa(Oe,et,Fe,!1);else if(ve==="MultiLineString"){if(oe.lineMetrics){for(const Qe of Oe)et=[],Fa(Qe,et,Fe,!1),Ke.push($o(Ue,"LineString",et,re.properties));return}Ms(Oe,et,Fe,!1)}else if(ve==="Polygon")Ms(Oe,et,Fe,!0);else{if(ve!=="MultiPolygon"){if(ve==="GeometryCollection"){for(const Qe of re.geometry.geometries)Ui(Ke,{id:Ue,geometry:Qe,properties:re.properties},oe,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Qe of Oe){const Nt=[];Ms(Qe,Nt,Fe,!0),et.push(Nt)}}Ke.push($o(Ue,ve,et,re.properties))}function Fo(Ke,re){re.push(Js(Ke[0]),la(Ke[1]),0)}function Fa(Ke,re,oe,ye){let Oe,ve,Fe=0;for(let Ue=0;Ue<Ke.length;Ue++){const Qe=Js(Ke[Ue][0]),Nt=la(Ke[Ue][1]);re.push(Qe,Nt,0),Ue>0&&(Fe+=ye?(Oe*Nt-Qe*ve)/2:Math.sqrt(Math.pow(Qe-Oe,2)+Math.pow(Nt-ve,2))),Oe=Qe,ve=Nt}const et=re.length-3;re[2]=1,Ki(re,0,et,oe),re[et+2]=1,re.size=Math.abs(Fe),re.start=0,re.end=re.size}function Ms(Ke,re,oe,ye){for(let Oe=0;Oe<Ke.length;Oe++){const ve=[];Fa(Ke[Oe],ve,oe,ye),re.push(ve)}}function Js(Ke){return Ke/360+.5}function la(Ke){const re=Math.sin(Ke*Math.PI/180),oe=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return oe<0?0:oe>1?1:oe}function Sa(Ke,re,oe,ye,Oe,ve,Fe,et){if(ye/=re,ve>=(oe/=re)&&Fe<ye)return Ke;if(Fe<oe||ve>=ye)return null;const Ue=[];for(const Qe of Ke){const Nt=Qe.geometry;let mt=Qe.type;const vr=Oe===0?Qe.minX:Qe.minY,Cr=Oe===0?Qe.maxX:Qe.maxY;if(vr>=oe&&Cr<ye){Ue.push(Qe);continue}if(Cr<oe||vr>=ye)continue;let Br=[];if(mt==="Point"||mt==="MultiPoint")Jl(Nt,Br,oe,ye,Oe);else if(mt==="LineString")Qs(Nt,Br,oe,ye,Oe,!1,et.lineMetrics);else if(mt==="MultiLineString")vo(Nt,Br,oe,ye,Oe,!1);else if(mt==="Polygon")vo(Nt,Br,oe,ye,Oe,!0);else if(mt==="MultiPolygon")for(const ln of Nt){const Jr=[];vo(ln,Jr,oe,ye,Oe,!0),Jr.length&&Br.push(Jr)}if(Br.length){if(et.lineMetrics&&mt==="LineString"){for(const ln of Br)Ue.push($o(Qe.id,mt,ln,Qe.tags));continue}mt!=="LineString"&&mt!=="MultiLineString"||(Br.length===1?(mt="LineString",Br=Br[0]):mt="MultiLineString"),mt!=="Point"&&mt!=="MultiPoint"||(mt=Br.length===3?"Point":"MultiPoint"),Ue.push($o(Qe.id,mt,Br,Qe.tags))}}return Ue.length?Ue:null}function Jl(Ke,re,oe,ye,Oe){for(let ve=0;ve<Ke.length;ve+=3){const Fe=Ke[ve+Oe];Fe>=oe&&Fe<=ye&&ts(re,Ke[ve],Ke[ve+1],Ke[ve+2])}}function Qs(Ke,re,oe,ye,Oe,ve,Fe){let et=el(Ke);const Ue=Oe===0?wl:tl;let Qe,Nt,mt=Ke.start;for(let Jr=0;Jr<Ke.length-3;Jr+=3){const cn=Ke[Jr],Yn=Ke[Jr+1],hn=Ke[Jr+2],Li=Ke[Jr+3],$n=Ke[Jr+4],to=Oe===0?cn:Yn,qn=Oe===0?Li:$n;let kn=!1;Fe&&(Qe=Math.sqrt(Math.pow(cn-Li,2)+Math.pow(Yn-$n,2))),to<oe?qn>oe&&(Nt=Ue(et,cn,Yn,Li,$n,oe),Fe&&(et.start=mt+Qe*Nt)):to>ye?qn<ye&&(Nt=Ue(et,cn,Yn,Li,$n,ye),Fe&&(et.start=mt+Qe*Nt)):ts(et,cn,Yn,hn),qn<oe&&to>=oe&&(Nt=Ue(et,cn,Yn,Li,$n,oe),kn=!0),qn>ye&&to<=ye&&(Nt=Ue(et,cn,Yn,Li,$n,ye),kn=!0),!ve&&kn&&(Fe&&(et.end=mt+Qe*Nt),re.push(et),et=el(Ke)),Fe&&(mt+=Qe)}let vr=Ke.length-3;const Cr=Ke[vr],Br=Ke[vr+1],ln=Oe===0?Cr:Br;ln>=oe&&ln<=ye&&ts(et,Cr,Br,Ke[vr+2]),vr=et.length-3,ve&&vr>=3&&(et[vr]!==et[0]||et[vr+1]!==et[1])&&ts(et,et[0],et[1],et[2]),et.length&&re.push(et)}function el(Ke){const re=[];return re.size=Ke.size,re.start=Ke.start,re.end=Ke.end,re}function vo(Ke,re,oe,ye,Oe,ve){for(const Fe of Ke)Qs(Fe,re,oe,ye,Oe,ve,!1)}function ts(Ke,re,oe,ye){Ke.push(re,oe,ye)}function wl(Ke,re,oe,ye,Oe,ve){const Fe=(ve-re)/(ye-re);return ts(Ke,ve,oe+(Oe-oe)*Fe,1),Fe}function tl(Ke,re,oe,ye,Oe,ve){const Fe=(ve-oe)/(Oe-oe);return ts(Ke,re+(ye-re)*Fe,ve,1),Fe}function Ql(Ke,re){const oe=[];for(let ye=0;ye<Ke.length;ye++){const Oe=Ke[ye],ve=Oe.type;let Fe;if(ve==="Point"||ve==="MultiPoint"||ve==="LineString")Fe=rl(Oe.geometry,re);else if(ve==="MultiLineString"||ve==="Polygon"){Fe=[];for(const et of Oe.geometry)Fe.push(rl(et,re))}else if(ve==="MultiPolygon"){Fe=[];for(const et of Oe.geometry){const Ue=[];for(const Qe of et)Ue.push(rl(Qe,re));Fe.push(Ue)}}oe.push($o(Oe.id,ve,Fe,Oe.tags))}return oe}function rl(Ke,re){const oe=[];oe.size=Ke.size,Ke.start!==void 0&&(oe.start=Ke.start,oe.end=Ke.end);for(let ye=0;ye<Ke.length;ye+=3)oe.push(Ke[ye]+re,Ke[ye+1],Ke[ye+2]);return oe}function eu(Ke,re){if(Ke.transformed)return Ke;const oe=1<<Ke.z,ye=Ke.x,Oe=Ke.y;for(const ve of Ke.features){const Fe=ve.geometry,et=ve.type;if(ve.geometry=[],et===1)for(let Ue=0;Ue<Fe.length;Ue+=2)ve.geometry.push(ii(Fe[Ue],Fe[Ue+1],re,oe,ye,Oe));else for(let Ue=0;Ue<Fe.length;Ue++){const Qe=[];for(let Nt=0;Nt<Fe[Ue].length;Nt+=2)Qe.push(ii(Fe[Ue][Nt],Fe[Ue][Nt+1],re,oe,ye,Oe));ve.geometry.push(Qe)}}return Ke.transformed=!0,Ke}function ii(Ke,re,oe,ye,Oe,ve){return[Math.round(oe*(Ke*ye-Oe)),Math.round(oe*(re*ye-ve))]}function Gu(Ke,re,oe,ye,Oe){const ve=re===Oe.maxZoom?0:Oe.tolerance/((1<<re)*Oe.extent),Fe={features:[],numPoints:0,numSimplified:0,numFeatures:Ke.length,source:null,x:oe,y:ye,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const et of Ke)Hu(Fe,et,ve,Oe);return Fe}function Hu(Ke,re,oe,ye){const Oe=re.geometry,ve=re.type,Fe=[];if(Ke.minX=Math.min(Ke.minX,re.minX),Ke.minY=Math.min(Ke.minY,re.minY),Ke.maxX=Math.max(Ke.maxX,re.maxX),Ke.maxY=Math.max(Ke.maxY,re.maxY),ve==="Point"||ve==="MultiPoint")for(let et=0;et<Oe.length;et+=3)Fe.push(Oe[et],Oe[et+1]),Ke.numPoints++,Ke.numSimplified++;else if(ve==="LineString")qo(Fe,Oe,Ke,oe,!1,!1);else if(ve==="MultiLineString"||ve==="Polygon")for(let et=0;et<Oe.length;et++)qo(Fe,Oe[et],Ke,oe,ve==="Polygon",et===0);else if(ve==="MultiPolygon")for(let et=0;et<Oe.length;et++){const Ue=Oe[et];for(let Qe=0;Qe<Ue.length;Qe++)qo(Fe,Ue[Qe],Ke,oe,!0,Qe===0)}if(Fe.length){let et=re.tags||null;if(ve==="LineString"&&ye.lineMetrics){et={};for(const Qe in re.tags)et[Qe]=re.tags[Qe];et.mapbox_clip_start=Oe.start/Oe.size,et.mapbox_clip_end=Oe.end/Oe.size}const Ue={geometry:Fe,type:ve==="Polygon"||ve==="MultiPolygon"?3:ve==="LineString"||ve==="MultiLineString"?2:1,tags:et};re.id!==null&&(Ue.id=re.id),Ke.features.push(Ue)}}function qo(Ke,re,oe,ye,Oe,ve){const Fe=ye*ye;if(ye>0&&re.size<(Oe?Fe:ye))return void(oe.numPoints+=re.length/3);const et=[];for(let Ue=0;Ue<re.length;Ue+=3)(ye===0||re[Ue+2]>Fe)&&(oe.numSimplified++,et.push(re[Ue],re[Ue+1])),oe.numPoints++;Oe&&(function(Ue,Qe){let Nt=0;for(let mt=0,vr=Ue.length,Cr=vr-2;mt<vr;Cr=mt,mt+=2)Nt+=(Ue[mt]-Ue[Cr])*(Ue[mt+1]+Ue[Cr+1]);if(Nt>0===Qe)for(let mt=0,vr=Ue.length;mt<vr/2;mt+=2){const Cr=Ue[mt],Br=Ue[mt+1];Ue[mt]=Ue[vr-2-mt],Ue[mt+1]=Ue[vr-1-mt],Ue[vr-2-mt]=Cr,Ue[vr-1-mt]=Br}})(et,ve),Ke.push(et)}const nl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Kf{constructor(re,oe){const ye=(oe=this.options=(function(ve,Fe){for(const et in Fe)ve[et]=Fe[et];return ve})(Object.create(nl),oe)).debug;if(ye&&console.time("preprocess data"),oe.maxZoom<0||oe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(oe.promoteId&&oe.generateId)throw new Error("promoteId and generateId cannot be used together.");let Oe=(function(ve,Fe){const et=[];if(ve.type==="FeatureCollection")for(let Ue=0;Ue<ve.features.length;Ue++)Ui(et,ve.features[Ue],Fe,Ue);else Ui(et,ve.type==="Feature"?ve:{geometry:ve},Fe);return et})(re,oe);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",oe.indexMaxZoom,oe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Oe=(function(ve,Fe){const et=Fe.buffer/Fe.extent;let Ue=ve;const Qe=Sa(ve,1,-1-et,et,0,-1,2,Fe),Nt=Sa(ve,1,1-et,2+et,0,-1,2,Fe);return(Qe||Nt)&&(Ue=Sa(ve,1,-et,1+et,0,-1,2,Fe)||[],Qe&&(Ue=Ql(Qe,1).concat(Ue)),Nt&&(Ue=Ue.concat(Ql(Nt,-1)))),Ue})(Oe,oe),Oe.length&&this.splitTile(Oe,0,0,0),ye&&(Oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(re,oe,ye,Oe,ve,Fe,et){const Ue=[re,oe,ye,Oe],Qe=this.options,Nt=Qe.debug;for(;Ue.length;){Oe=Ue.pop(),ye=Ue.pop(),oe=Ue.pop(),re=Ue.pop();const mt=1<<oe,vr=Wu(oe,ye,Oe);let Cr=this.tiles[vr];if(!Cr&&(Nt>1&&console.time("creation"),Cr=this.tiles[vr]=Gu(re,oe,ye,Oe,Qe),this.tileCoords.push({z:oe,x:ye,y:Oe}),Nt)){Nt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",oe,ye,Oe,Cr.numFeatures,Cr.numPoints,Cr.numSimplified),console.timeEnd("creation"));const kn=`z${oe}`;this.stats[kn]=(this.stats[kn]||0)+1,this.total++}if(Cr.source=re,ve==null){if(oe===Qe.indexMaxZoom||Cr.numPoints<=Qe.indexMaxPoints)continue}else{if(oe===Qe.maxZoom||oe===ve)continue;if(ve!=null){const kn=ve-oe;if(ye!==Fe>>kn||Oe!==et>>kn)continue}}if(Cr.source=null,re.length===0)continue;Nt>1&&console.time("clipping");const Br=.5*Qe.buffer/Qe.extent,ln=.5-Br,Jr=.5+Br,cn=1+Br;let Yn=null,hn=null,Li=null,$n=null,to=Sa(re,mt,ye-Br,ye+Jr,0,Cr.minX,Cr.maxX,Qe),qn=Sa(re,mt,ye+ln,ye+cn,0,Cr.minX,Cr.maxX,Qe);re=null,to&&(Yn=Sa(to,mt,Oe-Br,Oe+Jr,1,Cr.minY,Cr.maxY,Qe),hn=Sa(to,mt,Oe+ln,Oe+cn,1,Cr.minY,Cr.maxY,Qe),to=null),qn&&(Li=Sa(qn,mt,Oe-Br,Oe+Jr,1,Cr.minY,Cr.maxY,Qe),$n=Sa(qn,mt,Oe+ln,Oe+cn,1,Cr.minY,Cr.maxY,Qe),qn=null),Nt>1&&console.timeEnd("clipping"),Ue.push(Yn||[],oe+1,2*ye,2*Oe),Ue.push(hn||[],oe+1,2*ye,2*Oe+1),Ue.push(Li||[],oe+1,2*ye+1,2*Oe),Ue.push($n||[],oe+1,2*ye+1,2*Oe+1)}}getTile(re,oe,ye){re=+re,oe=+oe,ye=+ye;const Oe=this.options,{extent:ve,debug:Fe}=Oe;if(re<0||re>24)return null;const et=1<<re,Ue=Wu(re,oe=oe+et&et-1,ye);if(this.tiles[Ue])return eu(this.tiles[Ue],ve);Fe>1&&console.log("drilling down to z%d-%d-%d",re,oe,ye);let Qe,Nt=re,mt=oe,vr=ye;for(;!Qe&&Nt>0;)Nt--,mt>>=1,vr>>=1,Qe=this.tiles[Wu(Nt,mt,vr)];return Qe&&Qe.source?(Fe>1&&(console.log("found parent tile z%d-%d-%d",Nt,mt,vr),console.time("drilling down")),this.splitTile(Qe.source,Nt,mt,vr,re,oe,ye),Fe>1&&console.timeEnd("drilling down"),this.tiles[Ue]?eu(this.tiles[Ue],ve):null):null}}function Wu(Ke,re,oe){return 32*((1<<Ke)*oe+re)+Ke}function Ct(Ke,re){const oe=Ke.tileID.canonical;if(!this._geoJSONIndex)return void re(null,null);const ye=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!ye)return void re(null,null);const Oe=Qe=>Qe.tags&&"3d_elevation_id"in Qe.tags&&"source"in Qe.tags&&Qe.tags.source==="elevation",ve=ye.features.filter((Qe=>Oe(Qe)));let Fe={_geojsonTileLayer:ye.features};ve.length>0&&(Fe={_geojsonTileLayer:ye.features.filter((Qe=>!Oe(Qe))),hd_road_elevation:ve});const et=new ze(Fe),Ue=(function(Qe){const Nt=new a.bq;for(const mt of Object.keys(Qe))Nt.writeMessage(3,lt,{name:mt,features:Qe[mt]});return Nt.finish()})(Fe).buffer;re(null,{vectorTile:et,rawData:Ue})}class il extends ne{constructor(re,oe,ye,Oe,ve,Fe,et){super(re,oe,ye,Oe,ve,Ct,et),Fe&&(this.loadGeoJSON=Fe),this._dynamicIndex=new kt}loadData(re,oe){const ye=re&&re.request,Oe=ye&&ye.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(re,((ve,Fe)=>{if(ve||!Fe)return oe(ve);if(typeof Fe!="object")return oe(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));{try{if(re.filter){const Ue=a.X(re.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ue.result==="error")throw new Error(Ue.value.map((Qe=>`${Qe.key}: ${Qe.message}`)).join(", "));Fe.features=Fe.features.filter((Qe=>Ue.value.evaluate({zoom:0},Qe)))}re.dynamic?(Fe.type==="Feature"&&(Fe={type:"FeatureCollection",features:[Fe]}),re.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Fe.features,this.loaded),re.cluster&&(Fe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=re.cluster?new pn((function({superclusterOptions:Ue,clusterProperties:Qe}){if(!Qe||!Ue)return Ue;const Nt={},mt={},vr={accumulated:null,zoom:0},Cr={properties:null},Br=Object.keys(Qe);for(const ln of Br){const[Jr,cn]=Qe[ln],Yn=a.X(cn),hn=a.X(typeof Jr=="string"?[Jr,["accumulated"],["get",ln]]:Jr);Nt[ln]=Yn.value,mt[ln]=hn.value}return Ue.map=ln=>{Cr.properties=ln;const Jr={};for(const cn of Br)Jr[cn]=Nt[cn].evaluate(vr,Cr);return Jr},Ue.reduce=(ln,Jr)=>{Cr.properties=Jr;for(const cn of Br)vr.accumulated=ln[cn],ln[cn]=mt[cn].evaluate(vr,Cr)},Ue})(re)).load(Fe.features):re.dynamic?this._dynamicIndex:(function(Ue,Qe){return new Kf(Ue,Qe)})(Fe,re.geojsonVtOptions)}catch(Ue){return oe(Ue)}const et={};if(Oe){const Ue=R(ye);Ue&&(et.resourceTiming={},et.resourceTiming[re.source]=JSON.parse(JSON.stringify(Ue)))}oe(null,et)}}))}reloadTile(re,oe){const ye=this.loaded;return ye&&ye[re.uid]?re.partial?oe(null,void 0):super.reloadTile(re,oe):this.loadTile(re,oe)}loadGeoJSON(re,oe){if(re.request)a.n(re.request,oe);else{if(typeof re.data!="string")return oe(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return oe(null,JSON.parse(re.data))}catch{return oe(new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(re,oe){try{oe(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(ye){oe(ye)}}getClusterChildren(re,oe){try{oe(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(ye){oe(ye)}}getClusterLeaves(re,oe){try{oe(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(ye){oe(ye)}}}class Yf{constructor(re,oe,ye){this.tileID=new a.aM(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.tileZoom=re.tileZoom,this.uid=re.uid,this.zoom=re.zoom,this.canonical=re.tileID.canonical,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=re.projection,this.brightness=oe,this.worldview=ye}parse(re,oe,ye,Oe){this.status="parsing";const ve=new a.aM(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),Fe=[],et=oe.familiesBySource[ye.source],Ue=new a.fc(ve,ye.promoteId);Ue.bucketLayerIDs=[],Ue.is3DTile=!0,a.fr(re).then((Qe=>{if(!Qe)return Oe(new Error("Could not parse tile"));const Nt=Qe.json.extensionsUsed&&Qe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Qe.json.asset.extras&&Qe.json.asset.extras.MAPBOX_mesh_features,mt=Qe.json.extensionsUsed&&Qe.json.extensionsUsed.includes("EXT_meshopt_compression"),vr=new a.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Cr in et)for(const Br of et[Cr]){const ln=Br[0];Ue.bucketLayerIDs.push(Br.map((Yn=>a.C(Yn.id,Yn.scope)))),ln.recalculate(vr,[]);const Jr=a.fs(Qe,1/a.d4(ye.tileID.canonical)),cn=new a.ft(Br,Jr,ve,Nt,mt,this.brightness,Ue,this.worldview);Nt||(cn.needsUpload=!0),Fe.push(cn),cn.evaluate(ln)}this.status="done",Oe(null,{buckets:Fe,featureIndex:Ue,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((Qe=>Oe(new Error(Qe.message))))}}class Zu{constructor(re,oe,ye,Oe,ve,Fe,et,Ue){this.actor=re,this.layerIndex=oe,this.availableImages=ye,this.availableModels=Oe,this.brightness=et,this.loading={},this.loaded={},this.worldview=Ue}loadTile(re,oe){const ye=re.uid,Oe=this.loading[ye]=new Yf(re,this.brightness,this.worldview);a.br(re.request,((ve,Fe)=>{const et=!this.loading[ye];return delete this.loading[ye],et||ve?(Oe.status="done",et||(this.loaded[ye]=Oe),oe(ve)):Fe&&Fe.byteLength!==0?void Oe.parse(Fe,this.layerIndex,re,((Ue,Qe)=>{Oe.status="done",this.loaded=this.loaded||{},this.loaded[ye]=Oe,Ue||!Qe?oe(Ue):oe(null,Qe)})):(Oe.status="done",this.loaded[ye]=Oe,oe())}))}reloadTile(re,oe){const ye=this.loaded,Oe=re.uid;if(ye&&ye[Oe]){const ve=ye[Oe];ve.projection=re.projection,ve.brightness=re.brightness;const Fe=(et,Ue)=>{ve.reloadCallback&&(delete ve.reloadCallback,this.loadTile(re,oe)),oe(et,Ue)};ve.status==="parsing"?ve.reloadCallback=Fe:ve.status==="done"&&this.loadTile(re,oe)}}abortTile(re,oe){const ye=re.uid;this.loading[ye]&&delete this.loading[ye],oe()}removeTile(re,oe){const ye=this.loaded,Oe=re.uid;ye&&ye[Oe]&&delete ye[Oe],oe()}}class Cn{constructor(re){this.self=re,this.actor=new a.fv(re,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new a.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=a.cj({name:"mercator"}),this.workerSourceTypes={vector:ne,geojson:il,"raster-dem":de,"raster-array":be,"batched-model":Zu},this.workerSources={},this.self.registerWorkerSource=(oe,ye)=>{if(this.workerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.workerSourceTypes[oe]=ye},this.self.registerRTLTextPlugin=oe=>{if(a.fw.isParsed())throw new Error("RTL text plugin already registered.");a.fw.setState({pluginStatus:a.fx.parsed,pluginURL:a.fw.getPluginURL()}),a.fw.applyArabicShaping=oe.applyArabicShaping,a.fw.processBidirectionalText=oe.processBidirectionalText,a.fw.processStyledBidirectionalText=oe.processStyledBidirectionalText;for(const ye of this.rtlPluginParsingListeners)ye(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(re,oe,ye){delete this.layerIndexes[re],delete this.availableImages[re],delete this.availableModels[re],delete this.workerSources[re],ye()}checkIfReady(re,oe,ye){ye()}setReferrer(re,oe){this.referrer=oe}spriteLoaded(re,oe){this.isSpriteLoaded[re]||(this.isSpriteLoaded[re]={});const{scope:ye,isLoaded:Oe}=oe;if(this.isSpriteLoaded[re][ye]=Oe,this.workerSources[re]&&this.workerSources[re][ye])for(const ve in this.workerSources[re][ye]){const Fe=this.workerSources[re][ye][ve];for(const et in Fe){const Ue=Fe[et];Ue instanceof ne&&(Ue.isSpriteLoaded=Oe,Ue.fire(new a.A("isSpriteLoaded")))}}}setImages(re,oe,ye){this.availableImages[re]||(this.availableImages[re]={});const{scope:Oe,images:ve}=oe;if(this.availableImages[re][Oe]=ve,this.workerSources[re]&&this.workerSources[re][Oe]){for(const Fe in this.workerSources[re][Oe]){const et=this.workerSources[re][Oe][Fe];for(const Ue in et)et[Ue].availableImages=ve}ye()}else ye()}setModels(re,{scope:oe,models:ye},Oe){if(this.availableModels[re]||(this.availableModels[re]={}),this.availableModels[re][oe]=ye,this.workerSources[re]&&this.workerSources[re][oe]){for(const ve in this.workerSources[re][oe]){const Fe=this.workerSources[re][oe][ve];for(const et in Fe)Fe[et].availableModels=ye}Oe()}else Oe()}setProjection(re,oe){this.projections[re]=a.cj(oe)}setBrightness(re,oe,ye){this.brightness=oe,ye()}setWorldview(re,oe,ye){this.worldview=oe,ye()}setLayers(re,oe,ye){this.getLayerIndex(re,oe.scope).replace(oe.layers,oe.options),ye()}updateLayers(re,oe,ye){this.getLayerIndex(re,oe.scope).update(oe.layers,oe.removedIds,oe.options),ye()}loadTile(re,oe,ye){oe.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,oe.type,oe.source,oe.scope).loadTile(oe,ye)}decodeRasterArray(re,oe,ye){this.getWorkerSource(re,oe.type,oe.source,oe.scope).decodeRasterArray(oe,ye)}reloadTile(re,oe,ye){oe.projection=this.projections[re]||this.defaultProjection,this.getWorkerSource(re,oe.type,oe.source,oe.scope).reloadTile(oe,ye)}abortTile(re,oe,ye){this.getWorkerSource(re,oe.type,oe.source,oe.scope).abortTile(oe,ye)}removeTile(re,oe,ye){this.getWorkerSource(re,oe.type,oe.source,oe.scope).removeTile(oe,ye)}removeSource(re,oe,ye){if(!(this.workerSources[re]&&this.workerSources[re][oe.scope]&&this.workerSources[re][oe.scope][oe.type]&&this.workerSources[re][oe.scope][oe.type][oe.source]))return;const Oe=this.workerSources[re][oe.scope][oe.type][oe.source];delete this.workerSources[re][oe.scope][oe.type][oe.source],Oe.removeSource!==void 0?Oe.removeSource(oe,ye):ye()}loadWorkerSource(re,oe,ye){try{this.self.importScripts(oe.url),ye()}catch(Oe){ye(Oe.toString())}}syncRTLPluginState(re,oe,ye){if(a.fw.isParsed())ye(null,!0);else if(a.fw.isParsing())this.rtlPluginParsingListeners.push(ye);else try{a.fw.setState(oe);const Oe=a.fw.getPluginURL();!a.fw.isLoaded()||a.fw.isParsed()||a.fw.isParsing()||Oe==null||(a.fw.setState({pluginStatus:a.fx.parsing,pluginURL:a.fw.getPluginURL()}),this.self.importScripts(Oe),a.fw.isParsed()?ye(null,!0):this.rtlPluginParsingListeners.push(ye))}catch(Oe){ye(Oe.toString())}}setDracoUrl(re,oe){this.dracoUrl=oe}getAvailableImages(re,oe){this.availableImages[re]||(this.availableImages[re]={});let ye=this.availableImages[re][oe];return ye||(ye=[]),ye}getAvailableModels(re,oe){this.availableModels[re]||(this.availableModels[re]={});let ye=this.availableModels[re][oe];return ye||(ye={}),ye}getLayerIndex(re,oe){this.layerIndexes[re]||(this.layerIndexes[re]={});let ye=this.layerIndexes[re][oe];return ye||(ye=this.layerIndexes[re][oe]=new V,ye.scope=oe),ye}getWorkerSource(re,oe,ye,Oe){const ve=this.workerSources;return ve[re]||(ve[re]={}),ve[re][Oe]||(ve[re][Oe]={}),ve[re][Oe][oe]||(ve[re][Oe][oe]={}),this.isSpriteLoaded[re]||(this.isSpriteLoaded[re]={}),ve[re][Oe][oe][ye]||(ve[re][Oe][oe][ye]=new this.workerSourceTypes[oe]({send:(Fe,et,Ue,Qe,Nt,mt)=>this.actor.send(Fe,et,Ue,re,Nt,mt),scheduler:this.actor.scheduler},this.getLayerIndex(re,Oe),this.getAvailableImages(re,Oe),this.getAvailableModels(re,Oe),this.isSpriteLoaded[re][Oe],void 0,this.brightness,this.worldview)),ve[re][Oe][oe][ye]}rasterizeImagesWorker(re,oe,ye){const Oe=new Map;for(const[ve,{image:Fe,imageVariant:et}]of oe.tasks.entries()){const Ue=this.imageRasterizer.rasterize(et,Fe,oe.scope,re);Oe.set(ve,Ue)}ye(void 0,Oe)}removeRasterizedImages(re,oe,ye){this.imageRasterizer.removeImagesFromCacheByIds(oe.imageIds,oe.scope,re),ye()}enforceCacheSizeLimit(re,oe){a.fy(oe)}getWorkerPerformanceMetrics(re,oe,ye){ye(void 0,void 0)}}return a.fu(self)&&(self.worker=new Cn(self)),Cn})),w(["./shared"],(function(a){var R="3.14.0";const z={create:"create",load:"load",fullLoad:"fullLoad"},$={mark(f){performance.mark(f)},measure(f,t,s){performance.measure(f,t,s)}};function V(f){const t=f.name.split("?")[0];return a.a(t)&&t.includes("mapbox-gl.js")?"javascript":a.a(t)&&t.includes("mapbox-gl.css")?"css":a.b(t)?"fontRange":a.c(t)?"sprite":a.i(t)?"style":a.d(t)?"tilejson":"other"}var W,ie={},ae=(function(){if(W)return ie;function f(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,S,E=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(E);try{S=new Worker(C),v=!0}catch{v=!1}return S&&S.terminate(),URL.revokeObjectURL(C),v})()?(function(){var v=document.createElement("canvas");v.width=v.height=1;var S=v.getContext("2d");if(!S)return!1;var E=S.getImageData(0,0,1,1);return E&&E.width===v.width})()?(s[_=d&&d.failIfMajorPerformanceCaveat]===void 0&&(s[_]=(function(v){var S,E=(function(C){var k=document.createElement("canvas"),L=Object.create(f.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=C,k.getContext("webgl2",L)})(v);if(!E)return!1;try{S=E.createShader(E.VERTEX_SHADER)}catch{return!1}return!(!S||E.isContextLost())&&(E.shaderSource(S,"void main() {}"),E.compileShader(S),E.getShaderParameter(S,E.COMPILE_STATUS)===!0)})(_)),s[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}W=1,ie.supported=f,ie.notSupportedReason=t;var s={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ie})();function ee(f,t,s){const d=document.createElement(f);return t!=null&&(d.className=t),s&&s.appendChild(d),d}function ne(f,t,s){const d=document.createElementNS("http://www.w3.org/2000/svg",f);for(const _ of Object.keys(t))d.setAttributeNS(null,_,String(t[_]));return s&&s.appendChild(d),d}const de=typeof document<"u"?document.documentElement&&document.documentElement.style:null,xe=de&&de.userSelect!==void 0?"userSelect":"WebkitUserSelect";let be;function ke(){de&&xe&&(be=de[xe],de[xe]="none")}function he(){de&&xe&&(de[xe]=be)}function _e(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",_e,!0)}function ze(){window.addEventListener("click",_e,!0),window.setTimeout((()=>{window.removeEventListener("click",_e,!0)}),0)}function Ne(f,t){const s=f.getBoundingClientRect();return He(f,s,t)}function rt(f,t){const s=f.getBoundingClientRect(),d=[];for(let _=0;_<t.length;_++)d.push(He(f,s,t[_]));return d}function kt(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function He(f,t,s){const d=f.offsetWidth===t.width?1:f.offsetWidth/t.width;return new a.P((s.clientX-t.left)*d,(s.clientY-t.top)*d)}const yt="01",gt="NO_ACCESS_TOKEN";class Pt{constructor(t,s,d){this._transformRequestFn=t,this._customAccessToken=s,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const t=(function(){let s="";for(let d=0;d<10;d++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",yt,s].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeStyleURL(t,s){if(!a.j(t))return t;const d=Tt(t);return d.params.push(`sdk=js-${R}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||s)}normalizeGlyphsURL(t,s){if(!a.j(t))return t;const d=Tt(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||s)}normalizeModelURL(t,s){if(!a.j(t))return t;const d=Tt(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||s)}normalizeSourceURL(t,s,d,_){if(!a.j(t))return t;const v=Tt(t);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),d&&v.params.push(`language=${d}`),_&&v.params.push(`worldview=${_}`),this._makeAPIURL(v,this._customAccessToken||s)}normalizeIconsetURL(t,s){const d=Tt(t);return a.j(t)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||s)):Ht(d)}normalizeSpriteURL(t,s,d,_){const v=Tt(t);return a.j(t)?(v.path=`/styles/v1${v.path}/sprite${s}${d}`,this._makeAPIURL(v,this._customAccessToken||_)):(v.path+=`${s}${d}`,Ht(v))}normalizeTileURL(t,s,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!a.j(t))return t;const _=Tt(t);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||d&&_.authority!=="raster"&&d===512?"@2x":""}${a.l.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${a.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${a.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${a.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${a.e.TILE_URL_VERSION}${_.path}`);const v=this._customAccessToken||(function(S){for(const E of S){const C=E.match(/^access_token=(.*)$/);if(C)return C[1]}return null})(_.params)||a.e.ACCESS_TOKEN;return a.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,v)}canonicalizeTileURL(t,s){const d=Tt(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let _="mapbox://";d.path.match(/^\/raster\/v1\//)?_+=`raster/${d.path.replace(`/${a.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${d.path.replace(`/${a.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${d.path.replace(`/${a.e.TILE_URL_VERSION}/`,"")}`;let v=d.params;return s&&(v=v.filter((S=>!S.match(/^access_token=/)))),v.length&&(_+=`?${v.join("&")}`),_}canonicalizeTileset(t,s){const d=!!s&&a.j(s),_=[];for(const v of t.tiles||[])a.k(v)?_.push(this.canonicalizeTileURL(v,d)):_.push(v);return _}_makeAPIURL(t,s){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=Tt(a.e.API_URL);if(t.protocol=_.protocol,t.authority=_.authority,t.protocol==="http"){const v=t.params.indexOf("secure");v>=0&&t.params.splice(v,1)}if(_.path!=="/"&&(t.path=`${_.path}${t.path}`),!a.e.REQUIRE_ACCESS_TOKEN)return Ht(t);if(s=s||a.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter((v=>v.indexOf("access_token")===-1)),t.params.push(`access_token=${s||""}`),Ht(t)}}const xt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Tt(f){const t=f.match(xt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ht(f){const t=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${t}`}const lt="mapbox.eventData";function Wt(f){if(!f)return null;const t=f.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(a.m(t[1]))}catch{return null}}class Zt{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=Wt(a.e.ACCESS_TOKEN);let d="";return d=s&&s.u?a.f(s.u):a.e.ACCESS_TOKEN||"",t?`${lt}.${t}:${d}`:`${lt}:${d}`}fetchEventData(){const t=a.s("localStorage"),s=this.getStorageKey(),d=this.getStorageKey("uuid");if(t)try{const _=localStorage.getItem(s);_&&(this.eventData=JSON.parse(_));const v=localStorage.getItem(d);v&&(this.anonId=v)}catch{a.w("Unable to read from LocalStorage")}}saveEventData(){const t=a.s("localStorage"),s=this.getStorageKey(),d=this.getStorageKey("uuid"),_=this.anonId;if(t&&_)try{localStorage.setItem(d,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{a.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,d,_){if(!a.e.EVENTS_URL)return;const v=Tt(a.e.EVENTS_URL);v.params.push(`access_token=${_||a.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(t).toISOString()},E=s?a.h(S,s):S,C={url:Ht(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([E])};this.pendingRequest=a.p(C,(k=>{this.pendingRequest=null,d(k),this.saveEventData(),this.processRequests(_)}))}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}const $e=new class extends Zt{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,t){a.e.EVENTS_URL&&a.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some((s=>a.j(s)||a.k(s)))&&this.queueRequest(Date.now(),t)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Wt(a.e.ACCESS_TOKEN),s=t?t.u:a.e.ACCESS_TOKEN;let d=s!==this.eventData.tokenU;a.v(this.anonId)||(this.anonId=a.u(),d=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const v=new Date(this.eventData.lastSuccess),S=new Date(_),E=(_-this.eventData.lastSuccess)/864e5;d=d||E>=1||E<-1||v.getDate()!==S.getDate()}else d=!0;d?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:yt,"enabled.telemetry":!1,userId:this.anonId},(v=>{v||(this.eventData.lastSuccess=_,this.eventData.tokenU=s)}),f):this.processRequests()}},pt=$e.postTurnstileEvent.bind($e),fr=new class extends Zt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,t,s,d){this.skuToken=t,this.errorCb=d,a.e.EVENTS_URL&&(s||a.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},s):this.errorCb(new Error(gt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),a.v(this.anonId)||(this.anonId=a.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:yt,skuToken:this.skuToken,userId:this.anonId},(d=>{d?this.errorCb(d):t&&(this.success[t]=!0)}),f))}remove(){this.errorCb=null}},zr=fr.postMapLoadEvent.bind(fr),Hr=new class extends Zt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let t=this.mapInstanceIdMap.get(f);return t||(t=a.u(),this.mapInstanceIdMap.set(f,t)),t}getEventId(f){const t=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,t+1),t}postStyleLoadEvent(f,t){const{map:s,style:d,importedStyles:_}=t;if(!a.e.EVENTS_URL||!f&&!a.e.ACCESS_TOKEN)return;const v=this.getMapInstanceId(s),S={mapInstanceId:v,eventId:this.getEventId(v),style:d};_.length&&(S.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:S},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:s}=this.queue.shift();this.postEvent(t,s,(()=>{}),f)}},Ir=Hr.postStyleLoadEvent.bind(Hr),Lr=new class extends Zt{constructor(){super("gljs.performance")}postPerformanceEvent(f,t){a.e.EVENTS_URL&&(f||a.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:s}=this.queue.shift(),d=(function(_){const v=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),E=(function(q){const K={};if(q){for(const Z in q)if(Z!=="other")for(const J of q[Z]){const Y=`${Z}ResolveRangeMin`,se=`${Z}ResolveRangeMax`,ce=`${Z}RequestCount`,pe=`${Z}RequestCachedCount`;K[Y]=Math.min(K[Y]||1/0,J.startTime),K[se]=Math.max(K[se]||-1/0,J.responseEnd);const Se=Pe=>{K[Pe]===void 0&&(K[Pe]=0),++K[Pe]};J.transferSize!==void 0&&J.transferSize===0&&Se(pe),Se(ce)}}return K})((function(q,K){const Z={};if(q)for(const J of q){const Y=K(J);Z[Y]===void 0&&(Z[Y]=[]),Z[Y].push(J)}return Z})(v,V)),C=window.devicePixelRatio,k=navigator.connection||navigator.mozConnection||navigator.webkitConnection,L=k?k.effectiveType:void 0,j={counters:[],metadata:[],attributes:[]},B=(q,K,Z)=>{Z!=null&&q.push({name:K,value:Z.toString()})};for(const q in E)B(j.counters,q,E[q]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(B(j.counters,"interactionRangeMin",_.interactionRange[0]),B(j.counters,"interactionRangeMax",_.interactionRange[1])),S)for(const q of Object.keys(z)){const K=z[q],Z=S.find((J=>J.name===K));Z&&B(j.counters,K,Z.startTime)}return B(j.counters,"visibilityHidden",_.visibilityHidden),B(j.attributes,"style",(function(q){if(q)for(const K of q){const Z=K.name.split("?")[0];if(a.i(Z)){const J=Z.split("/").slice(-2);if(J.length===2)return`mapbox://styles/${J[0]}/${J[1]}`}}})(v)),B(j.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),B(j.attributes,"fogEnabled",_.fogEnabled?"true":"false"),B(j.attributes,"projection",_.projection),B(j.attributes,"zoom",_.zoom),B(j.metadata,"devicePixelRatio",C),B(j.metadata,"connectionEffectiveType",L),B(j.metadata,"navigatorUserAgent",navigator.userAgent),B(j.metadata,"screenWidth",window.screen.width),B(j.metadata,"screenHeight",window.screen.height),B(j.metadata,"windowWidth",window.innerWidth),B(j.metadata,"windowHeight",window.innerHeight),B(j.metadata,"mapWidth",_.width/C),B(j.metadata,"mapHeight",_.height/C),B(j.metadata,"webglRenderer",_.renderer),B(j.metadata,"webglVendor",_.vendor),B(j.metadata,"sdkVersion",R),B(j.metadata,"sdkIdentifier","mapbox-gl-js"),j})(s);for(const _ of d.metadata);for(const _ of d.counters);for(const _ of d.attributes);this.postEvent(t,d,(()=>{}),f)}},Ur=Lr.postPerformanceEvent.bind(Lr),or=new class extends Zt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,t,s,d){if(!a.e.API_URL||!a.e.SESSION_PATH)return;const _=Tt(a.e.API_URL+a.e.SESSION_PATH);_.params.push(`sku=${t||""}`),_.params.push(`access_token=${d||a.e.ACCESS_TOKEN||""}`);const v={url:Ht(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=a.g(v,(S=>{this.pendingRequest=null,s(S),this.saveEventData(),this.processRequests(d)}))}getSessionAPI(f,t,s,d){this.skuToken=t,this.errorCb=d,a.e.SESSION_PATH&&a.e.API_URL&&(s||a.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},s):this.errorCb(new Error(gt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,(d=>{d?this.errorCb(d):t&&(this.success[t]=!0)}),f)}remove(){this.errorCb=null}},Er=or.getSessionAPI.bind(or),pn=new Set;function sr(f,t){t?pn.add(f):pn.delete(f)}class Pi{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,s){this._updatedSourceCaches[t]=s,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const s=t.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(t.id),this.setDirty()}removeLayer(t){const s=t.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][t.id]=t,this._updatedLayers[s].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const s in this._updatedLayers)t[s]=t[s]||{},t[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)t[s]=t[s]||{},t[s].removedIds=Object.keys(this._removedLayers[s]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,s){this._updatedImages[s]=this._updatedImages[s]||new Set,this._updatedImages[s].add(a.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Rn(f){const{userImage:t}=f;return!!(t&&t.render&&t.render())&&(f.data.replace(new Uint8Array(t.data.buffer)),!0)}class In extends a.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&a.t()&&(this.imageRasterizerDispatcher=new a.D(a.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new a.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const s=this.atlasTexture.get(t);s&&(s.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,s){this.imageProviders.has(s)||this.imageProviders.set(s,new Map),this.imageProviders.get(s).set(t.id,t)}removeImageProvider(t,s){this.imageProviders.has(s)&&this.imageProviders.get(s).delete(t)}getPendingImageProviders(){const t=[];for(const s of this.imageProviders.values())for(const d of s.values())d.hasPendingRequests()&&t.push(d);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new a.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,s){if(this.loaded.get(s)!==t&&(this.loaded.set(s,t),t)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,s,_);this.requestors=[]}}hasImage(t,s){return!!this.getImage(t,s)}getImage(t,s){return this.images.get(s).get(t.toString())}addImage(t,s,d){this._validate(t,d)&&this.images.get(s).set(t.toString(),d)}_validate(t,s){let d=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new a.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),d=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new a.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),d=!1),this._validateContent(s.content,s)||(this.fire(new a.z(new Error(`Image "${t.name}" has invalid "content" value`))),d=!1),d}_validateStretch(t,s){if(!t)return!0;let d=0;for(const _ of t){if(_[0]<d||_[1]<_[0]||s<_[1])return!1;d=_[1]}return!0}_validateContent(t,s){return t?t.length!==4||!s.usvg&&(t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,s,d){const _=this.images.get(s).get(t.toString());d.version=_.version+1,this.images.get(s).set(t.toString(),d),this.updatedImages.get(s).add(t),this.removeFromImageRasterizerCache(t,s)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,s){this.spriteFormat!=="raster"&&(a.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:s}):this.imageRasterizer.removeImagesFromCacheByIds([t],s))}removeImage(t,s){const d=this.images.get(s),_=d.get(t.toString());d.delete(t.toString()),this.patterns.get(s).delete(t.toString()),this.removeFromImageRasterizerCache(t,s),_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map((s=>a.I.from(s)))}getImages(t,s,d){const _=[],v=[],S=this.imageProviders.get(s);for(const L of t){if(!L.iconsetId){_.push(L);continue}const j=S.get(L.iconsetId);j&&(this.getImage(L,s)?v.push(L):j.addPendingRequest(L))}if(_.length===0)return void this._notify(v,s,d);let E=!0;const C=!!this.loaded.get(s),k=this.images.get(s);if(!C)for(const L of _)k.has(L.toString())||(E=!1);C||E?this._notify(_,s,d):this.requestors.push({ids:_,scope:s,callback:d})}rasterizeImages(t,s){const d=new Map,{tasks:_,scope:v}=t;for(const[S,E]of _.entries()){const C=this.getImage(E.id,v);C&&d.set(S,{image:C,imageVariant:E})}this._rasterizeImages(v,d,s)}_rasterizeImages(t,s,d){if(a.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:s,scope:t},d);else{const _=new Map;for(const[v,{image:S,imageVariant:E}]of s.entries())_.set(v,this.imageRasterizer.rasterize(E,S,t,0));d(void 0,_)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,s,d){const _=this.images.get(s),v=new Map;for(const S of t){if(!_.get(S.toString())){if(S.iconsetId)continue;this.fire(new a.A("styleimagemissing",{id:S.name}))}const E=_.get(S.toString());if(!E){a.w(`Image "${S.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const C={data:E.usvg?null:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,usvg:E.usvg,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)};E.usvg&&Object.assign(C,{width:E.icon.usvg_tree.width,height:E.icon.usvg_tree.height}),v.set(a.I.toString(S),C)}d(null,v)}getPixelSize(t){const{width:s,height:d}=this.atlasImage.get(t);return{width:s,height:d}}getPattern(t,s,d){const _=t.toString(),v=this.patterns.get(s),S=v.get(_),E=this.getImage(t,s);if(!E)return null;if(S){if(S.position.version===E.version)return S.position;S.position.version=E.version}else{if(E.usvg&&!E.data){const C=this.getPatternInFlightId(_,s);if(this.patternsInFlight.has(C))return null;this.patternsInFlight.add(C);const k=new a.B(t).scaleSelf(a.q.devicePixelRatio),L=new Map([[k.toString(),{image:E,imageVariant:k}]]);return this._rasterizeImages(s,L,((j,B)=>this.storePatternImage(k,s,E,d,B))),null}this.storePattern(t,s,E)}return this._updatePatternAtlas(s,d),v.get(_).position}getPatternInFlightId(t,s){return a.C(t,s)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,s,d,_,v){const S=t.toString(),E=v?v.get(S):void 0;E&&(d.data=E,this.storePattern(t.id,s,d),this._updatePatternAtlas(s,_),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),s)))}storePattern(t,s,d){const _={w:d.data.width+2*a.F,h:d.data.height+2*a.F,x:0,y:0},v=new a.G(_,d,a.F);this.patterns.get(s).set(t.toString(),{bin:_,position:v})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,s){const d=t.gl;let _=this.atlasTexture.get(s);_?this.dirty&&(_.update(this.atlasImage.get(s)),this.dirty=!1):(_=new a.T(t,this.atlasImage.get(s),d.RGBA8),this.atlasTexture.set(s,_)),_.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,s){const d=this.patterns.get(t),_=Array.from(d.values()).map((({bin:k})=>k)),{w:v,h:S}=a.H(_),E=this.atlasImage.get(t);E.resize({width:v||1,height:S||1});const C=this.images.get(t);for(const[k,{bin:L,position:j}]of d.entries()){let B=j.padding;const q=L.x+B,K=L.y+B,Z=C.get(k).data,J=Z.width,Y=Z.height;B=B>1?B-1:B,a.r.copy(Z,E,{x:0,y:0},{x:q,y:K},{width:J,height:Y},s),a.r.copy(Z,E,{x:0,y:Y-B},{x:q,y:K-B},{width:J,height:B},s),a.r.copy(Z,E,{x:0,y:0},{x:q,y:K+Y},{width:J,height:B},s),a.r.copy(Z,E,{x:J-B,y:0},{x:q-B,y:K},{width:B,height:Y},s),a.r.copy(Z,E,{x:0,y:0},{x:q+J,y:K},{width:B,height:Y},s),a.r.copy(Z,E,{x:J-B,y:Y-B},{x:q-B,y:K-B},{width:B,height:B},s),a.r.copy(Z,E,{x:0,y:Y-B},{x:q+J,y:K-B},{width:B,height:B},s),a.r.copy(Z,E,{x:0,y:0},{x:q+J,y:K+Y},{width:B,height:B},s),a.r.copy(Z,E,{x:J-B,y:0},{x:q-B,y:K+Y},{width:B,height:B},s)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,s){const d=this.images.get(s);for(const _ of t){if(this.callbackDispatchedThisFrame.get(s).has(_.toString()))continue;this.callbackDispatchedThisFrame.get(s).add(_.toString());const v=d.get(_.toString());Rn(v)&&this.updateImage(_,s,v)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function ci(f){const t=f.key,s=f.value,d=f.valueSpec||{},_=f.objectElementValidators||{},v=f.style,S=f.styleSpec;let E=[];const C=a.J(s);if(C!=="object")return[new a.V(t,s,`object expected, ${C} found`)];for(const k in s){const L=k.split(".")[0];let j;_[L]?j=_[L]:d[L]?j=ii:_["*"]?j=_["*"]:d["*"]&&(j=ii),j?E=E.concat(j({key:(t&&`${t}.`)+k,value:s[k],valueSpec:d[L]||d["*"],style:v,styleSpec:S,object:s,objectKey:k},s)):E.push(new a.K(t,s[k],`unknown property "${k}"`))}for(const k in d)_[k]||d[k].required&&d[k].default===void 0&&s[k]===void 0&&E.push(new a.V(t,s,`missing required property "${k}"`));return E}function Ki(f){const t=f.value,s=f.valueSpec,d=f.style,_=f.styleSpec,v=f.key,S=f.arrayElementValidator||ii;if(a.J(t)!=="array")return[new a.V(v,t,`array expected, ${a.J(t)} found`)];if(s.length&&t.length!==s.length)return[new a.V(v,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new a.V(v,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let E={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};_.$version<7&&(E.function=s.function),a.J(s.value)==="object"&&(E=s.value);let C=[];for(let k=0;k<t.length;k++)C=C.concat(S({array:t,arrayIndex:k,value:t[k],valueSpec:E,style:d,styleSpec:_,key:`${v}[${k}]`},!0));return C}function wa(f){const t=f.key,s=f.value,d=f.valueSpec;let _=a.J(s);if(_==="number"&&s!=s&&(_="NaN"),_!=="number")return[new a.V(t,s,`number expected, ${_} found`)];if("minimum"in d){let v=d.minimum;if(a.J(d.minimum)==="array"&&(v=d.minimum[f.arrayIndex]),s<v)return[new a.V(t,s,`${s} is less than the minimum value ${v}`)]}if("maximum"in d){let v=d.maximum;if(a.J(d.maximum)==="array"&&(v=d.maximum[f.arrayIndex]),s>v)return[new a.V(t,s,`${s} is greater than the maximum value ${v}`)]}return[]}function $o(f){const t=f.valueSpec,s=a.M(f.value.type);let d,_,v,S={};const E=s!=="categorical"&&f.value.property===void 0,C=!E,k=a.J(f.value.stops)==="array"&&a.J(f.value.stops[0])==="array"&&a.J(f.value.stops[0][0])==="object",L=ci({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(q){if(s==="identity")return[new a.V(q.key,q.value,'identity function may not have a "stops" property')];let K=[];const Z=q.value;return K=K.concat(Ki({key:q.key,value:Z,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:j})),a.J(Z)==="array"&&Z.length===0&&K.push(new a.V(q.key,Z,"array must have at least one stop")),K},default:function(q){return ii({key:q.key,value:q.value,valueSpec:t,style:q.style,styleSpec:q.styleSpec})}}});return s==="identity"&&E&&L.push(new a.V(f.key,f.value,'missing required property "property"')),s==="identity"||f.value.stops||L.push(new a.V(f.key,f.value,'missing required property "stops"')),s==="exponential"&&f.valueSpec.expression&&!a.N(f.valueSpec)&&L.push(new a.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(C&&!a.O(f.valueSpec)?L.push(new a.V(f.key,f.value,"property functions not supported")):E&&!a.Q(f.valueSpec)&&L.push(new a.V(f.key,f.value,"zoom functions not supported"))),s!=="categorical"&&!k||f.value.property!==void 0||L.push(new a.V(f.key,f.value,'"property" property is required')),L;function j(q){let K=[];const Z=q.value,J=q.key;if(a.J(Z)!=="array")return[new a.V(J,Z,`array expected, ${a.J(Z)} found`)];if(Z.length!==2)return[new a.V(J,Z,`array length 2 expected, length ${Z.length} found`)];if(k){if(a.J(Z[0])!=="object")return[new a.V(J,Z,`object expected, ${a.J(Z[0])} found`)];if(Z[0].zoom===void 0)return[new a.V(J,Z,"object stop key must have zoom")];if(Z[0].value===void 0)return[new a.V(J,Z,"object stop key must have value")];const Y=a.M(Z[0].zoom);if(typeof Y!="number")return[new a.V(J,Z[0].zoom,"stop zoom values must be numbers")];if(v&&v>Y)return[new a.V(J,Z[0].zoom,"stop zoom values must appear in ascending order")];Y!==v&&(v=Y,_=void 0,S={}),K=K.concat(ci({key:`${J}[0]`,value:Z[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:wa,value:B}}))}else K=K.concat(B({key:`${J}[0]`,value:Z[0],style:q.style,styleSpec:q.styleSpec},Z));return a.S(a.U(Z[1]))?K.concat([new a.V(`${J}[1]`,Z[1],"expressions are not allowed in function stops.")]):K.concat(ii({key:`${J}[1]`,value:Z[1],valueSpec:t,style:q.style,styleSpec:q.styleSpec}))}function B(q,K){const Z=a.J(q.value),J=a.M(q.value),Y=q.value!==null?q.value:K;if(d){if(Z!==d)return[new a.V(q.key,Y,`${Z} stop domain type must match previous stop domain type ${d}`)]}else d=Z;if(Z!=="number"&&Z!=="string"&&Z!=="boolean"&&typeof J!="number"&&typeof J!="string"&&typeof J!="boolean")return[new a.V(q.key,Y,"stop domain value must be a number, string, or boolean")];if(Z!=="number"&&s!=="categorical"){let se=`number expected, ${Z} found`;return a.O(t)&&s===void 0&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new a.V(q.key,Y,se)]}return s!=="categorical"||Z!=="number"||typeof J=="number"&&isFinite(J)&&Math.floor(J)===J?s!=="categorical"&&Z==="number"&&typeof J=="number"&&typeof _=="number"&&_!==void 0&&J<_?[new a.V(q.key,Y,"stop domain values must appear in ascending order")]:(_=J,s==="categorical"&&J in S?[new a.V(q.key,Y,"stop domain values must be unique")]:(S[J]=!0,[])):[new a.V(q.key,Y,`integer expected, found ${String(J)}`)]}}function fo(f){const t=(f.expressionContext==="property"?a.W:a.X)(a.U(f.value),f.valueSpec);if(t.result==="error")return t.value.map((d=>new a.V(`${f.key}${d.key}`,f.value,d.message)));const s=t.value.expression||t.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!s.outputDefined())return[new a.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!a.Y(s))return[new a.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Ui(s,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!a.Z(s,["zoom","feature-state"]))return[new a.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!a._(s))return[new a.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ui(f,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const _ of t.valueSpec.expression.parameters)s.delete(_);if(s.size===0)return[];const d=[];return f instanceof a.$&&s.has(f.name)?[new a.V(t.key,t.value,`["${f.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(f.eachChild((_=>{d.push(...Ui(_,t))})),d)}function Fo(f){const t=f.key,s=f.value,d=f.valueSpec,_=[];return Array.isArray(d.values)?d.values.indexOf(a.M(s))===-1&&_.push(new a.V(t,s,`expected one of [${d.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(d.values).indexOf(a.M(s))===-1&&_.push(new a.V(t,s,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(s)} found`)),_}function Fa(f){return a.a1(a.U(f.value))?fo(a.L({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Ms(f)}function Ms(f){const t=f.value,s=f.key;if(a.J(t)!=="array")return[new a.V(s,t,`array expected, ${a.J(t)} found`)];const d=f.styleSpec;let _,v=[];if(t.length<1)return[new a.V(s,t,"filter array must have at least 1 element")];switch(v=v.concat(Fo({key:`${s}[0]`,value:t[0],valueSpec:d.filter_operator,style:f.style,styleSpec:f.styleSpec})),a.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&a.M(t[1])==="$type"&&v.push(new a.V(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&v.push(new a.V(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(_=a.J(t[1]),_!=="string"&&v.push(new a.V(`${s}[1]`,t[1],`string expected, ${_} found`)));for(let S=2;S<t.length;S++)_=a.J(t[S]),a.M(t[1])==="$type"?v=v.concat(Fo({key:`${s}[${S}]`,value:t[S],valueSpec:d.geometry_type,style:f.style,styleSpec:f.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&v.push(new a.V(`${s}[${S}]`,t[S],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let S=1;S<t.length;S++)v=v.concat(Ms({key:`${s}[${S}]`,value:t[S],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":_=a.J(t[1]),t.length!==2?v.push(new a.V(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):_!=="string"&&v.push(new a.V(`${s}[1]`,t[1],`string expected, ${_} found`))}return v}function Js(f,t){const s=f.key,d=f.style,_=f.layer,v=f.styleSpec,S=f.value,E=f.objectKey,C=v[`${t}_${f.layerType}`];if(!C)return[];const k=E.match(/^(.*)-use-theme$/);if(t==="paint"&&k&&C[k[1]])return a.S(S)?[].concat(ii({key:f.key,value:S,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:E})):ii({key:s,value:S,valueSpec:{type:"string"},style:d,styleSpec:v});const L=E.match(/^(.*)-transition$/);if(t==="paint"&&L&&C[L[1]]&&C[L[1]].transition)return ii({key:s,value:S,valueSpec:v.transition,style:d,styleSpec:v});const j=f.valueSpec||C[E];if(!j)return[new a.K(s,S,`unknown property "${E}"`)];let B;if(a.J(S)==="string"&&a.O(j)&&!j.tokens&&(B=/^{([^}]+)}$/.exec(S))){const K=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new a.V(s,S,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${K}.`)]}const q=[];if(f.layerType==="symbol")E!=="text-field"||!d||d.glyphs||d.imports||q.push(new a.V(s,S,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&a.a2(a.U(S))&&a.M(S.type)==="identity"&&q.push(new a.V(s,S,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&t==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&a.O(j)&&(a.a3(j)||a.Q(j))){const K=a.W(a.U(S),j),Z=K.value.expression||K.value._styleExpression.expression;Z&&!a.Z(Z,["measure-light"])&&(E==="model-emissive-strength"&&a._(Z)&&a.Y(Z)||q.push(new a.V(s,S,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return q.concat(ii({key:f.key,value:S,valueSpec:j,style:d,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:E}))}function la(f){return Js(f,"paint")}function Sa(f){return Js(f,"layout")}function Jl(f){let t=[];const s=f.value,d=f.key,_=f.style,v=f.styleSpec;s.type||s.ref||t.push(new a.V(d,s,'either "type" or "ref" is required'));let S=a.M(s.type);const E=a.M(s.ref);if(s.id){const C=a.M(s.id);for(let k=0;k<f.arrayIndex;k++){const L=_.layers[k];a.M(L.id)===C&&t.push(new a.V(d,s.id,`duplicate layer id "${s.id}", previously used at line ${L.id.__line__}`))}}if("ref"in s){let C;["type","source","source-layer","filter","layout"].forEach((k=>{k in s&&t.push(new a.V(d,s[k],`"${k}" is prohibited for ref layers`))})),_.layers.forEach((k=>{a.M(k.id)===E&&(C=k)})),C?C.ref?t.push(new a.V(d,s.ref,"ref cannot reference another ref layer")):S=a.M(C.type):typeof E=="string"&&t.push(new a.V(d,s.ref,`ref layer "${E}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(s.source){const C=_.sources&&_.sources[s.source],k=C&&a.M(C.type);C?k==="vector"&&S==="raster"?t.push(new a.V(d,s.source,`layer "${s.id}" requires a raster source`)):k==="raster"&&S!=="raster"?t.push(new a.V(d,s.source,`layer "${s.id}" requires a vector source`)):k!=="vector"||s["source-layer"]?k==="raster-dem"&&S!=="hillshade"?t.push(new a.V(d,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="raster-array"||["raster","raster-particle"].includes(S)?S==="line"&&s.paint&&(s.paint["line-gradient"]||s.paint["line-trim-offset"])&&k==="geojson"&&!C.lineMetrics?t.push(new a.V(d,s,`layer "${s.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):S==="raster-particle"&&k!=="raster-array"&&t.push(new a.V(d,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):t.push(new a.V(d,s.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new a.V(d,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new a.V(d,s.source,`source "${s.source}" not found`))}else t.push(new a.V(d,s,'missing required property "source"'));return t=t.concat(ci({key:d,value:s,valueSpec:v.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ii({key:`${d}.type`,value:s.type,valueSpec:v.layer.type,style:f.style,styleSpec:f.styleSpec,object:s,objectKey:"type"}),filter:C=>Fa(a.L({layerType:S},C)),layout:C=>ci({layer:s,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":k=>Sa(a.L({layerType:S},k))}}),paint:C=>ci({layer:s,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":k=>la(a.L({layerType:S,layer:s},k))}})}})),t}function Qs(f){const t=f.value,s=f.key,d=a.J(t);return d!=="string"?[new a.V(s,t,`string expected, ${d} found`)]:[]}const el={promoteId:function f({key:t,value:s}){if(a.J(s)==="string")return Qs({key:t,value:s});if(Array.isArray(s)){const d=[],_=a.U(s),v=a.X(_);return v.result==="error"&&v.value.forEach((S=>{d.push(new a.V(`${t}${S.key}`,null,`${S.message}`))})),a.Z(v.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||d.push(new a.V(`${t}`,null,"promoteId expression should be only feature dependent")),d}{const d=[];for(const _ in s)d.push(...f({key:`${t}.${_}`,value:s[_]}));return d}}};function vo(f){const t=f.value,s=f.key,d=f.styleSpec,_=f.style;if(!t.type)return[new a.V(s,t,'"type" is required')];const v=a.M(t.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(t.url||t.tiles||S.push(new a.K(s,t,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(ci({key:s,value:t,valueSpec:d[`source_${v.replace("-","_")}`],style:f.style,styleSpec:d,objectElementValidators:el})),S;case"geojson":if(S=ci({key:s,value:t,valueSpec:d.source_geojson,style:_,styleSpec:d,objectElementValidators:el}),t.cluster)for(const E in t.clusterProperties){const[C,k]=t.clusterProperties[E],L=typeof C=="string"?[C,["accumulated"],["get",E]]:C;S.push(...fo({key:`${s}.${E}.map`,value:k,expressionContext:"cluster-map"})),S.push(...fo({key:`${s}.${E}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return S;case"video":return ci({key:s,value:t,valueSpec:d.source_video,style:_,styleSpec:d});case"image":return ci({key:s,value:t,valueSpec:d.source_image,style:_,styleSpec:d});case"canvas":return[new a.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fo({key:`${s}.type`,value:t.type,valueSpec:{values:ts(d)}})}}function ts(f){return f.source.reduce(((t,s)=>{const d=f[s];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values))),t}),[])}function wl(f){const t=f.value,s=f.styleSpec,d=s.light,_=f.style;let v=[];const S=a.J(t);if(t===void 0)return v;if(S!=="object")return v=v.concat([new a.V("light",t,`object expected, ${S} found`)]),v;for(const E in t){const C=E.match(/^(.*)-transition$/),k=E.match(/^(.*)-use-theme$/);v=v.concat(k&&d[k[1]]?ii({key:E,value:t[E],valueSpec:{type:"string"},style:_,styleSpec:s}):C&&d[C[1]]&&d[C[1]].transition?ii({key:E,value:t[E],valueSpec:s.transition,style:_,styleSpec:s}):d[E]?ii({key:E,value:t[E],valueSpec:d[E],style:_,styleSpec:s}):[new a.V(E,t[E],`unknown property "${E}"`)])}return v}function tl(f){const t=f.value;let s=[];if(!t)return s;const d=a.J(t);if(d!=="object")return s=s.concat([new a.V("light-3d",t,`object expected, ${d} found`)]),s;const _=f.styleSpec,v=_["light-3d"],S=f.key,E=f.style,C=f.style.lights;for(const j of["type","id"])if(!(j in t))return s=s.concat([new a.V("light-3d",t,`missing property ${j} on light`)]),s;if(t.type&&C)for(let j=0;j<f.arrayIndex;j++){const B=a.M(t.type),q=C[j];a.M(q.type)===B&&s.push(new a.V(S,t.id,`duplicate light type "${t.type}", previously defined at line ${q.id.__line__}`))}const k=`properties_light_${t.type}`;if(!(k in _))return s=s.concat([new a.V("light-3d",t,`Invalid light type ${t.type}`)]),s;const L=_[k];for(const j in t)if(j==="properties"){const B=t[j],q=a.J(B);if(q!=="object")return s=s.concat([new a.V("properties",B,`object expected, ${q} found`)]),s;for(const K in B){const Z=K.match(/^(.*)-transition$/),J=K.match(/^(.*)-use-theme$/);s=s.concat(J&&L[J[1]]?ii({key:j,value:B[K],valueSpec:{type:"string"},style:E,styleSpec:_}):Z&&L[Z[1]]&&L[Z[1]].transition?ii({key:j,value:t[j],valueSpec:_.transition,style:E,styleSpec:_}):L[K]?ii({key:K,value:B[K],valueSpec:L[K],style:E,styleSpec:_}):[new a.K(f.key,B[K],`unknown property "${K}"`)])}}else s=s.concat(v[j]?ii({key:j,value:t[j],valueSpec:v[j],style:E,styleSpec:_}):[new a.K(j,t[j],`unknown property "${j}"`)]);return s}function Ql(f){const t=f.value,s=f.key,d=f.style,_=f.styleSpec,v=_.terrain;let S=[];const E=a.J(t);if(t===void 0||E==="null")return S;if(E!=="object")return S=S.concat([new a.V("terrain",t,`object expected, ${E} found`)]),S;for(const C in t){const k=C.match(/^(.*)-transition$/),L=C.match(/^(.*)-use-theme$/);S=S.concat(L&&v[L[1]]?ii({key:C,value:t[C],valueSpec:{type:"string"},style:d,styleSpec:_}):k&&v[k[1]]&&v[k[1]].transition?ii({key:C,value:t[C],valueSpec:_.transition,style:d,styleSpec:_}):v[C]?ii({key:C,value:t[C],valueSpec:v[C],style:d,styleSpec:_}):[new a.K(C,t[C],`unknown property "${C}"`)])}if(t.source){const C=d.sources&&d.sources[t.source],k=C&&a.M(C.type);C?k!=="raster-dem"&&S.push(new a.V(s,t.source,`terrain cannot be used with a source of type ${String(k)}, it only be used with a "raster-dem" source type`)):S.push(new a.V(s,t.source,`source "${t.source}" not found`))}else S.push(new a.V(s,t,'terrain is missing required property "source"'));return S}function rl(f){const t=f.value,s=f.style,d=f.styleSpec,_=d.fog;let v=[];const S=a.J(t);if(t===void 0)return v;if(S!=="object")return v=v.concat([new a.V("fog",t,`object expected, ${S} found`)]),v;for(const E in t){const C=E.match(/^(.*)-transition$/),k=E.match(/^(.*)-use-theme$/);v=v.concat(k&&_[k[1]]?ii({key:E,value:t[E],valueSpec:{type:"string"},style:s,styleSpec:d}):C&&_[C[1]]&&_[C[1]].transition?ii({key:E,value:t[E],valueSpec:d.transition,style:s,styleSpec:d}):_[E]?ii({key:E,value:t[E],valueSpec:_[E],style:s,styleSpec:d}):[new a.K(E,t[E],`unknown property "${E}"`)])}return v}const eu={"*":()=>[],array:Ki,boolean:function(f){const t=f.value,s=f.key,d=a.J(t);return d!=="boolean"?[new a.V(s,t,`boolean expected, ${d} found`)]:[]},number:wa,color:function(f){const t=f.key,s=f.value,d=a.J(s);return d!=="string"?[new a.V(t,s,`color expected, ${d} found`)]:a.a0.parseCSSColor(s)===null?[new a.V(t,s,`color expected, "${s}" found`)]:[]},enum:Fo,filter:Fa,function:$o,layer:Jl,object:ci,source:vo,model:a.a4,light:wl,"light-3d":tl,terrain:Ql,fog:rl,string:Qs,formatted:function(f){return Qs(f).length===0?[]:fo(f)},resolvedImage:function(f){return Qs(f).length===0?[]:fo(f)},projection:function(f){const t=f.value,s=f.styleSpec,d=s.projection,_=f.style;let v=[];const S=a.J(t);if(S==="object")for(const E in t)v=v.concat(ii({key:E,value:t[E],valueSpec:d[E],style:_,styleSpec:s}));else S!=="string"&&(v=v.concat([new a.V("projection",t,`object or string expected, ${S} found`)]));return v},import:function(f){const{value:t,styleSpec:s}=f,{data:d,..._}=t;Object.defineProperty(_,"__line__",{value:t.__line__,enumerable:!1});let v=ci(a.L({},f,{value:_,valueSpec:s.import}));return a.M(_.id)===""&&v.push(new a.V(`${f.key}.id`,_,"import id can't be an empty string")),d&&(v=v.concat(Hu(d,s,{key:`${f.key}.data`}))),v},iconset:function(f){const t=f.value,s=f.key,d=f.styleSpec,_=f.style;if(!t.type)return[new a.V(s,t,'"type" is required')];const v=a.M(t.type);let S=[];if(S=S.concat(ci({key:s,value:t,valueSpec:d[`iconset_${v}`],style:_,styleSpec:d})),v==="source"&&t.source){const E=_.sources&&_.sources[t.source],C=E&&a.M(E.type);E?C!=="raster-array"&&S.push(new a.V(s,t.source,`iconset cannot be used with a source of type ${String(C)}, it only be used with a "raster-array" source type`)):S.push(new a.V(s,t.source,`source "${t.source}" not found`))}return S}};function ii(f,t=!1){const s=f.value,d=f.valueSpec,_=f.styleSpec;if(d.expression&&a.a2(a.M(s)))return $o(f);if(d.expression&&a.S(a.U(s)))return fo(f);if(d.type&&eu[d.type]){const v=eu[d.type](f);return t===!0&&v.length>0&&a.J(f.value)==="array"?fo(f):v}return ci(a.L({},f,{valueSpec:d.type?_[d.type]:d}))}function Gu(f){const t=f.value,s=f.key,d=Qs(f);return d.length||(t.indexOf("{fontstack}")===-1&&d.push(new a.V(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&d.push(new a.V(s,t,'"glyphs" url must include a "{range}" token'))),d}function Hu(f,t=a.a5,s={}){return ii({key:s.key||"",value:f,valueSpec:t.$root,styleSpec:t,style:f,objectElementValidators:{glyphs:Gu,"*":()=>[]}})}function qo(f,t=a.a5){return Oe(Hu(f,t))}const nl=f=>Oe(vo(f)),Kf=f=>Oe(wl(f)),Wu=f=>Oe(tl(f)),Ct=f=>Oe(Ql(f)),il=f=>Oe(rl(f)),Yf=f=>Oe((function(t){const s=t.value,d=t.style,_=t.styleSpec,v=_.snow;let S=[];const E=a.J(s);if(s===void 0)return S;if(E!=="object")return S=S.concat([new a.V("snow",s,`object expected, ${E} found`)]),S;for(const C in s){const k=C.match(/^(.*)-transition$/);S=S.concat(k&&v[k[1]]&&v[k[1]].transition?ii({key:C,value:s[C],valueSpec:_.transition,style:d,styleSpec:_}):v[C]?ii({key:C,value:s[C],valueSpec:v[C],style:d,styleSpec:_}):[new a.K(C,s[C],`unknown property "${C}"`)])}return S})(f)),Zu=f=>Oe((function(t){const s=t.value,d=t.style,_=t.styleSpec,v=_.rain;let S=[];const E=a.J(s);if(s===void 0)return S;if(E!=="object")return S=S.concat([new a.V("rain",s,`object expected, ${E} found`)]),S;for(const C in s){const k=C.match(/^(.*)-transition$/);S=S.concat(k&&v[k[1]]&&v[k[1]].transition?ii({key:C,value:s[C],valueSpec:_.transition,style:d,styleSpec:_}):v[C]?ii({key:C,value:s[C],valueSpec:v[C],style:d,styleSpec:_}):[new a.K(C,s[C],`unknown property "${C}"`)])}return S})(f)),Cn=f=>Oe(Jl(f)),Ke=f=>Oe(Fa(f)),re=f=>Oe(la(f)),oe=f=>Oe(Sa(f)),ye=f=>Oe(a.a4(f));function Oe(f){return f.slice().sort(((t,s)=>t.line&&s.line?t.line-s.line:0))}function ve(f,t){let s=!1;if(t&&t.length)for(const d of t)d instanceof a.K?a.w(d.message):(f.fire(new a.z(new Error(d.message))),s=!0);return s}let Fe;class et extends a.E{constructor(t,s="flat"){super(),this._transitionable=new a.a6(Fe||(Fe=new a.a7({anchor:new a.a8(a.a5.light.anchor),position:new a.a9(a.a5.light.position),color:new a.a8(a.a5.light.color),intensity:new a.a8(a.a5.light.intensity)}))),this.setLight(t,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s,d={}){this._validate(Kf,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=s)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,d){return(!d||d.validate!==!1)&&ve(this,t.call(qo,a.h({value:s,style:{glyphs:!0,sprite:!0},styleSpec:a.a5})))}}let Ue=class extends a.E{constructor(f,t,s,d,_){super(),this.scope=s,this._transitionable=new a.a6(new a.a7({source:new a.a8(a.a5.terrain.source),exaggeration:new a.a8(a.a5.terrain.exaggeration)}),s,d),this._transitionable.setTransitionOrValue(f,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=_}get(){return this._transitionable.serialize()}set(f,t){this._transitionable.setTransitionOrValue(f,t)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new a.aa(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const t=f.value.expression;if(!t)return null;let s=-1,d=-1,_=1;for(const v of t.zoomStops)_=t.evaluate(new a.aa(v,{worldview:this.worldview})),_>.01?(s=v,d=-1):d=v;return _<.01&&s>0&&d>s?[s,d]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof a.ab}};const Qe=45,Nt=65,mt=.05;function vr(f,t,s,d){const _=a.af(Qe,Nt,s),[v,S]=Cr(f,d);let E=1-Math.min(1,Math.exp((t-v)/(S-v)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*_*f.alpha}function Cr(f,t){const s=.5/Math.tan(.5*t);return[f.range[0]+s,f.range[1]+s]}function Br(f,t,s,d,_){const v=a.ad([],[t,s,d],_.mercatorFogMatrix);return vr(f,a.ae(v),_.pitch,_._fov)}function ln(f,t,s,d,_,v,S){const E=[[s,d,0],[_,d,0],[_,v,0],[s,v,0]];let C=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(const L of E){const j=a.ad([],L,t),B=a.ae(j);C=Math.min(C,B),k=Math.max(k,B)}return[vr(f,C,S.pitch,S._fov),vr(f,k,S.pitch,S._fov)]}class Jr extends a.E{constructor(t,s,d,_){super();const v=new a.a7({range:new a.a8(a.a5.fog.range),color:new a.a8(a.a5.fog.color),"color-use-theme":new a.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new a.a8(a.a5.fog["high-color"]),"high-color-use-theme":new a.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new a.a8(a.a5.fog["space-color"]),"space-color-use-theme":new a.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new a.a8(a.a5.fog["horizon-blend"]),"star-intensity":new a.a8(a.a5.fog["star-intensity"]),"vertical-range":new a.a8(a.a5.fog["vertical-range"])});this._transitionable=new a.a6(v,d,new Map(_)),this.set(t,_),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new a.ag(v),this.scope=d}get state(){const t=this._transform,s=t.projection.name==="globe",d=a.ah(t.zoom),_=this.properties.get("range"),v=[.5,3];return{range:s?[a.ai(v[0],_[0],d),a.ai(v[1],_[1],d)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s,d={}){if(this._validate(il,t,d))return;const _=a.h({},t);for(const v of Object.keys(a.a5.fog))_[v]===void 0&&(_[v]=a.a5.fog[v].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.af(Qe,Nt,t))*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?(function(d,_,v){const S=a.ac.fromLngLat(_),E=v.elevation?v.elevation.getAtPointOrZero(S):0;return Br(d,S.x,S.y,E,v)})(this.state,t,s):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(t.toUnwrapped());return ln(this.state,s,0,0,a.aj,a.aj,this._transform)}getOpacityForBounds(t,s,d,_,v){return this._transform.projection.supportsFog?ln(this.state,t,s,d,_,v,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Cr(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const d of s){const _=t.points[d];let v;if(_[2]>=0)v=_;else{const S=t.points[d-4];v=a.ak(S,_,S[2]/(S[2]-_[2]))}if(Br(this.state,v[0],v[1],0,this._transform)>=mt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,d){return(!d||d.validate!==!1)&&ve(this,t.call(qo,a.h({value:s,style:{glyphs:!0,sprite:!0},styleSpec:a.a5})))}}let cn,Yn,hn,Li,$n=class extends a.E{constructor(f,t,s,d){super();const _=cn||(cn=new a.a7({density:new a.a8(a.a5.snow.density),intensity:new a.a8(a.a5.snow.intensity),color:new a.a8(a.a5.snow.color),opacity:new a.a8(a.a5.snow.opacity),vignette:new a.a8(a.a5.snow.vignette),"vignette-color":new a.a8(a.a5.snow["vignette-color"]),"center-thinning":new a.a8(a.a5.snow["center-thinning"]),direction:new a.a8(a.a5.snow.direction),"flake-size":new a.a8(a.a5.snow["flake-size"])}));this._transitionable=new a.a6(_,s,new Map(d)),this.set(f,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.ag(_),this.scope=s}get state(){const f=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),d=a.al(s[0]),_=-Math.max(a.al(s[1]),.01),v=[Math.cos(d)*Math.cos(_),Math.sin(d)*Math.cos(_),Math.sin(_)],S=this.properties.get("vignette"),E=this.properties.get("vignette-color");return E.a=S,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.am(t.r,t.g,t.b,t.a*f),direction:v,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:E}}get(){return this._transitionable.serialize()}set(f,t,s={}){if(this._validate(Yf,f,s))return;const d=a.h({},f);for(const _ of Object.keys(a.a5.snow))d[_]===void 0&&(d[_]=a.a5.snow[_].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,t,s){return(!s||s.validate!==!1)&&ve(this,f.call(qo,a.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:a.a5})))}},to=class extends a.E{constructor(f,t,s,d){super();const _=Yn||(Yn=new a.a7({density:new a.a8(a.a5.rain.density),intensity:new a.a8(a.a5.rain.intensity),color:new a.a8(a.a5.rain.color),opacity:new a.a8(a.a5.rain.opacity),vignette:new a.a8(a.a5.rain.vignette),"vignette-color":new a.a8(a.a5.rain["vignette-color"]),"center-thinning":new a.a8(a.a5.rain["center-thinning"]),direction:new a.a8(a.a5.rain.direction),"droplet-size":new a.a8(a.a5.rain["droplet-size"]),"distortion-strength":new a.a8(a.a5.rain["distortion-strength"])}));this._transitionable=new a.a6(_,s,new Map(d)),this.set(f,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new a.ag(_),this.scope=s}get state(){const f=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),d=a.al(s[0]),_=-Math.max(a.al(s[1]),.01),v=[Math.cos(d)*Math.cos(_),Math.sin(d)*Math.cos(_),Math.sin(_)],S=this.properties.get("vignette-color");return S.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new a.am(t.r,t.g,t.b,t.a*f),direction:v,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(f,t,s={}){if(this._validate(Zu,f,s))return;const d=a.h({},f);for(const _ of Object.keys(a.a5.rain))d[_]===void 0&&(d[_]=a.a5.rain[_].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,t,s){return(!s||s.validate!==!1)&&ve(this,f.call(qo,a.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:a.a5})))}};class qn extends a.E{constructor(t,s,d,_){super(),this.scope=d,this._options=t,this.properties=new a.ag(s),this._transitionable=new a.a6(s,d,new Map(_)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,s){this._options=t,this._transitionable.setTransitionOrValue(t.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class kn{constructor(t,s,d){this.screenBounds=t,this.cameraPoint=d.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=s,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(t,s){let d,_;if(t instanceof a.P||typeof t[0]=="number"){const v=a.P.convert(t);d=[v],_=s.isPointAboveHorizon(v)}else{const v=a.P.convert(t[0]),S=a.P.convert(t[1]),E=v.add(S)._div(2);d=[v,S],_=a.ao(v,S).every((C=>s.isPointAboveHorizon(C)))&&s.isPointAboveHorizon(E)}return new kn(d,_,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return a.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],_=a.ao(s,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<d.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?_[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(_[3]=this.cameraPoint)),a.ap(_,t)}bufferedCameraGeometryGlobe(t){const s=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new a.P(1,1)):this.screenBounds[1],_=a.ao(s,d,t),v=this.cameraPoint.clone();switch(3*((v.y>s.y)+(v.y>d.y))+((v.x>s.x)+(v.x>d.x))){case 0:_[0]=v,_[4]=v.clone();break;case 1:_.splice(1,0,v);break;case 2:_[1]=v;break;case 3:_.splice(4,0,v);break;case 5:_.splice(2,0,v);break;case 6:_[3]=v;break;case 7:_.splice(3,0,v);break;case 8:_[2]=v}return _}containsTile(t,s,d,_=0){const v=t.queryPadding/s._pixelsPerMercatorPixel+1,S=d?this._bufferedCameraMercator(v,s):this._bufferedScreenMercator(v,s);let E=t.tileID.wrap+(S.unwrapped?_:0);const C=S.polygon.map((J=>a.aq(t.tileTransform,J,E)));if(!a.ar(C,0,0,a.aj,a.aj))return;E=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const k=this.screenGeometryMercator.polygon.map((J=>a.as(t.tileTransform,J,E))),L=k.map((J=>new a.P(J[0],J[1]))),j=s.getFreeCameraOptions().position||new a.ac(0,0,0),B=a.as(t.tileTransform,j,E),q=k.map((J=>{const Y=a.at(J,J,B);return a.au(Y,Y),new a.av(B,Y)})),K=a.aw(t,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:q,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(Z=a.ax(C),Z.min.x=a.ay(Z.min.x,0,a.aj),Z.min.y=a.ay(Z.min.y,0,a.aj),Z.max.x=a.ay(Z.max.x,0,a.aj),Z.max.y=a.ay(Z.max.y,0,a.aj),Z),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:K};var Z}_bufferedScreenMercator(t,s){const d=gi(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let _;return _=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),s):{polygon:this.bufferedScreenGeometry(t).map((v=>s.pointCoordinate3D(v))),unwrapped:!0},this._screenRaycastCache[d]=_,_}}_bufferedCameraMercator(t,s){const d=gi(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let _;return _=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),s):{polygon:this.bufferedCameraGeometry(t).map((v=>s.pointCoordinate3D(v))),unwrapped:!0},this._cameraRaycastCache[d]=_,_}}_projectAndResample(t,s){const d=(function(v,S){const E=a.az([],S.pixelMatrix,S.globeMatrix),C=[0,-a.aB,0,1],k=[0,a.aB,0,1],L=[0,0,0,1];a.aA(C,C,E),a.aA(k,k,E),a.aA(L,L,E);const j=new a.P(C[0]/C[3],C[1]/C[3]),B=new a.P(k[0]/k[3],k[1]/k[3]),q=a.aC(v,j)&&C[3]<L[3],K=a.aC(v,B)&&k[3]<L[3];if(!q&&!K)return null;const Z=(function(Me,Te,Ee){for(let Ae=1;Ae<Me.length;Ae++){const We=Ti(Te.pointCoordinate3D(Me[Ae-1]).x),Le=Ti(Te.pointCoordinate3D(Me[Ae]).x);if(Ee<0){if(We<Le)return{idx:Ae,t:-We/(Le-1-We)}}else if(Le<We)return{idx:Ae,t:(1-We)/(Le+1-We)}}return null})(v,S,q?-1:1);if(!Z)return null;const{idx:J,t:Y}=Z;let se=J>1?bi(v.slice(0,J),S):[],ce=J<v.length?bi(v.slice(J),S):[];se=se.map((Me=>new a.P(Ti(Me.x),Me.y))),ce=ce.map((Me=>new a.P(Ti(Me.x),Me.y)));const pe=[...se];pe.length===0&&pe.push(ce[ce.length-1]);const Se=a.ai(pe[pe.length-1].y,(ce.length===0?se[0]:ce[0]).y,Y);let Pe;return Pe=q?[new a.P(0,Se),new a.P(0,0),new a.P(1,0),new a.P(1,Se)]:[new a.P(1,Se),new a.P(1,1),new a.P(0,1),new a.P(0,Se)],pe.push(...Pe),ce.length===0?pe.push(se[0]):pe.push(...ce),{polygon:pe.map((Me=>new a.ac(Me.x,Me.y))),unwrapped:!1}})(t,s);if(d)return d;const _=(function(v,S){let E=!1,C=-1/0,k=0;for(let j=0;j<v.length-1;j++)v[j].x>C&&(C=v[j].x,k=j);for(let j=0;j<v.length-1;j++){const B=(k+j)%(v.length-1),q=v[B],K=v[B+1];Math.abs(q.x-K.x)>.5&&(q.x<K.x?(q.x+=1,B===0&&(v[v.length-1].x+=1)):(K.x+=1,B+1===v.length-1&&(v[0].x+=1)),E=!0)}const L=a.aD(S.center.lng);return E&&L<Math.abs(L-1)&&v.forEach((j=>{j.x-=1})),{polygon:v,unwrapped:E}})(bi(t,s).map((v=>new a.P(Ti(v.x),v.y))),s);return{polygon:_.polygon.map((v=>new a.ac(v.x,v.y))),unwrapped:_.unwrapped}}}function bi(f,t){return a.aE(f,(s=>{const d=t.pointCoordinate3D(s);s.x=d.x,s.y=d.y}),1/256)}function Ti(f){return f<0?1+f%1:f%1}function gi(f){return 100*f|0}function oo(f,t,s,d,_){const v=function(E,C){if(E)return _(E);if(C){if(f.url&&C.tiles&&f.tiles&&delete f.tiles,C.variants){if(!Array.isArray(C.variants))return _(new Error("variants must be an array"));for(const L of C.variants){if(L==null||typeof L!="object"||L.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return _(new Error("capabilities must be an array"));if(L.capabilities.length===1&&L.capabilities[0]==="meshopt"){C=a.h(C,L);break}}}const k=a.aF(a.h({},C,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);k.tiles=t.canonicalizeTileset(k,f.url),_(null,k)}},S=(function(E,C,k){if(!E)return null;if(!C&&!k)return E;k=k||E.worldview_default;const L=Object.values(E.language||{});if(L.length===0)return null;const j=Object.values(E.worldview||{});if(j.length===0)return null;const B=L.every((K=>K===C)),q=j.every((K=>K===k));return B&&q?E:C in(E.language_options||{})||k in(E.worldview_options||{})?null:E.language_options&&E.worldview_options?E:null})(f.data,s,d);return S?a.q.frame((()=>v(null,S))):f.url?a.n(t.transformRequest(t.normalizeSourceURL(f.url,null,s,d),a.R.Source),v):a.q.frame((()=>{const{data:E,...C}=f;v(null,C)}))}function ro(f,t){const s=Math.pow(2,t.z),d=Math.floor(a.aD(f.getWest())*s),_=Math.floor(a.aH(f.getNorth())*s),v=Math.ceil(a.aD(f.getEast())*s),S=Math.ceil(a.aH(f.getSouth())*s);return t.x>=d&&t.x<v&&t.y>=_&&t.y<S}class Qo{constructor(t,s,d){this.bounds=t?a.aG.convert(this.validateBounds(t)):null,this.minzoom=s||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const s of t)this.extraBounds.push(a.aG.convert(this.validateBounds(s)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!ro(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const s of this.extraBounds)if(ro(s,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const s=new Qo(t.bounds,t.minzoom,t.maxzoom);return s.addExtraBounds(t.extra_bounds),s}}class Ta extends a.E{constructor(t,s,d,_){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.h(this,a.aF(s,["url","scheme","tileSize","promoteId"])),this._options=a.h({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new a.aI}load(t){this._loaded=!1,this.fire(new a.A("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=oo(this._options,this.map._requestManager,s,d,((_,v)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new a.z(_));else if(v){if(a.h(this,v),this.hasWorldviews=!!v.worldview_options,v.worldview_default&&(this.worldviewDefault=v.worldview_default),v.vector_layers){this.vectorLayers=v.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const S of v.vector_layers)this.vectorLayerIds.push(S.id),v.worldview&&v.worldview[S.source]&&this.localizableLayerIds.add(S.id)}this.tileBounds=Qo.fromTileJSON(v),pt(v.tiles,this.map._requestManager._customAccessToken),this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(_)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=a.C(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return a.h({},this._options)}loadTile(t,s){const d=t.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(d),v=this.map._requestManager.transformRequest(_,a.R.Tile),S=this.map.style?this.map.style.getLut(this.scope):null,E=S?{image:S.image.clone()}:null,C={request:v,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:E,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:a.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&a.j(d)&&(C.localizableLayerIds=this.localizableLayerIds),C.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",C,k.bind(this));else if(t.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",C,k.bind(this),void 0,!0);else{const L=a.aJ.call({deduped:this._deduped},C,((j,B)=>{j||!B?k.call(this,j):(C.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},t.actor&&t.actor.send("loadTile",C,k.bind(this),void 0,!0))}),!0);t.request={cancel:L}}function k(L,j){return delete t.request,t.aborted?s(null):L&&L.status!==404?s(L):(j&&j.resourceTiming&&(t.resourceTiming=j.resourceTiming),this.map._refreshExpiredTiles&&j&&t.setExpiryData(j),t.loadVectorData(j,this.map.painter),a.aK(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Bo extends a.E{constructor(t,s,d,_){super(),this.id=t,this.dispatcher=d,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.h({type:"raster"},s),a.h(this,a.aF(s,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new a.A("dataloading",{dataType:"source"}));const s=this.map.getWorldview();this._tileJSONRequest=oo(this._options,this.map._requestManager,null,s,((d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new a.z(d)):_&&(a.h(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map((v=>v.id))),this.tileBounds=Qo.fromTileJSON(_),pt(_.tiles),this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(d)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=a.C(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return a.h({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const d=a.q.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=a.o(this.map._requestManager.transformRequest(_,a.R.Tile),((v,S,E,C)=>(delete t.request,t.aborted?(t.state="unloaded",s(null)):v?(t.state="errored",s(v)):S?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:E,expires:C}),t.setTexture(S,this.map.painter),t.state="loaded",a.aK(this.dispatcher),void s(null)):s(null))))}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s&&s()}unloadTile(t,s){t.texture&&t.texture instanceof a.T?(t.destroy(!0),t.texture&&t.texture instanceof a.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class tu extends Bo{constructor(t,s,d,_){super(t,s,d,_),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=a.h({type:"raster-array"},s)}triggerRepaint(t){const s=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);s&&s.enabled&&d&&s._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,s){const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(d,a.R.Tile),v={request:_,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=_,t.actor||(t.actor=this.dispatcher.getActor());const S=(E,C,k,L)=>{if(delete t.request,t.aborted)return t.state="unloaded",s(null);if(E)return E.name==="AbortError"?void 0:(t.state="errored",s(E));if(this.map._refreshExpiredTiles&&C&&t.setExpiryData({cacheControl:k,expires:L}),this.partial)t.state="empty";else{if(!C)return s(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=C}s(null)};t.request=this.partial?t.fetchHeader(void 0,S.bind(this)):t.actor.send("loadTile",v,S.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){const d=t.texturePerLayer;if(t.flushAllQueues(),d.size){t.destroy(!0);for(const _ of d.values())this.map.painter.saveTileTexture(_)}else t.destroy()}prepareTile(t,s,d,_){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(s,d,_,((v,S)=>{if(v)return t.state="errored",this.fire(new a.z(v)),void this.triggerRepaint(t);S&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(d,S,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find((({id:v})=>v===t)),d=s&&s.fields,_=d&&d.bands&&d.bands;return _?_[0]:0}getTextureDescriptor(t,s,d){if(!t)return;const _=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let v=null;s instanceof a.aN?v=s.paint.get("raster-array-band"):s instanceof a.aO&&(v=s.paint.get("raster-particle-array-band"));const S=v||this.getInitialBand(_);if(S==null)return;if(!t.textureDescriptorPerLayer.get(s.id))return void this.prepareTile(t,_,s.id,S);if(t.updateNeeded(s.id,S)&&!d)return;const E=t.textureDescriptorPerLayer.get(s.id);return Object.assign({},E,{texture:t.texturePerLayer.get(s.id)})}getImages(t,s){const d=new Map;for(const _ of t)for(const v of s){const[S,E]=v.split("/"),C=_.getLayer(S);if(!C||!C.hasBand(E)||!C.hasDataForBand(E))continue;const{bytes:k,tileSize:L,buffer:j}=C.getBandView(E),B=L+2*j,q={data:new a.r({width:B,height:B},k),pixelRatio:2,sdf:!1,usvg:!1,version:0};d.set(v,q)}return d}}const Jf={vector:Ta,raster:Bo,"raster-dem":class extends Bo{constructor(f,t,s,d){super(f,t,s,d),this.type="raster-dem",this.maxzoom=22,this._options=a.h({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(f,t){const s=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(_,v){_&&(f.state="errored",t(_)),v&&(f.dem=v,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",t(null))}f.request=a.o(this.map._requestManager.transformRequest(s,a.R.Tile),function(_,v,S,E){if(delete f.request,f.aborted)f.state="unloaded",t(null);else if(_)f.state="errored",t(_);else if(v){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:S,expires:E});const C=ImageBitmap&&v instanceof ImageBitmap&&a.t(),k=1-(v.width-a.aL(v.width))/2;k<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const L=C?v:a.q.getImageData(v,k),j={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:k};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",j,d.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const t=f.canonical,s=Math.pow(2,t.z),d=(t.x-1+s)%s,_=t.x===0?f.wrap-1:f.wrap,v=(t.x+1+s)%s,S=t.x+1===s?f.wrap+1:f.wrap,E={};return E[new a.aM(f.overscaledZ,_,t.z,d,t.y).key]={backfilled:!1},E[new a.aM(f.overscaledZ,S,t.z,v,t.y).key]={backfilled:!1},t.y>0&&(E[new a.aM(f.overscaledZ,_,t.z,d,t.y-1).key]={backfilled:!1},E[new a.aM(f.overscaledZ,f.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},E[new a.aM(f.overscaledZ,S,t.z,v,t.y-1).key]={backfilled:!1}),t.y+1<s&&(E[new a.aM(f.overscaledZ,_,t.z,d,t.y+1).key]={backfilled:!1},E[new a.aM(f.overscaledZ,f.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},E[new a.aM(f.overscaledZ,S,t.z,v,t.y+1).key]={backfilled:!1}),E}},"raster-array":tu,geojson:class extends a.E{constructor(f,t,s,d){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(d),this._data=t.data,this._options=a.h({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const _=a.aj/this.tileSize;this.workerOptions=a.h({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*_,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*_,extent:a.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:a.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*_,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new a.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new a.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const s of this._data.features)t.set(s.id,s);for(const s of f.features)t.set(s.id,s);this._data.features=[...t.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},t),this}getClusterChildren(f,t){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},t),this}getClusterLeaves(f,t,s,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:t,offset:s},d),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=a.h({append:f},this.workerOptions);t.scope=this.scope;const s=this._data;typeof s=="string"?(t.request=this.map._requestManager.transformRequest(a.q.resolveURL(s),a.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new a.z(d));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(v.resourceTiming=_.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new a.A("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const f=a.C(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,t){const s=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,_=d?{image:d.image.clone()}:null,v=this._partialReload,S={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:a.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:v,worldview:this.map.getWorldview()};f.request=this.actor.send(s,S,((E,C)=>v&&!C?(f.state="loaded",t(null)):(delete f.request,f.destroy(),f.aborted?t(null):E?t(E):(f.loadVectorData(C,this.map.painter,s==="reloadTile"),t(null)))),void 0,s==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,t){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends a.aP{constructor(f,t,s,d){super(f,t,s,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const t of f.urls)this.urls.push(this.map._requestManager.transformRequest(t,a.R.Source).url);a.aQ(this.urls,((t,s)=>{this._loaded=!0,t?this.fire(new a.z(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const t=this.video.seekable;f<t.start(0)||f>t.end(0)?this.fire(new a.z(new a.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,t=f.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new a.T(f,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:a.aP,model:class extends a.E{constructor(f,t,s,d){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const f=[];for(const t in this._options.models){const s=this._options.models[t],d=a.aS(this.map._requestManager.transformRequest(s.uri,a.R.Model).url).then((_=>{if(!_)return;const v=a.aT(_),S=new a.aU(t,s.position,s.orientation,v);S.computeBoundsAndApplyParent(),this.models.push(S)})).catch((_=>{this.fire(new a.z(new Error(`Could not load model ${t} from ${s.uri}: ${_.message}`)))}));f.push(d)}Promise.allSettled(f).then((()=>{this._loaded=!0,this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((t=>{this._loaded=!0,this.fire(new a.z(new Error(`Could not load models: ${t.message}`)))}))}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,t){}serialize(){return this._options}},"batched-model":class extends a.E{constructor(f,t,s,d){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=a.C(this.id,this.scope);this.load((()=>this.map.style.clearSource(f)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new a.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=oo(this._options,this.map._requestManager,t,s,((d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new a.z(d))):_&&(a.h(this,_),_.bounds&&(this.tileBounds=new Qo(_.bounds,this.minzoom,this.maxzoom)),pt(_.tiles,this.map._requestManager._customAccessToken),this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))),f&&f(d)}))}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,t){const s=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(s,a.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:a.q.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=t;else{if(f.buckets){const v=Object.values(f.buckets);for(const S of v)S.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",d,_.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",d,_.bind(this),void 0,!0);function _(v,S){return f.aborted?t(null):v&&v.status!==404?t(v):(this.map._refreshExpiredTiles&&S&&f.setExpiryData(S),f.loadModelData(S,this.map.painter),f.state="loaded",void t(null))}}serialize(){return a.h({},this._options)}},canvas:class extends a.aP{constructor(f,t,s,d){super(f,t,s,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some((_=>!Array.isArray(_)||_.length!==2||_.some((v=>typeof v!="number"))))||this.fire(new a.z(new a.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.z(new a.V(`sources.${f}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new a.z(new a.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new a.z(new a.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.z(new a.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof a.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends a.E{constructor(f,t,s,d){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Qo(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),a.h(this,a.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new a.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:t,y:s,z:d}=f.canonical;return this._implementation.hasTile({x:t,y:s,z:d})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,t){const{x:s,y:d,z:_}=f.tileID.canonical,v=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:s,y:d,z:_},{signal:v.signal})).then(function(S){return delete f.request,f.aborted?(f.state="unloaded",t(null)):S===void 0?(f.state="errored",t(null)):S===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",t(null)):(function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement})(S)?(this.loadTileData(f,S),f.state="loaded",void t(null)):(f.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch((S=>{S.name!=="AbortError"&&(f.state="errored",t(S))})),f.request.cancel=()=>v.abort()}loadTileData(f,t){f.setTexture(t,this.map.painter)}unloadTile(f,t){if(f.texture&&f.texture instanceof a.T?(f.destroy(!0),f.texture&&f.texture instanceof a.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:s,y:d,z:_}=f.tileID.canonical;this._implementation.unloadTile({x:s,y:d,z:_})}t&&t()}abortTile(f,t){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z})))}_clearTiles(){const f=a.C(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new a.A("data",{dataType:"source",sourceDataType:"content"}))}}},ru=function(f,t,s,d){const _=new Jf[t.type](f,t,s,d);if(_.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${_.id}`);return a.aV(["load","abort","unload","serialize","prepare"],_),_};function nu(f,t,s=""){return`${s}:${t.id||""}:${t.layer.id}:${(function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:_,importId:v}=d;return`featureset:${_}${v?`:import:${v}`:""}`}})(f.target)}`}function iu(f,t,s,d=""){if(f.uniqueFeatureID){const _=nu(f,t,d);if(s.has(_))return!0;s.add(_)}return!1}function Xu(f,t,s,d,_=!1){const v=t.sourceCache.transform,S=t.sourceCache.tilesIn(f,t.has3DLayers,_);S.sort(Vc);const E=[];for(const C of S){const k=C.tile.queryRenderedFeatures(t,C,s,d,v,_);Object.keys(k).length&&E.push({wrappedTileID:C.tile.tileID.wrapped().key,queryResults:k})}return E.length===0?{}:(function(C){const k={},L={};for(const j of C){const B=j.queryResults,q=j.wrappedTileID,K=L[q]=L[q]||{};for(const Z in B){const J=B[Z],Y=K[Z]=K[Z]||{},se=k[Z]=k[Z]||[];for(const ce of J)Y[ce.featureIndex]||(Y[ce.featureIndex]=!0,se.push(ce))}}return k})(E)}function Ku(f,t,s,d,_,v){const S={},E=d.queryRenderedSymbols(f),C=[];for(const k of Object.keys(E).map(Number))C.push(_[k]);C.sort(Vc);for(const k of C){const L=k.featureIndex.lookupSymbolFeatures(E[k.bucketInstanceId],k.bucketIndex,k.sourceLayerIndex,t,s,v);for(const j in L){const B=S[j]=S[j]||[],q=L[j];q.sort(((K,Z)=>{const J=k.featureSortOrder;if(J){const Y=J.indexOf(K.featureIndex);return J.indexOf(Z.featureIndex)-Y}return Z.featureIndex-K.featureIndex}));for(const K of q)B.push(K)}}return S}function Nh(f,t){const s=f.getRenderableIds().map((v=>f.getTileByID(v))),d=[],_={};for(let v=0;v<s.length;v++){const S=s[v],E=S.tileID.canonical.key;_[E]||(_[E]=!0,S.querySourceFeatures(d,t))}return d}function Vc(f,t){const s=f.tileID,d=t.tileID;return s.overscaledZ-d.overscaledZ||s.canonical.y-d.canonical.y||s.wrap-d.wrap||s.canonical.x-d.canonical.x}function ds(f,t){const s={};if(!t)return s;for(const d of f){const _=d.layerIds.map((v=>t.getLayer(v))).filter(Boolean);if(_.length!==0){d.layers=_,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map((v=>_.filter((S=>S.id===v))[0])));for(const v of _)s[v.fqid]=d}}return s}const Ea=32,ua=33,Sl=new Uint16Array(8184);for(let f=0;f<2046;f++){let t=f+2,s=0,d=0,_=0,v=0,S=0,E=0;for(1&t?_=v=S=Ea:s=d=E=Ea;(t>>=1)>1;){const k=s+_>>1,L=d+v>>1;1&t?(_=s,v=d,s=S,d=E):(s=_,d=v,_=S,v=E),S=k,E=L}const C=4*f;Sl[C+0]=s,Sl[C+1]=d,Sl[C+2]=_,Sl[C+3]=v}const rs=new Uint16Array(2178),oi=new Uint8Array(1089),$c=new Uint16Array(1089);function Os(f){return f===0?-.03125:f===32?.03125:0}const Yu={type:2,extent:a.aj,loadGeometry:()=>[[new a.P(0,0),new a.P(a.aj+1,0),new a.P(a.aj+1,a.aj+1),new a.P(0,a.aj+1),new a.P(0,0)]]};class ou{constructor(t,s,d,_,v,S){this.tileID=t,this.uid=a.a$(),this.uses=0,this.tileSize=s,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection),this.worldview=S}registerFadeDuration(t){const s=t+this.timeAdded;s<a.q.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=a.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=ds(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof a.b1){if(this.hasSymbolBuckets=!0,!d)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const v=this.buckets[_];if(v instanceof a.b1&&v.hasRTLText){this.hasRTLText=!0,a.b2();break}}this.queryPadding=0;for(const _ in this.buckets){const v=this.buckets[_],S=s.style.getOwnLayer(_);if(!S)continue;const E=S.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,E)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new a.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,s,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,ds(t.buckets,s.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const _ in this.buckets){const v=this.buckets[_];v.uploadPending()&&v.upload(t)}const s=t.gl,d=this.imageAtlas;d&&!d.uploaded&&(this.imageAtlasTexture=new a.T(t,d.image,s.RGBA8,{useMipmap:!!d.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new a.T(t,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new a.T(t,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(t,s,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=s.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(s,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}queryRenderedFeatures(t,s,d,_,v,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const E=(function(C,k){const L=a.bn([],[.5*C.width,.5*-C.height,1]);return a.bo(L,L,[1,-1,0]),a.az(L,L,C.calculateProjMatrix(k.toUnwrapped())),Float32Array.from(L)})(v,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:s,pixelPosMatrix:E,transform:_,availableImages:d,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,s){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const _=d.loadVTLayers(),v=s?s.sourceLayer:"",S=_._geojsonTileLayer||_[v];if(!S)return;const E=a.b3(s&&s.filter),{z:C,x:k,y:L}=this.tileID.canonical,j={z:C,x:k,y:L};for(let B=0;B<S.length;B++){const q=S.feature(B);if(E.needGeometry){const J=a.b4(q,!0);if(!E.filter(new a.aa(this.tileID.overscaledZ,{worldview:this.worldview}),J,this.tileID.canonical))continue}else if(!E.filter(new a.aa(this.tileID.overscaledZ,{worldview:this.worldview}),q))continue;const K=d.getId(q,v),Z=new a.b5(q,C,k,L,K);Z.tile=j,t.push(Z)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const d=a.b6(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let _=!1;if(this.expirationTime>d)_=!1;else if(s)if(this.expirationTime<s)_=!0;else{const v=this.expirationTime-s;v?this.expirationTime=d+Math.max(v,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,s){if(!this.latestFeatureIndex||!t.style)return;const d=this.latestFeatureIndex.loadVTLayers(),_=t.style.listImages(),v=t.style.getBrightness();for(const S in this.buckets){if(!t.style.hasLayer(S))continue;const E=this.buckets[S],C=E.layers[0],k=C.sourceLayer||"_geojsonTileLayer",L=d[k],j=t.style.getLayerSourceCache(C);let B={};j&&(B=j._state.getState(k,void 0));const q=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},K=Object.keys(B).length>0&&!s;K&&!E.stateDependentLayers.length&&!s||E.update(B,L,_,q,K?E.stateDependentLayers:E.layers,s,v),(E instanceof a.b7||E instanceof a.b8)&&t._terrain&&t._terrain.enabled&&j&&E.uploadPending()&&t._terrain._clearRenderCacheForTile(j.id,this.tileID);const Z=t&&t.style&&t.style.getOwnLayer(S);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<a.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=a.q.now()+t}setTexture(t,s){const d=s.context,_=d.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof a.T?this.texture.update(t):(this.texture=new a.T(d,t,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(t,s){const d={};for(const _ of s)d[_]=!0;this.dependencies[t]=d}hasDependency(t,s){for(const d of t){const _=this.dependencies[d];if(_){for(const v of s)if(_[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const d=a.b9(Yu,this.tileID.canonical,this.tileTransform)[0],_=new a.ba,v=new a.bb;for(let S=0;S<d.length;S++){const{x:E,y:C}=d[S];_.emplaceBack(E,C),v.emplaceBack(S)}v.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(v),this._tileDebugBuffer=t.createVertexBuffer(_,a.bc.members),this._tileDebugSegments=a.bd.simpleSegment(0,0,_.length,v.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const d=a.b9(Yu,this.tileID.canonical,this.tileTransform)[0];let _,v;if(this.isRaster){const S=(function(E,C){const k=a.aW(E,C),L=Math.pow(2,E.z);for(let J=0;J<ua;J++)for(let Y=0;Y<ua;Y++){const se=a.aX((E.x+(Y+Os(Y))/Ea)/L),ce=a.aY((E.y+(J+Os(J))/Ea)/L),pe=C.project(se,ce),Se=J*ua+Y;rs[2*Se+0]=Math.round((pe.x*k.scale-k.x)*a.aj),rs[2*Se+1]=Math.round((pe.y*k.scale-k.y)*a.aj)}oi.fill(0),$c.fill(0);for(let J=2045;J>=0;J--){const Y=4*J,se=Sl[Y+0],ce=Sl[Y+1],pe=Sl[Y+2],Se=Sl[Y+3],Pe=se+pe>>1,Me=ce+Se>>1,Te=Pe+Me-ce,Ee=Me+se-Pe,Ae=ce*ua+se,We=Se*ua+pe,Le=Me*ua+Pe,ut=Math.hypot((rs[2*Ae+0]+rs[2*We+0])/2-rs[2*Le+0],(rs[2*Ae+1]+rs[2*We+1])/2-rs[2*Le+1])>=16;oi[Le]=oi[Le]||(ut?1:0),J<1022&&(oi[Le]=oi[Le]||oi[(ce+Ee>>1)*ua+(se+Te>>1)]||oi[(Se+Ee>>1)*ua+(pe+Te>>1)])}const j=new a.aZ,B=new a.a_;let q=0;function K(J,Y){const se=Y*ua+J;return $c[se]===0&&(j.emplaceBack(rs[2*se+0],rs[2*se+1],J*a.aj/Ea,Y*a.aj/Ea),$c[se]=++q),$c[se]-1}function Z(J,Y,se,ce,pe,Se){const Pe=J+se>>1,Me=Y+ce>>1;if(Math.abs(J-pe)+Math.abs(Y-Se)>1&&oi[Me*ua+Pe])Z(pe,Se,J,Y,Pe,Me),Z(se,ce,pe,Se,Pe,Me);else{const Te=K(J,Y),Ee=K(se,ce),Ae=K(pe,Se);B.emplaceBack(Te,Ee,Ae)}}return Z(0,0,Ea,Ea,Ea,0),Z(Ea,Ea,0,0,0,Ea),{vertices:j,indices:B}})(this.tileID.canonical,s);_=S.vertices,v=S.indices}else{_=new a.aZ,v=new a.a_;for(const{x:E,y:C}of d)_.emplaceBack(E,C,0,0);const S=a.be(_.int16.subarray(0,4*_.length),void 0,4);for(let E=0;E<S.length;E+=3)v.emplaceBack(S[E],S[E+1],S[E+2])}this._tileBoundsBuffer=t.createVertexBuffer(_,a.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(v),this._tileBoundsSegments=a.bd.simpleSegment(0,0,_.length,v.length)}_makeGlobeTileDebugBuffers(t,s){const d=s.projection;if(!d||d.name!=="globe"||s.freezeTileCoverage)return;const _=this.tileID.canonical,v=a.bg(_,s),S=a.bh(v),E=a.ah(s.zoom);let C;E>0&&(C=a.bi(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,_,s,S,C,E),this._makeGlobeTileDebugTextBuffer(t,_,s,S,C,E)}_globePoint(t,s,d,_,v,S,E){let C=a.bj(t,s,d);if(S){const k=1<<d.z,L=a.aD(_.center.lng),j=a.aH(_.center.lat),B=(d.x+.5)/k-L;let q=0;B>.5?q=-1:B<-.5&&(q=1);let K=(t/a.aj+d.x)/k+q,Z=(s/a.aj+d.y)/k;K=(K-L)*_._pixelsPerMercatorPixel+L,Z=(Z-j)*_._pixelsPerMercatorPixel+j;const J=[K*_.worldSize,Z*_.worldSize,0];a.ad(J,J,S),C=a.bk(C,J,E)}return a.ad(C,C,v)}_makeGlobeTileDebugBorderBuffer(t,s,d,_,v,S){const E=new a.ba,C=new a.bb,k=new a.bl,L=(B,q,K,Z,J)=>{const Y=(K-B)/(J-1),se=(Z-q)/(J-1),ce=E.length;for(let pe=0;pe<J;pe++){const Se=B+pe*Y,Pe=q+pe*se;E.emplaceBack(Se,Pe);const Me=this._globePoint(Se,Pe,s,d,_,v,S);k.emplaceBack(Me[0],Me[1],Me[2]),C.emplaceBack(ce+pe)}},j=a.aj;L(0,0,j,0,16),L(j,0,j,j,16),L(j,j,0,j,16),L(0,j,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(C),this._tileDebugBuffer=t.createVertexBuffer(E,a.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(k,a.bm.members),this._tileDebugSegments=a.bd.simpleSegment(0,0,E.length,C.length)}_makeGlobeTileDebugTextBuffer(t,s,d,_,v,S){const E=a.aj/4,C=new a.ba,k=new a.a_,L=new a.bl,j=25;k.reserve(32),C.reserve(j),L.reserve(j);const B=(q,K)=>j*q+K;for(let q=0;q<j;q++){const K=q*E;for(let Z=0;Z<j;Z++){const J=Z*E;C.emplaceBack(J,K);const Y=this._globePoint(J,K,s,d,_,v,S);L.emplaceBack(Y[0],Y[1],Y[2])}}for(let q=0;q<4;q++)for(let K=0;K<4;K++){const Z=B(q,K),J=B(q,K+1),Y=B(q+1,K),se=B(q+1,K+1);k.emplaceBack(Z,J,Y),k.emplaceBack(Y,J,se)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(k),this._tileDebugTextBuffer=t.createVertexBuffer(C,a.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(L,a.bm.members),this._tileDebugTextSegments=a.bd.simpleSegment(0,0,j,32)}destroy(t=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof a.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}a.bp.setPbf(a.bq);class Ju extends ou{constructor(t,s,d,_,v){super(t,s,d,_,v),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,s,d){const _=d.context,v=_.gl;let S=this.texturePerLayer.get(t)||d.getTileTexture(s.width);S&&S instanceof a.T?S.update(s,{premultiply:!1}):S=new a.T(_,s,v.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,S)}flushQueues(t){const s=this._workQueuePerLayer.get(t)||[],d=this._fetchQueuePerLayer.get(t)||[];for(;s.length;)s.pop()();for(;d.length;)d.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const s=this._workQueuePerLayer.get(t)||[];for(;s.length;)s.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const s=this._fetchQueuePerLayer.get(t)||[];for(;s.length;)s.pop()()}}fetchHeader(t=16384,s){const d=this._mrt=new a.bp(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=a.br(_,((v,S,E,C)=>{if(v)s(v);else try{const k=d.getHeaderLength(S);if(k>t)return void(this.request=this.fetchHeader(k,s));d.parseHeader(S),this._isHeaderLoaded=!0;let L=0;for(const j of Object.values(d.layers))L=Math.max(L,j.dataIndex[j.dataIndex.length-1].lastByte);S.byteLength>=L&&(this.entireBuffer=S),s(null,this.entireBuffer||S,E,C)}catch(k){s(k)}})),this.request}fetchBand(t,s,d,_){const v=this._mrt;if(!this._isHeaderLoaded||!v)return void _(new Error("Tile header is not ready"));const S=this.actor;if(!S)return void _(new Error("Can't fetch tile band without an actor"));let E;const C=(B,q)=>{if(E.complete(B,q),B)return void _(B);this.updateTextureDescriptor(t,s,d);const K=this.textureDescriptorPerLayer.get(s);_(null,K&&K.img)},k=(B,q)=>{if(B)return _(B);const K=S.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:q,task:E},C,void 0,!0),Z=this._workQueuePerLayer.get(s)||[];Z.push((()=>{K&&K.cancel(),E.cancel()})),this._workQueuePerLayer.has(s)||this._workQueuePerLayer.set(s,Z)},L=v.getLayer(t);if(!L)return void _(new Error(`Unknown sourceLayer "${t}"`));if(L.hasDataForBand(d)){this.updateTextureDescriptor(t,s,d);const B=this.textureDescriptorPerLayer.get(s);return void _(null,B?B.img:null)}const j=L.getDataRange([d]);if(E=v.createDecodingTask(j),!E||E.tasks.length)if(this.flushQueues(s),this.entireBuffer)k(null,this.entireBuffer.slice(j.firstByte,j.lastByte+1));else{const B=Object.assign({},this.requestParams,{headers:{Range:`bytes=${j.firstByte}-${j.lastByte}`}}),q=a.br(B,k),K=this._fetchQueuePerLayer.get(s)||[];K.push((()=>{q.cancel(),E.cancel()})),this._fetchQueuePerLayer.has(s)||this._fetchQueuePerLayer.set(s,K)}else _(null)}updateNeeded(t,s){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==s)&&this.state!=="errored"}updateTextureDescriptor(t,s,d){if(!this._mrt)return;const _=this._mrt.getLayer(t);if(!_||!_.hasBand(d)||!_.hasDataForBand(d))return;const{bytes:v,tileSize:S,buffer:E,offset:C,scale:k}=_.getBandView(d),L=S+2*E,j=new a.r({width:L,height:L},v),B=this.texturePerLayer.get(s);B&&B instanceof a.T&&B.update(j,{premultiply:!1}),this.textureDescriptorPerLayer.set(s,{layer:t,band:d,img:j,buffer:E,offset:C,tileSize:S,format:_.pixelFormat,mix:[k,256*k,65536*k,16777216*k]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const s of this.texturePerLayer.values())s&&s instanceof a.T&&s.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Qf{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,d){const _=t.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const v={value:s,timeout:void 0};if(d!==void 0&&(v.timeout=setTimeout((()=>{this.remove(t,v)}),d)),this.data[_].push(v),this.order.push(_),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const d=t.wrapped().key,_=s===void 0?0:this.data[d].indexOf(s),v=this.data[d][_];return this.data[d].splice(_,1),v.timeout&&clearTimeout(v.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(v.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const d in this.data)for(const _ of this.data[d])t(_.value)||s.push(_);for(const d of s)this.remove(d.value.tileID,d)}}class jh{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,d){const _=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][_]=this.stateChanges[t][_]||{},a.h(this.stateChanges[t][_],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const v in this.state[t])v!==_&&(this.deletedStates[t][v]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][_]===null){this.deletedStates[t][_]={};for(const v in this.state[t][_])d[v]||(this.deletedStates[t][_][v]=null)}else for(const v in d)this.deletedStates[t]&&this.deletedStates[t][_]&&this.deletedStates[t][_][v]===null&&delete this.deletedStates[t][_][v]}removeFeatureState(t,s,d){if(this.deletedStates[t]===null)return;const _=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&s!==void 0)this.deletedStates[t][_]!==null&&(this.deletedStates[t][_]=this.deletedStates[t][_]||{},this.deletedStates[t][_][d]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][_])for(d in this.deletedStates[t][_]={},this.stateChanges[t][_])this.deletedStates[t][_][d]=null;else this.deletedStates[t][_]=null;else this.deletedStates[t]=null}getState(t,s){const d=this.state[t]||{},_=this.stateChanges[t]||{},v=this.deletedStates[t];if(v===null)return{};if(s!==void 0){const E=String(s),C=a.h({},d[E],_[E]);if(v){const k=v[s];if(k===null)return{};for(const L in k)delete C[L]}return C}const S=a.h({},d,_);if(v)for(const E in v)delete S[E];return S}initializeTileState(t,s){t.refreshFeatureState(s)}coalesceChanges(t,s){const d={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const v={};for(const S in this.stateChanges[_])this.state[_][S]||(this.state[_][S]={}),a.h(this.state[_][S],this.stateChanges[_][S]),v[S]=this.state[_][S];d[_]=v}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const v={};if(this.deletedStates[_]===null)for(const S in this.state[_])v[S]={},this.state[_][S]={};else for(const S in this.deletedStates[_]){if(this.deletedStates[_][S]===null)this.state[_][S]={};else if(this.state[_][S])for(const E of Object.keys(this.deletedStates[_][S]))delete this.state[_][S][E];v[S]=this.state[_][S]}d[_]=d[_]||{},a.h(d[_],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const _ in t)t[_].refreshFeatureState(s)}}class Go extends a.E{constructor(t,s,d){super(),this.id=t,this._onlySymbols=d,s.on("data",(_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),s.on("error",(()=>{this._sourceErrored=!0})),this._source=s,this._tiles={},this._cache=new Qf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new jh,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const d=this._tiles[s];d.upload(t),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(Ba).map((t=>t.key))}getRenderableIds(t,s){const d=[];for(const _ in this._tiles)this._isIdRenderable(+_,t,s)&&d.push(this._tiles[_]);return t?d.sort(((_,v)=>{const S=_.tileID,E=v.tileID,C=new a.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),k=new a.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-E.overscaledZ||k.y-C.y||k.x-C.x})).map((_=>_.tileID.key)):d.map((_=>_.tileID)).sort(Ba).map((_=>_.key))}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=s),this._loadTile(d,this._tileLoaded.bind(this,d,t,s)))}_tileLoaded(t,s,d,_){if(_)if(t.state="errored",_.status!==404)this._source.fire(new a.z(_,{tile:t}));else{if(this._source.fire(new a.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=a.q.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new a.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const s=this.getRenderableIds();for(let _=0;_<s.length;_++){const v=s[_];if(t.neighboringTiles&&t.neighboringTiles[v]){const S=this.getTileByID(v);d(t,S),d(S,t)}}function d(_,v){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let S=v.tileID.canonical.x-_.tileID.canonical.x;const E=v.tileID.canonical.y-_.tileID.canonical.y,C=Math.pow(2,_.tileID.canonical.z),k=v.tileID.key;S===0&&E===0||Math.abs(E)>1||(Math.abs(S)>1&&(Math.abs(S+C)===1?S+=C:Math.abs(S-C)===1&&(S-=C)),v.dem&&_.dem&&(_.dem.backfillBorder(v.dem,S,E),_.neighboringTiles&&_.neighboringTiles[k]&&(_.neighboringTiles[k].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,d,_){for(const v in this._tiles){let S=this._tiles[v];if(_[v]||!S.hasData()||S.tileID.overscaledZ<=s||S.tileID.overscaledZ>d)continue;let E=S.tileID;for(;S&&S.tileID.overscaledZ>s+1;){const k=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[k.key],S&&S.hasData()&&(E=k)}let C=E;for(;C.overscaledZ>s;)if(C=C.scaledTo(C.overscaledZ-1),t[C.key]){_[E.key]=E;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=s?d:null}for(let d=t.overscaledZ-1;d>=s;d--){const _=t.scaledTo(d),v=this._getLoadedTile(_);if(v)return v}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const d=Math.ceil(t.width/s)+1,_=Math.ceil(t.height/s)+1,v=Math.floor(d*_*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(E)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const d={};for(const _ in this._tiles){const v=this._tiles[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+s),d[v.tileID.key]=v}this._tiles=d;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(t,s,d,_,v){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const S=this._source.type==="batched-model";let E,C=this._source.maxzoom;const k=this.map&&this.map.painter?this.map.painter._terrain:null;if(k&&k.sourceCache===this&&k.attenuationRange()){const B=k.attenuationRange()[0],q=Math.floor(B)-Math.log2(k.getDemUpscale());C>q&&(C=q)}if(this.used||this.usedForTerrain){if(this._source.tileID)E=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((B=>new a.aM(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y)));else if(this.tileCoverLift!==0){const B=t.clone();B.tileCoverLift=this.tileCoverLift,E=B.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.minzoom<=1&&t.projection.name==="globe"&&(E.push(new a.aM(1,0,1,0,0)),E.push(new a.aM(1,0,1,1,0)),E.push(new a.aM(1,0,1,0,1)),E.push(new a.aM(1,0,1,1,1)))}else if(E=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.hasTile){const B=this._source.hasTile.bind(this._source);E=E.filter((q=>B(q)))}}else E=[];if(E.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ps(this._source.type)){const B=t.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),q=Math.min(B,this._source.maxzoom);if(S){const K=t.extendTileCover(E,q);for(const Z of K)E.push(Z)}else if(v){const K=t.extendTileCoverToNearPlane(E,this.transform.getFrustum(q),q);for(const Z of K)E.push(Z)}else if(this.castsShadows&&_){const K=t.extendTileCover(E,q,_);for(const Z of K)this._shadowCasterTiles[Z.key]=!0,E.push(Z)}}const L=this._updateRetainedTiles(E);if(ps(this._source.type)&&E.length!==0){const B={},q={},K=Object.keys(L);for(const J of K){const Y=L[J],se=this._tiles[J];if(!se||se.fadeEndTime&&se.fadeEndTime<=a.q.now())continue;const ce=this.findLoadedParent(Y,Math.max(Y.overscaledZ-Go.maxOverzooming,this._source.minzoom));ce&&(this._addTile(ce.tileID),B[ce.tileID.key]=ce.tileID),q[J]=Y}const Z=E[E.length-1].overscaledZ;for(const J in this._tiles){const Y=this._tiles[J];if(L[J]||!Y.hasData())continue;let se=Y.tileID;for(;se.overscaledZ>Z;){se=se.scaledTo(se.overscaledZ-1);const ce=this._tiles[se.key];if(ce&&ce.hasData()&&q[se.key]){L[J]=Y.tileID;break}}}for(const J in B)L[J]||(this._coveredTiles[J]=!0,L[J]=B[J])}for(const B in L)this._tiles[B].clearFadeHold();const j=a.bs(this._tiles,L);for(const B of j){const q=this._tiles[B];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(+B)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(t.length===0)return s;const d={},_=t.reduce(((k,L)=>Math.min(k,L.overscaledZ)),1/0),v=t[0].overscaledZ,S=Math.max(v-Go.maxOverzooming,this._source.minzoom),E=Math.max(v+Go.maxUnderzooming,this._source.minzoom),C={};for(const k of t){const L=this._addTile(k);s[k.key]=k,L.hasData()||_<this._source.maxzoom&&(C[k.key]=k)}this._retainLoadedChildren(C,_,E,s);for(const k of t){let L=this._tiles[k.key];if(L.hasData())continue;if(k.canonical.z>=this._source.maxzoom){const B=k.children(this._source.maxzoom)[0],q=this.getTile(B);if(q&&q.hasData()){s[B.key]=B;continue}}else{const B=k.children(this._source.maxzoom);if(s[B[0].key]&&s[B[1].key]&&s[B[2].key]&&s[B[3].key])continue}let j=L.wasRequested();for(let B=k.overscaledZ-1;B>=S;--B){const q=k.scaledTo(B);if(d[q.key]||(d[q.key]=!0,L=this.getTile(q),!L&&j&&(L=this._addTile(q)),L&&(s[q.key]=q,j=L.wasRequested(),L.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let d,_=this._tiles[t].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){d=this._loadedParentTiles[_.key];break}s.push(_.key);const v=_.scaledTo(_.overscaledZ-1);if(d=this._getLoadedTile(v),d)break;_=v}for(const v of s)this._loadedParentTiles[v]=d}}_addTile(t){let s=this._tiles[t.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const d=!!s;if(!d){const _=this.map?this.map.painter:null,v=this._source.tileSize*t.overscaleFactor();s=this._source.type==="raster-array"?new Ju(t,v,this.transform.tileZoom,_,this._isRaster):new ou(t,v,this.transform.tileZoom,_,this._isRaster,this._source.worldview),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s.uses++,this._tiles[t.key]=s,d||this._source.fire(new a.A("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=s.getExpiryTimeout();d&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),d))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,d){const _=[],v=this.transform;if(!v)return _;const S=v.projection.name==="globe",E=a.aD(v.center.lng);for(const C in this._tiles){const k=this._tiles[C];if(d&&k.clearQueryDebugViz(),k.holdingForFade())continue;let L;if(S){const j=k.tileID.canonical;if(j.z===0){const B=[Math.abs(a.ay(E,...ns(j,-1))-E),Math.abs(a.ay(E,...ns(j,1))-E)];L=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(a.ay(E,...ns(j,-1))-E),Math.abs(a.ay(E,...ns(j,0))-E),Math.abs(a.ay(E,...ns(j,1))-E)];L=[B.indexOf(Math.min(...B))-1]}}else L=[0];for(const j of L){const B=t.containsTile(k,v,s,j);B&&_.push(B)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,s){const d=this.getRenderableIds(t,s).map((v=>this._tiles[v].tileID)),_=this.transform.projection.name==="globe";for(const v of d)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=_?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return d}sortCoordinatesByDistance(t){const s=t.slice(),d=this.transform._camera.position,_=this.transform._camera.forward(),v={};for(const S of s){const E=1/(1<<S.canonical.z);v[S.key]=((S.canonical.x+.5)*E+S.wrap-d[0])*_[0]+((S.canonical.y+.5)*E-d[1])*_[1]-d[2]*_[2]}return s.sort(((S,E)=>v[S.key]-v[E.key])),s}hasTransition(){if(this._source.hasTransition())return!0;if(ps(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=a.q.now())return!0}return!1}setFeatureState(t,s,d){this._state.updateState(t=t||"_geojsonTileLayer",s,d)}removeFeatureState(t,s,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,d)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,d){const _=this._tiles[t];_&&_.setDependencies(s,d)}reloadTilesForDependencies(t,s){for(const d in this._tiles)this._tiles[d].hasDependency(t,s)&&this._reloadTile(+d,"reloading");this._cache.filter((d=>!d.hasDependency(t,s)))}_preloadTiles(t,s){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(t,s))};return void this._source.on("data",C)}const d=new Map,_=Array.isArray(t)?t:[t],v=this.map.painter.terrain,S=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const C of _){const k=C.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of k)d.set(L.key,L);this.usedForTerrain&&C.updateElevation(!1)}const E=Array.from(d.values());a.bt(E,((C,k)=>{const L=new ou(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(L,(j=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),k(j,L)}))}),s)}}function Ba(f,t){const s=Math.abs(2*f.wrap)-+(f.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return f.overscaledZ-t.overscaledZ||d-s||t.canonical.y-f.canonical.y||t.canonical.x-f.canonical.x}function ps(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function ns(f,t){const s=1<<f.z;return[f.x/s+t,(f.x+1)/s+t]}Go.maxOverzooming=10,Go.maxUnderzooming=3;class qc{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,s=!1;for(const d in this.style._mergedLayers){const _=this.style._mergedLayers[d];if(_.type==="fill-extrusion"||_.type==="building")this.layers.push({layer:_,visible:t,visibilityChanged:s});else if(_.type==="model"){const v=this.style.getLayerSource(_);v&&v.type==="batched-model"&&this.layers.push({layer:_,visible:t,visibilityChanged:s})}}}onNewFrame(t){this.layersGotHidden=!1;for(const s of this.layers){const d=s.layer;let _=!1;d.type==="fill-extrusion"?_=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="building"?_=!d.isHidden(t)&&d.paint.get("building-opacity")>0:d.type==="model"&&(_=!d.isHidden(t)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&s.visible,s.visible=_}}updateZOffset(t,s){this.currentBuildingBuckets=[];for(const _ of this.layers){const v=_.layer,S=this.style.getLayerSourceCache(v);let E=1;v.type==="fill-extrusion"?E=_.visible?v.paint.get("fill-extrusion-vertical-scale"):0:v.type==="building"&&(E=_.visible?v.paint.get("building-vertical-scale"):0);let C=S?S.getTile(s):null;if(!C&&S)for(const k in S._tiles){const L=S._tiles[k];if(s.canonical.isChildOf(L.tileID.canonical)){C=L;break}}this.currentBuildingBuckets.push({bucket:C?C.getBucket(v):null,tileID:C?C.tileID:s,verticalScale:E})}t.hasAnyZOffset=!1;let d=!1;for(let _=0;_<t.symbolInstances.length;_++){const v=t.symbolInstances.get(_),S=v.zOffset,E=this._getHeightAtTileOffset(s,v.tileAnchorX,v.tileAnchorY);v.zOffset=E!==Number.NEGATIVE_INFINITY?E:S,d||S===v.zOffset||(d=!0),t.hasAnyZOffset||v.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,s,d,_){let v=s,S=d;if(t.canonical.z!==_.canonical.z){const E=_.canonical,C=1/(1<<t.canonical.z-E.z);v=(s+t.canonical.x*a.aj)*C-E.x*a.aj|0,S=(d+t.canonical.y*a.aj)*C-E.y*a.aj|0}return{tileX:v,tileY:S}}_getHeightAtTileOffset(t,s,d){let _,v;for(let S=0;S<this.layers.length;++S){const E=this.layers[S].layer;if(E.type!=="fill-extrusion"&&E.type!=="building")continue;const{bucket:C,tileID:k,verticalScale:L}=this.currentBuildingBuckets[S];if(!C)continue;const{tileX:j,tileY:B}=this._mapCoordToOverlappingTile(t,s,d,k),q=C.getHeightAtTileCoord(j,B);q&&q.height!==void 0&&(q.hidden?_=q.height:v=Math.max(q.height*L,v||0))}if(v!==void 0)return v;for(let S=0;S<this.layers.length;++S){const E=this.layers[S];if(E.layer.type!=="model"||!E.visible)continue;const{bucket:C,tileID:k}=this.currentBuildingBuckets[S];if(!C)continue;const{tileX:L,tileY:j}=this._mapCoordToOverlappingTile(t,s,d,k),B=C.getHeightAtTileCoord(L,j);if(B&&!B.hidden)return B.height===void 0&&_!==void 0?Math.min(B.maxHeight,_)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Gc(f,t){const s={};for(const d in f)d!=="ref"&&(s[d]=f[d]);return a.bu.forEach((d=>{d in t&&(s[d]=t[d])})),s}function ms(f){f=f.slice();const t=Object.create(null);for(let s=0;s<f.length;s++)t[f[s].id]=f[s];for(let s=0;s<f.length;s++)"ref"in f[s]&&(f[s]=Gc(f[s],t[f[s].ref]));return f}const bn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Uh(f,t,s){s.push({command:bn.addSource,args:[f,t[f]]})}function ol(f,t,s){t.push({command:bn.removeSource,args:[f]}),s[f]=!0}function Vh(f,t,s,d){ol(f,s,d),Uh(f,t,s)}function wm(f,t,s){let d;for(d in f[s])if(f[s].hasOwnProperty(d)&&d!=="data"&&!a.bv(f[s][d],t[s][d]))return!1;for(d in t[s])if(t[s].hasOwnProperty(d)&&d!=="data"&&!a.bv(f[s][d],t[s][d]))return!1;return!0}function au(f,t,s,d,_,v){let S;for(S in t=t||{},f=f||{})f.hasOwnProperty(S)&&(a.bv(f[S],t[S])||s.push({command:v,args:[d,S,t[S],_]}));for(S in t)t.hasOwnProperty(S)&&!f.hasOwnProperty(S)&&(a.bv(f[S],t[S])||s.push({command:v,args:[d,S,t[S],_]}))}function su(f){return f.id}function lu(f,t){return f[t.id]=t,f}function Tl(f,t,s){const d=t.createTileMatrix(f,f.worldSize,s.toUnwrapped());return a.az(new Float32Array(16),f.projMatrix,d)}function Hc(f,t,s){if(t.projection.name===s.projection.name)return f.projMatrix;const d=s.clone();return d.setProjection(t.projection),Tl(d,t.getProjection(),f)}function El(f,t,s){return t.name===s.projection.name?f.projMatrix:Tl(s,t,f)}class $h{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.ay(t,0,1);let s=1,d=this._distances[s];const _=t*this.paddedLength+this.padding;for(;d<_&&s<this._distances.length;)d=this._distances[++s];const v=s-1,S=this._distances[v],E=d-S,C=E>0?(_-S)/E:0;return this.points[v].mult(1-C).add(this.points[s].mult(C))}}class Wc{constructor(t,s,d){const _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(s/d);for(let S=0;S<this.xCellCount*this.yCellCount;S++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,d,_,v){this._forEachCell(s,d,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(t,s,d,_){this._forEachCell(s-_,d-_,s+_,d+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(d),this.circles.push(_)}_insertBoxCell(t,s,d,_,v,S){this.boxCells[v].push(S)}_insertCircleCell(t,s,d,_,v,S){this.circleCells[v].push(S)}_query(t,s,d,_,v,S){if(d<0||t>this.width||_<0||s>this.height)return!v&&[];const E=[];if(t<=0&&s<=0&&this.width<=d&&this.height<=_){if(v)return!0;for(let C=0;C<this.boxKeys.length;C++)E.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const k=this.circles[3*C],L=this.circles[3*C+1],j=this.circles[3*C+2];E.push({key:this.circleKeys[C],x1:k-j,y1:L-j,x2:k+j,y2:L+j})}return S?E.filter(S):E}return this._forEachCell(t,s,d,_,this._queryCell,E,{hitTest:v,seenUids:{box:{},circle:{}}},S),v?E.length>0:E}_queryCircle(t,s,d,_,v){const S=t-d,E=t+d,C=s-d,k=s+d;if(E<0||S>this.width||k<0||C>this.height)return!_&&[];const L=[];return this._forEachCell(S,C,E,k,this._queryCellCircle,L,{hitTest:_,circle:{x:t,y:s,radius:d},seenUids:{box:{},circle:{}}},v),_?L.length>0:L}query(t,s,d,_,v){return this._query(t,s,d,_,!1,v)}hitTest(t,s,d,_,v){return this._query(t,s,d,_,!0,v)}hitTestCircle(t,s,d,_){return this._queryCircle(t,s,d,!0,_)}_queryCell(t,s,d,_,v,S,E,C){const k=E.seenUids,L=this.boxCells[v];if(L!==null){const B=this.bboxes;for(const q of L)if(!k.box[q]){k.box[q]=!0;const K=4*q;if(t<=B[K+2]&&s<=B[K+3]&&d>=B[K+0]&&_>=B[K+1]&&(!C||C(this.boxKeys[q]))){if(E.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[q],x1:B[K],y1:B[K+1],x2:B[K+2],y2:B[K+3]})}}}const j=this.circleCells[v];if(j!==null){const B=this.circles;for(const q of j)if(!k.circle[q]){k.circle[q]=!0;const K=3*q;if(this._circleAndRectCollide(B[K],B[K+1],B[K+2],t,s,d,_)&&(!C||C(this.circleKeys[q]))){if(E.hitTest)return S.push(!0),!0;{const Z=B[K],J=B[K+1],Y=B[K+2];S.push({key:this.circleKeys[q],x1:Z-Y,y1:J-Y,x2:Z+Y,y2:J+Y})}}}}}_queryCellCircle(t,s,d,_,v,S,E,C){const k=E.circle,L=E.seenUids,j=this.boxCells[v];if(j!==null){const q=this.bboxes;for(const K of j)if(!L.box[K]){L.box[K]=!0;const Z=4*K;if(this._circleAndRectCollide(k.x,k.y,k.radius,q[Z+0],q[Z+1],q[Z+2],q[Z+3])&&(!C||C(this.boxKeys[K])))return S.push(!0),!0}}const B=this.circleCells[v];if(B!==null){const q=this.circles;for(const K of B)if(!L.circle[K]){L.circle[K]=!0;const Z=3*K;if(this._circlesCollide(q[Z],q[Z+1],q[Z+2],k.x,k.y,k.radius)&&(!C||C(this.circleKeys[K])))return S.push(!0),!0}}}_forEachCell(t,s,d,_,v,S,E,C){const k=this._convertToXCellCoord(t),L=this._convertToYCellCoord(s),j=this._convertToXCellCoord(d),B=this._convertToYCellCoord(_);for(let q=k;q<=j;q++)for(let K=L;K<=B;K++)if(v.call(this,t,s,d,_,this.xCellCount*K+q,S,E,C))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,d,_,v,S){const E=_-t,C=v-s,k=d+S;return k*k>E*E+C*C}_circleAndRectCollide(t,s,d,_,v,S,E){const C=(S-_)/2,k=Math.abs(t-(_+C));if(k>C+d)return!1;const L=(E-v)/2,j=Math.abs(s-(v+L));if(j>L+d)return!1;if(k<=C||j<=L)return!0;const B=k-C,q=j-L;return B*B+q*q<=d*d}}const Qu={unknown:0,flipRequired:1,flipNotRequired:2},ed=Math.tan(85*Math.PI/180);function uu(f,t,s,d,_,v,S){const E=a.bz();if(s)if(v.name==="globe"){const C=a.bA(_,t);a.az(E,E,C)}else{const C=a.bB([],S);E[0]=C[0],E[1]=C[1],E[4]=C[2],E[5]=C[3],d||a.by(E,E,_.angle)}else a.az(E,_.labelPlaneMatrix,f);return E}function cu(f,t,s,d,_,v,S){const E=uu(f,t,s,d,_,v,S);return v.name==="globe"&&s||(E[2]=E[6]=E[10]=E[14]=0),E}function al(f,t,s,d,_,v,S){if(s){if(v.name==="globe"){const E=uu(f,t,s,d,_,v,S);return a.bi(E,E),a.az(E,f,E),E}{const E=a.bw(f),C=a.bx([]);return C[0]=S[0],C[1]=S[1],C[4]=S[2],C[5]=S[3],a.az(E,E,C),d||a.by(E,E,-_.angle),E}}return _.glCoordMatrix}function Io(f,t,s,d){const _=[f,t,s,1];s?a.aA(_,_,d):Sm(_,_,d);const v=_[3];return _[0]/=v,_[1]/=v,_[2]/=v,_}function qh(f,t){return Math.min(.5+f/t*.5,1.5)}function Zc(f,t){const s=f[0]/f[3],d=f[1]/f[3];return s>=-t[0]&&s<=t[0]&&d>=-t[1]&&d<=t[1]}function hu(f,t,s,d,_,v,S,E,C,k){const L=s.transform,j=d?f.textSizeData:f.iconSizeData,B=a.bH(j,s.transform.zoom),q=L.projection.name==="globe",K=[256/s.width*2+1,256/s.height*2+1],Z=d?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Z.clear();let J=null;q&&(J=d?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const Y=f.lineVertexArray,se=d?f.text.placedSymbolArray:f.icon.placedSymbolArray,ce=s.transform.width/s.transform.height;let pe,Se=!1;for(let Pe=0;Pe<se.length;Pe++){const Me=se.get(Pe),{numGlyphs:Te,writingMode:Ee}=Me;if(Ee!==a.bI.vertical||Se||pe===a.bI.horizontal||(Se=!0),pe=Ee,(Me.hidden||Ee===a.bI.vertical)&&!Se){sl(Te,Z);continue}Se=!1;const Ae=new a.P(Me.tileAnchorX,Me.tileAnchorY);let{x:We,y:Le,z:ut}=L.projection.projectTilePoint(Ae.x,Ae.y,k.canonical);if(C){const[lr,pr,Yt]=C(Ae);We+=lr,Le+=pr,ut+=Yt}const Je=[We,Le,ut,1];if(a.aA(Je,Je,t),!Zc(Je,K)){sl(Te,Z);continue}const dt=Je[3],wt=qh(s.transform.getCameraToCenterDistance(L.projection),dt),qe=a.bJ(j,B,Me),Re=S?qe/wt:qe*wt,tt=Io(We,Le,ut,_);if(tt[3]<=0){sl(Te,Z);continue}let Ye={};const vt=a.al(f.layers[0].layout.get("text-max-angle")),bt=Math.cos(vt),It=S?null:C,Dt=Gh(Me,Re,!1,E,t,_,v,f.glyphOffsetArray,Y,Z,J,tt,Ae,Ye,ce,It,L.projection,k,S,bt);Se=Dt.useVertical,It&&Dt.needsFlipping&&(Ye={}),(Dt.notEnoughRoom||Se||Dt.needsFlipping&&Gh(Me,Re,!0,E,t,_,v,f.glyphOffsetArray,Y,Z,J,tt,Ae,Ye,ce,It,L.projection,k,S,bt).notEnoughRoom)&&sl(Te,Z)}d?(f.text.dynamicLayoutVertexBuffer.updateData(Z),J&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(J)):(f.icon.dynamicLayoutVertexBuffer.updateData(Z),J&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(J))}function ea(f,t,s,d,_,v,S,E,C,k,L,j,B,q,K,Z,J){const{lineStartIndex:Y,glyphStartIndex:se,segment:ce}=E,pe=se+E.numGlyphs,Se=Y+E.lineLength,Pe=t.getoffsetX(se),Me=t.getoffsetX(pe-1),Te=ec(f*Pe,s,d,_,v,S,ce,Y,Se,C,k,L,j,B,!0,q,K,Z,J);if(!Te)return null;const Ee=ec(f*Me,s,d,_,v,S,ce,Y,Se,C,k,L,j,B,!0,q,K,Z,J);return Ee?{first:Te,last:Ee}:null}function Xc(f,t,s,d){return f===a.bI.horizontal&&Math.abs(d)>Math.abs(s)?{useVertical:!0}:f===a.bI.vertical?d>0?{needsFlipping:!0}:null:t!==Qu.unknown&&(function(_,v){return _===0||Math.abs(v/_)>ed})(s,d)?t===Qu.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function Gh(f,t,s,d,_,v,S,E,C,k,L,j,B,q,K,Z,J,Y,se,ce){const pe=t/24,Se=f.lineOffsetX*pe,Pe=f.lineOffsetY*pe,{lineStartIndex:Me,glyphStartIndex:Te,numGlyphs:Ee,segment:Ae,writingMode:We,flipState:Le}=f,ut=Me+f.lineLength,Je=dt=>{if(L){const[tt,Ye,vt]=dt.up,bt=k.length;a.bK(L,bt+0,tt,Ye,vt),a.bK(L,bt+1,tt,Ye,vt),a.bK(L,bt+2,tt,Ye,vt),a.bK(L,bt+3,tt,Ye,vt)}const[wt,qe,Re]=dt.point;a.bL(k,wt,qe,Re,dt.angle)};if(Ee>1){const dt=ea(pe,E,Se,Pe,s,j,B,f,C,v,q,Z,!1,J,Y,se,ce);if(!dt)return{notEnoughRoom:!0};if(d&&!s){let[wt,qe,Re]=dt.first.point,[tt,Ye,vt]=dt.last.point;[wt,qe]=Io(wt,qe,Re,S),[tt,Ye]=Io(tt,Ye,vt,S);const bt=Xc(We,Le,(tt-wt)*K,Ye-qe);if(f.flipState=bt&&bt.needsFlipping?Qu.flipRequired:Qu.flipNotRequired,bt)return bt}Je(dt.first);for(let wt=Te+1;wt<Te+Ee-1;wt++){const qe=ec(pe*E.getoffsetX(wt),Se,Pe,s,j,B,Ae,Me,ut,C,v,q,Z,!1,!1,J,Y,se,ce);if(!qe)return k.length-=4*(wt-Te),{notEnoughRoom:!0};Je(qe)}Je(dt.last)}else{if(d&&!s){const wt=Io(B.x,B.y,0,_),qe=Me+Ae+1,Re=new a.P(C.getx(qe),C.gety(qe)),tt=Io(Re.x,Re.y,0,_),Ye=tt[3]>0?tt:wn(B,Re,wt,1,_,void 0,J,Y.canonical),vt=Xc(We,Le,(Ye[0]-wt[0])*K,Ye[1]-wt[1]);if(f.flipState=vt&&vt.needsFlipping?Qu.flipRequired:Qu.flipNotRequired,vt)return vt}const dt=ec(pe*E.getoffsetX(Te),Se,Pe,s,j,B,Ae,Me,ut,C,v,q,Z,!1,!1,J,Y,se,ce);if(!dt)return{notEnoughRoom:!0};Je(dt)}return{}}function Aa(f,t,s,d,_){const{x:v,y:S,z:E}=d.projectTilePoint(f.x,f.y,t);if(!_)return Io(v,S,E,s);const[C,k,L]=_(f);return Io(v+C,S+k,E+L,s)}function wn(f,t,s,d,_,v,S,E){const C=Aa(f.sub(t)._unit()._add(f),E,_,S,v);return a.at(C,s,C),a.au(C,C),a.bE(C,s,C,d)}function ec(f,t,s,d,_,v,S,E,C,k,L,j,B,q,K,Z,J,Y,se){const ce=d?f-t:f+t;let pe=ce>0?1:-1,Se=0;d&&(pe*=-1,Se=Math.PI),pe<0&&(Se+=Math.PI);let Pe=E+S+(pe>0?0:1)|0,Me=_,Te=_,Ee=0,Ae=0;const We=Math.abs(ce),Le=[],ut=[];let Je=v,dt=Je,wt=a.bC([]);const qe=()=>wn(dt,Je,Te,We-Ee+1,L,B,Z,J.canonical);for(;Ee+Ae<=We;){if(Pe+=pe,Pe<E||Pe>=C)return null;if(Te=Me,dt=Je,Le.push(Te),q&&ut.push(dt),Je=new a.P(k.getx(Pe),k.gety(Pe)),Me=j[Pe],!Me){const Yt=Aa(Je,J.canonical,L,Z,B);Me=Yt[3]>0?j[Pe]=Yt:qe()}Ee+=Ae;const lr=a.at([],Me,Te),pr=a.bD(Te,Me);if(s&&pr>0&&Ae>0&&a.bG(wt,lr)/(Ae*pr)<se)return null;Ae=pr,wt=lr}K&&B&&(j[Pe]&&(Me=qe(),Ae=a.bD(Te,Me),wt=a.at([],Me,Te)),j[Pe]=Me);const Re=(We-Ee)/Ae,tt=Je.sub(dt)._mult(Re)._add(dt),Ye=a.bE([],Te,wt,Re);let vt=[0,0,1],bt=wt[0],It=wt[1];if(Y&&(vt=Z.upVector(J.canonical,tt.x,tt.y),vt[0]!==0||vt[1]!==0||vt[2]!==1)){const lr=[vt[2],0,-vt[0]],pr=a.bF([],vt,lr);a.au(lr,lr),a.au(pr,pr),bt=a.bG(wt,lr),It=a.bG(wt,pr)}if(s){const lr=a.bF([],vt,wt);a.au(lr,lr),a.bE(Ye,Ye,lr,s*pe)}const Dt=Se+Math.atan2(It,bt);return Le.push(Ye),q&&ut.push(tt),{point:Ye,angle:Dt,path:Le,tilePath:ut,up:vt}}function sl(f,t){const s=t.length,d=s+4*f;t.resize(d),t.float32.fill(-1/0,4*s,4*d)}function Sm(f,t,s){const d=t[0],_=t[1];return f[0]=s[0]*d+s[4]*_+s[12],f[1]=s[1]*d+s[5]*_+s[13],f[3]=s[3]*d+s[7]*_+s[15],f}const wr=100;class td{constructor(t,s,d=new Wc(t.width+200,t.height+200,25),_=new Wc(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=_,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+wr,this.screenBottomBoundary=t.height+wr,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,d,_,v,S,E,C,k,L,j){let B=d.projectedAnchorX,q=d.projectedAnchorY,K=d.projectedAnchorZ;const Z=d.tileAnchorX,J=d.tileAnchorY,Y=d.elevation,se=d.tileID,ce=t.getProjection();if(Y&&se){const[ut,Je,dt]=ce.upVector(se.canonical,d.tileAnchorX,d.tileAnchorY),wt=ce.upVectorScale(se.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=ut*Y*wt,q+=Je*Y*wt,K+=dt*Y*wt}const pe=t.projection.name==="globe",Se=t.projection.name==="globe"?a.ah(this.transform.zoom):0;if(se&&pe&&Se<1&&!S){const ut=1<<se.canonical.z,Je=a.bM(Z,J);a.bN(Je,Je,1/a.aj),a.bO(Je,Je,a.bM(se.canonical.x,se.canonical.y)),a.bN(Je,Je,1/ut),a.bP(Je,Je,a.bM(_[0],_[1])),Je[0]=a.bQ(Je[0],-.5,.5),a.bN(Je,Je,a.aj);const dt=a.bR(Je[0],Je[1],a.aj/(2*Math.PI),1);a.aA(dt,dt,v),B=a.ai(B,dt[0],Se),q=a.ai(q,dt[1],Se),K=a.ai(K,dt[2],Se)}const Pe=this.projectAndGetPerspectiveRatio(L,B,q,K,d.tileID,ce.name==="globe"||!!Y||this.transform.pitch>0,ce),Me=k*Pe.perspectiveRatio,Te=(d.x1*s+E.x-d.padding)*Me+Pe.point.x,Ee=(d.y1*s+E.y-d.padding)*Me+Pe.point.y,Ae=(d.x2*s+E.x+d.padding)*Me+Pe.point.x,We=(d.y2*s+E.y+d.padding)*Me+Pe.point.y,Le=Pe.perspectiveRatio<=.55||Pe.occluded;return!this.isInsideGrid(Te,Ee,Ae,We)||!C&&this.grid.hitTest(Te,Ee,Ae,We,j)||Le?{box:[],offscreen:!1,occluded:Pe.occluded}:{box:[Te,Ee,Ae,We],offscreen:this.isOffscreen(Te,Ee,Ae,We),occluded:!1}}placeCollisionCircles(t,s,d,_,v,S,E,C,k,L,j,B,q,K,Z){const J=[],Y=this.transform.elevation,se=t.getProjection(),ce=Y?Y.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,se):null,pe=new a.P(d.tileAnchorX,d.tileAnchorY);let{x:Se,y:Pe,z:Me}=se.projectTilePoint(pe.x,pe.y,Z.canonical);if(ce){const[vt,bt,It]=ce(pe);Se+=vt,Pe+=bt,Me+=It}const Te=se.name==="globe",Ee=this.projectAndGetPerspectiveRatio(E,Se,Pe,Me,Z,Te||!!Y||this.transform.pitch>0,se),{perspectiveRatio:Ae}=Ee,We=(j?S/Ae:S*Ae)/a.bU,Le=Io(Se,Pe,Me,C),ut=d.lineOffsetX*We,Je=d.lineOffsetY*We,dt=a.al(t.layers[0].layout.get("text-max-angle")),wt=Math.cos(dt),qe=Ee.signedDistanceFromCamera>0?ea(We,v,ut,Je,!1,Le,pe,d,_,C,{},Y&&!j?ce:null,j&&!!Y,se,Z,j,wt):null;let Re=!1,tt=!1,Ye=!0;if(qe&&!Ee.occluded){const vt=.5*q*Ae+K,bt=new a.P(-100,-100),It=new a.P(this.screenRightBoundary,this.screenBottomBoundary),Dt=new $h,{first:lr,last:pr}=qe,Yt=lr.path.length;let dr=[];for(let Vr=Yt-1;Vr>=1;Vr--)dr.push(lr.path[Vr]);for(let Vr=1;Vr<pr.path.length;Vr++)dr.push(pr.path[Vr]);const ur=2.5*vt;k&&(dr=dr.map((([Vr,Xr,vn],jr)=>(ce&&!Te&&(vn=ce(jr<Yt-1?lr.tilePath[Yt-1-jr]:pr.tilePath[jr-Yt+2])[2]),Io(Vr,Xr,vn,k)))),dr.some((Vr=>Vr[3]<=0))&&(dr=[]));let kr=[];if(dr.length>0){let Vr=1/0,Xr=-1/0,vn=1/0,jr=-1/0;for(const Sn of dr)Vr=Math.min(Vr,Sn[0]),vn=Math.min(vn,Sn[1]),Xr=Math.max(Xr,Sn[0]),jr=Math.max(jr,Sn[1]);Xr>=bt.x&&Vr<=It.x&&jr>=bt.y&&vn<=It.y&&(kr=[dr.map((Sn=>new a.P(Sn[0],Sn[1])))],(Vr<bt.x||Xr>It.x||vn<bt.y||jr>It.y)&&(kr=a.bS(kr,bt.x,bt.y,It.x,It.y)))}for(const Vr of kr){Dt.reset(Vr,.25*vt);let Xr=0;Xr=Dt.length<=.5*vt?1:Math.ceil(Dt.paddedLength/ur)+1;for(let vn=0;vn<Xr;vn++){const jr=vn/Math.max(Xr-1,1),Sn=Dt.lerp(jr),Mn=Sn.x+wr,Xn=Sn.y+wr;J.push(Mn,Xn,vt,0);const Gr=Mn-vt,Tn=Xn-vt,_n=Mn+vt,zn=Xn+vt;if(Ye=Ye&&this.isOffscreen(Gr,Tn,_n,zn),tt=tt||this.isInsideGrid(Gr,Tn,_n,zn),!s&&this.grid.hitTestCircle(Mn,Xn,vt,B)&&(Re=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Re,occluded:!1}}}}return{circles:!L&&Re||!tt?[]:J,offscreen:Ye,collisionDetected:Re,occluded:Ee.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let d=1/0,_=1/0,v=-1/0,S=-1/0;for(const L of t){const j=new a.P(L.x+wr,L.y+wr);d=Math.min(d,j.x),_=Math.min(_,j.y),v=Math.max(v,j.x),S=Math.max(S,j.y),s.push(j)}const E=this.grid.query(d,_,v,S).concat(this.ignoredGrid.query(d,_,v,S)),C={},k={};for(const L of E){const j=L.key;if(C[j.bucketInstanceId]===void 0&&(C[j.bucketInstanceId]={}),C[j.bucketInstanceId][j.featureIndex])continue;const B=[new a.P(L.x1,L.y1),new a.P(L.x2,L.y1),new a.P(L.x2,L.y2),new a.P(L.x1,L.y2)];a.bT(s,B)&&(C[j.bucketInstanceId][j.featureIndex]=!0,k[j.bucketInstanceId]===void 0&&(k[j.bucketInstanceId]=[]),k[j.bucketInstanceId].push(j.featureIndex))}return k}insertCollisionBox(t,s,d,_,v){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:v},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,d,_,v){const S=s?this.ignoredGrid:this.grid,E={bucketInstanceId:d,featureIndex:_,collisionGroupID:v};for(let C=0;C<t.length;C+=4)S.insertCircle(E,t[C],t[C+1],t[C+2])}projectAndGetPerspectiveRatio(t,s,d,_,v,S,E){const C=[s,d,_,1];let k=!1;_||this.transform.pitch>0?(a.aA(C,C,t),this.fogState&&v&&E.name!=="globe"&&(k=(function(B,q,K,Z,J,Y){const se=Y.calculateFogTileMatrix(J),ce=[q,K,Z];return a.ad(ce,ce,se),vr(B,a.ae(ce),Y.pitch,Y._fov)})(this.fogState,s,d,_,v.toUnwrapped(),this.transform)>.9)):Sm(C,C,t);const L=C[3];return{point:new a.P((C[0]/L+1)/2*this.transform.width+wr,(-C[1]/L+1)/2*this.transform.height+wr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/L*.5,1.5),signedDistanceFromCamera:L,occluded:S&&C[2]>L||k}}isOffscreen(t,s,d,_){return d<wr||t>=this.screenRightBoundary||_<wr||s>this.screenBottomBoundary}isInsideGrid(t,s,d,_){return d>=0&&t<this.gridRightBoundary&&_>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=a.bx([]);return a.bo(t,t,[-100,-100,0]),t}}class Al{constructor(t,s,d,_){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):_&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class ll{constructor(t,s,d,_,v,S=!1){this.text=new Al(t?t.text:null,s,d,v),this.icon=new Al(t?t.icon:null,s,_,v),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Na{constructor(t,s,d,_=!1){this.text=t,this.icon=s,this.skipFade=d,this.clipped=_}}class gp{constructor(){this.invProjMatrix=a.bz(),this.viewportMatrix=a.bz(),this.circles=[]}}class Kc{constructor(t,s,d,_,v){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=d,this.bucketIndex=_,this.tileID=v}}class yr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:d=>d.collisionGroupID===s}}return this.collisionGroups[t]}}function Dn(f,t,s,d,_){const{horizontalAlign:v,verticalAlign:S}=a.bZ(f),E=-(v-.5)*t,C=-(S-.5)*s,k=a.b_(f,d);return new a.P(E+k[0]*_,C+k[1]*_)}function Fn(f,t,s,d,_){const v=new a.P(f,t);return s&&v._rotate(d?_:-_),v}class ja{constructor(t,s,d,_,v,S){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new td(this.transform,v),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new yr(d),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,d,_,v=1){const S=d.getBucket(s),E=d.latestFeatureIndex;if(!S||!E||s.fqid!==S.layerIds[0])return;const C=S.layers[0].layout,k=S.layers[0].paint,L=d.collisionBoxArray,j=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),B=d.tileSize/a.aj,q=d.tileID.toUnwrapped();this.transform.setProjection(S.projection);const K=(Z=d.tileID,J=S.getProjection(),Y=this.transform,J.name===this.projection?Y.calculateProjMatrix(Z.toUnwrapped()):Tl(Y,J,Z));var Z,J,Y;const se=C.get("text-pitch-alignment")==="map",ce=C.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const pe=s.dynamicFilter(),Se=s.dynamicFilterNeedsFeature(),Pe=this.transform.calculatePixelsToTileUnitsMatrix(d),Me=cu(K,d.tileID.canonical,se,ce,this.transform,S.getProjection(),Pe);let Te=null;const Ee=S.getProjection().createInversionMatrix(this.transform,d.tileID.canonical);if(se){const Re=al(K,d.tileID.canonical,se,ce,this.transform,S.getProjection(),Pe);Te=a.az([],this.transform.labelPlaneMatrix,Re)}let Ae=null;pe&&d.latestFeatureIndex&&(Ae={unwrappedTileID:q,dynamicFilter:pe,dynamicFilterNeedsFeature:Se}),this.retainedQueryData[S.bucketInstanceId]=new Kc(S.bucketInstanceId,E,S.sourceLayerIndex,S.index,d.tileID);const[We,Le]=S.layers[0].layout.get("text-size-scale-range"),ut=a.ay(v,We,Le),[Je,dt]=C.get("icon-size-scale-range"),wt=a.ay(v,Je,dt),qe={bucket:S,layout:C,paint:k,posMatrix:K,invMatrix:Ee,mercatorCenter:[a.aD(this.transform.center.lng),a.aH(this.transform.center.lat)],textLabelPlaneMatrix:Me,labelToScreenMatrix:Te,clippingData:Ae,scale:j,textPixelRatio:B,holdingForFade:d.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:a.bH(S.textSizeData,this.transform.zoom,ut),partiallyEvaluatedIconSize:a.bH(S.iconSizeData,this.transform.zoom,wt),collisionGroup:this.collisionGroups.get(S.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(_)for(const Re of S.sortKeyRanges){const{sortKey:tt,symbolInstanceStart:Ye,symbolInstanceEnd:vt}=Re;t.push({sortKey:tt,symbolInstanceStart:Ye,symbolInstanceEnd:vt,parameters:qe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:qe})}attemptAnchorPlacement(t,s,d,_,v,S,E,C,k,L,j,B,q,K,Z,J,Y,se,ce,pe,Se){const{textOffset0:Pe,textOffset1:Me,crossTileID:Te}=Z,Ee=[Pe,Me],Ae=Dn(t,S,E,Ee,C),We=this.collisionIndex.placeCollisionBox(Y,C,s,d,_,v,Fn(Ae.x,Ae.y,k,L,this.transform.angle),K,j,B,q.predicate);if(ce){const Le=Y.getSymbolInstanceIconSize(Se,this.transform.zoom,Z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Y,Le,ce,d,_,v,Fn(Ae.x,Ae.y,k,L,this.transform.angle),K,j,B,q.predicate).box.length===0)return}if(We.box.length>0){let Le;return this.prevPlacement&&this.prevPlacement.variableOffsets[Te]&&this.prevPlacement.placements[Te]&&this.prevPlacement.placements[Te].text&&(Le=this.prevPlacement.variableOffsets[Te].anchor),this.variableOffsets[Te]={textOffset:Ee,width:S,height:E,anchor:t,textScale:C,prevAnchor:Le},this.markUsedJustification(Y,t,Z,se),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,se,Z),this.placedOrientations[Te]=se),{shift:Ae,placedGlyphBoxes:We}}}placeLayerBucketPart(t,s,d,_,v=1){const{bucket:S,layout:E,paint:C,posMatrix:k,textLabelPlaneMatrix:L,labelToScreenMatrix:j,clippingData:B,textPixelRatio:q,mercatorCenter:K,invMatrix:Z,holdingForFade:J,collisionBoxArray:Y,partiallyEvaluatedTextSize:se,partiallyEvaluatedIconSize:ce,collisionGroup:pe,latestFeatureIndex:Se}=t.parameters,Pe=E.get("text-optional"),Me=E.get("icon-optional"),Te=E.get("text-allow-overlap"),Ee=E.get("icon-allow-overlap"),Ae=E.get("text-rotation-alignment")==="map",We=E.get("icon-rotation-alignment")==="map",Le=E.get("text-pitch-alignment")==="map",ut=C.get("symbol-z-offset"),Je=E.get("symbol-elevation-reference")==="sea",dt=E.get("symbol-placement"),[wt,qe]=E.get("text-size-scale-range"),[Re,tt]=E.get("icon-size-scale-range"),Ye=a.ay(v,wt,qe),vt=a.ay(v,Re,tt),bt=E.get("text-variable-anchor"),It=Ae&&dt!=="point",Dt=We&&dt!=="point",lr=bt&&S.hasTextData(),pr=S.hasIconTextFit()&&lr&&S.hasIconData();this.transform.setProjection(S.projection);const Yt=lr||It,dr=Dt||pr;let ur=Te&&(Ee||!S.hasIconData()||Me),kr=Ee&&(Te||!S.hasTextData()||Pe);const Vr=!ut.isConstant();!S.collisionArrays&&Y&&S.deserializeCollisionBoxes(Y),d&&_&&S.updateCollisionDebugBuffers(this.transform.zoom,Y,Ye,vt);const Xr=(jr,Sn,Mn)=>{const{crossTileID:Xn,numVerticalGlyphVertices:Gr}=jr;let Tn=null;if(B&&B.dynamicFilterNeedsFeature||Vr){const Mi=this.retainedQueryData[S.bucketInstanceId];Tn=Se.loadFeature({featureIndex:jr.featureIndex,bucketIndex:Mi.bucketIndex,sourceLayerIndex:Mi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Tn,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new a.P(jr.tileAnchorX,jr.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[Xn]=new Na(!1,!1,!1,!0),void s.add(Xn);const _n=ut.evaluate(Tn,{});if(s.has(Xn))return;if(J)return void(this.placements[Xn]=new Na(!1,!1,!1));let zn=!1,Mr=!1,Gn=!0,On=!1,Si=!1,xn=null,Ln={box:null,offscreen:null,occluded:null},Wn={box:null},qi=null,ti=null,Ni=null,Ro=0,Xo=0,Uo=0;Mn.textFeatureIndex?Ro=Mn.textFeatureIndex:jr.useRuntimeCollisionCircles&&(Ro=jr.featureIndex),Mn.verticalTextFeatureIndex&&(Xo=Mn.verticalTextFeatureIndex);const ko=Mi=>{Mi.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const Oi=this.transform.elevation;Mi.elevation=Je?_n:_n+(Oi?Oi.getAtTileOffset(Mi.tileID,Mi.tileAnchorX,Mi.tileAnchorY):0),Mi.elevation+=jr.zOffset},Eo=Mn.textBox;if(Eo){ko(Eo);const Mi=Jn=>{let Qi=a.bI.horizontal;if(S.allowVerticalPlacement&&!Jn&&this.prevPlacement){const uo=this.prevPlacement.placedOrientations[Xn];uo&&(this.placedOrientations[Xn]=uo,Qi=uo,this.markUsedOrientation(S,Qi,jr))}return Qi},Oi=(Jn,Qi)=>{if(S.allowVerticalPlacement&&Gr>0&&Mn.verticalTextBox){for(const uo of S.writingModes)if(uo===a.bI.vertical?(Ln=Qi(),Wn=Ln):Ln=Jn(),Ln&&Ln.box&&Ln.box.length)break}else Ln=Jn()};if(bt){let Jn=bt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Xn]){const Ai=this.prevPlacement.variableOffsets[Xn];Jn.indexOf(Ai.anchor)>0&&(Jn=Jn.filter((Xa=>Xa!==Ai.anchor)),Jn.unshift(Ai.anchor))}const Qi=(Ai,Xa,Hl)=>{const Du=S.getSymbolInstanceTextSize(se,jr,this.transform.zoom,Sn),Oc=(Ai.x2-Ai.x1)*Du+2*Ai.padding,zu=(Ai.y2-Ai.y1)*Du+2*Ai.padding,ga=jr.hasIconTextFit&&!Ee?Xa:null;ga&&ko(ga);let Ts={box:[],offscreen:!1,occluded:!1};const Gi=Te?2*Jn.length:Jn.length;for(let Ka=0;Ka<Gi;++Ka){const Rc=this.attemptAnchorPlacement(Jn[Ka%Jn.length],Ai,K,Z,Yt,Oc,zu,Du,Ae,Le,q,k,pe,Ka>=Jn.length,jr,Sn,S,Hl,ga,se,ce);if(Rc&&(Ts=Rc.placedGlyphBoxes,Ts&&Ts.box&&Ts.box.length)){zn=!0,xn=Rc.shift;break}}return Ts};Oi((()=>Qi(Eo,Mn.iconBox,a.bI.horizontal)),(()=>{const Ai=Mn.verticalTextBox;return Ai&&ko(Ai),S.allowVerticalPlacement&&!(Ln&&Ln.box&&Ln.box.length)&&Gr>0&&Ai?Qi(Ai,Mn.verticalIconBox,a.bI.vertical):{box:null,offscreen:null,occluded:null}})),Ln&&(zn=Ln.box,Gn=Ln.offscreen,On=Ln.occluded);const uo=Mi(!(!Ln||!Ln.box));if(!zn&&this.prevPlacement){const Ai=this.prevPlacement.variableOffsets[Xn];Ai&&(this.variableOffsets[Xn]=Ai,this.markUsedJustification(S,Ai.anchor,jr,uo))}}else{const Jn=(Qi,uo)=>{const Ai=S.getSymbolInstanceTextSize(se,jr,this.transform.zoom,Sn,v),Xa=this.collisionIndex.placeCollisionBox(S,Ai,Qi,K,Z,Yt,new a.P(0,0),Te,q,k,pe.predicate);return Xa&&Xa.box&&Xa.box.length&&(this.markUsedOrientation(S,uo,jr),this.placedOrientations[Xn]=uo),Xa};Oi((()=>Jn(Eo,a.bI.horizontal)),(()=>{const Qi=Mn.verticalTextBox;return S.allowVerticalPlacement&&Gr>0&&Qi?(ko(Qi),Jn(Qi,a.bI.vertical)):{box:null,offscreen:null,occluded:null}})),Mi(!!(Ln&&Ln.box&&Ln.box.length))}}if(qi=Ln,zn=qi&&qi.box&&qi.box.length>0,Gn=qi&&qi.offscreen,On=qi&&qi.occluded,jr.useRuntimeCollisionCircles){const Mi=S.text.placedSymbolArray.get(jr.centerJustifiedTextSymbolIndex>=0?jr.centerJustifiedTextSymbolIndex:jr.verticalPlacedTextSymbolIndex),Oi=a.bJ(S.textSizeData,se,Mi),Jn=E.get("text-padding");ti=this.collisionIndex.placeCollisionCircles(S,Te,Mi,S.lineVertexArray,S.glyphOffsetArray,Oi,k,L,j,d,Le,pe.predicate,jr.collisionCircleDiameter*Oi/a.bU,Jn,this.retainedQueryData[S.bucketInstanceId].tileID),zn=Te||ti.circles.length>0&&!ti.collisionDetected,Gn=Gn&&ti.offscreen,On=ti.occluded}if(Mn.iconFeatureIndex&&(Uo=Mn.iconFeatureIndex),Mn.iconBox){const Mi=Oi=>{ko(Oi);const Jn=jr.hasIconTextFit&&xn?Fn(xn.x,xn.y,Ae,Le,this.transform.angle):new a.P(0,0),Qi=S.getSymbolInstanceIconSize(ce,this.transform.zoom,jr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,Qi,Oi,K,Z,dr,Jn,Ee,q,k,pe.predicate)};Wn&&Wn.box&&Wn.box.length&&Mn.verticalIconBox?(Ni=Mi(Mn.verticalIconBox),Mr=Ni.box.length>0):(Ni=Mi(Mn.iconBox),Mr=Ni.box.length>0),Gn=Gn&&Ni.offscreen,Si=Ni.occluded}const Ma=Pe||jr.numHorizontalGlyphVertices===0&&Gr===0,Za=Me||jr.numIconVertices===0;if(Ma||Za?Za?Ma||(Mr=Mr&&zn):zn=Mr&&zn:Mr=zn=Mr&&zn,zn&&qi&&qi.box&&this.collisionIndex.insertCollisionBox(qi.box,E.get("text-ignore-placement"),S.bucketInstanceId,Wn&&Wn.box&&Xo?Xo:Ro,pe.ID),Mr&&Ni&&this.collisionIndex.insertCollisionBox(Ni.box,E.get("icon-ignore-placement"),S.bucketInstanceId,Uo,pe.ID),ti&&(zn&&this.collisionIndex.insertCollisionCircles(ti.circles,E.get("text-ignore-placement"),S.bucketInstanceId,Ro,pe.ID),d)){const Mi=S.bucketInstanceId;let Oi=this.collisionCircleArrays[Mi];Oi===void 0&&(Oi=this.collisionCircleArrays[Mi]=new gp);for(let Jn=0;Jn<ti.circles.length;Jn+=4)Oi.circles.push(ti.circles[Jn+0]),Oi.circles.push(ti.circles[Jn+1]),Oi.circles.push(ti.circles[Jn+2]),Oi.circles.push(ti.collisionDetected?1:0)}const Ko=S.projection.name!=="globe";ur=ur&&(Ko||!On),kr=kr&&(Ko||!Si),this.placements[Xn]=new Na(zn||ur,Mr||kr,Gn||S.justReloaded),s.add(Xn)},vn=this.retainedQueryData[S.bucketInstanceId].tileID;if(S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,vn),S.elevationType==="road"&&S.updateRoadElevation(vn.canonical),S.updateZOffset(),S.sortFeaturesByY){const jr=S.getSortedSymbolIndexes(this.transform.angle);for(let Sn=jr.length-1;Sn>=0;--Sn){const Mn=jr[Sn];Xr(S.symbolInstances.get(Mn),Mn,S.collisionArrays[Mn])}S.hasAnyZOffset&&a.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const jr=S.getSortedIndexesByZOffset();for(let Sn=0;Sn<jr.length;++Sn){const Mn=jr[Sn];Xr(S.symbolInstances.get(Mn),Mn,S.collisionArrays[Mn])}}else for(let jr=t.symbolInstanceStart;jr<t.symbolInstanceEnd;jr++)Xr(S.symbolInstances.get(jr),jr,S.collisionArrays[jr]);if(d&&S.bucketInstanceId in this.collisionCircleArrays){const jr=this.collisionCircleArrays[S.bucketInstanceId];a.bi(jr.invProjMatrix,k),jr.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(t,s,d,_){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:C,crossTileID:k}=d,L=a.b$(s),j=_===a.bI.vertical?C:L==="left"?v:L==="center"?S:L==="right"?E:-1;v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=j>=0&&v!==j?0:k),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=j>=0&&S!==j?0:k),E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=j>=0&&E!==j?0:k),C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=j>=0&&C!==j?0:k)}markUsedOrientation(t,s,d){const _=s===a.bI.horizontal||s===a.bI.horizontalOnly?s:0,v=s===a.bI.vertical?s:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:k}=d,L=t.text.placedSymbolArray;S>=0&&(L.get(S).placedOrientation=_),E>=0&&(L.get(E).placedOrientation=_),C>=0&&(L.get(C).placedOrientation=_),k>=0&&(L.get(k).placedOrientation=v)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let d=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const _=s?s.symbolFadeChange(t):1,v=s?s.opacities:{},S=s?s.variableOffsets:{},E=s?s.placedOrientations:{};for(const C in this.placements){const k=this.placements[C],L=v[C];L?(this.opacities[C]=new ll(L,_,k.text,k.icon,null,k.clipped),d=d||k.text!==L.text.placed||k.icon!==L.icon.placed):(this.opacities[C]=new ll(null,_,k.text,k.icon,k.skipFade,k.clipped),d=d||k.text||k.icon)}for(const C in v){const k=v[C];if(!this.opacities[C]){const L=new ll(k,_,!1,!1);L.isHidden()||(this.opacities[C]=L,d=d||k.text.placed||k.icon.placed)}}for(const C in S)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=S[C]);for(const C in E)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=E[C]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s,d,_){const v=new Set;for(const S of s){const E=S.getBucket(t);E&&S.latestFeatureIndex&&t.fqid===E.layerIds[0]&&(this.updateBucketOpacities(E,v,S,S.collisionBoxArray,d,_,S.tileID,t.scope),E.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(E,S.tileID),E.elevationType==="road"&&E.updateRoadElevation(S.tileID.canonical),E.updateZOffset())}}updateBucketOpacities(t,s,d,_,v,S,E,C){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const k=t.layers[0].layout,L=t.layers[0].paint,j=!!t.layers[0].dynamicFilter(),B=new ll(null,0,!1,!1,!0),q=k.get("text-allow-overlap"),K=k.get("icon-allow-overlap"),Z=k.get("text-variable-anchor"),J=k.get("text-rotation-alignment")==="map",Y=k.get("text-pitch-alignment")==="map",se=L.get("symbol-z-offset"),ce=k.get("symbol-elevation-reference")==="sea",pe=!se.isConstant(),Se=new ll(null,0,q&&(K||!t.hasIconData()||k.get("icon-optional")),K&&(q||!t.hasTextData()||k.get("text-optional")),!0);!t.collisionArrays&&_&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(_);const Pe=(Te,Ee,Ae)=>{for(let We=0;We<Ee/4;We++)Te.opacityVertexArray.emplaceBack(Ae)};let Me=0;S&&t.updateReplacement(E,S);for(let Te=0;Te<t.symbolInstances.length;Te++){const Ee=t.symbolInstances.get(Te),{numHorizontalGlyphVertices:Ae,numVerticalGlyphVertices:We,crossTileID:Le,numIconVertices:ut,tileAnchorX:Je,tileAnchorY:dt}=Ee;let wt=null;const qe=this.retainedQueryData[t.bucketInstanceId];pe&&Ee&&qe&&(wt=d.latestFeatureIndex.loadFeature({featureIndex:Ee.featureIndex,bucketIndex:qe.bucketIndex,sourceLayerIndex:qe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Re=se.evaluate(wt,{}),tt=s.has(Le);let Ye=this.opacities[Le];tt?Ye=B:Ye||(Ye=Se,this.opacities[Le]=Ye),s.add(Le);const vt=Ae>0||We>0,bt=ut>0,It=this.placedOrientations[Le],Dt=It===a.bI.vertical,lr=It===a.bI.horizontal||It===a.bI.horizontalOnly;!vt&&!bt||Ye.isHidden()||Me++;let pr=!1;if((vt||bt)&&S)for(const Yt of t.activeReplacements){if(a.bV(Yt,v,a.bW.Symbol,C)||Yt.min.x>Je||Je>Yt.max.x||Yt.min.y>dt||dt>Yt.max.y)continue;const dr=a.bX(Je,dt,E.canonical,Yt.footprintTileId.canonical);if(pr=a.bY(dr,Yt.footprint),pr)break}if(vt){const Yt=pr?du:fu(Ye.text);Pe(t.text,Ae,Dt?du:Yt),Pe(t.text,We,lr?du:Yt);const dr=Ye.text.isHidden(),{leftJustifiedTextSymbolIndex:ur,centerJustifiedTextSymbolIndex:kr,rightJustifiedTextSymbolIndex:Vr,verticalPlacedTextSymbolIndex:Xr}=Ee,vn=t.text.placedSymbolArray,jr=dr||Dt?1:0;ur>=0&&(vn.get(ur).hidden=jr),kr>=0&&(vn.get(kr).hidden=jr),Vr>=0&&(vn.get(Vr).hidden=jr),Xr>=0&&(vn.get(Xr).hidden=dr||lr?1:0);const Sn=this.variableOffsets[Le];Sn&&this.markUsedJustification(t,Sn.anchor,Ee,It);const Mn=this.placedOrientations[Le];Mn&&(this.markUsedJustification(t,"left",Ee,Mn),this.markUsedOrientation(t,Mn,Ee))}if(bt){const Yt=pr?du:fu(Ye.icon),{placedIconSymbolIndex:dr,verticalPlacedIconSymbolIndex:ur}=Ee,kr=t.icon.placedSymbolArray,Vr=Ye.icon.isHidden()?1:0;dr>=0&&(Pe(t.icon,ut,Dt?du:Yt),kr.get(dr).hidden=Vr),ur>=0&&(Pe(t.icon,Ee.numVerticalIconVertices,lr?du:Yt),kr.get(ur).hidden=Vr)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Yt=t.collisionArrays[Te];if(Yt){let dr=new a.P(0,0),ur=!0;if(Yt.textBox||Yt.verticalTextBox){if(Z){const Vr=this.variableOffsets[Le];Vr?(dr=Dn(Vr.anchor,Vr.width,Vr.height,Vr.textOffset,Vr.textScale),J&&dr._rotate(Y?this.transform.angle:-this.transform.angle)):ur=!1}j&&(ur=!Ye.clipped),Yt.textBox&&Pl(t.textCollisionBox.collisionVertexArray,Ye.text.placed,!ur||Dt,Re,ce,dr.x,dr.y),Yt.verticalTextBox&&Pl(t.textCollisionBox.collisionVertexArray,Ye.text.placed,!ur||lr,Re,ce,dr.x,dr.y)}const kr=ur&&!!(!lr&&Yt.verticalIconBox);Yt.iconBox&&Pl(t.iconCollisionBox.collisionVertexArray,Ye.icon.placed,kr,Re,ce,Ee.hasIconTextFit?dr.x:0,Ee.hasIconTextFit?dr.y:0),Yt.verticalIconBox&&Pl(t.iconCollisionBox.collisionVertexArray,Ye.icon.placed,!kr,Re,ce,Ee.hasIconTextFit?dr.x:0,Ee.hasIconTextFit?dr.y:0)}}}if(t.fullyClipped=Me===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const Te=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Te.invProjMatrix,t.placementViewportMatrix=Te.viewportMatrix,t.collisionCircleArray=Te.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const d=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function Pl(f,t,s,d,_,v,S){f.emplaceBack(t?1:0,s?1:0,v||0,S||0,d,_?1:0),f.emplaceBack(t?1:0,s?1:0,v||0,S||0,d,_?1:0),f.emplaceBack(t?1:0,s?1:0,v||0,S||0,d,_?1:0),f.emplaceBack(t?1:0,s?1:0,v||0,S||0,d,_?1:0)}const Nn=Math.pow(2,25),rd=Math.pow(2,24),Yc=Math.pow(2,17),Hh=Math.pow(2,16),ta=Math.pow(2,9),no=Math.pow(2,8),Kg=Math.pow(2,1);function fu(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const t=f.placed?1:0,s=Math.floor(127*f.opacity);return s*Nn+t*rd+s*Yc+t*Hh+s*ta+t*no+s*Kg+t}const du=0;class Wh{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,s,d,_,v,S){const E=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(E,_,t[this._currentTileIndex],this._sortAcrossTiles,S),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort(((C,k)=>C.sortKey-k.sortKey)));this._currentPartIndex<E.length;){const C=E[this._currentPartIndex];if(s.placeLayerBucketPart(C,this._seenCrossTileIDs,d,C.symbolInstanceStart===0,S),this._currentPartIndex++,v())return!0}return!1}}class nd{constructor(t,s,d,_,v,S,E,C,k){this.placement=new ja(t,v,S,E,C,k),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,s,d,_,v){const S=a.q.now(),E=()=>{const C=a.q.now()-S;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=s[t[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=k)&&(!C.maxzoom||C.maxzoom>k)){const L=C,j=L.layout.get("symbol-z-elevate"),B=L.layout.get("symbol-sort-key").constantOr(1)!==void 0,q=L.layout.get("symbol-z-order"),K=q==="viewport-y"||q==="auto"&&!(q!=="viewport-y"&&B),Z=L.layout.get("text-allow-overlap")||L.layout.get("icon-allow-overlap")||L.layout.get("text-ignore-placement")||L.layout.get("icon-ignore-placement"),J=K&&Z,Y=this._inProgressLayer=this._inProgressLayer||new Wh(L),se=a.C(C.source,C.scope);if(Y.continuePlacement(j||J?_[se]:d[se],this.placement,this._showCollisionBoxes,C,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Jc=512/a.aj/2;class id{constructor(t,s,d){this.tileID=t,this.bucketInstanceId=d,this.index=new a.c0(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=t.canonical.x*a.aj,v=t.canonical.y*a.aj;for(let S=0;S<s.length;S++){const{key:E,crossTileID:C,tileAnchorX:k,tileAnchorY:L}=s.get(S),j=Math.floor((_+k)*Jc),B=Math.floor((v+L)*Jc);this.index.add(j,B),this.keys.push(E),this.crossTileIDs.push(C)}this.index.finish()}findMatches(t,s,d){const _=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),v=Jc/Math.pow(2,s.canonical.z-this.tileID.canonical.z),S=s.canonical.x*a.aj,E=s.canonical.y*a.aj;for(let C=0;C<t.length;C++){const k=t.get(C);if(k.crossTileID)continue;const{key:L,tileAnchorX:j,tileAnchorY:B}=k,q=Math.floor((S+j)*v),K=Math.floor((E+B)*v),Z=this.index.range(q-_,K-_,q+_,K+_).sort(((J,Y)=>J-Y));for(const J of Z){const Y=this.crossTileIDs[J];if(this.keys[J]===L&&!d.has(Y)){d.add(Y),k.crossTileID=Y;break}}}}}class ca{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Il{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const d in this.indexes){const _=this.indexes[d],v={};for(const S in _){const E=_[S];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+s),v[E.tileID.key]=E}this.indexes[d]=v}this.lng=t}addBucket(t,s,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let v=0;v<s.symbolInstances.length;v++)s.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const _=this.usedCrossTileIDs[t.overscaledZ];for(const v in this.indexes){const S=this.indexes[v];if(Number(v)>t.overscaledZ)for(const E in S){const C=S[E];C.tileID.isChildOf(t)&&C.findMatches(s.symbolInstances,t,_)}else{const E=S[t.scaledTo(Number(v)).key];E&&E.findMatches(s.symbolInstances,t,_)}}for(let v=0;v<s.symbolInstances.length;v++){const S=s.symbolInstances.get(v);S.crossTileID||(S.crossTileID=d.generate(),_.add(S.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new id(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const d of s.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let s=!1;for(const d in this.indexes){const _=this.indexes[d];for(const v in _)t[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,_[v]),delete _[v],s=!0)}return s}}class Pa{constructor(){this.layerIndexes={},this.crossTileIDs=new ca,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,d,_){let v=this.layerIndexes[t.fqid];v===void 0&&(v=this.layerIndexes[t.fqid]=new Il);let S=!1;const E={};_.name!=="globe"&&v.handleWrapJump(d);for(const C of s){const k=C.getBucket(t);k&&t.fqid===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(C.tileID,k,this.crossTileIDs)&&(S=!0),E[k.bucketInstanceId]=!0)}return v.removeStaleBuckets(E)&&(S=!0),S}pruneUnusedLayers(t){const s={};t.forEach((d=>{s[d]=!0}));for(const d in this.layerIndexes)s[d]||delete this.layerIndexes[d]}}const tc=771;class Wr{constructor(t,s,d,_){this.blendFunction=t,this.blendColor=s.toNonPremultipliedRenderColor(null),this.mask=d,this.blendEquation=_}}Wr.Replace=[1,0,1,0],Wr.disabled=new Wr(Wr.Replace,a.am.transparent,[!1,!1,!1,!1]),Wr.unblended=new Wr(Wr.Replace,a.am.transparent,[!0,!0,!0,!0]),Wr.alphaBlended=new Wr([1,tc,1,tc],a.am.transparent,[!0,!0,!0,!0]),Wr.alphaBlendedNonPremultiplied=new Wr([770,tc,770,tc],a.am.transparent,[!0,!0,!0,!0]),Wr.multiply=new Wr([774,0,774,0],a.am.transparent,[!0,!0,!0,!0]);class Qt{constructor(t,s,d){this.func=t,this.mask=s,this.range=d}}Qt.ReadOnly=!1,Qt.ReadWrite=!0,Qt.disabled=new Qt(519,Qt.ReadOnly,[0,1]);const Ua=7680;class Ar{constructor(t,s,d,_,v,S){this.test=t,this.ref=s,this.mask=d,this.fail=_,this.depthFail=v,this.pass=S}}Ar.disabled=new Ar({func:519,mask:0},0,0,Ua,Ua,Ua);const Yi=1029,Qc=2305;class Sr{constructor(t,s,d){this.enable=t,this.mode=s,this.frontFace=d}}function rc(f,t){const s=a.c6(f,3);a.c8(f,t),a.cc(f,3,s)}function nc(f,t){const s=a.c3([]);return a.c4(s,s,-t),a.c5(s,s,-f),s}function Cl(f,t){const s=[f[0],f[1],0],d=[t[0],t[1],0];if(a.ae(s)>=1e-15){const S=a.au([],s);a.c1(d,S,a.bG(d,S)),t[0]=d[0],t[1]=d[1]}const _=a.bF([],t,f);if(a.c2(_)<1e-15)return null;const v=Math.atan2(-_[1],_[0]);return nc(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),v)}Sr.disabled=new Sr(!1,Yi,Qc),Sr.backCCW=new Sr(!0,Yi,Qc),Sr.backCW=new Sr(!0,Yi,2304),Sr.frontCW=new Sr(!0,1028,2304),Sr.frontCCW=new Sr(!0,1028,Qc);class ic{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){const s=t instanceof a.ac?t:new a.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=a.bQ(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const d=this.position,_=this._elevation?this._elevation.getAtPointOrZero(a.ac.fromLngLat(t)):0,v=a.ac.fromLngLat(t,_),S=[v.x-d.x,v.y-d.y,v.z-d.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=Cl(S,s)}setPitchBearing(t,s){this.orientation=nc(a.al(t),a.al(-s))}}class gs{constructor(t,s){this._transform=a.bx([]),this.orientation=s,this.position=t}get mercatorPosition(){const t=this.position;return new a.ac(t[0],t[1],t[2])}get position(){const t=a.c6(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&a.cc(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||a.c3([]),t&&rc(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=nc(t,s),rc(this._transform,this._orientation)}forward(){const t=a.c6(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=a.c6(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=a.c6(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const d=new Float64Array(16);return a.bi(d,this.getWorldToCamera(t,s)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,s,d){const _=this.position;a.c1(_,_,-t);const v=new Float64Array(16);return a.bn(v,[d,d,d]),a.bo(v,v,_),v[10]*=s,v}getWorldToCamera(t,s){const d=new Float64Array(16),_=new Float64Array(4),v=this.position;return a.c7(_,this._orientation),a.c1(v,v,-t),a.c8(d,_),a.bo(d,d,v),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=s,d[9]*=s,d[10]*=s,d[11]*=s,d}getCameraToClipPerspective(t,s,d,_){const v=new Float64Array(16);return a.c9(v,t,s,d,_),v}getCameraToClipOrthographic(t,s,d,_,v,S){const E=new Float64Array(16);return a.ca(E,t,s,d,_,v,S),E}getDistanceToElevation(t,s=!1){const d=t===0?0:a.cb(t,s?a.aY(this.position[1]):this.position[1]),_=this.forward();return(d-this.position[2])/_[2]}clone(){return new gs([...this.position],[...this.orientation])}}const ha={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Zh{constructor(t=0,s=0,d=0,_=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(d)||d<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=d,this.right=_}interpolate(t,s,d){return s.top!=null&&t.top!=null&&(this.top=a.ai(t.top,s.top,d)),s.bottom!=null&&t.bottom!=null&&(this.bottom=a.ai(t.bottom,s.bottom,d)),s.left!=null&&t.left!=null&&(this.left=a.ai(t.left,s.left,d)),s.right!=null&&t.right!=null&&(this.right=a.ai(t.right,s.right,d)),this}getCenter(t,s){const d=a.ay((this.left+t-this.right)/2,0,t),_=a.ay((this.top+s-this.bottom)/2,0,s);return new a.P(d,_)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Zh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const xo=15;class od{constructor(t,s,d,_,v,S,E){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=d??0,this._maxPitch=_??60,this.setProjection(S),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new a.ci(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Zh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new gs,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new od(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<xo}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,s=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return a.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=a.cj(this.projectionOptions);const d=this.getProjection(),_=!a.bv(s,d);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.cj({name:"mercator"});const s=t!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.cb(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return a.bQ(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=a.ck(),a.cl(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=a.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=a.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let _=0,v=0;for(let S=0;S<s.length;S++){const E=new a.P(s[S][0]*this.width,d+s[S][1]*(this.height-d)),C=t.pointCoordinate(E);if(!C)continue;const k=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);_+=C[3]*k,v+=k}return v===0?NaN:_/v}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*s,_=this._mercatorZfromZoom(t),v=this._mercatorZfromZoom(this._maxZoom),S=Math.max(_-d,v);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const _=a.ae(a.at([],this._camera.position,d));return a.ay(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!a.cm(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];a.cn(d,this._camera.position)||(this._setCameraPosition(d),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new ic;return s.position=new a.ac(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!a.co(t))return!1;a.cp(t,t);const s=a.cq([],[0,0,-1],t),d=a.cq([],[0,-1,0],t);if(d[2]<0)return!1;const _=Cl(s,d);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;t[2]=a.ay(t[2],_/d,_/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,d){this._unmodified=!1,this._edgeInsets.interpolate(t,s,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new a.cr(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new a.P(0,0)),_=this.pointCoordinate(new a.P(this.width,0)),v=this.pointCoordinate(new a.P(this.width,this.height)),S=this.pointCoordinate(new a.P(0,this.height)),E=Math.floor(Math.min(d.x,_.x,v.x,S.x)),C=Math.floor(Math.max(d.x,_.x,v.x,S.x)),k=1;for(let L=E-k;L<=C+k;L++)L!==0&&s.push(new a.cr(L,t))}return s}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,s,d){let _=[];const v=d!=null,S=!v;if(S&&this.zoom<s||v&&d[0]===0&&d[1]===0)return _;const E=new Set,C=(L,j,B,q,K)=>{const Z=a.cV(j,L,B,q,K);E.has(Z)||(_.push(new a.aM(L,j,B,q,K)),E.add(Z))};for(let L=0;L<t.length;L++){const j=t[L];if(S&&j.canonical.z!==s)continue;const B=j.canonical,q=j.overscaledZ,K=j.wrap,Z=1<<B.z,J=B.x+1<Z,Y=B.x>0,se=B.y+1<Z,ce=B.y>0,pe=j.wrap-(Y?0:1),Se=j.wrap+(J?0:1),Pe=Y?B.x-1:Z-1,Me=J?B.x+1:0;if(v)d[0]<0?(C(q,Se,B.z,Me,B.y),d[1]<0&&se&&(C(q,K,B.z,B.x,B.y+1),C(q,Se,B.z,Me,B.y+1)),d[1]>0&&ce&&(C(q,K,B.z,B.x,B.y-1),C(q,Se,B.z,Me,B.y-1))):d[0]>0?(C(q,pe,B.z,Pe,B.y),d[1]<0&&se&&(C(q,K,B.z,B.x,B.y+1),C(q,pe,B.z,Pe,B.y+1)),d[1]>0&&ce&&(C(q,K,B.z,B.x,B.y-1),C(q,pe,B.z,Pe,B.y-1))):d[1]<0&&se?C(q,K,B.z,B.x,B.y+1):ce&&C(q,K,B.z,B.x,B.y-1);else{const Te=j.visibleQuadrants;1&Te&&(C(q,pe,B.z,Pe,B.y),ce&&(C(q,K,B.z,B.x,B.y-1),C(q,pe,B.z,Pe,B.y-1))),2&Te&&(C(q,Se,B.z,Me,B.y),ce&&(C(q,K,B.z,B.x,B.y-1),C(q,Se,B.z,Me,B.y-1))),4&Te&&(C(q,pe,B.z,Pe,B.y),se&&(C(q,K,B.z,B.x,B.y+1),C(q,pe,B.z,Pe,B.y+1))),8&Te&&(C(q,Se,B.z,Me,B.y),se&&(C(q,K,B.z,B.x,B.y+1),C(q,Se,B.z,Me,B.y+1)))}}const k=[];for(const L of _)_.some((j=>L.isChildOf(j)))||k.push(L);if(_=k.filter((L=>!t.some((j=>!!(L.overscaledZ<s&&j.isChildOf(L))||L.equals(j)||L.isChildOf(j))))),S){const L=1<<s,j=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[L*j.x,L*j.y],q=4,K=q*q;_=_.filter((Z=>{const J=Z.canonical.x+.5-B[0],Y=Z.canonical.y+.5-B[1];return J*J+Y*Y<K}))}return _}extendTileCoverToNearPlane(t,s,d){const _=[],v=new Set;for(const se of t)v.add(se.key);const S=(se,ce,pe,Se,Pe)=>{const Me=a.cV(ce,se,pe,Se,Pe);v.has(Me)||(_.push(new a.aM(se,ce,pe,Se,Pe)),v.add(Me))},E=t.reduce(((se,ce)=>Math.max(se,ce.overscaledZ)),d),C=1<<d,k=[new a.P(0,0),new a.P(a.aj,0),new a.P(a.aj,a.aj),new a.P(0,a.aj)],L=new a.P(0,0),j=new a.P(0,0),B=(se,ce)=>{const pe=Math.floor(se[0]),Se=Math.floor(se[1]),Pe=(se[0]-pe)*a.aj,Me=(se[1]-Se)*a.aj,Te=Math.floor(ce[0]),Ee=Math.floor(ce[1]),Ae=(ce[0]-Te)*a.aj,We=(ce[1]-Ee)*a.aj;for(let Le=-1;Le<=1;Le++){const ut=pe+Le;if(!(ut<0||ut>=C)){L.x=Pe-Le*a.aj,j.x=Ae-(ut-Te)*a.aj;for(let Je=-1;Je<=1;Je++){const dt=Se+Je;L.y=Me-Je*a.aj,j.y=We-(dt-Ee)*a.aj,a.cW(L,j,k)&&S(E,0,d,ut,dt)}}}},q=s.points,K=q[a.cs],Z=q[a.ct],J=this._projectToGround(K,q[a.cu]),Y=this._projectToGround(Z,q[a.cv]);return B(K,J),B(Z,Y),_}_projectToGround(t,s){return a.cw(a.cx(),t,s,t[2]/(t[2]-s[2]))}coveringTiles(t){let s=this.coveringZoomLevel(t);const d=s,_=this.elevation&&this.elevation.exaggeration(),v=_&&!t.isTerrainDEM,S=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const E=this.locationCoordinate(this.center),C=this.center.lat,k=1<<s,L=[k*E.x,k*E.y,0],j=this.projection.name==="globe",B=!j,q=a.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,B),K=j?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=k*a.cb(1,this.center.lat),J=this._camera.position[2]/a.cb(1,this.center.lat),Y=[k*K.x,k*K.y,J*(B?1:Z)],se=j||_,ce=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),pe=this.isLODDisabled(!0)?s:0;let Se;if(this._elevation&&t.isTerrainDEM)Se=1e4*this._elevation.exaggeration();else if(this._elevation){const Re=this._elevation.getMinMaxForVisibleTiles();Se=Re?Re.max:this._centerAltitude}else Se=this._centerAltitude;const Pe=t.isTerrainDEM?-Se:this._elevation?this._elevation.getMinElevationBelowMSL():0,Me=this.projection.isReprojectedInTileSpace?a.cz(this):1,Te=Re=>{const Ye=new a.ac(Re.x+25e-6,Re.y,Re.z),vt=new a.ac(Re.x,Re.y+25e-6,Re.z),bt=Re.toLngLat(),It=Ye.toLngLat(),Dt=vt.toLngLat(),lr=this.locationCoordinate(bt),pr=this.locationCoordinate(It),Yt=this.locationCoordinate(Dt),dr=Math.hypot(pr.x-lr.x,pr.y-lr.y),ur=Math.hypot(Yt.x-lr.x,Yt.y-lr.y);return Math.sqrt(dr*ur)*Me/25e-6},Ee=Re=>{const tt=Se,Ye=Pe;return{aabb:a.cC(this,k,0,0,0,Re,Ye,tt,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:tt,wrap:Re,fullyVisible:!1}},Ae=[];let We=[];const Le=s,ut=t.reparseOverscaled?d:s,Je=(J-this._centerAltitude)*Z,dt=Re=>{if(!this._elevation||!Re.tileID||!S)return;const tt=this._elevation.getMinMaxForTile(Re.tileID),Ye=Re.aabb;tt?(Ye.min[2]=tt.min,Ye.max[2]=tt.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(Re.shouldSplit=qe(Re),Re.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},wt=(Re,tt)=>{if(.707*tt<Re)return 1;const Ye=tt/Re;return Ye/(1.4144271570014144+(Math.pow(1.1,Ye-1.4144271570014144+1)-1)/(1.1-1)-1)},qe=Re=>{if(Re.zoom<pe)return!0;if(Re.zoom===Le)return!1;if(Re.shouldSplit!=null)return Re.shouldSplit;const tt=Re.aabb.distanceX(Y),Ye=Re.aabb.distanceY(Y);let vt=Je,bt=1;if(j){vt=Re.aabb.distanceZ(Y);const ur=Math.pow(2,Re.zoom),kr=a.aY((Re.y+1)/ur),Vr=a.aY(Re.y/ur),Xr=Math.min(Math.max(C,kr),Vr),vn=a.c_(Xr)/a.c_(C);if(bt=Xr===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,vn/this._mercatorScaleRatio),this.zoom<=a.cX&&Re.zoom===Le-1&&vn>=.9)return!0}else if(v&&(vt=Re.aabb.distanceZ(Y)*Z),this.projection.isReprojectedInTileSpace&&d<=5){const ur=Math.pow(2,Re.zoom),kr=Te(new a.ac((Re.x+.5)/ur,(Re.y+.5)/ur));bt=kr>.85?1:kr}if(!S){const ur=Math.sqrt(tt*tt+Ye*Ye+vt*vt);let kr=(1<<Le-Re.zoom)*ce*bt;return kr*=wt(Math.max(vt,Je),ur),ur<kr}let It=Number.MAX_VALUE,Dt=0;const lr=Re.aabb.getCorners(),pr=[];for(const ur of lr){a.at(pr,ur,Y),j||(v?pr[2]*=Z:pr[2]=Je);const kr=a.bG(pr,this._camera.forward());kr<It&&(It=kr,Dt=Math.abs(pr[2]))}let Yt=(1<<Le-Re.zoom)*ce*bt;if(Yt*=wt(Math.max(Dt,Je),It),It<Yt)return!0;const dr=Re.aabb.closestPoint(L);return dr[0]===L[0]&&dr[1]===L[1]};if(this.renderWorldCopies)for(let Re=1;Re<=3;Re++)Ae.push(Ee(-Re)),Ae.push(Ee(Re));for(Ae.push(Ee(0));Ae.length>0;){const Re=Ae.pop(),tt=Re.x,Ye=Re.y;let vt=Re.fullyVisible;const bt=()=>this.projection.name==="globe"&&(Re.y===0||Re.y===(1<<Re.zoom)-1);if(!vt){let It=se?Re.aabb.intersects(q):Re.aabb.intersectsFlat(q);if(It===0&&bt()){const Dt=new a.cA(Re.zoom,tt,Ye);It=a.cB(this,k,Dt,!0).intersects(q)}if(It===0)continue;vt=It===2}if(Re.zoom!==Le&&qe(Re))for(let It=0;It<4;It++){const Dt=(tt<<1)+It%2,lr=(Ye<<1)+(It>>1),pr={aabb:S?Re.aabb.quadrant(It):a.cC(this,k,Re.zoom+1,Dt,lr,Re.wrap,Re.minZ,Re.maxZ,this.projection),zoom:Re.zoom+1,x:Dt,y:lr,wrap:Re.wrap,fullyVisible:vt,tileID:void 0,shouldSplit:void 0,minZ:Re.minZ,maxZ:Re.maxZ};v&&!j&&(pr.tileID=new a.aM(Re.zoom+1===Le?ut:Re.zoom+1,Re.wrap,Re.zoom+1,Dt,lr),dt(pr)),Ae.push(pr)}else{const It=Re.zoom===Le?ut:Re.zoom;if(t.minzoom&&t.minzoom>It)continue;let Dt=0;if(!vt){let dr=se?Re.aabb.intersectsPrecise(q):Re.aabb.intersectsPreciseFlat(q);if(dr===0&&bt()){const ur=new a.cA(Re.zoom,tt,Ye);dr=a.cB(this,k,ur,!0).intersectsPrecise(q)}if(dr===0)continue;if(t.calculateQuadrantVisibility)if(q.containsPoint(Re.aabb.center))Dt=15;else for(let ur=0;ur<4;ur++)Re.aabb.quadrant(ur).intersects(q)!==0&&(Dt|=1<<ur)}const lr=L[0]-(.5+tt+(Re.wrap<<Re.zoom))*(1<<s-Re.zoom),pr=L[1]-.5-Ye,Yt=Re.tileID?Re.tileID:new a.aM(It,Re.wrap,Re.zoom,tt,Ye);t.calculateQuadrantVisibility&&(Yt.visibleQuadrants=Dt),We.push({tileID:Yt,distanceSq:lr*lr+pr*pr})}}if(this.fogCullDistSq){const Re=this.fogCullDistSq,tt=this.horizonLineFromTop();We=We.filter((Ye=>{const vt=[0,0,0,1],bt=[a.aj,a.aj,0,1],It=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());a.aA(vt,vt,It),a.aA(bt,bt,It);const Dt=a.cD([],vt,bt),lr=a.cE([],vt,bt),pr=a.cY(Dt,lr);if(pr===0)return!0;let Yt=!1;const dr=this._elevation;if(dr&&pr>Re&&tt!==0){const ur=this.calculateProjMatrix(Ye.tileID.toUnwrapped());let kr;t.isTerrainDEM||(kr=dr.getMinMaxForTile(Ye.tileID)),kr||(kr={min:Pe,max:Se});const Vr=a.cF(this.rotation),Xr=[Vr[0]*a.aj,Vr[1]*a.aj,kr.max];a.ad(Xr,Xr,ur),Yt=(1-Xr[1])*this.height*.5<tt}return pr<Re||Yt}))}return We.sort(((Re,tt)=>Re.distanceSq-tt.distanceSq)).map((Re=>Re.tileID))}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=a.ay(t.lat,-a.cG,a.cG),d=this.projection.project(t.lng,s);return new a.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.cb(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,s){let d,_;const v=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;d=(s.x-v.x)/E,_=(s.y-v.y)/E}else{const E=this.pointCoordinate(s),C=this.pointCoordinate(v);d=E.x-C.x,_=E.y-C.y}const S=this.locationCoordinate(t);this.setLocation(new a.ac(S.x-d,S.y-_))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,s){return this.projection.locationPoint(this,t,s)}locationPoint3D(t,s){return this.projection.locationPoint(this,t,s,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,s){return this.coordinateLocation(this.pointCoordinate3D(t,s))}locationCoordinate(t,s){const d=s?a.cb(s,t.lat):void 0,_=this.projection.project(t.lng,t.lat);return new a.ac(_.x,_.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const d=s??this._centerAltitude,_=[t.x,t.y,0,1],v=[t.x,t.y,1,1];a.aA(_,_,this.pixelMatrixInverse),a.aA(v,v,this.pixelMatrixInverse);const S=v[3];a.cH(_,_,1/_[3]),a.cH(v,v,1/S);const E=_[2],C=v[2];return{p0:_,p1:v,t:E===C?0:(d-E)/(C-E)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return a.aA(s,s,this.pixelMatrixInverse),a.aA(d,d,this.pixelMatrixInverse),a.cH(s,s,1/s[3]),a.cH(d,d,1/d[3]),s[2]=a.cb(s[2],this._center.lat)*this.worldSize,d[2]=a.cb(d[2],this._center.lat)*this.worldSize,a.cH(s,s,1/this.worldSize),a.cH(d,d,1/this.worldSize),new a.av([s[0],s[1],s[2]],a.au([],a.at([],d,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:d,t:_}=t,v=a.cb(s[2],this._center.lat),S=a.cb(d[2],this._center.lat);return new a.ac(a.ai(s[0],d[0],_)/this.worldSize,a.ai(s[1],d[1],_)/this.worldSize,a.ai(v,S,_))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t,s){if(!this.elevation)return this.pointCoordinate(t,s);let d=this.projection.pointCoordinate3D(this,t.x,t.y);if(d)return new a.ac(d[0],d[1],d[2]);let _=0,v=this.horizonLineFromTop();if(t.y>v)return this.pointCoordinate(t,s);const S=.02*v,E=t.clone();for(let C=0;C<10&&v-_>S;C++){E.y=a.ai(_,v,.66);const k=this.projection.pointCoordinate3D(this,E.x,E.y);k?(v=E.y,d=k):_=E.y}return d?new a.ac(d[0],d[1],d[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=a.cI)return!this.isPointAboveHorizon(t);const s=this.pointCoordinate(t);return s.y>=0&&s.y<=1}_coordinatePoint(t,s){const d=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,_=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return a.aA(_,_,this.pixelMatrix),_[3]>0?new a.P(_[0]/_[3],_[1]/_[3]):new a.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:s}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,v=this.pointLocation3D(new a.P(s,t)),S=this.pointLocation3D(new a.P(_,t)),E=this.pointLocation3D(new a.P(_,d)),C=this.pointLocation3D(new a.P(s,d));let k=Math.min(v.lng,S.lng,E.lng,C.lng),L=Math.max(v.lng,S.lng,E.lng,C.lng),j=Math.min(v.lat,S.lat,E.lat,C.lat),B=Math.max(v.lat,S.lat,E.lat,C.lat);const q=Math.pow(2,-this.zoom)/16*270,K=this.projection.name==="globe"?1:4,Z=(J,Y,se,ce,pe)=>{const Se=(J+se)/2,Pe=(Y+ce)/2,Me=new a.P(Se,Pe),{lng:Te,lat:Ee}=this.pointLocation3D(Me),Ae=Math.max(0,k-Te,j-Ee,Te-L,Ee-B);k=Math.min(k,Te),L=Math.max(L,Te),j=Math.min(j,Ee),B=Math.max(B,Ee),(pe<K||Ae>q)&&(Z(J,Y,Se,Pe,pe+1),Z(Se,Pe,se,ce,pe+1))};if(Z(s,t,_,t,1),Z(_,t,_,d,1),Z(_,d,s,d,1),Z(s,d,s,t,1),this.projection.name==="globe"){const[J,Y]=a.cJ(this);J?(B=90,L=180,k=-180):Y&&(j=-90,L=180,k=-180)}return new a.aG(new a.ci(k,j),new a.ci(L,B))}_getBoundsRectangular(t,s){const{top:d,left:_}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,E=new a.P(_,d),C=new a.P(S,d),k=new a.P(S,v),L=new a.P(_,v);let j=this.pointCoordinate(E,t),B=this.pointCoordinate(C,t);const q=this.pointCoordinate(k,s),K=this.pointCoordinate(L,s),Z=(J,Y)=>(Y.y-J.y)/(Y.x-J.x);return j.y>1&&B.y>=0?j=new a.ac((1-K.y)/Z(K,j)+K.x,1):j.y<0&&B.y<=1&&(j=new a.ac(-K.y/Z(K,j)+K.x,0)),B.y>1&&j.y>=0?B=new a.ac((1-q.y)/Z(q,B)+q.x,1):B.y<0&&j.y<=1&&(B=new a.ac(-q.y/Z(q,B)+q.x,0)),new a.aG().extend(this.coordinateLocation(j)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(q))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=t.visibleDemTiles.reduce(((d,_)=>{if(_.dem){const v=_.dem.tree;d.min=Math.min(d.min,v.minimums[0]),d.max=Math.max(d.max,v.maximums[0])}return d}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-a.cG,this.maxLat=a.cG,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.aD(this.minLng)*this.tileSize,this.worldMaxX=a.aD(this.maxLng)*this.tileSize,this.worldMinY=a.aH(this.maxLat)*this.tileSize,this.worldMaxY=a.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){const s=t.key,d=this._distanceTileDataCache;if(d[s])return d[s];const _=t.canonical,v=1/this.height,S=this.cameraWorldSize,E=S/this.zoomScale(_.z),C=(_.x+Math.pow(2,_.z)*t.wrap)*E,k=_.y*E,L=this.point;L.x*=S/this.worldSize,L.y*=S/this.worldSize;const j=this.angle,B=Math.sin(-j),q=-Math.cos(-j);return d[s]={bearing:[B,q],center:[(L.x-C)*v,(L.y-k)*v],scale:E/a.aj*v},d[s]}calculateFogTileMatrix(t){const s=t.key,d=this._fogTileMatrixCache;if(d[s])return d[s];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return a.az(_,this.worldToFogMatrix,_),d[s]=new Float32Array(_),d[s]}calculateProjMatrix(t,s=!1,d=!1){const _=t.key;let v;if(v=d?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,v[_])return v[_];const S=this.calculatePosMatrix(t,this.worldSize);let E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,a.az(S,E,S),v[_]=new Float32Array(S),v[_]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[s])return d[s];const _=a.cK(t,this);return d[s]=_,d[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,s=a.bn([],[t,t,t]);return a.az(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const s=a.cb(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(s),_=this._camera.forward(),v=a.cb(1,this._center.lat);d[2]/=v,_[2]/=v,a.au(_,_);const S=t.raycast(d,_,t.exaggeration());if(S){const E=a.bE([],d,_,S),C=new a.ac(E[0],E[1],a.cb(E[2],a.aY(E[1]))),k=(C.z+a.ae([C.x-d[0],C.y-d[1],C.z-d[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const s=this._elevation,d=a.cb(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),v=s.getAtPointOrZero(new a.ac(..._)),S=this.pixelsPerMeter/this.worldSize*v,E=this._minimumHeightOverTerrain(),C=_[2]-S;if(C<=E)if(C<0||t){const k=this.locationCoordinate(this._center,this._centerAltitude),L=[_[0],_[1],k.z-_[2]],j=a.ae(L);L[2]-=(E-C)/this._pixelsPerMercatorPixel;const B=a.ae(L);if(B===0)return;a.c1(L,L,j/B*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],k.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const B=this.center;return B.lat=a.ay(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(B.lng=a.ay(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const s=this._unmodified,{x:d,y:_}=this.point;let v=0,S=d,E=_;const C=this.width/2,k=this.height/2,L=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(_-k<L&&(E=L+k),_+k>j&&(E=j-k),j-L<this.height&&(v=Math.max(v,this.height/(j-L)),E=(j+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,q=this.worldMaxX*this.scale,K=this.worldSize/2-(B+q)/2;S=(d+K+this.worldSize)%this.worldSize-K,S-C<B&&(S=B+C),S+C>q&&(S=q-C),q-B<this.width&&(v=Math.max(v,this.width/(q-B)),S=(q+B)/2)}S===d&&E===_||this._allowWorldUnderZoom||(this.center=this.unproject(new a.P(S,E))),v&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.cb(1,this.center.lat)/a.cb(1,a.c$));const _=a.cL(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?d:1,S=this._camera.getWorldToCamera(this.worldSize,v);let E;const C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-t.x/this.width,C[9]=2*t.y/this.height,this.isOrthographic){let Ee=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ae=Ee*this.aspect,We=-Ae,Le=-Ee;Ae-=t.x,We-=t.x,Ee+=t.y,Le+=t.y,E=this._camera.getCameraToClipOrthographic(We,Ae,Le,Ee,this._nearZ,this._farZ),((ut,Je,dt,wt)=>{for(let qe=0;qe<16;qe++)ut[qe]=a.ai(Je[qe],dt[qe],wt)})(E,E,C,a.cZ(this.pitch>=xo?1:this.pitch/xo))}else E=C;const k=a.cM([],C,S);let L=a.cM([],E,S);if(this.projection.isReprojectedInTileSpace){const Ee=this.locationCoordinate(this.center),Ae=a.bx([]);a.bo(Ae,Ae,[Ee.x*this.worldSize,Ee.y*this.worldSize,0]),a.az(Ae,Ae,a.cN(this)),a.bo(Ae,Ae,[-Ee.x*this.worldSize,-Ee.y*this.worldSize,0]),a.az(L,L,Ae),a.az(k,k,Ae),this.inverseAdjustmentMatrix=a.cO(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=a.cP([],L,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=L,this.invProjMatrix=a.bi(new Float64Array(16),this.projMatrix),s){const Ee=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ee[8]=2*-t.x/this.width,Ee[9]=2*t.y/this.height,this.expandedFarZProjMatrix=a.cM([],Ee,S)}else this.expandedFarZProjMatrix=this.projMatrix;const j=a.bi([],E);this.frustumCorners=a.cQ.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height),this.cameraFrustum=a.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const B=new Float32Array(16);a.bx(B),a.cP(B,B,[1,-1,1]),a.cR(B,B,this._pitch),a.by(B,B,this.angle);const q=a.c9(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=a.bw(q);const K=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;q[8]=2*-t.x/this.width,q[9]=2*(t.y+K)/this.height,this.skyboxMatrix=a.az(B,q,B);const Z=this.point,J=Z.x,Y=Z.y,se=this.width%2/2,ce=this.height%2/2,pe=Math.cos(this.angle),Se=Math.sin(this.angle),Pe=J-Math.round(J)+pe*se+Se*ce,Me=Y-Math.round(Y)+pe*ce+Se*se,Te=new Float64Array(L);if(a.bo(Te,Te,[Pe>.5?Pe-1:Pe,Me>.5?Me-1:Me,0]),this.alignedProjMatrix=Te,L=a.bz(),a.cP(L,L,[this.width/2,-this.height/2,1]),a.bo(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=a.bz(),a.cP(L,L,[1,-1,1]),a.bo(L,L,[-1,-1,0]),a.cP(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=a.az(new Float64Array(16),this.labelPlaneMatrix,k),this._calcFogMatrices(),this._distanceTileDataCache={},L=a.bi(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.cS(this);const Ee=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.ad(Ee,Ee,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,d=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,v=[t,t,s];a.c1(v,v,_),a.c1(d,d,-1),a.cT(d,d,v);const S=a.bz();a.bo(S,S,d),a.cP(S,S,v),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,_)}_computeCameraPosition(t){const s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),_=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-d[0]*v,_.y/this.worldSize-d[1]*v,t/this.worldSize*this._centerAltitude-d[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],_=t[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(v=Math.min((s-d)/_,1)),this._camera.position=a.bE([],this._camera.position,t,v),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:d,bearing:_}=this._camera.getPitchBearing(),v=a.cb(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.al(this._maxPitch)),E=Math.max((t[2]-v)/Math.cos(d),S),C=this._zoomFromMercatorZ(E);a.bE(t,t,s,E),this._pitch=a.ay(d,a.al(this.minPitch),a.al(this.maxPitch)),this.angle=a.bQ(_,-Math.PI,Math.PI),this._setZoom(a.ay(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let s=0,d=a.cI,_=0,v=1/0;for(;d-s>1e-6&&d>s;){const S=s+.5*(d-s),E=this.tileSize*Math.pow(2,S),C=this.getCameraToCenterDistance(this.projection,S,E),k=this.scaleZoom(C/(Math.max(0,t)*this.tileSize)),L=Math.abs(S-k);L<v&&(v=L,_=S),S<k?s=S:d=S}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,s){const d=Math.min(t.x,s.x),_=Math.max(t.x,s.x),v=Math.min(t.y,s.y),S=Math.max(t.y,s.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new a.P(d,v),new a.P(_,S),new a.P(d,S),new a.P(_,v)],C=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const L of E){const j=this.pointRayIntersection(L);if(j.t<0)return!0;const B=this.rayIntersectionCoordinate(j);if(B.x<C||B.y<0||B.x>k||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.cU(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.P(0,0),new a.P(this.width,this.height))}zoomDeltaToMovement(t,s){const d=a.ae(a.at([],this._camera.position,t)),_=this._zoomFromMercatorZ(d)+s;return d-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const t=(function([s,d,_],v){const S=[s,d,_,1];a.aA(S,S,v);const E=S[3]=Math.max(S[3],1e-6);return S[0]/=E,S[1]/=E,S[2]/=E,S})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,t))}}getCameraToCenterDistance(t,s=this.zoom,d=this.worldSize){const _=a.cL(t,s,this.width,this.height,1024),v=t.pixelSpaceConversion(this.center.lat,d,_);let S=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(S=a.ai(1,S,a.cZ(this.pitch>=xo?1:this.pitch/xo))),S}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.az(t,t,this.globeMatrix),t}getFrustum(t){return a.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Va=(f,t)=>{if(t>0&&f.terrain&&a.w("Cutoff is currently disabled on terrain"),t<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=f.transform,d=Math.max(Math.abs(s._zoom-(f.minCutoffZoom-1)),1),_=s.isLODDisabled(!1)?a.af(60,45,s.pitch):a.af(30,15,s.pitch),v=s._farZ-s._nearZ,S=t*s.height,E=((1-(C=_))*s.cameraToCenterDistance+C*(s._farZ+S))*d;var C;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(E-s._nearZ)/v,(E-S-s._nearZ)/v]}}},bo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Xh{constructor(t,s){this.aabb=t,this.lastCascade=s}}class ad{add(t,s){const d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],s.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],s.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],s.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],s.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],s.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],s.max[2])):this.receivers[t.key]=new Xh(s,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,s,d){const _=a.d6.fromPoints(t.points);let v=0;for(const S in this.receivers){const E=this.receivers[S];if(!E||!_.intersectsAabb(E.aabb))continue;E.aabb.min=_.closestPoint(E.aabb.min),E.aabb.max=_.closestPoint(E.aabb.max);const C=E.aabb.getCorners();for(let k=0;k<d.length;k++){let L=!0;for(const j of C){const B=[j[0]*s,j[1]*s,j[2]];if(a.ad(B,B,d[k].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){L=!1;break}}if(E.lastCascade=k,v=Math.max(v,k),L)break}}return v+1}}class Yg{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ad,this._depthMode=new Qt(t.context.gl.LEQUAL,Qt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),t.tp.registerParameter(bo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(bo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(bo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,s){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const _=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||_<=0||(this._shadowLayerCount=d.style.order.reduce(((K,Z)=>{const J=d.style._mergedLayers[Z];return K+(J.hasShadowPass()&&!J.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const v=d.context,S=bo.shadowMapResolution,E=bo.shadowMapResolution;if(this._cascades.length===0||bo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let K=0;K<bo.cascadeCount;++K){const Z=d._shadowMapDebug,J=v.gl,Y=v.createFramebuffer(S,E,Z,"texture"),se=new a.T(v,{width:S,height:E,data:null},J.DEPTH_COMPONENT16);if(Y.depthAttachment.set(se.texture),Z){const ce=new a.T(v,{width:S,height:E,data:null},J.RGBA8);Y.colorAttachment.set(ce.texture)}this._cascades.push({framebuffer:Y,texture:se,matrix:[],far:0,boundingSphereRadius:0,frustum:new a.cy,scale:0})}}this.shadowDirection=pu(s);let C=0;if(t.elevation){const K=t.elevation,Z=[1e4,-1e4];K.visibleDemTiles.filter((J=>J.dem)).forEach((J=>{const Y=J.dem.tree;Z[0]=Math.min(Z[0],Y.minimums[0]),Z[1]=Math.max(Z[1],Y.maximums[0])})),Z[0]!==1e4&&(C=(Z[1]-Z[0])*K.exaggeration())}const k=1.5*t.cameraToCenterDistance,L=3*k,j=new Float64Array(16);for(let K=0;K<this._cascades.length;++K){const Z=this._cascades[K];let J=t.height/50,Y=1;bo.cascadeCount===1?Y=L:K===0?Y=k:(J=k,Y=L);const[se,ce]=oc(t,this.shadowDirection,J,Y,bo.shadowMapResolution,C);Z.scale=t.scale,Z.matrix=se,Z.boundingSphereRadius=ce,a.bi(j,Z.matrix),Z.frustum=a.cy.fromInvProjectionMatrix(j,1,0,!0),Z.far=Y}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/bo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=bo.shadowMapResolution,this._uniformValues.u_shadowmap_0=ha.ShadowMap0,this._uniformValues.u_shadowmap_1=ha.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const q=d.transform.elevation;for(const K of this._groundShadowTiles){let Z={min:0,max:0};if(q){const J=q.getMinMaxForTile(K);J&&(Z=J)}this.addShadowReceiver(K.toUnwrapped(),Z.min,Z.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,s){if(!this.enabled)return;const d=this.painter,_=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),_.viewport.set([0,0,bo.shadowMapResolution,bo.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){d.currentShadowCascade=v,_.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),_.clear({color:a.am.white,depth:1});for(const S of t.order){const E=t._mergedLayers[S];if(!E.hasShadowPass()||E.isHidden(d.transform.zoom))continue;const C=t.getLayerSourceCache(E),k=C?s[C.id]:void 0;(E.type==="model"||k&&k.length)&&d.renderLayer(d,C,E,k)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,s=t.style,d=t.context,_=d.gl,v=s.directionalLight,S=s.ambientLight;if(!v||!S)return;const E=[],C=Va(t,t.longestCutoffRange);C.shouldRenderCutoff&&E.push("RENDER_CUTOFF"),E.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&E.push("NORMAL_OFFSET");const k=Ol(s,v,S),L=new Qt(_.LEQUAL,Qt.ReadOnly,t.depthRangeFor3D),j=new Ar({func:_.EQUAL,mask:255},0,255,_.KEEP,_.KEEP,_.KEEP);for(const B of this._groundShadowTiles){const q=B.toUnwrapped(),K=t.isTileAffectedByFog(B),Z=t.getOrCreateProgram("groundShadow",{defines:E,overrideFog:K});this.setupShadows(q,Z),t.uploadCommonUniforms(d,Z,q,null,C);const J={u_matrix:t.transform.calculateProjMatrix(q),u_ground_shadow_factor:k};Z.draw(t,_.TRIANGLES,L,j,Wr.multiply,Sr.disabled,J,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Wr.unblended:Wr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const s=this.painter.transform,d=s.calculatePosMatrix(t,s.worldSize);return a.az(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){return a.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,s,d){if(!this.enabled)return;const _=this.painter.transform,v=this.painter.context,S=v.gl,E=this._uniformValues,C=new Float64Array(16),k=_.calculatePosMatrix(t,_.worldSize);for(let L=0;L<this._cascades.length;L++)a.az(C,this._cascades[L].matrix,k),E[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),v.activeTexture.set(S.TEXTURE0+ha.ShadowMap0+L),this._cascades[L].texture.bindExtraParam(S.LINEAR,S.LINEAR,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE,S.GREATER);if(this.useNormalOffset=!!d,this.useNormalOffset){const L=a.d4(t.canonical),j=2/_.tileSize*a.aj/bo.shadowMapResolution,B=j*this._cascades[0].boundingSphereRadius,q=j*this._cascades[this._cascades.length-1].boundingSphereRadius,K=(d==="vector-tile"?1:3)*(function(Z,J,Y,se,ce){const pe=a.ay((Z-22)/-22,0,1);return .125*(1-pe)+4*pe})(_.zoom);E.u_shadow_normal_offset=[L,B*K,q*K],E.u_shadow_bias=[1e-4,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(v,E)}setupShadowsFromMatrix(t,s,d=!1){if(!this.enabled)return;const _=this.painter.context,v=_.gl,S=this._uniformValues,E=new Float64Array(16);for(let C=0;C<bo.cascadeCount;C++)a.az(E,this._cascades[C].matrix,t),S[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),_.activeTexture.set(v.TEXTURE0+ha.ShadowMap0+C),this._cascades[C].texture.bindExtraParam(v.LINEAR,v.LINEAR,v.CLAMP_TO_EDGE,v.CLAMP_TO_EDGE,v.GREATER);if(this.useNormalOffset=d,d){const C=bo.normalOffset;S.u_shadow_normal_offset=[1,C,C],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(_,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,s,d,_){if(_[2]>=0)return{};const v=(function(C,k,L){const j=L/(1<<C.canonical.z);return new a.d6([C.canonical.x*j+C.wrap*L,C.canonical.y*j+C.wrap*L,0],[(C.canonical.x+1)*j+C.wrap*L,(C.canonical.y+1)*j+C.wrap*L,k])})(t,s,d).getCorners(),S=s/-_[2];_[0]<0?(a.d5(v[0],v[0],[_[0]*S,0,0]),a.d5(v[3],v[3],[_[0]*S,0,0])):_[0]>0&&(a.d5(v[1],v[1],[_[0]*S,0,0]),a.d5(v[2],v[2],[_[0]*S,0,0])),_[1]<0?(a.d5(v[0],v[0],[0,_[1]*S,0]),a.d5(v[1],v[1],[0,_[1]*S,0])):_[1]>0&&(a.d5(v[2],v[2],[0,_[1]*S,0]),a.d5(v[3],v[3],[0,_[1]*S,0]));const E={};return E.vertices=v,E.planes=[Ml(v[1],v[0],v[4]),Ml(v[2],v[1],v[5]),Ml(v[3],v[2],v[6]),Ml(v[0],v[3],v[7])],E}addShadowReceiver(t,s,d){this._receivers.add(t,a.d6.fromTileIdAndHeight(t,s,d))}getMaxCascadeForTile(t){const s=this._receivers.get(t);return s&&s.lastCascade?s.lastCascade:0}}function Ml(f,t,s){const d=a.at([],s,t),_=a.at([],f,t),v=a.bF([],d,_),S=a.ae(v);return S===0?[0,0,1,0]:(a.c1(v,v,1/S),[v[0],v[1],v[2],-a.bG(v,t)])}function pu(f){const t=f.properties.get("direction"),s=a.d1(t.x,t.y,t.z);s[2]=a.ay(s[2],0,75);const d=a.d3([s[0],s[1],s[2]]);return a.d2(d.x,d.y,d.z)}function Ol(f,t,s){const d=t.properties.get("color-use-theme")==="none",_=t.properties.get("color"),v=t.properties.get("intensity"),S=t.properties.get("direction"),E=[S.x,S.y,S.z],C=s.properties.get("color-use-theme")==="none",k=s.properties.get("color"),L=s.properties.get("intensity"),j=Math.max(a.bG([0,0,1],E),0),B=[0,0,0];a.c1(B,k.toPremultipliedRenderColor(C?null:f.getLut(t.scope)).toArray01Linear().slice(0,3),L);const q=[0,0,0];return a.c1(q,_.toPremultipliedRenderColor(d?null:f.getLut(s.scope)).toArray01Linear().slice(0,3),j*v),a.d8([B[0]>0?B[0]/(B[0]+q[0]):0,B[1]>0?B[1]/(B[1]+q[1]):0,B[2]>0?B[2]/(B[2]+q[2]):0])}function oc(f,t,s,d,_,v){const S=f.zoom,E=f.scale,C=f.worldSize,k=1/C,L=f.aspect,j=Math.sqrt(1+L*L)*Math.tan(.5*f.fovX),B=j*j,q=d-s,K=d+s;let Z,J;B>q/K?(Z=d,J=d*j):(Z=.5*K*(1+B),J=.5*Math.sqrt(q*q+2*(d*d+s*s)*B+K*K*B*B));const Y=f.projection.pixelsPerMeter(f.center.lat,C),se=f._camera.getCameraToWorldMercator(),ce=[0,0,-Z*k];a.ad(ce,ce,se);let pe=J*k;const Se=f._edgeInsets;if(!(Se.left===0&&Se.top===0&&Se.right===0&&Se.bottom===0||Se.left===Se.right&&Se.top===Se.bottom)){const vt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?Y:1),bt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,s,d);bt[8]=2*-f.centerOffset.x/f.width,bt[9]=2*f.centerOffset.y/f.height;const It=new Float64Array(16);a.cM(It,bt,vt);const Dt=new Float64Array(16);a.bi(Dt,It);const lr=a.cy.fromInvProjectionMatrix(Dt,C,S,!0);for(const pr of lr.points){const Yt=((Pe=pr)[0]/=E,Pe[1]/=E,Pe[2]=a.cb(Pe[2],f._center.lat),Pe);pe=Math.max(pe,a.c2(a.d7([],ce,Yt)))}}var Pe;pe*=_/(_-1);const Me=Math.acos(t[2]),Te=Math.atan2(-t[0],-t[1]),Ee=new gs;Ee.position=ce,Ee.setPitchBearing(Me,Te);const Ae=Ee.getWorldToCamera(C,Y),We=pe*C,Le=Math.min(f._mercatorZfromZoom(17)*C*-2,-2*We),ut=Ee.getCameraToClipOrthographic(-We,We,-We,We,Le,(We+v*Y)/t[2]),Je=new Float64Array(16);a.az(Je,ut,Ae);const dt=a.d2(Math.floor(1e6*ce[0])/1e6*C,Math.floor(1e6*ce[1])/1e6*C,0),wt=.5*_,qe=[0,0,0];a.ad(qe,dt,Je),a.c1(qe,qe,wt);const Re=[Math.floor(qe[0]),Math.floor(qe[1]),Math.floor(qe[2])],tt=[0,0,0];a.at(tt,qe,Re),a.c1(tt,tt,-1/wt);const Ye=new Float64Array(16);return a.bx(Ye),a.bo(Ye,Ye,tt),a.az(Je,Ye,Je),[Je,We]}class _p extends a.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,s){return a.aS(this.requestManager.transformRequest(s,a.R.Model).url).then((d=>{if(!d)return;const _=a.aT(d),v=new a.aU(t,void 0,void 0,_);return v.computeBoundsAndApplyParent(),v})).catch((d=>{if(d&&d.status===404)return null;this.fire(new a.z(new Error(`Could not load model ${t} from ${s}: ${d.message}`)))}))}load(t,s,d={forceReload:!1}){this.models[s]||(this.models[s]={});const _=Object.keys(t),v=[],S=[];for(const E of _){const C=t[E];this.hasURLBeenRequested(C)&&!d.forceReload||(this.modelByURL[C]={modelId:E,scope:s},v.push(this.loadModel(E,C)),S.push(E)),this.models[s][E]||(this.models[s][E]={model:null,numReferences:1})}this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+S.length,Promise.allSettled(v).then((E=>{for(let C=0;C<E.length;C++){const{status:k}=E[C];if(k==="rejected")continue;const{value:L}=E[C];this.models[s][S[C]]||(this.models[s][S[C]]={model:null,numReferences:1}),this.models[s][S[C]].model=L}this.numModelsLoading[s]-=S.length,this.fire(new a.A("data",{dataType:"style"}))})).catch((E=>{this.fire(new a.z(new Error(`Could not load models: ${E.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,s,d={exactIdMatch:!1}){return!!(d.exactIdMatch?this.getModel(t,s):this.getModelByURL(this.modelUris[s][t]))}getModel(t,s){return this.models[s]||(this.models[s]={}),this.models[s][t]?this.models[s][t].model:void 0}getModelByURL(t){if(!t)return null;const s=this.modelByURL[t];return s?this.models[s.scope][s.modelId].model:null}hasModelBeenAdded(t,s){return this.models[s]&&this.models[s][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,s,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const _=this.requestManager.normalizeModelURL(s);if((this.hasModel(t,d,{exactIdMatch:!0})||this.hasModelBeenAdded(t,d))&&this.modelUris[d][t]===_)this.models[d][t].numReferences++;else if(this.hasURLBeenRequested(_)){const{scope:v,modelId:S}=this.modelByURL[_];this.models[v][S].numReferences++}else this.modelUris[d][t]=_,this.load({[t]:this.modelUris[d][t]},d)}addModelURLs(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const d=this.modelUris[s];for(const _ in t)d[_]=this.requestManager.normalizeModelURL(t[_])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const d={};for(const _ of t)this.hasModel(_,s,{exactIdMatch:!0})||this.hasURLBeenRequested(_)?this.models[s][_].numReferences++:this.modelUris[s][_]&&!this.hasURLBeenRequested(_)?d[_]=this.modelUris[s][_]:!this.hasURLBeenRequested(_)&&a.d9(_,!1)&&(this.modelUris[s][_]=this.requestManager.normalizeModelURL(_),d[_]=this.modelUris[s][_]);this.load(d,s)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,s,d=!1,_=!1){if(this.models[s]&&this.models[s][t]&&(this.models[s][t].numReferences--,this.models[s][t].numReferences===0||_)){const v=this.modelUris[s][t];d||delete this.modelUris[s][t],delete this.modelByURL[v];const S=this.models[s][t].model;if(!S)return;delete this.models[s][t],S.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const s of Object.keys(this.models[t])){const d=this.models[t][s].model;delete this.models[t][s],d&&d.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,s){this.models[s]||(this.models[s]={});for(const d in this.models[s])this.models[s][d].model&&this.models[s][d].model.upload(t.context)}}const Kh=new a.a7({data:new a.a8(a.a5.colorTheme.data)});class yp{constructor(t){this._scope=t,this._buildingQueryParams={target:{featuresetId:"building-outline",importId:this._scope}},this._floorQueryParams={target:{featuresetId:"floor-outline",importId:this._scope}}}execute(t){const s=this._makeBuildingsQueryArea(t),d=this._makeFloorsQueryArea(t),_=t.queryRenderedFeatures(s,this._buildingQueryParams).filter((E=>E.properties.shape_type==="building")).reduce(((E,C)=>{const k=C.properties.id;return C.properties.shape_type!=="building"||E.some((L=>L.properties.id===k))||E.push(C),E}),[]),v=t.queryRenderedFeatures(d,this._floorQueryParams).filter((E=>E.properties.shape_type==="floor")).reduce(((E,C)=>{const k=C.properties.id;return C.properties.shape_type!=="floor"||E.some((L=>L.properties.id===k))||E.push(C),E}),[]),S=[t.getCenter().lng,t.getCenter().lat];return{floors:v,building:this._findBuildingAtCenter(S,_)||(_.length>0?_[0]:null)}}_makeBuildingsQueryArea(t){const s=t.transform.width,d=t.transform.height,_=Math.min(s,d),v=_*(1/8),S=_*(1/8),E=.5*(s-v),C=.5*(d-S);return[new a.P(E,C),new a.P(E+v,C+S)]}_makeFloorsQueryArea(t){const s=t.transform.width,d=t.transform.height,_=s*(2/3),v=d*(2/3),S=.5*(s-_),E=.5*(d-v);return[new a.P(S,E),new a.P(S+_,E+v)]}_findBuildingAtCenter(t,s){for(const d of s)if(d.geometry.type==="Polygon"&&this._pointInPolygon(t,d.geometry.coordinates[0]))return d;return null}_pointInPolygon(t,s){let d=!1;for(let _=0,v=s.length-1;_<s.length;v=_++){const S=s[_][0],E=s[_][1],C=s[v][1];E>t[1]!=C>t[1]&&t[0]<(s[v][0]-S)*(t[1]-E)/(C-E)+S&&(d=!d)}return d}}class mu{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}setBuildingId(t){this._selectedBuildingId=t}setFloors(t){if(this._floors=t.filter((s=>s.properties.building_id===this._selectedBuildingId)),!this._selectedFloorId||!this._floors.map((s=>s.properties.id)).includes(this._selectedFloorId)){const s=this._floors.map((d=>({id:d.properties.id,level:d.properties.floor_level}))).reduce(((d,_)=>{const v=Math.abs(d.level-1),S=Math.abs(_.level-1);return S<v||S===v&&_.level>d.level?_:d}));this._selectedFloorId=s.id}}setFloorId(t){this._selectedFloorId=t}getSelectedFloorId(){return this._selectedFloorId}getCurrentBuildingFloors(){return this._floors}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}}const Jg={"mbx-indoor-level-selected":{default:["literal",[]]}};function Tm(f){return f=f||{},Object.assign(f,Jg)}class Qg extends a.E{constructor(t){super(),a.aV(["_onLoad","_onMove"],this),this._map=t,this._floorSelectionState=new mu,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=null,this._floorSelectionState=null}_onLoad(){this._map.style.forEachFragmentStyle((t=>{t.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new a.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=t.scope,this._indoorDataQuery=new yp(this._scope)))})),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<16)return void this._clearIndoorData();const t=this._indoorDataQuery.execute(this._map);t&&t.floors.length!==0?(this._floorSelectionState.getSelectedFloorId()||this._map._addIndoorControl(),this._selectFloors(t)):this._clearIndoorData()}_selectFloors(t){if(t.building)this._floorSelectionState.setBuildingId(t.building.properties.id),this._floorSelectionState.setFloors(t.floors),this._updateUI();else{const s=this._floorSelectionState.getSelectedFloorId();if(s&&t.floors.some((d=>d.properties.id===s)))return;this._clearIndoorData()}}_clearIndoorData(){this._floorSelectionState.reset(),this._map._removeIndoorControl(),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[]])}_updateUI(){const t=this._floorSelectionState.getCurrentBuildingFloors().map((d=>({id:d.properties.id,name:d.properties.name,shortName:d.properties.floor_level,levelOrder:d.properties.floor_level}))),s=this._floorSelectionState.getSelectedFloorId();s?(this._updateIndoorConfig(),this.fire(new a.A("indoorupdate",{selectedFloorId:s,floors:t}))):console.warn("IndoorManager: Selected floor is not set")}_updateIndoorConfig(){const t=this._floorSelectionState.getSelectedFloorId();t?this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[t]]):console.warn("IndoorManager: Selected floor is not set")}selectFloor(t){this._floorSelectionState.setFloorId(t),this._updateIndoorConfig()}}function _s(f){if(!f.metadata||!f.metadata.content_area)return;const t=a.q.devicePixelRatio,{left:s,top:d,width:_,height:v}=f.metadata.content_area,S=s*t,E=d*t;return[S,E,S+_*t,E+v*t]}function eh(f){if(f)return f.map((([t,s])=>[t*a.q.devicePixelRatio,s*a.q.devicePixelRatio]))}class sd{constructor(t,s,d){this.id=t,this.scope=s,this.sourceCache=d,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const s=this.sourceCache.getVisibleCoordinates();if(s.length===0)return t;const d=this.sourceCache.getSource();if(!(d instanceof tu))return t;const _=s.map((S=>this.sourceCache.getTile(S))),v=d.getImages(_,Array.from(this.pendingRequests));for(const[S,E]of v)t.set(a.I.from({name:S,iconsetId:this.id}),E),this.pendingRequests.delete(S);for(const S of this.pendingRequests)this.missingRequests.add(S);return this.pendingRequests.clear(),t}}const Rl=(f,t)=>ve(f,t&&t.filter((s=>s.identifier!=="source.canvas"))),vp=a.aF(bn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),xp=a.aF(bn,["setCenter","setZoom","setBearing","setPitch"]),th=new Set(["background","sky","slot","custom"]),gu={version:8,layers:[],sources:{}},Yh={duration:300,delay:0};class ra extends a.E{constructor(t,s={}){super(),this.map=t,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=a.h({},Yh),this._buildingIndex=new qc(this),this.crossTileSymbolIndex=new Pa,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new Pi,this.dispatcher=s.dispatcher?s.dispatcher:new a.D(a.db(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new In(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new a.dc(t._requestManager,s.localFontFamily?a.dd.all:s.localIdeographFontFamily?a.dd.ideographs:a.dd.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new _p(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:s.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",a.de());const d=this;this._rtlTextPluginCallback=ra.registerForPluginStateChange((_=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},((v,S)=>{if(a.df(v),S&&S.every((E=>E)))for(const E in d._sourceCaches){const C=d._sourceCaches[E],k=C.getSource().type;k!=="vector"&&k!=="geojson"||C.reload()}}))})),this.on("data",(_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const v=this.getOwnSource(_.sourceId);if(v&&v.vectorLayerIds)for(const S in this._layers){const E=this._layers[S];E.source===v.id&&this._validateLayer(E)}}))}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(a.j(t))return t;const s=a.dg(t);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${a.dh(JSON.stringify(t))}`}_diffStyle(t,s,d){this.globalId=this._getGlobalId(t);const _=(v,S)=>{try{S(null,this.setState(v,d))}catch(E){S(E,!1)}};if(typeof t=="string"){const v=this.map._requestManager.normalizeStyleURL(t),S=this.map._requestManager.transformRequest(v,a.R.Style);a.n(S,((E,C)=>{E?this.fire(new a.z(E)):C&&_(C,s)}))}else typeof t=="object"&&_(t,s)}loadURL(t,s={}){this.fire(new a.A("dataloading",{dataType:"style"}));const d=typeof s.validate=="boolean"?s.validate:!a.j(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,s.accessToken),this.resolvedImports.add(t);const _=this.importsCache.get(t);if(_)return this._load(_,d);const v=this.map._requestManager.transformRequest(t,a.R.Style);this._request=a.n(v,((S,E)=>{if(this._request=null,S)this.fire(new a.z(S));else if(E)return this.importsCache.set(t,E),this._load(E,d)}))}loadJSON(t,s={}){this.fire(new a.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=a.q.frame((()=>{this._request=null,this._load(t,s.validate!==!1)}))}loadEmpty(){this.fire(new a.A("dataloading",{dataType:"style"})),this._load(gu,!1)}_loadImports(t,s,d){if(this.importDepth>=4)return a.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const v of t){const S=this._createFragmentStyle(v),E=new Promise((L=>{S.once("style.import.load",L),S.once("error",L)})).then((()=>this.mergeAll()));if(_.push(E),this.resolvedImports.has(v.url)){S.loadEmpty();continue}const C=v.data||this.importsCache.get(v.url);C?(S.loadJSON(C,{validate:s}),this._isInternalStyle(C)&&(S.globalId=null)):v.url?S.loadURL(v.url,{validate:s}):S.loadEmpty();const k={style:S,id:v.id,config:v.config};if(d){const L=this.fragments.findIndex((({id:j})=>j===d));this.fragments=this.fragments.slice(0,L).concat(k).concat(this.fragments.slice(L))}else this.fragments.push(k)}return Promise.allSettled(_)}getImportGlobalIds(t=this,s=new Set){for(const d of t.fragments)d.style.globalId&&s.add(d.style.globalId),this.getImportGlobalIds(d.style,s);return[...s.values()]}_createFragmentStyle(t){const s=this.scope?a.C(t.id,this.scope):t.id;let d;const _=this._initialConfig&&this._initialConfig[s];(t.config||_)&&(d=a.h({},t.config,_));const v=new ra(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,s){const d=t.indoor?Tm(t.schema):t.schema;if(this._isInternalStyle(t)){const S=a.h({},gu,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(S,s)}if(this.updateConfig(this._config,d),s&&Rl(this,qo(t)))return;this._loaded=!0,this.stylesheet=a.di(t);const _=()=>{for(const k in t.sources)this.addSource(k,t.sources[k],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const k in t.iconsets)this.addIconset(k,t.iconsets[k]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const S=ms(this.stylesheet.layers);if(this._order=S.map((k=>k.id)),this.stylesheet.light&&a.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const k=this.stylesheet.lights[0];this.light=new et(k.properties,k.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new et(this.stylesheet.light)),this._layers={};for(const k of S){const L=a.dn(k,this.scope,this._styleColorTheme.lut,this.options);L.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const j=this.getOwnLayerSourceCache(L),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();j&&L.canCastShadows()&&B&&(j.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const E=this.stylesheet.terrain;E&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(E,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new a.A("data",{dataType:"style"}));const C=this.isRootStyle();t.imports?this._loadImports(t.imports,s).then((()=>{this._reloadImports(),this.fire(new a.A(C?"style.load":"style.import.load"))})).catch((k=>{this.fire(new a.z(new Error("Failed to load imports",k))),this.fire(new a.A(C?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new a.A(C?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const S=this._evaluateColorThemeData(v);this._loadColorTheme(S).then((()=>{_()})).catch((E=>{a.w(`Couldn't load color theme from the stylesheet: ${E}`),_()}))}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,s,d,_,v,S,E,C,k,L;const j={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((B=>{if(B.stylesheet){if(B.light!=null&&(t=B.light),B.stylesheet.lights)for(const q of B.stylesheet.lights)q.type==="ambient"&&B.ambientLight!=null&&(s=B.ambientLight),q.type==="directional"&&B.directionalLight!=null&&(d=B.directionalLight);_=this._prioritizeTerrain(_,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(v=B.fog),B.stylesheet.snow&&B.snow!=null&&(S=B.snow),B.stylesheet.rain&&B.rain!=null&&(E=B.rain),B.stylesheet.camera!=null&&(L=B.stylesheet.camera),B.stylesheet.projection!=null&&(C=B.stylesheet.projection),B.stylesheet.transition!=null&&(k=B.stylesheet.transition),j[B.scope]=B._styleColorTheme}})),this.light=t,this.ambientLight=s,this.directionalLight=d,this.fog=v,this.snow=S,this.rain=E,this._styleColorThemeForScope=j,_===null?delete this.terrain:this.terrain=_,this.camera=L||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=a.h({},Yh,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const s=d=>{for(const _ of d.fragments)s(_.style);t(d)};s(this)}_prioritizeTerrain(t,s,d){const _=t&&t.drapeRenderMode===0;return d===null?s&&s.drapeRenderMode===0?s:_?t:null:s!=null&&(!t||_||s&&s.drapeRenderMode===1)?s:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((s=>{t=this._prioritizeTerrain(t,s.terrain,s.stylesheet.terrain)})),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((s=>{s.stylesheet.projection!=null&&(t=s.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const t={},s={},d={};this.forEachFragmentStyle((_=>{for(const v in _._sourceCaches){const S=a.C(v,_.scope);t[S]=_._sourceCaches[v]}for(const v in _._otherSourceCaches){const S=a.C(v,_.scope);s[S]=_._otherSourceCaches[v]}for(const v in _._symbolSourceCaches){const S=a.C(v,_.scope);d[S]=_._symbolSourceCaches[v]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=d}mergeLayers(){const t={},s=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((v=>{for(const S of v._order){const E=v._layers[S];if(E.type==="slot"){const C=a.dj(S);if(t[C])continue;t[C]=[]}E.slot&&t[E.slot]?t[E.slot].push(E):s.push(E)}})),this._mergedOrder=[];const _=(v=[])=>{for(const S of v)if(S.type==="slot"){const E=a.dj(S.id);t[E]&&_(t[E]),this._mergedSlots.push(E)}else{const E=a.C(S.id,S.scope);this._mergedOrder.push(E),d[E]=S,S.is3D(!!this.terrain)&&(this._has3DLayers=!0),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};_(s),this._mergedOrder.sort(((v,S)=>{const E=d[v],C=d[S];return E.hasInitialOcclusionOpacityProperties?C.is3D(!!this.terrain)?1:0:E.is3D(!!this.terrain)&&C.hasInitialOcclusionOpacityProperties?-1:0})),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=a.h({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(s,d,_,v){const S=a.h({},d);for(const C of Object.keys(a.a5.colorTheme))S[C]===void 0&&(S[C]=a.a5.colorTheme[C].default);const E=new a.a6(Kh,s,new Map(_));return E.setTransitionOrValue(S,_),E.untransitioned().possiblyEvaluate(new a.aa(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((d,_)=>{const v="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let S=t;S.startsWith(v)||(S=v+S);const E=a.I.from("mapbox-reserved-lut"),C=new Image;C.src=S,C.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},C.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void d();this._styleColorTheme.lutLoading=!1;const{width:k,height:L,data:j}=a.q.getImageData(C);if(L>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(k!==L*L)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(E)&&this.removeImage(E),this.addImage(E,{data:new a.r({width:k,height:L},j),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(E,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:t},d()):_(new Error("Missing LUT image."))}}))}getLut(t){const s=this._styleColorThemeForScope[t];return s?s.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(s,d,_){let v,S,E;const C=a.q.devicePixelRatio>1?"@2x":"";let k=a.n(d.transformRequest(d.normalizeSpriteURL(s,C,".json"),a.R.SpriteJSON),((B,q)=>{k=null,E||(E=B,v=q,j())})),L=a.o(d.transformRequest(d.normalizeSpriteURL(s,C,".png"),a.R.SpriteImage),((B,q)=>{L=null,E||(E=B,S=q,j())}));function j(){if(E)_(E);else if(v&&S){const B=a.q.getImageData(S),q={};for(const K in v){const{width:Z,height:J,x:Y,y:se,sdf:ce,pixelRatio:pe,stretchX:Se,stretchY:Pe,content:Me}=v[K],Te=new a.r({width:Z,height:J});a.r.copy(B,Te,{x:Y,y:se},{x:0,y:0},{width:Z,height:J},null),q[K]={data:Te,pixelRatio:pe,sdf:ce,stretchX:Se,stretchY:Pe,content:Me,usvg:!1}}_(null,q)}}return{cancel(){k&&(k.cancel(),k=null),L&&(L.cancel(),L=null)}}})(t,this.map._requestManager,((s,d)=>{if(this._spriteRequest=null,s)this.fire(new a.z(s));else if(d){const _=new Map;for(const v in d)_.set(a.I.from(v),d[v]);this.addImages(_)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.A("data",{dataType:"style"}))}))}addIconset(t,s){if(s.type==="sprite")return void this._loadSprite(s.url);const d=this.getOwnSourceCache(s.source);if(!d)return void this.fire(new a.z(new Error(`Source "${s.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const _=d.getSource();if(_.type!=="raster-array")return void this.fire(new a.z(new Error(`Source "${s.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));_.partial=!1;const v=new sd(t,this.scope,d);this.imageManager.addImageProvider(v,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!a.j(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const s=this.map._spriteFormat==="auto";var d,_;this._spriteRequest=(_=(v,S)=>{if(this._spriteRequest=null,v)s?this._loadSprite(t):this.fire(new a.z(v));else if(S){const E=new Map;for(const C in S)E.set(a.I.from(C),S[C]);this.addImages(E)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new a.A("data",{dataType:"style"}))},a.br((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(t),a.R.Iconset),((v,S)=>{if(v)return void _(v);const E={},C=a.da(new a.bq(S));for(const k of C.icons){const L={version:1,pixelRatio:a.q.devicePixelRatio,content:_s(k),stretchX:k.metadata?eh(k.metadata.stretch_x_areas):void 0,stretchY:k.metadata?eh(k.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:k};E[k.name]=L}_(null,E)})))}_validateLayer(t){const s=this.getOwnSource(t.source);if(!s)return;const d=t.sourceLayer;d&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(d)===-1)&&this.fire(new a.z(new Error(`Source layer "${d}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,s)=>{const d=this.fragments[s];return d&&d.style&&(t.data=d.style.serialize()),t}))}_serializeSources(){const t={};for(const s in this._sourceCaches){const d=this._sourceCaches[s].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){const s=[];for(const d of t){const _=this._layers[d];_&&_.type!=="custom"&&s.push(_.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const s=this.getOwnLayer(t);if(s)return s;this.fire(new a.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const s=this.getOwnSource(t);if(s)return s;this.fire(new a.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,s){const d=this.map.painter;if(d)for(let _=t.minzoom||0;_<(t.maxzoom||25.5);_++){const v=t.getProgramIds();if(v)for(const S of v){const E=t.getDefaultProgramParams(S,s.zoom,this._styleColorTheme.lut);E&&(d.style=this,this.fog&&(d._fogVisible=!0,E.overrideFog=!0,d.getOrCreateProgram(S,E)),d._fogVisible=!1,E.overrideFog=!1,d.getOrCreateProgram(S,E),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(E.overrideRtt=!0,d.getOrCreateProgram(S,E)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const s=this.calculateLightsBrightness();t.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const d=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const E=this._changes.getLayerUpdatesByScope();for(const C in E){const{updatedIds:k,removedIds:L}=E[C];(k||L)&&(this._updateWorkerLayers(C,k,L),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const v={};for(const E in this._mergedSourceCaches){const C=this._mergedSourceCaches[E];v[E]=C.used,C.used=!1,C.tileCoverLift=0}for(const E of this._mergedOrder){const C=this._mergedLayers[E];if(C.recalculate(t,this._availableImages),!C.isHidden(t.zoom)){const k=this.getLayerSourceCache(C);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(C,t)})):this.precompilePrograms(C,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();const S=this.imageManager.getPendingImageProviders();for(const E of S)E.sourceCache.used=!0;for(const E in v){const C=this._mergedSourceCaches[E];v[E]!==C.used&&C.getSource().fire(new a.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),d&&this.fire(new a.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const s of t){const d=s.resolvePendingRequests(),_=this.getFragmentStyle(s.scope);_&&_.addImages(d)}}_updateTilesForChangedImages(){const t={};for(const s in this._mergedSourceCaches){const d=this._mergedSourceCaches[s].getSource().scope;t[d]=t[d]||this._changes.getUpdatedImages(d),t[d].length!==0&&this._mergedSourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t[d])}for(const s in t)this._changes.resetUpdatedImages(s)}_updateWorkerLayers(t,s,d){const _=this.getFragmentStyle(t);_&&this.dispatcher.broadcast("updateLayers",{layers:s?_._serializeLayers(s):[],scope:t,removedIds:d||[],options:_.options})}setState(t,s){if(this._checkLoaded(),Rl(this,qo(t)))return!1;(t=a.di(t)).layers=ms(t.layers);const d=(function(S,E){if(!S)return[{command:bn.setStyle,args:[E]}];let C=[];try{if(!a.bv(S.version,E.version))return[{command:bn.setStyle,args:[E]}];if(a.bv(S.center,E.center)||C.push({command:bn.setCenter,args:[E.center]}),a.bv(S.zoom,E.zoom)||C.push({command:bn.setZoom,args:[E.zoom]}),a.bv(S.bearing,E.bearing)||C.push({command:bn.setBearing,args:[E.bearing]}),a.bv(S.pitch,E.pitch)||C.push({command:bn.setPitch,args:[E.pitch]}),a.bv(S.sprite,E.sprite)||C.push({command:bn.setSprite,args:[E.sprite]}),a.bv(S.glyphs,E.glyphs)||C.push({command:bn.setGlyphs,args:[E.glyphs]}),a.bv(S.imports,E.imports)||(function(q=[],K=[],Z){K=K||[];const J=(q=q||[]).map(su),Y=K.map(su),se=q.reduce(lu,{}),ce=K.reduce(lu,{}),pe=J.slice();let Se,Pe,Me,Te;for(Se=0,Pe=0;Se<J.length;Se++)Me=J[Se],ce.hasOwnProperty(Me)?Pe++:(Z.push({command:bn.removeImport,args:[Me]}),pe.splice(pe.indexOf(Me,Pe),1));for(Se=0,Pe=0;Se<Y.length;Se++)Me=Y[Y.length-1-Se],pe[pe.length-1-Se]!==Me&&(se.hasOwnProperty(Me)?(Z.push({command:bn.removeImport,args:[Me]}),pe.splice(pe.lastIndexOf(Me,pe.length-Pe),1)):Pe++,Te=pe[pe.length-Se],Z.push({command:bn.addImport,args:[ce[Me],Te]}),pe.splice(pe.length-Se,0,Me));for(const Ee of K){const Ae=se[Ee.id];Ae&&(delete Ae.data,a.bv(Ae,Ee)||Z.push({command:bn.updateImport,args:[Ee.id,Ee]}))}})(S.imports,E.imports,C),a.bv(S.transition,E.transition)||C.push({command:bn.setTransition,args:[E.transition]}),a.bv(S.light,E.light)||C.push({command:bn.setLight,args:[E.light]}),a.bv(S.fog,E.fog)||C.push({command:bn.setFog,args:[E.fog]}),a.bv(S.snow,E.snow)||C.push({command:bn.setSnow,args:[E.snow]}),a.bv(S.rain,E.rain)||C.push({command:bn.setRain,args:[E.rain]}),a.bv(S.projection,E.projection)||C.push({command:bn.setProjection,args:[E.projection]}),a.bv(S.lights,E.lights)||C.push({command:bn.setLights,args:[E.lights]}),a.bv(S.camera,E.camera)||C.push({command:bn.setCamera,args:[E.camera]}),a.bv(S.iconsets,E.iconsets)||(function(q,K,Z){let J;for(J in K=K||{},q=q||{})q.hasOwnProperty(J)&&(K.hasOwnProperty(J)||Z.push({command:bn.removeIconset,args:[J]}));for(J in K){if(!K.hasOwnProperty(J))continue;const Y=K[J];q.hasOwnProperty(J)?a.bv(q[J],Y)||(Z.push({command:bn.removeIconset,args:[J]}),Z.push({command:bn.addIconset,args:[J,Y]})):Z.push({command:bn.addIconset,args:[J,Y]})}})(S.iconsets,E.iconsets,C),!a.bv(S["color-theme"],E["color-theme"]))return[{command:bn.setStyle,args:[E]}];const k={},L=[];(function(q,K,Z,J){let Y;for(Y in K=K||{},q=q||{})q.hasOwnProperty(Y)&&(K.hasOwnProperty(Y)||ol(Y,Z,J));for(Y in K){if(!K.hasOwnProperty(Y))continue;const se=K[Y];q.hasOwnProperty(Y)?a.bv(q[Y],se)||(q[Y].type==="geojson"&&se.type==="geojson"&&wm(q,K,Y)?Z.push({command:bn.setGeoJSONSourceData,args:[Y,se.data]}):Vh(Y,K,Z,J)):Uh(Y,K,Z)}})(S.sources,E.sources,L,k);const j=[];S.layers&&S.layers.forEach((q=>{q.source&&k[q.source]?C.push({command:bn.removeLayer,args:[q.id]}):j.push(q)}));let B=S.terrain;B&&k[B.source]&&(C.push({command:bn.setTerrain,args:[void 0]}),B=void 0),C=C.concat(L),a.bv(B,E.terrain)||C.push({command:bn.setTerrain,args:[E.terrain]}),(function(q,K,Z){K=K||[];const J=(q=q||[]).map(su),Y=K.map(su),se=q.reduce(lu,{}),ce=K.reduce(lu,{}),pe=J.slice(),Se=Object.create(null);let Pe,Me,Te,Ee,Ae,We,Le;for(Pe=0,Me=0;Pe<J.length;Pe++)Te=J[Pe],ce.hasOwnProperty(Te)?Me++:(Z.push({command:bn.removeLayer,args:[Te]}),pe.splice(pe.indexOf(Te,Me),1));for(Pe=0,Me=0;Pe<Y.length;Pe++)Te=Y[Y.length-1-Pe],pe[pe.length-1-Pe]!==Te&&(se.hasOwnProperty(Te)?(Z.push({command:bn.removeLayer,args:[Te]}),pe.splice(pe.lastIndexOf(Te,pe.length-Me),1)):Me++,We=pe[pe.length-Pe],Z.push({command:bn.addLayer,args:[ce[Te],We]}),pe.splice(pe.length-Pe,0,Te),Se[Te]=!0);for(Pe=0;Pe<Y.length;Pe++)if(Te=Y[Pe],Ee=se[Te],Ae=ce[Te],!Se[Te]&&!a.bv(Ee,Ae))if(a.bv(Ee.source,Ae.source)&&a.bv(Ee["source-layer"],Ae["source-layer"])&&a.bv(Ee.type,Ae.type)){for(Le in au(Ee.layout,Ae.layout,Z,Te,null,bn.setLayoutProperty),au(Ee.paint,Ae.paint,Z,Te,null,bn.setPaintProperty),a.bv(Ee.slot,Ae.slot)||Z.push({command:bn.setSlot,args:[Te,Ae.slot]}),a.bv(Ee.filter,Ae.filter)||Z.push({command:bn.setFilter,args:[Te,Ae.filter]}),a.bv(Ee.minzoom,Ae.minzoom)&&a.bv(Ee.maxzoom,Ae.maxzoom)||Z.push({command:bn.setLayerZoomRange,args:[Te,Ae.minzoom,Ae.maxzoom]}),Ee)Ee.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&Le!=="slot"&&(Le.indexOf("paint.")===0?au(Ee[Le],Ae[Le],Z,Te,Le.slice(6),bn.setPaintProperty):a.bv(Ee[Le],Ae[Le])||Z.push({command:bn.setLayerProperty,args:[Te,Le,Ae[Le]]}));for(Le in Ae)Ae.hasOwnProperty(Le)&&!Ee.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&Le!=="slot"&&(Le.indexOf("paint.")===0?au(Ee[Le],Ae[Le],Z,Te,Le.slice(6),bn.setPaintProperty):a.bv(Ee[Le],Ae[Le])||Z.push({command:bn.setLayerProperty,args:[Te,Le,Ae[Le]]}))}else Z.push({command:bn.removeLayer,args:[Te]}),We=pe[pe.lastIndexOf(Te)+1],Z.push({command:bn.addLayer,args:[Ae,We]})})(j,E.layers,C)}catch(k){console.warn("Unable to compute style diff:",k),C=[{command:bn.setStyle,args:[E]}]}return C})(this.serialize(),t).filter((S=>!(S.command in xp)));if(d.length===0)return!1;const _=d.filter((S=>!(S.command in vp)));if(_.length>0)throw new Error(`Unimplemented: ${_.map((S=>S.command)).join(", ")}.`);const v=[];return d.forEach((S=>{v.push(this[S.command](...S.args))})),s&&Promise.all(v).then(s).catch(s),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[s,d]of t.entries()){if(this.getImage(s))return this.fire(new a.z(new Error(`An image with the name "${s.name}" already exists.`)));this.imageManager.addImage(s,this.scope,d),this._changes.updateImage(s,this.scope)}return this._updateWorkerImages(),this.fire(new a.A("data",{dataType:"style"})),this}addImage(t,s){return this.getImage(t)?this.fire(new a.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,s),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new a.A("data",{dataType:"style"})),this)}updateImage(t,s,d=!1){this.imageManager.updateImage(t,this.scope,s),d&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new a.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new a.A("data",{dataType:"style"})),this):this.fire(new a.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new a.A("data",{dataType:"style"})),this}addModel(t,s,d={}){return this._checkLoaded(),this._validate(ye,`models.${t}`,s,null,d)||(this.modelManager.addModel(t,s,this.scope),this.fire(new a.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new a.A("data",{dataType:"style"})),this):this.fire(new a.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,s,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(nl,`sources.${t}`,s,null,d))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const _=ru(t,s,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id})));const v=S=>{const E=(S?"symbol:":"other:")+_.id,C=a.C(E,this.scope),k=this._sourceCaches[E]=new Go(C,_,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=k,k.onAdd(this.map)};v(!1),s.type!=="vector"&&s.type!=="geojson"||v(!0),_.onAdd&&_.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const s=this.getOwnSource(t);if(!s)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===t)return this.fire(new a.z(new Error(`Source "${t}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new a.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const _=Object.entries(this.stylesheet.iconsets).find((([v,S])=>S.type==="source"&&S.source===t));if(_)return this.fire(new a.z(new Error(`Source "${t}" cannot be removed while iconset "${_[0]}" is using it.`)))}const d=this.getOwnSourceCaches(t);for(const _ of d){const v=a.dj(_.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(_.id),_.fire(new a.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getOwnSource(t).setData(s),this._changes.setDirty()}getOwnSource(t){const s=this.getOwnSourceCache(t);return s&&s.getSource()}getOwnSources(){const t=[];for(const s in this._otherSourceCaches){const d=this.getOwnSourceCache(s);d&&t.push(d.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const s in t){const d=t[s]._tiles;for(const _ in d){const v=d[_];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const v of t){if(this._validate(Wu,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){const S=this.ambientLight;S.set(v),S.updateTransitions(s)}else this.ambientLight=new qn(v,hn||(hn=new a.a7({color:new a.a8(a.a5.properties_light_ambient.color),"color-use-theme":new a.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.a8(a.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const S=this.directionalLight;S.set(v),S.updateTransitions(s)}else this.directionalLight=new qn(v,Li||(Li=new a.a7({direction:new a.an(a.a5.properties_light_directional.direction),color:new a.a8(a.a5.properties_light_directional.color),"color-use-theme":new a.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new a.a8(a.a5.properties_light_directional.intensity),"cast-shadows":new a.a8(a.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new a.a8(a.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new a.a8(a.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=Object.assign(s,{worldview:this.map.getWorldview()}),_=new a.aa(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,s=this.ambientLight;if(!t||!s)return;const d=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),_=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),v=t.properties.get("intensity"),S=t.properties.get("direction"),E=1-a.d1(S.x,S.y,S.z)[2]/90,C=d(_)*v*E,k=s.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),L=s.properties.get("intensity"),j=d(k)*L;return Number(((C+j)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(a.dk(t)){const s=a.dl(t),d=this.fragments.find((({id:v})=>v===s));if(!d)return;const _=a.dj(t);return d.style.getFragmentStyle(_)}{const s=this.fragments.find((({id:d})=>d===t));return s?s.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const s={},d=(_,v="")=>`${_}::${v}`;this._featuresetSelectors={};for(const _ in t){const v=this._featuresetSelectors[_]=[];for(const S of t[_].selectors){if(S.featureNamespace){const C=this.getOwnLayer(S.layer);if(!C){a.w(`Layer is undefined for selector: ${S.layer}`);continue}const k=d(C.source,C.sourceLayer);if(k in s&&s[k]!==S.featureNamespace){a.w(`"featureNamespace ${S.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}s[k]=S.featureNamespace}let E;if(S.properties)for(const C in S.properties){const k=a.X(S.properties[C]);k.result==="success"&&(E=E||{},E[C]=k.value)}v.push({layerId:S.layer,namespace:S.featureNamespace,properties:E,uniqueFeatureID:S._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const s=this.getFragmentStyle(t);if(!s||!s.stylesheet.featuresets)return[];const d=[];for(const _ in s.stylesheet.featuresets)d.push({featuresetId:_,importId:s.scope?s.scope:void 0});return d}getFeaturesetLayers(t,s){const d=this.getFragmentStyle(s),_=d.stylesheet.featuresets;if(!_||!_[t])return this.fire(new a.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const v=[];for(const S of _[t].selectors){const E=d.getOwnLayer(S.layer);E&&v.push(E)}return v}getConfigProperty(t,s){const d=this.getFragmentStyle(t);if(!d)return null;const _=a.C(s,d.scope),v=d.options.get(_),S=v?v.value||v.default:null;return S?S.serialize():null}setConfigProperty(t,s,d){const _=this.getFragmentStyle(t);if(!_)return;const v=_.stylesheet.indoor?Tm(_.stylesheet.schema):_.stylesheet.schema;if(!v||!v[s])return;const S=a.X(d);if(S.result!=="success")return void Rl(this,S.value);const E=S.value.expression,C=a.C(s,_.scope),k=_.options.get(C);if(!k)return;let L;const{minValue:j,maxValue:B,stepValue:q,type:K,values:Z}=v[s],J=a.X(v[s].default);J.result==="success"&&(L=J.value.expression),L?(this.options.set(C,Object.assign({},k,{value:E,default:L,minValue:j,maxValue:B,stepValue:q,type:K,values:Z})),this.updateConfigDependencies(s)):this.fire(new a.z(new Error(`No schema defined for the config option "${s}" in the "${t}" fragment.`)))}getConfig(t){const s=this.getFragmentStyle(t);if(!s)return null;const d=s.stylesheet.schema;if(!d)return null;const _={};for(const v in d){const S=a.C(v,s.scope),E=s.options.get(S),C=E?E.value||E.default:null;_[v]=C?C.serialize():null}return _}setConfig(t,s){const d=this.getFragmentStyle(t);d&&(d.updateConfig(s,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const s=this.getFragmentStyle(t);return s?s.stylesheet.schema:null}setSchema(t,s){const d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=s,d.updateConfig(d._config,s),this.updateConfigDependencies())}updateConfig(t,s){if(this._config=t,t||s)if(s)for(const d in s){let _,v;const S=a.X(s[d].default);if(S.result==="success"&&(_=S.value.expression),t&&t[d]!==void 0){const B=a.X(t[d]);B.result==="success"&&(v=B.value.expression)}const{minValue:E,maxValue:C,stepValue:k,type:L,values:j}=s[d];if(_){const B=a.C(d,this.scope);this.options.set(B,{default:_,value:v,minValue:E,maxValue:C,stepValue:k,type:L,values:j})}else this.fire(new a.z(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new a.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const s of this._configDependentLayers){const d=this.getLayer(s);if(d){if(t&&!d.configDependencies.has(t))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((s=>{const d=s._styleColorTheme.colorThemeOverride?s._styleColorTheme.colorThemeOverride:s._styleColorTheme.colorTheme;if(d){const _=s._evaluateColorThemeData(d);(!s._styleColorTheme.lut&&_!==""||s._styleColorTheme.lut&&_!==s._styleColorTheme.lut.data)&&s.setColorTheme(d)}})),this._changes.setDirty()}addLayer(t,s,d={}){this._checkLoaded();const _=t.id;if(this._layers[_])return void this.fire(new a.z(new Error(`Layer with id "${_}" already exists on this map`)));let v;if(t.type==="custom"){if(Rl(this,a.dm(t)))return;v=a.dn(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(_,t.source),t=a.di(t),t=a.h(t,{source:_})),this._validate(Cn,`layers.${_}`,t,{arrayIndex:-1},d))return;v=a.dn(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}})}v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid);let S=this._order.length;if(s){const L=this._order.indexOf(s);if(L===-1)return void this.fire(new a.z(new Error(`Layer with id "${s}" does not exist on this map.`)));v.slot===this._layers[s].slot?S=L:a.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,_),this._layerOrderChanged=!0,this._layers[_]=v;const E=this.getOwnLayerSourceCache(v),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&v.canCastShadows()&&C&&(E.castsShadows=!0);const k=this._changes.getRemovedLayer(v);if(k&&v.source&&E&&v.type!=="custom"){this._changes.discardLayerRemoval(v);const L=a.C(v.source,v.scope);k.type!==v.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),E.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(t,s){this._checkLoaded();const d=this._checkLayer(t);if(!d||t===s)return;const _=this._order.indexOf(t);this._order.splice(_,1);let v=this._order.length;if(s){const S=this._order.indexOf(s);if(S===-1)return void this.fire(new a.z(new Error(`Layer with id "${s}" does not exist on this map.`)));d.slot===this._layers[s].slot?v=S:a.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const s=this._checkLayer(t);if(!s)return;s.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const _=this.getOwnLayerSourceCache(s);if(_&&_.castsShadows){let v=!1;for(const S in this._layers)if(this._layers[S].source===s.source&&this._layers[S].canCastShadows()){v=!0;break}_.castsShadows=v}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,d){this._checkLoaded();const _=this._checkLayer(t);_&&(_.minzoom===s&&_.maxzoom===d||(s!=null&&(_.minzoom=s),d!=null&&(_.maxzoom=d),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,s){this._checkLoaded();const d=this._checkLayer(t);d&&d.slot!==s&&(d.slot=s,this._updateLayer(d))}setFilter(t,s,d={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!a.bv(_.filter,s))return s==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(Ke,`layers.${_.id}.filter`,s,{layerType:_.type},d)||(_.filter=a.di(s),this._updateLayer(_)))}getFilter(t){const s=this._checkLayer(t);if(s)return a.di(s.filter)}setLayoutProperty(t,s,d,_={}){this._checkLoaded();const v=this._checkLayer(t);if(v&&!a.bv(v.getLayoutProperty(s),d)){if(d!=null&&(!_||_.validate!==!1)&&Rl(v,oe.call(qo,{key:`layers.${t}.layout.${s}`,layerType:v.type,objectKey:s,value:d,styleSpec:a.a5,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(s,d),v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(t,s){const d=this._checkLayer(t);if(d)return d.getLayoutProperty(s)}setPaintProperty(t,s,d,_={}){this._checkLoaded();const v=this._checkLayer(t);if(!v||a.bv(v.getPaintProperty(s),d)||d!=null&&(!_||_.validate!==!1)&&Rl(v,re.call(qo,{key:`layers.${t}.paint.${s}`,layerType:v.type,objectKey:s,value:d,styleSpec:a.a5})))return;const S=v.setPaintProperty(s,d);v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),S&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(t,s){const d=this._checkLayer(t);if(d)return d.getPaintProperty(s)}setFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:C,importId:k}=t.target,L=this.getFragmentStyle(k),j=L.getFeaturesetLayers(C);for(const{source:B,sourceLayer:q}of j)L.setFeatureState({id:t.id,source:B,sourceLayer:q},s)}else if("layerId"in t.target){const{layerId:C}=t.target,k=this.getLayer(C);this.setFeatureState({id:t.id,source:k.source,sourceLayer:k.sourceLayer},s)}return}const d=t.source,_=t.sourceLayer,v=this._checkSource(d);if(!v)return;const S=v.type;if(S==="geojson"&&_)return void this.fire(new a.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!_)return void this.fire(new a.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new a.z(new Error("The feature id parameter must be provided.")));const E=this.getOwnSourceCaches(d);for(const C of E)C.setFeatureState(_,t.id,s)}removeFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:C,importId:k}=t.target,L=this.getFragmentStyle(k),j=L.getFeaturesetLayers(C);for(const{source:B,sourceLayer:q}of j)L.removeFeatureState({id:t.id,source:B,sourceLayer:q},s)}else if("layerId"in t.target){const{layerId:C}=t.target,k=this.getLayer(C);this.removeFeatureState({id:t.id,source:k.source,sourceLayer:k.sourceLayer},s)}return}const d=t.source,_=this._checkSource(d);if(!_)return;const v=_.type,S=v==="vector"?t.sourceLayer:void 0;if(v==="vector"&&!S)return void this.fire(new a.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new a.z(new Error("A feature id is required to remove its specific state property.")));const E=this.getOwnSourceCaches(d);for(const C of E)C.removeFeatureState(S,t.id,s)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let v;if("featuresetId"in t.target){const{featuresetId:S,importId:E}=t.target,C=this.getFragmentStyle(E),k=C.getFeaturesetLayers(S);for(const{source:L,sourceLayer:j}of k){const B=C.getFeatureState({id:t.id,source:L,sourceLayer:j});if(B&&!v)v=B;else if(!a.bv(v,B))return void this.fire(new a.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:S}=t.target,E=this.getLayer(S);v=this.getFeatureState({id:t.id,source:E.source,sourceLayer:E.sourceLayer})}return v}const s=t.source,d=t.sourceLayer,_=this._checkSource(s);if(_){if(_.type!=="vector"||d)return t.id===void 0&&this.fire(new a.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(d,t.id);this.fire(new a.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=a.h({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return a.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),s=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return a.dp({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(d=>d!==void 0))}_updateFilteredLayers(t){for(const s of Object.values(this._mergedLayers))t(s)&&this._updateLayer(s)}_updateLayer(t){this._changes.updateLayer(t);const s=this.getLayerSourceCache(t),d=a.C(t.source,t.scope),_=this._changes.getUpdatedSourceCaches();t.source&&!_[d]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),s.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=E=>this._mergedLayers[E].is3D(!!this.terrain),d=this.order,_={},v=[];for(let E=d.length-1;E>=0;E--){const C=d[E];if(s(C)){_[C]=E;for(const k of t){const L=k[C];if(L)for(const j of L)v.push(j)}}}v.sort(((E,C)=>C.intersectionZ-E.intersectionZ));const S=[];for(let E=d.length-1;E>=0;E--){const C=d[E];if(s(C))for(let k=v.length-1;k>=0;k--){const L=v[k].feature;if(L.layer&&_[L.layer.id]<E)break;S.push(L),v.pop()}else for(const k of t){const L=k[C];if(L)for(const j of L)S.push(j.feature)}}return S}queryRenderedFeatures(t,s,d){let _;s&&!Array.isArray(s)&&s.filter&&(this._validate(Ke,"queryRenderedFeatures.filter",s.filter,null,s),_=a.b3(s.filter));const v={},S=L=>{if(th.has(L.type))return;const j=this.getOwnLayerSourceCache(L),B=v[j.id]=v[j.id]||{sourceCache:j,layers:{},has3DLayers:!1};L.is3D(!!this.terrain)&&(B.has3DLayers=!0),B.layers[L.fqid]=B.layers[L.fqid]||{styleLayer:L,targets:[]},B.layers[L.fqid].targets.push({filter:_})};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new a.z(new Error("parameters.layers must be an Array."))),[];for(const L of s.layers){const j=this._layers[L];if(!j)return this.fire(new a.z(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];S(j)}}else for(const L in this._layers)S(this._layers[L]);const E=this._queryRenderedFeatures(t,v,d),C=this._flattenAndSortRenderedFeatures(E),k=[];for(const L of C)a.dq(L.layer.id)===this.scope&&k.push(L);return k}queryRenderedFeatureset(t,s,d){let _;s&&!Array.isArray(s)&&s.filter&&(this._validate(Ke,"queryRenderedFeatures.filter",s.filter,null,s),_=a.b3(s.filter));const v="mock",S=[];if(s&&s.target)S.push(Object.assign({},s,{targetId:v,filter:_}));else{const L=this.getFeaturesetDescriptors();for(const j of L)S.push({targetId:v,filter:_,target:j});for(const{style:j}of this.fragments){const B=j.getFeaturesetDescriptors();for(const q of B)S.push({targetId:v,filter:_,target:q})}}const E=this.queryRenderedTargets(t,S,d),C=[],k=new Set;for(const L of E)for(const j of L.variants[v])iu(j,L,k)||C.push(new a.dr(L,j));return C}queryRenderedTargets(t,s,d){const _={},v=(E,C,k,L)=>{const j=_[C.id]=_[C.id]||{sourceCache:C,layers:{},has3DLayers:!1};if(j.layers[E.fqid]=j.layers[E.fqid]||{styleLayer:E,targets:[]},E.is3D(!!this.terrain)&&(j.has3DLayers=!0),!L)return k.uniqueFeatureID=!1,void j.layers[E.fqid].targets.push(k);j.layers[E.fqid].targets.push(Object.assign({},k,{namespace:L.namespace,properties:L.properties,uniqueFeatureID:L.uniqueFeatureID}))};for(const E of s)if("featuresetId"in E.target){const{featuresetId:C,importId:k}=E.target,L=this.getFragmentStyle(k);if(!L||!L._featuresetSelectors)continue;const j=L._featuresetSelectors[C];if(!j){this.fire(new a.z(new Error(`The featureset '${C}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of j){const q=L.getOwnLayer(B.layerId);q&&!th.has(q.type)&&v(q,L.getOwnLayerSourceCache(q),E,B)}}else if("layerId"in E.target){const{layerId:C}=E.target,k=this.getLayer(C);if(!k||th.has(k.type))continue;v(k,this.getLayerSourceCache(k),E)}const S=this._queryRenderedFeatures(t,_,d);return this._flattenAndSortRenderedFeatures(S)}_queryRenderedFeatures(t,s,d){const _=[],v=!!this.map._showQueryGeometry,S=kn.createFromScreenPoints(t,d);for(const E in s){const C=Xu(S,s[E],this._availableImages,d,v);Object.keys(C).length&&_.push(C)}if(this.placement)for(const E in s){if(!s[E].sourceCache._onlySymbols)continue;const C=Ku(S.screenGeometry,s[E],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(C).length&&_.push(C)}return _}querySourceFeatures(t,s){const d=s&&s.filter;d&&this._validate(Ke,"querySourceFeatures.filter",d,null,s);let _=[];const v=this.getOwnSourceCaches(t);for(const S of v)_=_.concat(Nh(S,s));return _}addSourceType(t,s,d){return ra.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(ra.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,s,d={}){this._checkLoaded();const _=this.light.getLight();let v=!1;for(const E in t)if(!a.bv(t[E],_[E])){v=!0;break}if(!v)return;const S=this._getTransitionParameters();this.light.setLight(t,s,d),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=a.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&a.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,s=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t;const _=t.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){const E="terrain-dem-src";this.addSource(E,d.source),d=a.di(d),d=a.h(d,{source:E})}const v=a.h({},d),S={};if(this.terrain&&_){v.source=this.terrain.get().source;const E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(S.style=E.serialize())}if(this._validate(Ct,"terrain",v,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&s!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,s),this.fire(new a.A("data",{dataType:"style"}))}else{const v=this.terrain,S=v.get();for(const E of Object.keys(a.a5.terrain))!d.hasOwnProperty(E)&&a.a5.terrain[E].default&&(d[E]=a.a5.terrain[E].default);for(const E in t)if(!a.bv(t[E],S[E])){v.set(t,this.options),this.stylesheet.terrain=t;const C=this._getTransitionParameters({duration:0});v.updateTransitions(C),this.fire(new a.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const s=this.fog=new Jr(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}_createSnow(t){const s=this.snow=new $n(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}_createRain(t){const s=this.rain=new to(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!a.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.fog=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const s=this.snow;if(!a.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.snow=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const s=this.rain;if(!a.bv(s.get(),t)){s.set(t,this.options),this.stylesheet.rain=s.get();const d=this._getTransitionParameters({duration:0});s.updateTransitions(d)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!s)return this._styleColorTheme.lut=null,void t();const d=this._evaluateColorThemeData(s);this._loadColorTheme(d).then((()=>{this.fire(new a.A("colorthemeset")),t()})).catch((_=>{a.w(`Couldn't set color theme: ${_}`)}))}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&a.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,s){const d=this.getFragmentStyle(t);d&&(d._styleColorTheme.colorThemeOverride=s,d._reloadColorTheme())}_getTransitionParameters(t){return{now:a.q.now(),transition:a.h(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],s=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):s.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){const d=this.terrain=new Ue(t,s,this.scope,this.options,this.map.getWorldview());s===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});d.updateTransitions(_)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,d,_,v={}){if(v&&v.validate===!1)return!1;const S=a.h({},this.serialize());return Rl(this,t.call(qo,a.h({key:s,style:S,value:d,styleSpec:a.a5},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.ds.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const s=this.getSourceCaches(t);for(const d of s)d.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const s=this._mergedLayers[t];s._clear&&s._clear()}}reloadSource(t){const s=this.getSourceCaches(t);for(const d of s)d.resume(),d.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((t=>{t.modelManager.reloadModels(t.scope)}))}updateSources(t){let s;this.directionalLight&&(s=pu(this.directionalLight));const d=new Set;for(const _ in this._mergedLayers){const v=this._mergedLayers[_];v.hasElevation()&&!d.has(v.source)&&d.add(v.source)}for(const _ in this._mergedSourceCaches){const v=this._mergedSourceCaches[_],S=d.has(v._source.id);v.update(t,void 0,void 0,s,S)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,d,_,v,S,E=!1){let C=!1,k=!1;const L={},j={};for(const B of this._mergedOrder){const q=this._mergedLayers[B];if(q.type!=="symbol")continue;const K=a.C(q.source,q.scope);let Z=L[K];if(!Z){const Y=this.getLayerSourceCache(q);if(!Y)continue;const se=Y.getRenderableIds(!0).map((ce=>Y.getTileByID(ce)));j[K]=se.slice(),Z=L[K]=se.sort(((ce,pe)=>pe.tileID.overscaledZ-ce.tileID.overscaledZ||(ce.tileID.isLessThan(pe.tileID)?-1:1)))}const J=this.crossTileSymbolIndex.addLayer(q,Z,s.center.lng,s.projection);C=C||J}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),E=E||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new a.A("neworder")),(E||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.q.now(),s.zoom))&&(this.pauseablePlacement=new nd(s,this._mergedOrder,E,d,_,v,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,j,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.q.now()),k=!0),C&&this.pauseablePlacement.placement.setStale()),k||C){this._buildingIndex.onNewFrame(s.zoom);for(let B=0;B<this._mergedOrder.length;B++){const q=this._mergedLayers[this._mergedOrder[B]];if(q.type!=="symbol")continue;const K=this.isLayerClipped(q);this.placement.updateLayerOpacities(q,L[a.C(q.source,q.scope)],B,K?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,s){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex((({id:v})=>v===t.id))!==-1)return void this.fire(new a.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!s)return d.push(t),this._loadImports([t],!0);const _=d.findIndex((({id:v})=>v===s));return _===-1&&this.fire(new a.z(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,_).concat(t).concat(d.slice(_)),this._loadImports([t],!0,s)}updateImport(t,s){this._checkLoaded();const d=this.stylesheet.imports||[],_=this.getImportIndex(t);return _===-1?this:typeof s=="string"?(this.setImportUrl(t,s),this):(s.url&&s.url!==d[_].url&&this.setImportUrl(t,s.url),a.bv(s.config,d[_].config)||this.setImportConfig(t,s.config,s.data.schema),a.bv(s.data,d[_].data)||this.setImportData(t,s.data),this)}moveImport(t,s){this._checkLoaded();let d=this.stylesheet.imports||[];const _=this.getImportIndex(t);if(_===-1)return this;const v=this.getImportIndex(s);if(v===-1)return this;const S=d[_],E=this.fragments[_];return d=d.filter((({id:C})=>C!==t)),this.fragments=this.fragments.filter((({id:C})=>C!==t)),this.stylesheet.imports=d.slice(0,v).concat(S).concat(d.slice(v)),this.fragments=this.fragments.slice(0,v).concat(E).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(t,s){this._checkLoaded();const d=this.stylesheet.imports||[],_=this.getImportIndex(t);if(_===-1)return this;d[_].url=s;const v=this.fragments[_];return v.style=this._createFragmentStyle(d[_]),v.style.on("style.import.load",(()=>this.mergeAll())),v.style.loadURL(s),this}setImportData(t,s){this._checkLoaded();const d=this.getImportIndex(t),_=this.stylesheet.imports||[];return d===-1?this:s?(this.fragments[d].style.setState(s),this._reloadImports(),this):(delete _[d].data,this.setImportUrl(t,_[d].url))}setImportConfig(t,s,d){this._checkLoaded();const _=this.getImportIndex(t),v=this.stylesheet.imports||[];if(_===-1)return this;s?v[_].config=s:delete v[_].config;const S=this.fragments[_];d&&S.style.stylesheet&&(S.style.stylesheet.schema=d);const E=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=s,S.style.updateConfig(s,E),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const s=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(s.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){const s=(this.stylesheet.imports||[]).findIndex((d=>d.id===t));return s===-1&&this.fire(new a.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),s}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const s in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[s];d&&t.push(d.getSource())}return t}getSource(t,s){const d=this.getSourceCache(t,s);return d&&d.getSource()}getLayerSource(t){const s=this.getLayerSourceCache(t);return s&&s.getSource()}getSourceCache(t,s){const d=a.C(t,s);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){const s=a.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[t]&&s.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&s.push(this._mergedSymbolSourceCaches[t]),s}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const s in t){const d=t[s];d==="reload"?this.reloadSource(s):d==="clear"&&this.clearSource(s)}}updateLayers(t){const s=this._changes.getUpdatedPaintProperties();for(const d of s){const _=this.getLayer(d);_&&_.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,s,d){this.imageManager.getImages(s.images,s.scope,d),this._updateTilesForChangedImages();const _=S=>{if(S){const E=s.images.map((C=>a.I.toString(C)));S.setDependencies(s.tileID.key,s.type,E)}},v=a.C(s.source,s.scope);_(this._mergedOtherSourceCaches[v]),_(this._mergedSymbolSourceCaches[v]),s.images.some((S=>S.iconsetId))&&this.fire(new a.A("data",{dataType:"style"}))}rasterizeImages(t,s,d){this.imageManager.rasterizeImages(s,d)}getGlyphs(t,s,d){this.glyphManager.getGlyphs(s.stacks,d)}getResource(t,s,d){return a.dt(s,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){const s=this.getOwnSourceCaches(t);return s.length===0?(this.fire(new a.z(new Error(`There is no source with ID '${t}'`))),!1):s.every((d=>d.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,s){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const d=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),_=t.type==="building";if(t.is3D(!!this.terrain)){if(d||_||s&&s.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ra.getSourceType=function(f){return Jf[f]},ra.setSourceType=function(f,t){Jf[f]=t},ra.registerForPluginStateChange=a.du;var Jh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,ul=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,_u=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ld="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ac=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Ho=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,rh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,$t=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,nh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Qh=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,ef=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const ih=[];os(Jh,ih),os(_u,ih),os(ul,ih);const yu={"_prelude_fog.vertex.glsl":Ho,"_prelude_terrain.vertex.glsl":ac,"_prelude_shadow.vertex.glsl":Qh,"_prelude_fog.fragment.glsl":rh,"_prelude_shadow.fragment.glsl":ef,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":$t,"_prelude_raster_particle.glsl":nh},is={};gn("",ac),gn(rh,Ho),gn(ef,Qh),gn($t,""),gn(nh,"");const tf=gn(ul,_u),Ia=Jh;var sc={background:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:gn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:gn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:gn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:gn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:gn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:gn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:gn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:gn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:gn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:gn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:gn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:gn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:gn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:gn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:gn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:gn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:gn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:gn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:gn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ld),skyboxGradient:gn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ld),skyboxCapture:gn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:gn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:gn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:gn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:gn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:gn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:gn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:gn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:gn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function os(f,t){const s=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of s)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=d.split(" ");for(const v of _)t.includes(v)||t.push(v)}}function gn(f,t){const s=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let _=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map((k=>{const L=k.split(" ");return L[L.length-1]})),_=[...new Set(_)]);const v={},S=[],E=[];if(f=f.replace(s,((k,L)=>(E.push(L),""))),(t=t.replace(s,((k,L)=>(S.push(L),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...ih];os(f,C),os(t,C);for(const k of[...S,...E])yu[k]||console.error(`Undefined include: ${k}`),is[k]||(is[k]=[],os(yu[k],is[k])),C=[...C,...is[k]];return{fragmentSource:f=f.replace(d,((k,L,j,B,q)=>(v[q]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${j} ${B} ${q};
#else
uniform ${j} ${B} u_${q};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${q}
    ${j} ${B} ${q} = u_${q};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${j} ${B} ${q};
#endif
`:L==="initialize-attribute"?"":void 0))),vertexSource:t=t.replace(d,((k,L,j,B,q)=>{const K=B==="float"?"vec2":B,Z=q.match(/color/)?"color":K;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${q}
in ${j} ${B} a_${q};
#endif
`:v[q]?L==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${j} ${K} a_${q};
out ${j} ${B} ${q};
#else
uniform ${j} ${B} u_${q};
#endif
`:L==="initialize"?Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${j} ${B} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${Z}(a_${q}, u_${q}_t);
#else
    ${j} ${B} ${q} = u_${q};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    in ${j} ${B} a_${q};
    out ${j} ${B} ${q};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${q} = a_${q};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${j} ${K} a_${q};
#else
uniform ${j} ${B} u_${q};
#endif
`:L==="define-instanced"?Z==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${q}0;
in vec4 a_${q}1;
in vec4 a_${q}2;
in vec4 a_${q}3;
#else
uniform ${j} ${B} u_${q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${j} ${K} a_${q};
#else
uniform ${j} ${B} u_${q};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${q}
    ${j} ${B} ${q} = a_${q};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${j} ${B} ${q} = a_${q};
#else
    ${j} ${B} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${j} ${B} ${q} = unpack_mix_${Z}(a_${q}, u_${q}_t);
#else
    ${j} ${B} ${q} = u_${q};
#endif
`})),staticAttributes:_,usedDefines:C,vertexIncludes:S,fragmentIncludes:E}}class e_{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,s,d,_,v,S,E,C){this.context=t;let k=this.boundPaintVertexBuffers.length!==_.length;for(let j=0;!k&&j<_.length;j++)this.boundPaintVertexBuffers[j]!==_[j]&&(k=!0);let L=this.boundDynamicVertexBuffers.length!==E.length;for(let j=0;!L&&j<E.length;j++)this.boundDynamicVertexBuffers[j]!==E[j]&&(L=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==d||k||L||this.boundIndexBuffer!==v||this.boundVertexOffset!==S)this.freshBind(s,d,_,v,S,E,C);else{t.bindVertexArrayOES.set(this.vao);for(const j of E)j&&(j.bind(),C&&j.instanceCount&&j.setVertexAttribDivisor(t.gl,s,C));v&&v.dynamicDraw&&v.bind()}}freshBind(t,s,d,_,v,S,E){const C=t.numAttributes,k=this.context,L=k.gl;this.vao&&this.destroy(),this.vao=k.gl.createVertexArray(),k.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=S,s.enableAttributes(L,t),s.bind(),s.setVertexAttribPointers(L,t,v);for(const j of d)j.enableAttributes(L,t),j.bind(),j.setVertexAttribPointers(L,t,v);for(const j of S)j&&(j.enableAttributes(L,t),j.bind(),j.setVertexAttribPointers(L,t,v),E&&j.instanceCount&&j.setVertexAttribDivisor(L,t,E));_&&_.bind(),k.currentNumAttributes=C}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function lc(f,t){const s=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new a.ac(0,d/s).toLngLat().lat,new a.ac(0,(d+1)/s).toLngLat().lat]}function t_(f,t,s,d,_,v,S){const E=f.context,C=E.gl,k=s.hillshadeFBO;if(!k)return;f.prepareDrawTile();const L=f.isTileAffectedByFog(t),j=f.getOrCreateProgram("hillshade",{overrideFog:L});E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get());const B=((J,Y,se,ce)=>{const pe=se.paint.get("hillshade-shadow-color"),Se=se.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Pe=se.paint.get("hillshade-highlight-color"),Me=se.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Te=se.paint.get("hillshade-accent-color"),Ee=se.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ae=se.paint.get("hillshade-emissive-strength");let We=a.al(se.paint.get("hillshade-illumination-direction"));if(se.paint.get("hillshade-illumination-anchor")==="viewport")We-=J.transform.angle;else if(J.style&&J.style.enable3dLights()&&J.style.directionalLight){const ut=J.style.directionalLight.properties.get("direction"),Je=a.d1(ut.x,ut.y,ut.z);We=a.al(Je[1])}const Le=!J.options.moving;return{u_matrix:ce||J.transform.calculateProjMatrix(Y.tileID.toUnwrapped(),Le),u_image:0,u_latrange:lc(0,Y.tileID),u_light:[se.paint.get("hillshade-exaggeration"),We],u_shadow:pe.toPremultipliedRenderColor(Se?null:se.lut),u_highlight:Pe.toPremultipliedRenderColor(Me?null:se.lut),u_emissive_strength:Ae,u_accent:Te.toPremultipliedRenderColor(Ee?null:se.lut)}})(f,s,d,f.terrain?t.projMatrix:null);f.uploadCommonUniforms(E,j,t.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:K,tileBoundsSegments:Z}=f.getTileBoundsBuffers(s);j.draw(f,C.TRIANGLES,_,v,S,Sr.disabled,B,d.id,q,K,Z)}function ud(f,t,s){if(!t.needsDEMTextureUpload)return;const d=f.context,_=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||f.getTileTexture(s.stride);const v=s.getPixels();t.demTexture?t.demTexture.update(v,{premultiply:!1}):t.demTexture=new a.T(d,v,_.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function bp(f,t,s){const d=f.context,_=d.gl;if(!t.dem)return;const v=t.dem;if(d.activeTexture.set(_.TEXTURE1),ud(f,t,v),!t.demTexture)return;t.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const S=v.dim;d.activeTexture.set(_.TEXTURE0);let E=t.hillshadeFBO;if(!E){const B=new a.T(d,{width:S,height:S,data:null},_.RGBA8);B.bind(_.LINEAR,_.CLAMP_TO_EDGE),E=t.hillshadeFBO=d.createFramebuffer(S,S,!0,"renderbuffer"),E.colorAttachment.set(B.texture)}d.bindFramebuffer.set(E.framebuffer),d.viewport.set([0,0,S,S]);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:k,tileBoundsSegments:L}=f.getMercatorTileBoundsBuffers(),j=[];f.linearFloatFilteringSupported()&&j.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:j}).draw(f,_.TRIANGLES,Qt.disabled,Ar.disabled,Wr.unblended,Sr.disabled,((B,q)=>{const K=q.stride,Z=a.bz();return a.ca(Z,0,a.aj,-a.aj,0,0,1),a.bo(Z,Z,[0,-a.aj,0]),{u_matrix:Z,u_image:1,u_dimension:[K,K],u_zoom:B.overscaledZ}})(t.tileID,v),s.id,C,k,L),t.needsHillshadePrepare=!1}class un{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class wp extends un{getDefault(){return a.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class cd extends un{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class rf extends un{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Em extends un{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class hd extends un{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class nf extends un{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class uc extends un{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class oh extends un{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Sp extends un{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Tp extends un{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class fd extends un{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class dd extends un{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class cl extends un{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class kl extends un{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ah extends un{getDefault(){return a.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class sh extends un{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class vu extends un{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class pd extends un{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ep extends un{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Ap=class extends un{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class lh extends un{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class md extends un{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class uh extends un{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class hl extends un{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class of extends un{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class fl extends un{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Rs extends un{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ch extends un{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class dl extends un{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class xu extends un{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Am extends un{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Pp extends un{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class cc extends Pp{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class hh extends Pp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class bu extends Pp{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class fh extends hh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const af=(f,t,s)=>({u_matrix:f,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:s}),Dl=(f,t,s,d,_,v,S,E,C,k,L,j,B,q,K,Z)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:s,u_zoom_transition:_,u_merc_center:v,u_image0:0,u_frustum_tl:S,u_frustum_tr:E,u_frustum_br:C,u_frustum_bl:k,u_globe_pos:L,u_globe_radius:j,u_viewport:B,u_grid_matrix:Z?Float32Array.from(Z):new Float32Array(9),u_skirt_height:q,u_far_z_cutoff:K});function pl(f,t){return f!=null&&t!=null&&!(!f.hasData()||!t.hasData())&&f.demTexture!=null&&t.demTexture!=null&&f.tileID.key!==t.tileID.key}const Ii=new class{constructor(){this.operations={}}newMorphing(f,t,s,d,_){if(f in this.operations){const v=this.operations[f];v.to.tileID.key!==s.tileID.key&&(v.queued=s)}else this.operations[f]={startTime:d,phase:0,duration:_,from:t,to:s,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const t=this.operations[f];return{from:t.from,to:t.to,phase:t.phase}}update(f){for(const t in this.operations){const s=this.operations[t];for(s.phase=(f-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,f)){delete this.operations[t];break}}}_nextOp(f,t){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=t,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Vi={0:null,1:"TERRAIN_VERTEX_MORPHING"};function as(f,t,s){if(t===0)return 0;const d=t<1&&s===514?.25/t:1;return 6*Math.pow(1.5,22-f)*Math.max(t,1)*d}function Co(f,t){const s=1<<f.z;return!t&&(f.x===0||f.x===s-1)||f.y===0||f.y===s-1}const na=f=>({u_matrix:f});function wo(f,t,s,d,_){if(_>0){const v=a.q.now(),S=(v-f.timeAdded)/_,E=t?(v-t.timeAdded)/_:-1,C=s.getSource(),k=d.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-k)>Math.abs(f.tileID.overscaledZ-k),j=L&&f.refreshedUponExpiration?1:a.ay(L?S:1-E,0,1);return f.refreshedUponExpiration&&S>=1&&(f.refreshedUponExpiration=!1),t?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}class wu extends Go{constructor(t){const s=ru("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",s,!1),s.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class ia extends Go{constructor(t){const s=ru("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,d){if(t.freezeTileCoverage)return;this.transform=t;const _=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((v,S)=>{if(v[S.key]="",!this._tiles[S.key]){const E=new ou(S,this._source.tileSize*S.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);E.state="loaded",this._tiles[S.key]=E}return v}),{});for(const v in this._tiles)v in _||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const d=Object.values(s);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Su extends a.aM{constructor(t,s,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=d}}class sf extends a.dF{constructor(t,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,_,v]=(function(C){const k=new a.ba,L=new a.a_,j=131;k.reserve(17161),L.reserve(33800);const B=a.aj/128,q=a.aj+B/2,K=q+B;for(let J=-B;J<K;J+=B)for(let Y=-B;Y<K;Y+=B){const se=Y<0||Y>q||J<0||J>q?24575:0,ce=a.ay(Math.round(Y),0,a.aj),pe=a.ay(Math.round(J),0,a.aj);k.emplaceBack(ce+se,pe)}const Z=(J,Y)=>{const se=Y*j+J;L.emplaceBack(se+1,se,se+j),L.emplaceBack(se+j,se+j+1,se+1)};for(let J=1;J<129;J++)for(let Y=1;Y<129;Y++)Z(Y,J);return[0,129].forEach((J=>{for(let Y=0;Y<130;Y++)Z(Y,J),Z(J,Y)})),[k,L,32768]})(),S=t.context;this.gridBuffer=S.createVertexBuffer(d,a.bc.members),this.gridIndexBuffer=S.createIndexBuffer(_),this.gridSegments=a.bd.simpleSegment(0,0,d.length,_.length),this.gridNoSkirtSegments=a.bd.simpleSegment(0,0,d.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ia(s.map),this.orthoMatrix=a.bz(),a.ca(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.aj,0,a.aj,0,1);const E=S.gl;this._overlapStencilMode=new Ar({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new wu(s.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,s,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const _=t.terrain.properties,v=t.terrain.drapeRenderMode===0,S=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=a.q.now();const E=t.terrain&&t.terrain.scope,C=_.get("source"),k=v?this._mockSourceCache:t.getSourceCache(C,E);if(!k)return void a.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=k,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=S?this.calculateExaggeration(s):_.get("exaggeration"),!s.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&a.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(s,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),s.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const s=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;const _=s!=null?d-s:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const v=t.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(v);let E=v-this._previousZoom;const C=this._previousUpdateTimestamp;let k=v;this._evaluationZoom!=null&&(k=this._evaluationZoom,Math.abs(v-k)>.5&&(E=.5*(v-k+E)),E*_<0&&(k+=E)),this._evaluationZoom=k;const L=S.getExaggeration(k),j=L===S.getExaggeration(Math.max(0,k-.1));if(j&&Math.abs(L-this._exaggeration)<.01)return L;let B=Math.min(.1,.00375*(this._updateTimestamp-C));return(j||L<.1||Math.abs(E)<1e-4)&&(B=Math.min(.2,4*B)),a.ai(this._exaggeration,L,B)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(a.ac.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=s.getIds().map((C=>{const k=s.getTileByID(C).tileID;return k.projMatrix=d.calculateProjMatrix(k.toUnwrapped()),k}));(function(C,k){const L=k.transform.pointCoordinate(k.transform.getCameraPoint()),j=new a.P(L.x,L.y);C.sort(((B,q)=>{if(q.overscaledZ-B.overscaledZ)return q.overscaledZ-B.overscaledZ;const K=new a.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),Z=new a.P(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),J=j.mult(1<<B.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(K)-J.distSqr(Z)}))})(_,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},_.forEach((C=>{this.proxyToSource[C.key]={}})),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const C in S){const k=S[C];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,t[C],v),k.usedForTerrain))continue;const L=t[C];k.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[s.id]=_.map((C=>new Su(C,C.key,this.orthoMatrix))),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const E={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const k=this.terrainTileForTile[C.key];if(!k)continue;const L=k.tileID.key;L in E||(this._visibleDemTiles.push(k),E[L]=L)}}_assignTerrainTiles(t){this._initializing||t.forEach((s=>{if(this.terrainTileForTile[s.key])return;const d=this._findTileCoveringTileID(s,this.sourceCache);d&&(this.terrainTileForTile[s.key]=d)}))}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const d in this.terrainTileForTile){const _=this.terrainTileForTile[d],v=_.dem;!v||_.demTexture&&!_.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),ud(this.painter,_,v))}}_prepareDemTileUniforms(t,s,d,_){if(!s||s.demTexture==null)return!1;const v=t.tileID.canonical,S=Math.pow(2,s.tileID.canonical.z-v.z),E=_||"";return d[`u_dem_tl${E}`]=[v.x*S%1,v.y*S%1],d[`u_dem_scale${E}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const s=this._visibleDemTiles.reduce(((d,_)=>{if(!_.dem)return d;const v=_.dem.tree.minimums[0];return v>0&&t++,d+v}),0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const d=this._getLoadedAreaMinimum(),_=new a.dG({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(_,{premultiply:!1}):v=this._emptyDEMTexture=new a.T(t,_,s.R32F,{premultiply:!1}),v}setupElevationDraw(t,s,d){const _=this.painter.context,v=_.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let E=null,C=null,k=1;if(d&&d.morphing&&this._useVertexMorphing){const q=d.morphing.srcDemTile,K=d.morphing.dstDemTile;k=d.morphing.phase,q&&K&&(this._prepareDemTileUniforms(t,q,S,"_prev")&&(C=q),this._prepareDemTileUniforms(t,K,S)&&(E=K))}const L=q=>q&&q.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST;let j=null;var B;if(this.enabled?C&&E?(j=E.demTexture,_.activeTexture.set(v.TEXTURE4),C.demTexture.bind(L(C),v.CLAMP_TO_EDGE),S.u_dem_lerp=k):(E=this.terrainTileForTile[t.tileID.key],j=this._prepareDemTileUniforms(t,E,S)?E.demTexture:this.emptyDEMTexture):j=this.emptyDEMTexture,_.activeTexture.set(v.TEXTURE2),j&&(S.u_dem_size=(B=j).size[0]===1?1:B.size[0]-2,j.bind(L(E),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,s,S),d&&d.useMeterToDem&&E){const q=(1<<E.tileID.canonical.z)*a.cb(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=q}if(d&&d.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),s.setTerrainUniformValues(_,S),this.painter.transform.projection.name==="globe"){const q=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);s.setGlobeUniformValues(_,q)}}globeUniformValues(t,s,d){const _=t.projection;return{u_tile_tl_up:_.upVector(s,0,0),u_tile_tr_up:_.upVector(s,a.aj,0),u_tile_br_up:_.upVector(s,a.aj,a.aj),u_tile_bl_up:_.upVector(s,0,a.aj),u_tile_up_scale:d?a.dH(1):_.upVectorScale(s,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const s=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(_,v,S,E,C){if(_.transform.projection.name==="globe")(function(k,L,j,B,q){const K=k.context,Z=K.gl;let J,Y;const se=k.transform,ce=a.dy(k,K,se),pe=(ut,Je)=>{if(Y===Je)return;const dt=[Vi[Je],"PROJECTION_GLOBE_VIEW"];ce&&dt.push("CUSTOM_ANTIALIASING");const wt=k.isTileAffectedByFog(ut);J=k.getOrCreateProgram("globeRaster",{defines:dt,overrideFog:wt}),Y=Je},Se=k.colorModeForRenderPass(),Pe=new Qt(Z.LEQUAL,Qt.ReadWrite,k.depthRangeFor3D);Ii.update(q);const Me=a.dz(se),Te=[a.aD(se.center.lng),a.aH(se.center.lat)],Ee=k.globeSharedBuffers,Ae=[se.width*a.q.devicePixelRatio,se.height*a.q.devicePixelRatio],We=Float32Array.from(se.globeMatrix),Le={useDenormalizedUpVectorScale:!0};{const ut=k.transform,Je=as(ut.zoom,L.exaggeration(),L.sourceCache._source.tileSize);Y=-1;const dt=Z.TRIANGLES;for(const wt of B){const qe=j.getTile(wt),Re=Ar.disabled,tt=L.prevTerrainTileForTile[wt.key],Ye=L.terrainTileForTile[wt.key];pl(tt,Ye)&&Ii.newMorphing(wt.key,tt,Ye,q,250),K.activeTexture.set(Z.TEXTURE0),qe.texture&&qe.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const vt=Ii.getMorphValuesForProxy(wt.key),bt=vt?1:0;vt&&a.L(Le,{morphing:{srcDemTile:vt.from,dstDemTile:vt.to,phase:a.dx(vt.phase)}});const It=a.dA(wt.canonical),Dt=a.dB(It.getCenter().lat),lr=a.dC(wt.canonical,It,Dt,ut.worldSize/ut._pixelsPerMercatorPixel),pr=a.bh(a.dD(wt.canonical)),Yt=Dl(ut.expandedFarZProjMatrix,We,Me,pr,a.ah(ut.zoom),Te,ut.frustumCorners.TL,ut.frustumCorners.TR,ut.frustumCorners.BR,ut.frustumCorners.BL,ut.globeCenterInViewSpace,ut.globeRadius,Ae,Je,ut._farZ,lr);if(pe(wt,bt),J&&(L.setupElevationDraw(qe,J,Le),k.uploadCommonUniforms(K,J,wt.toUnwrapped()),Ee)){const[dr,ur,kr]=Ee.getGridBuffers(Dt,Je!==0);J.draw(k,dt,Pe,Re,Se,Sr.backCCW,Yt,"globe_raster",dr,ur,kr)}}}if(Ee&&(k.renderDefaultNorthPole||k.renderDefaultSouthPole)){const ut=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ce&&ut.push("CUSTOM_ANTIALIASING"),J=k.getOrCreateProgram("globeRaster",{defines:ut});for(const Je of B){const{x:dt,y:wt,z:qe}=Je.canonical,Re=wt===0,tt=wt===(1<<qe)-1,[Ye,vt,bt,It]=Ee.getPoleBuffers(qe,!1);if(It&&(Re||tt)){const Dt=j.getTile(Je);K.activeTexture.set(Z.TEXTURE0),Dt.texture&&Dt.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let lr=a.dE(qe,dt,se);const pr=a.bh(a.dD(Je.canonical)),Yt=(dr,ur)=>dr.draw(k,Z.TRIANGLES,Pe,Ar.disabled,Se,Sr.disabled,Dl(se.expandedFarZProjMatrix,lr,lr,pr,0,Te,se.frustumCorners.TL,se.frustumCorners.TR,se.frustumCorners.BR,se.frustumCorners.BL,se.globeCenterInViewSpace,se.globeRadius,Ae,0,se._farZ),"globe_pole_raster",ur,bt,It);L.setupElevationDraw(Dt,J,Le),k.uploadCommonUniforms(K,J,Je.toUnwrapped()),Re&&k.renderDefaultNorthPole&&Yt(J,Ye),tt&&k.renderDefaultSouthPole&&(lr=a.cP(a.bz(),lr,[1,-1,1]),Yt(J,vt))}}}})(_,v,S,E,C);else{const k=_.context,L=k.gl;let j,B;const q=_.shadowRenderer,K=Va(_,_.longestCutoffRange),Z=Se=>{if(B===Se)return;const Pe=[];Pe.push(Vi[Se]),K.shouldRenderCutoff&&Pe.push("RENDER_CUTOFF"),q&&(Pe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&Pe.push("NORMAL_OFFSET")),j=_.getOrCreateProgram("terrainRaster",{defines:Pe}),B=Se},J=_.colorModeForRenderPass(),Y=new Qt(L.LEQUAL,Qt.ReadWrite,_.depthRangeFor3D);Ii.update(C);const se=_.transform,ce=as(se.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let pe=[0,0,0];if(q){const Se=_.style.directionalLight,Pe=_.style.ambientLight;Se&&Pe&&(pe=Ol(_.style,Se,Pe))}{B=-1;const Se=L.TRIANGLES,[Pe,Me]=[v.gridIndexBuffer,v.gridSegments];for(const Te of E){const Ee=S.getTile(Te),Ae=Ar.disabled,We=v.prevTerrainTileForTile[Te.key],Le=v.terrainTileForTile[Te.key];pl(We,Le)&&Ii.newMorphing(Te.key,We,Le,C,250),k.activeTexture.set(L.TEXTURE0),Ee.texture&&Ee.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const ut=Ii.getMorphValuesForProxy(Te.key),Je=ut?1:0;let dt;ut&&(dt={morphing:{srcDemTile:ut.from,dstDemTile:ut.to,phase:a.dx(ut.phase)}});const wt=af(Te.projMatrix,Co(Te.canonical,se.renderWorldCopies)?ce/10:ce,pe);if(Z(Je),!j)continue;v.setupElevationDraw(Ee,j,dt);const qe=Te.toUnwrapped();q&&q.setupShadows(qe,j),_.uploadCommonUniforms(k,j,qe,null,K),j.draw(_,Se,Y,Ae,J,Sr.backCCW,wt,"terrain_raster",v.gridBuffer,Pe,Me)}}}})(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,d=this.painter.context,_=this.proxySourceCache,v=this.proxiedCoords[_.id],S=this._drapedRenderBatches.shift(),E=s.style.order,C=[];let k=0;for(const L of v){const j=_.getTileByID(L.proxyTileKey),B=_.proxyCachedFBO[L.key]?_.proxyCachedFBO[L.key][t]:void 0,q=B!==void 0?_.renderCache[B]:this.pool[k++],K=B!==void 0;if(j.texture=q.tex,K&&!q.dirty){C.push(j.tileID);continue}let Z;d.bindFramebuffer.set(q.fb.framebuffer),this.renderedToTile=!1,q.dirty&&(d.clear({color:a.am.transparent,stencil:0}),q.dirty=!1);for(let J=S.start;J<=S.end;++J){const Y=s.style._mergedLayers[E[J]];if(Y.isHidden(s.transform.zoom))continue;const se=s.style.getLayerSourceCache(Y),ce=se?this.proxyToSource[L.key][se.id]:[L];if(!ce)continue;const pe=ce;d.viewport.set([0,0,q.fb.width,q.fb.height]),Z!==(se?se.id:null)&&(this._setupStencil(q,ce,Y,se),Z=se?se.id:null),s.renderLayer(s,se,Y,pe)}if(this._drapedRenderBatches.length===0)for(const J of this._pendingGroundEffectLayers){const Y=s.style._mergedLayers[E[J]];if(Y.isHidden(s.transform.zoom))continue;const se=s.style.getLayerSourceCache(Y),ce=se?this.proxyToSource[L.key][se.id]:[L];if(!ce)continue;const pe=ce;d.viewport.set([0,0,q.fb.width,q.fb.height]),Z!==(se?se.id:null)&&(this._setupStencil(q,ce,Y,se),Z=se?se.id:null),s.renderLayer(s,se,Y,pe)}this.renderedToTile?(q.dirty=!0,C.push(j.tileID)):K||--k,k===5&&(k=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,s.width,s.height]),S.end+1}postRender(){}isLayerOrderingCorrect(t){const s=t.order.length;let d=-1,_=s;for(let v=0;v<s;++v)this._style.isLayerDraped(t._mergedLayers[t.order[v]])?d=Math.max(d,v):_=Math.min(_,v);return _>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((s=>s.dem)).forEach((s=>{t=Math.min(t,s.dem.tree.minimums[0])})),t===0?t:(t-30)*this._exaggeration}raycast(t,s,d){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter((v=>v.dem)).map((v=>{const S=v.tileID,E=1<<S.overscaledZ,{x:C,y:k}=S.canonical,L=C/E,j=(C+1)/E,B=k/E,q=(k+1)/E;return{minx:L,miny:B,maxx:j,maxy:q,t:v.dem.tree.raycastRoot(L,B,j,q,t,s,d),tile:v}}));_.sort(((v,S)=>(v.t!==null?v.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE)));for(const v of _){if(v.t==null)return null;const S=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,t,s,d);if(S!=null)return S}return null}_createFBO(){const t=this.painter.context,s=t.gl,d=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const _=new a.T(t,{width:d[0],height:d[1],data:null},s.RGBA8);_.bind(s.LINEAR,s.CLAMP_TO_EDGE);const v=t.createFramebuffer(d[0],d[1],!0,null);return v.colorAttachment.set(_.texture),v.depthAttachment=new fh(t,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:v,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const s=this._style._mergedLayers[t],d=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!d&&s.shouldRedrape():!d&&s.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const d of this._style.getSources())if(d instanceof Ta){t=!0;break}if(!t)return;const s={};for(let d=0;d<this._style.order.length;++d){const _=this._style._mergedLayers[this._style.order[d]],v=this._style.getLayerSourceCache(_);if(v&&!s[v.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof a.ab){s[v.id]=!0;for(const S of this.proxyCoords){const E=this.proxyToSource[S.key][v.id];if(E)for(const C of E)this._clearRenderCacheForTile(v.id,C)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof Bo){t=!0;break}if(!t)return;const s={};for(let d=0;d<this._style.order.length;++d){const _=this._style._mergedLayers[this._style.order[d]],v=this._style.getLayerSourceCache(_);if(!v||s[v.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const S=_.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const C=this.proxyToSource[E.key][v.id];if(C)for(const k of C){const L=wo(v.getTile(k),v.findLoadedParent(k,0),v,this.painter.transform,S);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(v.id,k)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,s=t.length;if(s===0)return;const d=[];this._pendingGroundEffectLayers=[];let _,v=0,S=this._style._mergedLayers[t[v]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++v<s;)S=this._style._mergedLayers[t[v]];for(;v<s;++v){const E=this._style._mergedLayers[t[v]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?_===void 0&&(_=v):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),_!==void 0&&(d.push({start:_,end:v-1}),_=void 0)))}if(_!==void 0&&d.push({start:_,end:v-1}),d.length!==0){const E=d[d.length-1];this._pendingGroundEffectLayers.every((C=>C>E.end))||a.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const S=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let E=0;E<S.length;++E){const C=Object.values(S[E]);s.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,_=this._tilesDirty;for(let S=d.length-1;S>=0;S--){const E=d[S];if(s.getTileByID(E.key),s.proxyCachedFBO[E.key]!==void 0){const C=t[E.key],k=this.proxyToSource[E.key];let L=0;for(const j in k){const B=k[j],q=C[j];if(!q||q.length!==B.length||B.some(((K,Z)=>K!==q[Z]||_[j]&&_[j].hasOwnProperty(K.key)))){L=-1;break}++L}for(const j in s.proxyCachedFBO[E.key])s.renderCache[s.proxyCachedFBO[E.key][j]].dirty=L<0||L!==Object.values(C).length}}const v=[...this._drapedRenderBatches];v.sort(((S,E)=>E.end-E.start-(S.end-S.start)));for(const S of v)for(const E of d){if(s.proxyCachedFBO[E.key])continue;let C=s.renderCachePool.pop();C===void 0&&s.renderCache.length<50&&(C=s.renderCache.length,s.renderCache.push(this._createFBO())),C!==void 0&&(s.proxyCachedFBO[E.key]={},s.proxyCachedFBO[E.key][S.start]=C,s.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,d,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,S=v.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let E;if(d.isTileClipped())E=s.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Ar.disabled}_renderTileClippingMasks(t,s){const d=this.painter,_=this.painter.context,v=_.gl;d._tileClippingMaskIDs={},_.setColorMode(Wr.disabled),_.setDepthMode(Qt.disabled);const S=d.getOrCreateProgram("clippingMask");for(const E of t){const C=d._tileClippingMaskIDs[E.key]=--s;S.draw(d,v.TRIANGLES,Qt.disabled,new Ar({func:v.ALWAYS,mask:0},C,255,v.KEEP,v.KEEP,v.REPLACE),Wr.disabled,Sr.disabled,na(E.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const d=[t.x,t.y,1,1];a.aA(d,d,s.pixelMatrixInverse),a.cH(d,d,1/d[3]),d[0]/=s.worldSize,d[1]/=s.worldSize;const _=s._camera.position,v=a.cb(1,s.center.lat),S=[_[0],_[1],_[2]/v,0],E=a.d7([],d.slice(0,3),S);a.au(E,E);const C=this.raycast(S,E,this._exaggeration);return C!==null&&C?(a.bE(S,S,E,C),S[3]=S[2],S[2]*=v,S):null}_setupProxiedCoordsForOrtho(t,s,d){if(t.getSource()instanceof a.aP)return this._setupProxiedCoordsForImageSource(t,s,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const _=this.proxiedCoords[t.id]=[],v=this.proxyCoords;for(let C=0;C<v.length;C++){const k=v[C],L=this._findTileCoveringTileID(k,t);if(L){const j=this._createProxiedId(k,L,d[k.key]&&d[k.key][t.id]);_.push(j),this.proxyToSource[k.key][t.id]=[j]}}let S=!1;const E=new Set;for(let C=0;C<s.length;C++){const k=t.getTile(s[C]);if(!k||!k.hasData())continue;const L=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==k.tileID.canonical.z){const j=this.proxyToSource[L.tileID.key][t.id],B=this._createProxiedId(L.tileID,k,d[L.tileID.key]&&d[L.tileID.key][t.id]);j?j.splice(j.length-1,0,B):this.proxyToSource[L.tileID.key][t.id]=[B];const q=this.proxyToSource[L.tileID.key][t.id];E.has(q)||E.add(q),_.push(B),S=!0}}if(this._sourceTilesOverlap[t.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const C of E)C.sort(((k,L)=>L.overscaledZ-k.overscaledZ))}_setupProxiedCoordsForImageSource(t,s,d){if(!t.getSource().loaded())return;const _=this.proxiedCoords[t.id]=[],v=this.proxyCoords,S=t.getSource(),E=S.tileID;if(!E)return;const C=new a.P(E.x,E.y)._div(1<<E.z),k=S.coordinates.map(a.ac.fromLngLat).reduce(((j,B)=>(j.min.x=Math.min(j.min.x,B.x-C.x),j.min.y=Math.min(j.min.y,B.y-C.y),j.max.x=Math.max(j.max.x,B.x-C.x),j.max.y=Math.max(j.max.y,B.y-C.y),j)),{min:new a.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(j,B)=>{const q=j.wrap+j.canonical.x/(1<<j.canonical.z),K=j.canonical.y/(1<<j.canonical.z),Z=a.aj/(1<<j.canonical.z),J=B.wrap+B.canonical.x/(1<<B.canonical.z),Y=B.canonical.y/(1<<B.canonical.z);return q+Z<J+k.min.x||q>J+k.max.x||K+Z<Y+k.min.y||K>Y+k.max.y};for(let j=0;j<v.length;j++){const B=v[j];for(let q=0;q<s.length;q++){const K=t.getTile(s[q]);if(!K||!K.hasData()||L(B,K.tileID))continue;const Z=this._createProxiedId(B,K,d[B.key]&&d[B.key][t.id]),J=this.proxyToSource[B.key][t.id];J?J.push(Z):this.proxyToSource[B.key][t.id]=[Z],_.push(Z)}}}_createProxiedId(t,s,d){let _=this.orthoMatrix;if(d){const v=d.find((S=>S.key===s.tileID.key));if(v)return v}if(s.tileID.key!==t.key){const v=t.canonical.z-s.tileID.canonical.z;let S,E,C;_=a.bz();const k=s.tileID.wrap-t.wrap<<t.overscaledZ;v>0?(S=a.aj>>v,E=S*((s.tileID.canonical.x<<v)-t.canonical.x+k),C=S*((s.tileID.canonical.y<<v)-t.canonical.y)):(S=a.aj<<-v,E=a.aj*(s.tileID.canonical.x-(t.canonical.x+k<<-v)),C=a.aj*(s.tileID.canonical.y-(t.canonical.y<<-v))),a.ca(_,0,S,0,S,0,1),a.bo(_,_,[E,C,0])}return new Su(s.tileID,t.key,_)}_findTileCoveringTileID(t,s){let d=s.getTile(t);if(d&&d.hasData())return d;const _=this._findCoveringTileCache[s.id],v=_[t.key];if(d=v?s.getTileByID(v):null,d&&d.hasData()||v===null)return d;let S=d?d.tileID:t,E=S.overscaledZ;const C=s.getSource().minzoom,k=[];if(!v){const j=s.getSource().maxzoom;if(t.canonical.z>=j){const B=t.canonical.z-j;s.getSource().reparseOverscaled?(E=Math.max(t.canonical.z+2,s.transform.tileZoom),S=new a.aM(E,t.wrap,j,t.canonical.x>>B,t.canonical.y>>B)):B!==0&&(E=j,S=new a.aM(E,t.wrap,j,t.canonical.x>>B,t.canonical.y>>B))}S.key!==t.key&&(k.push(S.key),d=s.getTile(S))}const L=j=>{k.forEach((B=>{_[B]=j})),k.length=0};for(E-=1;E>=C&&(!d||!d.hasData());E--){d&&L(d.tileID.key);const j=S.calculateScaledKey(E);if(d=s.getTileByID(j),d&&d.hasData())break;const B=_[j];if(B===null)break;B===void 0?k.push(j):d=s.getTileByID(B)}return L(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[s.key]=!0}}function gd(f,t,s){const d=(function(E,C,k){const L=a.bG(C,E),j=a.bG(k,[.2126,.7152,.0722]),B=(K,Z,J)=>(1-J)*K+J*Z,q=B(1-.3*Math.min(j,1),1,Math.min(L+1,1));return B(.92,1,Math.asin(a.ay(C[2],-1,1))/Math.PI+.5)*q})(f,[0,0,1],t),_=[0,0,0];a.c1(_,s.slice(0,3),d);const v=[0,0,0];a.c1(v,t.slice(0,3),f[2]);const S=[0,0,0];return a.d5(S,_,v),a.d8(S)}const dh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],lf=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class ys{static cacheKey(t,s,d,_){let v=`${s}${_?_.cacheKey:""}`;for(const S of d)t.usedDefines.includes(S)&&(v+=`/${S}`);return v}constructor(t,s,d,_,v,S){const E=t.gl;this.program=E.createProgram(),this.configuration=_,this.name=s,this.fixedDefines=[...S];const C=_?_.getBinderAttributes():[],k=(d.staticAttributes||[]).concat(C);let L=_?_.defines():[];L=L.concat(S.map((J=>`#define ${J}`)));const j=`#version 300 es
`;let B=j+L.concat("precision mediump float;",Ia,tf.fragmentSource).join(`
`);for(const J of d.fragmentIncludes)B+=`
${yu[J]}`;B+=`
${d.fragmentSource}`;let q=j+L.concat("precision highp float;",Ia,tf.vertexSource).join(`
`);for(const J of d.vertexIncludes)q+=`
${yu[J]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&d.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(q+=`
uniform int u_instanceID;
`),q+=`
${d.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(q=q.replaceAll("gl_InstanceID","u_instanceID"));const K=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(K,B),E.compileShader(K),E.attachShader(this.program,K);const Z=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(Z,q),E.compileShader(Z),E.attachShader(this.program,Z),this.attributes={},this.numAttributes=k.length;for(let J=0;J<this.numAttributes;J++)if(k[J]){const Y=k[J].startsWith("a_")?k[J]:`a_${k[J]}`;E.bindAttribLocation(this.program,J,Y),this.attributes[Y]=J}E.linkProgram(this.program),E.deleteShader(Z),E.deleteShader(K),this.fixedUniforms=v(t),this.binderUniforms=_?_.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(J=>({u_instanceID:new a.cd(J)}))(t)),(S.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(J=>({u_dem:new a.cd(J),u_dem_prev:new a.cd(J),u_dem_tl:new a.cg(J),u_dem_scale:new a.cf(J),u_dem_tl_prev:new a.cg(J),u_dem_scale_prev:new a.cf(J),u_dem_size:new a.cf(J),u_dem_lerp:new a.cf(J),u_exaggeration:new a.cf(J),u_depth:new a.cd(J),u_depth_size_inv:new a.cg(J),u_depth_range_unpack:new a.cg(J),u_occluder_half_size:new a.cf(J),u_occlusion_depth_offset:new a.cf(J),u_meter_to_dem:new a.cf(J),u_label_plane_matrix_inv:new a.ch(J)}))(t)),S.includes("GLOBE")&&(this.globeUniforms=(J=>({u_tile_tl_up:new a.ce(J),u_tile_tr_up:new a.ce(J),u_tile_br_up:new a.ce(J),u_tile_bl_up:new a.ce(J),u_tile_up_scale:new a.cf(J)}))(t)),S.includes("FOG")&&(this.fogUniforms=(J=>({u_fog_matrix:new a.ch(J),u_fog_range:new a.cg(J),u_fog_color:new a.d0(J),u_fog_horizon_blend:new a.cf(J),u_fog_vertical_limit:new a.cg(J),u_fog_temporal_offset:new a.cf(J),u_frustum_tl:new a.ce(J),u_frustum_tr:new a.ce(J),u_frustum_br:new a.ce(J),u_frustum_bl:new a.ce(J),u_globe_pos:new a.ce(J),u_globe_radius:new a.cf(J),u_globe_transition:new a.cf(J),u_is_globe:new a.cd(J),u_viewport:new a.cg(J)}))(t)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(J=>({u_cutoff_params:new a.d0(J)}))(t)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(J=>({u_lighting_ambient_color:new a.ce(J),u_lighting_directional_dir:new a.ce(J),u_lighting_directional_color:new a.ce(J),u_ground_radiance:new a.ce(J)}))(t)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(J=>({u_light_matrix_0:new a.ch(J),u_light_matrix_1:new a.ch(J),u_fade_range:new a.cg(J),u_shadow_normal_offset:new a.ce(J),u_shadow_intensity:new a.cf(J),u_shadow_texel_size:new a.cf(J),u_shadow_map_resolution:new a.cf(J),u_shadow_direction:new a.ce(J),u_shadow_bias:new a.ce(J),u_shadowmap_0:new a.cd(J),u_shadowmap_1:new a.cd(J)}))(t))}}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)d[_]&&d[_].set(this.program,_,s[_])}}setGlobeUniformValues(t,s){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)d[_]&&d[_].set(this.program,_,s[_])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)d[_].set(this.program,_,s[_])}}setCutoffUniformValues(t,s){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)d[_].set(this.program,_,s[_])}}setLightsUniformValues(t,s){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in s)d[_].set(this.program,_,s[_])}}setShadowUniformValues(t,s){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;t.program.set(this.program);for(const _ in s)d[_].set(this.program,_,s[_])}_drawDebugWireframe(t,s,d,_,v,S,E,C,k,L){const j=t.options.wireframe;if(j.terrain===!1&&j.layers2D===!1&&j.layers3D===!1)return;const B=t.context;if(!(!(!j.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!j.layers2D||t._terrain&&t._terrain.renderingToTexture||!dh.includes(this.name))||!(!j.layers3D||!lf.includes(this.name))))return;const q=B.gl,K=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,v,B);if(!K)return;const Z=[...this.fixedDefines];Z.push("DEBUG_WIREFRAME");const J=t.getOrCreateProgram(this.name,{config:this.configuration,defines:Z});B.program.set(J.program);const Y=(pe,Se,Pe)=>{if(Se[pe]&&Pe[pe])for(const Me in Se[pe])Pe[pe][Me]&&Pe[pe][Me].set(Pe.program,Me,Se[pe][Me].current)};k&&k.setUniforms(J.program,B,J.binderUniforms,E,{zoom:C}),Y("fixedUniforms",this,J),Y("terrainUniforms",this,J),Y("globeUniforms",this,J),Y("fogUniforms",this,J),Y("lightsUniforms",this,J),Y("shadowUniforms",this,J),K.bind(),B.setColorMode(new Wr([q.ONE,q.ONE_MINUS_SRC_ALPHA,q.ZERO,q.ONE],a.am.transparent,[!0,!0,!0,!1])),B.setDepthMode(new Qt(s.func===q.LESS?q.LEQUAL:s.func,Qt.ReadOnly,s.range)),B.setStencilMode(Ar.disabled);const se=3*S.primitiveLength*2,ce=3*S.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const pe=L||1;for(let Se=0;Se<pe;++Se)J.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Se),q.drawElements(q.LINES,se,q.UNSIGNED_SHORT,ce)}else L&&L>1?q.drawElementsInstanced(q.LINES,se,q.UNSIGNED_SHORT,ce,L):q.drawElements(q.LINES,se,q.UNSIGNED_SHORT,ce);v.bind(),B.program.set(this.program),B.setDepthMode(s),B.setStencilMode(d),B.setColorMode(_)}checkUniforms(t,s,d){if(this.fixedDefines.includes(s)){for(const _ of Object.keys(d))if(!d[_].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${_} not set but required by ${s} being defined`)}}draw(t,s,d,_,v,S,E,C,k,L,j,B,q,K,Z,J){const Y=t.context,se=Y.gl;if(this.failedToCreate)return;Y.program.set(this.program),Y.setDepthMode(d),Y.setStencilMode(_),Y.setColorMode(v),Y.setCullFace(S);for(const Se of Object.keys(this.fixedUniforms))this.fixedUniforms[Se].set(this.program,Se,E[Se]);K&&K.setUniforms(this.program,Y,this.binderUniforms,B,{zoom:q});const ce={[se.POINTS]:1,[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[s];this.checkUniforms(C,"RENDER_SHADOWS",this.shadowUniforms);const pe=J&&J>0?1:void 0;for(const Se of j.get()){const Pe=Se.vaos||(Se.vaos={});if((Pe[C]||(Pe[C]=new e_)).bind(Y,this,k,K?K.getPaintVertexBuffers():[],L,Se.vertexOffset,Z||[],pe),this.forceManualRenderingForInstanceIDShaders){const Me=J||1;for(let Te=0;Te<Me;++Te)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Te),L?se.drawElements(s,Se.primitiveLength*ce,se.UNSIGNED_SHORT,Se.primitiveOffset*ce*2):se.drawArrays(s,Se.vertexOffset,Se.vertexLength)}else J&&J>1?se.drawElementsInstanced(s,Se.primitiveLength*ce,se.UNSIGNED_SHORT,Se.primitiveOffset*ce*2,J):L?se.drawElements(s,Se.primitiveLength*ce,se.UNSIGNED_SHORT,Se.primitiveOffset*ce*2):se.drawArrays(s,Se.vertexOffset,Se.vertexLength);s===se.TRIANGLES&&L&&this._drawDebugWireframe(t,d,_,v,L,Se,B,q,K,J)}}}function hc(f,t,s=0){const d=Math.pow(2,t.tileID.overscaledZ),_=t.tileSize*Math.pow(2,f.transform.tileZoom)/d,v=_*(t.tileID.canonical.x+t.tileID.wrap*d),S=_*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/a.aw(t,1,f.transform.tileZoom),u_pixel_coord_upper:[v>>16,S>>16],u_pixel_coord_lower:[65535&v,65535&S],u_pattern_transition:s}}const zl={terrain:0,flat:1},_d=a.bz(),Ip=(f,t,s,d,_,v,S,E,C,k,L,j,B,q,K,Z,J,Y)=>{const se=t.style.light,ce=se.properties.get("position"),pe=[ce.x,ce.y,ce.z],Se=a.dJ();se.properties.get("anchor")==="viewport"&&(a.dK(Se,-t.transform.angle),a.dL(pe,pe,Se));const Pe=se.properties.get("color").toPremultipliedRenderColor(null),Me=t.transform,Te={u_matrix:f,u_lightpos:pe,u_lightintensity:se.properties.get("intensity"),u_lightcolor:[Pe.r,Pe.g,Pe.b],u_vertical_gradient:+s,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:_d,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:zl[k],u_base_type:zl[L],u_ao:_,u_edge_radius:v,u_width_scale:S,u_flood_light_color:K,u_vertical_scale:Z,u_flood_light_intensity:J,u_ground_shadow_factor:Y};return Me.projection.name==="globe"&&(Te.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],Te.u_zoom_transition=j,Te.u_inv_rot_matrix=q,Te.u_merc_center=B,Te.u_up_dir=Me.projection.upVector(new a.cA(0,0,0),B[0]*a.aj,B[1]*a.aj),Te.u_height_lift=C),Te},Ll=(f,t,s,d,_,v)=>({u_matrix:f,u_edge_radius:t,u_width_scale:s,u_vertical_scale:d,u_height_type:zl[_],u_base_type:zl[v]}),ks=(f,t,s,d,_,v,S,E,C,k,L,j,B,q,K,Z,J,Y)=>{const se=Ip(f,t,s,d,_,v,S,E,k,L,j,B,q,K,Z,J,1,[0,0,0]),ce={u_height_factor:-Math.pow(2,E.overscaledZ)/C.tileSize/8};return a.h(se,hc(t,C,Y),ce)},fc=(f,t,s)=>({u_matrix:f,u_emissive_strength:t,u_ground_shadow_factor:s}),uf=(f,t,s,d,_,v=0)=>a.h(fc(f,t,_),hc(s,d,v)),yd=(f,t,s,d)=>({u_matrix:f,u_world:s,u_emissive_strength:t,u_ground_shadow_factor:d}),vs=(f,t,s,d,_,v,S=0)=>a.h(uf(f,t,s,d,v,S),{u_world:_}),xs=(f,t)=>({u_matrix:f,u_ground_shadow_factor:t}),ml=(f,t,s,d,_)=>({u_matrix:f,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:s,u_height_scale:d,u_reset_depth:_}),Ds=(f,t)=>({u_matrix:f,u_normal_matrix:t,u_opacity:1}),zs=f=>({u_matrix:f}),Tu=f=>({u_matrix:f}),dc=(f,t,s,d,_,v,S,E)=>{const C=a.aj/v.tileSize;return{u_matrix:f,u_inv_rot_matrix:t,u_camera_to_center_distance:s.getCameraToCenterDistance(E),u_extrude_scale:[s.pixelsToGLUnits[0]/C,s.pixelsToGLUnits[1]/C],u_zoom_transition:d,u_tile_id:S,u_merc_center:_}},cf=(f,t,s=1)=>({u_matrix:f,u_color:t,u_overlay:0,u_overlay_scale:s}),vd=a.bz(),$a=(f,t,s,d,_,v,S)=>{const E=f.transform,C=E.projection.name==="globe",k=C?a.dM(E.zoom,t.canonical)*E._pixelsPerMercatorPixel:a.aw(s,1,v),L={u_matrix:t.projMatrix,u_extrude_scale:k,u_intensity:S,u_inv_rot_matrix:vd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){L.u_inv_rot_matrix=d,L.u_merc_center=_,L.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],L.u_zoom_transition=a.ah(E.zoom);const j=_[0]*a.aj,B=_[1]*a.aj;L.u_up_dir=E.projection.upVector(new a.cA(0,0,0),j,B)}return L};function fa(f,[t,s,d,_],[v,S]){if(v===S)return[0,0,0,0];const E=255*(f-1)/(f*(S-v));return[t*E,s*E,d*E,_*E]}function Ci(f,t,[s,d]){return s===d?0:.5/f+(t-s)*(f-1)/(f*(d-s))}const ss=(f,t,s,d,_,v,S,E,C,k,L,j,B,q,K,Z,J,Y,se,ce,pe)=>({u_matrix:f,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:d,u_grid_matrix:_,u_tl_parent:v,u_scale_parent:k,u_fade_t:L.mix,u_opacity:L.opacity*j.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:j.paint.get("raster-brightness-min"),u_brightness_high:j.paint.get("raster-brightness-max"),u_saturation_factor:a.dO(j.paint.get("raster-saturation")),u_contrast_factor:a.dN(j.paint.get("raster-contrast")),u_spin_weights:Fl(j.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:q,u_zoom_transition:S,u_merc_center:E,u_cutoff_params:C,u_colorization_mix:fa(a.dP,Z,Y),u_colorization_offset:Ci(a.dP,J,Y),u_color_ramp:K,u_texture_offset:[ce/(se+2*ce),se/(se+2*ce)],u_texture_res:[se+2*ce,se+2*ce],u_emissive_strength:pe});function Fl(f){f*=Math.PI/180;const t=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const Bl=.05,ph=(f,t,s,d,_,v,S,E,C,k,L,j)=>({u_matrix:f,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:d,u_grid_matrix:_,u_tl_parent:v,u_scale_parent:k,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:j,u_zoom_transition:S,u_merc_center:E,u_cutoff_params:C}),xd=(f,t,s,d,_,v,S,E,C,k)=>({u_particle_texture:f,u_particle_texture_side_len:t,u_tile_offset:s,u_velocity:d,u_color_ramp:v,u_velocity_res:_,u_max_speed:S,u_uv_offset:E,u_data_scale:[255*C[0],255*C[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Bl,Bl]}),Cp=(f,t,s,d,_,v,S,E,C,k)=>({u_particle_texture:f,u_particle_texture_side_len:t,u_velocity:s,u_velocity_res:d,u_max_speed:_,u_speed_factor:v,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:E,u_data_scale:[255*C[0],255*C[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Bl,Bl]}),pc=a.bz(),hf=(f,t,s,d,_,v,S,E,C,k,L,j,B,q,K,Z,J,Y,se,ce,pe,Se,Pe,Me)=>{const Te=_.transform,Ee={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Te.getCameraToCenterDistance(se),u_rotate_symbol:+s,u_aspect_ratio:Te.width/Te.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:S,u_coord_matrix:E,u_is_text:+k,u_elevation_from_sea:C?1:0,u_pitch_with_map:+d,u_texsize:L,u_texsize_icon:j,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:pc,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:pc,u_up_vector:[0,-1,0],u_color_adj_mat:Se,u_icon_transition:Pe||0,u_gamma_scale:d?_.transform.getCameraToCenterDistance(se)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:a.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Me||1,u_ground_shadow_factor:ce,u_inv_matrix:a.bi(a.bz(),S),u_normal_scale:pe};return se.name==="globe"&&(Ee.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],Ee.u_zoom_transition=K,Ee.u_inv_rot_matrix=J,Ee.u_merc_center=Z,Ee.u_camera_forward=Te._camera.forward(),Ee.u_ecef_origin=a.dQ(Te.globeMatrix,q.toUnwrapped()),Ee.u_tile_matrix=Float32Array.from(Te.globeMatrix),Ee.u_up_vector=Y),Ee},mc=(f,t,s,d)=>({u_matrix:f,u_emissive_strength:t,u_opacity:s,u_color:d}),ff=(f,t,s,d,_,v,S,E,C)=>a.h((function(k,L,j,B,q,K){const{width:Z,height:J}=B.imageManager.getPixelSize(L),Y=Math.pow(2,K.tileID.overscaledZ),se=K.tileSize*Math.pow(2,B.transform.tileZoom)/Y,ce=se*(K.tileID.canonical.x+K.tileID.wrap*Y),pe=se*K.tileID.canonical.y;return{u_image:0,u_pattern_tl:j.tl,u_pattern_br:j.br,u_texsize:[Z,J],u_pattern_size:j.displaySize,u_pattern_units_to_pixels:q?[B.transform.width,-1*B.transform.height]:[1/a.aw(K,1,B.transform.tileZoom),1/a.aw(K,1,B.transform.tileZoom)],u_pixel_coord_upper:[ce>>16,pe>>16],u_pixel_coord_lower:[65535&ce,65535&pe]}})(0,v,S,d,E,C),{u_matrix:f,u_emissive_strength:t,u_opacity:s}),gc=new Float32Array(a.bx([])),_c=(f,t,s,d,_,v,S,E,C,k,L,j,B,q=[0,0,0],K)=>{const Z=_.style.light,J=Z.properties.get("position"),Y=[-J.x,-J.y,J.z],se=a.dJ();Z.properties.get("anchor")==="viewport"&&(a.dK(se,-_.transform.angle),a.dL(Y,Y,se));const ce=L.alphaMode==="MASK",pe=Z.properties.get("color").toNonPremultipliedRenderColor(null),Se=B.paint.get("model-ambient-occlusion-intensity"),Pe=B.paint.get("model-color").constantOr(a.am.white).toNonPremultipliedRenderColor(null);return Pe.a=B.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:f,u_lighting_matrix:t,u_normal_matrix:s,u_node_matrix:d||gc,u_lightpos:Y,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[pe.r,pe.g,pe.b],u_camera_pos:q,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+ce,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:E.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:C,u_roughnessFactor:k,u_baseColorTexture:ha.BaseColor,u_metallicRoughnessTexture:ha.MetallicRoughness,u_normalTexture:ha.Normal,u_occlusionTexture:ha.Occlusion,u_emissionTexture:ha.Emission,u_lutTexture:ha.LUT,u_color_mix:Pe.toArray01(),u_aoIntensity:Se,u_emissive_strength:j,u_occlusionTextureTransform:K||[0,0,0,0]}},df=(f,t=gc,s=gc)=>({u_matrix:f,u_instance:t,u_node_matrix:s}),Mp={fillExtrusion:f=>({u_matrix:new a.ch(f),u_lightpos:new a.ce(f),u_lightintensity:new a.cf(f),u_lightcolor:new a.ce(f),u_vertical_gradient:new a.cf(f),u_opacity:new a.cf(f),u_edge_radius:new a.cf(f),u_width_scale:new a.cf(f),u_ao:new a.cg(f),u_height_type:new a.cd(f),u_base_type:new a.cd(f),u_tile_id:new a.ce(f),u_zoom_transition:new a.cf(f),u_inv_rot_matrix:new a.ch(f),u_merc_center:new a.cg(f),u_up_dir:new a.ce(f),u_height_lift:new a.cf(f),u_flood_light_color:new a.ce(f),u_vertical_scale:new a.cf(f),u_flood_light_intensity:new a.cf(f),u_ground_shadow_factor:new a.ce(f)}),fillExtrusionDepth:f=>({u_matrix:new a.ch(f),u_edge_radius:new a.cf(f),u_width_scale:new a.cf(f),u_vertical_scale:new a.cf(f),u_height_type:new a.cd(f),u_base_type:new a.cd(f)}),fillExtrusionPattern:f=>({u_matrix:new a.ch(f),u_lightpos:new a.ce(f),u_lightintensity:new a.cf(f),u_lightcolor:new a.ce(f),u_vertical_gradient:new a.cf(f),u_height_factor:new a.cf(f),u_edge_radius:new a.cf(f),u_width_scale:new a.cf(f),u_ao:new a.cg(f),u_height_type:new a.cd(f),u_base_type:new a.cd(f),u_tile_id:new a.ce(f),u_zoom_transition:new a.cf(f),u_inv_rot_matrix:new a.ch(f),u_merc_center:new a.cg(f),u_up_dir:new a.ce(f),u_height_lift:new a.cf(f),u_image:new a.cd(f),u_texsize:new a.cg(f),u_pixel_coord_upper:new a.cg(f),u_pixel_coord_lower:new a.cg(f),u_tile_units_to_pixels:new a.cf(f),u_opacity:new a.cf(f),u_pattern_transition:new a.cf(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new a.ch(f),u_opacity:new a.cf(f),u_ao_pass:new a.cf(f),u_meter_to_tile:new a.cf(f),u_ao:new a.cg(f),u_flood_light_intensity:new a.cf(f),u_flood_light_color:new a.ce(f),u_attenuation:new a.cf(f),u_edge_radius:new a.cf(f),u_fb:new a.cd(f),u_fb_size:new a.cf(f),u_dynamic_offset:new a.cf(f)}),fill:f=>({u_matrix:new a.ch(f),u_emissive_strength:new a.cf(f),u_ground_shadow_factor:new a.ce(f)}),fillPattern:f=>({u_matrix:new a.ch(f),u_emissive_strength:new a.cf(f),u_image:new a.cd(f),u_texsize:new a.cg(f),u_pixel_coord_upper:new a.cg(f),u_pixel_coord_lower:new a.cg(f),u_tile_units_to_pixels:new a.cf(f),u_ground_shadow_factor:new a.ce(f),u_pattern_transition:new a.cf(f)}),fillOutline:f=>({u_matrix:new a.ch(f),u_emissive_strength:new a.cf(f),u_world:new a.cg(f),u_ground_shadow_factor:new a.ce(f)}),fillOutlinePattern:f=>({u_matrix:new a.ch(f),u_emissive_strength:new a.cf(f),u_world:new a.cg(f),u_image:new a.cd(f),u_texsize:new a.cg(f),u_pixel_coord_upper:new a.cg(f),u_pixel_coord_lower:new a.cg(f),u_tile_units_to_pixels:new a.cf(f),u_ground_shadow_factor:new a.ce(f),u_pattern_transition:new a.cf(f)}),building:f=>({u_matrix:new a.ch(f),u_normal_matrix:new a.ch(f),u_opacity:new a.cf(f)}),buildingBloom:f=>({u_matrix:new a.ch(f)}),buildingDepth:f=>({u_matrix:new a.ch(f)}),elevatedStructuresDepth:f=>({u_matrix:new a.ch(f),u_depth_bias:new a.cf(f)}),elevatedStructures:f=>({u_matrix:new a.ch(f),u_ground_shadow_factor:new a.ce(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new a.ch(f),u_camera_pos:new a.ce(f),u_depth_bias:new a.cf(f),u_height_scale:new a.cf(f),u_reset_depth:new a.cf(f)}),circle:a.dT,collisionBox:f=>({u_matrix:new a.ch(f),u_inv_rot_matrix:new a.ch(f),u_camera_to_center_distance:new a.cf(f),u_extrude_scale:new a.cg(f),u_zoom_transition:new a.cf(f),u_merc_center:new a.cg(f),u_tile_id:new a.ce(f)}),collisionCircle:f=>({u_matrix:new a.ch(f),u_inv_matrix:new a.ch(f),u_camera_to_center_distance:new a.cf(f),u_viewport_size:new a.cg(f)}),debug:f=>({u_color:new a.dv(f),u_matrix:new a.ch(f),u_overlay:new a.cd(f),u_overlay_scale:new a.cf(f)}),clippingMask:f=>({u_matrix:new a.ch(f)}),heatmap:f=>({u_extrude_scale:new a.cf(f),u_intensity:new a.cf(f),u_matrix:new a.ch(f),u_inv_rot_matrix:new a.ch(f),u_merc_center:new a.cg(f),u_tile_id:new a.ce(f),u_zoom_transition:new a.cf(f),u_up_dir:new a.ce(f)}),heatmapTexture:f=>({u_image:new a.cd(f),u_color_ramp:new a.cd(f),u_opacity:new a.cf(f)}),hillshade:f=>({u_matrix:new a.ch(f),u_image:new a.cd(f),u_latrange:new a.cg(f),u_light:new a.cg(f),u_shadow:new a.dv(f),u_highlight:new a.dv(f),u_emissive_strength:new a.cf(f),u_accent:new a.dv(f)}),hillshadePrepare:f=>({u_matrix:new a.ch(f),u_image:new a.cd(f),u_dimension:new a.cg(f),u_zoom:new a.cf(f)}),line:a.dS,linePattern:a.dR,raster:f=>({u_matrix:new a.ch(f),u_normalize_matrix:new a.ch(f),u_globe_matrix:new a.ch(f),u_merc_matrix:new a.ch(f),u_grid_matrix:new a.dw(f),u_tl_parent:new a.cg(f),u_scale_parent:new a.cf(f),u_fade_t:new a.cf(f),u_opacity:new a.cf(f),u_image0:new a.cd(f),u_image1:new a.cd(f),u_brightness_low:new a.cf(f),u_brightness_high:new a.cf(f),u_saturation_factor:new a.cf(f),u_contrast_factor:new a.cf(f),u_spin_weights:new a.ce(f),u_perspective_transform:new a.cg(f),u_raster_elevation:new a.cf(f),u_zoom_transition:new a.cf(f),u_merc_center:new a.cg(f),u_cutoff_params:new a.d0(f),u_colorization_mix:new a.d0(f),u_colorization_offset:new a.cf(f),u_color_ramp:new a.cd(f),u_texture_offset:new a.cg(f),u_texture_res:new a.cg(f),u_emissive_strength:new a.cf(f)}),rasterParticle:f=>({u_matrix:new a.ch(f),u_normalize_matrix:new a.ch(f),u_globe_matrix:new a.ch(f),u_merc_matrix:new a.ch(f),u_grid_matrix:new a.dw(f),u_tl_parent:new a.cg(f),u_scale_parent:new a.cf(f),u_fade_t:new a.cf(f),u_opacity:new a.cf(f),u_image0:new a.cd(f),u_image1:new a.cd(f),u_raster_elevation:new a.cf(f),u_zoom_transition:new a.cf(f),u_merc_center:new a.cg(f),u_cutoff_params:new a.d0(f)}),rasterParticleTexture:f=>({u_texture:new a.cd(f),u_opacity:new a.cf(f)}),rasterParticleDraw:f=>({u_particle_texture:new a.cd(f),u_particle_texture_side_len:new a.cf(f),u_tile_offset:new a.cg(f),u_velocity:new a.cd(f),u_color_ramp:new a.cd(f),u_velocity_res:new a.cg(f),u_max_speed:new a.cf(f),u_uv_offset:new a.cg(f),u_data_scale:new a.cg(f),u_data_offset:new a.cf(f),u_particle_pos_scale:new a.cf(f),u_particle_pos_offset:new a.cg(f)}),rasterParticleUpdate:f=>({u_particle_texture:new a.cd(f),u_particle_texture_side_len:new a.cf(f),u_velocity:new a.cd(f),u_velocity_res:new a.cg(f),u_max_speed:new a.cf(f),u_speed_factor:new a.cf(f),u_reset_rate:new a.cf(f),u_rand_seed:new a.cf(f),u_uv_offset:new a.cg(f),u_data_scale:new a.cg(f),u_data_offset:new a.cf(f),u_particle_pos_scale:new a.cf(f),u_particle_pos_offset:new a.cg(f)}),symbol:f=>({u_is_size_zoom_constant:new a.cd(f),u_is_size_feature_constant:new a.cd(f),u_size_t:new a.cf(f),u_size:new a.cf(f),u_camera_to_center_distance:new a.cf(f),u_rotate_symbol:new a.cd(f),u_aspect_ratio:new a.cf(f),u_fade_change:new a.cf(f),u_matrix:new a.ch(f),u_label_plane_matrix:new a.ch(f),u_coord_matrix:new a.ch(f),u_is_text:new a.cd(f),u_elevation_from_sea:new a.cd(f),u_pitch_with_map:new a.cd(f),u_texsize:new a.cg(f),u_texsize_icon:new a.cg(f),u_texture:new a.cd(f),u_texture_icon:new a.cd(f),u_gamma_scale:new a.cf(f),u_device_pixel_ratio:new a.cf(f),u_tile_id:new a.ce(f),u_zoom_transition:new a.cf(f),u_inv_rot_matrix:new a.ch(f),u_merc_center:new a.cg(f),u_camera_forward:new a.ce(f),u_tile_matrix:new a.ch(f),u_up_vector:new a.ce(f),u_ecef_origin:new a.ce(f),u_is_halo:new a.cd(f),u_icon_transition:new a.cf(f),u_color_adj_mat:new a.ch(f),u_scale_factor:new a.cf(f),u_ground_shadow_factor:new a.ce(f),u_inv_matrix:new a.ch(f),u_normal_scale:new a.cf(f)}),background:f=>({u_matrix:new a.ch(f),u_emissive_strength:new a.cf(f),u_opacity:new a.cf(f),u_color:new a.dv(f)}),backgroundPattern:f=>({u_matrix:new a.ch(f),u_emissive_strength:new a.cf(f),u_opacity:new a.cf(f),u_image:new a.cd(f),u_pattern_tl:new a.cg(f),u_pattern_br:new a.cg(f),u_texsize:new a.cg(f),u_pattern_size:new a.cg(f),u_pixel_coord_upper:new a.cg(f),u_pixel_coord_lower:new a.cg(f),u_pattern_units_to_pixels:new a.cg(f)}),terrainRaster:f=>({u_matrix:new a.ch(f),u_image0:new a.cd(f),u_skirt_height:new a.cf(f),u_ground_shadow_factor:new a.ce(f)}),skybox:f=>({u_matrix:new a.ch(f),u_sun_direction:new a.ce(f),u_cubemap:new a.cd(f),u_opacity:new a.cf(f),u_temporal_offset:new a.cf(f)}),skyboxGradient:f=>({u_matrix:new a.ch(f),u_color_ramp:new a.cd(f),u_center_direction:new a.ce(f),u_radius:new a.cf(f),u_opacity:new a.cf(f),u_temporal_offset:new a.cf(f)}),skyboxCapture:f=>({u_matrix_3f:new a.dw(f),u_sun_direction:new a.ce(f),u_sun_intensity:new a.cf(f),u_color_tint_r:new a.d0(f),u_color_tint_m:new a.d0(f),u_luminance:new a.cf(f)}),globeRaster:f=>({u_proj_matrix:new a.ch(f),u_globe_matrix:new a.ch(f),u_normalize_matrix:new a.ch(f),u_merc_matrix:new a.ch(f),u_zoom_transition:new a.cf(f),u_merc_center:new a.cg(f),u_image0:new a.cd(f),u_grid_matrix:new a.dw(f),u_skirt_height:new a.cf(f),u_far_z_cutoff:new a.cf(f),u_frustum_tl:new a.ce(f),u_frustum_tr:new a.ce(f),u_frustum_br:new a.ce(f),u_frustum_bl:new a.ce(f),u_globe_pos:new a.ce(f),u_globe_radius:new a.cf(f),u_viewport:new a.cg(f)}),globeAtmosphere:f=>({u_frustum_tl:new a.ce(f),u_frustum_tr:new a.ce(f),u_frustum_br:new a.ce(f),u_frustum_bl:new a.ce(f),u_horizon:new a.cf(f),u_transition:new a.cf(f),u_fadeout_range:new a.cf(f),u_color:new a.d0(f),u_high_color:new a.d0(f),u_space_color:new a.d0(f),u_temporal_offset:new a.cf(f),u_horizon_angle:new a.cf(f)}),model:f=>({u_matrix:new a.ch(f),u_lighting_matrix:new a.ch(f),u_normal_matrix:new a.ch(f),u_node_matrix:new a.ch(f),u_lightpos:new a.ce(f),u_lightintensity:new a.cf(f),u_lightcolor:new a.ce(f),u_camera_pos:new a.ce(f),u_opacity:new a.cf(f),u_baseColorFactor:new a.d0(f),u_emissiveFactor:new a.d0(f),u_metallicFactor:new a.cf(f),u_roughnessFactor:new a.cf(f),u_baseTextureIsAlpha:new a.cd(f),u_alphaMask:new a.cd(f),u_alphaCutoff:new a.cf(f),u_baseColorTexture:new a.cd(f),u_metallicRoughnessTexture:new a.cd(f),u_normalTexture:new a.cd(f),u_occlusionTexture:new a.cd(f),u_emissionTexture:new a.cd(f),u_lutTexture:new a.cd(f),u_color_mix:new a.d0(f),u_aoIntensity:new a.cf(f),u_emissive_strength:new a.cf(f),u_occlusionTextureTransform:new a.d0(f)}),modelDepth:f=>({u_matrix:new a.ch(f),u_instance:new a.ch(f),u_node_matrix:new a.ch(f)}),groundShadow:f=>({u_matrix:new a.ch(f),u_ground_shadow_factor:new a.ce(f)}),stars:f=>({u_matrix:new a.ch(f),u_up:new a.ce(f),u_right:new a.ce(f),u_intensity_multiplier:new a.cf(f)}),snowParticle:f=>({u_modelview:new a.ch(f),u_projection:new a.ch(f),u_time:new a.cf(f),u_cam_pos:new a.ce(f),u_velocityConeAperture:new a.cf(f),u_velocity:new a.cf(f),u_horizontalOscillationRadius:new a.cf(f),u_horizontalOscillationRate:new a.cf(f),u_boxSize:new a.cf(f),u_billboardSize:new a.cf(f),u_simpleShapeParameters:new a.cg(f),u_screenSize:new a.cg(f),u_thinningCenterPos:new a.cg(f),u_thinningShape:new a.ce(f),u_thinningAffectedRatio:new a.cf(f),u_thinningParticleOffset:new a.cf(f),u_particleColor:new a.d0(f),u_direction:new a.ce(f)}),rainParticle:f=>({u_modelview:new a.ch(f),u_projection:new a.ch(f),u_time:new a.cf(f),u_cam_pos:new a.ce(f),u_texScreen:new a.cd(f),u_velocityConeAperture:new a.cf(f),u_velocity:new a.cf(f),u_boxSize:new a.cf(f),u_rainDropletSize:new a.cg(f),u_distortionStrength:new a.cf(f),u_rainDirection:new a.ce(f),u_color:new a.d0(f),u_screenSize:new a.cg(f),u_thinningCenterPos:new a.cg(f),u_thinningShape:new a.ce(f),u_thinningAffectedRatio:new a.cf(f),u_thinningParticleOffset:new a.cf(f),u_shapeDirectionalPower:new a.cf(f),u_shapeNormalPower:new a.cf(f),u_mode:new a.cf(f)}),vignette:f=>({u_vignetteShape:new a.ce(f),u_vignetteColor:new a.d0(f)}),occlusion:f=>({u_matrix:new a.ch(f),u_anchorPos:new a.ce(f),u_screenSizePx:new a.cg(f),u_occluderSizePx:new a.cg(f),u_color:new a.d0(f)})};class Nl{constructor(t,s,d,_){this.id=Nl.uniqueIdxCounter,Nl.uniqueIdxCounter++,this.context=t;const v=t.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||_||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Nl.uniqueIdxCounter,Nl.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Nl.uniqueIdxCounter=0;const Eu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class bd{constructor(t,s,d,_,v,S){this.length=s.length,this.attributes=d,this.itemSize=s.bytesPerElement,this.dynamicDraw=_,this.instanceCount=S,this.context=t;const E=t.gl;this.buffer=E.createBuffer(),t.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||v||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let d=0;d<this.attributes.length;d++){const _=s.attributes[this.attributes[d].name];_!==void 0&&t.enableVertexAttribArray(_)}}setVertexAttribPointers(t,s,d){for(let _=0;_<this.attributes.length;_++){const v=this.attributes[_],S=s.attributes[v.name];S!==void 0&&t.vertexAttribPointer(S,v.components,t[Eu[v.type]],!1,this.itemSize,v.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,s,d){for(let _=0;_<this.attributes.length;_++){const v=s.attributes[this.attributes[_].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(v,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class gl{constructor(t,s,d,_,v){this.context=t,this.width=s,this.height=d;const S=this.framebuffer=t.gl.createFramebuffer();_&&(this.colorAttachment=new cc(t,S)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new hh(t,S):new bu(t,S))}destroy(){const t=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&t.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&t.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&t.deleteTexture(s)}t.deleteFramebuffer(this.framebuffer)}}class yc{constructor(t,s){this.gl=t,this.clearColor=new wp(this),this.clearDepth=new cd(this),this.clearStencil=new rf(this),this.colorMask=new Em(this),this.depthMask=new hd(this),this.stencilMask=new nf(this),this.stencilFunc=new uc(this),this.stencilOp=new oh(this),this.stencilTest=new Sp(this),this.depthRange=new Tp(this),this.depthTest=new fd(this),this.depthFunc=new dd(this),this.blend=new cl(this),this.blendFunc=new kl(this),this.blendColor=new ah(this),this.blendEquation=new sh(this),this.cullFace=new vu(this),this.cullFaceSide=new pd(this),this.frontFace=new Ep(this),this.program=new Ap(this),this.activeTexture=new lh(this),this.viewport=new md(this),this.bindFramebuffer=new uh(this),this.bindRenderbuffer=new hl(this),this.bindTexture=new of(this),this.bindVertexBuffer=new fl(this),this.bindElementBuffer=new Rs(this),this.bindVertexArrayOES=new ch(this),this.pixelStoreUnpack=new dl(this),this.pixelStoreUnpackPremultiplyAlpha=new xu(this),this.pixelStoreUnpackFlipY=new Am(this),this.options=s?Object.assign({},s):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=s&&!!s.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s,d){return new Nl(this,t,s,d)}createVertexBuffer(t,s,d,_,v){return new bd(this,t,s,d,_,v)}createRenderbuffer(t,s,d){const _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,t,s,d),this.bindRenderbuffer.set(null),v}createFramebuffer(t,s,d,_){return new gl(this,t,s,d,_)}clear({color:t,depth:s,stencil:d,colorMask:_}){const v=this.gl;let S=0;t&&(S|=v.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(_||[!0,!0,!0,!0])),s!==void 0&&(S|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),d!==void 0&&(S|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),v.clear(S)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){a.bv(t.blendFunction,Wr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let ls;function pf(f,t,s,d,_,v,S){const E=f.context,C=E.gl,k=f.transform,L=[a.aD(k.center.lng),a.aH(k.center.lat)],j=s.layout.get("symbol-placement"),B=s.layout.get("text-variable-anchor"),q=s.layout.get("icon-rotation-alignment")==="map",K=s.layout.get("text-rotation-alignment")==="map",Z=j!=="point",J=[];let Y=0,se=0;for(let Ee=0;Ee<d.length;Ee++){const Ae=d[Ee],We=t.getTile(Ae),Le=We.getBucket(s);if(!Le)continue;const ut=Le.getProjection().createInversionMatrix(k,Ae.canonical),Je=[],dt=Hc(Ae,Le,k),wt=!S&&q&&Z,qe=S&&K&&Z,Re=B&&Le.hasTextData(),tt=Le.hasIconTextFit()&&Re&&Le.hasIconData(),Ye=wt||qe||S&&Re||tt,vt=Le.projection.name==="globe",bt=vt?a.ah(k.zoom):0;vt&&(Je.push("PROJECTION_GLOBE_VIEW"),Ye&&Je.push("PROJECTED_POS_ON_VIEWPORT"));const It=f.getOrCreateProgram("collisionBox",{defines:Je});let Dt=dt;_[0]===0&&_[1]===0||(Dt=f.translatePosMatrix(dt,We,_,v));const lr=S?Le.textCollisionBox:Le.iconCollisionBox,pr=Le.collisionCircleArray;if(pr.length>0){const dr=a.bz(),ur=Dt;a.cM(dr,Le.placementInvProjMatrix,k.glCoordMatrix),a.cM(dr,dr,Le.placementViewportMatrix),J.push({circleArray:pr,circleOffset:se,transform:ur,invTransform:dr,projection:Le.getProjection()}),Y+=pr.length/4,se=Y}if(!lr)continue;f.terrain&&f.terrain.setupElevationDraw(We,It);const Yt=vt?[Ae.canonical.x,Ae.canonical.y,1<<Ae.canonical.z]:[0,0,0];It.draw(f,C.LINES,Qt.disabled,Ar.disabled,f.colorModeForRenderPass(),Sr.disabled,dc(Dt,ut,k,bt,L,We,Yt,Le.getProjection()),s.id,lr.layoutVertexBuffer,lr.indexBuffer,lr.segments,null,k.zoom,null,[lr.collisionVertexBuffer,lr.collisionVertexBufferExt])}if(!S||!J.length)return;const ce=f.getOrCreateProgram("collisionCircle"),pe=new a.dU;pe.resize(4*Y),pe._trim();let Se=0;for(const Ee of J)for(let Ae=0;Ae<Ee.circleArray.length/4;Ae++){const We=4*Ae,Le=Ee.circleArray[We+0],ut=Ee.circleArray[We+1],Je=Ee.circleArray[We+2],dt=Ee.circleArray[We+3];pe.emplace(Se++,Le,ut,Je,dt,0),pe.emplace(Se++,Le,ut,Je,dt,1),pe.emplace(Se++,Le,ut,Je,dt,2),pe.emplace(Se++,Le,ut,Je,dt,3)}(!ls||ls.length<2*Y)&&(ls=(function(Ee){const Ae=2*Ee,We=new a.a_;We.resize(Ae),We._trim();for(let Le=0;Le<Ae;Le++){const ut=6*Le;We.uint16[ut+0]=4*Le+0,We.uint16[ut+1]=4*Le+1,We.uint16[ut+2]=4*Le+2,We.uint16[ut+3]=4*Le+2,We.uint16[ut+4]=4*Le+3,We.uint16[ut+5]=4*Le+0}return We})(Y));const Pe=E.createIndexBuffer(ls,!0),Me=E.createVertexBuffer(pe,a.dV.members,!0);for(const Ee of J){const Ae={u_matrix:Ee.transform,u_inv_matrix:Ee.invTransform,u_camera_to_center_distance:(Te=k).getCameraToCenterDistance(Ee.projection),u_viewport_size:[Te.width,Te.height]};ce.draw(f,C.TRIANGLES,Qt.disabled,Ar.disabled,f.colorModeForRenderPass(),Sr.disabled,Ae,s.id,Me,Pe,a.bd.simpleSegment(0,2*Ee.circleOffset,Ee.circleArray.length,Ee.circleArray.length/2),null,k.zoom)}var Te;Me.destroy(),Pe.destroy()}const jl=a.bz();function vc(f){const t=f._camera.getWorldToCamera(f.worldSize,1),s=a.az([],t,f.globeMatrix);a.bi(s,s);const d=[0,0,0],_=[0,1,0,0];return a.aA(_,_,s),d[0]=_[0],d[1]=_[1],d[2]=_[2],a.au(d,d),d}function mf({width:f,height:t,anchor:s,textOffset:d,textScale:_},v){const{horizontalAlign:S,verticalAlign:E}=a.bZ(s),C=-(S-.5)*f,k=-(E-.5)*t,L=a.b_(s,d);return new a.P((C/_+L[0])*v,(k/_+L[1])*v)}function xc(f,t,s,d,_,v,S,E,C,k){const L=f.text.placedSymbolArray,j=f.text.dynamicLayoutVertexArray,B=f.icon.dynamicLayoutVertexArray,q={},K=f.getProjection(),Z=El(S,K,_),J=_.elevation,Y=K.upVectorScale(S.canonical,_.center.lat,_.worldSize).metersToTile;j.clear();for(let se=0;se<L.length;se++){const ce=L.get(se),{tileAnchorX:pe,tileAnchorY:Se,numGlyphs:Pe}=ce,Me=ce.hidden||!ce.crossTileID||f.allowVerticalPlacement&&!ce.placedOrientation?null:d[ce.crossTileID];if(Me){let Te=0,Ee=0,Ae=0;if(J){const tt=J?J.getAtTileOffset(S,pe,Se):0,[Ye,vt,bt]=K.upVector(S.canonical,pe,Se);Te=tt*Ye*Y,Ee=tt*vt*Y,Ae=tt*bt*Y}let[We,Le,ut,Je]=Io(ce.projectedAnchorX+Te,ce.projectedAnchorY+Ee,ce.projectedAnchorZ+Ae,s?Z:v);const dt=qh(_.getCameraToCenterDistance(K),Je);let wt=a.bJ(f.textSizeData,C,ce)*dt/a.bU;s&&(wt*=f.tilePixelRatio/E);const qe=mf(Me,wt);s?({x:We,y:Le,z:ut}=K.projectTilePoint(pe+qe.x,Se+qe.y,S.canonical),[We,Le,ut]=Io(We+Te,Le+Ee,ut+Ae,v)):(t&&qe._rotate(-_.angle),We+=qe.x,Le+=qe.y,ut=0);const Re=f.allowVerticalPlacement&&ce.placedOrientation===a.bI.vertical?Math.PI/2:0;for(let tt=0;tt<Pe;tt++)a.bL(j,We,Le,ut,Re);k&&ce.associatedIconIndex>=0&&(q[ce.associatedIconIndex]={x:We,y:Le,z:ut,angle:Re})}else sl(Pe,j)}if(k){B.clear();const se=f.icon.placedSymbolArray;for(let ce=0;ce<se.length;ce++){const pe=se.get(ce),{numGlyphs:Se}=pe,Pe=q[ce];if(pe.hidden||!Pe)sl(Se,B);else{const{x:Me,y:Te,z:Ee,angle:Ae}=Pe;for(let We=0;We<Se;We++)a.bL(B,Me,Te,Ee,Ae)}}f.icon.dynamicLayoutVertexBuffer.updateData(B)}f.text.dynamicLayoutVertexBuffer.updateData(j)}function qa(f,t,s,d,_,v,S={}){const E=s.paint.get("icon-translate"),C=s.paint.get("text-translate"),k=s.paint.get("icon-translate-anchor"),L=s.paint.get("text-translate-anchor"),j=s.layout.get("icon-rotation-alignment"),B=s.layout.get("text-rotation-alignment"),q=s.layout.get("icon-pitch-alignment"),K=s.layout.get("text-pitch-alignment"),Z=s.layout.get("icon-keep-upright"),J=s.layout.get("text-keep-upright"),Y=s.paint.get("icon-color-saturation"),se=s.paint.get("icon-color-contrast"),ce=s.paint.get("icon-color-brightness-min"),pe=s.paint.get("icon-color-brightness-max"),Se=s.layout.get("symbol-elevation-reference")==="sea",Pe=f.context,Me=Pe.gl,Te=f.transform,Ee=j==="map",Ae=B==="map",We=q==="map",Le=K==="map",ut=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Je=!1;const dt=f.depthModeForSublayer(0,Qt.ReadOnly),wt=new Qt(f.context.gl.LEQUAL,Qt.ReadOnly,f.depthRangeFor3D),qe=[a.aD(Te.center.lng),a.aH(Te.center.lat)],Re=s.layout.get("text-variable-anchor"),tt=Te.projection.name==="globe",Ye=[],vt=[0,-1,0];for(const bt of d){const It=t.getTile(bt),Dt=It.getBucket(s);if(!Dt||Dt.projection.name==="mercator"&&tt||Dt.fullyClipped)continue;const lr=Dt.projection.name==="globe",pr=lr?a.ah(Te.zoom):0,Yt=El(bt,Dt.getProjection(),Te),dr=Te.calculatePixelsToTileUnitsMatrix(It),ur=Re&&Dt.hasTextData(),kr=Dt.hasIconTextFit()&&ur&&Dt.hasIconData(),Vr=Dt.getProjection().createInversionMatrix(Te,bt.canonical),Xr=(1<<It.tileID.canonical.z)*a.aj/f.transform.worldSize,vn=Gn=>{let On=[0,0,0];if(Gn){const Si=f.style.directionalLight,xn=f.style.ambientLight;Si&&xn&&(On=Ol(f.style,Si,xn))}return On},jr=Gn=>{Te.depthOcclusionForSymbolsAndCircles&&(s.hasInitialOcclusionOpacityProperties||f.terrain)&&(Gn.push("DEPTH_D24"),Gn.push("DEPTH_OCCLUSION"))},Sn=()=>{const Gn=Ee&&s.layout.get("symbol-placement")!=="point",On=[];jr(On);const Si=Gn||kr,xn=Dt.elevationType==="road",Ln=f.shadowRenderer,Wn=xn&&We&&!!Ln&&Ln.enabled,qi=vn(Wn),ti=xn&&We&&!f.terrain?wt:dt,Ni=s.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&We&&On.push("PITCH_WITH_MAP_TERRAIN"),lr&&(On.push("PROJECTION_GLOBE_VIEW"),Si&&On.push("PROJECTED_POS_ON_VIEWPORT")),Ni>0&&Dt.hasAnySecondaryIcon&&On.push("ICON_TRANSITION"),!Dt.icon.zOffsetVertexBuffer||xn&&f.terrain||On.push("Z_OFFSET"),Y===0&&se===0&&ce===0&&pe===1||On.push("COLOR_ADJUSTMENT"),Dt.sdfIcons&&On.push("RENDER_SDF"),Wn&&On.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),xn&&We&&!f.terrain&&Dt.icon.orientationVertexBuffer&&On.push("ELEVATED_ROADS");const Ro=Dt.icon.programConfigurations.get(s.id),Xo=f.getOrCreateProgram("symbol",{config:Ro,defines:On}),Uo=It.imageAtlasTexture?It.imageAtlasTexture.size:[0,0],ko=Dt.iconSizeData,Eo=a.bH(ko,Te.zoom),Ma=We||!Te.isOrthographic,Za=uu(Yt,It.tileID.canonical,We,Ee,Te,Dt.getProjection(),dr),Ko=al(Yt,It.tileID.canonical,We,Ee,Te,Dt.getProjection(),dr),Mi=f.translatePosMatrix(Ko,It,E,k,!0),Oi=f.translatePosMatrix(Yt,It,E,k),Jn=Si?jl:Za,Qi=Ee&&!We&&!Gn;let uo=vt;!tt&&!Te.mercatorFromTransition||Ee||(uo=vc(Te));const Ai=lr?uo:vt,Xa=s.getColorAdjustmentMatrix(Y,se,ce,pe),Hl=hf(ko.kind,Eo,Qi,We,f,Oi,Jn,Mi,Se,!1,Uo,[0,0],0,bt,pr,qe,Vr,Ai,Dt.getProjection(),qi,Xr,Xa,Ni,null),Du=It.imageAtlasTexture?It.imageAtlasTexture:null,Oc=s.layout.get("icon-size").constantOr(0)!==1||Dt.iconsNeedLinear,zu=Dt.sdfIcons||f.options.rotating||f.options.zooming||Oc||Ma?Me.LINEAR:Me.NEAREST,ga=Dt.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,Ts=f.terrain&&We&&Gn?a.bi(a.bz(),Za):jl;if(Gn&&Dt.icon){const Gi=Te.elevation,Ka=Gi?Gi.getAtTileOffsetFunc(bt,Te.center.lat,Te.worldSize,Dt.getProjection()):null,Rc=cu(Yt,It.tileID.canonical,We,Ee,Te,Dt.getProjection(),dr);hu(Dt,Yt,f,!1,Rc,Ko,We,Z,Ka,bt)}return{program:Xo,buffers:Dt.icon,uniformValues:Hl,atlasTexture:Du,atlasTextureIcon:null,atlasInterpolation:zu,atlasInterpolationIcon:null,isSDF:Dt.sdfIcons,hasHalo:ga,depthMode:ti,tile:It,renderWithShadows:Wn,labelPlaneMatrixInv:Ts}},Mn=()=>{const Gn=Ae&&s.layout.get("symbol-placement")!=="point",On=[],Si=Gn||Re||kr,xn=Dt.elevationType==="road",Ln=f.shadowRenderer,Wn=xn&&Le&&!!Ln&&Ln.enabled,qi=vn(Wn),ti=xn&&Le&&!f.terrain?wt:dt;f.terrainRenderModeElevated()&&Le&&On.push("PITCH_WITH_MAP_TERRAIN"),lr&&(On.push("PROJECTION_GLOBE_VIEW"),Si&&On.push("PROJECTED_POS_ON_VIEWPORT")),!Dt.text.zOffsetVertexBuffer||xn&&f.terrain||On.push("Z_OFFSET"),Dt.iconsInText&&On.push("RENDER_TEXT_AND_SYMBOL"),On.push("RENDER_SDF"),Wn&&On.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),xn&&Le&&!f.terrain&&Dt.text.orientationVertexBuffer&&On.push("ELEVATED_ROADS"),jr(On);const Ni=Dt.text.programConfigurations.get(s.id),Ro=f.getOrCreateProgram("symbol",{config:Ni,defines:On});let Xo,Uo=[0,0],ko=null;const Eo=Dt.textSizeData;Dt.iconsInText&&(Uo=It.imageAtlasTexture?It.imageAtlasTexture.size:[0,0],ko=It.imageAtlasTexture?It.imageAtlasTexture:null,Xo=Le||!Te.isOrthographic||f.options.rotating||f.options.zooming||Eo.kind==="composite"||Eo.kind==="camera"?Me.LINEAR:Me.NEAREST);const Ma=It.glyphAtlasTexture?It.glyphAtlasTexture.size:[0,0],Za=s.layout.get("text-size-scale-range"),Ko=a.ay(f.scaleFactor,Za[0],Za[1]),Mi=a.bH(Eo,Te.zoom,Ko),Oi=uu(Yt,It.tileID.canonical,Le,Ae,Te,Dt.getProjection(),dr),Jn=al(Yt,It.tileID.canonical,Le,Ae,Te,Dt.getProjection(),dr),Qi=f.translatePosMatrix(Jn,It,C,L,!0),uo=f.translatePosMatrix(Yt,It,C,L),Ai=Si?jl:Oi,Xa=Ae&&!Le&&!Gn;let Hl=vt;!tt&&!Te.mercatorFromTransition||Ae||(Hl=vc(Te));const Du=hf(Eo.kind,Mi,Xa,Le,f,uo,Ai,Qi,Se,!0,Ma,Uo,0,bt,pr,qe,Vr,lr?Hl:vt,Dt.getProjection(),qi,Xr,null,null,Ko),Oc=It.glyphAtlasTexture?It.glyphAtlasTexture:null,zu=Me.LINEAR,ga=s.paint.get("text-halo-width").constantOr(1)!==0,Ts=f.terrain&&Le&&Gn?a.bi(a.bz(),Oi):jl;if(Gn&&Dt.text){const Gi=Te.elevation,Ka=Gi?Gi.getAtTileOffsetFunc(bt,Te.center.lat,Te.worldSize,Dt.getProjection()):null,Rc=cu(Yt,It.tileID.canonical,Le,Ae,Te,Dt.getProjection(),dr);hu(Dt,Yt,f,!0,Rc,Jn,Le,J,Ka,bt)}return{program:Ro,buffers:Dt.text,uniformValues:Du,atlasTexture:Oc,atlasTextureIcon:ko,atlasInterpolation:zu,atlasInterpolationIcon:Xo,isSDF:!0,hasHalo:ga,depthMode:ti,tile:It,renderWithShadows:Wn,labelPlaneMatrixInv:Ts}},Xn=Dt.icon.segments.get().length,Gr=Dt.text.segments.get().length,Tn=Xn&&!S.onlyText?Sn():null,_n=Gr&&!S.onlyIcons?Mn():null,zn=s.paint.get("icon-opacity").constantOr(1),Mr=s.paint.get("text-opacity").constantOr(1);if(ut&&Dt.canOverlap){Je=!0;const Gn=zn&&!S.onlyText?Dt.icon.segments.get():[],On=Mr&&!S.onlyIcons?Dt.text.segments.get():[];for(const Si of Gn)Ye.push({segments:new a.bd([Si]),sortKey:Si.sortKey,state:Tn});for(const Si of On)Ye.push({segments:new a.bd([Si]),sortKey:Si.sortKey,state:_n})}else S.onlyText||Ye.push({segments:zn?Dt.icon.segments:new a.bd([]),sortKey:0,state:Tn}),S.onlyIcons||Ye.push({segments:Mr?Dt.text.segments:new a.bd([]),sortKey:0,state:_n})}Je&&Ye.sort(((bt,It)=>bt.sortKey-It.sortKey));for(const bt of Ye){const It=bt.state;if(It)if(f.terrain?f.terrain.setupElevationDraw(It.tile,It.program,{useDepthForOcclusion:Te.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:It.labelPlaneMatrixInv}):f.setupDepthForOcclusion(Te.depthOcclusionForSymbolsAndCircles,It.program),Pe.activeTexture.set(Me.TEXTURE0),It.atlasTexture&&It.atlasTexture.bind(It.atlasInterpolation,Me.CLAMP_TO_EDGE,!0),It.atlasTextureIcon&&(Pe.activeTexture.set(Me.TEXTURE1),It.atlasTextureIcon&&It.atlasTextureIcon.bind(It.atlasInterpolationIcon,Me.CLAMP_TO_EDGE,!0)),It.renderWithShadows&&f.shadowRenderer.setupShadows(It.tile.tileID.toUnwrapped(),It.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,It.program),It.hasHalo){const Dt=It.uniformValues;Dt.u_is_halo=1,Ga(It.buffers,bt.segments,s,f,It.program,It.depthMode,_,v,Dt,2),Dt.u_is_halo=0}else{if(It.isSDF){const Dt=It.uniformValues;It.hasHalo&&(Dt.u_is_halo=1,Ga(It.buffers,bt.segments,s,f,It.program,It.depthMode,_,v,Dt,1)),Dt.u_is_halo=0}Ga(It.buffers,bt.segments,s,f,It.program,It.depthMode,_,v,It.uniformValues,1)}}}function Ga(f,t,s,d,_,v,S,E,C,k){const L=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];_.draw(d,d.context.gl.TRIANGLES,v,S,E,Sr.disabled,C,s.id,f.layoutVertexBuffer,f.indexBuffer,t,s.paint,d.transform.zoom,f.programConfigurations.get(s.id),L,k)}function bc(f,t){const s=1<<f.canonical.z,d=(t.x*s-f.canonical.x-f.wrap*s)*a.aj,_=(t.y*s-f.canonical.y)*a.aj,v=a.e2(t.z,t.y);return a.d2(d,_,v)}function nr(f,t,s,d,_){if(!s.layout||s.layout.get("fill-elevation-reference")==="none")return;const v=f.context.gl,S=new Qt(f.context.gl.LEQUAL,Qt.ReadWrite,f.depthRangeFor3D),E=new Qt(f.context.gl.GREATER,Qt.ReadWrite,f.depthRangeFor3D),C=(function(q){const K=a.cU(q.pitch);let Z=.01;return q.isOrthographic&&(Z=a.ai(1e-4,Z,a.cZ(K>=xo?1:K/xo))),2*Z})(f.transform),k=f.transform.getFreeCameraOptions().position,L="elevatedStructuresDepthReconstruct",j=f.getOrCreateProgram(L,{defines:["DEPTH_RECONSTRUCTION"]}),B=f.getOrCreateProgram(L);for(const q of d){const K=t.getTile(q),Z=K.getBucket(s);if(!Z)continue;const J=Z.elevatedStructures;if(!J)continue;const Y=Z.elevationBufferData.heightRange,se=bc(q.toUnwrapped(),k),ce=f.translatePosMatrix(q.projMatrix,K,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));let pe,Se,Pe,Me;if(_==="initialize"){if(!Y||Y.min>=1||J.depthSegments.segments[0].primitiveLength===0)continue;pe=ml(ce,se,C,1,0),Se=S,Pe=J.depthSegments,Me=j}else if(_==="reset"){if(!Y||Y.min>=0||J.maskSegments.segments[0].primitiveLength===0)continue;pe=ml(ce,se,0,0,1),Se=E,Pe=J.maskSegments,Me=j}else if(_==="geometry"){if(J.depthSegments.segments[0].primitiveLength===0)continue;pe=ml(ce,se,C,1,0),Se=S,Pe=J.depthSegments,Me=B}Me.draw(f,v.TRIANGLES,Se,Ar.disabled,Wr.disabled,Sr.disabled,pe,s.id,J.vertexBuffer,J.indexBuffer,Pe,s.paint,f.transform.zoom)}}function bs(f,t,s){const{painter:d,sourceCache:_,layer:v,coords:S,colorMode:E,elevationType:C,terrainEnabled:k,pass:L}=f,j=d.context.gl,B=v.paint.get("fill-pattern"),q=v.paint.get("fill-pattern-cross-fade"),K=B.constantOr(null);let Z=C;C!=="road"||t&&!k||(Z="none");const J=Z==="road",Y=f.painter.shadowRenderer,se=J&&!!Y&&Y.enabled,ce=new Qt(d.context.gl.LEQUAL,Qt.ReadOnly,d.depthRangeFor3D);let pe=[0,0,0];if(se){const Me=d.style.directionalLight,Te=d.style.ambientLight;Me&&Te&&(pe=Ol(d.style,Me,Te))}const Se=B&&B.constantOr(1),Pe=(Me,Te)=>{let Ee,Ae,We,Le,ut;Te?(Ee=Se&&!v.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",We=j.LINES):(Ee=Se?"fillPattern":"fill",We=j.TRIANGLES);for(const Je of S){const dt=_.getTile(Je);if(Se&&!dt.patternsLoaded())continue;const wt=dt.getBucket(v);if(!wt)continue;const qe=t?wt.elevationBufferData:wt.bufferData;if(qe.isEmpty())continue;d.prepareDrawTile();const Re=qe.programConfigurations.get(v.id),tt=d.isTileAffectedByFog(Je),Ye=[],vt=[];J&&(Ye.push("ELEVATED_ROADS"),vt.push(qe.elevatedLayoutVertexBuffer)),se&&Ye.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Se&&(d.context.activeTexture.set(j.TEXTURE0),dt.imageAtlasTexture&&dt.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Re.updatePaintBuffers());let bt=!1;if(K&&dt.imageAtlas){const Yt=dt.imageAtlas,dr=a.dZ.from(K),ur=dr.getPrimary().scaleSelf(a.q.devicePixelRatio).toString(),kr=dr.getSecondary(),Vr=Yt.patternPositions.get(ur),Xr=kr?Yt.patternPositions.get(kr.scaleSelf(a.q.devicePixelRatio).toString()):null;bt=!!Vr&&!!Xr,Vr&&Re.setConstantPatternPositions(Vr,Xr)}q>0&&(bt||Re.getPatternTransitionVertexBuffer("fill-pattern"))&&Ye.push("FILL_PATTERN_TRANSITION");const It=d.getOrCreateProgram(Ee,{config:Re,overrideFog:tt,defines:Ye}),Dt=d.translatePosMatrix(Je.projMatrix,dt,v.paint.get("fill-translate"),v.paint.get("fill-translate-anchor"));se&&Y.setupShadows(dt.tileID.toUnwrapped(),It,"vector-tile");const lr=v.paint.get("fill-emissive-strength");if(Te){Le=qe.lineIndexBuffer,ut=qe.lineSegments;const Yt=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[j.drawingBufferWidth,j.drawingBufferHeight];Ae=Ee==="fillOutlinePattern"&&Se?vs(Dt,lr,d,dt,Yt,pe,q):yd(Dt,lr,Yt,pe)}else Le=qe.indexBuffer,ut=qe.triangleSegments,Ae=Se?uf(Dt,lr,d,dt,pe,q):fc(Dt,lr,pe);d.uploadCommonUniforms(d.context,It,Je.toUnwrapped());let pr=Me;(C==="road"&&!k||C==="offset")&&(pr=ce),It.draw(d,We,pr,s||d.stencilModeForClipping(Je),E,Sr.disabled,Ae,v.id,qe.layoutVertexBuffer,Le,ut,v.paint,d.transform.zoom,Re,vt)}};d.renderPass===L&&Pe(d.depthModeForSublayer(1,d.renderPass==="opaque"?Qt.ReadWrite:Qt.ReadOnly),!1),Z==="none"&&d.renderPass==="translucent"&&v.paint.get("fill-antialias")&&Pe(d.depthModeForSublayer(v.getPaintProperty("fill-outline-color")?2:0,Qt.ReadOnly),!0)}function ws(f,t,s,d,_,v,S,E){s.resetLayerRenderingStats(f);const C=f.context,k=C.gl,L=f.transform,j=s.paint.get("fill-extrusion-pattern"),B=s.paint.get("fill-extrusion-pattern-cross-fade"),q=j.constantOr(null),K=j.constantOr(1),Z=s.paint.get("fill-extrusion-opacity"),J=f.style.enable3dLights(),Y=s.paint.get(J&&!K?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),se=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y],ce=s.layout.get("fill-extrusion-edge-radius"),pe=ce>0&&!s.paint.get("fill-extrusion-rounded-roof"),Se=pe?0:ce,Pe=L.projection.name==="globe"?a.e5():0,Me=L.projection.name==="globe",Te=Me?a.ah(L.zoom):0,Ee=[a.aD(L.center.lng),a.aH(L.center.lat)],Ae=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",We=s.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Ae?null:s.lut).toArray01().slice(0,3),Le=s.paint.get("fill-extrusion-flood-light-intensity"),ut=s.paint.get("fill-extrusion-vertical-scale"),Je=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,dt=s.paint.get("fill-extrusion-height-alignment"),wt=s.paint.get("fill-extrusion-base-alignment"),qe=Va(f,s.paint.get("fill-extrusion-cutoff-fade-range")),Re=[];let tt;Me&&Re.push("PROJECTION_GLOBE_VIEW"),se[0]>0&&Re.push("FAUX_AO"),pe&&Re.push("ZERO_ROOF_RADIUS"),E&&Re.push("HAS_CENTROID"),Le>0&&Re.push("FLOOD_LIGHT"),qe.shouldRenderCutoff&&Re.push("RENDER_CUTOFF"),Je&&Re.push("RENDER_WALL_MODE");const Ye=f.renderPass==="shadow",vt=f.shadowRenderer,bt=Ye&&!!vt,It=Ye?Sr.disabled:Sr.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Dt=[0,0,0];if(vt){const Yt=f.style.directionalLight,dr=f.style.ambientLight;Yt&&dr&&(Dt=Ol(f.style,Yt,dr)),Ye||(Re.push("RENDER_SHADOWS","DEPTH_TEXTURE"),vt.useNormalOffset&&Re.push("NORMAL_OFFSET")),tt=Re.concat(["SHADOWS_SINGLE_CASCADE"])}const lr=bt?"fillExtrusionDepth":K?"fillExtrusionPattern":"fillExtrusion",pr=s.getLayerRenderingStats();for(const Yt of d){const dr=t.getTile(Yt),ur=dr.getBucket(s);if(!ur||ur.projection.name!==L.projection.name)continue;let kr=!1;vt&&(kr=vt.getMaxCascadeForTile(Yt.toUnwrapped())===0);const Vr=f.isTileAffectedByFog(Yt),Xr=ur.programConfigurations.get(s.id);let vn=!1;if(q&&dr.imageAtlas){const _n=dr.imageAtlas,zn=a.dZ.from(q),Mr=zn.getPrimary().scaleSelf(a.q.devicePixelRatio).toString(),Gn=zn.getSecondary(),On=_n.patternPositions.get(Mr),Si=Gn?_n.patternPositions.get(Gn.scaleSelf(a.q.devicePixelRatio).toString()):null;vn=!!On&&!!Si,On&&Xr.setConstantPatternPositions(On,Si)}B>0&&(vn||Xr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Re.push("FILL_EXTRUSION_PATTERN_TRANSITION");const jr=f.getOrCreateProgram(lr,{config:Xr,defines:kr?tt:Re,overrideFog:Vr});if(f.terrain&&f.terrain.setupElevationDraw(dr,jr,{useMeterToDem:!0}),!ur.centroidVertexBuffer){const _n=jr.attributes.a_centroid_pos;_n!==void 0&&k.vertexAttrib2f(_n,0,0)}!Ye&&vt&&vt.setupShadows(dr.tileID.toUnwrapped(),jr,"vector-tile"),K&&(f.context.activeTexture.set(k.TEXTURE0),dr.imageAtlasTexture&&dr.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Xr.updatePaintBuffers());const Sn=s.paint.get("fill-extrusion-vertical-gradient"),Mn=1/ur.tileToMeter;let Xn;if(Ye&&vt){if(wc(dr.tileID,ur.maxHeight,f))continue;const _n=vt.calculateShadowPassMatrixFromTile(dr.tileID.toUnwrapped());Xn=Ll(_n,Se,Mn,ut,dt,wt)}else{const _n=f.translatePosMatrix(Yt.expandedProjMatrix,dr,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),zn=L.projection.createInversionMatrix(L,Yt.canonical);Xn=K?ks(_n,f,Sn,Z,se,Se,Mn,Yt,dr,Pe,dt,wt,Te,Ee,zn,We,ut,B):Ip(_n,f,Sn,Z,se,Se,Mn,Yt,Pe,dt,wt,Te,Ee,zn,We,ut,Le,Dt)}f.uploadCommonUniforms(C,jr,Yt.toUnwrapped(),null,qe);let Gr=ur.segments;if(L.projection.name==="mercator"&&!Ye&&(Gr=ur.getVisibleSegments(dr.tileID,f.terrain,f.transform.getFrustum(0)),!Gr.get().length))continue;if(pr)if(Ye)for(const _n of Gr.get())pr.numRenderedVerticesInShadowPass+=_n.primitiveLength;else for(const _n of Gr.get())pr.numRenderedVerticesInTransparentPass+=_n.primitiveLength;const Tn=[];(f.terrain||E)&&Tn.push(ur.centroidVertexBuffer),Me&&Tn.push(ur.layoutVertexExtBuffer),Je&&Tn.push(ur.wallVertexBuffer),jr.draw(f,C.gl.TRIANGLES,_,v,S,It,Xn,s.id,ur.layoutVertexBuffer,ur.indexBuffer,Gr,s.paint,f.transform.zoom,Xr,Tn)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class Ls{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function da(f,t,s,d,_,v,S,E,C,k,L,j,B,q,K,Z,J,Y,se,ce){const pe=t.context,Se=pe.gl,Pe=t.transform,Me=t.transform.zoom,Te=[],Ee=f.translate,Ae=f.translateAnchor,We=f.edgeRadius,Le=Va(t,f.cutoffFadeRange);L==="clear"?(Te.push("CLEAR_SUBPASS"),ce&&(Te.push("CLEAR_FROM_TEXTURE"),pe.activeTexture.set(Se.TEXTURE0),ce.bind(Se.LINEAR,Se.CLAMP_TO_EDGE))):L==="sdf"&&Te.push("SDF_SUBPASS"),Y&&Te.push("HAS_CENTROID"),Le.shouldRenderCutoff&&Te.push("RENDER_CUTOFF");const ut=(Je,dt,wt,qe,Re)=>{const tt=dt.programConfigurations.get(d.id),Ye=t.isTileAffectedByFog(Je),vt=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:tt,defines:Te,overrideFog:Ye}),bt=((Dt,lr,pr,Yt,dr,ur,kr,Vr,Xr,vn,jr)=>({u_matrix:lr,u_opacity:pr,u_ao_pass:Yt?1:0,u_meter_to_tile:dr,u_ao:ur,u_flood_light_intensity:kr,u_flood_light_color:Vr,u_attenuation:Xr,u_edge_radius:vn,u_fb:0,u_fb_size:jr,u_dynamic_offset:1}))(0,qe,j,k,Re,[B,q*Re],K,Z,J,Me>=17?0:We*Re,ce?ce.size[0]:0),It=[];Y&&It.push(dt.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(pe,vt,Je.toUnwrapped(),null,Le),vt.draw(t,pe.gl.TRIANGLES,v,S,E,C,bt,d.id,dt.vertexBuffer,dt.indexBuffer,wt,d.paint,Me,tt,It)};for(const Je of _){const dt=s.getTile(Je),wt=dt.getBucket(d);if(!wt||wt.projection.name!==Pe.projection.name||!wt.groundEffect||wt.groundEffect&&!wt.groundEffect.hasData())continue;const qe=wt.groundEffect,Re=1/wt.tileToMeter;{const tt=t.translatePosMatrix(Je.projMatrix,dt,Ee,Ae),Ye=qe.getDefaultSegment();ut(Je,qe,Ye,tt,Re)}if(se)for(let tt=0;tt<4;tt++){const Ye=a.e3[tt](Je),vt=s.getTile(Ye);if(!vt)continue;const bt=vt.getBucket(d);if(!bt||bt.projection.name!==Pe.projection.name||!bt.groundEffect||bt.groundEffect&&!bt.groundEffect.hasData())continue;const It=bt.groundEffect;let Dt,lr;tt===0?(Dt=[-a.aj,0,0],lr=1):tt===1?(Dt=[a.aj,0,0],lr=0):tt===2?(Dt=[0,-a.aj,0],lr=3):(Dt=[0,a.aj,0],lr=2);const pr=It.regionSegments[lr];if(!pr)continue;const Yt=new Float32Array(16);a.bo(Yt,Je.projMatrix,Dt),ut(Je,It,pr,t.translatePosMatrix(Yt,dt,Ee,Ae),Re)}}}function br(f,t,s,d,_,v,S){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const E=v?v.findDEMTileFor(s):null;if(!(E&&E.dem||S))return;v&&E&&E.dem&&d.selfDEMTileTimestamp!==E.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=E.dem._timestamp);const C=Y=>new a.P(Math.ceil((Y+a.e7)*a.e8),0),k=Y=>{const se=t.getSource().minzoom,ce=Se=>{const Pe=t.getTileByID(Se);if(Pe&&Pe.hasData())return Pe.getBucket(_)},pe=[0,-1,1];for(const Se of pe){if(Y.overscaledZ+Se<se)continue;const Pe=ce(Y.calculateScaledKey(Y.overscaledZ+Se));if(Pe)return Pe}},L=[0,0,0],j=(Y,se)=>(L[0]=Math.min(Y.min.y,se.min.y),L[1]=Math.max(Y.max.y,se.max.y),L[2]=a.aj-se.min.x>Y.max.x?se.min.x-a.aj:Y.max.x,L),B=(Y,se)=>(L[0]=Math.min(Y.min.x,se.min.x),L[1]=Math.max(Y.max.x,se.max.x),L[2]=a.aj-se.min.y>Y.max.y?se.min.y-a.aj:Y.max.y,L),q=[(Y,se)=>j(Y,se),(Y,se)=>j(se,Y),(Y,se)=>B(Y,se),(Y,se)=>B(se,Y)],K=(Y,se,ce,pe,Se,Pe,Me)=>{if(!v)return 0;const Te=[[Pe?ce:Y,Pe?Y:ce,0],[Pe?ce:se,Pe?se:ce,0]],Ee=Me<0?a.aj+Me:Me,Ae=[Pe?Ee:(Y+se)/2,Pe?(Y+se)/2:Ee,0];return ce===0&&Me<0||ce!==0&&Me>0?v.getForTilePoints(Se,[Ae],!0,pe):Te.push(Ae),v.getForTilePoints(s,Te,!0,E),Math.max(Te[0][2],Te[1][2],Ae[2])/v.exaggeration()};for(let Y=0;Y<4;Y++){const se=d.borderFeatureIndices[Y];if(se.length===0)continue;const ce=a.e3[Y](s),pe=k(ce);if(!(pe&&pe instanceof a.e4))continue;const Se=v?v.findDEMTileFor(ce):null;if(!(Se&&Se.dem||S)||(v&&Se&&Se.dem&&d.borderDEMTileTimestamp[Y]!==Se.dem._timestamp&&(d.borderDoneWithNeighborZ[Y]=-1,d.borderDEMTileTimestamp[Y]=Se.dem._timestamp),d.borderDoneWithNeighborZ[Y]===pe.canonical.z))continue;pe.centroidVertexArray.length===0&&pe.createCentroidsBuffer();const Pe=(Y<2?1:5)-Y,Me=pe.borderDoneWithNeighborZ[Pe]!==d.canonical.z,Te=pe.borderFeatureIndices[Pe];let Ee=0;if(d.canonical.z!==pe.canonical.z){for(const Ae of se)d.showCentroid(d.featuresOnBorder[Ae]);if(Me)for(const Ae of Te)pe.showCentroid(pe.featuresOnBorder[Ae]);d.borderDoneWithNeighborZ[Y]=pe.canonical.z,pe.borderDoneWithNeighborZ[Pe]=d.canonical.z}for(const Ae of se){const We=d.featuresOnBorder[Ae],Le=d.centroidData[We.centroidDataIndex],ut=We.borders[Y];let Je;for(;Ee<Te.length;){Je=pe.featuresOnBorder[Te[Ee]];const dt=Je.borders[Pe];if(dt[1]>ut[0]+3||dt[0]>ut[0]-3)break;pe.showCentroid(Je),Ee++}if(Je&&Ee<Te.length){const dt=Ee;let wt=0;for(;!(Je.borders[Pe][0]>ut[1]-3)&&(wt++,++Ee!==Te.length);)Je=pe.featuresOnBorder[Te[Ee]];Je=pe.featuresOnBorder[Te[dt]];let qe=!1;if(wt>=1){const Ye=Je.borders[Pe];Math.abs(ut[0]-Ye[0])<3&&Math.abs(ut[1]-Ye[1])<3&&(wt=1,qe=!0,Ee=dt+1)}else if(wt===0){d.showCentroid(We);continue}const Re=pe.centroidData[Je.centroidDataIndex];S&&qe&&(((Z=Le).flags|(J=Re).flags)&a.e6?(Z.flags|=a.e6,J.flags|=a.e6):(Z.flags&=~a.e6,J.flags&=~a.e6));const tt=We.intersectsCount()>1||Je.intersectsCount()>1;if(wt>1)Ee=dt,Le.centroidXY=Re.centroidXY=new a.P(0,0);else if(Se&&Se.dem&&!tt){const Ye=q[Y](Le,Re),vt=Y%2?a.aj-1:0,bt=K(Ye[0],Math.min(a.aj-1,Ye[1]),vt,Se,ce,Y<2,Ye[2]);Le.centroidXY=Re.centroidXY=C(bt)}else tt?Le.centroidXY=Re.centroidXY=new a.P(0,0):(Le.centroidXY=d.encodeBorderCentroid(We),Re.centroidXY=pe.encodeBorderCentroid(Je));d.writeCentroidToBuffer(Le),pe.writeCentroidToBuffer(Re)}else d.showCentroid(We)}d.borderDoneWithNeighborZ[Y]=pe.canonical.z,pe.borderDoneWithNeighborZ[Pe]=d.canonical.z}var Z,J;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(f)}const _l=[1,0,0],wd=[0,1,0],Pm=[0,0,1];function wc(f,t,s){const d=s.transform,_=s.shadowRenderer;if(!_)return!0;const v=f.toUnwrapped(),S=d.tileSize*_._cascades[s.currentShadowCascade].scale;let E=t;if(d.elevation){const Z=d.elevation.getMinMaxForTile(f);Z&&(E+=Z.max)}const C=[..._.shadowDirection];C[2]=-C[2];const k=_.computeSimplifiedTileShadowVolume(v,E,S,C);if(!k)return!1;const L=[_l,wd,Pm,C,[C[0],0,C[2]],[0,C[1],C[2]]],j=d.projection.name==="globe",B=d.scaleZoom(S),q=a.cy.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,B,!j),K=_.getCurrentCascadeFrustum();return q.intersectsPrecise(k.vertices,k.planes,L)===0||K.intersectsPrecise(k.vertices,k.planes,L)===0}function gf(f){const{painter:t,source:s,layer:d,coords:_}=f,v=f.defines,S=t.context,E=t.renderPass==="shadow",C=t.renderPass==="light-beam",k=t.shadowRenderer;let L;k&&(L=v.concat(["SHADOWS_SINGLE_CASCADE"]));const j=a.e9(t.transform.center.lat,t.transform.zoom);for(const B of _){const q=s.getTile(B),K=q.getBucket(d);if(!K)continue;let Z=!1;k&&(Z=k.getMaxCascadeForTile(B.toUnwrapped())===0);const J=K.programConfigurations.get(d.id);let Y,se,ce=t.translatePosMatrix(B.expandedProjMatrix,q,[0,0],"map");if(ce=a.cP(a.bz(),ce,[1,1,f.verticalScale]),E&&k){if(wc(q.tileID,K.maxHeight*j,t))continue;let pe=k.calculateShadowPassMatrixFromTile(q.tileID.toUnwrapped());pe=a.cP(a.bz(),pe,[1,1,f.verticalScale]),se=Tu(pe),Y=t.getOrCreateProgram("buildingDepth",{config:J,defines:Z?L:v,overrideFog:!1})}else if(C)Y=t.getOrCreateProgram("buildingBloom",{config:J,defines:Z?L:v,overrideFog:!1}),se=zs(ce);else{const pe=t.transform.calculatePosMatrix(B.toUnwrapped(),t.transform.worldSize);a.cP(pe,pe,[1,1,f.verticalScale]);const Se=a.bz();a.cP(Se,pe,[1,-1,1/j]),a.bi(Se,Se),a.ea(Se,Se),se=Ds(ce,Se),Y=t.getOrCreateProgram("building",{config:J,defines:Z?L:v,overrideFog:!1}),k&&k.setupShadowsFromMatrix(pe,Y,!0)}if(t.uploadCommonUniforms(S,Y,B.toUnwrapped(),null,null),C){const pe=K.bloomGeometry;Y.draw(t,S.gl.TRIANGLES,f.depthMode,Ar.disabled,f.blendMode,Sr.disabled,se,d.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segmentsBucket,d.paint,t.transform.zoom,J,[pe.layoutAttenuationBuffer,pe.layoutColorBuffer])}else Y.draw(t,S.gl.TRIANGLES,f.depthMode,Ar.disabled,f.blendMode,E?Sr.disabled:Sr.backCW,se,d.id,K.layoutVertexBuffer,K.indexBuffer,K.segments,d.paint,t.transform.zoom,J,[K.layoutNormalBuffer,K.layoutColorBuffer])}}function mh(f){return[f[0]*a.eb,f[1]*a.eb,f[2]*a.eb,0]}function us(f,t,s,d,_,v,S,E,C){const k=d.getSource(),L=s.globeSharedBuffers;if(!L)return;let j,B,q;if(t&&(j=d.getTile(t)),k instanceof a.aP?(B=k.texture,q=a.dE(0,0,s.transform)):j&&t&&(B=j.texture,q=a.dE(t.canonical.z,t.canonical.x,s.transform)),!B||!q)return;f||(q=a.cP(a.bz(),q,[1,-1,1]));const K=s.context,Z=K.gl,J=_.paint.get("raster-resampling")==="nearest"?Z.NEAREST:Z.LINEAR,Y=s.colorModeForDrapableLayerRenderPass(v),se=S.defines;se.push("GLOBE_POLES");const ce=new Qt(Z.LEQUAL,Qt.ReadWrite,s.depthRangeFor3D),pe=Float32Array.from(s.transform.expandedFarZProjMatrix),Se=Float32Array.from(a.bh(a.dD(new a.cA(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),K.activeTexture.set(Z.TEXTURE0),B.bind(J,Z.CLAMP_TO_EDGE),K.activeTexture.set(Z.TEXTURE1),B.bind(J,Z.CLAMP_TO_EDGE),"useMipmap"in B&&K.extTextureFilterAnisotropic&&s.transform.pitch>20&&Z.texParameterf(Z.TEXTURE_2D,K.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,K.extTextureFilterAnisotropicMax);const[Pe,Me,Te,Ee]=t?L.getPoleBuffers(t.canonical.z,!1):L.getPoleBuffers(0,!0),Ae=_.paint.get("raster-elevation");let We;f?(We=Pe,s.renderDefaultNorthPole=Ae!==0):(We=Me,s.renderDefaultSouthPole=Ae!==0);const Le=mh(S.mix),ut=((dt,wt,qe,Re,tt,Ye,vt,bt,It,Dt,lr,pr,Yt)=>ss(dt,wt,qe,new Float32Array(16),new Float32Array(9),[0,0],Re,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ye,[0,0],bt,2,Dt,lr,pr,1,0,Yt))(pe,Se,q,a.ah(s.transform.zoom),0,_,0,Ae,0,Le,S.offset,S.range,v),Je=s.getOrCreateProgram("raster",{defines:se});s.uploadCommonUniforms(K,Je,null),Je.draw(s,Z.TRIANGLES,ce,C,Y,E,ut,_.id,We,Te,Ee)}function _f(f){const t=f._nearZ,s=f.projection.farthestPixelDistance(f),d=s-t,_=.2*f.height,v=t+_;return[t,s,(v-_-t)/d,(v-t)/d]}function yf(f,t,s,d){if(f)return t instanceof tu&&f instanceof Ju?t.getTextureDescriptor(f,s,!0):{texture:f.texture,mix:mh(d.mix),offset:d.offset,buffer:0,tileSize:1}}var Mo=a.ec([{name:"a_index",type:"Int16",components:1}]);class vf{constructor(t,s,d,_){const v={width:d[0],height:d[1],data:null},S=t.gl;this.targetColorTexture=new a.T(t,v,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new a.T(t,v,S.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(s,_),this.lastInvalidatedAt=0}updateParticleTexture(t,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,_=s.width*s.height;this.particleTexture0=new a.T(this.context,s,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new a.T(this.context,s,d.RGBA8,{premultiply:!1,useMipmap:!1});const v=new a.ed;v.reserve(_);for(let S=0;S<_;S++)v.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(v,Mo.members,!0),this.particleSegment=a.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=a.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function So(f,t,s){if(!f)return null;const d=t.getTextureDescriptor(f,s,!0);if(!d)return null;let{texture:_,mix:v,offset:S,tileSize:E,buffer:C,format:k}=d;if(!_||!k)return null;let L=!1;return k==="uint32"&&(L=!0,v[3]=0,v=fa(a.ee,v,[0,s.paint.get("raster-particle-max-speed")]),S=Ci(a.ee,S,[0,s.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[C/(E+2*C),E/(E+2*C)],tileSize:E,scalarData:L,scale:v,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[k]]}}function Ul(f){const t=f._nearZ,s=f.projection.farthestPixelDistance(f),d=s-t,_=.2*f.height,v=t+_;return[t,s,(v-_-t)/d,(v-t)/d]}const Sd=new a.am(1,0,0,1),Ji=new a.am(0,1,0,1),gh=new a.am(0,0,1,1),xf=new a.am(1,0,1,1),Td=new a.am(0,1,1,1);function cs(f,t,s,d,_,v){for(let S=0;S<s.length;S++)if(_){const k=new a.am(d.r*.8,d.g*.8,d.b*.8,1);Un(f,t,s[S],d,-1,-1,v),Un(f,t,s[S],d,-1,1,v),Un(f,t,s[S],d,1,1,v),Un(f,t,s[S],d,1,-1,v),Un(f,t,s[S],k,0,0,v)}else Un(f,t,s[S],d,0,0,v)}function Un(f,t,s,d,_,v,S){const E=f.context,C=f.transform,k=E.gl,L=C.projection.name==="globe",j=L?["PROJECTION_GLOBE_VIEW"]:[];let B=a.bw(s.projMatrix);if(L&&a.ah(C.zoom)>0){const Le=a.bg(s.canonical,C),ut=a.ef(Le);B=a.az(new Float32Array(16),C.globeMatrix,ut),a.az(B,C.projMatrix,B)}const q=a.bz();q[12]+=2*_/(a.q.devicePixelRatio*C.width),q[13]+=2*v/(a.q.devicePixelRatio*C.height),a.az(B,q,B);const K=f.getOrCreateProgram("debug",{defines:j}),Z=t.getTileByID(s.key);f.terrain&&f.terrain.setupElevationDraw(Z,K);const J=Qt.disabled,Y=Ar.disabled,se=f.colorModeForRenderPass(),ce="$debug";E.activeTexture.set(k.TEXTURE0),f.emptyTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),L?Z._makeGlobeTileDebugBuffers(f.context,C):Z._makeDebugTileBoundsBuffers(f.context,C.projection);const pe=Z._tileDebugBuffer||f.debugBuffer,Se=Z._tileDebugIndexBuffer||f.debugIndexBuffer,Pe=Z._tileDebugSegments||f.debugSegments;if(K.draw(f,k.LINE_STRIP,J,Y,se,Sr.disabled,cf(B,d.toPremultipliedRenderColor(null)),ce,pe,Se,Pe,null,null,null,[Z._globeTileDebugBorderBuffer]),S){const Le=Z.latestRawTileData,ut=Math.floor((Le&&Le.byteLength||0)/1024);let Je=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Je+=` => ${s.overscaledZ}`),Je+=` ${Z.state}`,Je+=` ${ut}kb`,(function(dt,wt){dt.initDebugOverlayCanvas();const qe=dt.debugOverlayCanvas,Re=dt.context.gl,tt=dt.debugOverlayCanvas.getContext("2d");tt.clearRect(0,0,qe.width,qe.height),tt.shadowColor="white",tt.shadowBlur=2,tt.lineWidth=1.5,tt.strokeStyle="white",tt.textBaseline="top",tt.font="bold 36px Open Sans, sans-serif",tt.fillText(wt,5,5),tt.strokeText(wt,5,5),dt.debugOverlayTexture.update(qe),dt.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)})(f,Je)}const Me=t.getTile(s).tileSize,Te=512/Math.min(Me,512)*(s.overscaledZ/C.zoom)*.5,Ee=Z._tileDebugTextBuffer||f.debugBuffer,Ae=Z._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,We=Z._tileDebugTextSegments||f.debugSegments;K.draw(f,k.TRIANGLES,J,Y,Wr.alphaBlended,Sr.disabled,cf(B,a.am.transparent.toPremultipliedRenderColor(null),Te),ce,Ee,Ae,We,null,null,null,[Z._globeTileDebugTextBuffer])}function Fs(f,t,s,d){ao(f,0,t+s/2,f.transform.width,s,d)}function Hi(f,t,s,d){ao(f,t-s/2,0,s,f.transform.height,d)}function ao(f,t,s,d,_,v){const S=f.context,E=S.gl;E.enable(E.SCISSOR_TEST),E.scissor(t*a.q.devicePixelRatio,s*a.q.devicePixelRatio,d*a.q.devicePixelRatio,_*a.q.devicePixelRatio),S.clear({color:v}),E.disable(E.SCISSOR_TEST)}const No=a.ec([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:bf}=No;function Ss(f,t,s,d){f.emplaceBack(t,s,d)}class Bs{constructor(t){this.vertexArray=new a.eg,this.indices=new a.a_,Ss(this.vertexArray,-1,-1,1),Ss(this.vertexArray,1,-1,1),Ss(this.vertexArray,-1,1,1),Ss(this.vertexArray,1,1,1),Ss(this.vertexArray,-1,-1,-1),Ss(this.vertexArray,1,-1,-1),Ss(this.vertexArray,-1,1,-1),Ss(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,bf),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=a.bd.simpleSegment(0,0,36,12)}}function Ns(f,t,s,d,_,v){const S=f.context.gl,E=t.paint.get("sky-atmosphere-color"),C=t.paint.get("sky-atmosphere-halo-color"),k=t.paint.get("sky-atmosphere-sun-intensity"),L=((j,B,q,K,Z)=>({u_matrix_3f:j,u_sun_direction:B,u_sun_intensity:q,u_color_tint_r:[K.r,K.g,K.b,K.a],u_color_tint_m:[Z.r,Z.g,Z.b,Z.a],u_luminance:5e-5}))(a.ei(a.dJ(),d),_,k,E.toPremultipliedRenderColor(null),C.toPremultipliedRenderColor(null));S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+v,t.skyboxTexture,0),s.draw(f,S.TRIANGLES,Qt.disabled,Ar.disabled,Wr.unblended,Sr.frontCW,L,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const St=a.ec([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Jt{constructor(t){const s=new a.ej;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const d=new a.a_;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(s,St.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=a.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Au=a.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ei{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Ve{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Wr([1,tc,1,tc],a.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Wr([1,0,1,0],a.am.transparent,[!1,!1,!1,!0]),this.params=new Ei,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(t){const s=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Jt(s);const d=this.params.sizeRange,_=this.params.intensityRange,v=(function(L){const j=a.el(30),B=[];for(let q=0;q<L;++q){const K=2*Math.PI*j(),Z=Math.acos(1-2*j())-.5*Math.PI;B.push(a.d2(Math.cos(Z)*Math.cos(K),Math.cos(Z)*Math.sin(K),Math.sin(Z)))}return B})(this.params.starsCount),S=a.el(300),E=new a.ek,C=new a.a_;let k=0;for(let L=0;L<v.length;++L){const j=a.c1([],v[L],200),B=Math.max(0,1+.01*d*(1*S()-.5)),q=Math.max(0,1+.01*_*(1*S()-.5));E.emplaceBack(j[0],j[1],j[2],-1,-1,B,q),E.emplaceBack(j[0],j[1],j[2],1,-1,B,q),E.emplaceBack(j[0],j[1],j[2],1,1,B,q),E.emplaceBack(j[0],j[1],j[2],-1,1,B,q),C.emplaceBack(k+0,k+1,k+2),C.emplaceBack(k+0,k+2,k+3),k+=4}this.starsVx=s.createVertexBuffer(E,Au.members),this.starsIdx=s.createIndexBuffer(C),this.starsSegments=a.bd.simpleSegment(0,0,E.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,s){const d=t.context,_=d.gl,v=t.transform,S=new Qt(_.LEQUAL,Qt.ReadOnly,[0,1]),E=a.ah(v.zoom),C=t.style.getLut(s.scope),k=s.properties.get("color-use-theme")==="none",L=s.properties.get("color").toNonPremultipliedRenderColor(k?null:C).toArray01(),j=s.properties.get("high-color-use-theme")==="none",B=s.properties.get("high-color").toNonPremultipliedRenderColor(j?null:C).toArray01(),q=s.properties.get("space-color-use-theme")==="none",K=s.properties.get("space-color").toNonPremultipliedRenderColor(q?null:C).toArray01(),Z=5e-4,J=a.em(s.properties.get("horizon-blend"),0,1,Z,.25),Y=a.dy(t,d,v)&&J===Z?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,se=t.frameCounter/1e3%1,ce=a.ae(v.globeCenterInViewSpace),pe=Math.sqrt(Math.pow(ce,2)-Math.pow(Y,2)),Se=Math.acos(pe/ce),Pe=Me=>{const Te=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Me&&Te.push("ALPHA_PASS");const Ee=t.getOrCreateProgram("globeAtmosphere",{defines:Te}),Ae=((Le,ut,Je,dt,wt,qe,Re,tt,Ye,vt,bt,It)=>({u_frustum_tl:Le,u_frustum_tr:ut,u_frustum_br:Je,u_frustum_bl:dt,u_horizon:wt,u_transition:qe,u_fadeout_range:Re,u_color:tt,u_high_color:Ye,u_space_color:vt,u_temporal_offset:bt,u_horizon_angle:It}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,E,J,L,B,K,se,Se);t.uploadCommonUniforms(d,Ee);const We=this.atmosphereBuffer;We&&Ee.draw(t,_.TRIANGLES,S,Ar.disabled,Me?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Sr.backCW,Ae,Me?"atmosphere_glow_alpha":"atmosphere_glow",We.vertexBuffer,We.indexBuffer,We.segments)};Pe(!1),Pe(!0)}drawStars(t,s){const d=a.ay(s.properties.get("star-intensity"),0,1);if(d===0)return;const _=t.context,v=_.gl,S=t.transform,E=t.getOrCreateProgram("stars"),C=a.c3([]);a.c5(C,C,-S._pitch),a.c4(C,C,-S.angle),a.c5(C,C,a.al(S._center.lat)),a.en(C,C,-a.al(S._center.lng));const k=a.c8(new Float32Array(16),C),L=a.az([],S.starsProjMatrix,k),j=a.ei([],k),B=a.eo([],j),q=[0,1,0];a.dL(q,q,B),a.c1(q,q,this.params.sizeMultiplier);const K=[1,0,0];a.dL(K,K,B),a.c1(K,K,this.params.sizeMultiplier);const Z=(J=q,Y=K,se=d,{u_matrix:Float32Array.from(L),u_up:J,u_right:Y,u_intensity_multiplier:se});var J,Y,se;t.uploadCommonUniforms(_,E),this.starsVx&&this.starsIdx&&E.draw(t,v.TRIANGLES,Qt.disabled,Ar.disabled,this.colorModeAlphaBlendedWriteRGB,Sr.disabled,Z,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class hs{constructor(){this.visibleTiles=[]}updateBorders(t,s){const d=[],_=[],v=t._getRenderableCoordinates(!1,!0);for(const C of v){const k=t.getTile(C);if(!k.hasData())continue;const L=k.getBucket(s);L&&(L.isEmpty()||(d.push(C.key),_.push({bucket:L,tileID:C.canonical})))}let S=d.length!==this.visibleTiles.length;if(!S){d.sort();for(let C=0;C<d.length;C++)if(d[C]!==this.visibleTiles[C]){S=!0;break}}if(!S)return;const E=new Set;this.visibleTiles=d,_.sort(((C,k)=>C.tileID.z-k.tileID.z||C.tileID.x-k.tileID.x||C.tileID.y-k.tileID.y));for(const C of _){const k=new Array,L=new Array,j=C.bucket;for(const B of j.featuresOnBorder)E.has(B.featureId)?L.push(B.footprintIndex):(E.add(B.featureId),k.push(B.footprintIndex));j.updateFootprintHiddenFlags(k,a.ep,!1),j.updateFootprintHiddenFlags(L,a.ep,!0)}}}function Vl(f,t){const s=[...f],d=t.cameraWorldSizeForFog/t.worldSize,_=a.bx([]);return a.cP(_,_,[d,d,1]),a.az(s,_,s),a.az(s,t.worldToFogMatrix,s),s}function Sc(f,t,s,d,_){const v=s.material,S=d.context,{baseColorTexture:E,metallicRoughnessTexture:C}=v.pbrMetallicRoughness,{normalTexture:k,occlusionTexture:L,emissionTexture:j}=v;function B(K,Z,J){if(K&&(f.push(Z),S.activeTexture.set(S.gl.TEXTURE0+J),K.gfxTexture)){const{minFilter:Y,magFilter:se,wrapS:ce,wrapT:pe}=K.sampler;K.gfxTexture.bindExtraParam(Y,se,ce,pe)}}B(E,"HAS_TEXTURE_u_baseColorTexture",ha.BaseColor),B(C,"HAS_TEXTURE_u_metallicRoughnessTexture",ha.MetallicRoughness),B(k,"HAS_TEXTURE_u_normalTexture",ha.Normal),B(L,"HAS_TEXTURE_u_occlusionTexture",ha.Occlusion),B(j,"HAS_TEXTURE_u_emissionTexture",ha.Emission),_&&(_.texture||(_.texture=new a.et(d.context,_.image,[_.image.height,_.image.height,_.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+ha.LUT),_.texture&&_.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(s.texcoordBuffer)),s.colorBuffer&&(f.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(s.colorBuffer)),s.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(s.normalBuffer)),s.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(s.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||f.push("DIFFUSE_SHADED");const q=d.shadowRenderer;q&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),q.useNormalOffset&&f.push("NORMAL_OFFSET"))}function Pu(f,t,s,d,_,v){const S=s.paint.get("model-opacity").constantOr(1),E=t.context,C=new Qt(t.context.gl.LEQUAL,Qt.ReadWrite,t.depthRangeFor3D),k=t.transform,L=f.mesh,j=L.material,B=j.pbrMetallicRoughness,q=t.style.fog;let K;K=t.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:a.az([],d.zScaleMatrix,f.nodeModelMatrix),a.az(K,d.negCameraPosMatrix,K);const Z=a.bi([],K);a.ea(Z,Z);const J=s.paint.get("model-color-use-theme").constantOr("default")==="none",Y=s.paint.get("model-emissive-strength").constantOr(0),se=_c(new Float32Array(f.worldViewProjection),new Float32Array(K),new Float32Array(Z),null,t,S,B.baseColorFactor,j.emissiveFactor,B.metallicFactor,B.roughnessFactor,j,Y,s),ce={defines:[]},pe=[],Se=t.shadowRenderer;Se&&(Se.useNormalOffset=!1),Sc(ce.defines,pe,L,t,J?null:s.lut);let Pe=null;if(q){const Ee=Vl(f.nodeModelMatrix,t.transform);if(Pe=new Float32Array(Ee),k.projection.name!=="globe"){const Ae=L.aabb.min,We=L.aabb.max,[Le,ut]=q.getOpacityForBounds(Ee,Ae[0],Ae[1],We[0],We[1]);ce.overrideFog=Le>=mt||ut>=mt}}const Me=Va(t,s.paint.get("model-cutoff-fade-range"));Me.shouldRenderCutoff&&ce.defines.push("RENDER_CUTOFF");const Te=t.getOrCreateProgram("model",ce);t.uploadCommonUniforms(E,Te,null,Pe,Me),t.renderPass!=="shadow"&&Se&&Se.setupShadowsFromMatrix(f.nodeModelMatrix,Te),Te.draw(t,E.gl.TRIANGLES,C,_,v,L.material.doubleSided?Sr.disabled:Sr.backCCW,se,s.id,L.vertexBuffer,L.indexBuffer,L.segments,s.paint,t.transform.zoom,void 0,pe)}function Ed(f,t,s,d,_,v,S){let E;E=f.projection.name==="globe"?a.er(s,f):[...s],a.az(E,E,t.matrix);const C=a.az([],d,E);if(t.meshes)for(const k of t.meshes){if(k.material.alphaMode!=="BLEND"){S.push({mesh:k,depth:0,modelIndex:_,worldViewProjection:C,nodeModelMatrix:E});continue}const L=a.ad([],k.centroid,C);!f.isOrthographic&&L[2]<=0||v.push({mesh:k,depth:L[2],modelIndex:_,worldViewProjection:C,nodeModelMatrix:E})}if(t.children)for(const k of t.children)Ed(f,k,s,d,_,v,S)}function wf(f,t,s,d){const _=s.shadowRenderer;if(!_)return;const v=_.getShadowPassDepthMode(),S=_.getShadowPassColorMode(),E=_.calculateShadowPassMatrixFromMatrix(t),C=df(E);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,v,Ar.disabled,S,Sr.backCCW,C,d.id,f.vertexBuffer,f.indexBuffer,f.segments,d.paint,s.transform.zoom,void 0,void 0)}function Tc(f,t,s){const d=t.updateZoomBasedPaintProperties(),_=(function(v,S,E){let C,k,L,j=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&j>0){const B=v.terrain,q=B.findDEMTileFor(E);q&&q.dem?C=a.eu.create(B,E,q):j=0}if(j===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),j===S.validForExaggeration&&(j===0||C&&C._demTile&&C._demTile.tileID===S.validForDEMTile.id&&C._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const B in S.instancesPerModel){const q=S.instancesPerModel[B];for(let K=0;K<q.instancedDataArray.length;++K){const Z=(C?j*C.getElevationAt(0|q.instancedDataArray.float32[16*K],0|q.instancedDataArray.float32[16*K+1],!0,!0):0)+q.instancesEvaluatedElevation[K];q.instancedDataArray.float32[16*K+6]=Z,k=k?Math.min(S.terrainElevationMin,Z):Z,L=L?Math.max(S.terrainElevationMax,Z):Z}}return S.terrainElevationMin=k||0,S.terrainElevationMax=L||0,S.validForExaggeration=j,S.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0})(f,t,s);(d||_)&&(t.uploaded=!1,t.upload(f.context))}const js={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new a.d6([0,0,0],[a.aj,a.aj,0])};function Im(f,t){const s=1<<f.canonical.z,d=t.getFreeCameraOptions().position,_=t.elevation,v=f.canonical.x/s,S=(f.canonical.x+1)/s,E=f.canonical.y/s,C=(f.canonical.y+1)/s;let k=t._centerAltitude;if(_){const q=_.getMinMaxForTile(f);q&&q.max>k&&(k=q.max)}const L=a.ay(d.x,v,S)-d.x,j=a.ay(d.y,E,C)-d.y,B=a.cb(k,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(L*L+j*j+B*B))}function Ad(f,t,s,d,_,v,S){const E=f.context,C=f.renderPass==="shadow",k=f.shadowRenderer,L=C&&k?k.getShadowPassDepthMode():new Qt(E.gl.LEQUAL,Qt.ReadWrite,f.depthRangeFor3D),j=f.isTileAffectedByFog(v);if(s.meshes)for(const B of s.meshes){const q=["MODEL_POSITION_ON_GPU"],K=[];let Z,J,Y;d.instancedDataArray.length>20&&q.push("INSTANCED_ARRAYS");const se=Va(f,t.paint.get("model-cutoff-fade-range"));if(se.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),C&&k)Z=f.getOrCreateProgram("modelDepth",{defines:q}),J=df(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(s.matrix)),Y=k.getShadowPassColorMode();else{Sc(q,K,B,f,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),Z=f.getOrCreateProgram("model",{defines:q,overrideFog:j});const pe=B.material,Se=pe.pbrMetallicRoughness,Pe=t.paint.get("model-opacity").constantOr(1),Me=t.paint.get("model-emissive-strength").constantOr(0);J=_c(v.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,f,Pe,Se.baseColorFactor,pe.emissiveFactor,Se.metallicFactor,Se.roughnessFactor,pe,Me,t,_),k&&(S.shadowUniformsInitialized?Z.setShadowUniformValues(E,k.getShadowUniformValues()):(k.setupShadows(v.toUnwrapped(),Z,"model-tile"),S.shadowUniformsInitialized=!0)),Y=se.shouldRenderCutoff||Pe<1||pe.alphaMode!=="OPAQUE"?Wr.alphaBlended:Wr.unblended}f.uploadCommonUniforms(E,Z,v.toUnwrapped(),null,se);const ce=B.material.doubleSided?Sr.disabled:Sr.backCCW;if(d.instancedDataArray.length>20)K.push(d.instancedDataBuffer),Z.draw(f,E.gl.TRIANGLES,L,Ar.disabled,Y,ce,J,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,f.transform.zoom,void 0,K,d.instancedDataArray.length);else{const pe=C?"u_instance":"u_normal_matrix";for(let Se=0;Se<d.instancedDataArray.length;++Se)J[pe]=new Float32Array(d.instancedDataArray.arrayBuffer,64*Se,16),Z.draw(f,E.gl.TRIANGLES,L,Ar.disabled,Y,ce,J,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,f.transform.zoom,void 0,K)}}if(s.children)for(const B of s.children)Ad(f,t,B,d,_,v,S)}const Sf=[1,-1,1];function Pd(f,t,s,d){if(!s.modelManager)return!0;const _=s.modelManager;if(!s.shadowRenderer)return!0;const v=s.shadowRenderer,S=t.aabb;let E=!0,C=f.maxHeight;if(C===0){let L=0;for(const j in f.instancesPerModel){const B=_.getModel(j,d);B?L=Math.max(L,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):E=!1}C=f.maxScale*L*1.41+f.maxVerticalOffset,E&&(f.maxHeight=C)}S.max[2]=C,S.min[2]+=f.terrainElevationMin,S.max[2]+=f.terrainElevationMax,a.ad(S.min,S.min,t.tileMatrix),a.ad(S.max,S.max,t.tileMatrix);const k=S.intersects(v.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=k===2),k===0}function _h(f,t){const s=f.uniformValues.u_cutoff_params[0],d=f.uniformValues.u_cutoff_params[1],_=f.uniformValues.u_cutoff_params[2],v=f.uniformValues.u_cutoff_params[3];return d===s||v===_?1:a.ay(((t-s)/(d-s)-_)/(v-_),0,1)}function Op(f,t,s,d){if(t.pitch<20)return 1;const _=t.getWorldToCameraMatrix();a.az(_,_,f);const v=a.bR(s.min[0],s.min[1],s.min[2],1);let S=a.aA(a.ev(),v,_),E=S,C=S;v[1]=s.max[1],S=a.aA(a.ev(),v,_),E=S[1]<E[1]?S:E,C=S[1]>C[1]?S:C,v[0]=s.max[0],S=a.aA(a.ev(),v,_),E=S[1]<E[1]?S:E,C=S[1]>C[1]?S:C,v[1]=s.min[1],S=a.aA(a.ev(),v,_),E=S[1]<E[1]?S:E,C=S[1]>C[1]?S:C;const k=a.ay(d[0],0,1),L=100*t.pixelsPerMeter*a.ay(d[1],0,1),j=a.ay(d[2],0,1),B=a.ew(a.ev(),E,C,k),q=Math.tan(.5*t.fovX),K=-B[2]*q;if(L===0)return B[1]<-Math.abs(K)?j:1;const Z=(-Math.abs(K)-B[1])/L,J=(se,ce,pe)=>(1-pe)*se+pe*ce,Y=a.ay(J(1,j,Z),j,1);return J(1,Y,a.ay((t.pitch-20)/20,0,1))}class Ec{}class Iu{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,s,d){{const j=this._storage.get(s.id);if(j)return j.lastUsedFrameIdx=t,j.buf}const _=d.gl,v=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),S=new ArrayBuffer(v),E=new Int16Array(S);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const C=new a.ey;for(let j=0;j<v/2;j+=3){const B=E[j],q=E[j+1],K=E[j+2];C.emplaceBack(B,q),C.emplaceBack(q,K),C.emplaceBack(K,B)}const k=d.bindVertexArrayOES.current,L=new Ec;return L.buf=new Nl(d,C),L.lastUsedFrameIdx=t,this._storage.set(s.id,L),d.bindVertexArrayOES.set(k),L.buf}update(t){for(const[s,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(s))}destroy(){for(const[t,s]of this._storage)s.buf.destroy(),this._storage.delete(t)}}class Ac{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Id=a.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Cm{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Wo{constructor(t,s){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...s,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...s,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Mm=a.ec([{type:"Float32",name:"a_pos_2f",components:2}]);class yh{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,s){const d=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const S=new a.ez,E=new a.a_;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(1,1),S.emplaceBack(-1,1),E.emplaceBack(0,1,2),E.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(S,Mm.members),this.vignetteIdx=t.context.createIndexBuffer(E)}const _=a.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,d);const S={u_vignetteShape:(v={vignetteShape:[s.start,s.range,Math.pow(10,s.fadePower)],vignetteColor:[s.color.r,s.color.g,s.color.b,s.color.a*s.strength]}).vignetteShape,u_vignetteColor:v.vignetteColor};d.draw(t,t.context.gl.TRIANGLES,Qt.disabled,Ar.disabled,Wr.alphaBlended,Sr.disabled,S,"vignette",this.vignetteVx,this.vignetteIdx,_)}var v}}class ni{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,s){const d=t.getFreeCameraOptions().position,_=d.toAltitude(),v=d.toLngLat(),S=a.al(v.lng),E=a.al(v.lat),C=t.pixelsPerMeter/s,k=S*a.eB,L=a.eB*Math.log(Math.tan(Math.PI/4+E/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const j=-this._offsetYPrev+L,B=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+k)*C,this._accumulatedOffsetY+=j*C,this._accumulatedElevation+=B*C,this._offsetXPrev=k,this._offsetYPrev=L,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function mn(f,t){return[-(f[0]-Math.floor(f[0]/t)*t),-(f[1]-Math.floor(f[1]/t)*t),-(f[2]-Math.floor(f[2]/t)*t)]}function Cd(f){const t=a.el(1323123451230),s=[];for(let d=0;d<f;++d){const _=2*t()-1,v=2*t()-1,S=2*t()-1;s.push(a.d2(_,v,S))}return s}function pa(f,t,s,d,_){const v=a.ay((_-s)/(d-s),0,1);return(1-v)*f+v*t}class vh{constructor(t){this._movement=new ni,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new yh,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,s){const d=t.transform;this._movement.update(d,this._ppmScaleFactor);const _=d.starsProjMatrix,v=a.c3([]);a.c5(v,v,a.al(90)-d._pitch),a.c4(v,v,-d.angle);const S=a.c8(new Float32Array(16),v),E=a.eA(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),C=a.ea([],E),k=a.az([],C,S),L=Date.now()/1e3;return this._accumulatedTimeFromStart+=(L-this._prevTime)*s,this._prevTime=L,{projectionMatrix:_,modelviewMatrix:k}}}class Pc extends vh{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Wo(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const d=Cd(this.particlesCount),_=new a.eC,v=new a.a_;let S=0;const E=a.el(1323123451230);for(let C=0;C<d.length;++C){const k=d[C],L=[2*E()-1,E(),E(),E()];_.emplaceBack(k[0],k[1],k[2],-1,-1,...L),_.emplaceBack(k[0],k[1],k[2],1,-1,...L),_.emplaceBack(k[0],k[1],k[2],1,1,...L),_.emplaceBack(k[0],k[1],k[2],-1,1,...L),v.emplaceBack(S+0,S+1,S+2),v.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=s.createVertexBuffer(_,Id.members),this.particlesIdx=s.createIndexBuffer(v)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const s=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=t.transform.zoom;if(s.revealStart>d)return;const _=pa(0,1,s.revealStart,s.revealStart+s.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const v=structuredClone(this._params);let S=[-v.direction.x,v.direction.y,-100];a.au(S,S);const E=structuredClone(this._vignetteParams);E.strength*=_,v.overrideStyleParameters||(v.intensity=t.style.rain.state.density,v.timeFactor=t.style.rain.state.intensity,v.color=structuredClone(t.style.rain.state.color),S=structuredClone(t.style.rain.state.direction),v.screenThinning.intensity=t.style.rain.state.centerThinning,v.dropletSizeX=t.style.rain.state.dropletSize[0],v.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],v.distortionStrength=100*t.style.rain.state.distortionStrength,E.strength=1,E.color=structuredClone(t.style.rain.state.vignetteColor));const C=this.updateOnRender(t,v.timeFactor),k=t.context,L=k.gl,j=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new a.T(k,{width:t.width,height:t.height,data:null},L.RGBA8)),v.distortionStrength>0&&(k.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),L.copyTexSubImage2D(L.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const B=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(k,B),k.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const q=[v.color.r,v.color.g,v.color.b,v.color.a],K=(Z,J)=>{const Y=mn(this._movement.getPosition(),Z),se=v.dropletSizeX,ce=v.dropletSizeX*v.dropletSizeYScale,pe=t.width/2,Se=t.height/2,Pe=pa(0,v.screenThinning.start,0,1,v.screenThinning.intensity),Me=pa(.001,v.screenThinning.range,0,1,v.screenThinning.intensity),Te=pa(0,v.screenThinning.particleOffset,0,1,v.screenThinning.intensity),Ee=(Ae={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Y,velocityConeAperture:v.velocityConeAperture,velocity:v.velocity,boxSize:Z,rainDropletSize:[se,ce],distortionStrength:v.distortionStrength,rainDirection:S,color:q,screenSize:[j.width,j.height],thinningCenterPos:[pe,Se],thinningShape:[Pe,Me,Math.pow(10,v.screenThinning.fadePower)],thinningAffectedRatio:v.screenThinning.affectedRatio,thinningParticleOffset:Te,shapeDirectionalPower:v.shapeDirPower,shapeNormalPower:v.shapeNormalPower,mode:J?0:1},{u_modelview:Float32Array.from(Ae.modelview),u_projection:Float32Array.from(Ae.projection),u_time:Ae.time,u_cam_pos:Ae.camPos,u_texScreen:0,u_velocityConeAperture:Ae.velocityConeAperture,u_velocity:Ae.velocity,u_boxSize:Ae.boxSize,u_rainDropletSize:Ae.rainDropletSize,u_distortionStrength:Ae.distortionStrength,u_rainDirection:Ae.rainDirection,u_color:Ae.color,u_screenSize:Ae.screenSize,u_thinningCenterPos:Ae.thinningCenterPos,u_thinningShape:Ae.thinningShape,u_thinningAffectedRatio:Ae.thinningAffectedRatio,u_thinningParticleOffset:Ae.thinningParticleOffset,u_shapeDirectionalPower:Ae.shapeDirectionalPower,u_shapeNormalPower:Ae.shapeNormalPower,u_mode:Ae.mode});var Ae;const We=Math.round(v.intensity*this.particlesCount),Le=a.bd.simpleSegment(0,0,4*We,2*We);B.draw(t,L.TRIANGLES,Qt.disabled,Ar.disabled,Wr.alphaBlended,Sr.disabled,Ee,"rain_particles",this.particlesVx,this.particlesIdx,Le)};v.distortionStrength>0&&K(v.boxSize,!0),K(v.boxSize,!1),this._vignette.draw(t,E)}}const Ic=a.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Rp extends vh{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Wo(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const d=Cd(this.particlesCount),_=new a.eD,v=new a.a_;let S=0;const E=a.el(1323123451230);for(let C=0;C<d.length;++C){const k=d[C],L=E(),j=E(),B=E(),q=[C/d.length,L,j,B],K=[E(),E()];_.emplaceBack(k[0],k[1],k[2],-1,-1,...q,...K),_.emplaceBack(k[0],k[1],k[2],1,-1,...q,...K),_.emplaceBack(k[0],k[1],k[2],1,1,...q,...K),_.emplaceBack(k[0],k[1],k[2],-1,1,...q,...K),v.emplaceBack(S+0,S+1,S+2),v.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=s.createVertexBuffer(_,Ic.members),this.particlesIdx=s.createIndexBuffer(v)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const s=structuredClone(this._params);let d=[-s.direction.x,s.direction.y,-100];a.au(d,d);const _=structuredClone(this._vignetteParams),v=s.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},S=t.transform.zoom;if(v.revealStart>S)return;const E=pa(0,1,v.revealStart,v.revealStart+v.revealRange,S);_.strength*=E,s.overrideStyleParameters||(s.intensity=t.style.snow.state.density,s.timeFactor=t.style.snow.state.intensity,s.color=structuredClone(t.style.snow.state.color),d=structuredClone(t.style.snow.state.direction),s.screenThinning.intensity=t.style.snow.state.centerThinning,s.billboardSize=2.79*t.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(t.style.snow.state.vignetteColor));const C=this.updateOnRender(t,s.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const k=t.context,L=k.gl,j=t.transform,B=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(k,B),((q,K,Z)=>{const J=mn(this._movement.getPosition(),q),Y=j.width/2,se=j.height/2,ce=pa(0,Z.screenThinning.start,0,1,Z.screenThinning.intensity),pe=pa(.001,Z.screenThinning.range,0,1,Z.screenThinning.intensity),Se=pa(0,Z.screenThinning.particleOffset,0,1,Z.screenThinning.intensity),Pe=(Me={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:J,velocityConeAperture:Z.velocityConeAperture,velocity:Z.velocity,horizontalOscillationRadius:Z.horizontalOscillationRadius,horizontalOscillationRate:Z.horizontalOscillationRate,boxSize:q,billboardSize:1*Z.billboardSize,simpleShapeParameters:[Z.shapeFadeStart,Z.shapeFadePower],screenSize:[j.width,j.height],thinningCenterPos:[Y,se],thinningShape:[ce,pe,Math.pow(10,Z.screenThinning.fadePower)],thinningAffectedRatio:Z.screenThinning.affectedRatio,thinningParticleOffset:Se,color:[Z.color.r,Z.color.g,Z.color.b,Z.color.a],direction:d},{u_modelview:Float32Array.from(Me.modelview),u_projection:Float32Array.from(Me.projection),u_time:Me.time,u_cam_pos:Me.camPos,u_velocityConeAperture:Me.velocityConeAperture,u_velocity:Me.velocity,u_horizontalOscillationRadius:Me.horizontalOscillationRadius,u_horizontalOscillationRate:Me.horizontalOscillationRate,u_boxSize:Me.boxSize,u_billboardSize:Me.billboardSize,u_simpleShapeParameters:Me.simpleShapeParameters,u_screenSize:Me.screenSize,u_thinningCenterPos:Me.thinningCenterPos,u_thinningShape:Me.thinningShape,u_thinningAffectedRatio:Me.thinningAffectedRatio,u_thinningParticleOffset:Me.thinningParticleOffset,u_particleColor:Me.color,u_direction:Me.direction});var Me;const Te=Math.round(Z.intensity*this.particlesCount),Ee=a.bd.simpleSegment(0,0,4*Te,2*Te);this.particlesVx&&this.particlesIdx&&B.draw(t,L.TRIANGLES,Qt.disabled,Ar.disabled,Wr.alphaBlended,Sr.disabled,Pe,"snow_particles",this.particlesVx,this.particlesIdx,Ee)})(s.boxSize,0,s),this._vignette.draw(t,_)}}const Md={symbol:function(f,t,s,d,_){if(f.renderPass!=="translucent")return;const v=Ar.disabled,S=f.colorModeForRenderPass(),E=s.layout.get("text-variable-anchor"),C=s.layout.get("text-size-scale-range"),k=a.ay(f.scaleFactor,C[0],C[1]);E&&(function(B,q,K,Z,J,Y,se,ce){const pe=q.transform,Se=J==="map",Pe=Y==="map";for(const Me of B){const Te=Z.getTile(Me),Ee=Te.getBucket(K);if(!Ee||!Ee.text||!Ee.text.segments.get().length)continue;const Ae=a.bH(Ee.textSizeData,pe.zoom,ce),We=El(Me,Ee.getProjection(),pe),Le=pe.calculatePixelsToTileUnitsMatrix(Te),ut=uu(We,Te.tileID.canonical,Pe,Se,pe,Ee.getProjection(),Le),Je=Ee.hasIconTextFit()&&Ee.hasIconData();Ae&&xc(Ee,Se,Pe,se,pe,ut,Me,Math.pow(2,pe.zoom-Te.tileID.overscaledZ),Ae,Je)}})(d,f,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),_,k);const L=s.paint.get("icon-opacity").constantOr(1)!==0,j=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(L||j)?qa(f,t,s,d,v,S):(L&&qa(f,t,s,d,v,S,{onlyIcons:!0}),j&&qa(f,t,s,d,v,S,{onlyText:!0})),t.map.showCollisionBoxes&&(pf(f,t,s,d,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),pf(f,t,s,d,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(f,t,s,d){if(f.renderPass!=="translucent")return;const _=s.paint.get("circle-opacity"),v=s.paint.get("circle-stroke-width"),S=s.paint.get("circle-stroke-opacity"),E=s.layout.get("circle-sort-key").constantOr(1)!==void 0,C=s.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(v.constantOr(1)===0||S.constantOr(1)===0))return;const k=f.context,L=k.gl,j=f.transform,B=!(!f.terrain||!f.terrain.enabled),q=s.layout.get("circle-elevation-reference"),K=f.depthModeForSublayer(0,Qt.ReadOnly),Z=new Qt(f.context.gl.LEQUAL,Qt.ReadOnly,f.depthRangeFor3D),J=q==="none"||B?K:Z,Y=Ar.disabled,se=f.colorModeForDrapableLayerRenderPass(C),ce=j.projection.name==="globe",pe=[a.aD(j.center.lng),a.aH(j.center.lat)],Se=[];for(let Me=0;Me<d.length;Me++){const Te=d[Me],Ee=t.getTile(Te),Ae=Ee.getBucket(s);if(!Ae||Ae.projection.name!==j.projection.name)continue;const We=Ae.programConfigurations.get(s.id),Le=Ae.layoutVertexBuffer,ut=Ae.globeExtVertexBuffer,Je=Ae.indexBuffer,dt=a.dW(s),wt=[ut],qe=f.isTileAffectedByFog(Te);ce&&dt.push("PROJECTION_GLOBE_VIEW"),dt.push("DEPTH_D24"),f.terrain&&j.depthOcclusionForSymbolsAndCircles&&dt.push("DEPTH_OCCLUSION"),Ae.hasElevation&&!f.terrain&&(dt.push("ELEVATED_ROADS"),wt.push(Ae.elevatedLayoutVertexBuffer));const Re=f.getOrCreateProgram("circle",{config:We,defines:dt,overrideFog:qe}),tt=j.projection.createInversionMatrix(j,Te.canonical),Ye={programConfiguration:We,program:Re,layoutVertexBuffer:Le,dynamicBuffers:wt,indexBuffer:Je,uniformValues:a.dX(f,Te,Ee,tt,pe,s),tile:Ee};if(E){const vt=Ae.segments.get();for(const bt of vt)Se.push({segments:new a.bd([bt]),sortKey:bt.sortKey,state:Ye})}else Se.push({segments:Ae.segments,sortKey:0,state:Ye})}E&&Se.sort(((Me,Te)=>Me.sortKey-Te.sortKey));const Pe={useDepthForOcclusion:j.depthOcclusionForSymbolsAndCircles};for(const Me of Se){const{programConfiguration:Te,program:Ee,layoutVertexBuffer:Ae,dynamicBuffers:We,indexBuffer:Le,uniformValues:ut,tile:Je}=Me.state,dt=Me.segments;f.terrain&&f.terrain.setupElevationDraw(Je,Ee,Pe),f.uploadCommonUniforms(k,Ee,Je.tileID.toUnwrapped()),Ee.draw(f,L.TRIANGLES,J,Y,se,Sr.disabled,ut,s.id,Ae,Le,dt,s.paint,j.zoom,Te,We)}},heatmap:function(f,t,s,d){if(s.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const _=f.context,v=_.gl,S=Ar.disabled,E=new Wr([v.ONE,v.ONE,v.ONE,v.ONE],a.am.transparent,[!0,!0,!0,!0]);(function(q,K,Z,J){const Y=q.gl,se=K.width*J,ce=K.height*J;q.activeTexture.set(Y.TEXTURE1),q.viewport.set([0,0,se,ce]);let pe=Z.heatmapFbo;if(!pe||pe&&(pe.width!==se||pe.height!==ce)){pe&&pe.destroy();const Se=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,Se),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),pe=Z.heatmapFbo=q.createFramebuffer(se,ce,!0,null),(function(Pe,Me,Te,Ee,Ae,We){const Le=Pe.gl;Le.texImage2D(Le.TEXTURE_2D,0,Pe.extRenderToTextureHalfFloat?Le.RGBA16F:Le.RGBA,Ae,We,0,Le.RGBA,Pe.extRenderToTextureHalfFloat?Le.HALF_FLOAT:Le.UNSIGNED_BYTE,null),Ee.colorAttachment.set(Te)})(q,0,Se,pe,se,ce)}else Y.bindTexture(Y.TEXTURE_2D,pe.colorAttachment.get()),q.bindFramebuffer.set(pe.framebuffer)})(_,f,s,f.transform.projection.name==="globe"?.5:.25),_.clear({color:a.am.transparent});const C=f.transform,k=C.projection.name==="globe",L=k?["PROJECTION_GLOBE_VIEW"]:[],j=k?Sr.frontCCW:Sr.disabled,B=[a.aD(C.center.lng),a.aH(C.center.lat)];for(let q=0;q<d.length;q++){const K=d[q];if(t.hasRenderableParent(K))continue;const Z=t.getTile(K),J=Z.getBucket(s);if(!J||J.projection.name!==C.projection.name)continue;const Y=f.isTileAffectedByFog(K),se=J.programConfigurations.get(s.id),ce=f.getOrCreateProgram("heatmap",{config:se,defines:L,overrideFog:Y}),{zoom:pe}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Z,ce),f.uploadCommonUniforms(_,ce,K.toUnwrapped());const Se=C.projection.createInversionMatrix(C,K.canonical);ce.draw(f,v.TRIANGLES,Qt.disabled,S,E,j,$a(f,K,Z,Se,B,pe,s.paint.get("heatmap-intensity")),s.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,s.paint,f.transform.zoom,se,k?[J.globeExtVertexBuffer]:null)}_.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),(function(_,v){const S=_.context,E=S.gl,C=v.heatmapFbo;if(!C)return;S.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment.get()),S.activeTexture.set(E.TEXTURE1);let k=v.colorRampTexture;k||(k=v.colorRampTexture=new a.T(S,v.colorRamp,E.RGBA8)),k.bind(E.LINEAR,E.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,E.TRIANGLES,Qt.disabled,Ar.disabled,_.colorModeForRenderPass(),Sr.disabled,((L,j,B,q)=>({u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}))(0,v),v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)})(f,s))},line:function(f,t,s,d){if(f.renderPass!=="translucent")return;const _=s.paint.get("line-opacity"),v=s.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;const S=s.paint.get("line-emissive-strength"),E=s.paint.get("line-occlusion-opacity"),C=s.layout.get("line-elevation-reference"),k=s.layout.get("line-width-unit")==="meters",L=C==="sea",j=!(!f.terrain||!f.terrain.enabled),B=f.context,q=B.gl;if(s.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const K=s.layout.get("line-cross-slope"),Z=K!==void 0,J=K<1,Y=f.colorModeForDrapableLayerRenderPass(S),se=f.terrain&&f.terrain.renderingToTexture,ce=se?1:a.q.devicePixelRatio,pe=s.paint.get("line-dasharray"),Se=pe.constantOr(1),Pe=s.layout.get("line-cap"),Me=pe.constantOr(null),Te=Pe.constantOr(null),Ee=s.paint.get("line-pattern"),Ae=Ee.constantOr(1),We=s.paint.get("line-pattern-cross-fade"),Le=Ee.constantOr(null),ut=s.paint.get("line-opacity").constantOr(1);let Je=!Ae&&ut!==1||f.depthOcclusion&&E>0&&E<1;const dt=s.paint.get("line-gradient"),wt=Ae?"linePattern":"line",qe=a.dY(s);let Re;if(se&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(Je=!1),E!==0&&f.depthOcclusion){const bt=s.paint._values["line-opacity"];bt&&bt.value&&bt.value.kind==="constant"?Re=bt.value:a.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}v.value.kind!=="constant"&&v.value.isLineProgressConstant===!1&&qe.push("VARIABLE_LINE_WIDTH");const tt=(bt,It,Dt,lr,pr,Yt)=>{for(const dr of bt){const ur=t.getTile(dr);if(Ae&&!ur.patternsLoaded())continue;const kr=ur.getBucket(s);if(!kr||kr.elevationType!=="none"&&!pr||kr.elevationType==="none"&&pr)continue;f.prepareDrawTile();const Vr=[...It],Xr=f.shadowRenderer,vn=kr.elevationType==="road"&&!!Xr&&Xr.enabled;let jr=[0,0,0];if(vn){const xn=f.style.directionalLight,Ln=f.style.ambientLight;xn&&Ln&&(jr=Ol(f.style,xn,Ln)),Vr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Sn=kr.programConfigurations.get(s.id);let Mn=!1;if(Le&&ur.imageAtlas){const xn=a.dZ.from(Le),Ln=xn.getPrimary().scaleSelf(ce).toString(),Wn=ur.imageAtlas.patternPositions.get(Ln),qi=xn.getSecondary(),ti=qi?ur.imageAtlas.patternPositions.get(qi.scaleSelf(ce).toString()):null;Mn=!!Wn&&!!ti,Wn&&Sn.setConstantPatternPositions(Wn,ti)}We>0&&(Mn||Sn.getPatternTransitionVertexBuffer("line-pattern"))&&Vr.push("LINE_PATTERN_TRANSITION");const Xn=f.isTileAffectedByFog(dr),Gr=f.getOrCreateProgram(wt,{config:Sn,defines:Vr,overrideFog:Xn});if(!Ae&&Me&&Te&&ur.lineAtlas){const xn=ur.lineAtlas.getDash(Me,Te);xn&&Sn.setConstantPatternPositions(xn)}vn&&Xr.setupShadows(ur.tileID.toUnwrapped(),Gr,"vector-tile");let[Tn,_n]=s.paint.get("line-trim-offset");(Te==="round"||Te==="square")&&Tn!==_n&&(Tn===0&&(Tn-=1),_n===1&&(_n+=1));const zn=se?dr.projMatrix:null,Mr=k?1/kr.tileToMeter/a.aw(ur,1,f.transform.zoom):1,Gn=k?1/kr.tileToMeter/a.aw(ur,1,Math.floor(f.transform.zoom)):1,On=Ae?a.d_(f,ur,s,zn,ce,Mr,Gn,[Tn,_n],jr,We):a.d$(f,ur,s,zn,kr.lineClipsArray.length,ce,Mr,Gn,[Tn,_n],jr);if(dt){const xn=kr.gradients[s.id];let Ln=xn.texture;if(s.gradientVersion!==xn.version){let Wn=256;if(s.stepInterpolant){const qi=t.getSource().maxzoom,ti=dr.canonical.z===qi?Math.ceil(1<<f.transform.maxZoom-dr.canonical.z):1;Wn=a.ay(a.e0(kr.maxLineLength/a.aj*1024*ti),256,B.maxTextureSize)}xn.gradient=a.e1({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Wn,image:xn.gradient||void 0,clips:kr.lineClipsArray}),xn.texture?xn.texture.update(xn.gradient):xn.texture=new a.T(B,xn.gradient,q.RGBA8),xn.version=s.gradientVersion,Ln=xn.texture}B.activeTexture.set(q.TEXTURE1),Ln.bind(s.stepInterpolant?q.NEAREST:q.LINEAR,q.CLAMP_TO_EDGE)}Se&&(B.activeTexture.set(q.TEXTURE0),ur.lineAtlasTexture&&ur.lineAtlasTexture.bind(q.LINEAR,q.REPEAT),Sn.updatePaintBuffers()),Ae&&(B.activeTexture.set(q.TEXTURE0),ur.imageAtlasTexture&&ur.imageAtlasTexture.bind(q.LINEAR,q.CLAMP_TO_EDGE),Sn.updatePaintBuffers()),pr&&!L&&f.terrain.setupElevationDraw(ur,Gr),f.uploadCommonUniforms(B,Gr,dr.toUnwrapped());const Si=xn=>{Re!=null&&(Re.value=ut*E),Gr.draw(f,q.TRIANGLES,Dt,xn,Y,Sr.disabled,On,s.id,kr.layoutVertexBuffer,kr.indexBuffer,kr.segments,s.paint,f.transform.zoom,Sn,[kr.layoutVertexBuffer2,kr.patternVertexBuffer,kr.zOffsetVertexBuffer]),Re!=null&&(Re.value=ut)};if(Je&&!pr){const xn=f.stencilModeForClipping(dr).ref;xn===0&&se&&B.clear({stencil:0});const Ln={func:q.EQUAL,mask:255};On.u_alpha_discard_threshold=.8,Si(new Ar(Ln,xn,255,q.KEEP,q.KEEP,q.INVERT)),On.u_alpha_discard_threshold=0,Si(new Ar(Ln,xn,255,q.KEEP,q.KEEP,q.KEEP))}else On.u_alpha_discard_threshold=Je&&pr&&Yt?.8:0,Si(pr?lr:f.stencilModeForClipping(dr))}};let Ye=f.depthModeForSublayer(0,Qt.ReadOnly);const vt=new Qt(f.depthOcclusion?q.GREATER:q.LEQUAL,Qt.ReadOnly,f.depthRangeFor3D);if(s.hasNonElevatedBuckets){const bt=!se&&f.terrain;E!==0&&bt?a.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`):bt?a.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${s.id}.`):tt(d,qe,Ye,Ar.disabled,!1,!0)}if(s.hasElevatedBuckets){C==="hd-road-markup"?j||(Ye=vt,qe.push("ELEVATED_ROADS")):(qe.push("ELEVATED"),Ye=vt,Z&&qe.push(J?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),L&&qe.push("ELEVATION_REFERENCE_SEA"));const bt=Je?f.stencilModeFor3D():Ar.disabled;f.forceTerrainMode=!0,tt(d,qe,Ye,bt,!0,!0),Je&&tt(d,qe,Ye,bt,!0,!1),f.forceTerrainMode=!1}Je&&(f.resetStencilClippingMasks(),se&&B.clear({stencil:0})),E===0||f.depthOcclusion||se||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,t,s,d){const _=s.paint.get("fill-color"),v=s.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const S=s.paint.get("fill-emissive-strength"),E=f.colorModeForDrapableLayerRenderPass(S),C=s.paint.get("fill-pattern"),k=f.opaquePassEnabledForLayer()&&!C.constantOr(1)&&_.constantOr(a.am.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";let L="none";s.layout.get("fill-elevation-reference")!=="none"?L="road":s.paint.get("fill-z-offset").constantOr(1)!==0&&(L="offset");const j=!(!f.terrain||!f.terrain.enabled),B={painter:f,sourceCache:t,layer:s,coords:d,colorMode:E,elevationType:L,terrainEnabled:j,pass:k};if(f.renderPass!=="shadow")if(L!=="offset"){if(bs(B,!1),L==="road"){const q=!j&&f.renderPass==="translucent";q&&nr(f,t,s,d,"geometry"),bs(B,!0,Ar.disabled),q&&(function(K){const{painter:Z,sourceCache:J,layer:Y,coords:se,colorMode:ce}=K,pe=Z.context.gl,Se=K.painter.shadowRenderer,Pe=!!Se&&Se.enabled,Me=new Qt(Z.context.gl.LEQUAL,Qt.ReadOnly,Z.depthRangeFor3D);let Te=[0,0,0];if(Pe){const Ae=Z.style.directionalLight,We=Z.style.ambientLight;Ae&&We&&(Te=Ol(Z.style,Ae,We))}const Ee=Ae=>{for(const We of se){const Le=J.getTile(We),ut=Le.getBucket(Y);if(!ut)continue;const Je=ut.elevatedStructures;if(!Je)continue;let dt,wt;if(Ae?(dt=Je.renderableBridgeSegments,wt=Je.bridgeProgramConfigurations.get(Y.id)):(dt=Je.renderableTunnelSegments,wt=Je.tunnelProgramConfigurations.get(Y.id)),!dt||dt.segments[0].primitiveLength===0)continue;wt.updatePaintBuffers(),Z.prepareDrawTile();const qe=Z.isTileAffectedByFog(We),Re=[];Pe&&Re.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const tt=Z.getOrCreateProgram("elevatedStructures",{config:wt,overrideFog:qe,defines:Re}),Ye=Z.translatePosMatrix(We.projMatrix,Le,Y.paint.get("fill-translate"),Y.paint.get("fill-translate-anchor"));Pe&&Se.setupShadows(Le.tileID.toUnwrapped(),tt,"vector-tile");const vt=xs(Ye,Te);Z.uploadCommonUniforms(Z.context,tt,We.toUnwrapped()),tt.draw(Z,pe.TRIANGLES,Me,Ar.disabled,ce,Sr.backCCW,vt,Y.id,Je.vertexBuffer,Je.indexBuffer,dt,Y.paint,Z.transform.zoom,wt,[Je.vertexBufferNormal])}};Ee(!0),Ee(!1)})(B)}}else bs(B,!1,f.stencilModeFor3D());else f.shadowRenderer&&L==="road"&&!j&&(function(q){const{painter:K,sourceCache:Z,layer:J,coords:Y}=q,se=K.context.gl,ce=q.painter.shadowRenderer;for(const pe of Y){const Se=Z.getTile(pe),Pe=Se.getBucket(J);if(!Pe)continue;const Me=Pe.elevatedStructures;if(!Me||!Me.shadowCasterSegments||Me.shadowCasterSegments.segments[0].primitiveLength===0)continue;K.prepareDrawTile();const Te=Pe.bufferData.programConfigurations.get(J.id),Ee=K.isTileAffectedByFog(pe),Ae=K.getOrCreateProgram("elevatedStructuresDepth",{config:Te,overrideFog:Ee}),We=ce.calculateShadowPassMatrixFromTile(Se.tileID.toUnwrapped());K.uploadCommonUniforms(K.context,Ae,pe.toUnwrapped());const Le={u_matrix:We,u_depth_bias:0};Ae.draw(K,se.TRIANGLES,ce.getShadowPassDepthMode(),Ar.disabled,ce.getShadowPassColorMode(),Sr.disabled,Le,J.id,Me.vertexBuffer,Me.indexBuffer,Me.shadowCasterSegments,J.paint,K.transform.zoom,Te)}})(B)},"fill-extrusion":function(f,t,s,d){const _=s.paint.get("fill-extrusion-opacity"),v=f.context,S=v.gl,E=f.terrain,C=E&&E.renderingToTexture;if(_===0)return;const k=f.conflationActive&&f.style.isLayerClipped(s,t.getSource()),L=f.style.order.indexOf(s.fqid);if(k&&(function(j,B,q,K,Z){for(const J of K){const Y=B.getTile(J).getBucket(q);Y&&(Y.updateReplacement(J,j.replacementSource,Z),Y.uploadCentroid(j.context))}})(f,t,s,d,L),E||k)for(const j of d){const B=t.getTile(j).getBucket(s);B&&br(f.context,t,j,B,s,E,k)}if(f.renderPass==="shadow"&&f.shadowRenderer){const j=f.shadowRenderer;if(E&&_<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof a.ab)return;const B=j.getShadowPassDepthMode(),q=j.getShadowPassColorMode();ws(f,t,s,d,B,Ar.disabled,q,k)}else if(f.renderPass==="translucent"){const j=!s.paint.get("fill-extrusion-pattern").constantOr(1),B=s.paint.get("fill-extrusion-color").constantOr(a.am.white);if(!C&&B.a!==0){const q=new Qt(f.context.gl.LEQUAL,Qt.ReadWrite,f.depthRangeFor3D);_===1&&j?ws(f,t,s,d,q,Ar.disabled,Wr.unblended,k):(ws(f,t,s,d,q,Ar.disabled,Wr.disabled,k),ws(f,t,s,d,q,f.stencilModeFor3D(),f.colorModeForRenderPass(),k),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&j&&(!E&&f.transform.projection.name!=="globe"||C)){const q=s.paint.get("fill-extrusion-opacity"),K=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),J=s.paint.get("fill-extrusion-flood-light-intensity"),Y=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",se=s.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Y?null:s.lut).toArray01().slice(0,3),ce=K>0&&Z>0,pe=J>0,Se=(Te,Ee,Ae)=>(1-Ae)*Te+Ae*Ee,Pe=new Ls;Pe.translate=s.paint.get("fill-extrusion-translate"),Pe.translateAnchor=s.paint.get("fill-extrusion-translate-anchor"),Pe.edgeRadius=s.layout.get("fill-extrusion-edge-radius"),Pe.cutoffFadeRange=s.paint.get("fill-extrusion-cutoff-fade-range");const Me=Te=>{const Ee=f.depthModeForSublayer(1,Qt.ReadOnly,S.LEQUAL,!0),Ae=s.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),We=Se(.1,3,Ae),Le=f._showOverdrawInspector;if(!Le){const ut=new Ar({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Je=new Wr([S.ONE,S.ONE,S.ONE,S.ONE],a.am.transparent,[!1,!1,!1,!0],S.MIN);da(Pe,f,t,s,d,Ee,ut,Je,Sr.disabled,Te,"sdf",q,K,Z,J,se,We,k,!1)}{const ut=Le?Ar.disabled:new Ar({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Je=Le?f.colorModeForRenderPass():new Wr([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],a.am.transparent,[!0,!0,!0,!0]);da(Pe,f,t,s,d,Ee,ut,Je,Sr.disabled,Te,"color",q,K,Z,J,se,We,k,!1)}};if(C){const Te=(Ee,Ae,We)=>{const Le=f.depthModeForSublayer(1,Qt.ReadOnly,S.LEQUAL,!1),ut=s.paint.get(Ee?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Je=Se(.1,3,ut);{const dt=new Wr([S.ONE,S.ONE,S.ONE,S.ONE],a.am.transparent,[!1,!1,!1,!0]);da(Pe,f,t,s,d,Le,Ar.disabled,dt,Sr.disabled,Ee,"clear",q,K,Z,J,se,Je,k,Ae)}{const dt=new Ar({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),wt=new Wr([S.ONE,S.ONE,S.ONE,S.ONE],a.am.transparent,[!1,!1,!1,!0],S.MIN);da(Pe,f,t,s,d,Le,dt,wt,Sr.disabled,Ee,"sdf",q,K,Z,J,se,Je,k,Ae)}{const dt=Ee?S.ZERO:S.ONE_MINUS_DST_ALPHA,wt=new Ar({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),qe=new Wr([dt,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],a.am.transparent,[!0,!0,!0,!0]);da(Pe,f,t,s,d,Le,wt,qe,Sr.disabled,Ee,"color",q,K,Z,J,se,Je,k,Ae)}{const dt=new Wr([S.ONE,S.ONE,S.ONE,Ee?S.ZERO:S.ONE],a.am.transparent,[!1,!1,!1,!0],Ee?S.FUNC_ADD:S.MAX);da(Pe,f,t,s,d,Le,Ar.disabled,dt,Sr.disabled,Ee,"clear",q,K,Z,J,se,Je,k,Ae,We)}};if(ce||pe){let Ee;if(f.prepareDrawTile(),E){const Ae=E.drapeBufferSize[0],We=E.drapeBufferSize[1];Ee=E.framebufferCopyTexture,Ee&&(!Ee||Ee.size[0]===Ae&&Ee.size[1]===We)||(Ee&&Ee.destroy(),Ee=E.framebufferCopyTexture=new a.T(v,new a.r({width:Ae,height:We}),S.RGBA8)),Ee.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexSubImage2D(S.TEXTURE_2D,0,0,0,0,0,Ae,We)}ce&&Te(!0,!1,Ee),pe&&Te(!1,!0,Ee)}}else ce&&Me(!0),pe&&Me(!1),(ce||pe)&&f.resetStencilClippingMasks()}}},building:function(f,t,s,d){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const _=s.paint.get("building-ambient-occlusion-ground-intensity"),v=s.paint.get("building-ambient-occlusion-ground-radius"),S=s.paint.get("building-ambient-occlusion-ground-attenuation");let E=_>0&&v>0,C=!0;const k=s.paint.get("building-vertical-scale");k<1&&(C=!1);const L=f.conflationActive&&f.style.isLayerClipped(s,t.getSource()),j=f.style.order.indexOf(s.fqid);if((function(B,q,K,Z,J,Y){for(const se of Y){const ce=q.getTile(se).getBucket(K);ce&&(J&&ce.updateReplacement(se,B.replacementSource,Z),ce.uploadUpdatedIndexBuffer(B.context))}})(f,t,s,j,L,d),(function(B,q,K,Z){for(const J of Z){const Y=q.getTile(J).getBucket(K);Y&&Y.needsEvaluation(B,K)&&(Y.evaluate(K),Y.uploadUpdatedColorBuffer(B.context))}})(f,t,s,d),s.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const B=f.shadowRenderer,q=[],K=B.getShadowPassDepthMode();gf({painter:f,source:t,layer:s,coords:d,defines:q,blendMode:B.getShadowPassColorMode(),depthMode:K,verticalScale:k})}else if(f.renderPass==="translucent"){E&&(function(Z,J,Y,se,ce,pe,Se,Pe,Me,Te,Ee,Ae,We){const Le=Z.context.gl,ut=Z.depthModeForSublayer(1,Qt.ReadOnly,Le.LEQUAL,!0),Je=.1*(1-(dt=Ee))+3*dt;var dt;const wt=Z._showOverdrawInspector,qe=Ae,Re=new Ls;wt||da(Re,Z,J,Y,se,ut,new Ar({func:Le.ALWAYS,mask:255},255,255,Le.KEEP,Le.KEEP,Le.REPLACE),new Wr([Le.ONE,Le.ONE,Le.ONE,Le.ONE],a.am.transparent,[!1,!1,!1,!0],Le.MIN),Sr.disabled,ce,"sdf",1,Se,Pe,0,Te,Je,qe,!1);{const tt=wt?Ar.disabled:new Ar({func:Le.EQUAL,mask:255},255,255,Le.KEEP,Le.DECR,Le.DECR),Ye=wt?Z.colorModeForRenderPass():new Wr([Le.ONE_MINUS_DST_ALPHA,Le.DST_ALPHA,Le.ONE,Le.ONE],a.am.transparent,[!0,!0,!0,!0]);da(Re,Z,J,Y,se,ut,tt,Ye,Sr.disabled,ce,"color",1,Se,Pe,0,Te,Je,qe,!1)}})(f,t,s,d,!0,0,_,v,0,[0,0,0],S,L);let B=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];C&&(B=B.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer.useNormalOffset&&(B=B.concat("NORMAL_OFFSET"));const q=new Qt(f.context.gl.LEQUAL,Qt.ReadWrite,f.depthRangeFor3D),K=f.colorModeForRenderPass();gf({painter:f,source:t,layer:s,coords:d,defines:B,blendMode:K,depthMode:q,verticalScale:k})}else if(f.renderPass==="light-beam"){const B=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],q=new Qt(f.context.gl.LEQUAL,Qt.ReadOnly,f.depthRangeFor3D);gf({painter:f,source:t,layer:s,coords:d,defines:B,blendMode:Wr.alphaBlended,depthMode:q,verticalScale:k})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,t,s,d){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const _=f.context,v=f.terrain&&f.terrain.renderingToTexture,[S,E]=f.renderPass!=="translucent"||v?[{},d]:f.stencilConfigForOverlap(d);for(const C of E){const k=t.getTile(C);if(k.needsHillshadePrepare&&f.renderPass==="offscreen")bp(f,k,s);else if(f.renderPass==="translucent"){const L=f.depthModeForSublayer(0,Qt.ReadOnly),j=s.paint.get("hillshade-emissive-strength"),B=f.colorModeForDrapableLayerRenderPass(j),q=v&&f.terrain?f.terrain.stencilModeForRTTOverlap(C):S[C.overscaledZ];t_(f,C,k,s,L,q,B)}}_.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,t,s,d,_,v){if(f.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const S=f.transform.projection.name==="globe",E=s.paint.get("raster-elevation")!==0,C=E&&S;if(f.renderElevatedRasterBackface&&!C)return;const k=f.context,L=k.gl,j=t.getSource(),B=(function(Pe,Me,Te,Ee){const Ae=Me.paint.get("raster-color"),We=Pe.type==="raster-array",Le=[],ut=Me.paint.get("raster-resampling"),Je=Me.paint.get("raster-color-mix");let dt=Me.paint.get("raster-color-range");const wt=[Je[0],Je[1],Je[2],0],qe=Je[3];let Re=ut==="nearest"?Ee.NEAREST:Ee.LINEAR;if(We&&(Le.push("RASTER_ARRAY"),Ae||Le.push("RASTER_COLOR"),ut==="linear"&&Le.push("RASTER_ARRAY_LINEAR"),Re=Ee.NEAREST,!dt&&Pe.rasterLayers)){const tt=Pe.rasterLayers.find((({id:Ye})=>Ye===Me.sourceLayer));tt&&tt.fields&&tt.fields.range&&(dt=tt.fields.range)}if(dt=dt||[0,1],Ae){Le.push("RASTER_COLOR"),Te.activeTexture.set(Ee.TEXTURE2),Me.updateColorRamp(dt);let tt=Me.colorRampTexture;tt||(tt=Me.colorRampTexture=new a.T(Te,Me.colorRamp,Ee.RGBA8)),tt.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)}return{mix:wt,range:dt,offset:qe,defines:Le,resampling:Re}})(j,s,k,L);if(j instanceof a.aP&&!d.length&&!S)return;const q=s.paint.get("raster-emissive-strength"),K=f.colorModeForDrapableLayerRenderPass(q),Z=f.terrain&&f.terrain.renderingToTexture,J=!f.options.moving,Y=s.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(j instanceof a.aP&&!d.length&&(j.onNorthPole||j.onSouthPole)){const Pe=E?f.stencilModeFor3D():Ar.disabled;return void us(!!j.onNorthPole,null,f,t,s,q,B,Sr.disabled,Pe)}if(!d.length)return;const[se,ce]=j instanceof a.aP||Z?[{},d]:f.stencilConfigForOverlap(d),pe=ce[ce.length-1].overscaledZ;C&&B.defines.push("PROJECTION_GLOBE_VIEW"),E&&B.defines.push("RENDER_CUTOFF");const Se=(Pe,Me,Te)=>{for(const Ee of Pe){const Ae=Ee.toUnwrapped(),We=t.getTile(Ee);if(Z&&(!We||!We.hasData()))continue;k.activeTexture.set(L.TEXTURE0);const Le=yf(We,j,s,B);if(!Le||!Le.texture)continue;const{texture:ut,mix:Je,offset:dt,tileSize:wt,buffer:qe}=Le;let Re,tt;Z?(Re=Qt.disabled,tt=Ee.projMatrix):E?(Re=new Qt(L.LEQUAL,Qt.ReadWrite,f.depthRangeFor3D),tt=S?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(Ae,J)):(Re=f.depthModeForSublayer(Ee.overscaledZ-pe,s.paint.get("raster-opacity")===1?Qt.ReadWrite:Qt.ReadOnly,L.LESS),tt=f.transform.calculateProjMatrix(Ae,J));const Ye=f.terrain&&Z?f.terrain.stencilModeForRTTOverlap(Ee):se[Ee.overscaledZ],vt=v?0:s.paint.get("raster-fade-duration");We.registerFadeDuration(vt);const bt=t.findLoadedParent(Ee,0),It=wo(We,bt,t,f.transform,vt);let Dt,lr;f.terrain&&f.terrain.prepareDrawTile(),k.activeTexture.set(L.TEXTURE0),ut.bind(Y,L.CLAMP_TO_EDGE),k.activeTexture.set(L.TEXTURE1),bt?(bt.texture&&bt.texture.bind(Y,L.CLAMP_TO_EDGE),Dt=Math.pow(2,bt.tileID.overscaledZ-We.tileID.overscaledZ),lr=[We.tileID.canonical.x*Dt%1,We.tileID.canonical.y*Dt%1]):ut.bind(Y,L.CLAMP_TO_EDGE),"useMipmap"in ut&&k.extTextureFilterAnisotropic&&f.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const pr=f.transform;let Yt;const dr=E?_f(pr):[0,0,0,0];let ur,kr,Vr,Xr,vn,jr=0;if(C&&j instanceof a.aP&&j.coordinates.length>3)ur=Float32Array.from(a.bh(a.dD(new a.cA(0,0,0)))),kr=Float32Array.from(pr.globeMatrix),Vr=Float32Array.from(a.dz(pr)),Xr=[a.aD(pr.center.lng),a.aH(pr.center.lat)],Yt=j.elevatedGlobePerspectiveTransform,vn=j.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){const Gr=a.dA(Ee.canonical);jr=a.dB(Gr.getCenter().lat),ur=Float32Array.from(a.bh(a.dD(Ee.canonical))),kr=Float32Array.from(pr.globeMatrix),Vr=Float32Array.from(a.dz(pr)),Xr=[a.aD(pr.center.lng),a.aH(pr.center.lat)],Yt=[0,0],vn=Float32Array.from(a.dC(Ee.canonical,Gr,jr,pr.worldSize/pr._pixelsPerMercatorPixel))}else Yt=j instanceof a.aP?j.perspectiveTransform:[0,0],ur=new Float32Array(16),kr=new Float32Array(9),Vr=new Float32Array(16),Xr=[0,0],vn=new Float32Array(9);const Sn=ss(tt,ur,kr,Vr,vn,lr||[0,0],a.ah(f.transform.zoom),Xr,dr,Dt||1,It,s,Yt,E?s.paint.get("raster-elevation"):0,2,Je,dt,B.range,wt,qe,q),Mn=f.isTileAffectedByFog(Ee),Xn=f.getOrCreateProgram("raster",{defines:B.defines,overrideFog:Mn});if(f.uploadCommonUniforms(k,Xn,Ae),j instanceof a.aP){const Gr=j.elevatedGlobeVertexBuffer,Tn=j.elevatedGlobeIndexBuffer;if(Z||!S)j.boundsBuffer&&j.boundsSegments&&Xn.draw(f,L.TRIANGLES,Re,Ar.disabled,K,Sr.disabled,Sn,s.id,j.boundsBuffer,f.quadTriangleIndexBuffer,j.boundsSegments);else if(Gr&&Tn){const _n=pr.zoom<=a.cX?j.elevatedGlobeSegments:j.getSegmentsForLongitude(pr.center.lng);_n&&Xn.draw(f,L.TRIANGLES,Re,Ar.disabled,K,Me,Sn,s.id,Gr,Tn,_n)}}else if(C){Re=new Qt(L.LEQUAL,Qt.ReadOnly,f.depthRangeFor3D);const Gr=f.globeSharedBuffers;if(Gr){const[Tn,_n,zn]=Gr.getGridBuffers(jr,!1);Xn.draw(f,L.TRIANGLES,Re,Te||Ye,f.colorModeForRenderPass(),Me,Sn,s.id,Tn,_n,zn)}}else{const{tileBoundsBuffer:Gr,tileBoundsIndexBuffer:Tn,tileBoundsSegments:_n}=f.getTileBoundsBuffers(We);Xn.draw(f,L.TRIANGLES,Re,Ye,K,Sr.disabled,Sn,s.id,Gr,Tn,_n)}}if(!(j instanceof a.aP)&&C)for(const Ee of Pe){const Ae=Ee.canonical.y===(1<<Ee.canonical.z)-1;Ee.canonical.y===0&&us(!0,Ee,f,t,s,q,B,Me,Te||Ar.disabled),Ae&&us(!1,Ee,f,t,s,q,B,Me===Sr.frontCW?Sr.backCW:Sr.frontCW,Te||Ar.disabled)}};C?Se(ce,f.renderElevatedRasterBackface?Sr.backCW:Sr.frontCW,f.stencilModeFor3D()):Se(ce,Sr.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,t,s,d,_,v){f.renderPass==="offscreen"&&(function(S,E,C,k){if(!k.length)return;const L=S.context,j=L.gl,B=E.getSource();if(!(B instanceof tu))return;const q=Math.ceil(Math.sqrt(C.paint.get("raster-particle-count")));let K=C.particlePositionRGBAImage;if(!K||K.width!==q){const ce=(function(pe){const Se=pe*pe,Pe=new Uint8Array(4*Se),Me=function(Ee){return Ee|=0,Ee=Math.imul(2747636419^Ee,2654435769),Ee=Math.imul(Ee^Ee>>>16,2654435769),((Ee=Math.imul(Ee^Ee>>>16,2654435769))>>>0)/4294967296},Te=1/1.1;for(let Ee=0;Ee<Se;Ee++){const Ae=Te*(Me(2*Ee+0)+Bl),We=Te*(Me(2*Ee+1)+Bl),Le=255*Ae%1,ut=255*We%1,Je=Le,dt=We-ut/255,wt=ut;Pe[4*Ee+0]=255*(Ae-Le/255),Pe[4*Ee+1]=255*Je,Pe[4*Ee+2]=255*dt,Pe[4*Ee+3]=255*wt}return Pe})(q);K=C.particlePositionRGBAImage=new a.r({width:q,height:q},ce)}let Z=C.particleFramebuffer;Z?Z.width!==q&&(Z.destroy(),Z=C.particleFramebuffer=L.createFramebuffer(q,q,!0,null)):Z=C.particleFramebuffer=L.createFramebuffer(q,q,!0,null);const J=[];for(const ce of k){const pe=E.getTile(ce);if(!(pe instanceof Ju))continue;const Se=So(pe,B,C);if(!Se)continue;const Pe=[pe.tileSize,pe.tileSize];let Me=C.tileFramebuffer;Me||(Me=C.tileFramebuffer=L.createFramebuffer(Pe[0],Pe[1],!0,null));let Te=pe.rasterParticleState;Te||(Te=pe.rasterParticleState=new vf(L,ce,Pe,K));const Ee=Te.update(C.lastInvalidatedAt);Te.particleTextureDimension!==q&&Te.updateParticleTexture(ce,K);const Ae=Te.targetColorTexture;Te.targetColorTexture=Te.backgroundColorTexture,Te.backgroundColorTexture=Ae;const We=Te.particleTexture0;Te.particleTexture0=Te.particleTexture1,Te.particleTexture1=We,J.push([ce,Se,Te,Ee])}if(J.length===0)return;const Y=a.q.now(),se=C.previousDrawTimestamp?.001*(Y-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=Y,C.hasColorMap()){L.activeTexture.set(j.TEXTURE0+2);let ce=C.colorRampTexture;ce||(ce=C.colorRampTexture=new a.T(L,C.colorRamp,j.RGBA8)),ce.bind(j.LINEAR,j.CLAMP_TO_EDGE)}L.bindFramebuffer.set(C.tileFramebuffer.framebuffer),(function(ce,pe,Se){const Pe=ce.context,Me=Pe.gl,Te=pe.tileFramebuffer;Pe.activeTexture.set(Me.TEXTURE0);const Ee={u_texture:0,u_opacity:1.05*(We=pe.paint.get("raster-particle-fade-opacity-factor"))/(We+.05)},Ae=ce.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var We;for(const Le of Se){const[,,ut,Je]=Le;Te.colorAttachment.set(ut.targetColorTexture.texture),Pe.viewport.set([0,0,Te.width,Te.height]),Pe.clear({color:a.am.transparent}),Je&&(ut.backgroundColorTexture.bind(Me.NEAREST,Me.CLAMP_TO_EDGE),Ae.draw(ce,Me.TRIANGLES,Qt.disabled,Ar.disabled,Wr.alphaBlended,Sr.disabled,Ee,pe.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments))}})(S,C,J),(function(ce,pe,Se,Pe){const Me=ce.context,Te=Me.gl,Ee=Se.tileFramebuffer,Ae=ce.transform.projection.name==="globe",We=Se.paint.get("raster-particle-max-speed");for(const Le of Pe){const[ut,Je,dt]=Le;Me.activeTexture.set(Te.TEXTURE0+0),Je.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Ee.colorAttachment.set(dt.targetColorTexture.texture);const wt=ce.getOrCreateProgram("rasterParticleDraw",{defines:Je.defines,overrideFog:!1});Me.activeTexture.set(Te.TEXTURE0+1);const qe=Je.scalarData?[]:[0,1,2,3].map((Ye=>a.e3[Ye](ut)));qe.push(ut);const Re=ut.canonical.x,tt=ut.canonical.y;for(const Ye of qe){const vt=pe.getTile(Ae?Ye.wrapped():Ye);if(!vt)continue;const bt=vt.rasterParticleState;if(!bt)continue;const It=Ye.canonical.x+(1<<Ye.canonical.z)*(Ye.wrap-ut.wrap),Dt=Ye.canonical.y;bt.particleTexture0.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const lr=xd(1,bt.particleTexture0.size[0],[It-Re,Dt-tt],0,Je.texture.size,2,We,Je.textureOffset,Je.scale,Je.offset);wt.draw(ce,Te.POINTS,Qt.disabled,Ar.disabled,Wr.alphaBlended,Sr.disabled,lr,Se.id,bt.particleIndexBuffer,void 0,bt.particleSegment)}}})(S,E,C,J),L.bindFramebuffer.set(C.particleFramebuffer.framebuffer),(function(ce,pe,Se,Pe){const Me=ce.context,Te=Me.gl,Ee=pe.paint.get("raster-particle-max-speed"),Ae=Pe*pe.paint.get("raster-particle-speed-factor")*.15,We=(function(ut){return Math.pow(ut,6)})(.01+1*pe.paint.get("raster-particle-reset-rate-factor")),Le=pe.particleFramebuffer;Me.viewport.set([0,0,Le.width,Le.height]);for(const ut of Se){const[,Je,dt]=ut;Me.activeTexture.set(Te.TEXTURE0+0),Je.texture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),Me.activeTexture.set(Te.TEXTURE0+1);const wt=dt.particleTexture0;wt.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);const qe=Cp(1,wt.size[0],0,Je.texture.size,Ee,Ae,We,Je.textureOffset,Je.scale,Je.offset);Le.colorAttachment.set(dt.particleTexture1.texture),Me.clear({color:a.am.transparent}),ce.getOrCreateProgram("rasterParticleUpdate",{defines:Je.defines}).draw(ce,Te.TRIANGLES,Qt.disabled,Ar.disabled,Wr.unblended,Sr.disabled,qe,pe.id,ce.viewportBuffer,ce.quadTriangleIndexBuffer,ce.viewportSegments)}})(S,C,J,se)})(f,t,s,d),f.renderPass==="translucent"&&((function(S,E,C,k,L){const j=S.context,B=j.gl,q=E.getSource().tileSize,K=5*(1-a.af(a.cI,a.cI+1,S.transform.zoom))*q+C.paint.get("raster-particle-elevation"),Z=!S.options.moving,J=S.transform.projection.name==="globe";if(!k.length)return;const[Y,se]=S.stencilConfigForOverlap(k),ce=[];J&&ce.push("PROJECTION_GLOBE_VIEW");const pe=S.stencilModeFor3D();for(const Se of se){const Pe=Se.toUnwrapped(),Me=E.getTile(Se);if(!Me.rasterParticleState)continue;const Te=Me.rasterParticleState,Ee=100;Me.registerFadeDuration(Ee);const Ae=E.findLoadedParent(Se,0),We=wo(Me,Ae,E,S.transform,Ee);let Le,ut;S.terrain&&S.terrain.prepareDrawTile(),j.activeTexture.set(B.TEXTURE0),Te.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),j.activeTexture.set(B.TEXTURE1),Ae&&Ae.rasterParticleState?(Ae.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Le=Math.pow(2,Ae.tileID.overscaledZ-Me.tileID.overscaledZ),ut=[Me.tileID.canonical.x*Le%1,Me.tileID.canonical.y*Le%1]):Te.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const Je=J?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Pe,Z),dt=S.transform,wt=Ul(dt),qe=a.dA(Se.canonical),Re=a.dB(qe.getCenter().lat);let tt,Ye,vt,bt,It;J?(tt=Float32Array.from(a.bh(a.dD(Se.canonical))),Ye=Float32Array.from(dt.globeMatrix),vt=Float32Array.from(a.dz(dt)),bt=[a.aD(dt.center.lng),a.aH(dt.center.lat)],It=Float32Array.from(a.dC(Se.canonical,qe,Re,dt.worldSize/dt._pixelsPerMercatorPixel))):(tt=new Float32Array(16),Ye=new Float32Array(9),vt=new Float32Array(16),bt=[0,0],It=new Float32Array(9));const Dt=ph(Je,tt,Ye,vt,It,ut||[0,0],a.ah(S.transform.zoom),bt,wt,Le||1,We,K),lr=S.isTileAffectedByFog(Se),pr=S.getOrCreateProgram("rasterParticle",{defines:ce,overrideFog:lr});if(S.uploadCommonUniforms(j,pr,Pe),J){const Yt=new Qt(B.LEQUAL,Qt.ReadOnly,S.depthRangeFor3D),dr=0,ur=S.globeSharedBuffers;if(ur){const[kr,Vr,Xr]=ur.getGridBuffers(Re,dr!==0);pr.draw(S,B.TRIANGLES,Yt,pe,Wr.alphaBlended,S.renderElevatedRasterBackface?Sr.frontCCW:Sr.backCCW,Dt,C.id,kr,Vr,Xr)}}else{const Yt=S.depthModeForSublayer(0,Qt.ReadOnly),dr=Y[Se.overscaledZ],{tileBoundsBuffer:ur,tileBoundsIndexBuffer:kr,tileBoundsSegments:Vr}=S.getTileBoundsBuffers(Me);pr.draw(S,B.TRIANGLES,Yt,dr,Wr.alphaBlended,Sr.disabled,Dt,C.id,ur,kr,Vr)}}S.resetStencilClippingMasks()})(f,t,s,d),f.style.map.triggerRepaint())},background:function(f,t,s,d){const _=s.paint.get("background-color"),v=s.paint.get("background-color-use-theme").constantOr("default")==="none",S=s.paint.get("background-opacity"),E=s.paint.get("background-emissive-strength"),C=s.paint.get("background-pitch-alignment")==="viewport";if(S===0)return;const k=f.context,L=k.gl,j=f.transform,B=j.tileSize,q=s.paint.get("background-pattern");let K;if(q!==void 0&&(q===null||(K=f.imageManager.getPattern(a.I.from(q.toString()),s.scope,f.style.getLut(s.scope)),!K)))return;const Z=!q&&_.a===1&&S===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==Z)return;const J=Ar.disabled,Y=f.depthModeForSublayer(0,Z==="opaque"?Qt.ReadWrite:Qt.ReadOnly),se=f.colorModeForDrapableLayerRenderPass(E),ce=q?"backgroundPattern":"background";let pe,Se=d;if(Se||(pe=f.getBackgroundTiles(),Se=Object.values(pe).map((Pe=>Pe.tileID))),q&&(k.activeTexture.set(L.TEXTURE0),f.imageManager.bind(f.context,s.scope)),C){const Pe=f.getOrCreateProgram(ce,{overrideFog:!1,overrideRtt:!0}),Me=new Float32Array(a.bx([])),Te=new a.aM(0,0,0,0,0),Ee=q?ff(Me,E,S,f,0,s.scope,K,C,{tileID:Te,tileSize:B}):mc(Me,E,S,_.toPremultipliedRenderColor(v?null:s.lut));Pe.draw(f,L.TRIANGLES,Y,J,se,Sr.disabled,Ee,s.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const Pe of Se){const Me=f.isTileAffectedByFog(Pe),Te=f.getOrCreateProgram(ce,{overrideFog:Me}),Ee=Pe.toUnwrapped(),Ae=d?Pe.projMatrix:f.transform.calculateProjMatrix(Ee);f.prepareDrawTile();const We=t?t.getTile(Pe):pe?pe[Pe.key]:new ou(Pe,B,j.zoom,f),Le=q?ff(Ae,E,S,f,0,s.scope,K,C,{tileID:Pe,tileSize:B}):mc(Ae,E,S,_.toPremultipliedRenderColor(v?null:s.lut));f.uploadCommonUniforms(k,Te,Ee);const{tileBoundsBuffer:ut,tileBoundsIndexBuffer:Je,tileBoundsSegments:dt}=f.getTileBoundsBuffers(We);Te.draw(f,L.TRIANGLES,Y,J,se,Sr.disabled,Le,s.id,ut,Je,dt)}},sky:function(f,t,s){const d=f._atmosphere?a.ah(f.transform.zoom):1,_=s.paint.get("sky-opacity")*d;if(_===0)return;const v=f.context,S=s.paint.get("sky-type"),E=new Qt(v.gl.LEQUAL,Qt.ReadOnly,[0,1]),C=f.frameCounter/1e3%1;S==="atmosphere"?f.renderPass==="offscreen"?s.needsSkyboxCapture(f)&&((function(k,L,j,B){const q=k.context,K=q.gl;let Z=L.skyboxFbo;if(!Z){Z=L.skyboxFbo=q.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new Bs(q),L.skyboxTexture=q.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,L.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let ce=0;ce<6;++ce)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}q.bindFramebuffer.set(Z.framebuffer),q.viewport.set([0,0,32,32]);const J=L.getCenter(k,!0),Y=k.getOrCreateProgram("skyboxCapture"),se=new Float64Array(16);a.bx(se),a.eh(se,se,.5*-Math.PI),Ns(k,L,Y,se,J,0),a.bx(se),a.eh(se,se,.5*Math.PI),Ns(k,L,Y,se,J,1),a.bx(se),a.cR(se,se,.5*-Math.PI),Ns(k,L,Y,se,J,2),a.bx(se),a.cR(se,se,.5*Math.PI),Ns(k,L,Y,se,J,3),a.bx(se),Ns(k,L,Y,se,J,4),a.bx(se),a.eh(se,se,Math.PI),Ns(k,L,Y,se,J,5),q.viewport.set([0,0,k.width,k.height])})(f,s),s.markSkyboxValid(f)):f.renderPass==="sky"&&(function(k,L,j,B,q){const K=k.context,Z=K.gl,J=k.transform,Y=k.getOrCreateProgram("skybox");K.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_CUBE_MAP,L.skyboxTexture);const se=((ce,pe,Se,Pe,Me)=>({u_matrix:ce,u_sun_direction:pe,u_cubemap:0,u_opacity:Pe,u_temporal_offset:Me}))(J.skyboxMatrix,L.getCenter(k,!1),0,B,q);k.uploadCommonUniforms(K,Y),Y.draw(k,Z.TRIANGLES,j,Ar.disabled,k.colorModeForRenderPass(),Sr.backCW,se,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)})(f,s,E,_,C):S==="gradient"&&f.renderPass==="sky"&&(function(k,L,j,B,q){const K=k.context,Z=K.gl,J=k.transform,Y=k.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Bs(K)),K.activeTexture.set(Z.TEXTURE0);let se=L.colorRampTexture;se||(se=L.colorRampTexture=new a.T(K,L.colorRamp,Z.RGBA8)),se.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const ce=((pe,Se,Pe,Me,Te)=>({u_matrix:pe,u_color_ramp:0,u_center_direction:Se,u_radius:a.al(Pe),u_opacity:Me,u_temporal_offset:Te}))(J.skyboxMatrix,L.getCenter(k,!1),L.paint.get("sky-gradient-radius"),B,q);k.uploadCommonUniforms(K,Y),Y.draw(k,Z.TRIANGLES,j,Ar.disabled,k.colorModeForRenderPass(),Sr.backCW,ce,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)})(f,s,E,_,C)},custom:function(f,t,s,d){const _=f.context,v=s.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&s.isDraped(t)){if(f.renderPass==="offscreen"){const S=v.prerender;if(S){if(f.setCustomLayerDefaults(),_.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const E=f.transform.pointMerc;S.call(v,_.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),a.ah(f.transform.zoom),[E.x,E.y],f.transform.pixelsPerMeterRatio)}else S.call(v,_.gl,f.transform.customLayerMatrix());_.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const E=v.renderToTile;if(E){const C=d[0].canonical,k={x:C.x+d[0].wrap*(v.wrapTileId?0:1<<C.z),y:C.y,z:C.z};_.setDepthMode(Qt.disabled),_.setStencilMode(Ar.disabled),_.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),E.call(v,_.gl,k),_.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),_.setColorMode(f.colorModeForRenderPass()),_.setStencilMode(Ar.disabled);const S=v.renderingMode==="3d"?new Qt(f.context.gl.LEQUAL,Qt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Qt.ReadOnly);if(_.setDepthMode(S),f.transform.projection.name==="globe"){const E=f.transform.pointMerc;v.render(_.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),a.ah(f.transform.zoom),[E.x,E.y],f.transform.pixelsPerMeterRatio)}else v.render(_.gl,f.transform.customLayerMatrix());_.setDirty(),f.setBaseState(),_.bindFramebuffer.set(null)}}else a.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,t,s,d){if(f.renderPass==="opaque")return;const _=s.paint.get("model-opacity").constantOr(1);if(_===0)return;const v=s.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!v||f.terrain&&_<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof a.ab))return;const S=f.shadowRenderer,E=s.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,E||(S.enabled=!1));const C=()=>{S&&(S.useNormalOffset=!0,E||(S.enabled=!0))},k=t.getSource();if(f.renderPass==="light-beam"&&k.type!=="batched-model")return;if(k.type==="vector"||k.type==="geojson")return(function(Y,se,ce,pe,Se){const Pe=Y.transform;if(Pe.projection.name!=="mercator")return void a.w(`Drawing 3D models for ${Pe.projection.name} projection is not yet implemented`);const Me=Pe.getFreeCameraOptions().position;if(!Y.modelManager)return;const Te=Y.modelManager;ce.modelManager=Te;const Ee=Y.shadowRenderer;if(!ce._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ae=ce._unevaluatedLayout._values["model-id"],We=Object.assign({},ce.layout.get("model-id").parameters),Le=Y.style.order.indexOf(ce.fqid);for(const ut of pe){const Je=se.getTile(ut).getBucket(ce);if(!Je||Je.projection.name!==Pe.projection.name)continue;const dt=Je.getModelUris();dt&&!Je.modelsRequested&&(Te.addModelsFromBucket(dt,Se),Je.modelsRequested=!0);const wt=Im(ut,Pe);We.zoom=wt;const qe=Ae.possiblyEvaluate(We);if(Tc(Y,Je,ut),js.shadowUniformsInitialized=!1,js.useSingleShadowCascade=!!Ee&&Ee.getMaxCascadeForTile(ut.toUnwrapped())===0,Y.renderPass==="shadow"&&Ee){if(Y.currentShadowCascade===1&&Je.isInsideFirstShadowMapFrustum)continue;const Ye=Pe.calculatePosMatrix(ut.toUnwrapped(),Pe.worldSize);if(js.tileMatrix.set(Ye),js.shadowTileMatrix=Float32Array.from(Ee.calculateShadowPassMatrixFromMatrix(Ye)),js.aabb.min.fill(0),js.aabb.max[0]=js.aabb.max[1]=a.aj,js.aabb.max[2]=0,Pd(Je,js,Y,ce.scope))continue}const Re=1<<ut.canonical.z,tt=[((Me.x-ut.wrap)*Re-ut.canonical.x)*a.aj,(Me.y*Re-ut.canonical.y)*a.aj,Me.z*Re*a.aj];Y.conflationActive&&Object.keys(Je.instancesPerModel).length>0&&Y.style.isLayerClipped(ce,se.getSource())&&Je.updateReplacement(ut,Y.replacementSource,Le,Se)&&(Je.uploaded=!1,Je.upload(Y.context));for(let Ye in Je.instancesPerModel){const vt=Je.instancesPerModel[Ye];vt.features.length>0&&(Ye=qe.evaluate(vt.features[0].feature,{}));const bt=Te.getModel(Ye,Se);if(bt||Te.hasURLBeenRequested(Ye)||Je.modelUris.includes(Ye)||(Je.modelUris.push(Ye),Je.modelsRequested=!1),bt&&bt.uploaded)for(const It of bt.nodes)Ad(Y,ce,It,vt,tt,ut,js)}}})(f,t,s,d,k.type==="vector"?s.scope:""),void C();if(!k.loaded())return;if(k.type==="batched-model")return(function(Y,se,ce,pe){ce.resetLayerRenderingStats(Y);const Se=Y.context,Pe=Y.transform,Me=Y.style.fog,Te=Y.shadowRenderer;if(Pe.projection.name!=="mercator")return void a.w(`Drawing 3D landmark models for ${Pe.projection.name} projection is not yet implemented`);const Ee=Y.transform.getFreeCameraOptions().position,Ae=a.c1([],[Ee.x,Ee.y,Ee.z],Y.transform.worldSize),We=a.eq([],Ae),Le=a.bx([]),ut=a.e9(Pe.center.lat,Pe.zoom),Je=a.bn([],[1,1,1/ut]);a.bo(Le,Le,We);const dt=ce.paint.get("model-opacity").constantOr(1),wt=new Qt(Se.gl.LEQUAL,Qt.ReadWrite,Y.depthRangeFor3D),qe=new Qt(Se.gl.LEQUAL,Qt.ReadOnly,Y.depthRangeFor3D),Re=new a.d6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),tt=Y.renderPass==="shadow",Ye=tt&&Te?Te.getCurrentCascadeFrustum():Pe.getFrustum(Pe.scaleZoom(Pe.worldSize)),vt=ce.paint.get("model-front-cutoff"),bt=vt[2]<1,It=Va(Y,ce.paint.get("model-cutoff-fade-range")),Dt=ce.getLayerRenderingStats();(function(lr,pr,Yt,dr){const ur=lr.terrain?lr.terrain.exaggeration():0,kr=lr.transform.zoom;for(const Vr of dr){const Xr=pr.getTile(Vr).getBucket(Yt);Xr&&(Xr.setFilter(Yt.filter),lr.conflationActive&&Xr.updateReplacement(Vr,lr.replacementSource),Xr.evaluateTransform(lr,Yt),lr.terrain&&ur>0&&Xr.elevationUpdate(lr.terrain,ur,Vr,Yt.source),Xr.needsReEvaluation(lr,kr,Yt)&&Xr.evaluate(Yt))}})(Y,se,ce,pe),(function(){let lr,pr,Yt;bt?(lr=pe.length-1,pr=-1,Yt=-1):(lr=0,pr=pe.length,Yt=1);const dr=new Float64Array(16),ur=a.cx(),kr=new a.P(0,0);for(let Vr=lr;Vr!==pr;Vr+=Yt){const Xr=pe[Vr],vn=se.getTile(Xr).getBucket(ce);if(!vn||!vn.uploaded)continue;let jr=!1;Te&&(jr=Te.getMaxCascadeForTile(Xr.toUnwrapped())===0);const Sn=Pe.calculatePosMatrix(Xr.toUnwrapped(),Pe.worldSize),Mn=vn.modelTraits;!tt&&bt&&(a.bi(dr,Sn),a.ad(ur,Ae,dr),kr.x=ur[0],kr.y=ur[1]);const Xn=[];vn.setFilter(ce.filter);for(const Gr of vn.getNodesInfo()){if(Gr.hiddenByReplacement||!Gr.node.meshes)continue;const Tn=Gr.node;let _n=0;Y.terrain&&Tn.elevation&&(_n=Tn.elevation*Y.terrain.exaggeration());const zn=(()=>{const Ro=Gr.aabb;return Re.min=[...Ro.min],Re.max=[...Ro.max],Re.min[2]+=_n,Re.max[2]+=_n,a.ad(Re.min,Re.min,Sn),a.ad(Re.max,Re.max,Sn),Re})(),Mr=Gr.evaluatedScale;if(Mr[0]<=1&&Mr[1]<=1&&Mr[2]<=1&&zn.intersects(Ye)===0)continue;if(!tt&&bt){const Ro=.16666666666666666;Gr.cameraCollisionOpacity=Ae[0]>zn.min[0]&&Ae[0]<zn.max[0]&&Ae[1]>zn.min[1]&&Ae[1]<zn.max[1]&&Ae[2]*ut<zn.max[2]&&Tn.footprint&&a.bY(kr,Tn.footprint)?Math.max(Gr.cameraCollisionOpacity-Ro,0):Math.min(1,Gr.cameraCollisionOpacity+Ro)}const Gn=[...Sn],On=1/a.d4(Xr.canonical),Si=Tn.anchor?Tn.anchor[0]:0,xn=Tn.anchor?Tn.anchor[1]:0;a.bo(Gn,Gn,[Si*(Mr[0]-1)+Gr.evaluatedTranslation[0]*On,xn*(Mr[1]-1)+Gr.evaluatedTranslation[1]*On,_n+Gr.evaluatedTranslation[2]]),a.cn(Mr,a.es)||a.cP(Gn,Gn,Mr);const Ln=a.az([],Gn,Tn.matrix),Wn=a.az([],Pe.expandedFarZProjMatrix,Ln),qi=a.az([],Pe.expandedFarZProjMatrix,Gn),ti=a.aA([],[Si,xn,_n,1],Wn)[2];Tn.hidden=!1;let Ni=dt;tt||(bt&&(Ni*=Gr.cameraCollisionOpacity,Ni*=Op(Gn,Pe,Gr.aabb,vt)),Ni*=_h(It,ti)),Ni!==0?Xn.push({nodeInfo:Gr,depth:ti,opacity:Ni,wvpForNode:Wn,wvpForTile:qi,nodeModelMatrix:Ln,tileModelMatrix:Gn}):Tn.hidden=!0}tt||Xn.sort(((Gr,Tn)=>!bt||Gr.opacity===1&&Tn.opacity===1?Gr.depth<Tn.depth?-1:1:Gr.opacity===1?-1:Tn.opacity===1?1:Gr.depth>Tn.depth?-1:1));for(const Gr of Xn){const Tn=Gr.nodeInfo,_n=Tn.node;let zn=a.az([],Je,Gr.tileModelMatrix);a.az(zn,Le,zn);const Mr=a.bi([],zn);a.ea(Mr,Mr),a.cP(Mr,Mr,Sf),zn=a.az(zn,zn,_n.matrix);const Gn=Y.renderPass==="light-beam",On=ce.paint.get("model-color-use-theme").constantOr("default")==="none",Si=Mn&a.ex.HasMapboxMeshFeatures,xn=Si?0:Tn.evaluatedRMEA[0][2];for(let Ln=0;Ln<_n.meshes.length;++Ln){const Wn=_n.meshes[Ln],qi=Ln===_n.lightMeshIndex;let ti=Gr.wvpForNode;if(qi){if(!Gn&&!Y.terrain&&Y.shadowRenderer){Y.currentLayer<Y.firstLightBeamLayer&&(Y.firstLightBeamLayer=Y.currentLayer);continue}ti=Gr.wvpForTile}else if(Gn)continue;const Ni={defines:[]},Ro=[];if(!tt&&Te&&(Te.useNormalOffset=!!Wn.normalBuffer),Sc(Ni.defines,Ro,Wn,Y,On?null:ce.lut),Si||Ni.defines.push("DIFFUSE_SHADED"),jr&&Ni.defines.push("SHADOWS_SINGLE_CASCADE"),Dt&&(tt?Dt.numRenderedVerticesInShadowPass+=Wn.vertexArray.length:Dt.numRenderedVerticesInTransparentPass+=Wn.vertexArray.length),tt){wf(Wn,Gr.nodeModelMatrix,Y,ce);continue}let Xo=null;if(Me){const Ko=Vl(Gr.nodeModelMatrix,Y.transform);if(Xo=new Float32Array(Ko),Pe.projection.name!=="globe"){const Mi=Wn.aabb.min,Oi=Wn.aabb.max,[Jn,Qi]=Me.getOpacityForBounds(Ko,Mi[0],Mi[1],Oi[0],Oi[1]);Ni.overrideFog=Jn>=mt||Qi>=mt}}const Uo=Wn.material;let ko;Uo.occlusionTexture&&Uo.occlusionTexture.offsetScale&&(ko=Uo.occlusionTexture.offsetScale,Ni.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Eo=Y.getOrCreateProgram("model",Ni);!tt&&Te&&Te.setupShadowsFromMatrix(Gr.tileModelMatrix,Eo,Te.useNormalOffset),Y.uploadCommonUniforms(Se,Eo,null,Xo);const Ma=Uo.pbrMetallicRoughness;Ma.metallicFactor=.9,Ma.roughnessFactor=.5;const Za=_c(new Float32Array(ti),new Float32Array(zn),new Float32Array(Mr),new Float32Array(_n.matrix),Y,Gr.opacity,Ma.baseColorFactor,Uo.emissiveFactor,Ma.metallicFactor,Ma.roughnessFactor,Uo,xn,ce,[0,0,0],ko);!qi&&(Tn.hasTranslucentParts||Gr.opacity<1)&&Eo.draw(Y,Se.gl.TRIANGLES,wt,Ar.disabled,Wr.disabled,Sr.backCCW,Za,ce.id,Wn.vertexBuffer,Wn.indexBuffer,Wn.segments,ce.paint,Y.transform.zoom,void 0,Ro),Eo.draw(Y,Se.gl.TRIANGLES,qi?qe:wt,Ar.disabled,qi||Gr.opacity<1||Tn.hasTranslucentParts?Wr.alphaBlended:Wr.unblended,Sr.backCCW,Za,ce.id,Wn.vertexBuffer,Wn.indexBuffer,Wn.segments,ce.paint,Y.transform.zoom,void 0,Ro)}}}})()})(f,t,s,d),void C();if(k.type!=="model")return;const L=k.getModels(),j=[],B=f.transform.getFreeCameraOptions().position,q=a.c1([],[B.x,B.y,B.z],f.transform.worldSize);a.eq(q,q);const K=[],Z=[];let J=0;for(const Y of L){const se=s.paint.get("model-rotation").constantOr(null),ce=s.paint.get("model-scale").constantOr(null),pe=s.paint.get("model-translation").constantOr(null);Y.computeModelMatrix(f,se,ce,pe,!0,!0,!1);const Se=a.bx([]),Pe=a.e9(Y.position.lat,f.transform.zoom),Me=a.bn([],[1,1,1/Pe]);a.bo(Se,Se,q),j.push({zScaleMatrix:Me,negCameraPosMatrix:Se});for(const Te of Y.nodes)Ed(f.transform,Te,Y.matrix,f.transform.expandedFarZProjMatrix,J,K,Z);J++}if(K.sort(((Y,se)=>se.depth-Y.depth)),f.renderPass!=="shadow"){if(_===1)for(const Y of Z)Pu(Y,f,s,j[Y.modelIndex],Ar.disabled,f.colorModeForRenderPass());else{for(const Y of Z)Pu(Y,f,s,j[Y.modelIndex],Ar.disabled,Wr.disabled);for(const Y of Z)Pu(Y,f,s,j[Y.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(const Y of K)Pu(Y,f,s,j[Y.modelIndex],Ar.disabled,f.colorModeForRenderPass());C()}else{for(const Y of Z)wf(Y.mesh,Y.nodeModelMatrix,f,s);for(const Y of K)wf(Y.mesh,Y.nodeModelMatrix,f,s);C()}}},Tf={line:function(f,t,s){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const d=t.getVisibleCoordinates();for(const _ of d){const v=t.getTile(_).getBucket(f);if(v&&(v.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,t,s){const d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,d.type==="vector"?f.scope:""));if(d.type==="batched-model"||d.type!=="model")return;const _=d.getModels();for(const v of _)v.upload(s.context)},raster:function(f,t,s){const d=t.getSource();if(!(d instanceof tu&&d.loaded()))return;const _=f.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!_)return;const v=f.paint.get("raster-array-band")||d.getInitialBand(_);if(v==null)return;const S=t.getIds().map((E=>t.getTileByID(E)));for(const E of S)E.updateNeeded(f.id,v)&&d.prepareTile(E,_,f.id,v)},"raster-particle":function(f,t,s){const d=t.getSource();if(!(d instanceof tu&&d.loaded()))return;const _=f.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!_)return;const v=f.paint.get("raster-particle-array-band")||d.getInitialBand(_);if(v==null)return;const S=t.getIds().map((E=>t.getTileByID(E)));for(const E of S)E.updateNeeded(f.id,v)&&d.prepareTile(E,_,f.id,v)}},Ef={fill:nr},ma={fill:function(f,t,s,d){if(!s.layout||s.layout.get("fill-elevation-reference")==="none")return;const _=f.context.gl,v=new Qt(_.LEQUAL,Qt.ReadOnly,f.depthRangeFor3D),S=new Ar({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),E=f.transform.getFreeCameraOptions().position,C=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const k of d){const L=t.getTile(k),j=L.getBucket(s);if(!j)continue;const B=j.elevatedStructures;if(!B||B.depthSegments.segments[0].primitiveLength===0)continue;const q=bc(k.toUnwrapped(),E),K=f.translatePosMatrix(k.projMatrix,L,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),Z=ml(K,q,0,1,0);C.draw(f,_.TRIANGLES,v,S,Wr.disabled,Sr.disabled,Z,s.id,B.vertexBuffer,B.indexBuffer,B.depthSegments,s.paint,f.transform.zoom)}}};class Cu{constructor(t,s,d,_,v,S){this.context=new yc(t,s),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=a.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const E=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const k of E)this._debugParams.enabledLayers[k]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),v.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const k of E)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],k);this.occlusionParams=new Ac(v),this.setup(),this.numSublayers=Go.maxUnderzooming+Go.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new a.eE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Yg(this),this._wireframeDebugCache=new Iu,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const C=new a.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new a.T(this.context,C,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_,this.worldview=S}updateTerrain(t,s){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new sf(this,t));const _=this._terrain;this.transform.elevation=d?_:null,_.update(t,this.transform,s),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(t){const s=t.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,_]=s.getFovAdjustedRange(this.transform._fov);if(d>_)return void(this.transform.fogCullDistSq=null);const v=d+.78*(_-d);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new sf(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,s){if(this.width=t*a.q.devicePixelRatio,this.height=s*a.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const t=this.context,s=new a.ba;s.emplaceBack(0,0),s.emplaceBack(a.aj,0),s.emplaceBack(0,a.aj),s.emplaceBack(a.aj,a.aj),this.tileExtentBuffer=t.createVertexBuffer(s,a.bc.members),this.tileExtentSegments=a.bd.simpleSegment(0,0,4,2);const d=new a.ba;d.emplaceBack(0,0),d.emplaceBack(a.aj,0),d.emplaceBack(0,a.aj),d.emplaceBack(a.aj,a.aj),this.debugBuffer=t.createVertexBuffer(d,a.bc.members),this.debugSegments=a.bd.simpleSegment(0,0,4,5);const _=new a.ba;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,a.bc.members),this.viewportSegments=a.bd.simpleSegment(0,0,4,2);const v=new a.aZ;v.emplaceBack(0,0,0,0),v.emplaceBack(a.aj,0,a.aj,0),v.emplaceBack(0,a.aj,0,a.aj),v.emplaceBack(a.aj,a.aj,a.aj,a.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(v,a.bf.members),this.mercatorBoundsSegments=a.bd.simpleSegment(0,0,4,2);const S=new a.a_;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S);const E=new a.bb;for(const k of[0,1,3,2,0])E.emplaceBack(k);this.debugIndexBuffer=t.createIndexBuffer(E),this.emptyTexture=new a.T(t,new a.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=a.bz();const C=this.context.gl;this.stencilClearMode=new Ar({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Qt.disabled,this.stencilClearMode,Wr.disabled,Sr.disabled,na(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,s,d){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const C of d)if(this._tileClippingMaskIDs[C.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=s.id;const _=this.context,v=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(Wr.disabled),_.setDepthMode(Qt.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of d){const C=s.getTile(E),k=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:j,tileBoundsSegments:B}=this.getTileBoundsBuffers(C);S.draw(this,v.TRIANGLES,Qt.disabled,new Ar({func:v.ALWAYS,mask:0},k,255,v.KEEP,v.KEEP,v.REPLACE),Wr.disabled,Sr.disabled,na(E.projMatrix),"$clipping",L,j,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new Ar({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new Ar({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,d=t.sort(((S,E)=>E.overscaledZ-S.overscaledZ)),_=d[d.length-1].overscaledZ,v=d[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const S={};for(let E=0;E<v;E++)S[E+_]=new Ar({func:s.GEQUAL,mask:255},E+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=v,[S,d]}return[{[_]:Ar.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Wr([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new a.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Wr.unblended:Wr.alphaBlended}colorModeForDrapableLayerRenderPass(t){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Wr([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new a.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,s,d,_=!1){if(this.depthOcclusion)return new Qt(this.context.gl.GREATER,Qt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return Qt.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Qt(d||this.context.gl.LEQUAL,s,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,s=Math.ceil(this.width),d=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),v=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&d!==0&&(this.depthFBO=new gl(this.context,s,d,!1,"texture"),this.depthTexture=new a.T(this.context,{width:s,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),t.bindTexture(t.TEXTURE_2D,v),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,s,d,0,0,s,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,s)=>t+s/this._fpsHistory.length),0))}render(t,s){const d=a.q.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=s;const _=this.style._mergedLayers,v=!(!this.terrain||!this.terrain.enabled),S=()=>this.style._getOrder(v).filter((qe=>{const Re=_[qe];return!(Re.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Re.type]}));let E=S(),C=!1,k=!1,L=null;for(const qe of E){const Re=_[qe];Re.type==="circle"?C=!0:Re.type==="building"?L=Re:Re.type==="symbol"&&(Re.hasInitialOcclusionOpacityProperties?k=!0:C=!0)}let j=E.map((qe=>_[qe]));const B=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.q.now()),this.imageManager.beginFrame();let q=0,K=!1;for(const qe in B){const Re=B[qe];Re.used&&(Re.prepare(this.context),Re.getSource().usedInConflation&&++q)}let Z=!1;for(const qe of j)qe.isHidden(this.transform.zoom)||(qe.type==="clip"&&(Z=!0),this.prepareLayer(qe));const J={},Y={},se={},ce={},pe={};for(const qe in B){const Re=B[qe];J[qe]=Re.getVisibleCoordinates(),Y[qe]=J[qe].slice().reverse(),se[qe]=Re.getVisibleCoordinates(!0).reverse(),ce[qe]=Re.getShadowCasterCoordinates(),pe[qe]=Re.sortCoordinatesByDistance(J[qe])}const Se=qe=>{const Re=this.style.getLayerSourceCache(qe);return Re&&Re.used?Re.getSource():null};if(q||Z||this._clippingActiveLastFrame){const qe=[],Re=[];let tt=0;for(const Ye of j)this.isSourceForClippingOrConflation(Ye,Se(Ye))&&(qe.push(Ye),Re.push(tt)),tt++;if(qe&&(Z||qe.length>1)||this._clippingActiveLastFrame){Z=!1;const Ye=[];for(let vt=0;vt<qe.length;vt++){const bt=qe[vt],It=Re[vt],Dt=this.style.getLayerSourceCache(bt);if(!Dt||!Dt.used||!Dt.getSource().usedInConflation&&bt.type!=="clip"&&bt.type!=="building")continue;let lr=a.eF,pr=a.bW.None;const Yt=[];let dr=!0;if(bt.type==="building")lr=a.eH;else if(bt.type==="clip"){lr=It;for(const ur of bt.layout.get("clip-layer-types"))pr|=ur==="model"?a.bW.Model:ur==="symbol"?a.bW.Symbol:a.bW.FillExtrusion;for(const ur of bt.layout.get("clip-layer-scope"))Yt.push(ur);bt.isHidden(this.transform.zoom)?dr=!1:Z=!0}dr&&Ye.push({layer:bt.fqid,cache:Dt,order:lr,clipMask:pr,clipScope:Yt})}this.replacementSource.setSources(Ye),K=!0}}this._clippingActiveLastFrame=Z,K||this.replacementSource.clear(),this.conflationActive=K,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let qe=0;qe<j.length;qe++){const Re=j[qe],tt=Re.cutoffRange();if(this.longestCutoffRange=Math.max(tt,this.longestCutoffRange),tt>0){const Ye=Se(Re);Ye&&(this.minCutoffZoom=Math.max(Ye.minzoom,this.minCutoffZoom)),Re.minzoom&&(this.minCutoffZoom=Math.max(Re.minzoom,this.minCutoffZoom))}Re.is3D(v)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=qe),this._lastOcclusionLayer=qe)}const Pe=this.style&&this.style.fog;Pe?(this._fogVisible=Pe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Pe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(se),this.opaquePassCutoff=0,E=S(),j=E.map((qe=>_[qe])));const Me=this._shadowRenderer;if(Me){Me.updateShadowParameters(this.transform,this.style.directionalLight);for(const qe in B)for(const Re of J[qe]){let tt={min:0,max:0};this.terrain&&(tt=this.terrain.getMinMaxForTile(Re)||tt),Me.addShadowReceiver(Re.toUnwrapped(),tt.min,tt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.eG(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Ve(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Ee=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Te&&!this._snow&&(this._snow=new Rp(this)),!Te&&this._snow&&(this._snow.destroy(),delete this._snow),Ee&&!this._rain&&(this._rain=new Pc(this)),!Ee&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),L){this.buildingTileBorderManager||(this.buildingTileBorderManager=new hs);const qe=this.style.getLayerSourceCache(L);this.buildingTileBorderManager.updateBorders(qe,L)}if(!pn.has(this.context.gl))return;this.renderPass="offscreen";for(const qe of j){const Re=t.getLayerSourceCache(qe);if(!qe.hasOffscreenPass()||qe.isHidden(this.transform.zoom))continue;const tt=Re?Y[Re.id]:void 0;(qe.type==="custom"||qe.type==="raster"||qe.type==="raster-particle"||qe.isSky()||tt&&tt.length)&&this.renderLayer(this,Re,qe,tt)}this.depthRangeFor3D=[0,1-(j.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ce)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ae=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),We=(()=>{if(s.showOverdrawInspector)return a.am.black;const qe=this.style.fog;if(qe&&this.transform.projection.supportsFog){const Re=this.style.getLut(qe.scope);if(!Ae){const tt=qe.properties.get("color-use-theme")==="none",Ye=qe.properties.get("color").toNonPremultipliedRenderColor(tt?null:Re).toArray01();return new a.am(...Ye)}if(Ae){const tt=qe.properties.get("space-color-use-theme")==="none",Ye=qe.properties.get("space-color").toNonPremultipliedRenderColor(tt?null:Re).toArray01();return new a.am(...Ye)}}return a.am.transparent})();if(this.context.clear({color:We,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ae&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=E.length-1;this.currentLayer>=0;this.currentLayer--){const qe=j[this.currentLayer],Re=t.getLayerSourceCache(qe);if(qe.isSky())continue;const tt=Re?(qe.is3D(v)?pe:Y)[Re.id]:void 0;this._renderTileClippingMasks(qe,Re,tt),this.renderLayer(this,Re,qe,tt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ae&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||a.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<E.length;this.currentLayer++){const qe=j[this.currentLayer],Re=t.getLayerSourceCache(qe);qe.isSky()&&this.renderLayer(this,Re,qe,Re?Y[Re.id]:void 0)}function Le(qe,Re){let tt;return Re&&(tt=(qe.type==="symbol"?se:qe.is3D(v)?pe:Y)[Re.id]),tt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<E.length;){const qe=j[this.currentLayer];if(qe.type==="raster"||qe.type==="raster-particle"){const Re=t.getLayerSourceCache(qe);this.renderLayer(this,Re,qe,Le(qe,Re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ut=0;Me&&(ut=Me.getShadowCastingLayerCount());let Je=!1,dt=-1;for(let qe=0;qe<E.length;++qe){const Re=j[qe];Re.isHidden(this.transform.zoom)||Re.is3D(v)&&(dt=qe)}k&&dt===-1&&(C=!0);let wt=!1;for(;this.currentLayer<E.length;){const qe=j[this.currentLayer],Re=t.getLayerSourceCache(qe);if(qe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(qe)){if(qe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!wt&&qe.is3D(v)&&!v){const tt=this.currentLayer,Ye=vt=>{for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const bt=j[this.currentLayer];if(Ef[bt.type]){const It=this.style.getLayerSourceCache(bt);Ef[bt.type](this,It,bt,Le(bt,It),vt)}}};Ye("initialize"),Ye("reset"),this.currentLayer=tt,wt=!0}if(C&&!Je&&this.terrain&&!this.transform.isOrthographic&&(Je=!0,this.blitDepth()),k&&dt!==-1&&this.currentLayer===dt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(qe,Re,Re?J[Re.id]:void 0),this.renderLayer(this,Re,qe,Le(qe,Re)),!this.terrain&&Me&&ut>0&&qe.hasShadowPass()&&--ut==0){{this.clearStencil(),this.resetStencilClippingMasks();const tt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const Ye=j[this.currentLayer];if(ma[Ye.type]){const vt=this.style.getLayerSourceCache(Ye);ma[Ye.type](this,vt,Ye,Le(Ye,vt))}}this.currentLayer=tt}if(Me.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const tt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=tt;this.currentLayer++){const Ye=j[this.currentLayer];if(!Ye.hasLightBeamPass())continue;const vt=t.getLayerSourceCache(Ye);this.renderLayer(this,vt,Ye,vt?Y[vt.id]:void 0)}this.currentLayer=tt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const tt=this.currentLayer;this.depthOcclusion=!0;for(const Ye of this.layersWithOcclusionOpacity){this.currentLayer=Ye;const vt=j[this.currentLayer],bt=t.getLayerSourceCache(vt),It=bt?Y[bt.id]:void 0;this.terrain||this._renderTileClippingMasks(vt,bt,bt?J[bt.id]:void 0),this.renderLayer(this,bt,vt,It)}this.depthOcclusion=!1,this.currentLayer=tt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let qe=null;j.forEach((Re=>{const tt=t.getLayerSourceCache(Re);tt&&!Re.isHidden(this.transform.zoom)&&tt.getVisibleCoordinates().length&&(!qe||qe.getSource().maxzoom<tt.getSource().maxzoom)&&(qe=tt)})),qe&&this.options.showTileBoundaries&&cs(this,qe,qe.getVisibleCoordinates(),a.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&cs(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new a.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(qe){const Re=qe.transform.padding;Fs(qe,qe.transform.height-(Re.top||0),3,Sd),Fs(qe,Re.bottom||0,3,Ji),Hi(qe,Re.left||0,3,gh),Hi(qe,qe.transform.width-(Re.right||0),3,xf);const tt=qe.transform.centerPoint;(function(Ye,vt,bt,It){ao(Ye,vt-1,bt-10,2,20,It),ao(Ye,vt-10,bt-1,20,2,It)})(qe,tt.x,qe.transform.height-tt.y,Td)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),K||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:s}=this.transform.projection,d=!s||!s.includes(t.type);if(Tf[t.type]&&(d||this.terrain&&t.type==="custom")){const _=this.style.getLayerSourceCache(t);Tf[t.type](t,_,this)}this.gpuTimingEnd()}renderLayer(t,s,d,_){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||_&&_.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||Md[d.type](t,s,d,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,d=this.context.gl;let _=this.gpuTimers[t.id];_||(_=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),_.calls++,d.beginQuery(s.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,s=this.context.gl,d=s.createQuery();this.deferredRenderGpuTimeQueries.push(d),s.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const s={};for(const d in t){const _=t[d],v=this.context.extTimerQuery,S=v.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(_.query),s[d]=S}return s}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let d=0;for(const _ of t)d+=s.getQueryParameter(_,s.QUERY_RESULT)/1e6,s.deleteQuery(_);return d}translatePosMatrix(t,s,d,_,v){if(!d[0]&&!d[1])return t;const S=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(S){const k=Math.sin(S),L=Math.cos(S);d=[d[0]*L-d[1]*k,d[0]*k+d[1]*L]}const E=[v?d[0]:a.aw(s,d[0],this.transform.zoom),v?d[1]:a.aw(s,d[1],this.transform.zoom),0],C=new Float32Array(16);return a.bo(C,t,E),C}saveTileTexture(t){if(t.context!==this.context)return;const s=t.size[0],d=this._tileTextures[s];d?d.push(t):this._tileTextures[s]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,s,d){const _=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,v=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||v.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||_||s!==void 0&&!s||v.push("FOG","FOG_DITHERING"),_&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(t,s){this.cache=this.cache||{};const d=s&&s.defines||[],_=s&&s.config,v=this.currentGlobalDefines(t,s&&s.overrideFog,s&&s.overrideRtt).concat(d),S=ys.cacheKey(sc[t],t,v,_);return this.cache[S]||(this.cache[S]=new ys(this.context,t,sc[t],_,Mp[t],v)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,s){if(this.style.enable3dLights()){const d=this.style.directionalLight,_=this.style.ambientLight;if(d&&_){const v=((S,E,C)=>{const k=S.properties.get("direction"),L=S.properties.get("color-use-theme")==="none",j=S.properties.get("color").toNonPremultipliedRenderColor(L?null:C.getLut(S.scope)).toArray01(),B=S.properties.get("intensity"),q=E.properties.get("color-use-theme")==="none",K=E.properties.get("color").toNonPremultipliedRenderColor(q?null:C.getLut(E.scope)).toArray01(),Z=E.properties.get("intensity"),J=[k.x,k.y,k.z],Y=a.dI(K,Z),se=a.dI(j,B);return{u_lighting_ambient_color:Y,u_lighting_directional_dir:J,u_lighting_directional_color:se,u_ground_radiance:gd(J,se,Y)}})(d,_,this.style);s.setLightsUniformValues(t,v)}}}uploadCommonUniforms(t,s,d,_,v){if(this.uploadCommonLightUniforms(t,s),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const E=S.getOpacity(this.transform.pitch),C=((k,L,j,B,q,K,Z,J,Y,se,ce,pe)=>{const Se=k.transform,Pe=L.properties.get("color-use-theme")==="none",Me=L.properties.get("color").toNonPremultipliedRenderColor(Pe?null:k.style.getLut(L.scope)).toArray01();Me[3]=B;const Te=k.frameCounter/1e3%1,[Ee,Ae]=L.properties.get("vertical-range");return{u_fog_matrix:j?Se.calculateFogTileMatrix(j):pe||k.identityMat,u_fog_range:L.getFovAdjustedRange(Se._fov),u_fog_color:Me,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ee,Ae),Ae],u_fog_temporal_offset:Te,u_frustum_tl:q,u_frustum_tr:K,u_frustum_br:Z,u_frustum_bl:J,u_globe_pos:Y,u_globe_radius:se,u_viewport:ce,u_globe_transition:a.ah(Se.zoom),u_is_globe:+(Se.projection.name==="globe")}})(this,S,d,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.q.devicePixelRatio,this.transform.height*a.q.devicePixelRatio],_);s.setFogUniformValues(t,C)}v&&s.setCutoffUniformValues(t,v.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const _ of d)s[_.key]=t[_.key]||new ou(_,512,this.transform.tileZoom,this,void 0,this.worldview);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,s){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[t.key];return s||(this._cachedTileFogOpacities[t.key]=s=this.style.fog.getOpacityForTile(t)),s[0]>=mt||s[1]>=mt}setupDepthForOcclusion(t,s,d){const _=this.context,v=_.gl,S=!!d;var E;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(v.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((E=this.depthRangeFor3D)[1]-E[0]),-1-2*E[0]/(E[1]-E[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),_.activeTexture.set(v.TEXTURE0),S||s.setTerrainUniformValues(_,d)}}function xh(f,t){let s=!1,d=null;const _=()=>{d=null,s&&(f(),d=setTimeout(_,t),s=!1)};return()=>(s=!0,d||_(),d)}class Od{constructor(t){this._hashName=t&&encodeURIComponent(t),a.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=xh(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const s=Ha(t);if(this._hashName){const d=this._hashName;let _=!1;const v=location.hash.slice(1).split("&").map((S=>{const E=S.split("=")[0];return E===d?(_=!0,`${E}=${s}`):S})).filter((S=>S));return _||v.push(`${d}=${s}`),`#${v.join("&")}`}return`#${s}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map((d=>d.split("="))).forEach((d=>{d[0]===this._hashName&&(s=d)})),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some((d=>isNaN(Number(d))))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:d,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Ha(f,t){const s=f.getCenter(),d=Math.round(100*f.getZoom())/100,_=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),S=Math.round(s.lng*v)/v,E=Math.round(s.lat*v)/v,C=f.getBearing(),k=f.getPitch();let L=t?`/${S}/${E}/${d}`:`${d}/${E}/${S}`;return(C||k)&&(L+="/"+Math.round(10*C)/10),k&&(L+=`/${Math.round(k)}`),L}const Mu={linearity:.3,easing:a.eI(0,0,.3,1)},Us=a.h({deceleration:2500,maxSpeed:1400},Mu),Rd=a.h({deceleration:20,maxSpeed:1400},Mu),Vs=a.h({deceleration:1e3,maxSpeed:360},Mu),kd=a.h({deceleration:1e3,maxSpeed:90},Mu);class bh{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=a.q.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)s.zoom+=v.zoomDelta||0,s.bearing+=v.bearingDelta||0,s.pitch+=v.pitchDelta||0,v.panDelta&&s.pan._add(v.panDelta),v.around&&(s.around=v.around),v.pinchAround&&(s.pinchAround=v.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(s.pan.mag()){const v=Ou(s.pan.mag(),d,a.h({},Us,t||{}));_.offset=s.pan.mult(v.amount/s.pan.mag()),_.center=this._map.transform.center,$s(_,v)}if(s.zoom){const v=Ou(s.zoom,d,Rd);_.zoom=this._map.transform.zoom+v.amount,$s(_,v)}if(s.bearing){const v=Ou(s.bearing,d,Vs);_.bearing=this._map.transform.bearing+a.ay(v.amount,-179,179),$s(_,v)}if(s.pitch){const v=Ou(s.pitch,d,kd);_.pitch=this._map.transform.pitch+v.amount,$s(_,v)}if(_.zoom||_.bearing){const v=s.pinchAround===void 0?s.around:s.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function $s(f,t){(!f.duration||f.duration<t.duration)&&(f.duration=t.duration,f.easing=t.easing)}function Ou(f,t,s){const{maxSpeed:d,linearity:_,deceleration:v}=s,S=a.ay(f*_/(t/1e3),-d,d),E=Math.abs(S)/(v*_);return{easing:s.easing,duration:1e3*E,amount:S*(E/2)}}class ai extends a.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,d,_={}){const v=Ne(s.getCanvasContainer(),d),S=s.unproject(v);super(t,a.h({point:v,lngLat:S,originalEvent:d},_)),this._defaultPrevented=!1,this.target=s}}class wh extends a.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,d){const _=t==="touchend"?d.changedTouches:d.touches,v=rt(s.getCanvasContainer(),_),S=v.map((C=>s.unproject(C))),E=v.reduce(((C,k,L,j)=>C.add(k.div(j.length))),new a.P(0,0));super(t,{points:v,point:E,lngLats:S,lngLat:s.unproject(E),originalEvent:d}),this._defaultPrevented=!1}}class Dd extends a.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class zd{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Dd(this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new ai(t.type,this._map,t))}mouseup(t){this._map.fire(new ai(t.type,this._map,t))}preclick(t){const s=a.h({},t);s.type="preclick",this._map.fire(new ai(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new ai(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new ai(t.type,this._map,t))}mouseover(t){this._map.fire(new ai(t.type,this._map,t))}mouseout(t){this._map.fire(new ai(t.type,this._map,t))}touchstart(t){return this._firePreventable(new wh(t.type,this._map,t))}touchmove(t){this._map.fire(new wh(t.type,this._map,t))}touchend(t){this._map.fire(new wh(t.type,this._map,t))}touchcancel(t){this._map.fire(new wh(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ru{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new ai(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ai("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new ai(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ld{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(ke(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const d=s,_=this._startPos,v=this._lastPos;if(!_||!v||v.equals(d)||!this._box&&d.dist(_)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=ee("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const S=Math.min(_.x,d.x),E=Math.max(_.x,d.x),C=Math.min(_.y,d.y),k=Math.max(_.y,d.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${S}px,${C}px)`,this._box.style.width=E-S+"px",this._box.style.height=k-C+"px")}))}mouseupWindow(t,s){if(!this._active)return;const d=this._startPos,_=s;if(d&&t.button===0){if(this.reset(),ze(),d.x!==_.x||d.y!==_.y)return this._map.fire(new a.A("boxzoomend",{originalEvent:t})),{cameraAnimation:v=>v.fitScreenCoordinates(d,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),he(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new a.A(t,{originalEvent:s}))}}function Sh(f,t){const s={};for(let d=0;d<f.length;d++)s[f[d].identifier]=t[d];return s}class kp{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=(function(_){const v=new a.P(0,0);for(const S of _)v._add(S);return v.div(_.length)})(s),this.touches=Sh(d,s)))}touchmove(t,s,d){if(this.aborted||!this.centroid)return;const _=Sh(d,s);for(const v in this.touches){const S=_[v];(!S||S.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(t,s,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class To{constructor(t){this.singleTap=new kp(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,d){this.singleTap.touchstart(t,s,d)}touchmove(t,s,d){this.singleTap.touchmove(t,s,d)}touchend(t,s,d){const _=this.singleTap.touchend(t,s,d);if(_){const v=t.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(_)<30;if(v&&S||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class oa{constructor(){this._zoomIn=new To({numTouches:1,numTaps:2}),this._zoomOut=new To({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,d){this._zoomIn.touchstart(t,s,d),this._zoomOut.touchstart(t,s,d)}touchmove(t,s,d){this._zoomIn.touchmove(t,s,d),this._zoomOut.touchmove(t,s,d)}touchend(t,s,d){const _=this._zoomIn.touchend(t,s,d),v=this._zoomOut.touchend(t,s,d);return _?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(_)},{originalEvent:t})}):v?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(v)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Fd={0:1,2:2},Af={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Cc{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const d=kt(t);this._correctButton(t,d)&&(this._lastPoint=s,this._eventButton=d)}mousemoveWindow(t,s){const d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&(function(_,v){const S=Fd[v];return _.buttons===void 0||(_.buttons&S)!==S})(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(d,s)}}mouseupWindow(t){this._lastPoint&&kt(t)===this._eventButton&&(this._moved&&ze(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bd extends Cc{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class Pf extends Cc{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Af[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const d=.8*(s.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class If extends Cc{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Af[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const d=-.5*(s.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Dp{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),a.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}touchstart(t,s,d){return this._calculateTransform(t,s,d)}touchmove(t,s,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!a.eJ())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,s,d)}}touchend(t,s,d){this._calculateTransform(t,s,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,d){d.length>0&&(this._active=!0);const _=Sh(d,s),v=new a.P(0,0),S=new a.P(0,0);let E=0;for(const k in _){const L=_[k],j=this._touches[k];j&&(v._add(L),S._add(L.sub(j)),E++,_[k]=L)}if(this._touches=_,E<this._minTouches||!S.mag())return;const C=S.div(E);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(E),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ee("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Th{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,d){return{}}touchstart(t,s,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,d){const _=this._firstTwoTouches;if(!_)return;t.preventDefault();const[v,S]=_,E=Eh(d,s,v),C=Eh(d,s,S);if(!E||!C)return;const k=this._aroundCenter?null:E.add(C).div(2);return this._move([E,C],k,t)}touchend(t,s,d){if(!this._firstTwoTouches)return;const[_,v]=this._firstTwoTouches,S=Eh(d,s,_),E=Eh(d,s,v);S&&E||(this._active&&ze(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Eh(f,t,s){for(let d=0;d<f.length;d++)if(f[d].identifier===s)return t[d]}function Nd(f,t){return Math.log(f/t)/Math.LN2}class jd extends Th{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Nd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nd(this._distance,d),pinchAround:s}}}function Cf(f,t){return 180*f.angleWith(t)/Math.PI}class zp extends Th{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Cf(this._vector,d),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const _=Cf(t,d);return Math.abs(_)<s}}function Ah(f){return Math.abs(f.y)>Math.abs(f.x)}class Mf extends Th{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Ah(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,d){const _=this._lastPoints;if(!_)return;const v=t[0].sub(_[0]),S=t[1].sub(_[1]);return this._map._cooperativeGestures&&!a.eJ()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(v,S,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(v.y+S.y)/2*-.5})}gestureBeginsVertically(t,s,d){if(this._valid!==void 0)return this._valid;const _=t.mag()>=2,v=s.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const S=t.y>0==s.y>0;return Ah(t)&&Ah(s)&&S}}const Om={panStep:100,bearingStep:15,pitchStep:10};class Lp{constructor(){const t=Om;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,d=0,_=0,v=0,S=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),v=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),v=1);break;case 38:t.shiftKey?_=1:(t.preventDefault(),S=-1);break;case 40:t.shiftKey?_=-1:(t.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(d=0,_=0),{cameraAnimation:E=>{const C=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Ud,zoom:s?Math.round(C)+s*(t.shiftKey?2:1):C,bearing:E.getBearing()+d*this._bearingStep,pitch:E.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-S*this._panStep],center:E.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ud(f){return f*(2-f)}const Fp=4.000244140625,Vd=1/450;class $l{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Vd,a.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||a.eJ()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=a.q.now(),_=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,s!==0&&s%Fp==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(_*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Ne(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>Fp?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&L!==0&&(L=1/L);const j=s(),B=Math.pow(2,j),q=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(q*L))),this._type==="wheel"&&(this._startZoom=j,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:s(),_=this._startZoom,v=this._easing;let S,E=!1;if(this._type==="wheel"&&_&&v){const k=Math.min((a.q.now()-this._lastWheelEventTime)/200,1),L=v(k);S=a.ai(_,d,L),k<1?this._frameId||(this._frameId=!0):E=!0}else S=d,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let C=S-s();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=a.eK;if(this._prevEase){const d=this._prevEase,_=(a.q.now()-d.start)/d.duration,v=d.easing(_+.01)-d.easing(_),S=.27/Math.sqrt(v*v+1e-4)*.01,E=Math.sqrt(.0729-S*S);s=a.eI(S,E,.25,1)}return this._prevEase={start:a.q.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ee("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class wi{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Bp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Np{constructor(){this._tap=new To({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=s[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,s,d))}touchmove(t,s,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const _=s[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,t.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(t,s,d)}touchend(t,s,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,s,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $d{constructor(t,s,d){this._el=t,this._mousePan=s,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rm{constructor(t,s,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ql{constructor(t,s,d,_){this._el=t,this._touchZoom=s,this._touchRotate=d,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Oo=f=>f.zoom||f.drag||f.pitch||f.rotate;class jp extends a.A{}class qd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const d=a.at([],s,t);this.radius=a.ae(d[2]<0?a.eM([],d,this.constants):[d[0],d[1],0])}projectRay(t){a.eM(t,t,this.constants),a.au(t,t),a.eN(t,t,this.constants);const s=a.c1([],t,this.radius);if(s[2]>0){const d=a.c1([],[0,0,1],a.bG(s,[0,0,1])),_=a.c1([],a.au([],[s[0],s[1],0]),this.radius),v=a.d5([],s,a.c1([],a.at([],a.d5([],_,d),s),2));s[0]=v[0],s[1]=v[1]}return s}}function Ca(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class jo{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bh(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new qd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),a.aV(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,v,S]of this._listeners){const E=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(v,E,S)}}destroy(){for(const[t,s,d]of this._listeners){const _=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(s,_,d)}}_addDefaultHandlers(t){const s=this._map,d=s.getCanvasContainer();this._add("mapEvent",new zd(s,t));const _=s.boxZoom=new Ld(s,t);this._add("boxZoom",_);const v=new oa,S=new Bp;s.doubleClickZoom=new wi(S,v),this._add("tapZoom",v),this._add("clickZoom",S);const E=new Np;this._add("tapDragZoom",E);const C=s.touchPitch=new Mf(s);this._add("touchPitch",C);const k=new Pf(t),L=new If(t);s.dragRotate=new Rm(t,k,L),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const j=new Bd(t),B=new Dp(s,t);s.dragPan=new $d(d,j,B),this._add("mousePan",j),this._add("touchPan",B,["touchZoom","touchRotate"]);const q=new zp,K=new jd;s.touchZoomRotate=new ql(d,K,q,E),this._add("touchRotate",q,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ru(s));const Z=s.scrollZoom=new $l(s,this);this._add("scrollZoom",Z,["mousePan"]);const J=s.keyboard=new Lp;this._add("keyboard",J);for(const Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Y]&&s[Y].enable(t[Y])}_add(t,s,d){this._handlers.push({handlerName:t,handler:s,allowed:d}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Oo(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,s,d){for(const _ in t)if(_!==d&&(!s||s.indexOf(_)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const d of t)this._el.contains(d.target)&&s.push(d);return s}handleEvent(t,s){this._updatingCamera=!0;const d=t.type==="renderFrame",_=d?void 0:t,v={needsRenderFrame:!1},S={},E={},C=t.touches?this._getMapTouches(t.touches):void 0,k=C?rt(this._el,C):d?void 0:Ne(this._el,t);for(const{handlerName:B,handler:q,allowed:K}of this._handlers){if(!q.isEnabled())continue;let Z;this._blockedByActive(E,K,B)?q.reset():q[s||t.type]&&(Z=q[s||t.type](t,k,C),this.mergeHandlerResult(v,S,Z,B,_),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||q.isActive())&&(E[B]=q)}const L={};for(const B in this._previousActiveHandlers)E[B]||(L[B]=_);this._previousActiveHandlers=E,(Object.keys(L).length||Ca(v))&&(this._changes.push([v,S,L]),this._triggerRenderFrame()),(Object.keys(E).length||Ca(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=v;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(t,s,d,_,v){if(!d)return;a.h(t,d);const S={handlerName:_,originalEvent:d.originalEvent||v};d.zoomDelta!==void 0&&(s.zoom=S),d.panDelta!==void 0&&(s.drag=S),d.pitchDelta!==void 0&&(s.pitch=S),d.bearingDelta!==void 0&&(s.rotate=S)}_applyChanges(){const t={},s={},d={};for(const[_,v,S]of this._changes)_.panDelta&&(t.panDelta=(t.panDelta||new a.P(0,0))._add(_.panDelta)),_.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(t.around=_.around),_.aroundCoord!==void 0&&(t.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(t.pinchAround=_.pinchAround),_.noInertia&&(t.noInertia=_.noInertia),a.h(s,v),a.h(d,S);this._updateMapTransform(t,s,d),this._changes=[]}_updateMapTransform(t,s,d){const _=this._map,v=_.transform,S=se=>[se.x,se.y,se.z];if((se=>{const ce=this._eventsInProgress.drag;return ce&&!this._handlersById[ce.handlerName].isActive()})()&&!Ca(t)){const se=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),se!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&_._stop(!0),!Ca(t))return void this._fireEvents(s,d,!0);let{panDelta:E,zoomDelta:C,bearingDelta:k,pitchDelta:L,around:j,aroundCoord:B,pinchAround:q}=t;v._isCameraConstrained&&(C>0&&(C=0),v._isCameraConstrained=!1),q!==void 0&&(j=q),(C||(se=>s[se]&&!this._eventsInProgress[se])("drag"))&&j&&(this._dragOrigin=S(v.pointCoordinate3D(j)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",_._stop(!0),j=j||_.transform.centerPoint,k&&(v.bearing+=k),L&&(v.pitch+=L),v._updateCameraState();const K=[0,0,0];if(E)if(v.projection.name==="mercator"){const se=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(j).dir),ce=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(j.sub(E)).dir);K[0]=ce[0]-se[0],K[1]=ce[1]-se[1]}else{const se=v.pointCoordinate(j);if(v.projection.name==="globe"){E=E.rotate(-v.angle);const ce=v._pixelsPerMercatorPixel/v.worldSize;K[0]=-E.x*a.eL(a.aY(se.y))*ce,K[1]=-E.y*a.eL(v.center.lat)*ce}else{const ce=v.pointCoordinate(j.sub(E));se&&ce&&(K[0]=ce.x-se.x,K[1]=ce.y-se.y)}}const Z=v.zoom,J=[0,0,0];if(C){const se=S(B||v.pointCoordinate3D(j)),ce={dir:a.au([],a.at([],se,v._camera.position))};if(ce.dir[2]<0){const pe=v.zoomDeltaToMovement(se,C);a.c1(J,ce.dir,pe)}}const Y=a.d5(K,K,J);v._translateCameraConstrained(Y),C&&Math.abs(v.zoom-Z)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,d,!0)}_fireEvents(t,s,d){const _=Oo(this._eventsInProgress),v=Oo(t),S={};for(const L in t){const{originalEvent:j}=t[L];this._eventsInProgress[L]||(S[`${L}start`]=j),this._eventsInProgress[L]=t[L]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(const L in S)this._fireEvent(L,S[L]);v&&this._fireEvent("move",v.originalEvent);for(const L in t){const{originalEvent:j}=t[L];this._fireEvent(L,j)}const E={};let C;for(const L in this._eventsInProgress){const{handlerName:j,originalEvent:B}=this._eventsInProgress[L];this._handlersById[j].isActive()||(delete this._eventsInProgress[L],C=s[j]||B,E[`${L}end`]=C)}for(const L in E)this._fireEvent(L,E[L]);const k=Oo(this._eventsInProgress);if(d&&(_||v)&&!k){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;L?(j(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:C})):(this._map.fire(new a.A("moveend",{originalEvent:C})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new a.A(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new jp("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const $i="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Nr extends a.E{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,a.aV(["_renderFrameCallback"],this)}getCenter(){return new a.ci(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,d){return t=a.P.convert(t).mult(-1),this.panTo(this.transform.center,a.h({offset:t},s),d)}panTo(t,s,d){return this.easeTo(a.h({center:t},s),d)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,d){return this.easeTo(a.h({zoom:t},s),d)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,d){return this.easeTo(a.h({bearing:t},s),d)}resetNorth(t,s){return this.rotateTo(0,a.h({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(a.h({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=a.aG.convert(t);const d=s&&s.bearing||0,_=s&&s.pitch||0,v=t.getNorthWest(),S=t.getSouthEast();return this._cameraForBounds(this.transform,v,S,d,_,s)}_extendPadding(t){const s={top:0,right:0,bottom:0,left:0};return t==null?a.h({},s,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:a.h({},s,t)}_extendCameraOptions(t){return(t=a.h({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,s){const d=s.max[0]-s.min[0],_=s.max[1]-s.min[1];return d/_>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):_/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,s,d,_,v,S){const E=t.clone(),C=this._extendCameraOptions(S);E.bearing=_,E.pitch=v;const k=a.ci.convert(s),L=a.ci.convert(d),j=.5*(k.lat+L.lat),B=.5*(k.lng+L.lng),q=a.eO(j,B),K=a.au([],q),Z=a.au([],a.bF([],K,[0,1,0])),J=a.bF([],Z,K),Y=[Z[0],Z[1],Z[2],0,J[0],J[1],J[2],0,K[0],K[1],K[2],0,0,0,0,1],se=[q,a.eO(k.lat,k.lng),a.eO(L.lat,k.lng),a.eO(L.lat,L.lng),a.eO(k.lat,L.lng),a.eO(j,k.lng),a.eO(j,L.lng),a.eO(k.lat,B),a.eO(L.lat,B)];let ce=a.d6.fromPoints(se.map((Ye=>[a.bG(Z,Ye),a.bG(J,Ye),a.bG(K,Ye)])));const pe=a.ad([],ce.center,Y);a.eP(pe)===0&&a.eQ(pe,0,0,1),a.au(pe,pe),a.c1(pe,pe,a.aB),E.center=a.eR(pe);const Se=E.getWorldToCameraMatrix(),Pe=a.bi(new Float64Array(16),Se);ce=a.d6.applyTransform(ce,a.az([],Se,Y));const Me=this._extendAABB(ce,E,C,_);if(!Me)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=Me,a.ad(pe,pe,Se);const Te=.5*(ce.max[2]-ce.min[2]),Ee=this._minimumAABBFrustumDistance(E,ce),Ae=a.c1([],[0,0,1],Te),We=a.d5(Ae,pe,Ae),Le=Ee+(E.pitch===0?0:a.bD(pe,We)),ut=E.globeCenterInViewSpace,Je=a.at([],pe,[ut[0],ut[1],ut[2]]);a.au(Je,Je),a.c1(Je,Je,Le);const dt=a.d5([],pe,Je);a.ad(dt,dt,Pe);const wt=a.eB/a.aB,qe=a.ae(dt),Re=a.cb(Math.max(qe*wt-a.eB,Number.EPSILON),0),tt=Math.min(E.zoomFromMercatorZAdjusted(Re),C.maxZoom);return tt>.5*(a.cX+a.cI)?(E.setProjection({name:"mercator"}),E.zoom=tt,this._cameraForBounds(E,s,d,_,v,S)):{center:E.center,zoom:tt,bearing:_,pitch:v}}_extendAABB(t,s,d,_){const v=.5*((d.padding.left||0)+(d.padding.right||0)),S=.5*((d.padding.top||0)+(d.padding.bottom||0)),E=S,C=v,k=v,L=S,j=s.width-(C+k),B=s.height-(E+L),q=a.at([],t.max,t.min),K=Math.min(j/q[0],B/q[1]),Z=Math.min(s.scaleZoom(s.scale*K),d.maxZoom);if(isNaN(Z))return null;const J=s.scale/s.zoomScale(Z),Y=new a.d6([t.min[0]-C*J,t.min[1]-L*J,t.min[2]],[t.max[0]+k*J,t.max[1]+E*J,t.max[2]]),se=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new a.P(d.offset.x,d.offset.y):a.P.convert(d.offset)).rotate(-a.al(_));return Y.center[0]-=se.x*J,Y.center[1]+=se.y*J,Y}queryTerrainElevation(t,s){const d=this.transform.elevation;return d?(s=a.h({},{exaggerated:!0},s),d.getAtPoint(a.ac.fromLngLat(t),null,s.exaggerated)):null}_cameraForBounds(t,s,d,_,v,S){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,s,d,_,v,S);const E=t.clone(),C=this._extendCameraOptions(S);E.bearing=_,E.pitch=v;const k=a.ci.convert(s),L=a.ci.convert(d),j=new a.ci(k.lng,L.lat),B=new a.ci(L.lng,k.lat),q=E.project(k),K=E.project(L),Z=this.queryTerrainElevation(k),J=this.queryTerrainElevation(L),Y=this.queryTerrainElevation(j),se=this.queryTerrainElevation(B),ce=[[q.x,q.y,Math.min(Z||0,J||0,Y||0,se||0)],[K.x,K.y,Math.max(Z||0,J||0,Y||0,se||0)]];let pe=a.d6.fromPoints(ce);const Se=E.getWorldToCameraMatrix(),Pe=a.bi(new Float64Array(16),Se);pe=a.d6.applyTransform(pe,Se);const Me=this._extendAABB(pe,E,C,_);if(!Me)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=Me;const Te=.5*a.at([],pe.max,pe.min)[2],Ee=this._minimumAABBFrustumDistance(E,pe),Ae=[0,0,1,0];a.aA(Ae,Ae,Se),a.eS(Ae,Ae);const We=a.c1([],Ae,Ee+Te),Le=a.d5([],pe.center,We);a.ad(pe.center,pe.center,Pe),a.ad(Le,Le,Pe);const ut=E.unproject(new a.P(pe.center[0],pe.center[1])),Je=a.eT(E.projection,ut),dt=Math.pow(2,Je),wt=Math.min(E._zoomFromMercatorZ(Le[2]*E.pixelsPerMeter*dt/E.worldSize),C.maxZoom);return E.mercatorFromTransition&&wt<.5*(a.cX+a.cI)?(E.setProjection({name:"globe"}),E.zoom=wt,this._cameraForBounds(E,s,d,_,v,S)):{center:ut,zoom:wt,bearing:_,pitch:v}}fitBounds(t,s,d){const _=this.cameraForBounds(t,s);return this._fitInternal(_,s,d)}fitScreenCoordinates(t,s,d,_,v){const S=a.P.convert(t),E=a.P.convert(s),C=new a.P(Math.min(S.x,E.x),Math.min(S.y,E.y)),k=new a.P(Math.max(S.x,E.x),Math.max(S.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,E))return this;const L=this.transform.pointLocation3D(C),j=this.transform.pointLocation3D(k),B=this.transform.pointLocation3D(new a.P(C.x,k.y)),q=this.transform.pointLocation3D(new a.P(k.x,C.y)),K=[Math.min(L.lng,j.lng,B.lng,q.lng),Math.min(L.lat,j.lat,B.lat,q.lat)],Z=[Math.max(L.lng,j.lng,B.lng,q.lng),Math.max(L.lat,j.lat,B.lat,q.lat)],J=_&&_.pitch?_.pitch:this.getPitch(),Y=this._cameraForBounds(this.transform,K,Z,d,J,_);return this._fitInternal(Y,_,v)}_fitInternal(t,s,d){return t?(s=a.h(t,s)).linear?this.easeTo(s,d):this.flyTo(s,d):this}jumpTo(t,s){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let _=!1,v=!1,S=!1;"zoom"in t&&d.zoom!==+t.zoom&&(_=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=a.ci.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(v=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(S=!0,d.pitch=+t.pitch);const E=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(E))if(t.retainPadding===!1){const C=d.clone();C.padding=E,d.setLocationAtPoint(d.center,C.centerPoint)}else d.padding=E;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new a.A("movestart",s)).fire(new a.A("move",s)),_&&this.fire(new a.A("zoomstart",s)).fire(new a.A("zoom",s)).fire(new a.A("zoomend",s)),v&&this.fire(new a.A("rotatestart",s)).fire(new a.A("rotate",s)).fire(new a.A("rotateend",s)),S&&this.fire(new a.A("pitchstart",s)).fire(new a.A("pitch",s)).fire(new a.A("pitchend",s)),this.fire(new a.A("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.w($i),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const d=this.transform;if(!d.projection.supportsFreeCamera)return a.w($i),this;this.stop();const _=d.zoom,v=d.pitch,S=d.bearing;d.setFreeCameraOptions(t);const E=_!==d.zoom,C=v!==d.pitch,k=S!==d.bearing;return this.fire(new a.A("movestart",s)).fire(new a.A("move",s)),E&&this.fire(new a.A("zoomstart",s)).fire(new a.A("zoom",s)).fire(new a.A("zoomend",s)),k&&this.fire(new a.A("rotatestart",s)).fire(new a.A("rotate",s)).fire(new a.A("rotateend",s)),C&&this.fire(new a.A("pitchstart",s)).fire(new a.A("pitch",s)).fire(new a.A("pitchend",s)),this.fire(new a.A("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=a.h({offset:[0,0],duration:500,easing:a.eK},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const d=this.transform,_=this.getZoom(),v=this.getBearing(),S=this.getPitch(),E=this.getPadding(),C="zoom"in t?+t.zoom:_,k="bearing"in t?this._normalizeBearing(t.bearing,v):v,L="pitch"in t?+t.pitch:S,j=this._extendPadding(t.padding),B=a.P.convert(t.offset);let q,K,Z;if(d.projection.name==="globe"){const Ae=a.ac.fromLngLat(d.center),We=B.rotate(-d.angle);Ae.x+=We.x/d.worldSize,Ae.y+=We.y/d.worldSize;const Le=Ae.toLngLat(),ut=a.ci.convert(t.center||Le);this._normalizeCenter(ut),q=d.centerPoint.add(We),K=new a.P(Ae.x,Ae.y).mult(d.worldSize),Z=new a.P(a.aD(ut.lng),a.aH(ut.lat)).mult(d.worldSize).sub(K)}else{q=d.centerPoint.add(B);const Ae=d.pointLocation(q),We=a.ci.convert(t.center||Ae);this._normalizeCenter(We),K=d.project(Ae),Z=d.project(We).sub(K)}const J=d.zoomScale(C-_);let Y,se;t.around&&(Y=a.ci.convert(t.around),se=d.locationPoint(Y));const ce=this._zooming||C!==_,pe=this._rotating||v!==k,Se=this._pitching||L!==S,Pe=!d.isPaddingEqual(j),Me=t.retainPadding===!1?d.clone():d,Te=Ae=>We=>{if(ce&&(Ae.zoom=a.ai(_,C,We)),pe&&(Ae.bearing=a.ai(v,k,We)),Se&&(Ae.pitch=a.ai(S,L,We)),Pe&&(Me.interpolatePadding(E,j,We),q=Me.centerPoint.add(B)),Y)Ae.setLocationAtPoint(Y,se);else{const Le=Ae.zoomScale(Ae.zoom-_),ut=C>_?Math.min(2,J):Math.max(.5,J),Je=Math.pow(ut,1-We),dt=Ae.unproject(K.add(Z.mult(We*Je)).mult(Le));Ae.setLocationAtPoint(Ae.renderWorldCopies?dt.wrap():dt,q)}return t.preloadOnly||this._fireMoveEvents(s),Ae};if(t.preloadOnly){const Ae=this._emulate(Te,t.duration,d);return this._preloadTiles(Ae),this}const Ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ce,this._rotating=pe,this._pitching=Se,this._padding=Pe,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,Ee),this._ease(Te(d),(Ae=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(s,Ae)}),t),this}_prepareEase(t,s,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||d.moving||this.fire(new a.A("movestart",t)),this._zooming&&!d.zooming&&this.fire(new a.A("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new a.A("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new a.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new a.A("move",t)),this._zooming&&this.fire(new a.A("zoom",t)),this._rotating&&this.fire(new a.A("rotate",t)),this._pitching&&this.fire(new a.A("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new a.A("zoomend",t)),_&&this.fire(new a.A("rotateend",t)),v&&this.fire(new a.A("pitchend",t)),this.fire(new a.A("moveend",t))}flyTo(t,s){if(this._prefersReducedMotion(t)){const Ye=a.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ye,s)}this.stop(),t=a.h({offset:[0,0],speed:1.2,curve:1.42,easing:a.eK},t);const d=this.transform,_=this.getZoom(),v=this.getBearing(),S=this.getPitch(),E=this.getPadding(),C="zoom"in t?a.ay(+t.zoom,d.minZoom,d.maxZoom):_,k="bearing"in t?this._normalizeBearing(t.bearing,v):v,L="pitch"in t?+t.pitch:S,j=this._extendPadding(t.padding),B=d.zoomScale(C-_),q=a.P.convert(t.offset);let K=d.centerPoint.add(q);const Z=d.pointLocation(K),J=a.ci.convert(t.center||Z);this._normalizeCenter(J);const Y=d.project(Z),se=d.project(J).sub(Y);let ce=t.curve;const pe=Math.max(d.width,d.height),Se=pe/B,Pe=se.mag();if("minZoom"in t){const Ye=a.ay(Math.min(t.minZoom,_,C),d.minZoom,d.maxZoom),vt=pe/d.zoomScale(Ye-_);ce=Math.sqrt(vt/Pe*2)}const Me=ce*ce;function Te(Ye){const vt=(Se*Se-pe*pe+(Ye?-1:1)*Me*Me*Pe*Pe)/(2*(Ye?Se:pe)*Me*Pe);return Math.log(Math.sqrt(vt*vt+1)-vt)}function Ee(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function Ae(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const We=Te(0);let Le=function(Ye){return Ae(We)/Ae(We+ce*Ye)},ut=function(Ye){return pe*((Ae(We)*(Ee(vt=We+ce*Ye)/Ae(vt))-Ee(We))/Me)/Pe;var vt},Je=(Te(1)-We)/ce;if(Math.abs(Pe)<1e-6||!isFinite(Je)){if(Math.abs(pe-Se)<1e-6)return this.easeTo(t,s);const Ye=Se<pe?-1:1;Je=Math.abs(Math.log(Se/pe))/ce,ut=function(){return 0},Le=function(vt){return Math.exp(Ye*ce*vt)}}t.duration="duration"in t?+t.duration:1e3*Je/("screenSpeed"in t?+t.screenSpeed/ce:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const dt=v!==k,wt=L!==S,qe=!d.isPaddingEqual(j),Re=t.retainPadding===!1?d.clone():d,tt=Ye=>vt=>{const bt=vt*Je,It=1/Le(bt);Ye.zoom=vt===1?C:_+Ye.scaleZoom(It),dt&&(Ye.bearing=a.ai(v,k,vt)),wt&&(Ye.pitch=a.ai(S,L,vt)),qe&&(Re.interpolatePadding(E,j,vt),K=Re.centerPoint.add(q));const Dt=vt===1?J:Ye.unproject(Y.add(se.mult(ut(bt))).mult(It));return Ye.setLocationAtPoint(Ye.renderWorldCopies?Dt.wrap():Dt,K),Ye._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),Ye};if(t.preloadOnly){const Ye=this._emulate(tt,t.duration,d);return this._preloadTiles(Ye),this}return this._zooming=!0,this._rotating=dt,this._pitching=wt,this._padding=qe,this._prepareEase(s,!1),this._ease(tt(d),(()=>this._afterEase(s)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,s)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,s,d){d.animate===!1||d.duration===0?(t(1),s()):(this._easeStart=a.q.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((a.q.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=a.bQ(t,-180,180);const d=Math.abs(t-s);return Math.abs(t-360-s)<d&&(t-=360),Math.abs(t+360-s)<d&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const d=t.lng-s.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&a.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,s,d){const _=Math.ceil(15*s/1e3),v=[],S=t(d.clone());for(let E=0;E<=_;E++){const C=S(E/_);v.push(C.clone())}return v}_preloadTiles(t,s){}}class qs{constructor(t={}){this.options=t,a.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=ee("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ee("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const _=ee("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",d),this._innerContainer=ee("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.e.ACCESS_TOKEN}];if(t){const d=s.reduce(((_,v,S)=>(v.value&&(_+=`${v.key}=${v.value}${S<s.length-1?"&":""}`),_)),"?");t.href=`${a.e.FEEDBACK_URL}/${d}#${Ha(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const s=this._map.style._mergedSourceCaches;for(const _ in s){const v=s[_];if(v.used){const S=v.getSource();S.attribution&&t.indexOf(S.attribution)<0&&t.push(S.attribution)}}t.sort(((_,v)=>_.length-v.length)),t=t.filter(((_,v)=>{for(let S=v+1;S<t.length;S++)if(t[S].indexOf(_)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Mc{constructor(){a.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=ee("div","mapboxgl-ctrl");const s=ee("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const d=t[s].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Gd{constructor(){a.aV(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=ee("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",(s=>this._onIndoorUpdate({selectedFloorId:s.selectedFloorId,floors:s.floors}))),this._container}_createButton(t,s){const d=ee("button",t,this._container);return d.type="button",d.addEventListener("click",s),d}_setButtonTitle(t,s){this._map&&(t.setAttribute("aria-label",s),t.innerHTML=`<strong>${s}</strong>`,t.firstElementChild&&t.firstElementChild.setAttribute("title",s))}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return void(this._container.style.display="none");const s=this._model;this._model=t,this._container.style.display="inline-block";const d=t.floors.sort(((_,v)=>_.levelOrder-v.levelOrder));s?(Array.from(this._container.children).forEach((_=>_.remove())),this.addCurrentFloors(d)):this.addCurrentFloors(d)}addCurrentFloors(t){for(const s of t){const d=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(s.id),Array.from(this._container.children).forEach((_=>{_.classList.remove("mapboxgl-ctrl-level-button-selected")})),d.classList.add("mapboxgl-ctrl-level-button-selected")}));this._setButtonTitle(d,s.shortName),this._model&&s.id===this._model.selectedFloorId&&(this._map._selectIndoorFloor(s.id),d.classList.add("mapboxgl-ctrl-level-button-selected")),this._container.append(d)}}}class km{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,d=s?this._queue.concat(s):this._queue;for(const _ of d)if(_.id===t)return void(_.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const d of s)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Gl{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=a.dx((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,d){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+d}}const Hd={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Wd extends a.A{constructor(t,s,d,_){const{point:v,lngLat:S,originalEvent:E,target:C}=t;super(t.type,{point:v,lngLat:S,originalEvent:E,target:C}),this.preventDefault=()=>{t.preventDefault()},this.id=s,this.interaction=d,this.feature=_}}class Zd{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,s){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const d=s.filter;let _=s.type;d&&this.filters.set(t,a.b3(d)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");const v=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,s)):v.size===0&&this.map.on(_,this.handleType),v.size===0&&this.interactionsByType.set(_,v),v.set(t,s),this.typeById.set(t,_)}get(t){const s=this.typeById.get(t);if(!s)return;const d=this.interactionsByType.get(s);return d?d.get(t):void 0}remove(t){const s=this.typeById.get(t);if(!s)return;this.typeById.delete(t),this.filters.delete(t);const d=this.interactionsByType.get(s);d&&(d.delete(t),s==="mouseenter"||s==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(s,this.handleType))}queryTargets(t,s){const d=[];for(const[_,v]of s)v.target&&d.push({targetId:_,target:v.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(t,d,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const s=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());s.length&&(t.type="mouseenter",this.handleType(t,s));const d=new Map;for(const[_,{feature:v}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||d.set(v.id,v);d.size&&(t.type="mouseleave",this.handleType(t,Array.from(d.values())))}handleOut(t){const s=Array.from(this.hoveredFeatures.values()).map((({feature:d})=>d));s.length&&(t.type="mouseleave",this.handleType(t,s)),this.hoveredFeatures.clear()}handleType(t,s){const d=t.type==="mouseenter";if(d&&!this.interactionsByType.has(t.type))return void a.w("mouseenter interaction required for mouseleave to work.");const _=Array.from(this.interactionsByType.get(t.type)).reverse(),v=!!s;s=s||this.queryTargets(t.point,_);let S=!1;const E=new Set;for(const C of s){for(const[k,L]of _){if(!L.target)continue;const j=C.variants?C.variants[k]:null;if(j){for(const B of j){if(iu(B,C,E,k))continue;const q=new a.dr(C,B),K=nu(B,C,k);v&&(q.state=this.map.getFeatureState(q));const Z=d?this.prevHoveredFeatures.get(K):null,J=new Wd(t,k,L,q),Y=Z?Z.stop:L.handler(J);if(d&&this.hoveredFeatures.set(K,{feature:C,stop:Y}),Y!==!1){S=!0;break}}if(S)break}}if(S)break}if(!S)for(const[C,k]of _){const{handler:L,target:j}=k;if(!j&&L(new Wd(t,C,k,null))!==!1)break}}}function Xd(f,t){if(Array.isArray(f)&&Array.isArray(t)){const s=new Set(f),d=new Set(t);return s.size===d.size&&f.every((_=>d.has(_)))}return a.bv(f,t)}const Ph={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},ku={showCompass:!0,showZoom:!0,visualizePitch:!1};class Gs{constructor(t,s,d=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Pf({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new If({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),a.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),ke()}move(t,s){const d=this.map,_=this.mouseRotate.mousemoveWindow(t,s),v=_&&_.bearingDelta;if(v&&d.setBearing(d.getBearing()+v),this.mousePitch){const S=this.mousePitch.mousemoveWindow(t,s),E=S&&S.pitchDelta;E&&d.setPitch(d.getPitch()+E)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){he(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(a.h({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Ne(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Ne(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=rt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=rt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Bi(f,t,s){if(f=new a.ci(f.lng,f.lat),t){const d=new a.ci(f.lng-360,f.lat),_=new a.ci(f.lng+360,f.lat),v=360*Math.ceil(Math.abs(f.lng-s.center.lng)/360),S=s.locationPoint3D(f).distSqr(t),E=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint3D(d).distSqr(t)<S&&(E||Math.abs(d.lng-s.center.lng)<v)?f=d:s.locationPoint3D(_).distSqr(t)<S&&(E||Math.abs(_.lng-s.center.lng)<v)&&(f=_)}for(;Math.abs(f.lng-s.center.lng)>180;){const d=s.locationPoint3D(f);if(d.x>=0&&d.y>=0&&d.x<=s.width&&d.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f}const so={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},lo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Wa extends a.E{constructor(t,s){super(),(t instanceof HTMLElement||s)&&(t=a.h({element:t},s)),a.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:d="center",color:_="#3FB1CE",scale:v=1,draggable:S=!1,clickTolerance:E=0,rotation:C=lo.rotation,rotationAlignment:k=lo.rotationAlignment,pitchAlignment:L=lo.pitchAlignment,occludedOpacity:j=lo.occludedOpacity,altitude:B=lo.altitude}=t||{};this._anchor=d,this._color=_,this._scale=v,this._draggable=S,this._clickTolerance=E,this._rotation=C,this._rotationAlignment=k,this._pitchAlignment=L,this._occludedOpacity=j,this._altitude=B,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=a.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=a.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(Z=>{Z.preventDefault()})),this._element.addEventListener("mousedown",(Z=>{Z.preventDefault()}));const q=this._element.classList;for(const Z in so)q.remove(`mapboxgl-marker-anchor-${Z}`);q.add(`mapboxgl-marker-anchor-${this._anchor}`);const K=t&&t.className?t.className.trim().split(/\s+/):[];q.add(...K),this._popup=null}_createDefaultMarker(){const t=ee("div"),s=ne("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const d=ne("radialGradient",{id:"shadowGradient"},ne("defs",{},s));ne("stop",{offset:"10%","stop-opacity":.4},d),ne("stop",{offset:"100%","stop-opacity":.05},d),ne("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},s)}return ne("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},s),ne("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},s),ne("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},s),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.ci.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||lo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,d=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,d=this._element;this._popup&&(s===d||d.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,s=this._pos;if(!t||!s)return!1;const d=t.unproject(s,this._altitude),_=t.getFreeCameraOptions();if(!_.position)return!1;const v=_.position.toLngLat();return v.distanceTo(d)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(s,this._altitude);let _;t._showingGlobe()&&a.eW(t.transform,this._lngLat)?_=0:(_=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${so[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const t=this._pos,s=this._map,d=this.getPitchAlignment();if(!s||!t||d!=="map")return"";if(!s._showingGlobe()){const C=s.getPitch();return C?`rotateX(${C}deg)`:""}const _=a.cU(a.eX(s.transform,this._lngLat)),v=t.sub(a.eY(s.transform)),S=Math.abs(v.x)+Math.abs(v.y);if(S===0)return"";const E=_/S;return`rotateX(${-v.y*E}deg) rotateY(${v.x*E}deg)`}_calculateZTransform(){const t=this._pos,s=this._map;if(!s||!t)return"";let d=0;const _=this.getRotationAlignment();if(_==="map")if(s._showingGlobe()){const v=s.project(new a.ci(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),S=s.project(new a.ci(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(v);d=a.cU(Math.atan2(S.y,S.x))-90}else d=-s.getBearing();else if(_==="horizon"){const v=a.af(4,6,s.getZoom()),S=a.eY(s.transform);S.y+=v*s.transform.height;const E=t.sub(S),C=a.cU(Math.atan2(E.y,E.x));d=(C>90?C-270:C+90)*(1-v)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=Bi(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),s._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=a.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const s=this._map;if(!s)return;const d=this._pointerdownPos,_=this._positionDelta;if(d&&_){if(!this._isDragging){const v=this._clickTolerance||s._clickTolerance;if(t.point.dist(d)<v)return;this._isDragging=!0}this._pos=t.point.sub(_),this._lngLat=s.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.A("dragstart"))),this.fire(new a.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.A("dragend")),this._state="inactive"}_addDragHandler(t){const s=this._map,d=this._pos;s&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||lo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||lo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||lo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||lo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Dm={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Hs={maxWidth:100,unit:"metric"},zm={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},yl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Lm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Zo(f=new a.P(0,0),t="bottom"){if(typeof f=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(t){case"top":return new a.P(0,f);case"top-left":return new a.P(s,s);case"top-right":return new a.P(-s,s);case"bottom":return new a.P(0,-f);case"bottom-left":return new a.P(s,-s);case"bottom-right":return new a.P(-s,-s);case"left":return new a.P(f,0);case"right":return new a.P(-f,0)}return new a.P(0,0)}return f instanceof a.P||Array.isArray(f)?a.P.convert(f):a.P.convert(f[t]||[0,0])}return{version:R,supported:ae.supported,setRTLTextPlugin:a.f0,getRTLTextPluginStatus:a.e$,Map:class extends Nr{constructor(f){$.mark(z.create);const t=f;if((f=a.h({},Ph,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&a.eU(window)&&(f.antialias=!1,a.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new od(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new km,this._domRenderTaskQueue=new km,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.a$(),this._locale=a.h({},Hd,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Gl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Pt(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const s=document.getElementById(f.container);if(!s)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=s}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&a.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,a.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Cm),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new jo(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||a.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this.indoor=new Qg(this),f.hash&&(this._hash=new Od(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const s=f.bounds;s&&(this.resize(),this.fitBounds(s,a.h({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new qs({customAttribution:f.customAttribution})),this._logoControl=new Mc,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(s=>{this._update(s.dataType==="style"),this.fire(new a.A(`${s.dataType}data`,s))})),this.on("dataloading",(s=>{this.fire(new a.A(`${s.dataType}dataloading`,s))})),this._interactions=new Zd(this)}_getMapId(){return this._mapId}addControl(f,t){if(t===void 0&&(t=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new a.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(s,d.firstChild):d.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new a.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(f);return t>-1&&this._controls.splice(t,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new a.A("movestart",f)).fire(new a.A("move",f)),this.fire(new a.A("resize",f)),t&&this.fire(new a.A("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(a.aG.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new a.A("zoomstart")).fire(new a.A("zoom")).fire(new a.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new a.A("zoomstart")).fire(new a.A("zoom")).fire(new a.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new a.A("pitchstart")).fire(new a.A("pitch")).fire(new a.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new a.A("pitchstart")).fire(new a.A("pitch")).fire(new a.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((t=>t.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map((t=>t==="auto"?navigator.language:t)):f}setLanguage(f){const t=this._parseLanguage(f);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,t=f.projection.name;let s;t==="globe"&&f.zoom>=a.cI?(f.setMercatorFromTransition(),s=!0):t==="mercator"&&f.zoom<a.cI&&(f.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,t){return this._updateProjection(f||t||{name:"mercator"})}_updateProjection(f){let t;return t=f.name==="globe"&&this.transform.zoom>=a.cI?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,t){return this.transform.locationPoint3D(a.ci.convert(f),t)}unproject(f,t){return this.transform.pointLocation3D(a.P.convert(f),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,t,s){const d=_=>{let v=[];if(Array.isArray(t)){const S=t.filter((E=>this.getLayer(E)));v=S.length?this.queryRenderedFeatures(_,{layers:S}):[]}else v=this.queryRenderedFeatures(_,{target:t});return v};if(f==="mouseenter"||f==="mouseover"){let _=!1;return{listener:s,targets:t,delegates:{mousemove:S=>{const E=d(S.point);E.length?_||(_=!0,s.call(this,new ai(f,this,S.originalEvent,{features:E}))):_=!1},mouseout:()=>{_=!1}}}}if(f==="mouseleave"||f==="mouseout"){let _=!1;return{listener:s,targets:t,delegates:{mousemove:E=>{d(E.point).length?_=!0:_&&(_=!1,s.call(this,new ai(f,this,E.originalEvent)))},mouseout:E=>{_&&(_=!1,s.call(this,new ai(f,this,E.originalEvent)))}}}}{const _=v=>{const S=d(v.point);S.length&&(v.features=S,s.call(this,v),delete v.features)};return{listener:s,targets:t,delegates:{[f]:_}}}}on(f,t,s){if(typeof t=="function"||s===void 0)return super.on(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(f,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return this}once(f,t,s){if(typeof t=="function"||s===void 0)return super.once(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(f,t,s);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(f,t,s){if(typeof t=="function"||s===void 0)return super.off(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._delegatedListeners?this._delegatedListeners[f]:void 0;return d&&(_=>{for(let v=0;v<_.length;v++){const S=_[v];if(S.listener===s&&Xd(S.targets,t)){for(const E in S.delegates)this.off(E,S.delegates[E]);return _.splice(v,1),this}}})(d),this}queryRenderedFeatures(f,t){if(!this.style)return[];if(f===void 0||f instanceof a.P||Array.isArray(f)||t!==void 0||(t=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!t){const v=this.style.queryRenderedFeatures(f,void 0,this.transform),S=this.style.queryRenderedFeatureset(f,void 0,this.transform);return v.concat(S)}let s=!0;if(t.target&&(s=this._isTargetValid(t.target),s&&!t.layers))return this.style.queryRenderedFeatureset(f,t,this.transform);let d=!0;if(t.layers&&Array.isArray(t.layers)){for(const v of t.layers)if(!this._isValidId(v)){d=!1;break}if(d&&!t.target)return this.style.queryRenderedFeatures(f,t,this.transform)}let _=[];return d&&(_=_.concat(this.style.queryRenderedFeatures(f,t,this.transform))),s&&(_=_.concat(this.style.queryRenderedFeatureset(f,t,this.transform))),_}querySourceFeatures(f,t){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,t)}isPointOnSurface(f){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&a.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.P.convert(f))}addInteraction(f,t){return this._interactions.add(f,t),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,t){return t=a.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&f&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(f,((s,d)=>{if(s){const _=typeof s=="string"?s:s instanceof Error?s.message:s.error;a.w(`Unable to perform style diff: ${_}. Rebuilding the style from scratch.`),this._updateStyle(f,t)}else d&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(f,t))}_getUIString(f){const t=this._locale[f];if(t==null)throw new Error(`Missing UI string '${f}'`);return t}_updateStyle(f,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const s=a.h({},t);t&&t.config&&(s.initialConfig=t.config,delete s.config),this.style=new ra(this,s).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ra(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new a.z(new Error("IDs can't be empty."))),!1):!a.dk(f)||(this.fire(new a.z(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const t of f)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(f)}addSource(f,t){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,t),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(f,t,s)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,t,{pixelRatio:s=1,sdf:d=!1,stretchX:_,stretchY:v,content:S}={}){this._lazyInitEmptyStyle();const E=a.I.from(f);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:C,height:k,data:L}=a.q.getImageData(t);this.style.addImage(E,{data:new a.r({width:C,height:k},L),pixelRatio:s,stretchX:_,stretchY:v,content:S,sdf:d,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new a.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:k}=t,L=t;this.style.addImage(E,{data:new a.r({width:C,height:k},new Uint8Array(L.data)),pixelRatio:s,stretchX:_,stretchY:v,content:S,sdf:d,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,f)}}updateImage(f,t){this._lazyInitEmptyStyle();const s=a.I.from(f),d=this.style.getImage(s);if(!d)return void this.fire(new a.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?a.q.getImageData(t):t,{width:v,height:S,data:E}=_;if(v===void 0||S===void 0)return void this.fire(new a.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==(d.usvg?d.icon.usvg_tree.width:d.data.width)||S!==(d.usvg?d.icon.usvg_tree.height:d.data.height))return void this.fire(new a.z(new Error(`The width and height of the updated image (${v}, ${S})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const C=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let k=!1;d.usvg?(d.data=new a.r({width:v,height:S},new Uint8Array(E)),d.usvg=!1,d.icon=void 0,k=!0):d.data.replace(E,C),this.style.updateImage(s,d,k)}hasImage(f){return f?!!this.style&&!!this.style.getImage(a.I.from(f)):(this.fire(new a.z(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(a.I.from(f))}loadImage(f,t){a.o(this._requestManager.transformRequest(f,a.R.Image),((s,d)=>{t(s,d instanceof HTMLImageElement?a.q.getImageData(d):d)}))}listImages(){return this.style.listImages().map((f=>f.name))}addModel(f,t){this._lazyInitEmptyStyle(),this.style.addModel(f,t)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new a.z(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,t){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,t),this._update(!0)):this}getSlot(f){const t=this.getLayer(f);return t&&t.slot||null}setSlot(f,t){return this.style.setSlot(f,t),this.style.mergeLayers(),this._update(!0)}addImport(f,t){return this.style.addImport(f,t).catch((s=>this.fire(new a.z(new Error("Failed to add import",s))))),this}updateImport(f,t){return typeof t!="string"&&t.id!==f?(this.removeImport(f),this.addImport(t)):(this.style.updateImport(f,t),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,t){return this.style.moveImport(f,t),this._update(!0)}moveLayer(f,t){return this._isValidId(f)?(this.style.moveLayer(f,t),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const t=this.style.getOwnLayer(f);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,t,s){return this._isValidId(f)?(this.style.setLayerZoomRange(f,t,s),this._update(!0)):this}setFilter(f,t,s={}){return this._isValidId(f)?(this.style.setFilter(f,t,s),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,t,s,d={}){return this._isValidId(f)?(this.style.setPaintProperty(f,t,s,d),this._update(!0)):this}getPaintProperty(f,t){return this._isValidId(f)?this.style.getPaintProperty(f,t):null}setLayoutProperty(f,t,s,d={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,t,s,d),this._update(!0)):this}getLayoutProperty(f,t){return this._isValidId(f)?this.style.getLayoutProperty(f,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,t){return this.style.setSchema(f,t),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,t){return this.style.setConfig(f,t),this._update(!0)}getConfigProperty(f,t){return this.style.getConfigProperty(f,t)}setConfigProperty(f,t,s){return this.style.setConfigProperty(f,t,s),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const t=f[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,t),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.ci.convert(f),this.transform):0}setFeatureState(f,t){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,t),this._update())}removeFeatureState(f,t){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,t),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.indoor.selectFloor(f)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Gd),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let s,d,_,v=this._container;for(;v&&(!d||!_);){const S=window.getComputedStyle(v).transform;S&&S!=="none"&&(s=S.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(d=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(_=s[3])),v=v.parentElement}this._containerWidth=d?Math.abs(f/d):f,this._containerHeight=_?Math.abs(t/_):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=ee("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ee("div","mapboxgl-canvas-container",f);this._canvas=ee("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=ee("div","mapboxgl-control-container",f),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((_=>{d[_]=ee("div",`mapboxgl-ctrl-${_}`,s)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,t){const s=a.q.devicePixelRatio||1;this._canvas.width=s*Math.ceil(f),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${t}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const t=this._markers.indexOf(f);t!==-1&&this._markers.splice(t,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const t=this._popups.indexOf(f);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const f=a.h({},ae.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",f);t?(sr(t,!0),this.painter=new Cu(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),a.l.testSupport(t)):this.fire(new a.z(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.A("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new a.A("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let t;this.fire(new a.A("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,d=a.q.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=_.createQuery(),_.beginQuery(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,L=this.transform.pitch,j=a.q.now(),B=new a.aa(k,{now:j,fadeDuration:v,pitch:L,transition:this.style.transition,worldview:this._worldview});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(d),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(d);const E=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),E&&(this._placementDirty=E.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,$.mark(z.load),this.fire(new a.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const k=a.q.now()-d;_.endQuery(s.TIME_ELAPSED_EXT),setTimeout((()=>{const L=_.getQueryParameter(t,_.QUERY_RESULT)/1e6;_.deleteQuery(t),this.fire(new a.A("gpu-timing-frame",{cpuTime:k,gpuTime:L}))}),50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout((()=>{const L=this.painter.queryGpuTimers(k);this.fire(new a.A("gpu-timing-layer",{layerTimes:L}))}),50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const L=this.painter.queryGpuTimeDeferredRender(k);this.fire(new a.A("gpu-timing-deferred-render",{gpuTime:L}))}),50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(C||this._repaint)this.triggerRepaint();else{const k=this.idle();if(k&&(S=this._updateAverageElevation(d,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new a.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new a.A("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,$.mark(z.fullLoad),this._performanceMetricsCollection&&Ur(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const t of this._markers)f&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!f||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(f,t=!1){const s=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const _=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=f;const S=Math.abs(_-v);if(S>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(v),s(v);this._averageElevation.easeTo(v,f,300)}else if(S>1e-4)return this._averageElevation.jumpTo(v),s(v)}return!!this._averageElevation.isEasing(f)&&s(this._averageElevation.getValue(f))}_authenticate(){Er(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(f=>{if(f&&(f.message===gt||f.status===401)){const t=this.painter.context.gl;sr(t,!1),this._logoControl instanceof Mc&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),zr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&Ir(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,d=s.createFramebuffer();function _(v){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,v,0);const S=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,S),S}return s.bindFramebuffer(s.FRAMEBUFFER,d),this._canvasPixelComparison(_(f),t.canvasCopies.map(_),t.timeStamps)}_canvasPixelComparison(f,t,s){let d=s[1]-s[0];const _=f.length/4;for(let v=0;v<t.length;v++){const S=t[v];let E=0;for(let C=0;C<S.length;C+=4)S[C]===f[C]&&S[C+1]===f[C+1]&&S[C+2]===f[C+2]&&S[C+3]===f[C+3]&&(E+=1);d+=(s[v+2]-s[v+1])*(1-E/_)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),pn.delete(this.painter.context.gl),or.remove(),fr.remove(),this._removed=!0,this.fire(new a.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=a.q.frame((t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)})))}_preloadTiles(f){const t=this.style?this.style.getSourceCaches():[];return a.bt(t,((s,d)=>s._preloadTiles(f,d)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,t){a.eV(f,t)}get version(){return R}},NavigationControl:class{constructor(f={}){this.options=a.h({},ku,f),this._container=ee("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(a.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),ee("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),ee("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))})),this._compassIcon=ee("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const t=f.getZoom(),s=t===f.getMaxZoom(),d=t===f.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Gs(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,t){const s=ee("button",f,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(f,t){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${t}`);f.setAttribute("aria-label",s),f.firstElementChild&&f.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends a.E{constructor(f={}){super();const t=navigator.geolocation;this.options=a.h({geolocation:t},Dm,f),a.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=xh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=ee("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const t=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,f(s)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((s=>t(s.state!=="denied"))).catch((()=>t())):t()}_isOutOfMapMaxBounds(f){const t=this._map.getMaxBounds(),s=f.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new a.A("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.A("geolocate",f)),this._finish()}}_updateCamera(f){const t=new a.ci(f.coords.longitude,f.coords.latitude),s=f.coords.accuracy,d=this._map.getBearing(),_=a.h({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),_,{geolocateSource:!0})}_updateMarker(f){if(f){const t=new a.ci(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,t=a.cb(1,f._center.lat)*f.worldSize,s=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new a.A("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=ee("button","mapboxgl-ctrl-geolocate",this._container),ee("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ee("div","mapboxgl-user-location"),this._dotElement.appendChild(ee("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ee("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Wa({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ee("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.A("trackuserlocationend")))}))}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((t=>{t==="granted"&&f()})).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:qs,ScaleControl:class{constructor(f={}){this.options=a.h({},Hs,f),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),a.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,t=this._map,s=t._containerHeight/2,d=t._containerWidth/2-f/2,_=t.unproject([d,s]),v=t.unproject([d+f,s]),S=_.distanceTo(v);if(this.options.unit==="imperial"){const E=3.2808*S;E>5280?this._setScale(f,E/5280,"mile"):this._setScale(f,E,"foot")}else this.options.unit==="nautical"?this._setScale(f,S/1852,"nautical-mile"):S>=1e3?this._setScale(f,S/1e3,"kilometer"):this._setScale(f,S,"meter")}_setScale(f,t,s){this._map._requestDomTask((()=>{const d=(function(v){const S=Math.pow(10,`${Math.floor(v)}`.length-1);let E=v/S;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:(function(C){const k=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*k)/k})(E),S*E})(t),_=d/t;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(d):`${d}&nbsp;${zm[s]}`,this._container.style.width=f*_+"px"}))}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=ee("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:a.w("Full screen control 'container' must be a DOM element.")),a.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=ee("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=ee("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ee("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Gd,Popup:class extends a.E{constructor(f){super(),this.options=a.h(Object.create(yl),f),this._altitude=this.options.altitude,a.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new a.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new a.A("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=a.ci.convert(f),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const t=document.createDocumentFragment(),s=document.createElement("body");let d;for(s.innerHTML=f;d=s.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=ee("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(f),this.options.closeButton){const s=this._closeButton=ee("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.innerHTML='<span aria-hidden="true">&#215;</span>',s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let t;return this._classList.delete(f)?t=!1:(this._classList.add(f),t=!0),this._updateClassList(),t}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const t=this._map,s=this._container,d=this._pos;if(!t||!s||!d)return"bottom";const _=s.offsetWidth,v=s.offsetHeight,S=d.x<_/2,E=d.x>t.transform.width-_/2;if(d.y+f<v)return S?"top-left":E?"top-right":"top";if(d.y>t.transform.height-v){if(S)return"bottom-left";if(E)return"bottom-right"}return S?"left":E?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),f.className=t.join(" ")}_update(f){const t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let d=this._container;if(d||(d=this._container=ee("div","mapboxgl-popup",t.getContainer()),this._tip=ee("div","mapboxgl-popup-tip",d),d.appendChild(s)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bi(this._lngLat,this._pos,t.transform)),!this._trackPointer||f){const _=this._pos=this._trackPointer&&f instanceof a.P?f:t.project(this._lngLat,this._altitude),v=Zo(this.options.offset),S=this._anchor=this._getAnchor(v.y),E=Zo(this.options.offset,S),C=_.add(E).round();t._requestDomTask((()=>{this._container&&S&&(this._container.style.transform=`${so[S]} translate(${C.x}px,${C.y}px)`)}))}if(!this._marker&&t._showingGlobe()){const _=a.eW(t.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Lm);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Wa,Style:ra,LngLat:a.ci,LngLatBounds:a.aG,Point:a.P,MercatorCoordinate:a.ac,FreeCameraOptions:ic,Evented:a.E,config:a.e,prewarm:a.e_,clearPrewarmedResources:a.eZ,get accessToken(){return a.e.ACCESS_TOKEN},set accessToken(f){a.e.ACCESS_TOKEN=f},get baseApiUrl(){return a.e.API_URL},set baseApiUrl(f){a.e.API_URL=f},get workerCount(){return a.f7.workerCount},set workerCount(f){a.f7.workerCount=f},get maxParallelImageRequests(){return a.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){a.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){a.f6(f)},get workerUrl(){return a.f5.workerUrl},set workerUrl(f){a.f5.workerUrl=f},get workerClass(){return a.f5.workerClass},set workerClass(f){a.f5.workerClass=f},get workerParams(){return a.f5.workerParams},set workerParams(f){a.f5.workerParams=f},get dracoUrl(){return a.f4()},set dracoUrl(f){a.f3(f)},get meshoptUrl(){return a.f2()},set meshoptUrl(f){a.f1(f)},setNow:a.q.setNow,restoreNow:a.q.restoreNow}}));var P=y;return P}))})(s0)),s0.exports}var vre=yre();const OA=Xi(vre);OA.accessToken="pk.eyJ1IjoiYWNtb3JhLWNsb3VkeSIsImEiOiJjbWY0bWUyNjYwNzlkMmlva2lwdG5yOXF5In0.XGV4ZIaC_lJPOIV1lN_jlw";function xre({selectedCountries:r}){const n=ir.useRef(null),l=ir.useRef(null);return ir.useEffect(()=>{if(!n.current||l.current)return;const c=new OA.Map({container:n.current,style:"mapbox://styles/mapbox/light-v11",center:[0,20],projection:"mercator",zoom:2});return c.addControl(new OA.NavigationControl),c.on("load",()=>{c.addSource("south-america",{type:"geojson",data:"https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson"}),c.addLayer({id:"south-america-layer",type:"fill",source:"south-america",paint:{"fill-color":["case",["in",["get","ISO3166-1-Alpha-3"],["literal",r]],"#030213","transparent"],"fill-opacity":.7}})}),c.on("click","south-america-layer",y=>{const w=y.features?.[0]?.properties?.name;w&&alert(`Clicked on ${w}`)}),l.current=c,()=>c.remove()},[]),ir.useEffect(()=>{const c=l.current;c&&c.getLayer("south-america-layer")&&c.setPaintProperty("south-america-layer","fill-color",["case",["in",["get","ISO3166-1-Alpha-3"],["literal",r]],"#030213","transparent"])},[r]),Bt.jsx("div",{ref:n,style:{width:"100%",height:"500px",borderRadius:"12px"}})}const bre=[{name:"Ecuador",count:22,flag:"🇪🇨",code:"ECU"},{name:"España",count:35,flag:"🇪🇸",code:"ESP"},{name:"Colombia",count:34,flag:"🇨🇴",code:"COL"}];function wre(){const[r,n]=ir.useState(["Ecuador","España","Colombia"]),[l,c]=ir.useState(null),y=w=>{n(P=>P.includes(w)?P.filter(a=>a!==w):[...P,w])};return Bt.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[Bt.jsxs(mg,{className:"p-4",children:[Bt.jsx("h3",{className:"text-sm font-medium mb-4",children:"Países seleccionados"}),Bt.jsxs("div",{className:"flex gap-2 mb-4",children:[Bt.jsx(up,{variant:"selected",size:"sm",children:"Seleccionado"}),Bt.jsx(up,{variant:"ghost",size:"sm",children:"Inactivo"})]}),Bt.jsx(xre,{selectedCountries:r})]}),Bt.jsxs(mg,{className:"p-4",children:[Bt.jsx("h3",{className:"text-sm font-medium mb-4",children:"Países"}),Bt.jsx("div",{className:"space-y-3",children:bre.map(w=>Bt.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg cursor-pointer transition-colors hover:bg-accent/50 ${r.includes(w.code)?"bg-accent/30":""}`,onClick:()=>y(w.code),children:[Bt.jsxs("div",{className:"flex items-center gap-3",children:[Bt.jsx("div",{className:"w-6 h-4 rounded bg-gradient-to-r from-red-500 to-yellow-500 flex items-center justify-center",children:Bt.jsx("span",{className:"text-xs",children:w.flag})}),Bt.jsx("span",{className:"font-medium",children:w.name})]}),Bt.jsx("span",{className:"text-muted-foreground",children:w.count})]},w.name))})]})]})}function Sre({className:r,...n}){return Bt.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:Bt.jsx("table",{"data-slot":"table",className:Hf("w-full caption-bottom text-sm",r),...n})})}function Tre({className:r,...n}){return Bt.jsx("thead",{"data-slot":"table-header",className:Hf("[&_tr]:border-b",r),...n})}function Ere({className:r,...n}){return Bt.jsx("tbody",{"data-slot":"table-body",className:Hf("[&_tr:last-child]:border-0",r),...n})}function O3({className:r,...n}){return Bt.jsx("tr",{"data-slot":"table-row",className:Hf("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",r),...n})}function i0({className:r,...n}){return Bt.jsx("th",{"data-slot":"table-head",className:Hf("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",r),...n})}function o0({className:r,...n}){return Bt.jsx("td",{"data-slot":"table-cell",className:Hf("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",r),...n})}const Are=[{name:"Juan Pérez",publications:50,citations:1200,hIndex:20},{name:"María Gómez",publications:40,citations:900,hIndex:18},{name:"Carlos Rodríguez",publications:30,citations:700,hIndex:15}];function Pre(){return Bt.jsxs("div",{className:"p-4",children:[Bt.jsx("h3",{className:"text-sm font-medium mb-4",children:"Autores Destacados"}),Bt.jsxs(Sre,{children:[Bt.jsx(Tre,{children:Bt.jsxs(O3,{children:[Bt.jsx(i0,{children:"Nombre"}),Bt.jsx(i0,{children:"Publicaciones"}),Bt.jsx(i0,{children:"Citas"}),Bt.jsx(i0,{children:"Índice h"})]})}),Bt.jsx(Ere,{children:Are.map(r=>Bt.jsxs(O3,{children:[Bt.jsx(o0,{children:r.name}),Bt.jsx(o0,{children:r.publications}),Bt.jsx(o0,{children:r.citations}),Bt.jsx(o0,{children:r.hIndex})]},r.name))})]})]})}function Ire(){const[r,n]=ir.useState("dashboard"),[l,c]=ir.useState("resumen"),y=P=>{n(P)},w=P=>{c(P)};return Bt.jsxs("div",{className:"flex h-screen bg-gray-50",children:[Bt.jsx(HV,{activeItem:r,onItemClick:y}),Bt.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[Bt.jsx(WV,{activeTab:l,onTabChange:w}),Bt.jsx("div",{className:"flex-1 overflow-auto",children:Bt.jsx("div",{className:"p-6",children:l==="resumen"?Bt.jsxs("div",{className:"space-y-6",children:[Bt.jsx(ZV,{}),Bt.jsx(gre,{}),Bt.jsx(wre,{})]}):Bt.jsxs("div",{className:"text-center py-12",children:[Bt.jsx("h2",{className:"text-xl font-semibold text-muted-foreground",children:"Base de datos"}),Bt.jsx(Pre,{})]})})})]})]})}BU.createRoot(document.getElementById("root")).render(Bt.jsx(Ire,{}));
